√˜
MD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\EFactura\FacturacionDatos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
{ 
public 

class 
FacturacionDatos !
:" ##
EFacturaRepositorioBase$ ;
,; <#
IFacturacionRepositorio= T
{ 
public #
IFacturacionRepositorio &#
ObtenerNuevoRepositorio' >
(> ?
)? @
{ 	
return 
new 
FacturacionDatos '
(' (
)( )
;) *
} 	
public 
OperationResult 
CrearDocumento -
(- .
	Documento. 7
	documento8 A
)A B
{ 	
try 
{ 
_db 
. 
	Documento 
. 
Add !
(! "
	documento" +
)+ ,
;, -
var 
result 
= 
Save !
(! "
)" #
;# $
result 
. 
data 
= 
	documento '
.' (
id( *
;* +
return 
result 
; 
} 
catch   
(   
	Exception   
e   
)   
{!! 
throw"" 
e"" 
;"" 
}## 
}$$ 	
public&& 
OperationResult&& 
ActualizarDocumento&& 2
(&&2 3
	Documento&&3 <
	documento&&= F
)&&F G
{'' 	
try(( 
{)) 
	Documento** 
dbDocumento** %
=**& '
_db**( +
.**+ ,
	Documento**, 5
.**5 6
Single**6 <
(**< =
c**= >
=>**? A
c**B C
.**C D
id**D F
==**G I
	documento**J S
.**S T
id**T V
)**V W
;**W X
_db++ 
.++ 
Entry++ 
(++ 
dbDocumento++ %
)++% &
.++& '
CurrentValues++' 4
.++4 5
	SetValues++5 >
(++> ?
	documento++? H
)++H I
;++I J
var,, 
result,, 
=,, 
Save,, !
(,,! "
),," #
;,,# $
result-- 
.-- 
data-- 
=-- 
	documento-- '
.--' (
id--( *
;--* +
return.. 
result.. 
;.. 
}// 
catch00 
(00 
	Exception00 
e00 
)00 
{11 
return22 
new22 
OperationResult22 *
(22* +
e22+ ,
)22, -
;22- .
}33 
}44 	
public66 
OperationResult66 %
ActualizarEstadoDocumento66 8
(668 9
long669 =

idSigescom66> H
,66H I&
EstadoDocumentoElectronico66J d
estado66e k
,66k l/
"EstadoSigescomDocumentoElectronico	66m è
estadoSigescom
66ê û
)
66û ü
{77 	
try88 
{99 
	Documento:: 
dbDocumento:: %
=::& '
_db::( +
.::+ ,
	Documento::, 5
.::5 6
Single::6 <
(::< =
c::= >
=>::? A
c::B C
.::C D

idSigescom::D N
==::O Q

idSigescom::R \
)::\ ]
;::] ^
dbDocumento;; 
.;; 
estado;; "
=;;# $
(;;% &
int;;& )
);;) *
estado;;* 0
;;;0 1
dbDocumento<< 
.<< 
estadoSigescom<< *
=<<+ ,
(<<- .
int<<. 1
)<<1 2
estadoSigescom<<2 @
;<<@ A
var== 
result== 
=== 
Save== !
(==! "
)==" #
;==# $
result>> 
.>> 
data>> 
=>> 
dbDocumento>> )
.>>) *
id>>* ,
;>>, -
return?? 
result?? 
;?? 
}@@ 
catchAA 
(AA 
	ExceptionAA 
eAA 
)AA 
{BB 
returnCC 
newCC 
OperationResultCC *
(CC* +
eCC+ ,
)CC, -
;CC- .
}DD 
}EE 	
publicGG 
OperationResultGG "
CrearDocumentosMasivosGG 5
(GG5 6
ListGG6 :
<GG: ;
	DocumentoGG; D
>GGD E
ListaDocumentosGGF U
)GGU V
{HH 	
tryII 
{JJ 
ListKK 
<KK 
stringKK 
>KK 
comandosSQLKK (
=KK) *
newKK+ .
ListKK/ 3
<KK3 4
stringKK4 :
>KK: ;
(KK; <
)KK< =
;KK= >
comandosSQLLL 
.LL 
AddLL 
(LL  
$strLL  8
)LL8 9
;LL9 :
ListMM 
<MM 
SqlParameterMM !
>MM! "
parametrosSqlMM# 0
=MM1 2
newMM3 6
ListMM7 ;
<MM; <
SqlParameterMM< H
>MMH I
(MMI J
)MMJ K
;MMK L
intNN 
indexNN 
=NN 
$numNN 
;NN 
foreachOO 
(OO 
varOO 
	documentoOO &
inOO' )
ListaDocumentosOO* 9
)OO9 :
{PP 
varQQ 
comandoActualQQ %
=QQ& '
(QQ( )
EnvironmentQQ) 4
.QQ4 5
NewLineQQ5 <
+QQ= >
$strQQ? m
+QQn o
indexQQp u
+QQv w
$str	QQx æ
+
QQø ¿
	documento
QQ¡  
.
QQ  À

idSigescom
QQÀ ’
+
QQ÷ ◊
$str
QQÿ ‹
+
QQ› ﬁ
	documento
QQﬂ Ë
.
QQË È#
codigoTipoComprobante
QQÈ ˛
+
QQˇ Ä
$str
QQÅ Ü
+
QQá à
	documento
QQâ í
.
QQí ì
serieComprobante
QQì £
+
QQ§ •
$str
QQ¶ ´
+
QQ¨ ≠
	documento
QQÆ ∑
.
QQ∑ ∏
numeroComprobante
QQ∏ …
+
QQ  À
$str
QQÃ —
+
QQ“ ”
	documento
QQ‘ ›
.
QQ› ﬁ
fechaEmision
QQﬁ Í
.
QQÍ Î
ToString
QQÎ Û
(
QQÛ Ù
$str
QQÙ ç
)
QQç é
+
QQè ê
$str
QQë °
+
QQ¢ £
	documento
QQ§ ≠
.
QQ≠ Æ
tipoComprobante
QQÆ Ω
+
QQæ ø
$str
QQ¿ ƒ
+
QQ≈ ∆
+
QQ« »
	documento
QQ» —
.
QQ— “
estado
QQ“ ÿ
+
QQŸ ⁄
$str
QQ€ ﬁ
+
QQﬂ ‡
+
QQ· ‚
	documento
QQ‚ Î
.
QQÎ Ï
estadoSigescom
QQÏ ˙
+
QQ˚ ¸
$str
QQ˝ É
)
QQÉ Ñ
;
QQÑ Ö
varRR 
parametroActualRR '
=RR( )
newRR* -
SqlParameterRR. :
(RR: ;
$strRR; M
+RRN O
indexRRP U
,RRU V
SystemRRW ]
.RR] ^
DataRR^ b
.RRb c
	SqlDbTypeRRc l
.RRl m
	VarBinaryRRm v
)RRv w
;RRw x
parametroActualSS #
.SS# $
ValueSS$ )
=SS* +
	documentoSS, 5
.SS5 6
BinarioSS6 =
.SS= >
archivoBinarioSS> L
;SSL M
comandosSQLTT 
.TT  
AddTT  #
(TT# $
comandoActualTT$ 1
)TT1 2
;TT2 3
parametrosSqlUU !
.UU! "
AddUU" %
(UU% &
parametroActualUU& 5
)UU5 6
;UU6 7
indexVV 
++VV 
;VV 
}WW 
stringXX 
comandoAEjecutarXX '
=XX( )
$strXX* ,
;XX, -
foreachYY 
(YY 
varYY 
itemYY !
inYY" $
comandosSQLYY% 0
)YY0 1
{ZZ 
comandoAEjecutar[[ $
+=[[% '
item[[( ,
;[[, -
}\\ 
var]] 
	resultado]] 
=]] 
_db]]  #
.]]# $
Database]]$ ,
.]], -
ExecuteSqlCommand]]- >
(]]> ?
comandoAEjecutar]]? O
,]]O P
parametrosSql]]Q ^
.]]^ _
ToArray]]_ f
(]]f g
)]]g h
)]]h i
;]]i j
var^^ 
resultadoDetails^^ $
=^^% &
new^^' *
OperationResult^^+ :
(^^: ;
OperationResultEnum^^; N
.^^N O
Success^^O V
)^^V W
;^^W X
return__ 
resultadoDetails__ '
;__' (
}`` 
catchaa 
(aa 
	Exceptionaa 
eaa 
)aa 
{bb 
throwcc 
newcc 
DatosExceptioncc (
(cc( )
$strcc) U
,ccU V
eccW X
)ccX Y
;ccY Z
}dd 
}ee 	
publickk 
OperationResultkk 

CrearEnviokk )
(kk) *
Enviokk* /
enviokk0 5
)kk5 6
{ll 	
trymm 
{nn 
_dboo 
.oo 
Enviooo 
.oo 
Addoo 
(oo 
enviooo #
)oo# $
;oo$ %
varpp 
resultpp 
=pp 
Savepp !
(pp! "
)pp" #
;pp# $
resultqq 
.qq 
dataqq 
=qq 
envioqq #
.qq# $
idqq$ &
;qq& '
returnrr 
resultrr 
;rr 
}ss 
catchtt 
(tt 
	Exceptiontt 
ett 
)tt 
{uu 
throwvv 
evv 
;vv 
}ww 
}xx 	
publiczz 
OperationResultzz 
ActualizarEnviozz .
(zz. /
Enviozz/ 4
enviozz5 :
)zz: ;
{{{ 	
try|| 
{}} 
string~~ 
comando~~ 
=~~  
$str~~! >
+~~? @
envio~~A F
.~~F G
estado~~G M
+~~N O
$str~~P h
+~~i j
envio~~k p
.~~p q
codigoRespuesta	~~q Ä
+
~~Å Ç
$str
~~É ó
+
~~ò ô
envio
~~ö ü
.
~~ü †
observacion
~~† ´
.
~~´ ¨
Replace
~~¨ ≥
(
~~≥ ¥
$str
~~¥ ∑
,
~~∑ ∏
$str
~~π Ω
)
~~Ω æ
+
~~ø ¿
$str
~~¡ €
+
~~‹ ›
(
~~ﬁ ﬂ
envio
~~ﬂ ‰
.
~~‰ Â 
idBinarioRespuesta
~~Â ˜
==
~~¯ ˙
null
~~˚ ˇ
?
~~Ä Å
$str
~~Ç à
:
~~â ä
(
~~ã å
$str
~~å è
+
~~ê ë
envio
~~í ó
.
~~ó ò 
idBinarioRespuesta
~~ò ™
+
~~´ ¨
$str
~~≠ ∞
)
~~∞ ±
)
~~± ≤
+
~~≥ ¥
$str
~~µ √
+
~~ƒ ≈
envio
~~∆ À
.
~~À Ã
id
~~Ã Œ
+
~~œ –
$str
~~— ‘
;
~~‘ ’
_db 
. 
Database 
. 
ExecuteSqlCommand .
(. /
comando/ 6
)6 7
;7 8
return
ÄÄ 
new
ÄÄ 
OperationResult
ÄÄ *
(
ÄÄ* +!
OperationResultEnum
ÄÄ+ >
.
ÄÄ> ?
Success
ÄÄ? F
)
ÄÄF G
;
ÄÄG H
}
ÅÅ 
catch
ÇÇ 
(
ÇÇ 
	Exception
ÇÇ 
e
ÇÇ 
)
ÇÇ 
{
ÉÉ 
return
ÑÑ 
new
ÑÑ 
OperationResult
ÑÑ *
(
ÑÑ* +
e
ÑÑ+ ,
)
ÑÑ, -
;
ÑÑ- .
}
ÖÖ 
}
ÜÜ 	
public
áá 
OperationResult
áá 
ActualizarEnvios
áá /
(
áá/ 0
List
áá0 4
<
áá4 5
Envio
áá5 :
>
áá: ;
enviosAActualizar
áá< M
)
ááM N
{
àà 	
try
ââ 
{
ää 
List
ãã 
<
ãã 
string
ãã 
>
ãã 
lineasComandos
ãã +
=
ãã, -
new
ãã. 1
List
ãã2 6
<
ãã6 7
string
ãã7 =
>
ãã= >
(
ãã> ?
)
ãã? @
;
ãã@ A
foreach
åå 
(
åå 
var
åå 
item
åå !
in
åå" $
enviosAActualizar
åå% 6
)
åå6 7
{
çç 
lineasComandos
éé "
.
éé" #
Add
éé# &
(
éé& '
Environment
éé' 2
.
éé2 3
NewLine
éé3 :
+
éé; <
$str
éé= Z
+
éé[ \
item
éé] a
.
ééa b
estado
ééb h
+
ééi j
$stréék É
+ééÑ Ö
itemééÜ ä
.ééä ã
codigoRespuestaééã ö
+ééõ ú
$strééù ±
+éé≤ ≥
iteméé¥ ∏
.éé∏ π
observacionééπ ƒ
.ééƒ ≈
Replaceéé≈ Ã
(ééÃ Õ
$strééÕ –
,éé– —
$stréé“ ÷
)éé÷ ◊
+ééÿ Ÿ
$stréé⁄ ı
+ééˆ ˜
iteméé¯ ¸
.éé¸ ˝"
idBinarioRespuestaéé˝ è
+ééê ë
$strééí °
+éé¢ £
iteméé§ ®
.éé® ©
idéé© ´
+éé¨ ≠
$strééÆ ±
)éé± ≤
;éé≤ ≥
}
èè 
string
êê 
comando
êê 
=
êê  
$str
êê! #
;
êê# $
foreach
ëë 
(
ëë 
var
ëë 
item
ëë !
in
ëë" $
lineasComandos
ëë% 3
)
ëë3 4
{
íí 
comando
ìì 
+=
ìì 
item
ìì #
;
ìì# $
}
îî 
_db
ïï 
.
ïï 
Database
ïï 
.
ïï 
ExecuteSqlCommand
ïï .
(
ïï. /
comando
ïï/ 6
)
ïï6 7
;
ïï7 8
return
ññ 
new
ññ 
OperationResult
ññ *
(
ññ* +!
OperationResultEnum
ññ+ >
.
ññ> ?
Success
ññ? F
)
ññF G
;
ññG H
}
óó 
catch
òò 
(
òò 
	Exception
òò 
e
òò 
)
òò 
{
ôô 
return
öö 
new
öö 
OperationResult
öö *
(
öö* +
e
öö+ ,
)
öö, -
;
öö- .
}
õõ 
}
úú 	
public
ûû 
OperationResult
ûû 0
"ActualizarObservacionYEstadoEnvios
ûû A
(
ûûA B
List
ûûB F
<
ûûF G
Envio
ûûG L
>
ûûL M
enviosAActualizar
ûûN _
)
ûû_ `
{
üü 	
try
†† 
{
°° 
List
¢¢ 
<
¢¢ 
string
¢¢ 
>
¢¢ 
lineasComandos
¢¢ +
=
¢¢, -
new
¢¢. 1
List
¢¢2 6
<
¢¢6 7
string
¢¢7 =
>
¢¢= >
(
¢¢> ?
)
¢¢? @
;
¢¢@ A
foreach
££ 
(
££ 
var
££ 
item
££ !
in
££" $
enviosAActualizar
££% 6
)
££6 7
{
§§ 
lineasComandos
•• "
.
••" #
Add
••# &
(
••& '
Environment
••' 2
.
••2 3
NewLine
••3 :
+
••; <
$str
••= _
+
••` a
item
••b f
.
••f g
observacion
••g r
.
••r s
Replace
••s z
(
••z {
$str
••{ ~
,
••~ 
$str••Ä Ñ
)••Ñ Ö
+••Ü á
$str••à ñ
+••ó ò
item••ô ù
.••ù û
estado••û §
+••• ¶
$str••ß µ
+••∂ ∑
item••∏ º
.••º Ω
id••Ω ø
+••¿ ¡
$str••¬ ≈
)••≈ ∆
;••∆ «
}
¶¶ 
string
ßß 
comando
ßß 
=
ßß  
$str
ßß! #
;
ßß# $
foreach
®® 
(
®® 
var
®® 
item
®® !
in
®®" $
lineasComandos
®®% 3
)
®®3 4
{
©© 
comando
™™ 
+=
™™ 
item
™™ #
;
™™# $
}
´´ 
_db
¨¨ 
.
¨¨ 
Database
¨¨ 
.
¨¨ 
ExecuteSqlCommand
¨¨ .
(
¨¨. /
comando
¨¨/ 6
)
¨¨6 7
;
¨¨7 8
return
≠≠ 
new
≠≠ 
OperationResult
≠≠ *
(
≠≠* +!
OperationResultEnum
≠≠+ >
.
≠≠> ?
Success
≠≠? F
)
≠≠F G
;
≠≠G H
}
ÆÆ 
catch
ØØ 
(
ØØ 
	Exception
ØØ 
e
ØØ 
)
ØØ 
{
∞∞ 
return
±± 
new
±± 
OperationResult
±± *
(
±±* +
e
±±+ ,
)
±±, -
;
±±- .
}
≤≤ 
}
≥≥ 	
public
µµ 
OperationResult
µµ +
ActualizarDocumentosAEnviados
µµ <
(
µµ< =
long
µµ= A
[
µµA B
]
µµB C
idsDocumentos
µµD Q
)
µµQ R
{
∂∂ 	
try
∑∑ 
{
∏∏ 
List
ππ 
<
ππ 
string
ππ 
>
ππ 
lineasComandos
ππ +
=
ππ, -
new
ππ. 1
List
ππ2 6
<
ππ6 7
string
ππ7 =
>
ππ= >
(
ππ> ?
)
ππ? @
;
ππ@ A
foreach
∫∫ 
(
∫∫ 
var
∫∫ 
item
∫∫ !
in
∫∫" $
idsDocumentos
∫∫% 2
)
∫∫2 3
{
ªª 
lineasComandos
ºº "
.
ºº" #
Add
ºº# &
(
ºº& '
Environment
ºº' 2
.
ºº2 3
NewLine
ºº3 :
+
ºº; <
$str
ºº= k
+
ººl m
item
ººn r
+
ººs t
$str
ººu x
)
ººx y
;
ººy z
}
ΩΩ 
string
ææ 
comando
ææ 
=
ææ  
$str
ææ! #
;
ææ# $
foreach
øø 
(
øø 
var
øø 
item
øø !
in
øø" $
lineasComandos
øø% 3
)
øø3 4
{
¿¿ 
comando
¡¡ 
+=
¡¡ 
item
¡¡ #
;
¡¡# $
}
¬¬ 
_db
√√ 
.
√√ 
Database
√√ 
.
√√ 
ExecuteSqlCommand
√√ .
(
√√. /
comando
√√/ 6
)
√√6 7
;
√√7 8
return
ƒƒ 
new
ƒƒ 
OperationResult
ƒƒ *
(
ƒƒ* +!
OperationResultEnum
ƒƒ+ >
.
ƒƒ> ?
Success
ƒƒ? F
)
ƒƒF G
;
ƒƒG H
}
≈≈ 
catch
∆∆ 
(
∆∆ 
	Exception
∆∆ 
e
∆∆ 
)
∆∆ 
{
«« 
return
»» 
new
»» 
OperationResult
»» *
(
»»* +
e
»»+ ,
)
»», -
;
»»- .
}
…… 
}
   	
public
ÃÃ 
OperationResult
ÃÃ #
ActualizarEstadoEnvio
ÃÃ 4
(
ÃÃ4 5
Envio
ÃÃ5 :
envioAActualizar
ÃÃ; K
)
ÃÃK L
{
ÕÕ 	
try
ŒŒ 
{
œœ 
Envio
–– 
dbEnvio
–– 
=
–– 
_db
––  #
.
––# $
Envio
––$ )
.
––) *
Single
––* 0
(
––0 1
r
––1 2
=>
––3 5
r
––6 7
.
––7 8
id
––8 :
==
––; =
envioAActualizar
––> N
.
––N O
id
––O Q
)
––Q R
;
––R S
dbEnvio
—— 
.
—— 
estado
—— 
=
——  
envioAActualizar
——! 1
.
——1 2
estado
——2 8
;
——8 9
_db
““ 
.
““ 
Entry
““ 
(
““ 
dbEnvio
““ !
)
““! "
.
““" #
Property
““# +
(
““+ ,
x
““, -
=>
““. 0
x
““1 2
.
““2 3
estado
““3 9
)
““9 :
.
““: ;

IsModified
““; E
=
““F G
true
““H L
;
““L M
var
”” 
result
”” 
=
”” 
Save
”” !
(
””! "
)
””" #
;
””# $
result
‘‘ 
.
‘‘ 
data
‘‘ 
=
‘‘ 
envioAActualizar
‘‘ .
.
‘‘. /
id
‘‘/ 1
;
‘‘1 2
return
’’ 
result
’’ 
;
’’ 
}
÷÷ 
catch
◊◊ 
(
◊◊ 
	Exception
◊◊ 
e
◊◊ 
)
◊◊ 
{
ÿÿ 
return
ŸŸ 
new
ŸŸ 
OperationResult
ŸŸ *
(
ŸŸ* +
e
ŸŸ+ ,
)
ŸŸ, -
;
ŸŸ- .
}
⁄⁄ 
}
€€ 	
public
›› 
OperationResult
›› 4
&ActualizarEstadoObservacionTicketEnvio
›› E
(
››E F
Envio
››F K
envio
››L Q
)
››Q R
{
ﬁﬁ 	
try
ﬂﬂ 
{
‡‡ 
string
·· 
comando
·· 
=
··  
$str
··! >
+
··? @
envio
··A F
.
··F G
estado
··G M
+
··N O
$str
··P d
+
··e f
envio
··g l
.
··l m
observacion
··m x
.
··x y
Replace··y Ä
(··Ä Å
$str··Å Ñ
,··Ñ Ö
$str··Ü ä
)··ä ã
+··å ç
$str··é £
+··§ •
envio··¶ ´
.··´ ¨
numeroTicket··¨ ∏
+··π ∫
$str··ª  
+··À Ã
envio··Õ “
.··“ ”
id··” ’
+··÷ ◊
$str··ÿ €
;··€ ‹
_db
‚‚ 
.
‚‚ 
Database
‚‚ 
.
‚‚ 
ExecuteSqlCommand
‚‚ .
(
‚‚. /
comando
‚‚/ 6
)
‚‚6 7
;
‚‚7 8
return
„„ 
new
„„ 
OperationResult
„„ *
(
„„* +!
OperationResultEnum
„„+ >
.
„„> ?
Success
„„? F
)
„„F G
;
„„G H
}
‰‰ 
catch
ÂÂ 
(
ÂÂ 
	Exception
ÂÂ 
e
ÂÂ 
)
ÂÂ 
{
ÊÊ 
return
ÁÁ 
new
ÁÁ 
OperationResult
ÁÁ *
(
ÁÁ* +
e
ÁÁ+ ,
)
ÁÁ, -
;
ÁÁ- .
}
ËË 
}
ÈÈ 	
public
ÎÎ 
OperationResult
ÎÎ )
ActualizarDocumentoAEnviado
ÎÎ :
(
ÎÎ: ;
long
ÎÎ; ?
idDocumento
ÎÎ@ K
)
ÎÎK L
{
ÏÏ 	
try
ÌÌ 
{
ÓÓ 
	Documento
ÔÔ 
dbDocumento
ÔÔ %
=
ÔÔ& '
_db
ÔÔ( +
.
ÔÔ+ ,
	Documento
ÔÔ, 5
.
ÔÔ5 6
Single
ÔÔ6 <
(
ÔÔ< =
r
ÔÔ= >
=>
ÔÔ? A
r
ÔÔB C
.
ÔÔC D
id
ÔÔD F
==
ÔÔG I
idDocumento
ÔÔJ U
)
ÔÔU V
;
ÔÔV W
dbDocumento
 
.
 
enviado
 #
=
$ %
true
& *
;
* +
_db
ÒÒ 
.
ÒÒ 
Entry
ÒÒ 
(
ÒÒ 
dbDocumento
ÒÒ %
)
ÒÒ% &
.
ÒÒ& '
Property
ÒÒ' /
(
ÒÒ/ 0
x
ÒÒ0 1
=>
ÒÒ2 4
x
ÒÒ5 6
.
ÒÒ6 7
enviado
ÒÒ7 >
)
ÒÒ> ?
.
ÒÒ? @

IsModified
ÒÒ@ J
=
ÒÒK L
true
ÒÒM Q
;
ÒÒQ R
var
ÚÚ 
result
ÚÚ 
=
ÚÚ 
Save
ÚÚ !
(
ÚÚ! "
)
ÚÚ" #
;
ÚÚ# $
result
ÛÛ 
.
ÛÛ 
data
ÛÛ 
=
ÛÛ 
dbDocumento
ÛÛ )
.
ÛÛ) *
id
ÛÛ* ,
;
ÛÛ, -
return
ÙÙ 
result
ÙÙ 
;
ÙÙ 
}
ıı 
catch
ˆˆ 
(
ˆˆ 
	Exception
ˆˆ 
e
ˆˆ 
)
ˆˆ 
{
˜˜ 
return
¯¯ 
new
¯¯ 
OperationResult
¯¯ *
(
¯¯* +
e
¯¯+ ,
)
¯¯, -
;
¯¯- .
}
˘˘ 
}
˙˙ 	
public
¸¸ 
OperationResult
¸¸ /
!ActualizarEstadoYObservacionEnvio
¸¸ @
(
¸¸@ A
Envio
¸¸A F
envioAActualizar
¸¸G W
)
¸¸W X
{
˝˝ 	
try
˛˛ 
{
ˇˇ 
Envio
ÄÄ 
dbEnvio
ÄÄ 
=
ÄÄ 
_db
ÄÄ  #
.
ÄÄ# $
Envio
ÄÄ$ )
.
ÄÄ) *
Single
ÄÄ* 0
(
ÄÄ0 1
r
ÄÄ1 2
=>
ÄÄ3 5
r
ÄÄ6 7
.
ÄÄ7 8
id
ÄÄ8 :
==
ÄÄ; =
envioAActualizar
ÄÄ> N
.
ÄÄN O
id
ÄÄO Q
)
ÄÄQ R
;
ÄÄR S
dbEnvio
ÅÅ 
.
ÅÅ 
estado
ÅÅ 
=
ÅÅ  
envioAActualizar
ÅÅ! 1
.
ÅÅ1 2
estado
ÅÅ2 8
;
ÅÅ8 9
dbEnvio
ÇÇ 
.
ÇÇ 
observacion
ÇÇ #
=
ÇÇ$ %
envioAActualizar
ÇÇ& 6
.
ÇÇ6 7
observacion
ÇÇ7 B
;
ÇÇB C
_db
ÉÉ 
.
ÉÉ 
Entry
ÉÉ 
(
ÉÉ 
dbEnvio
ÉÉ !
)
ÉÉ! "
.
ÉÉ" #
Property
ÉÉ# +
(
ÉÉ+ ,
x
ÉÉ, -
=>
ÉÉ. 0
x
ÉÉ1 2
.
ÉÉ2 3
estado
ÉÉ3 9
)
ÉÉ9 :
.
ÉÉ: ;

IsModified
ÉÉ; E
=
ÉÉF G
true
ÉÉH L
;
ÉÉL M
_db
ÑÑ 
.
ÑÑ 
Entry
ÑÑ 
(
ÑÑ 
dbEnvio
ÑÑ !
)
ÑÑ! "
.
ÑÑ" #
Property
ÑÑ# +
(
ÑÑ+ ,
x
ÑÑ, -
=>
ÑÑ. 0
x
ÑÑ1 2
.
ÑÑ2 3
observacion
ÑÑ3 >
)
ÑÑ> ?
.
ÑÑ? @

IsModified
ÑÑ@ J
=
ÑÑK L
true
ÑÑM Q
;
ÑÑQ R
var
ÖÖ 
result
ÖÖ 
=
ÖÖ 
Save
ÖÖ !
(
ÖÖ! "
)
ÖÖ" #
;
ÖÖ# $
result
ÜÜ 
.
ÜÜ 
data
ÜÜ 
=
ÜÜ 
envioAActualizar
ÜÜ .
.
ÜÜ. /
id
ÜÜ/ 1
;
ÜÜ1 2
return
áá 
result
áá 
;
áá 
}
àà 
catch
ââ 
(
ââ 
	Exception
ââ 
e
ââ 
)
ââ 
{
ää 
return
ãã 
new
ãã 
OperationResult
ãã *
(
ãã* +
e
ãã+ ,
)
ãã, -
;
ãã- .
}
åå 
}
çç 	
public
ìì 
OperationResult
ìì !
CrearEnvioDocumento
ìì 2
(
ìì2 3
EnvioDocumento
ìì3 A
envioDocumento
ììB P
)
ììP Q
{
îî 	
try
ïï 
{
ññ 
_db
óó 
.
óó 
EnvioDocumento
óó "
.
óó" #
Add
óó# &
(
óó& '
envioDocumento
óó' 5
)
óó5 6
;
óó6 7
var
òò 
result
òò 
=
òò 
Save
òò !
(
òò! "
)
òò" #
;
òò# $
result
ôô 
.
ôô 
data
ôô 
=
ôô 
envioDocumento
ôô ,
.
ôô, -
id
ôô- /
;
ôô/ 0
return
öö 
result
öö 
;
öö 
}
õõ 
catch
úú 
(
úú 
	Exception
úú 
e
úú 
)
úú 
{
ùù 
throw
ûû 
new
ûû 
DatosException
ûû (
(
ûû( )
$str
ûû) X
,
ûûX Y
e
ûûZ [
)
ûû[ \
;
ûû\ ]
}
üü 
}
†† 	
public
¢¢ 
OperationResult
¢¢ '
CrearEnvioDocumentoMasivo
¢¢ 8
(
¢¢8 9
long
¢¢9 =
idEnvio
¢¢> E
,
¢¢E F
long
¢¢G K
[
¢¢K L
]
¢¢L M
idsDocumentos
¢¢N [
)
¢¢[ \
{
££ 	
try
§§ 
{
•• 
List
ßß 
<
ßß 
string
ßß 
>
ßß 
comandosSQL
ßß (
=
ßß) *
new
ßß+ .
List
ßß/ 3
<
ßß3 4
string
ßß4 :
>
ßß: ;
(
ßß; <
)
ßß< =
;
ßß= >
comandosSQL
®® 
.
®® 
Add
®® 
(
®®  
$str
®®  :
)
®®: ;
;
®®; <
List
©© 
<
©© 
SqlParameter
©© !
>
©©! "
parametrosSql
©©# 0
=
©©1 2
new
©©3 6
List
©©7 ;
<
©©; <
SqlParameter
©©< H
>
©©H I
(
©©I J
)
©©J K
;
©©K L
int
™™ 
index
™™ 
=
™™ 
$num
™™ 
;
™™ 
foreach
´´ 
(
´´ 
var
´´ 
idDocumento
´´ (
in
´´) +
idsDocumentos
´´, 9
)
´´9 :
{
¨¨ 
var
≠≠ 
comandoActual
≠≠ %
=
≠≠& '
(
≠≠( )
Environment
≠≠) 4
.
≠≠4 5
NewLine
≠≠5 <
+
≠≠= >
$str
≠≠? q
+
≠≠r s
index
≠≠t y
+
≠≠z {
$str≠≠| Ä
+≠≠Å Ç
idEnvio≠≠É ä
+≠≠ã å
$str≠≠ç ë
)≠≠ë í
;≠≠í ì
var
ÆÆ 
parametroActual
ÆÆ '
=
ÆÆ( )
new
ÆÆ* -
SqlParameter
ÆÆ. :
(
ÆÆ: ;
$str
ÆÆ; I
+
ÆÆJ K
index
ÆÆL Q
,
ÆÆQ R
System
ÆÆS Y
.
ÆÆY Z
Data
ÆÆZ ^
.
ÆÆ^ _
	SqlDbType
ÆÆ_ h
.
ÆÆh i
Int
ÆÆi l
)
ÆÆl m
;
ÆÆm n
parametroActual
ØØ #
.
ØØ# $
Value
ØØ$ )
=
ØØ* +
idDocumento
ØØ, 7
;
ØØ7 8
comandosSQL
∞∞ 
.
∞∞  
Add
∞∞  #
(
∞∞# $
comandoActual
∞∞$ 1
)
∞∞1 2
;
∞∞2 3
parametrosSql
±± !
.
±±! "
Add
±±" %
(
±±% &
parametroActual
±±& 5
)
±±5 6
;
±±6 7
index
≤≤ 
++
≤≤ 
;
≤≤ 
}
≥≥ 
string
¥¥ 
comandoAEjecutar
¥¥ '
=
¥¥( )
$str
¥¥* ,
;
¥¥, -
foreach
µµ 
(
µµ 
var
µµ 
item
µµ !
in
µµ" $
comandosSQL
µµ% 0
)
µµ0 1
{
∂∂ 
comandoAEjecutar
∑∑ $
+=
∑∑% '
item
∑∑( ,
;
∑∑, -
}
∏∏ 
var
ππ 
	resultado
ππ 
=
ππ 
_db
ππ  #
.
ππ# $
Database
ππ$ ,
.
ππ, -
ExecuteSqlCommand
ππ- >
(
ππ> ?
comandoAEjecutar
ππ? O
,
ππO P
parametrosSql
ππQ ^
.
ππ^ _
ToArray
ππ_ f
(
ππf g
)
ππg h
)
ππh i
;
ππi j
var
∫∫ 
resultadoDetails
∫∫ $
=
∫∫% &
new
∫∫' *
OperationResult
∫∫+ :
(
∫∫: ;!
OperationResultEnum
∫∫; N
.
∫∫N O
Success
∫∫O V
)
∫∫V W
;
∫∫W X
return
ªª 
resultadoDetails
ªª '
;
ªª' (
}
ºº 
catch
ΩΩ 
(
ΩΩ 
	Exception
ΩΩ 
e
ΩΩ 
)
ΩΩ 
{
ææ 
throw
øø 
new
øø 
DatosException
øø (
(
øø( )
$str
øø) I
,
øøI J
e
øøK L
)
øøL M
;
øøM N
}
¿¿ 
}
¡¡ 	
public
«« 
OperationResult
«« 
CrearBinario
«« +
(
««+ ,
Binario
««, 3
archivoBinario
««4 B
)
««B C
{
»» 	
try
…… 
{
   
_db
ÀÀ 
.
ÀÀ 
Binario
ÀÀ 
.
ÀÀ 
Add
ÀÀ 
(
ÀÀ  
archivoBinario
ÀÀ  .
)
ÀÀ. /
;
ÀÀ/ 0
var
ÃÃ 
result
ÃÃ 
=
ÃÃ 
Save
ÃÃ !
(
ÃÃ! "
)
ÃÃ" #
;
ÃÃ# $
result
ÕÕ 
.
ÕÕ 
data
ÕÕ 
=
ÕÕ 
archivoBinario
ÕÕ ,
.
ÕÕ, -
id
ÕÕ- /
;
ÕÕ/ 0
return
ŒŒ 
result
ŒŒ 
;
ŒŒ 
}
œœ 
catch
–– 
(
–– 
	Exception
–– 
e
–– 
)
–– 
{
—— 
throw
““ 
e
““ 
;
““ 
}
”” 
}
‘‘ 	
public
÷÷ 
OperationResult
÷÷ 
ActualizarBinario
÷÷ 0
(
÷÷0 1
Binario
÷÷1 8
binario
÷÷9 @
)
÷÷@ A
{
◊◊ 	
try
ÿÿ 
{
ŸŸ 
Binario
⁄⁄ 
	dbBinario
⁄⁄ !
=
⁄⁄" #
_db
⁄⁄$ '
.
⁄⁄' (
Binario
⁄⁄( /
.
⁄⁄/ 0
Single
⁄⁄0 6
(
⁄⁄6 7
c
⁄⁄7 8
=>
⁄⁄9 ;
c
⁄⁄< =
.
⁄⁄= >
id
⁄⁄> @
==
⁄⁄A C
binario
⁄⁄D K
.
⁄⁄K L
id
⁄⁄L N
)
⁄⁄N O
;
⁄⁄O P
_db
€€ 
.
€€ 
Entry
€€ 
(
€€ 
	dbBinario
€€ #
)
€€# $
.
€€$ %
CurrentValues
€€% 2
.
€€2 3
	SetValues
€€3 <
(
€€< =
binario
€€= D
)
€€D E
;
€€E F
var
‹‹ 
result
‹‹ 
=
‹‹ 
Save
‹‹ !
(
‹‹! "
)
‹‹" #
;
‹‹# $
result
›› 
.
›› 
data
›› 
=
›› 
binario
›› %
.
››% &
id
››& (
;
››( )
return
ﬁﬁ 
result
ﬁﬁ 
;
ﬁﬁ 
}
ﬂﬂ 
catch
‡‡ 
(
‡‡ 
	Exception
‡‡ 
e
‡‡ 
)
‡‡ 
{
·· 
throw
‚‚ 
e
‚‚ 
;
‚‚ 
}
„„ 
}
‰‰ 	
public
ÊÊ 
byte
ÊÊ 
[
ÊÊ 
]
ÊÊ 
ObtenerBinario
ÊÊ $
(
ÊÊ$ %
long
ÊÊ% )
	idBinario
ÊÊ* 3
)
ÊÊ3 4
{
ÁÁ 	
try
ËË 
{
ÈÈ 
return
ÍÍ 
_db
ÍÍ 
.
ÍÍ 
Binario
ÍÍ "
.
ÍÍ" #
SingleOrDefault
ÍÍ# 2
(
ÍÍ2 3
b
ÍÍ3 4
=>
ÍÍ5 7
b
ÍÍ8 9
.
ÍÍ9 :
id
ÍÍ: <
==
ÍÍ= ?
	idBinario
ÍÍ@ I
)
ÍÍI J
.
ÍÍJ K
archivoBinario
ÍÍK Y
;
ÍÍY Z
}
ÎÎ 
catch
ÏÏ 
(
ÏÏ 
	Exception
ÏÏ 
e
ÏÏ 
)
ÏÏ 
{
ÌÌ 
throw
ÓÓ 
e
ÓÓ 
;
ÓÓ 
}
ÔÔ 
}
 	
public
ˆˆ 
IEnumerable
ˆˆ 
<
ˆˆ 
	Documento
ˆˆ $
>
ˆˆ$ %
ObtenerDocumentos
ˆˆ& 7
(
ˆˆ7 8
)
ˆˆ8 9
{
˜˜ 	
try
¯¯ 
{
˘˘ 
return
˙˙ 
_db
˙˙ 
.
˙˙ 
	Documento
˙˙ $
.
˙˙$ %
Include
˙˙% ,
(
˙˙, -
d
˙˙- .
=>
˙˙/ 1
d
˙˙2 3
.
˙˙3 4
EnvioDocumento
˙˙4 B
)
˙˙B C
;
˙˙C D
}
˚˚ 
catch
¸¸ 
(
¸¸ 
	Exception
¸¸ 
e
¸¸ 
)
¸¸ 
{
˝˝ 
throw
˛˛ 
e
˛˛ 
;
˛˛ 
}
ˇˇ 
}
ÄÄ 	
public
ÇÇ 
IEnumerable
ÇÇ 
<
ÇÇ 
	Documento
ÇÇ $
>
ÇÇ$ %*
ObtenerDocumentosEntreFechas
ÇÇ& B
(
ÇÇB C
DateTime
ÇÇC K

fechaDesde
ÇÇL V
,
ÇÇV W
DateTime
ÇÇX `

fechaHasta
ÇÇa k
)
ÇÇk l
{
ÉÉ 	
try
ÑÑ 
{
ÖÖ 
return
ÜÜ 
_db
ÜÜ 
.
ÜÜ 
	Documento
ÜÜ $
.
ÜÜ$ %
Include
ÜÜ% ,
(
ÜÜ, -
d
ÜÜ- .
=>
ÜÜ/ 1
d
ÜÜ2 3
.
ÜÜ3 4
EnvioDocumento
ÜÜ4 B
)
ÜÜB C
.
ÜÜC D
Where
ÜÜD I
(
ÜÜI J
d
ÜÜJ K
=>
ÜÜL N
d
ÜÜO P
.
ÜÜP Q
fechaEmision
ÜÜQ ]
>=
ÜÜ^ `

fechaDesde
ÜÜa k
&&
ÜÜl n
d
ÜÜo p
.
ÜÜp q
fechaEmision
ÜÜq }
<=ÜÜ~ Ä

fechaHastaÜÜÅ ã
)ÜÜã å
;ÜÜå ç
}
áá 
catch
àà 
(
àà 
	Exception
àà 
e
àà 
)
àà 
{
ââ 
throw
ää 
e
ää 
;
ää 
}
ãã 
}
åå 	
public
éé 
IEnumerable
éé 
<
éé 
	Documento
éé $
>
éé$ %
ObtenerDocumentos
éé& 7
(
éé7 8
List
éé8 <
<
éé< =
long
éé= A
>
ééA B
idDocumentos
ééC O
)
ééO P
{
èè 	
try
êê 
{
ëë 
return
ìì 
_db
ìì 
.
ìì 
	Documento
ìì $
.
ìì$ %
Include
ìì% ,
(
ìì, -
d
ìì- .
=>
ìì/ 1
d
ìì2 3
.
ìì3 4
EnvioDocumento
ìì4 B
)
ììB C
.
îî 
Include
îî 
(
îî 
d
îî 
=>
îî !
d
îî" #
.
îî# $
EnvioDocumento
îî$ 2
.
îî2 3
Select
îî3 9
(
îî9 :
ed
îî: <
=>
îî= ?
ed
îî@ B
.
îîB C
Envio
îîC H
)
îîH I
)
îîI J
.
ïï 
Where
ïï 
(
ïï 
d
ïï 
=>
ïï 
idDocumentos
ïï  ,
.
ïï, -
Contains
ïï- 5
(
ïï5 6
d
ïï6 7
.
ïï7 8
id
ïï8 :
)
ïï: ;
)
ïï; <
;
ïï< =
}
ññ 
catch
óó 
(
óó 
	Exception
óó 
e
óó 
)
óó 
{
òò 
throw
ôô 
e
ôô 
;
ôô 
}
öö 
}
õõ 	
public
ùù 
	Documento
ùù 8
*ObtenerDocumentoElectronicoIncluidoBinario
ùù C
(
ùùC D
long
ùùD H
idDocumento
ùùI T
)
ùùT U
{
ûû 	
try
üü 
{
†† 
return
°° 
_db
°° 
.
°° 
	Documento
°° $
.
°°$ %
Include
°°% ,
(
°°, -
d
°°- .
=>
°°/ 1
d
°°2 3
.
°°3 4
Binario
°°4 ;
)
°°; <
.
°°< =
SingleOrDefault
°°= L
(
°°L M
dm
°°M O
=>
°°P R
dm
°°S U
.
°°U V
id
°°V X
==
°°Y [
idDocumento
°°\ g
)
°°g h
;
°°h i
}
¢¢ 
catch
££ 
(
££ 
	Exception
££ 
e
££ 
)
££ 
{
§§ 
throw
•• 
e
•• 
;
•• 
}
¶¶ 
}
ßß 	
public
©© 
	Documento
©© )
ObtenerDocumentoElectronico
©© 4
(
©©4 5
long
©©5 9
idDocumento
©©: E
)
©©E F
{
™™ 	
try
´´ 
{
¨¨ 
return
≠≠ 
_db
≠≠ 
.
≠≠ 
	Documento
≠≠ $
.
≠≠$ %
SingleOrDefault
≠≠% 4
(
≠≠4 5
dm
≠≠5 7
=>
≠≠8 :
dm
≠≠; =
.
≠≠= >
id
≠≠> @
==
≠≠A C
idDocumento
≠≠D O
)
≠≠O P
;
≠≠P Q
}
ÆÆ 
catch
ØØ 
(
ØØ 
	Exception
ØØ 
e
ØØ 
)
ØØ 
{
∞∞ 
throw
±± 
e
±± 
;
±± 
}
≤≤ 
}
≥≥ 	
public
µµ 
int
µµ "
ObtenerIdentificador
µµ '
(
µµ' (
DateTime
µµ( 0
fechaConsulta
µµ1 >
,
µµ> ?
string
µµ@ F
	tipoEnvio
µµG P
)
µµP Q
{
∂∂ 	
try
∑∑ 
{
∏∏ 
return
ππ 
_db
ππ 
.
ππ 
Envio
ππ  
.
ππ  !
Where
ππ! &
(
ππ& '
dm
ππ' )
=>
ππ* ,
dm
ππ- /
.
ππ/ 0

fechaEnvio
ππ0 :
.
ππ: ;
Day
ππ; >
==
ππ? A
fechaConsulta
ππB O
.
ππO P
Day
ππP S
&&
ππT V
dm
ππW Y
.
ππY Z

fechaEnvio
ππZ d
.
ππd e
Month
ππe j
==
ππk m
fechaConsulta
ππn {
.
ππ{ |
Monthππ| Å
&&ππÇ Ñ
dmππÖ á
.ππá à

fechaEnvioππà í
.ππí ì
Yearππì ó
==ππò ö
fechaConsultaππõ ®
.ππ® ©
Yearππ© ≠
&&ππÆ ∞
dmππ± ≥
.ππ≥ ¥
	tipoEnvioππ¥ Ω
==ππæ ¿
	tipoEnvioππ¡  
)ππ  À
.ππÀ Ã
CountππÃ —
(ππ— “
)ππ“ ”
;ππ” ‘
}
∫∫ 
catch
ªª 
(
ªª 
	Exception
ªª 
e
ªª 
)
ªª 
{
ºº 
throw
ΩΩ 
e
ΩΩ 
;
ΩΩ 
}
ææ 
}
øø 	
public
∆∆ 
IEnumerable
∆∆ 
<
∆∆ 
long
∆∆ 
>
∆∆  .
 ObtenerIdDocumentosAEnviarPorDia
∆∆! A
(
∆∆A B
string
∆∆B H#
codigoTipoComprobante
∆∆I ^
)
∆∆^ _
{
«« 	
try
»» 
{
…… 
DateTime
   
fechaReferencia
   (
=
  ) *
_db
  + .
.
  . /
	Documento
  / 8
.
  8 9
Where
  9 >
(
  > ?
d
  ? @
=>
  A C
d
  D E
.
  E F#
codigoTipoComprobante
  F [
==
  \ ^#
codigoTipoComprobante
  _ t
&&
  u w
!
  x y
d
  y z
.
  z {
EnvioDocumento  { â
.  â ä
Any  ä ç
(  ç é
)  é è
)  è ê
.  ê ë
First  ë ñ
(  ñ ó
)  ó ò
.  ò ô
fechaEmision  ô •
;  • ¶
DateTime
ÀÀ #
fechaReferenciaMinimo
ÀÀ .
=
ÀÀ/ 0
fechaReferencia
ÀÀ1 @
.
ÀÀ@ A
Date
ÀÀA E
;
ÀÀE F
DateTime
ÃÃ #
fechaReferenciaMaximo
ÃÃ .
=
ÃÃ/ 0
fechaReferencia
ÃÃ1 @
.
ÃÃ@ A
Date
ÃÃA E
.
ÃÃE F
AddDays
ÃÃF M
(
ÃÃM N
$num
ÃÃN O
)
ÃÃO P
.
ÃÃP Q
AddMilliseconds
ÃÃQ `
(
ÃÃ` a
-
ÃÃa b
$num
ÃÃb c
)
ÃÃc d
;
ÃÃd e
return
ÕÕ 
_db
ÕÕ 
.
ÕÕ 
	Documento
ÕÕ $
.
ÕÕ$ %
Where
ÕÕ% *
(
ÕÕ* +
d
ÕÕ+ ,
=>
ÕÕ- /
d
ÕÕ0 1
.
ÕÕ1 2#
codigoTipoComprobante
ÕÕ2 G
==
ÕÕH J#
codigoTipoComprobante
ÕÕK `
&&
ÕÕa c
!
ÕÕd e
d
ÕÕe f
.
ÕÕf g
EnvioDocumento
ÕÕg u
.
ÕÕu v
Any
ÕÕv y
(
ÕÕy z
)
ÕÕz {
&&
ÕÕ| ~$
fechaReferenciaMinimoÕÕ î
<=ÕÕï ó
dÕÕò ô
.ÕÕô ö
fechaEmisionÕÕö ¶
&&ÕÕß ©
dÕÕ™ ´
.ÕÕ´ ¨
fechaEmisionÕÕ¨ ∏
<=ÕÕπ ª%
fechaReferenciaMaximoÕÕº —
)ÕÕ— “
.ÕÕ“ ”
SelectÕÕ” Ÿ
(ÕÕŸ ⁄
dÕÕ⁄ €
=>ÕÕ‹ ﬁ
dÕÕﬂ ‡
.ÕÕ‡ ·
idÕÕ· „
)ÕÕ„ ‰
;ÕÕ‰ Â
}
ŒŒ 
catch
œœ 
(
œœ 
	Exception
œœ 
e
œœ 
)
œœ 
{
–– 
throw
—— 
e
—— 
;
—— 
}
““ 
}
”” 	
public
⁄⁄ 
IEnumerable
⁄⁄ 
<
⁄⁄ 
	Documento
⁄⁄ $
>
⁄⁄$ %;
-ObtenerDocumentosIncluidoBinarioAEnviarPorDia
⁄⁄& S
(
⁄⁄S T
string
⁄⁄T Z#
codigoTipoComprobante
⁄⁄[ p
)
⁄⁄p q
{
€€ 	
try
‹‹ 
{
›› 
IEnumerable
ﬁﬁ 
<
ﬁﬁ 
	Documento
ﬁﬁ %
>
ﬁﬁ% &
	resultado
ﬁﬁ' 0
=
ﬁﬁ1 2
new
ﬁﬁ3 6
List
ﬁﬁ7 ;
<
ﬁﬁ; <
	Documento
ﬁﬁ< E
>
ﬁﬁE F
(
ﬁﬁF G
)
ﬁﬁG H
;
ﬁﬁH I
var
ﬂﬂ &
primerDocumentoNoEnviado
ﬂﬂ ,
=
ﬂﬂ- .
_db
ﬂﬂ/ 2
.
ﬂﬂ2 3
	Documento
ﬂﬂ3 <
.
ﬂﬂ< =
FirstOrDefault
ﬂﬂ= K
(
ﬂﬂK L
d
ﬂﬂL M
=>
ﬂﬂN P
!
ﬂﬂQ R
d
ﬂﬂR S
.
ﬂﬂS T
enviado
ﬂﬂT [
&&
ﬂﬂ\ ^
d
ﬂﬂ_ `
.
ﬂﬂ` a#
codigoTipoComprobante
ﬂﬂa v
==
ﬂﬂw y$
codigoTipoComprobanteﬂﬂz è
)ﬂﬂè ê
;ﬂﬂê ë
if
‡‡ 
(
‡‡ &
primerDocumentoNoEnviado
‡‡ ,
==
‡‡- /
null
‡‡0 4
)
‡‡4 5
{
·· 
return
‚‚ 
	resultado
‚‚ $
;
‚‚$ %
}
„„ 
DateTime
ÂÂ 
fechaReferencia
ÂÂ (
=
ÂÂ) *&
primerDocumentoNoEnviado
ÂÂ+ C
.
ÂÂC D
fechaEmision
ÂÂD P
;
ÂÂP Q
DateTime
ÊÊ #
fechaReferenciaMinimo
ÊÊ .
=
ÊÊ/ 0
fechaReferencia
ÊÊ1 @
.
ÊÊ@ A
Date
ÊÊA E
;
ÊÊE F
DateTime
ÁÁ #
fechaReferenciaMaximo
ÁÁ .
=
ÁÁ/ 0
fechaReferencia
ÁÁ1 @
.
ÁÁ@ A
Date
ÁÁA E
.
ÁÁE F
AddDays
ÁÁF M
(
ÁÁM N
$num
ÁÁN O
)
ÁÁO P
.
ÁÁP Q
AddMilliseconds
ÁÁQ `
(
ÁÁ` a
-
ÁÁa b
$num
ÁÁb c
)
ÁÁc d
;
ÁÁd e
	resultado
ËË 
=
ËË 
_db
ËË 
.
ËË  
	Documento
ËË  )
.
ËË) *
Include
ËË* 1
(
ËË1 2
d
ËË2 3
=>
ËË4 6
d
ËË7 8
.
ËË8 9
Binario
ËË9 @
)
ËË@ A
.
ËËA B
Where
ËËB G
(
ËËG H
d
ËËH I
=>
ËËJ L#
fechaReferenciaMinimo
ËËM b
<=
ËËc e
d
ËËf g
.
ËËg h
fechaEmision
ËËh t
&&
ËËu w
d
ËËx y
.
ËËy z
fechaEmisionËËz Ü
<=ËËá â%
fechaReferenciaMaximoËËä ü
&&ËË† ¢
dËË£ §
.ËË§ •%
codigoTipoComprobanteËË• ∫
==ËËª Ω%
codigoTipoComprobanteËËæ ”
&&ËË‘ ÷
!ËË◊ ÿ
dËËÿ Ÿ
.ËËŸ ⁄
enviadoËË⁄ ·
)ËË· ‚
;ËË‚ „
return
ÈÈ 
	resultado
ÈÈ  
;
ÈÈ  !
}
ÍÍ 
catch
ÎÎ 
(
ÎÎ 
	Exception
ÎÎ 
e
ÎÎ 
)
ÎÎ 
{
ÏÏ 
throw
ÌÌ 
new
ÌÌ 
DatosException
ÌÌ (
(
ÌÌ( )
$str
ÌÌ) `
,
ÌÌ` a
e
ÌÌb c
)
ÌÌc d
;
ÌÌd e
}
ÓÓ 
}
ÔÔ 	
public
˜˜ 
IEnumerable
˜˜ 
<
˜˜ 
	Documento
˜˜ $
>
˜˜$ %,
ObtenerDocumentosAEnviarPorDia
˜˜& D
(
˜˜D E
string
˜˜E K#
codigoTipoComprobante
˜˜L a
,
˜˜a b
int
˜˜c f
estado
˜˜g m
)
˜˜m n
{
¯¯ 	
try
˘˘ 
{
˙˙ 
DateTime
˚˚ 
fechaReferencia
˚˚ (
=
˚˚) *
_db
˚˚+ .
.
˚˚. /
	Documento
˚˚/ 8
.
˚˚8 9
Where
˚˚9 >
(
˚˚> ?
d
˚˚? @
=>
˚˚A C
d
˚˚D E
.
˚˚E F#
codigoTipoComprobante
˚˚F [
==
˚˚\ ^#
codigoTipoComprobante
˚˚_ t
&&
˚˚u w
!
˚˚x y
d
˚˚y z
.
˚˚z {
EnvioDocumento˚˚{ â
.˚˚â ä
Any˚˚ä ç
(˚˚ç é
)˚˚é è
&&˚˚ê í
d˚˚ì î
.˚˚î ï
estado˚˚ï õ
==˚˚ú û
estado˚˚ü •
)˚˚• ¶
.˚˚¶ ß
First˚˚ß ¨
(˚˚¨ ≠
)˚˚≠ Æ
.˚˚Æ Ø
fechaEmision˚˚Ø ª
;˚˚ª º
DateTime
¸¸ #
fechaReferenciaMinimo
¸¸ .
=
¸¸/ 0
fechaReferencia
¸¸1 @
.
¸¸@ A
Date
¸¸A E
;
¸¸E F
DateTime
˝˝ #
fechaReferenciaMaximo
˝˝ .
=
˝˝/ 0
fechaReferencia
˝˝1 @
.
˝˝@ A
Date
˝˝A E
.
˝˝E F
AddDays
˝˝F M
(
˝˝M N
$num
˝˝N O
)
˝˝O P
.
˝˝P Q
AddMilliseconds
˝˝Q `
(
˝˝` a
-
˝˝a b
$num
˝˝b c
)
˝˝c d
;
˝˝d e
return
˛˛ 
_db
˛˛ 
.
˛˛ 
	Documento
˛˛ $
.
˛˛$ %
Where
˛˛% *
(
˛˛* +
d
˛˛+ ,
=>
˛˛- /
d
˛˛0 1
.
˛˛1 2#
codigoTipoComprobante
˛˛2 G
==
˛˛H J#
codigoTipoComprobante
˛˛K `
&&
˛˛a c
!
˛˛d e
d
˛˛e f
.
˛˛f g
EnvioDocumento
˛˛g u
.
˛˛u v
Any
˛˛v y
(
˛˛y z
)
˛˛z {
&&
˛˛| ~$
fechaReferenciaMinimo˛˛ î
<=˛˛ï ó
d˛˛ò ô
.˛˛ô ö
fechaEmision˛˛ö ¶
&&˛˛ß ©
d˛˛™ ´
.˛˛´ ¨
fechaEmision˛˛¨ ∏
<=˛˛π ª%
fechaReferenciaMaximo˛˛º —
&&˛˛“ ‘
d˛˛’ ÷
.˛˛÷ ◊
estado˛˛◊ ›
==˛˛ﬁ ‡
estado˛˛· Á
)˛˛Á Ë
;˛˛Ë È
}
ˇˇ 
catch
ÄÄ 
(
ÄÄ 
	Exception
ÄÄ 
e
ÄÄ 
)
ÄÄ 
{
ÅÅ 
throw
ÇÇ 
e
ÇÇ 
;
ÇÇ 
}
ÉÉ 
}
ÑÑ 	
public
ãã 
IEnumerable
ãã 
<
ãã 
long
ãã 
>
ãã  (
ObtenerIdDocumentosAEnviar
ãã! ;
(
ãã; <
string
ãã< B#
codigoTipoComprobante
ããC X
)
ããX Y
{
åå 	
try
çç 
{
éé 
return
èè 
_db
èè 
.
èè 
	Documento
èè $
.
èè$ %
Where
èè% *
(
èè* +
d
èè+ ,
=>
èè- /
d
èè0 1
.
èè1 2#
codigoTipoComprobante
èè2 G
==
èèH J#
codigoTipoComprobante
èèK `
&&
èèa c
!
èèd e
d
èèe f
.
èèf g
EnvioDocumento
èèg u
.
èèu v
Any
èèv y
(
èèy z
)
èèz {
)
èè{ |
.
èè| }
Selectèè} É
(èèÉ Ñ
dèèÑ Ö
=>èèÜ à
dèèâ ä
.èèä ã
idèèã ç
)èèç é
;èèé è
}
êê 
catch
ëë 
(
ëë 
	Exception
ëë 
e
ëë 
)
ëë 
{
íí 
throw
ìì 
e
ìì 
;
ìì 
}
îî 
}
ïï 	
public
úú 
IEnumerable
úú 
<
úú 
	Documento
úú $
>
úú$ %&
ObtenerDocumentosAEnviar
úú& >
(
úú> ?
string
úú? E#
codigoTipoComprobante
úúF [
)
úú[ \
{
ùù 	
try
ûû 
{
üü 
return
†† 
_db
†† 
.
†† 
	Documento
†† $
.
††$ %
Where
††% *
(
††* +
d
††+ ,
=>
††- /
d
††0 1
.
††1 2#
codigoTipoComprobante
††2 G
==
††H J#
codigoTipoComprobante
††K `
&&
††a c
!
††d e
d
††e f
.
††f g
EnvioDocumento
††g u
.
††u v
Any
††v y
(
††y z
)
††z {
)
††{ |
;
††| }
}
°° 
catch
¢¢ 
(
¢¢ 
	Exception
¢¢ 
e
¢¢ 
)
¢¢ 
{
££ 
throw
§§ 
e
§§ 
;
§§ 
}
•• 
}
¶¶ 	
public
≠≠ 
IEnumerable
≠≠ 
<
≠≠ 
	Documento
≠≠ $
>
≠≠$ %5
'ObtenerDocumentosIncluidoBinarioAEnviar
≠≠& M
(
≠≠M N
string
≠≠N T#
codigoTipoComprobante
≠≠U j
,
≠≠j k
int
≠≠l o
estadoDocumento
≠≠p 
)≠≠ Ä
{
ÆÆ 	
try
ØØ 
{
∞∞ 
return
±± 
_db
±± 
.
±± 
	Documento
±± $
.
±±$ %
Include
±±% ,
(
±±, -
d
±±- .
=>
±±/ 1
d
±±2 3
.
±±3 4
Binario
±±4 ;
)
±±; <
.
±±< =
Where
±±= B
(
±±B C
d
±±C D
=>
±±E G
d
±±H I
.
±±I J#
codigoTipoComprobante
±±J _
==
±±` b#
codigoTipoComprobante
±±c x
&&
±±y {
d
±±| }
.
±±} ~
estado±±~ Ñ
==±±Ö á
estadoDocumento±±à ó
&&±±ò ö
!±±õ ú
d±±ú ù
.±±ù û
EnvioDocumento±±û ¨
.±±¨ ≠
Any±±≠ ∞
(±±∞ ±
)±±± ≤
)±±≤ ≥
;±±≥ ¥
}
≤≤ 
catch
≥≥ 
(
≥≥ 
	Exception
≥≥ 
e
≥≥ 
)
≥≥ 
{
¥¥ 
throw
µµ 
e
µµ 
;
µµ 
}
∂∂ 
}
∑∑ 	
public
ææ 
IEnumerable
ææ 
<
ææ 
	Documento
ææ $
>
ææ$ %5
'ObtenerDocumentosIncluidoBinarioAEnviar
ææ& M
(
ææM N
string
ææN T#
codigoTipoComprobante
ææU j
)
ææj k
{
øø 	
try
¿¿ 
{
¡¡ 
return
¬¬ 
_db
¬¬ 
.
¬¬ 
	Documento
¬¬ $
.
¬¬$ %
Include
¬¬% ,
(
¬¬, -
d
¬¬- .
=>
¬¬/ 1
d
¬¬2 3
.
¬¬3 4
Binario
¬¬4 ;
)
¬¬; <
.
¬¬< =
Where
¬¬= B
(
¬¬B C
d
¬¬C D
=>
¬¬E G
d
¬¬H I
.
¬¬I J#
codigoTipoComprobante
¬¬J _
==
¬¬` b#
codigoTipoComprobante
¬¬c x
&&
¬¬y {
!
¬¬| }
d
¬¬} ~
.
¬¬~ 
EnvioDocumento¬¬ ç
.¬¬ç é
Any¬¬é ë
(¬¬ë í
)¬¬í ì
)¬¬ì î
;¬¬î ï
}
√√ 
catch
ƒƒ 
(
ƒƒ 
	Exception
ƒƒ 
e
ƒƒ 
)
ƒƒ 
{
≈≈ 
throw
∆∆ 
e
∆∆ 
;
∆∆ 
}
«« 
}
»» 	
public
ÕÕ 
IEnumerable
ÕÕ 
<
ÕÕ 
Envio
ÕÕ  
>
ÕÕ  !
ObtenerEnvios
ÕÕ" /
(
ÕÕ/ 0
)
ÕÕ0 1
{
ŒŒ 	
try
œœ 
{
–– 
return
—— 
_db
—— 
.
—— 
Envio
——  
.
——  !
Include
——! (
(
——( )
e
——) *
=>
——+ -
e
——. /
.
——/ 0
EnvioDocumento
——0 >
)
——> ?
;
——? @
}
““ 
catch
”” 
(
”” 
	Exception
”” 
e
”” 
)
”” 
{
‘‘ 
throw
’’ 
e
’’ 
;
’’ 
}
÷÷ 
}
◊◊ 	
public
ŸŸ 
Envio
ŸŸ 
ObtenerEnvio
ŸŸ !
(
ŸŸ! "
long
ŸŸ" &
idEnvio
ŸŸ' .
)
ŸŸ. /
{
⁄⁄ 	
try
€€ 
{
‹‹ 
return
›› 
_db
›› 
.
›› 
Envio
››  
.
››  !
Include
››! (
(
››( )
e
››) *
=>
››+ -
e
››. /
.
››/ 0
EnvioDocumento
››0 >
)
››> ?
.
››? @
Include
ﬁﬁ 
(
ﬁﬁ 
e
ﬁﬁ 
=>
ﬁﬁ  
e
ﬁﬁ! "
.
ﬁﬁ" #
EnvioDocumento
ﬁﬁ# 1
.
ﬁﬁ1 2
Select
ﬁﬁ2 8
(
ﬁﬁ8 9
ed
ﬁﬁ9 ;
=>
ﬁﬁ< >
ed
ﬁﬁ? A
.
ﬁﬁA B
	Documento
ﬁﬁB K
)
ﬁﬁK L
)
ﬁﬁL M
.
ﬁﬁM N
Include
ﬂﬂ 
(
ﬂﬂ 
e
ﬂﬂ 
=>
ﬂﬂ  
e
ﬂﬂ! "
.
ﬂﬂ" #
EnvioDocumento
ﬂﬂ# 1
.
ﬂﬂ1 2
Select
ﬂﬂ2 8
(
ﬂﬂ8 9
ed
ﬂﬂ9 ;
=>
ﬂﬂ< >
ed
ﬂﬂ? A
.
ﬂﬂA B
	Documento
ﬂﬂB K
.
ﬂﬂK L
Binario
ﬂﬂL S
)
ﬂﬂS T
)
ﬂﬂT U
.
ﬂﬂU V
Single
‡‡ 
(
‡‡ 
e
‡‡ 
=>
‡‡ 
e
‡‡  !
.
‡‡! "
id
‡‡" $
==
‡‡% '
idEnvio
‡‡( /
)
‡‡/ 0
;
‡‡0 1
}
·· 
catch
‚‚ 
(
‚‚ 
	Exception
‚‚ 
e
‚‚ 
)
‚‚ 
{
„„ 
throw
‰‰ 
e
‰‰ 
;
‰‰ 
}
ÂÂ 
}
ÊÊ 	
public
ËË 
IEnumerable
ËË 
<
ËË 
Envio
ËË  
>
ËË  !G
9ObtenerEnviosInclusiveEnvioDocumentoYDocumentoEntreFechas
ËË" [
(
ËË[ \
DateTime
ËË\ d

fechaDesde
ËËe o
,
ËËo p
DateTime
ËËq y

fechaHastaËËz Ñ
)ËËÑ Ö
{
ÈÈ 	
try
ÍÍ 
{
ÎÎ 
return
ÏÏ 
_db
ÏÏ 
.
ÏÏ 
Envio
ÏÏ  
.
ÏÏ  !
Include
ÏÏ! (
(
ÏÏ( )
e
ÏÏ) *
=>
ÏÏ+ -
e
ÏÏ. /
.
ÏÏ/ 0
EnvioDocumento
ÏÏ0 >
)
ÏÏ> ?
.
ÏÏ? @
Include
ÏÏ@ G
(
ÏÏG H
e
ÏÏH I
=>
ÏÏJ L
e
ÏÏM N
.
ÏÏN O
EnvioDocumento
ÏÏO ]
.
ÏÏ] ^
Select
ÏÏ^ d
(
ÏÏd e
ed
ÏÏe g
=>
ÏÏh j
ed
ÏÏk m
.
ÏÏm n
	Documento
ÏÏn w
)
ÏÏw x
)
ÏÏx y
.
ÏÏy z
Where
ÏÏz 
(ÏÏ Ä
eÏÏÄ Å
=>ÏÏÇ Ñ
eÏÏÖ Ü
.ÏÏÜ á

fechaEnvioÏÏá ë
>=ÏÏí î

fechaDesdeÏÏï ü
&&ÏÏ† ¢
eÏÏ£ §
.ÏÏ§ •

fechaEnvioÏÏ• Ø
<=ÏÏ∞ ≤

fechaHastaÏÏ≥ Ω
)ÏÏΩ æ
;ÏÏæ ø
}
ÌÌ 
catch
ÓÓ 
(
ÓÓ 
	Exception
ÓÓ 
e
ÓÓ 
)
ÓÓ 
{
ÔÔ 
throw
 
e
 
;
 
}
ÒÒ 
}
ÚÚ 	
public
ÙÙ 
IEnumerable
ÙÙ 
<
ÙÙ 
EnvioSimplificado
ÙÙ ,
>
ÙÙ, -/
!ObtenerEnviosSinCodigoDeRespuesta
ÙÙ. O
(
ÙÙO P
)
ÙÙP Q
{
ıı 	
try
ˆˆ 
{
˜˜ 
return
¯¯ 
_db
¯¯ 
.
¯¯ 
Envio
¯¯  
.
¯¯  !
Where
¯¯! &
(
¯¯& '
e
¯¯' (
=>
¯¯) +
e
¯¯, -
.
¯¯- .
estado
¯¯. 4
==
¯¯5 7
(
¯¯8 9
int
¯¯9 <
)
¯¯< =
EstadoEnvio
¯¯= H
.
¯¯H I
	Pendiente
¯¯I R
||
¯¯S U
e
¯¯V W
.
¯¯W X
estado
¯¯X ^
==
¯¯_ a
(
¯¯b c
int
¯¯c f
)
¯¯f g
EstadoEnvio
¯¯g r
.
¯¯r s
ConExcepcion
¯¯s 
)¯¯ Ä
.¯¯Ä Å
Select¯¯Å á
(¯¯á à
e¯¯à â
=>¯¯ä å
new¯¯ç ê!
EnvioSimplificado¯¯ë ¢
(¯¯¢ £
)¯¯£ §
{¯¯• ¶
Id¯¯ß ©
=¯¯™ ´
e¯¯¨ ≠
.¯¯≠ Æ
id¯¯Æ ∞
,¯¯∞ ±
NumeroTicket¯¯≤ æ
=¯¯ø ¿
e¯¯¡ ¬
.¯¯¬ √
numeroTicket¯¯√ œ
,¯¯œ –
	TipoEnvio¯¯— ⁄
=¯¯€ ‹
e¯¯› ﬁ
.¯¯ﬁ ﬂ
	tipoEnvio¯¯ﬂ Ë
,¯¯Ë È#
CodigoTipoDocumento¯¯Í ˝
=¯¯˛ ˇ
e¯¯Ä Å
.¯¯Å Ç
EnvioDocumento¯¯Ç ê
.¯¯ê ë
FirstOrDefault¯¯ë ü
(¯¯ü †
)¯¯† °
.¯¯° ¢
	Documento¯¯¢ ´
.¯¯´ ¨%
codigoTipoComprobante¯¯¨ ¡
,¯¯¡ ¬
SerieDocumento¯¯√ —
=¯¯“ ”
e¯¯‘ ’
.¯¯’ ÷
EnvioDocumento¯¯÷ ‰
.¯¯‰ Â
FirstOrDefault¯¯Â Û
(¯¯Û Ù
)¯¯Ù ı
.¯¯ı ˆ
	Documento¯¯ˆ ˇ
.¯¯ˇ Ä 
serieComprobante¯¯Ä ê
,¯¯ê ë
NumeroDocumento¯¯í °
=¯¯¢ £
e¯¯§ •
.¯¯• ¶
EnvioDocumento¯¯¶ ¥
.¯¯¥ µ
FirstOrDefault¯¯µ √
(¯¯√ ƒ
)¯¯ƒ ≈
.¯¯≈ ∆
	Documento¯¯∆ œ
.¯¯œ –!
numeroComprobante¯¯– ·
}¯¯‚ „
)¯¯„ ‰
;¯¯‰ Â
}
˘˘ 
catch
˙˙ 
(
˙˙ 
	Exception
˙˙ 
e
˙˙ 
)
˙˙ 
{
˚˚ 
throw
¸¸ 
e
¸¸ 
;
¸¸ 
}
˝˝ 
}
˛˛ 	
public
ÄÄ 
bool
ÄÄ 
	HayEnvios
ÄÄ 
(
ÄÄ 
string
ÄÄ $
	tipoEnvio
ÄÄ% .
,
ÄÄ. /
int
ÄÄ0 3
estado
ÄÄ4 :
)
ÄÄ: ;
{
ÅÅ 	
try
ÇÇ 
{
ÉÉ 
return
ÑÑ 
_db
ÑÑ 
.
ÑÑ 
Envio
ÑÑ  
.
ÑÑ  !
Any
ÑÑ! $
(
ÑÑ$ %
e
ÑÑ% &
=>
ÑÑ' )
e
ÑÑ* +
.
ÑÑ+ ,
	tipoEnvio
ÑÑ, 5
==
ÑÑ6 8
	tipoEnvio
ÑÑ9 B
&&
ÑÑC E
e
ÑÑF G
.
ÑÑG H
estado
ÑÑH N
==
ÑÑO Q
estado
ÑÑR X
)
ÑÑX Y
;
ÑÑY Z
}
ÖÖ 
catch
ÜÜ 
(
ÜÜ 
	Exception
ÜÜ 
e
ÜÜ 
)
ÜÜ 
{
áá 
throw
àà 
e
àà 
;
àà 
}
ââ 
}
ää 	
public
åå 
IEnumerable
åå 
<
åå 
long
åå 
>
åå  
IdEnvios
åå! )
(
åå) *
string
åå* 0
	tipoEnvio
åå1 :
,
åå: ;
int
åå< ?
estado
åå@ F
)
ååF G
{
çç 	
try
éé 
{
èè 
return
êê 
_db
êê 
.
êê 
Envio
êê  
.
êê  !
Where
êê! &
(
êê& '
e
êê' (
=>
êê) +
e
êê, -
.
êê- .
	tipoEnvio
êê. 7
==
êê8 :
	tipoEnvio
êê; D
&&
êêE G
e
êêH I
.
êêI J
estado
êêJ P
==
êêQ S
estado
êêT Z
)
êêZ [
.
êê[ \
Select
êê\ b
(
êêb c
e
êêc d
=>
êêe g
e
êêh i
.
êêi j
id
êêj l
)
êêl m
;
êêm n
}
ëë 
catch
íí 
(
íí 
	Exception
íí 
e
íí 
)
íí 
{
ìì 
throw
îî 
e
îî 
;
îî 
}
ïï 
}
ññ 	
public
òò 
IEnumerable
òò 
<
òò 
Envio
òò  
>
òò  !;
-ObtenerEnviosIncluidoDocumentoIncluidoBinario
òò" O
(
òòO P
int
òòP S
estado
òòT Z
)
òòZ [
{
ôô 	
try
öö 
{
õõ 
return
úú 
_db
úú 
.
úú 
Envio
úú  
.
úú  !
Include
úú! (
(
úú( )
e
úú) *
=>
úú+ -
e
úú. /
.
úú/ 0
EnvioDocumento
úú0 >
)
úú> ?
.
úú? @
Include
ùù 
(
ùù 
e
ùù 
=>
ùù  
e
ùù! "
.
ùù" #
EnvioDocumento
ùù# 1
.
ùù1 2
Select
ùù2 8
(
ùù8 9
ed
ùù9 ;
=>
ùù< >
ed
ùù? A
.
ùùA B
	Documento
ùùB K
)
ùùK L
)
ùùL M
.
ùùM N
Include
ûû 
(
ûû 
e
ûû 
=>
ûû  
e
ûû! "
.
ûû" #
EnvioDocumento
ûû# 1
.
ûû1 2
Select
ûû2 8
(
ûû8 9
ed
ûû9 ;
=>
ûû< >
ed
ûû? A
.
ûûA B
	Documento
ûûB K
.
ûûK L
Binario
ûûL S
)
ûûS T
)
ûûT U
.
ûûU V
Where
üü 
(
üü 
e
üü 
=>
üü 
e
üü  
.
üü  !
estado
üü! '
==
üü( *
estado
üü+ 1
)
üü1 2
;
üü2 3
}
†† 
catch
°° 
(
°° 
	Exception
°° 
e
°° 
)
°° 
{
¢¢ 
throw
££ 
e
££ 
;
££ 
}
§§ 
}
•• 	
public
ßß 
IEnumerable
ßß 
<
ßß 
Envio
ßß  
>
ßß  !;
-ObtenerEnviosIncluidoDocumentoIncluidoBinario
ßß" O
(
ßßO P
string
ßßP V
	tipoEnvio
ßßW `
,
ßß` a
int
ßßb e
estado
ßßf l
)
ßßl m
{
®® 	
try
©© 
{
™™ 
return
´´ 
_db
´´ 
.
´´ 
Envio
´´  
.
´´  !
Include
´´! (
(
´´( )
e
´´) *
=>
´´+ -
e
´´. /
.
´´/ 0
EnvioDocumento
´´0 >
)
´´> ?
.
´´? @
Include
¨¨ 
(
¨¨ 
e
¨¨ 
=>
¨¨  
e
¨¨! "
.
¨¨" #
EnvioDocumento
¨¨# 1
.
¨¨1 2
Select
¨¨2 8
(
¨¨8 9
ed
¨¨9 ;
=>
¨¨< >
ed
¨¨? A
.
¨¨A B
	Documento
¨¨B K
)
¨¨K L
)
¨¨L M
.
¨¨M N
Include
≠≠ 
(
≠≠ 
e
≠≠ 
=>
≠≠  
e
≠≠! "
.
≠≠" #
EnvioDocumento
≠≠# 1
.
≠≠1 2
Select
≠≠2 8
(
≠≠8 9
ed
≠≠9 ;
=>
≠≠< >
ed
≠≠? A
.
≠≠A B
	Documento
≠≠B K
.
≠≠K L
Binario
≠≠L S
)
≠≠S T
)
≠≠T U
.
≠≠U V
Where
ÆÆ 
(
ÆÆ 
e
ÆÆ 
=>
ÆÆ 
e
ÆÆ  
.
ÆÆ  !
	tipoEnvio
ÆÆ! *
==
ÆÆ+ -
	tipoEnvio
ÆÆ. 7
&&
ÆÆ8 :
e
ÆÆ; <
.
ÆÆ< =
estado
ÆÆ= C
==
ÆÆD F
estado
ÆÆG M
)
ÆÆM N
;
ÆÆN O
}
ØØ 
catch
∞∞ 
(
∞∞ 
	Exception
∞∞ 
e
∞∞ 
)
∞∞ 
{
±± 
throw
≤≤ 
e
≤≤ 
;
≤≤ 
}
≥≥ 
}
¥¥ 	
public
∫∫ 
IEnumerable
∫∫ 
<
∫∫ 
long
∫∫ 
>
∫∫  )
ObtenerIdDocumentosEnviados
∫∫! <
(
∫∫< =
long
∫∫= A
idEnvio
∫∫B I
)
∫∫I J
{
ªª 	
try
ºº 
{
ΩΩ 
return
ææ 
_db
ææ 
.
ææ 
EnvioDocumento
ææ )
.
ææ) *
Where
ææ* /
(
ææ/ 0
ed
ææ0 2
=>
ææ3 5
ed
ææ6 8
.
ææ8 9
idEnvio
ææ9 @
==
ææA C
idEnvio
ææD K
)
ææK L
.
ææL M
Select
ææM S
(
ææS T
d
ææT U
=>
ææV X
d
ææY Z
.
ææZ [
idDocumento
ææ[ f
)
ææf g
;
ææg h
}
øø 
catch
¿¿ 
(
¿¿ 
	Exception
¿¿ 
e
¿¿ 
)
¿¿ 
{
¡¡ 
throw
¬¬ 
e
¬¬ 
;
¬¬ 
}
√√ 
}
ƒƒ 	
public
∆∆ 
IEnumerable
∆∆ 
<
∆∆ 
	Documento
∆∆ $
>
∆∆$ %'
ObtenerDocumentosEnviados
∆∆& ?
(
∆∆? @
long
∆∆@ D
idEnvio
∆∆E L
)
∆∆L M
{
«« 	
try
»» 
{
…… 
return
   
_db
   
.
   
EnvioDocumento
   )
.
  ) *
Where
  * /
(
  / 0
ed
  0 2
=>
  3 5
ed
  6 8
.
  8 9
idEnvio
  9 @
==
  A C
idEnvio
  D K
)
  K L
.
  L M
Select
  M S
(
  S T
d
  T U
=>
  V X
d
  Y Z
.
  Z [
	Documento
  [ d
)
  d e
;
  e f
}
ÀÀ 
catch
ÃÃ 
(
ÃÃ 
	Exception
ÃÃ 
e
ÃÃ 
)
ÃÃ 
{
ÕÕ 
throw
ŒŒ 
e
ŒŒ 
;
ŒŒ 
}
œœ 
}
–– 	
public
““ 
bool
““ %
HayDocumentosNoEnviados
““ +
(
““+ ,
string
““, 2#
codigoTipoComprobante
““3 H
)
““H I
{
”” 	
try
‘‘ 
{
’’ 
return
÷÷ 
_db
÷÷ 
.
÷÷ 
	Documento
÷÷ $
.
÷÷$ %
Count
÷÷% *
(
÷÷* +
d
÷÷+ ,
=>
÷÷- /
d
÷÷0 1
.
÷÷1 2#
codigoTipoComprobante
÷÷2 G
==
÷÷H J#
codigoTipoComprobante
÷÷K `
&&
÷÷a c
d
÷÷d e
.
÷÷e f
EnvioDocumento
÷÷f t
.
÷÷t u
Count
÷÷u z
(
÷÷z {
)
÷÷{ |
<=
÷÷} 
$num÷÷Ä Å
)÷÷Å Ç
>÷÷É Ñ
$num÷÷Ö Ü
;÷÷Ü á
}
◊◊ 
catch
ÿÿ 
(
ÿÿ 
	Exception
ÿÿ 
e
ÿÿ 
)
ÿÿ 
{
ŸŸ 
throw
⁄⁄ 
e
⁄⁄ 
;
⁄⁄ 
}
€€ 
}
‹‹ 	
public
·· 
bool
·· %
HayDocumentosNoEnviados
·· +
(
··+ ,
string
··, 2#
codigoTipoComprobante
··3 H
,
··H I
int
··J M
estado
··N T
)
··T U
{
‚‚ 	
try
„„ 
{
‰‰ 
return
ÂÂ 
_db
ÂÂ 
.
ÂÂ 
	Documento
ÂÂ $
.
ÂÂ$ %
Any
ÂÂ% (
(
ÂÂ( )
d
ÂÂ) *
=>
ÂÂ+ -
d
ÂÂ. /
.
ÂÂ/ 0#
codigoTipoComprobante
ÂÂ0 E
==
ÂÂF H#
codigoTipoComprobante
ÂÂI ^
&&
ÂÂ_ a
!
ÂÂb c
d
ÂÂc d
.
ÂÂd e
EnvioDocumento
ÂÂe s
.
ÂÂs t
Any
ÂÂt w
(
ÂÂw x
)
ÂÂx y
&&
ÂÂz |
d
ÂÂ} ~
.
ÂÂ~ 
estadoÂÂ Ö
==ÂÂÜ à
estadoÂÂâ è
)ÂÂè ê
;ÂÂê ë
}
ÊÊ 
catch
ÁÁ 
(
ÁÁ 
	Exception
ÁÁ 
e
ÁÁ 
)
ÁÁ 
{
ËË 
throw
ÈÈ 
e
ÈÈ 
;
ÈÈ 
}
ÍÍ 
}
ÎÎ 	
public
ÌÌ 
bool
ÌÌ ,
DocumentoReferenciaFueAceptado
ÌÌ 2
(
ÌÌ2 3
string
ÌÌ3 9%
tipoDocumentoReferencia
ÌÌ: Q
,
ÌÌQ R
string
ÌÌS Y'
numeroDocumentoReferencia
ÌÌZ s
,
ÌÌs t
List
ÌÌu y
<
ÌÌy z
int
ÌÌz }
>
ÌÌ} ~"
estadosDeAceptacionÌÌ í
)ÌÌí ì
{
ÓÓ 	
try
ÔÔ 
{
 
return
ÒÒ 
_db
ÒÒ 
.
ÒÒ 
EnvioDocumento
ÒÒ )
.
ÒÒ) *
Where
ÒÒ* /
(
ÒÒ/ 0
ed
ÒÒ0 2
=>
ÒÒ3 5
ed
ÒÒ6 8
.
ÒÒ8 9
	Documento
ÒÒ9 B
.
ÒÒB C#
codigoTipoComprobante
ÒÒC X
==
ÒÒY [%
tipoDocumentoReferencia
ÒÒ\ s
&&
ÒÒt v
ed
ÒÒw y
.
ÒÒy z
	DocumentoÒÒz É
.ÒÒÉ Ñ 
serieComprobanteÒÒÑ î
+ÒÒï ñ
$strÒÒó ö
+ÒÒõ ú
edÒÒù ü
.ÒÒü †
	DocumentoÒÒ† ©
.ÒÒ© ™!
numeroComprobanteÒÒ™ ª
==ÒÒº æ)
numeroDocumentoReferenciaÒÒø ÿ
)ÒÒÿ Ÿ
.ÒÒŸ ⁄
AnyÒÒ⁄ ›
(ÒÒ› ﬁ
edÒÒﬁ ‡
=>ÒÒ· „#
estadosDeAceptacionÒÒ‰ ˜
.ÒÒ˜ ¯
ContainsÒÒ¯ Ä
(ÒÒÄ Å
edÒÒÅ É
.ÒÒÉ Ñ
EnvioÒÒÑ â
.ÒÒâ ä
estadoÒÒä ê
)ÒÒê ë
)ÒÒë í
;ÒÒí ì
}
ÚÚ 
catch
ÛÛ 
(
ÛÛ 
	Exception
ÛÛ 
e
ÛÛ 
)
ÛÛ 
{
ÙÙ 
throw
ıı 
e
ıı 
;
ıı 
}
ˆˆ 
}
˜˜ 	
public
˘˘ 
IEnumerable
˘˘ 
<
˘˘ 
	Documento
˘˘ $
>
˘˘$ %8
*ObtenerDocumentosFaltantesAEmitirAnulacion
˘˘& P
(
˘˘P Q0
"EstadoSigescomDocumentoElectronico
˘˘Q s
estadoSigescom˘˘t Ç
,˘˘Ç É
int˘˘Ñ á%
numeroEnviosAceptados˘˘à ù
,˘˘ù û
string˘˘ü •%
codigoTipoComprobante˘˘¶ ª
,˘˘ª º
int˘˘Ω ¿
[˘˘¿ ¡
]˘˘¡ ¬)
estadosEnvioQueNoSeQuiere˘˘√ ‹
)˘˘‹ ›
{
˙˙ 	
try
˚˚ 
{
¸¸ 
return
˝˝ 
_db
˝˝ 
.
˝˝ 
	Documento
˝˝ $
.
˝˝$ %
Where
˝˝% *
(
˝˝* +
d
˝˝+ ,
=>
˝˝- /
d
˝˝0 1
.
˝˝1 2
estadoSigescom
˝˝2 @
==
˝˝A C
(
˝˝D E
int
˝˝E H
)
˝˝H I
estadoSigescom
˝˝I W
&&
˝˝X Z
d
˝˝[ \
.
˝˝\ ]#
codigoTipoComprobante
˝˝] r
==
˝˝s u$
codigoTipoComprobante˝˝v ã
&&
˛˛ 
d
˛˛ 
.
˛˛ 
EnvioDocumento
˛˛ #
.
˛˛# $
Where
˛˛$ )
(
˛˛) *
ed
˛˛* ,
=>
˛˛- /
ed
˛˛0 2
.
˛˛2 3
Envio
˛˛3 8
.
˛˛8 9
	modoEnvio
˛˛9 B
==
˛˛C E
(
˛˛F G
int
˛˛G J
)
˛˛J K
	ModoEnvio
˛˛K T
.
˛˛T U
Adicion
˛˛U \
)
˛˛\ ]
.
˛˛] ^
Count
˛˛^ c
(
˛˛c d
ed
˛˛d f
=>
˛˛g i
ed
˛˛j l
.
˛˛l m
Envio
˛˛m r
.
˛˛r s
estado
˛˛s y
==
˛˛z |
(
˛˛} ~
int˛˛~ Å
)˛˛Å Ç
EstadoEnvio˛˛Ç ç
.˛˛ç é
Aceptado˛˛é ñ
||˛˛ó ô
ed˛˛ö ú
.˛˛ú ù
Envio˛˛ù ¢
.˛˛¢ £
estado˛˛£ ©
==˛˛™ ¨
(˛˛≠ Æ
int˛˛Æ ±
)˛˛± ≤
EstadoEnvio˛˛≤ Ω
.˛˛Ω æ(
AceptadoConObservaciones˛˛æ ÷
)˛˛÷ ◊
==˛˛ÿ ⁄%
numeroEnviosAceptados˛˛€ 
&&
ˇˇ 
d
ˇˇ 
.
ˇˇ 
EnvioDocumento
ˇˇ #
.
ˇˇ# $
Where
ˇˇ$ )
(
ˇˇ) *
ed
ˇˇ* ,
=>
ˇˇ- /
ed
ˇˇ0 2
.
ˇˇ2 3
Envio
ˇˇ3 8
.
ˇˇ8 9
	modoEnvio
ˇˇ9 B
==
ˇˇC E
(
ˇˇF G
int
ˇˇG J
)
ˇˇJ K
	ModoEnvio
ˇˇK T
.
ˇˇT U
	Anulacion
ˇˇU ^
)
ˇˇ^ _
.
ˇˇ_ `
Count
ˇˇ` e
(
ˇˇe f
ed
ˇˇf h
=>
ˇˇi k
ed
ˇˇl n
.
ˇˇn o
Envio
ˇˇo t
.
ˇˇt u
estado
ˇˇu {
==
ˇˇ| ~
(ˇˇ Ä
intˇˇÄ É
)ˇˇÉ Ñ
EstadoEnvioˇˇÑ è
.ˇˇè ê
Aceptadoˇˇê ò
||ˇˇô õ
edˇˇú û
.ˇˇû ü
Envioˇˇü §
.ˇˇ§ •
estadoˇˇ• ´
==ˇˇ¨ Æ
(ˇˇØ ∞
intˇˇ∞ ≥
)ˇˇ≥ ¥
EstadoEnvioˇˇ¥ ø
.ˇˇø ¿(
AceptadoConObservacionesˇˇ¿ ÿ
)ˇˇÿ Ÿ
==ˇˇ⁄ ‹
$numˇˇ› ﬁ
&&
ÄÄ 
d
ÄÄ 
.
ÄÄ 
EnvioDocumento
ÄÄ #
.
ÄÄ# $
Count
ÄÄ$ )
(
ÄÄ) *
ed
ÄÄ* ,
=>
ÄÄ- /'
estadosEnvioQueNoSeQuiere
ÄÄ0 I
.
ÄÄI J
Contains
ÄÄJ R
(
ÄÄR S
ed
ÄÄS U
.
ÄÄU V
Envio
ÄÄV [
.
ÄÄ[ \
estado
ÄÄ\ b
)
ÄÄb c
)
ÄÄc d
==
ÄÄe g
$num
ÄÄh i
)
ÅÅ 
;
ÅÅ 
}
ÇÇ 
catch
ÉÉ 
(
ÉÉ 
	Exception
ÉÉ 
e
ÉÉ 
)
ÉÉ 
{
ÑÑ 
throw
ÖÖ 
new
ÖÖ 
DatosException
ÖÖ (
(
ÖÖ( )
$str
ÖÖ) F
,
ÖÖF G
e
ÖÖH I
)
ÖÖI J
;
ÖÖJ K
}
ÜÜ 
}
áá 	
public
åå 
IEnumerable
åå 
<
åå 
	Documento
åå $
>
åå$ %
ObtenerDocumentos
åå& 7
(
åå7 8
string
åå8 >#
codigoTipoComprobante
åå? T
,
ååT U0
"EstadoSigescomDocumentoElectronico
ååV x
estadoSigescomååy á
,ååá à
stringååâ è

tipoEnvio1ååê ö
,ååö õ
intååú ü&
numeroEnviosAceptados1åå† ∂
,åå∂ ∑
stringåå∏ æ

tipoEnvio2ååø …
,åå…  
intååÀ Œ&
numeroEnviosAceptados2ååœ Â
)ååÂ Ê
{
çç 	
return
éé 
_db
éé 
.
éé 
	Documento
éé  
.
éé  !
Where
éé! &
(
éé& '
d
éé' (
=>
éé) +
d
éé, -
.
éé- .
estadoSigescom
éé. <
==
éé= ?
(
éé@ A
int
ééA D
)
ééD E
estadoSigescom
ééE S
&&
èè 
d
èè 
.
èè #
codigoTipoComprobante
èè &
==
èè' )#
codigoTipoComprobante
èè* ?
&&
êê 
d
êê 
.
êê 
EnvioDocumento
êê 
.
êê  
Count
êê  %
(
êê% &
ed
êê& (
=>
êê) +
ed
êê, .
.
êê. /
Envio
êê/ 4
.
êê4 5
	tipoEnvio
êê5 >
==
êê? A

tipoEnvio1
êêB L
&&
êêM O
(
êêP Q
ed
êêQ S
.
êêS T
Envio
êêT Y
.
êêY Z
estado
êêZ `
==
êêa c
(
êêd e
int
êêe h
)
êêh i
EstadoEnvio
êêi t
.
êêt u
Aceptado
êêu }
||êê~ Ä
edêêÅ É
.êêÉ Ñ
EnvioêêÑ â
.êêâ ä
estadoêêä ê
==êêë ì
(êêî ï
intêêï ò
)êêò ô
EstadoEnvioêêô §
.êê§ •(
AceptadoConObservacionesêê• Ω
)êêΩ æ
)
ëë 
==
ëë $
numeroEnviosAceptados1
ëë '
&&
íí 
d
íí 
.
íí 
EnvioDocumento
íí 
.
íí  
Count
íí  %
(
íí% &
ed
íí& (
=>
íí) +
ed
íí, .
.
íí. /
Envio
íí/ 4
.
íí4 5
	tipoEnvio
íí5 >
==
íí? A

tipoEnvio2
ííB L
&&
ìì 
(
ìì 
ed
ìì 
.
ìì 
Envio
ìì 
.
ìì 
estado
ìì 
==
ìì  "
(
ìì# $
int
ìì$ '
)
ìì' (
EstadoEnvio
ìì( 3
.
ìì3 4
Aceptado
ìì4 <
||
ìì= ?
ed
ìì@ B
.
ììB C
Envio
ììC H
.
ììH I
estado
ììI O
==
ììP R
(
ììS T
int
ììT W
)
ììW X
EstadoEnvio
ììX c
.
ììc d&
AceptadoConObservaciones
ììd |
)
ìì| }
)
ìì} ~
==ìì Å&
numeroEnviosAceptados2ììÇ ò
)ììò ô
;ììô ö
}
îî 	
}
òò 
}ôô æ
TD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\EFactura\EFacturaRepositorioBase.cs
	namespace 	
Tsp
 
. "
FacturacionElectronica $
.$ %
AccesoDatos% 0
{ 
public 

class #
EFacturaRepositorioBase (
:) *
IRepositorioBase+ ;
{ 
	protected 
FacturacionEntities %
_db& )
=* +
null, 0
;0 1
public #
EFacturaRepositorioBase &
(& '
)' (
{ 	
_db 
= 
new 
FacturacionEntities )
() *
)* +
;+ ,
} 	
public 
OperationResult 
Save #
(# $
)$ %
{ 	
try 
{ 
_db 
. 
SaveChanges 
(  
)  !
;! "
return 
new 
OperationResult *
(* +
OperationResultEnum+ >
.> ?
Success? F
)F G
;G H
} 
catch 
( (
DbUpdateConcurrencyException /
ex0 2
)2 3
{   
return!! 
new!! 
OperationResult!! *
(!!* +
ex!!+ -
)!!- .
;!!. /
}"" 
catch## 
(## 
EntityException## "
e### $
)##$ %
{$$ 
OperationResult%% 
result%%  &
=%%' (
new%%) ,
OperationResult%%- <
(%%< =
OperationResultEnum%%= P
.%%P Q
Error%%Q V
,%%V W
$str	%%X ±
)
%%± ≤
;
%%≤ ≥
result&& 
.&& 

exceptions&& !
.&&! "
Add&&" %
(&&% &
e&&& '
)&&' (
;&&( )
return'' 
result'' 
;'' 
}(( 
catch)) 
()) 
	Exception)) 
e)) 
))) 
{** 
return++ 
new++ 
OperationResult++ *
(++* +
e+++ ,
)++, -
;++- .
},, 
}.. 	
public00 
void00 
RefreshEntity00 !
(00! "
object00" (
_object00) 0
)000 1
{11 	
var22 
context22 
=22 
(22 
(22 !
IObjectContextAdapter22 1
)221 2
_db222 5
)225 6
.226 7
ObjectContext227 D
;22D E
context33 
.33 
Refresh33 
(33 
System33 "
.33" #
Data33# '
.33' (
Entity33( .
.33. /
Core33/ 3
.333 4
Objects334 ;
.33; <
RefreshMode33< G
.33G H
	StoreWins33H Q
,33Q R
_object33S Z
)33Z [
;33[ \
}44 	
public55 
void55 #
RefreshEntityCollection55 +
(55+ ,
IEnumerable55, 7
<557 8
object558 >
>55> ?

collection55@ J
)55J K
{66 	
var77 
context77 
=77 
(77 
(77 !
IObjectContextAdapter77 1
)771 2
_db772 5
)775 6
.776 7
ObjectContext777 D
;77D E
context88 
.88 
Refresh88 
(88 
System88 "
.88" #
Data88# '
.88' (
Entity88( .
.88. /
Core88/ 3
.883 4
Objects884 ;
.88; <
RefreshMode88< G
.88G H
	StoreWins88H Q
,88Q R

collection88S ]
)88] ^
;88^ _
}99 	
}:: 
};; ⁄Ô
GD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\ActorDatos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
{ 
public 

class 

ActorDatos 
: 
RepositorioBase -
,- .
IActorRepositorio/ @
{ 
public 
OperationResult .
"CrearActorNegocioActualizandoActor A
(A B
Actor_negocioB O
actorNegocioP \
)\ ]
{ 	
try 
{ 
List 
< 
Actor_negocio "
>" #
updRoles$ ,
=- .
actorNegocio/ ;
.; <
Actor< A
.A B
Actor_negocioB O
.O P
ToListP V
(V W
)W X
;X Y
;Z [
var 
dbActor 
= 
_db !
.! "
Actor" '
.' (
Include( /
(/ 0
a0 1
=>2 4
a5 6
.6 7
	Direccion7 @
)@ A
.A B
SingleB H
(H I
aI J
=>K M
aN O
.O P
idP R
==S U
actorNegocioV b
.b c
id_actorc k
)k l
;l m
_db!! 
.!! 
Entry!! 
(!! 
dbActor!! !
)!!! "
.!!" #
CurrentValues!!# 0
.!!0 1
	SetValues!!1 :
(!!: ;
actorNegocio!!; G
.!!G H
Actor!!H M
)!!M N
;!!N O
List$$ 
<$$ 
	Direccion$$ 
>$$ 
updDirecciones$$  .
=$$/ 0
actorNegocio$$1 =
.$$= >
Actor$$> C
.$$C D
	Direccion$$D M
.$$M N
ToList$$N T
($$T U
)$$U V
;$$V W
List%% 
<%% 
	Direccion%% 
>%% 
dbDirecciones%%  -
=%%. /
dbActor%%0 7
.%%7 8
	Direccion%%8 A
.%%A B
ToList%%B H
(%%H I
)%%I J
;%%J K
foreach'' 
('' 
var'' 
dbDireccion'' (
in'') +
dbDirecciones'', 9
)''9 :
{(( 
if** 
(** 
updDirecciones** &
.**& '
Any**' *
(*** +
d**+ ,
=>**- /
d**0 1
.**1 2
id**2 4
==**5 7
dbDireccion**8 C
.**C D
id**D F
)**F G
)**G H
{++ 
var,, 
	direccion,, %
=,,& '
updDirecciones,,( 6
.,,6 7
Single,,7 =
(,,= >
d,,> ?
=>,,@ B
d,,C D
.,,D E
id,,E G
==,,H J
dbDireccion,,K V
.,,V W
id,,W Y
),,Y Z
;,,Z [
_db-- 
.-- 
Entry-- !
(--! "
dbDireccion--" -
)--- .
.--. /
CurrentValues--/ <
.--< =
	SetValues--= F
(--F G
	direccion--G P
)--P Q
;--Q R
}.. 
else// 
{00 
_db11 
.11 
	Direccion11 %
.11% &
Remove11& ,
(11, -
dbDireccion11- 8
)118 9
;119 :
}22 
}33 
foreach55 
(55 
var55 
updDireccion55 )
in55* ,
updDirecciones55- ;
)55; <
{66 
if77 
(77 
!77 
dbDirecciones77 &
.77& '
Any77' *
(77* +
d77+ ,
=>77- /
d770 1
.771 2
id772 4
==775 7
updDireccion778 D
.77D E
id77E G
)77G H
)77H I
{88 
_db99 
.99 
	Direccion99 %
.99% &
Add99& )
(99) *
updDireccion99* 6
)996 7
;997 8
}:: 
};; 
actorNegocio>> 
.>> 
Actor>> "
=>># $
dbActor>>% ,
;>>, -
_db?? 
.?? 
Actor_negocio?? !
.??! "
Add??" %
(??% &
actorNegocio??& 2
)??2 3
;??3 4
foreachBB 
(BB 
varBB 
updRolBB #
inBB$ &
updRolesBB' /
)BB/ 0
{CC 
_dbDD 
.DD 
Actor_negocioDD %
.DD% &
AddDD& )
(DD) *
updRolDD* 0
)DD0 1
;DD1 2
}EE 
varFF 
resultFF 
=FF 
SaveFF !
(FF! "
)FF" #
;FF# $
resultGG 
.GG 
dataGG 
=GG 
actorNegocioGG *
.GG* +
idGG+ -
;GG- .
returnHH 
resultHH 
;HH 
}II 
catchJJ 
(JJ 
	ExceptionJJ 
eJJ 
)JJ 
{KK 
throwLL 
eLL 
;LL 
}MM 
}NN 	
publicUU 
intUU 
obtenerIdActorUU !
(UU! "
intUU" %
idActorNegocioUU& 4
)UU4 5
{VV 	
returnWW 
_dbWW 
.WW 
Actor_negocioWW $
.WW$ %
WhereWW% *
(WW* +
anWW+ -
=>WW. 0
anWW1 3
.WW3 4
idWW4 6
==WW7 9
idActorNegocioWW: H
)WWH I
.WWI J
MaxWWJ M
(WWM N
anWWN P
=>WWQ S
anWWT V
.WWV W
id_actorWWW _
)WW_ `
;WW` a
}XX 	
publicZZ 
intZZ 
obtenerIdDireccionZZ %
(ZZ% &
intZZ& )
idActorZZ* 1
)ZZ1 2
{[[ 	
var\\ 
direcciones\\ 
=\\ 
_db\\ !
.\\! "
	Direccion\\" +
.\\+ ,
Where\\, 1
(\\1 2
an\\2 4
=>\\5 7
an\\8 :
.\\: ;
id_actor\\; C
==\\D F
idActor\\G N
)\\N O
;\\O P
return]] 
direcciones]] 
.]] 
Count]] $
(]]$ %
)]]% &
>]]' (
$num]]) *
?]]+ ,
_db]]- 0
.]]0 1
	Direccion]]1 :
.]]: ;
Where]]; @
(]]@ A
an]]A C
=>]]D F
an]]G I
.]]I J
id_actor]]J R
==]]S U
idActor]]V ]
)]]] ^
.]]^ _
Max]]_ b
(]]b c
an]]c e
=>]]f h
an]]i k
.]]k l
id]]l n
)]]n o
:]]p q
$num]]r s
;]]s t
}^^ 	
publicaa 
boolaa =
1ExisteNumeroDocumentoIdDetalleMultiPropositoActoraa E
(aaE F
intaaF I#
idDetalleMultipropositoaaJ a
,aaa b
stringaac i
numeroDocumentoaaj y
,aay z
string	aa{ Å
primerNombre
aaÇ é
)
aaé è
{bb 	
trycc 
{dd 
boolee 
existeee 
=ee 
_dbee !
.ee! "
Actoree" '
.ee' (
Whereee( -
(ee- .
cnee. 0
=>ee1 3
cnee4 6
.ee6 7&
numero_documento_identidadee7 Q
==eeR T
numeroDocumentoeeU d
&&eee g
cneeh j
.eej k
primer_nombreeek x
==eey {
primerNombre	ee| à
&&
eeâ ã
cn
eeå é
.
eeé è'
id_detalle_multiproposito
eeè ®
==
ee© ´%
idDetalleMultiproposito
ee¨ √
)
ee√ ƒ
.
eeƒ ≈
Any
ee≈ »
(
ee» …
)
ee…  
;
ee  À
returnff 
existeff 
;ff 
}gg 
catchhh 
(hh 
	Exceptionhh 
ehh 
)hh 
{ii 
throwjj 
newjj 
DatosExceptionjj (
(jj( )
$strjj) e
,jje f
ejjg h
)jjh i
;jji j
}kk 
}ll 	
publicnn 
boolnn =
1ExisteNumeroDocumentoIdDetalleMultiPropositoActornn E
(nnE F
intnnF I
idActornnJ Q
,nnQ R
intnnS V#
idDetalleMultipropositonnW n
,nnn o
stringnnp v
numeroDocumento	nnw Ü
,
nnÜ á
string
nnà é
primerNombre
nnè õ
)
nnõ ú
{oo 	
trypp 
{qq 
boolrr 
existerr 
=rr 
_dbrr !
.rr! "
Actorrr" '
.rr' (
Whererr( -
(rr- .
cnrr. 0
=>rr1 3
cnrr4 6
.rr6 7
idrr7 9
!=rr: <
idActorrr= D
&&rrE G
cnrrH J
.rrJ K&
numero_documento_identidadrrK e
==rrf h
numeroDocumentorri x
&&rry {
cnrr| ~
.rr~ 
primer_nombre	rr å
==
rrç è
primerNombre
rrê ú
&&
rrù ü
cn
rr† ¢
.
rr¢ £'
id_detalle_multiproposito
rr£ º
==
rrΩ ø%
idDetalleMultiproposito
rr¿ ◊
)
rr◊ ÿ
.
rrÿ Ÿ
Any
rrŸ ‹
(
rr‹ ›
)
rr› ﬁ
;
rrﬁ ﬂ
returnss 
existess 
;ss 
}tt 
catchuu 
(uu 
	Exceptionuu 
euu 
)uu 
{vv 
throwww 
newww 
DatosExceptionww (
(ww( )
$strww) e
,wwe f
ewwg h
)wwh i
;wwi j
}xx 
}yy 	
public
ÜÜ 
OperationResult
ÜÜ *
actualizarActorNegocioYRoles
ÜÜ ;
(
ÜÜ; <
Actor_negocio
ÜÜ< I
updActorNegocio
ÜÜJ Y
)
ÜÜY Z
{
áá 	
var
ää 
dbActorNegocio
ää 
=
ää  
_db
ää! $
.
ää$ %
Actor_negocio
ää% 2
.
ää2 3
Include
ää3 :
(
ää: ;
an
ää; =
=>
ää> @
an
ääA C
.
ääC D
Actor
ääD I
.
ääI J
	Direccion
ääJ S
)
ääS T
.
ääT U
Include
ääU \
(
ää\ ]
an
ää] _
=>
ää` b
an
ääc e
.
ääe f
Actor
ääf k
.
ääk l
Actor_negocio
ääl y
)
ääy z
.
ääz {
Singleää{ Å
(ääÅ Ç
anääÇ Ñ
=>ääÖ á
anääà ä
.äää ã
idääã ç
==ääé ê
updActorNegocioääë †
.ää† °
idää° £
)ää£ §
;ää§ •
_db
åå 
.
åå 
Entry
åå 
(
åå 
dbActorNegocio
åå $
)
åå$ %
.
åå% &
CurrentValues
åå& 3
.
åå3 4
	SetValues
åå4 =
(
åå= >
updActorNegocio
åå> M
)
ååM N
;
ååN O
_db
éé 
.
éé 
Entry
éé 
(
éé 
dbActorNegocio
éé $
.
éé$ %
Actor
éé% *
)
éé* +
.
éé+ ,
CurrentValues
éé, 9
.
éé9 :
	SetValues
éé: C
(
ééC D
updActorNegocio
ééD S
.
ééS T
Actor
ééT Y
)
ééY Z
;
ééZ [
int
ëë 
[
ëë 
]
ëë '
idsDireccionesAActualizar
ëë +
=
ëë, -
updActorNegocio
ëë. =
.
ëë= >
Actor
ëë> C
.
ëëC D
	Direccion
ëëD M
.
ëëM N
Select
ëëN T
(
ëëT U
d
ëëU V
=>
ëëW Y
d
ëëZ [
.
ëë[ \
id
ëë\ ^
)
ëë^ _
.
ëë_ `
ToArray
ëë` g
(
ëëg h
)
ëëh i
;
ëëi j
List
íí 
<
íí 
	Direccion
íí 
>
íí 
dbDirecciones
íí )
=
íí* +
dbActorNegocio
íí, :
.
íí: ;
Actor
íí; @
.
íí@ A
	Direccion
ííA J
.
ííJ K
Where
ííK P
(
ííP Q
d
ííQ R
=>
ííS U'
idsDireccionesAActualizar
ííV o
.
íío p
Contains
ííp x
(
ííx y
d
ííy z
.
ííz {
id
íí{ }
)
íí} ~
)
íí~ 
.íí Ä
ToListííÄ Ü
(ííÜ á
)ííá à
;ííà â
foreach
îî 
(
îî 
var
îî 
dbDireccion
îî $
in
îî% '
dbDirecciones
îî( 5
)
îî5 6
{
ïï 
_db
óó 
.
óó 
Entry
óó 
(
óó 
dbDireccion
óó %
)
óó% &
.
óó& '
CurrentValues
óó' 4
.
óó4 5
	SetValues
óó5 >
(
óó> ?
updActorNegocio
óó? N
.
óóN O
Actor
óóO T
.
óóT U
	Direccion
óóU ^
.
óó^ _
SingleOrDefault
óó_ n
(
óón o
d
óóo p
=>
óóq s
d
óót u
.
óóu v
id
óóv x
==
óóy {
dbDireccionóó| á
.óóá à
idóóà ä
)óóä ã
)óóã å
;óóå ç
}
òò 
List
õõ 
<
õõ 
Actor_negocio
õõ 
>
õõ 
dbRoles
õõ  '
=
õõ( )
dbActorNegocio
õõ* 8
.
õõ8 9
Actor
õõ9 >
.
õõ> ?
Actor_negocio
õõ? L
.
õõL M
Where
õõM R
(
õõR S
an
õõS U
=>
õõV X
an
õõY [
.
õõ[ \
Rol
õõ\ _
.
õõ_ `
id_rol_padre
õõ` l
==
õõm o
updActorNegocio
õõp 
.õõ Ä
id_rolõõÄ Ü
&&õõá â
anõõä å
.õõå ç

es_vigenteõõç ó
==õõò ö
trueõõõ ü
)õõü †
.õõ† °
ToListõõ° ß
(õõß ®
)õõ® ©
;õõ© ™
List
úú 
<
úú 
Actor_negocio
úú 
>
úú 
updRoles
úú  (
=
úú) *
updActorNegocio
úú+ :
.
úú: ;
Actor
úú; @
.
úú@ A
Actor_negocio
úúA N
.
úúN O
ToList
úúO U
(
úúU V
)
úúV W
;
úúW X
foreach
ûû 
(
ûû 
var
ûû 
dbRol
ûû 
in
ûû !
dbRoles
ûû" )
)
ûû) *
{
üü 
if
°° 
(
°° 
!
°° 
updRoles
°° 
.
°° 
Any
°° !
(
°°! "
p
°°" #
=>
°°$ &
p
°°' (
.
°°( )
id_rol
°°) /
==
°°0 2
dbRol
°°3 8
.
°°8 9
id_rol
°°9 ?
)
°°? @
)
°°@ A
{
¢¢ 
dbRol
££ 
.
££ 
	fecha_fin
££ #
=
££$ %
DateTimeUtil
££& 2
.
££2 3
FechaActual
££3 >
(
££> ?
)
££? @
;
££@ A
dbRol
§§ 
.
§§ 

es_vigente
§§ $
=
§§% &
false
§§' ,
;
§§, -
}
•• 
}
¶¶ 
foreach
®® 
(
®® 
var
®® 
updRol
®® 
in
®®  "
updRoles
®®# +
)
®®+ ,
{
©© 
if
™™ 
(
™™ 
!
™™ 
dbRoles
™™ 
.
™™ 
Any
™™  
(
™™  !
p
™™! "
=>
™™# %
p
™™& '
.
™™' (
id_rol
™™( .
==
™™/ 1
updRol
™™2 8
.
™™8 9
id_rol
™™9 ?
)
™™? @
)
™™@ A
{
´´ 
_db
¨¨ 
.
¨¨ 
Actor_negocio
¨¨ %
.
¨¨% &
Add
¨¨& )
(
¨¨) *
updRol
¨¨* 0
)
¨¨0 1
;
¨¨1 2
}
≠≠ 
}
ÆÆ 
return
ØØ 
Save
ØØ 
(
ØØ 
)
ØØ 
;
ØØ 
}
∞∞ 	
public
¥¥ 
OperationResult
¥¥ .
 actualizarActorNegocioYDireccion
¥¥ ?
(
¥¥? @
Actor_negocio
¥¥@ M
updActorNegocio
¥¥N ]
)
¥¥] ^
{
µµ 	
var
∑∑ 
dbActorNegocio
∑∑ 
=
∑∑  
_db
∑∑! $
.
∑∑$ %
Actor_negocio
∑∑% 2
.
∑∑2 3
Include
∑∑3 :
(
∑∑: ;
an
∑∑; =
=>
∑∑> @
an
∑∑A C
.
∑∑C D%
Parametro_actor_negocio
∑∑D [
)
∑∑[ \
.
∑∑\ ]
Include
∑∑] d
(
∑∑d e
an
∑∑e g
=>
∑∑h j
an
∑∑k m
.
∑∑m n
Actor
∑∑n s
.
∑∑s t
	Direccion
∑∑t }
)
∑∑} ~
.
∑∑~ 
Single∑∑ Ö
(∑∑Ö Ü
an∑∑Ü à
=>∑∑â ã
an∑∑å é
.∑∑é è
id∑∑è ë
==∑∑í î
updActorNegocio∑∑ï §
.∑∑§ •
id∑∑• ß
)∑∑ß ®
;∑∑® ©
_db
ππ 
.
ππ 
Entry
ππ 
(
ππ 
dbActorNegocio
ππ $
)
ππ$ %
.
ππ% &
CurrentValues
ππ& 3
.
ππ3 4
	SetValues
ππ4 =
(
ππ= >
updActorNegocio
ππ> M
)
ππM N
;
ππN O
_db
ºº 
.
ºº 
Entry
ºº 
(
ºº 
dbActorNegocio
ºº $
.
ºº$ %
Actor
ºº% *
)
ºº* +
.
ºº+ ,
CurrentValues
ºº, 9
.
ºº9 :
	SetValues
ºº: C
(
ººC D
updActorNegocio
ººD S
.
ººS T
Actor
ººT Y
)
ººY Z
;
ººZ [
int
¿¿ 
[
¿¿ 
]
¿¿ '
idsDireccionesAActualizar
¿¿ +
=
¿¿, -
updActorNegocio
¿¿. =
.
¿¿= >
Actor
¿¿> C
.
¿¿C D
	Direccion
¿¿D M
.
¿¿M N
Select
¿¿N T
(
¿¿T U
d
¿¿U V
=>
¿¿W Y
d
¿¿Z [
.
¿¿[ \
id
¿¿\ ^
)
¿¿^ _
.
¿¿_ `
ToArray
¿¿` g
(
¿¿g h
)
¿¿h i
;
¿¿i j
List
¡¡ 
<
¡¡ 
	Direccion
¡¡ 
>
¡¡ 
dbDirecciones
¡¡ )
=
¡¡* +
dbActorNegocio
¡¡, :
.
¡¡: ;
Actor
¡¡; @
.
¡¡@ A
	Direccion
¡¡A J
.
¡¡J K
Where
¡¡K P
(
¡¡P Q
d
¡¡Q R
=>
¡¡S U'
idsDireccionesAActualizar
¡¡V o
.
¡¡o p
Contains
¡¡p x
(
¡¡x y
d
¡¡y z
.
¡¡z {
id
¡¡{ }
)
¡¡} ~
)
¡¡~ 
.¡¡ Ä
ToList¡¡Ä Ü
(¡¡Ü á
)¡¡á à
;¡¡à â
foreach
ƒƒ 
(
ƒƒ 
var
ƒƒ 
dbDireccion
ƒƒ $
in
ƒƒ% '
dbDirecciones
ƒƒ( 5
)
ƒƒ5 6
{
≈≈ 
_db
«« 
.
«« 
Entry
«« 
(
«« 
dbDireccion
«« %
)
««% &
.
««& '
CurrentValues
««' 4
.
««4 5
	SetValues
««5 >
(
««> ?
updActorNegocio
««? N
.
««N O
Actor
««O T
.
««T U
	Direccion
««U ^
.
««^ _
SingleOrDefault
««_ n
(
««n o
d
««o p
=>
««q s
d
««t u
.
««u v
id
««v x
==
««y {
dbDireccion««| á
.««á à
id««à ä
)««ä ã
)««ã å
;««å ç
}
»» 
List
ÀÀ 
<
ÀÀ %
Parametro_actor_negocio
ÀÀ (
>
ÀÀ( )
dbParametros
ÀÀ* 6
=
ÀÀ7 8
dbActorNegocio
ÀÀ9 G
.
ÀÀG H%
Parametro_actor_negocio
ÀÀH _
.
ÀÀ_ `
ToList
ÀÀ` f
(
ÀÀf g
)
ÀÀg h
;
ÀÀh i
List
ÃÃ 
<
ÃÃ %
Parametro_actor_negocio
ÃÃ (
>
ÃÃ( )
updParametros
ÃÃ* 7
=
ÃÃ8 9
updActorNegocio
ÃÃ: I
.
ÃÃI J%
Parametro_actor_negocio
ÃÃJ a
.
ÃÃa b
ToList
ÃÃb h
(
ÃÃh i
)
ÃÃi j
;
ÃÃj k
foreach
ŒŒ 
(
ŒŒ 
var
ŒŒ 
dbParametro
ŒŒ $
in
ŒŒ% '
dbParametros
ŒŒ( 4
)
ŒŒ4 5
{
œœ 
if
—— 
(
—— 
updParametros
—— !
.
——! "
Any
——" %
(
——% &
p
——& '
=>
——( *
p
——+ ,
.
——, -
id_parametro
——- 9
==
——: <
dbParametro
——= H
.
——H I
id_parametro
——I U
)
——U V
)
——V W
{
““ 
dbParametro
”” 
.
””   
id_valor_parametro
””  2
=
””3 4
updParametros
””5 B
.
””B C
Single
””C I
(
””I J
pan
””J M
=>
””N P
pan
””Q T
.
””T U
id_parametro
””U a
==
””b d
dbParametro
””e p
.
””p q
id_parametro
””q }
)
””} ~
.
””~ !
id_valor_parametro”” ë
;””ë í
dbParametro
‘‘ 
.
‘‘  
valor
‘‘  %
=
‘‘& '
updParametros
‘‘( 5
.
‘‘5 6
Single
‘‘6 <
(
‘‘< =
pan
‘‘= @
=>
‘‘A C
pan
‘‘D G
.
‘‘G H
id_parametro
‘‘H T
==
‘‘U W
dbParametro
‘‘X c
.
‘‘c d
id_parametro
‘‘d p
)
‘‘p q
.
‘‘q r
valor
‘‘r w
;
‘‘w x
}
’’ 
else
÷÷ 
{
◊◊ 
_db
ÿÿ 
.
ÿÿ %
Parametro_actor_negocio
ÿÿ /
.
ÿÿ/ 0
Remove
ÿÿ0 6
(
ÿÿ6 7
dbParametro
ÿÿ7 B
)
ÿÿB C
;
ÿÿC D
}
ŸŸ 
}
⁄⁄ 
foreach
‹‹ 
(
‹‹ 
var
‹‹ 
updParametro
‹‹ %
in
‹‹& (
updParametros
‹‹) 6
)
‹‹6 7
{
›› 
if
ﬁﬁ 
(
ﬁﬁ 
!
ﬁﬁ 
dbParametros
ﬁﬁ !
.
ﬁﬁ! "
Any
ﬁﬁ" %
(
ﬁﬁ% &
p
ﬁﬁ& '
=>
ﬁﬁ( *
p
ﬁﬁ+ ,
.
ﬁﬁ, -
id_parametro
ﬁﬁ- 9
==
ﬁﬁ: <
updParametro
ﬁﬁ= I
.
ﬁﬁI J
id_parametro
ﬁﬁJ V
)
ﬁﬁV W
)
ﬁﬁW X
{
ﬂﬂ 
_db
‡‡ 
.
‡‡ %
Parametro_actor_negocio
‡‡ /
.
‡‡/ 0
Add
‡‡0 3
(
‡‡3 4
updParametro
‡‡4 @
)
‡‡@ A
;
‡‡A B
}
·· 
}
‚‚ 
return
„„ 
Save
„„ 
(
„„ 
)
„„ 
;
„„ 
}
‰‰ 	
public
ÂÂ 
OperationResult
ÂÂ $
actualizarActorNegocio
ÂÂ 5
(
ÂÂ5 6
Actor_negocio
ÂÂ6 C
newActorNegocio
ÂÂD S
,
ÂÂS T
int
ÂÂU X
[
ÂÂX Y
]
ÂÂY Z#
newIdsActorNegocioRol
ÂÂ[ p
)
ÂÂp q
{
ÊÊ 	
var
ËË 
dbActorNegocio
ËË 
=
ËË  
_db
ËË! $
.
ËË$ %
Actor_negocio
ËË% 2
.
ËË2 3
Include
ËË3 :
(
ËË: ;
an
ËË; =
=>
ËË> @
an
ËËA C
.
ËËC D
Actor
ËËD I
)
ËËI J
.
ËËJ K
Include
ËËK R
(
ËËR S
an
ËËS U
=>
ËËV X
an
ËËY [
.
ËË[ \
Actor_negocio_rol
ËË\ m
)
ËËm n
.
ËËn o
Single
ËËo u
(
ËËu v
an
ËËv x
=>
ËËy {
an
ËË| ~
.
ËË~ 
idËË Å
==ËËÇ Ñ
newActorNegocioËËÖ î
.ËËî ï
idËËï ó
)ËËó ò
;ËËò ô
_db
ÎÎ 
.
ÎÎ 
Entry
ÎÎ 
(
ÎÎ 
dbActorNegocio
ÎÎ $
)
ÎÎ$ %
.
ÎÎ% &
CurrentValues
ÎÎ& 3
.
ÎÎ3 4
	SetValues
ÎÎ4 =
(
ÎÎ= >
newActorNegocio
ÎÎ> M
)
ÎÎM N
;
ÎÎN O
_db
ÌÌ 
.
ÌÌ 
Entry
ÌÌ 
(
ÌÌ 
dbActorNegocio
ÌÌ $
.
ÌÌ$ %
Actor
ÌÌ% *
)
ÌÌ* +
.
ÌÌ+ ,
CurrentValues
ÌÌ, 9
.
ÌÌ9 :
	SetValues
ÌÌ: C
(
ÌÌC D
newActorNegocio
ÌÌD S
.
ÌÌS T
Actor
ÌÌT Y
)
ÌÌY Z
;
ÌÌZ [
foreach
 
(
 
var
 %
dbParametroActorNegocio
 0
in
1 3
dbActorNegocio
4 B
.
B C%
Parametro_actor_negocio
C Z
)
Z [
{
ÒÒ 
if
ÛÛ 
(
ÛÛ 
newActorNegocio
ÛÛ #
.
ÛÛ# $
nuevosParametros
ÛÛ$ 4
.
ÛÛ4 5
Any
ÛÛ5 8
(
ÛÛ8 9
pan
ÛÛ9 <
=>
ÛÛ= ?
pan
ÛÛ@ C
.
ÛÛC D
id_parametro
ÛÛD P
==
ÛÛQ S%
dbParametroActorNegocio
ÛÛT k
.
ÛÛk l
id_parametro
ÛÛl x
)
ÛÛx y
)
ÛÛy z
{
ÙÙ %
dbParametroActorNegocio
ıı +
.
ıı+ , 
id_valor_parametro
ıı, >
=
ıı? @
newActorNegocio
ııA P
.
ııP Q
nuevosParametros
ııQ a
.
ııa b
Single
ııb h
(
ııh i
pan
ııi l
=>
ıım o
pan
ııp s
.
ııs t
id_parametroııt Ä
==ııÅ É'
dbParametroActorNegocioııÑ õ
.ııõ ú
id_parametroııú ®
)ıı® ©
.ıı© ™"
id_valor_parametroıı™ º
;ııº Ω
}
ˆˆ 
else
˜˜ 
{
¯¯ 
_db
˘˘ 
.
˘˘ %
Parametro_actor_negocio
˘˘ /
.
˘˘/ 0
Remove
˘˘0 6
(
˘˘6 7%
dbParametroActorNegocio
˘˘7 N
)
˘˘N O
;
˘˘O P
}
˙˙ 
}
˚˚ 
foreach
˛˛ 
(
˛˛ 
var
˛˛ &
newParametroActorNegocio
˛˛ 1
in
˛˛2 4
newActorNegocio
˛˛5 D
.
˛˛D E
nuevosParametros
˛˛E U
)
˛˛U V
{
ˇˇ 
if
ÄÄ 
(
ÄÄ 
!
ÄÄ 
dbActorNegocio
ÄÄ #
.
ÄÄ# $%
Parametro_actor_negocio
ÄÄ$ ;
.
ÄÄ; <
Any
ÄÄ< ?
(
ÄÄ? @
pan
ÄÄ@ C
=>
ÄÄD F
pan
ÄÄG J
.
ÄÄJ K
id_parametro
ÄÄK W
==
ÄÄX Z&
newParametroActorNegocio
ÄÄ[ s
.
ÄÄs t
id_parametroÄÄt Ä
)ÄÄÄ Å
)ÄÄÅ Ç
{
ÅÅ 
_db
ÇÇ 
.
ÇÇ %
Parametro_actor_negocio
ÇÇ /
.
ÇÇ/ 0
Add
ÇÇ0 3
(
ÇÇ3 4&
newParametroActorNegocio
ÇÇ4 L
)
ÇÇL M
;
ÇÇM N
}
ÉÉ 
}
ÑÑ 
foreach
áá 
(
áá 
var
áá 
dbActorNegocioRol
áá *
in
áá+ -
dbActorNegocio
áá. <
.
áá< =
Actor_negocio_rol
áá= N
.
ááN O
ToList
ááO U
(
ááU V
)
ááV W
)
ááW X
{
àà 
if
ââ 
(
ââ 
!
ââ #
newIdsActorNegocioRol
ââ *
.
ââ* +
Any
ââ+ .
(
ââ. /
id
ââ/ 1
=>
ââ2 4
id
ââ5 7
==
ââ8 :
dbActorNegocioRol
ââ; L
.
ââL M
id_rol
ââM S
)
ââS T
)
ââT U
{
ää 
_db
ãã 
.
ãã 
Actor_negocio_rol
ãã )
.
ãã) *
Remove
ãã* 0
(
ãã0 1
dbActorNegocioRol
ãã1 B
)
ããB C
;
ããC D
}
åå 
}
çç 
foreach
êê 
(
êê 
var
êê 
newId
êê 
in
êê !#
newIdsActorNegocioRol
êê" 7
)
êê7 8
{
ëë 
if
íí 
(
íí 
!
íí 
dbActorNegocio
íí #
.
íí# $
Actor_negocio_rol
íí$ 5
.
íí5 6
Any
íí6 9
(
íí9 :
anr
íí: =
=>
íí> @
anr
ííA D
.
ííD E
id_rol
ííE K
==
ííL N
newId
ííO T
)
ííT U
)
ííU V
{
ìì 
dbActorNegocio
îî "
.
îî" #
Actor_negocio_rol
îî# 4
.
îî4 5
Add
îî5 8
(
îî8 9
new
îî9 <
Actor_negocio_rol
îî= N
(
îîN O
dbActorNegocio
îîO ]
.
îî] ^
id
îî^ `
,
îî` a
newId
îîb g
)
îîg h
)
îîh i
;
îîi j
}
ïï 
}
ññ 
return
óó 
Save
óó 
(
óó 
)
óó 
;
óó 
}
òò 	
public
†† 
IEnumerable
†† 
<
†† 
Clase_actor
†† &
>
††& '"
obtenerClasesDeActor
††( <
(
††< =
int
††= @
idTipoActor
††A L
)
††L M
{
°° 	
try
¢¢ 
{
££ 
return
§§ 
_db
§§ 
.
§§ 
Clase_actor
§§ &
.
§§& '
Where
§§' ,
(
§§, -
ca
§§- /
=>
§§0 2
ca
§§3 5
.
§§5 6
id_tipo_actor
§§6 C
==
§§D F
idTipoActor
§§G R
)
§§R S
.
§§S T
ToList
§§T Z
(
§§Z [
)
§§[ \
;
§§\ ]
}
•• 
catch
¶¶ 
(
¶¶ 
	Exception
¶¶ 
e
¶¶ 
)
¶¶ 
{
ßß 
throw
®® 
e
®® 
;
®® 
}
©© 
}
™™ 	
public
¨¨ 
IEnumerable
¨¨ 
<
¨¨ 
Estado_legal
¨¨ '
>
¨¨' (#
obtenerEstadosLegales
¨¨) >
(
¨¨> ?
int
¨¨? B
idTipoActor
¨¨C N
)
¨¨N O
{
≠≠ 	
try
ÆÆ 
{
ØØ 
return
∞∞ 
_db
∞∞ 
.
∞∞ 
Estado_legal
∞∞ '
.
∞∞' (
Where
∞∞( -
(
∞∞- .
el
∞∞. 0
=>
∞∞1 3
el
∞∞4 6
.
∞∞6 7
id_tipo_actor
∞∞7 D
==
∞∞E G
idTipoActor
∞∞H S
)
∞∞S T
.
∞∞T U
ToList
∞∞U [
(
∞∞[ \
)
∞∞\ ]
;
∞∞] ^
}
±± 
catch
≤≤ 
(
≤≤ 
	Exception
≤≤ 
e
≤≤ 
)
≤≤ 
{
≥≥ 
throw
¥¥ 
e
¥¥ 
;
¥¥ 
}
µµ 
}
∂∂ 	
public
∏∏ 
IEnumerable
∏∏ 
<
∏∏ 

Tipo_actor
∏∏ %
>
∏∏% &!
obtenerTiposDeActor
∏∏' :
(
∏∏: ;
)
∏∏; <
{
ππ 	
try
∫∫ 
{
ªª 
return
ºº 
_db
ºº 
.
ºº 

Tipo_actor
ºº %
;
ºº% &
}
ΩΩ 
catch
ææ 
(
ææ 
	Exception
ææ 
e
ææ 
)
ææ 
{
øø 
throw
¿¿ 
e
¿¿ 
;
¿¿ 
}
¡¡ 
}
¬¬ 	
public
ƒƒ 
string
ƒƒ &
obtenerDenominacionClase
ƒƒ .
(
ƒƒ. /
int
ƒƒ/ 2
idTipoActor
ƒƒ3 >
)
ƒƒ> ?
{
≈≈ 	
return
∆∆ 
_db
∆∆ 
.
∆∆ 

Tipo_actor
∆∆ !
.
∆∆! "
SingleOrDefault
∆∆" 1
(
∆∆1 2
ta
∆∆2 4
=>
∆∆5 7
ta
∆∆8 :
.
∆∆: ;
id
∆∆; =
==
∆∆> @
idTipoActor
∆∆A L
)
∆∆L M
.
∆∆M N#
denominacion_de_clase
∆∆N c
;
∆∆c d
}
«« 	
public
ÕÕ 
IEnumerable
ÕÕ 
<
ÕÕ 
Actor_negocio
ÕÕ (
>
ÕÕ( )%
ObtenerActoresDeNegocio
ÕÕ* A
(
ÕÕA B
int
ÕÕB E
[
ÕÕE F
]
ÕÕF G
idsActoresNegocio
ÕÕH Y
)
ÕÕY Z
{
ŒŒ 	
try
œœ 
{
–– 
return
—— 
_db
—— 
.
—— 
Actor_negocio
—— (
.
““ 
Include
““ 
(
““ 
an
““ 
=>
““  "
an
““# %
.
““% &
Actor
““& +
)
““+ ,
.
”” 
Include
”” 
(
”” 
an
”” 
=>
””  "
an
””# %
.
””% &
Actor
””& +
.
””+ ,
Detalle_maestro
””, ;
)
””; <
.
‘‘ 
Include
‘‘ 
(
‘‘ 
an
‘‘ 
=>
‘‘  "
an
‘‘# %
.
‘‘% &
Actor
‘‘& +
.
‘‘+ ,
	Direccion
‘‘, 5
)
‘‘5 6
.
’’ 
Include
’’ 
(
’’ 
an
’’ 
=>
’’  "
an
’’# %
.
’’% &
Actor
’’& +
.
’’+ ,
	Direccion
’’, 5
.
’’5 6
Select
’’6 <
(
’’< =
d
’’= >
=>
’’? A
d
’’B C
.
’’C D
Ubigeo
’’D J
)
’’J K
)
’’K L
.
÷÷ 
Where
÷÷ 
(
÷÷ 
an
÷÷ 
=>
÷÷  
idsActoresNegocio
÷÷! 2
.
÷÷2 3
Contains
÷÷3 ;
(
÷÷; <
an
÷÷< >
.
÷÷> ?
id
÷÷? A
)
÷÷A B
)
÷÷B C
;
÷÷C D
}
◊◊ 
catch
ÿÿ 
(
ÿÿ 
	Exception
ÿÿ 
e
ÿÿ 
)
ÿÿ 
{
ŸŸ 
throw
⁄⁄ 
e
⁄⁄ 
;
⁄⁄ 
}
€€ 
}
‹‹ 	
public
ﬂﬂ 
Modelo
ﬂﬂ 
.
ﬂﬂ 
Custom
ﬂﬂ 
.
ﬂﬂ .
 EstablecimientoComercialConLogo_
ﬂﬂ =$
ObtenerEstablecimiento
ﬂﬂ> T
(
ﬂﬂT U
int
ﬂﬂU X
id
ﬂﬂY [
)
ﬂﬂ[ \
{
‡‡ 	
try
·· 
{
‚‚ 
var
„„ 
	resultado
„„ 
=
„„ 
_db
„„  #
.
„„# $
Actor_negocio
„„$ 1
.
„„1 2
Where
„„2 7
(
„„7 8
an
„„8 :
=>
„„; =
an
„„> @
.
„„@ A
id
„„A C
==
„„D F
id
„„G I
)
„„I J
.
„„J K
Select
„„K Q
(
„„Q R
actorDeNegocio
„„R `
=>
„„a c
new
„„d g
{
‰‰ 
Establecimiento
ÂÂ #
=
ÂÂ$ %
new
ÂÂ& ).
 EstablecimientoComercialConLogo_
ÂÂ* J
{
ÊÊ 
Id
ÁÁ 
=
ÁÁ 
actorDeNegocio
ÁÁ +
.
ÁÁ+ ,
id
ÁÁ, .
,
ÁÁ. /
NombreComercial
ËË '
=
ËË( )
actorDeNegocio
ËË* 8
.
ËË8 9
Actor
ËË9 >
.
ËË> ?
segundo_nombre
ËË? M
,
ËËM N
IdActor
ÈÈ 
=
ÈÈ  !
actorDeNegocio
ÈÈ" 0
.
ÈÈ0 1
id_actor
ÈÈ1 9
,
ÈÈ9 :
NombreCorto
ÍÍ #
=
ÍÍ$ %
actorDeNegocio
ÍÍ& 4
.
ÍÍ4 5
Actor
ÍÍ5 :
.
ÍÍ: ;
tercer_nombre
ÍÍ; H
,
ÍÍH I 
NombreORazonSocial
ÎÎ *
=
ÎÎ+ ,
actorDeNegocio
ÎÎ- ;
.
ÎÎ; <
Actor
ÎÎ< A
.
ÎÎA B
primer_nombre
ÎÎB O
,
ÎÎO P
Codigo
ÏÏ 
=
ÏÏ  
actorDeNegocio
ÏÏ! /
.
ÏÏ/ 0
codigo_negocio
ÏÏ0 >
,
ÏÏ> ?&
NumeroDocumentoIdentidad
ÌÌ 0
=
ÌÌ1 2
actorDeNegocio
ÌÌ3 A
.
ÌÌA B
Actor
ÌÌB G
.
ÌÌG H(
numero_documento_identidad
ÌÌH b
,
ÌÌb c$
TipoDocumentoIdentidad
ÓÓ .
=
ÓÓ/ 0
new
ÓÓ1 4
ItemGenerico
ÓÓ5 A
(
ÓÓA B
)
ÓÓB C
{
ÓÓD E
Id
ÓÓF H
=
ÓÓI J
actorDeNegocio
ÓÓK Y
.
ÓÓY Z
Actor
ÓÓZ _
.
ÓÓ_ `$
id_documento_identidad
ÓÓ` v
,
ÓÓv w
Nombre
ÓÓx ~
=ÓÓ Ä
actorDeNegocioÓÓÅ è
.ÓÓè ê
ActorÓÓê ï
.ÓÓï ñ
Detalle_maestroÓÓñ •
.ÓÓ• ¶
nombreÓÓ¶ ¨
,ÓÓ¨ ≠
CodigoÓÓÆ ¥
=ÓÓµ ∂
actorDeNegocioÓÓ∑ ≈
.ÓÓ≈ ∆
ActorÓÓ∆ À
.ÓÓÀ Ã
Detalle_maestroÓÓÃ €
.ÓÓ€ ‹
codigoÓÓ‹ ‚
,ÓÓ‚ „
ValorÓÓ‰ È
=ÓÓÍ Î
actorDeNegocioÓÓÏ ˙
.ÓÓ˙ ˚
ActorÓÓ˚ Ä
.ÓÓÄ Å
Detalle_maestroÓÓÅ ê
.ÓÓê ë
valorÓÓë ñ
}ÓÓó ò
,ÓÓò ô
TipoPersona
ÔÔ #
=
ÔÔ$ %
new
ÔÔ& )
ItemGenerico
ÔÔ* 6
(
ÔÔ6 7
)
ÔÔ7 8
{
ÔÔ9 :
Id
ÔÔ; =
=
ÔÔ> ?
actorDeNegocio
ÔÔ@ N
.
ÔÔN O
Actor
ÔÔO T
.
ÔÔT U
id_tipo_actor
ÔÔU b
,
ÔÔb c
Nombre
ÔÔd j
=
ÔÔk l
actorDeNegocio
ÔÔm {
.
ÔÔ{ |
ActorÔÔ| Å
.ÔÔÅ Ç

Tipo_actorÔÔÇ å
.ÔÔå ç
nombreÔÔç ì
,ÔÔì î
CodigoÔÔï õ
=ÔÔú ù
$strÔÔû †
,ÔÔ† °
ValorÔÔ¢ ß
=ÔÔ® ©
$strÔÔ™ ¨
}ÔÔ≠ Æ
,ÔÔÆ Ø
DomicilioFiscal
 '
=
( )
actorDeNegocio
* 8
.
8 9
Actor
9 >
.
> ?
	Direccion
? H
.
H I
Select
I O
(
O P
d
P Q
=>
R T
new
U X

Direccion_
Y c
(
c d
)
d e
{
f g
Ubigeo
h n
=
o p
(
q r
new
r u
ItemGenericov Ç
(Ç É
)É Ñ
{Ö Ü
Idá â
=ä ã
då ç
.ç é
Ubigeoé î
.î ï
idï ó
,ó ò
Nombreô ü
=† °
d¢ £
.£ §
Ubigeo§ ™
.™ ´!
descripcion_corta´ º
,º Ω
Codigoæ ƒ
=≈ ∆
$str« …
,…  
ValorÀ –
=— “
$str” ’
}÷ ◊
)◊ ÿ
,ÿ Ÿ
Id⁄ ‹
=› ﬁ
dﬂ ‡
.‡ ·
id· „
,„ ‰
DetalleÂ Ï
=Ì Ó
dÔ 
. Ò
detalleÒ ¯
}˘ ˙
)˙ ˚
.˚ ¸
FirstOrDefault¸ ä
(ä ã
)ã å
,å ç
	EsVigente
ÒÒ !
=
ÒÒ" #
actorDeNegocio
ÒÒ$ 2
.
ÒÒ2 3

es_vigente
ÒÒ3 =
,
ÒÒ= >
Correo
ÚÚ 
=
ÚÚ  
actorDeNegocio
ÚÚ! /
.
ÚÚ/ 0
Actor
ÚÚ0 5
.
ÚÚ5 6
correo
ÚÚ6 <
,
ÚÚ< =%
InformacionPublicitaria
ÛÛ /
=
ÛÛ0 1
actorDeNegocio
ÛÛ2 @
.
ÛÛ@ A
Actor
ÛÛA F
.
ÛÛF G(
informacion_multiproposito
ÛÛG a
!=
ÛÛb d
null
ÛÛe i
?
ÛÛj k
actorDeNegocio
ÛÛl z
.
ÛÛz {
ActorÛÛ{ Ä
.ÛÛÄ Å*
informacion_multipropositoÛÛÅ õ
:ÛÛú ù
$strÛÛû †
,ÛÛ† °
Telefono
ÙÙ  
=
ÙÙ! "
actorDeNegocio
ÙÙ# 1
.
ÙÙ1 2
Actor
ÙÙ2 7
.
ÙÙ7 8
telefono
ÙÙ8 @
,
ÙÙ@ A
NombreInterno
ıı %
=
ıı& '
actorDeNegocio
ıı( 6
.
ıı6 7
Actor
ıı7 <
.
ıı< =
tercer_nombre
ıı= J
,
ııJ K
EsSede
ˆˆ 
=
ˆˆ  
actorDeNegocio
ˆˆ! /
.
ˆˆ/ 0
id_rol
ˆˆ0 6
==
ˆˆ7 9
ActorSettings
ˆˆ: G
.
ˆˆG H
Default
ˆˆH O
.
ˆˆO P
	IdRolSede
ˆˆP Y
,
ˆˆY Z

EsSucursal
˜˜ "
=
˜˜# $
actorDeNegocio
˜˜% 3
.
˜˜3 4
id_rol
˜˜4 :
==
˜˜; =
ActorSettings
˜˜> K
.
˜˜K L
Default
˜˜L S
.
˜˜S T
IdRolSucursal
˜˜T a
,
˜˜a b
Logo
¯¯ 
=
¯¯ 
actorDeNegocio
¯¯ -
.
¯¯- .
Actor
¯¯. 3
.
¯¯3 4
Foto
¯¯4 8
.
¯¯8 9
imagen
¯¯9 ?
,
¯¯? @
JsonExtension
˘˘ %
=
˘˘& '
actorDeNegocio
˘˘( 6
.
˘˘6 7
extension_json
˘˘7 E
}
˙˙ 
,
˙˙ 
ParametroPrecio
˚˚ #
=
˚˚$ %
actorDeNegocio
˚˚& 4
.
˚˚4 5%
Parametro_actor_negocio
˚˚5 L
.
˚˚L M
FirstOrDefault
˚˚M [
(
˚˚[ \
pcn
˚˚\ _
=>
˚˚` b
pcn
˚˚c f
.
˚˚f g
id_parametro
˚˚g s
==
˚˚t v
MaestroSettings˚˚w Ü
.˚˚Ü á
Default˚˚á é
.˚˚é èO
?IdDetalleMaestroParametroIdCentroDeAtencionParaObtencionPrecios˚˚è Œ
)˚˚Œ œ
,˚˚œ –
ParametroStock
¸¸ "
=
¸¸# $
actorDeNegocio
¸¸% 3
.
¸¸3 4%
Parametro_actor_negocio
¸¸4 K
.
¸¸K L
FirstOrDefault
¸¸L Z
(
¸¸Z [
pcn
¸¸[ ^
=>
¸¸_ a
pcn
¸¸b e
.
¸¸e f
id_parametro
¸¸f r
==
¸¸s u
MaestroSettings¸¸v Ö
.¸¸Ö Ü
Default¸¸Ü ç
.¸¸ç éM
=IdDetalleMaestroParametroIdCentroDeAtencionParaObtencionStock¸¸é À
)¸¸À Ã
,¸¸Ã Õ
DomicilioFiscal
˝˝ #
=
˝˝$ %
actorDeNegocio
˝˝& 4
.
˝˝4 5
Actor
˝˝5 :
.
˝˝: ;
	Direccion
˝˝; D
.
˝˝D E
FirstOrDefault
˝˝E S
(
˝˝S T
)
˝˝T U
,
˝˝U V
IdRol
˛˛ 
=
˛˛ 
actorDeNegocio
˛˛ *
.
˛˛* +
id_rol
˛˛+ 1
}
ÄÄ 
)
ÄÄ 
.
ÄÄ 
FirstOrDefault
ÄÄ !
(
ÄÄ! "
)
ÄÄ" #
;
ÄÄ# $
var
ÇÇ 
establecimiento
ÇÇ #
=
ÇÇ$ %
	resultado
ÇÇ& /
.
ÇÇ/ 0
Establecimiento
ÇÇ0 ?
;
ÇÇ? @
establecimiento
ÉÉ 
.
ÉÉ  
EsSede
ÉÉ  &
=
ÉÉ' (
	resultado
ÉÉ) 2
.
ÉÉ2 3
IdRol
ÉÉ3 8
==
ÉÉ9 ;
ActorSettings
ÉÉ< I
.
ÉÉI J
Default
ÉÉJ Q
.
ÉÉQ R
	IdRolSede
ÉÉR [
;
ÉÉ[ \
establecimiento
ÑÑ 
.
ÑÑ  

EsSucursal
ÑÑ  *
=
ÑÑ+ ,
	resultado
ÑÑ- 6
.
ÑÑ6 7
IdRol
ÑÑ7 <
==
ÑÑ= ?
ActorSettings
ÑÑ@ M
.
ÑÑM N
Default
ÑÑN U
.
ÑÑU V
IdRolSucursal
ÑÑV c
;
ÑÑc d
establecimiento
ÖÖ 
.
ÖÖ  6
(IdCentroDeAtencionParaObtencionDePrecios
ÖÖ  H
=
ÖÖI J
	resultado
ÖÖK T
.
ÖÖT U
ParametroPrecio
ÖÖU d
!=
ÖÖe g
null
ÖÖh l
?
ÖÖm n
(
ÖÖo p
int
ÖÖp s
?
ÖÖs t
)
ÖÖt u
System
ÖÖu {
.
ÖÖ{ |
ConvertÖÖ| É
.ÖÖÉ Ñ
ToInt32ÖÖÑ ã
(ÖÖã å
	resultadoÖÖå ï
.ÖÖï ñ
ParametroPrecioÖÖñ •
.ÖÖ• ¶
valorÖÖ¶ ´
)ÖÖ´ ¨
:ÖÖ≠ Æ
nullÖÖØ ≥
;ÖÖ≥ ¥
establecimiento
ÜÜ 
.
ÜÜ  4
&IdCentroDeAtencionParaObtencionDeStock
ÜÜ  F
=
ÜÜG H
	resultado
ÜÜI R
.
ÜÜR S
ParametroStock
ÜÜS a
!=
ÜÜb d
null
ÜÜe i
?
ÜÜj k
(
ÜÜl m
int
ÜÜm p
?
ÜÜp q
)
ÜÜq r
System
ÜÜr x
.
ÜÜx y
ConvertÜÜy Ä
.ÜÜÄ Å
ToInt32ÜÜÅ à
(ÜÜà â
	resultadoÜÜâ í
.ÜÜí ì
ParametroStockÜÜì °
.ÜÜ° ¢
valorÜÜ¢ ß
)ÜÜß ®
:ÜÜ© ™
nullÜÜ´ Ø
;ÜÜØ ∞
return
àà 
establecimiento
àà &
;
àà& '
}
ââ 
catch
ää 
(
ää 
	Exception
ää 
e
ää 
)
ää 
{
ãã 
throw
åå 
new
åå 
DatosException
åå (
(
åå( )
$str
åå) T
,
ååT U
e
ååV W
)
ååW X
;
ååX Y
}
çç 
}
éé 	
public
ëë 
Actor_negocio
ëë Y
KObtenerActorDeNegocioInclusiveDireccionesYTipoDocumentoIdentidadYParametros
ëë h
(
ëëh i
int
ëëi l
id
ëëm o
)
ëëo p
{
íí 	
try
ìì 
{
îî 
return
ïï 
_db
ïï 
.
ïï 
Actor_negocio
ïï (
.
ññ 
Include
ññ 
(
ññ 
an
ññ 
=>
ññ  "
an
ññ# %
.
ññ% &
Actor
ññ& +
)
ññ+ ,
.
óó 
Include
óó 
(
óó 
an
óó 
=>
óó  "
an
óó# %
.
óó% &
Actor
óó& +
.
óó+ ,

Tipo_actor
óó, 6
)
óó6 7
.
òò 
Include
òò 
(
òò 
an
òò 
=>
òò  "
an
òò# %
.
òò% &
Actor
òò& +
.
òò+ ,
Detalle_maestro
òò, ;
)
òò; <
.
ôô 
Include
ôô 
(
ôô 
an
ôô 
=>
ôô  "
an
ôô# %
.
ôô% &
Actor
ôô& +
.
ôô+ ,
Detalle_maestro1
ôô, <
)
ôô< =
.
öö 
Include
öö 
(
öö 
an
öö 
=>
öö  "
an
öö# %
.
öö% &
Actor
öö& +
.
öö+ ,
	Direccion
öö, 5
)
öö5 6
.
õõ 
Include
õõ 
(
õõ 
an
õõ 
=>
õõ  "
an
õõ# %
.
õõ% &
Actor
õõ& +
.
õõ+ ,
	Direccion
õõ, 5
.
õõ5 6
Select
õõ6 <
(
õõ< =
d
õõ= >
=>
õõ? A
d
õõB C
.
õõC D
Ubigeo
õõD J
)
õõJ K
)
õõK L
.
úú 
Include
úú 
(
úú 
an
úú 
=>
úú  "
an
úú# %
.
úú% &
Actor
úú& +
.
úú+ ,
Foto
úú, 0
)
úú0 1
.
ùù 
Include
ùù 
(
ùù 
an
ùù 
=>
ùù  "
an
ùù# %
.
ùù% &%
Parametro_actor_negocio
ùù& =
)
ùù= >
.
ûû 
SingleOrDefault
ûû $
(
ûû$ %
an
ûû% '
=>
ûû( *
an
ûû+ -
.
ûû- .
id
ûû. 0
==
ûû1 3
id
ûû4 6
)
ûû6 7
;
ûû7 8
}
üü 
catch
†† 
(
†† 
	Exception
†† 
e
†† 
)
†† 
{
°° 
throw
¢¢ 
e
¢¢ 
;
¢¢ 
}
££ 
}
§§ 	
public
©© 
IEnumerable
©© 
<
©© 
Actor_negocio
©© (
>
©©( )?
1obtenerActoresDeNegocioPorRolInclusiveActorYRoles
©©* [
(
©©[ \
int
©©\ _
idRol
©©` e
)
©©e f
{
™™ 	
try
´´ 
{
¨¨ 
return
≠≠ 
_db
≠≠ 
.
≠≠ 
Actor_negocio
≠≠ (
.
≠≠( )
Include
≠≠) 0
(
≠≠0 1
an
≠≠1 3
=>
≠≠4 6
an
≠≠7 9
.
≠≠9 :
Actor
≠≠: ?
)
≠≠? @
.
≠≠@ A
Include
≠≠A H
(
≠≠H I
an
≠≠I K
=>
≠≠L N
an
≠≠O Q
.
≠≠Q R
Actor
≠≠R W
.
≠≠W X

Tipo_actor
≠≠X b
)
≠≠b c
.
≠≠c d
Include
ÆÆ 
(
ÆÆ 
an
ÆÆ 
=>
ÆÆ 
an
ÆÆ  
.
ÆÆ  !
Actor
ÆÆ! &
.
ÆÆ& '
Detalle_maestro
ÆÆ' 6
)
ÆÆ6 7
.
ÆÆ7 8
Include
ÆÆ8 ?
(
ÆÆ? @
an
ÆÆ@ B
=>
ÆÆC E
an
ÆÆF H
.
ÆÆH I%
Parametro_actor_negocio
ÆÆI `
)
ÆÆ` a
.
ÆÆa b
Include
ØØ 
(
ØØ 
an
ØØ 
=>
ØØ 
an
ØØ  
.
ØØ  !
Actor_negocio_rol
ØØ! 2
.
ØØ2 3
Select
ØØ3 9
(
ØØ9 :
anr
ØØ: =
=>
ØØ> @
anr
ØØA D
.
ØØD E
Rol
ØØE H
)
ØØH I
)
ØØI J
.
ØØJ K
Include
ØØK R
(
ØØR S
an
ØØS U
=>
ØØV X
an
ØØY [
.
ØØ[ \
Rol
ØØ\ _
)
ØØ_ `
.
ØØ` a
Where
ØØa f
(
ØØf g
an
ØØg i
=>
ØØj l
an
ØØm o
.
ØØo p
id_rol
ØØp v
==
ØØw y
idRol
ØØz 
)ØØ Ä
;ØØÄ Å
}
∞∞ 
catch
±± 
(
±± 
	Exception
±± 
e
±± 
)
±± 
{
≤≤ 
throw
≥≥ 
e
≥≥ 
;
≥≥ 
}
¥¥ 
}
µµ 	
public
∑∑ 
async
∑∑ 
Task
∑∑ 
<
∑∑ 
IEnumerable
∑∑ %
<
∑∑% &
Actor_negocio
∑∑& 3
>
∑∑3 4
>
∑∑4 53
%ObtenerActoresDeNegocioPorRolVigentes
∑∑6 [
(
∑∑[ \
int
∑∑\ _
idRol
∑∑` e
)
∑∑e f
{
∏∏ 	
try
ππ 
{
∫∫ 
var
ªª 
_dbAsync
ªª 
=
ªª 
new
ªª "
SigescomEntities
ªª# 3
(
ªª3 4
)
ªª4 5
;
ªª5 6
return
ºº 
(
ºº 
await
ºº 
_dbAsync
ºº &
.
ºº& '
Actor_negocio
ºº' 4
.
ºº4 5
Where
ºº5 :
(
ºº: ;
an
ºº; =
=>
ºº> @
an
ººA C
.
ººC D
id_rol
ººD J
==
ººK M
idRol
ººN S
&&
ººT V
an
ººW Y
.
ººY Z

es_vigente
ººZ d
)
ººd e
.
ººe f
ToListAsync
ººf q
(
ººq r
)
ººr s
)
ººs t
;
ººt u
}
ΩΩ 
catch
ææ 
(
ææ 
	Exception
ææ 
e
ææ 
)
ææ 
{
øø 
throw
¿¿ 
e
¿¿ 
;
¿¿ 
}
¡¡ 
}
¬¬ 	
public
ƒƒ 
async
ƒƒ 
Task
ƒƒ 
<
ƒƒ 
IEnumerable
ƒƒ %
<
ƒƒ% &
Actor_negocio
ƒƒ& 3
>
ƒƒ3 4
>
ƒƒ4 53
%ObtenerActoresDeNegocioPorRolVigentes
ƒƒ6 [
(
ƒƒ[ \
int
ƒƒ\ _
idRol
ƒƒ` e
,
ƒƒe f
int
ƒƒg j!
idActorNegocioPadre
ƒƒk ~
)
ƒƒ~ 
{
≈≈ 	
try
∆∆ 
{
«« 
var
»» 
_dbAsync
»» 
=
»» 
new
»» "
SigescomEntities
»»# 3
(
»»3 4
)
»»4 5
;
»»5 6
return
…… 
(
…… 
await
…… 
_dbAsync
…… &
.
……& '
Actor_negocio
……' 4
.
……4 5
Where
……5 :
(
……: ;
an
……; =
=>
……> @
an
……A C
.
……C D
id_rol
……D J
==
……K M
idRol
……N S
&&
……T V
an
……W Y
.
……Y Z

es_vigente
……Z d
&&
……e g
an
……h j
.
……j k%
id_actor_negocio_padre……k Å
==……Ç Ñ#
idActorNegocioPadre……Ö ò
)……ò ô
.……ô ö
ToListAsync……ö •
(……• ¶
)……¶ ß
)……ß ®
;……® ©
}
   
catch
ÀÀ 
(
ÀÀ 
	Exception
ÀÀ 
e
ÀÀ 
)
ÀÀ 
{
ÃÃ 
throw
ÕÕ 
e
ÕÕ 
;
ÕÕ 
}
ŒŒ 
}
œœ 	
public
—— 
Actor_negocio
—— #
obtenerActorDeNegocio
—— 2
(
——2 3
int
——3 6
idActorNegocio
——7 E
,
——E F
int
——G J
idRol
——K P
)
——P Q
{
““ 	
try
”” 
{
‘‘ 
return
’’ 
_db
’’ 
.
’’ 
Actor_negocio
’’ (
.
÷÷ 
Include
÷÷ 
(
÷÷ 
an
÷÷ 
=>
÷÷  "
an
÷÷# %
.
÷÷% &
Actor_negocio_rol
÷÷& 7
)
÷÷7 8
.
◊◊ 
Include
◊◊ 
(
◊◊ 
an
◊◊ 
=>
◊◊  "
an
◊◊# %
.
◊◊% &
Actor
◊◊& +
)
◊◊+ ,
.
ÿÿ 
Include
ÿÿ 
(
ÿÿ 
an
ÿÿ 
=>
ÿÿ  "
an
ÿÿ# %
.
ÿÿ% &
Actor
ÿÿ& +
.
ÿÿ+ ,
Actor_negocio
ÿÿ, 9
)
ÿÿ9 :
.
ŸŸ 
Include
ŸŸ 
(
ŸŸ 
an
ŸŸ 
=>
ŸŸ  "
an
ŸŸ# %
.
ŸŸ% &
Actor
ŸŸ& +
.
ŸŸ+ ,
	Direccion
ŸŸ, 5
)
ŸŸ5 6
.
⁄⁄ 
SingleOrDefault
⁄⁄ $
(
⁄⁄$ %
an
⁄⁄% '
=>
⁄⁄( *
an
⁄⁄+ -
.
⁄⁄- .
id
⁄⁄. 0
==
⁄⁄1 3
idActorNegocio
⁄⁄4 B
&&
⁄⁄C E
an
⁄⁄F H
.
⁄⁄H I
id_rol
⁄⁄I O
==
⁄⁄P R
idRol
⁄⁄S X
)
⁄⁄X Y
;
⁄⁄Y Z
}
€€ 
catch
‹‹ 
(
‹‹ 
	Exception
‹‹ 
e
‹‹ 
)
‹‹ 
{
›› 
throw
ﬁﬁ 
e
ﬁﬁ 
;
ﬁﬁ 
}
ﬂﬂ 
}
‡‡ 	
public
ÂÂ 
Actor_negocio
ÂÂ *
ObtenerActorDeNegocioVigente
ÂÂ 9
(
ÂÂ9 :
int
ÂÂ: =
idActorNegocio
ÂÂ> L
,
ÂÂL M
int
ÂÂN Q
idRol
ÂÂR W
)
ÂÂW X
{
ÊÊ 	
try
ÁÁ 
{
ËË 
Actor_negocio
ÈÈ 
actorNegocio
ÈÈ *
=
ÈÈ+ ,
_db
ÈÈ- 0
.
ÈÈ0 1
Actor_negocio
ÈÈ1 >
.
ÈÈ> ?
SingleOrDefault
ÈÈ? N
(
ÈÈN O
an
ÈÈO Q
=>
ÈÈR T
an
ÈÈU W
.
ÈÈW X
id
ÈÈX Z
==
ÈÈ[ ]
idActorNegocio
ÈÈ^ l
)
ÈÈl m
;
ÈÈm n
return
ÍÍ 
_db
ÍÍ 
.
ÍÍ 
Actor_negocio
ÍÍ (
.
ÍÍ( )
SingleOrDefault
ÍÍ) 8
(
ÍÍ8 9
an
ÍÍ9 ;
=>
ÍÍ< >
an
ÍÍ? A
.
ÍÍA B
id_actor
ÍÍB J
==
ÍÍK M
actorNegocio
ÍÍN Z
.
ÍÍZ [
Actor
ÍÍ[ `
.
ÍÍ` a
id
ÍÍa c
&&
ÍÍd f
an
ÍÍg i
.
ÍÍi j
id_rol
ÍÍj p
==
ÍÍq s
idRol
ÍÍt y
&&
ÍÍz |
an
ÍÍ} 
.ÍÍ Ä

es_vigenteÍÍÄ ä
)ÍÍä ã
;ÍÍã å
}
ÎÎ 
catch
ÏÏ 
(
ÏÏ 
	Exception
ÏÏ 
e
ÏÏ 
)
ÏÏ 
{
ÌÌ 
throw
ÓÓ 
e
ÓÓ 
;
ÓÓ 
}
ÔÔ 
}
 	
public
ıı 
OperationResult
ıı !
establecerIdUsuario
ıı 2
(
ıı2 3
string
ıı3 9

idUdsuario
ıı: D
,
ııD E
int
ııF I
idActorNegocio
ııJ X
)
ııX Y
{
ˆˆ 	
try
˜˜ 
{
¯¯ 
var
˘˘ 
dbActorNegocio
˘˘ "
=
˘˘# $
_db
˘˘% (
.
˘˘( )
Actor_negocio
˘˘) 6
.
˘˘6 7
Single
˘˘7 =
(
˘˘= >
an
˘˘> @
=>
˘˘A C
an
˘˘D F
.
˘˘F G
id
˘˘G I
==
˘˘J L
idActorNegocio
˘˘M [
)
˘˘[ \
;
˘˘\ ]
dbActorNegocio
˙˙ 
.
˙˙ 

id_usuario
˙˙ )
=
˙˙* +

idUdsuario
˙˙, 6
;
˙˙6 7
return
˚˚ 
Save
˚˚ 
(
˚˚ 
)
˚˚ 
;
˚˚ 
}
¸¸ 
catch
˝˝ 
(
˝˝ 
	Exception
˝˝ 
e
˝˝ 
)
˝˝ 
{
˛˛ 
return
ˇˇ 
new
ˇˇ 
OperationResult
ˇˇ *
(
ˇˇ* +
e
ˇˇ+ ,
,
ˇˇ, -
$str
ˇˇ. d
)
ˇˇd e
;
ˇˇe f
}
ÄÄ 
}
ÅÅ 	
public
ÉÉ 
IEnumerable
ÉÉ 
<
ÉÉ 
Actor_negocio
ÉÉ (
>
ÉÉ( )5
'obtenerActorDeNegocioVigentesAhoraEnRol
ÉÉ* Q
(
ÉÉQ R
int
ÉÉR U
idRolActorNegocio
ÉÉV g
,
ÉÉg h
int
ÉÉi l
idRolEn
ÉÉm t
)
ÉÉt u
{
ÑÑ 	
return
ÖÖ 
_db
ÖÖ 
.
ÖÖ 
Actor_negocio_rol
ÖÖ (
.
ÖÖ( )
Include
ÜÜ 
(
ÜÜ 
anr
ÜÜ 
=>
ÜÜ 
anr
ÜÜ "
.
ÜÜ" #
Rol
ÜÜ# &
)
ÜÜ& '
.
ÜÜ' (
Include
áá 
(
áá 
anr
áá 
=>
áá 
anr
áá "
.
áá" #
Actor_negocio
áá# 0
)
áá0 1
.
áá1 2
Include
àà 
(
àà 
anr
àà 
=>
àà 
anr
àà "
.
àà" #
Actor_negocio
àà# 0
.
àà0 1
Actor
àà1 6
)
àà6 7
.
àà7 8
Where
ââ 
(
ââ 
anr
ââ 
=>
ââ 
anr
ââ  
.
ââ  !
Actor_negocio
ââ! .
.
ââ. /
id_rol
ââ/ 5
==
ââ6 8
idRolActorNegocio
ââ9 J
&&
ââK M
anr
ââN Q
.
ââQ R
Actor_negocio
ââR _
.
ââ_ `
fecha_inicio
ââ` l
<=
ââm o
SqlFunctions
ââp |
.
ââ| }
GetDateââ} Ñ
(ââÑ Ö
)ââÖ Ü
&&ââá â
anrââä ç
.ââç é
Actor_negocioââé õ
.ââõ ú
	fecha_finââú •
>=ââ¶ ®
SqlFunctionsââ© µ
.ââµ ∂
GetDateââ∂ Ω
(ââΩ æ
)ââæ ø
&&ââ¿ ¬
anrââ√ ∆
.ââ∆ «
id_rolââ« Õ
==ââŒ –
idRolEnââ— ÿ
)ââÿ Ÿ
.ââŸ ⁄
Selectââ⁄ ‡
(ââ‡ ·
anrââ· ‰
=>ââÂ Á
anrââË Î
.ââÎ Ï
Actor_negocioââÏ ˘
)ââ˘ ˙
;ââ˙ ˚
}
ää 	
public
åå 
IEnumerable
åå 
<
åå 
Actor_negocio
åå (
>
åå( )7
)obtenerActorDeNegocioVigentesAhoraEnRoles
åå* S
(
ååS T
int
ååT W
idRolActorNegocio
ååX i
,
ååi j
int
ååk n
[
åån o
]
ååo p

idsRolesEn
ååq {
)
åå{ |
{
çç 	
return
éé 
_db
éé 
.
éé 
Actor_negocio_rol
éé (
.
éé( )
Include
èè 
(
èè 
anr
èè 
=>
èè 
anr
èè "
.
èè" #
Rol
èè# &
)
èè& '
.
èè' (
Include
êê 
(
êê 
anr
êê 
=>
êê 
anr
êê "
.
êê" #
Actor_negocio
êê# 0
)
êê0 1
.
êê1 2
Include
ëë 
(
ëë 
anr
ëë 
=>
ëë 
anr
ëë "
.
ëë" #
Actor_negocio
ëë# 0
.
ëë0 1
Actor
ëë1 6
)
ëë6 7
.
ëë7 8
Where
íí 
(
íí 
anr
íí 
=>
íí 
anr
íí  
.
íí  !
Actor_negocio
íí! .
.
íí. /
id_rol
íí/ 5
==
íí6 8
idRolActorNegocio
íí9 J
&&
ííK M
anr
ííN Q
.
ííQ R
Actor_negocio
ííR _
.
íí_ `
fecha_inicio
íí` l
<=
íím o
SqlFunctions
ííp |
.
íí| }
GetDateíí} Ñ
(ííÑ Ö
)ííÖ Ü
&&ííá â
anr
ìì 
.
ìì 
Actor_negocio
ìì !
.
ìì! "
	fecha_fin
ìì" +
>=
ìì, .
SqlFunctions
ìì/ ;
.
ìì; <
GetDate
ìì< C
(
ììC D
)
ììD E
&&
ììF H

idsRolesEn
ììI S
.
ììS T
Contains
ììT \
(
ìì\ ]
anr
ìì] `
.
ìì` a
id_rol
ììa g
)
ììg h
)
ììh i
.
ììi j
Select
ììj p
(
ììp q
anr
ììq t
=>
ììu w
anr
ììx {
.
ìì{ |
Actor_negocioìì| â
)ììâ ä
;ììä ã
}
ïï 	
public
ûû 
IEnumerable
ûû 
<
ûû 
Actor_negocio
ûû (
>
ûû( )C
5obtenerActorDeNegocioIncluidoActorPorRolVigentesAhora
ûû* _
(
ûû_ `
int
ûû` c
idRol
ûûd i
)
ûûi j
{
üü 	
return
†† 
_db
†† 
.
†† 
Actor_negocio
†† $
.
††$ %
Include
°° 
(
°° 
an
°° 
=>
°° 
an
°°  
.
°°  !
Actor
°°! &
)
°°& '
.
°°' (
Where
¢¢ 
(
¢¢ 
an
¢¢ 
=>
¢¢ 
an
¢¢ 
.
¢¢ 
id_rol
¢¢ %
==
¢¢& (
idRol
¢¢) .
&&
¢¢/ 1
an
¢¢2 4
.
¢¢4 5

es_vigente
¢¢5 ?
==
¢¢@ B
true
¢¢C G
)
¢¢G H
;
¢¢H I
}
§§ 	
public
ÆÆ 
IEnumerable
ÆÆ 
<
ÆÆ 
Actor_negocio
ÆÆ (
>
ÆÆ( ))
obtenerActorDeNegocioPorRol
ÆÆ* E
(
ÆÆE F
int
ÆÆF I
idRol
ÆÆJ O
)
ÆÆO P
{
ØØ 	
return
∞∞ 
_db
∞∞ 
.
∞∞ 
Actor_negocio
∞∞ $
.
∞∞$ %
Include
∞∞% ,
(
∞∞, -
an
∞∞- /
=>
∞∞0 2
an
∞∞3 5
.
∞∞5 6
Actor
∞∞6 ;
)
∞∞; <
.
∞∞< =
Include
∞∞= D
(
∞∞D E
an
∞∞E G
=>
∞∞H J
an
∞∞K M
.
∞∞M N
Actor
∞∞N S
.
∞∞S T

Tipo_actor
∞∞T ^
)
∞∞^ _
.
∞∞_ `
Include
±± 
(
±± 
an
±± 
=>
±± 
an
±±  
.
±±  !
Actor
±±! &
.
±±& '
Detalle_maestro
±±' 6
)
±±6 7
.
±±7 8
Include
±±8 ?
(
±±? @
an
±±@ B
=>
±±C E
an
±±F H
.
±±H I%
Parametro_actor_negocio
±±I `
)
±±` a
.
±±a b
Include
≤≤ 
(
≤≤ 
an
≤≤ 
=>
≤≤ 
an
≤≤  
.
≤≤  !
Actor_negocio_rol
≤≤! 2
.
≤≤2 3
Select
≤≤3 9
(
≤≤9 :
anr
≤≤: =
=>
≤≤> @
anr
≤≤A D
.
≤≤D E
Rol
≤≤E H
)
≤≤H I
)
≤≤I J
.
≤≤J K
Include
≤≤K R
(
≤≤R S
an
≤≤S U
=>
≤≤V X
an
≤≤Y [
.
≤≤[ \
Rol
≤≤\ _
)
≤≤_ `
.
≥≥ 
Where
≥≥ 
(
≥≥ 
an
≥≥ 
=>
≥≥ 
an
≥≥ 
.
≥≥  
id_rol
≥≥  &
==
≥≥' )
idRol
≥≥* /
)
≥≥/ 0
;
≥≥0 1
}
¥¥ 	
public
∂∂ 
IEnumerable
∂∂ 
<
∂∂ 
Actor_negocio
∂∂ (
>
∂∂( ))
obtenerActorDeNegocioPorRol
∂∂* E
(
∂∂E F
int
∂∂F I
idRol
∂∂J O
,
∂∂O P
DateTime
∂∂Q Y
fechaVigencia
∂∂Z g
)
∂∂g h
{
∑∑ 	
return
∏∏ 
_db
∏∏ 
.
∏∏ 
Actor_negocio
∏∏ $
.
ππ 
Where
ππ 
(
ππ 
an
ππ 
=>
ππ 
an
ππ 
.
ππ  
id_rol
ππ  &
==
ππ' )
idRol
ππ* /
&&
ππ0 2
an
ππ3 5
.
ππ5 6
fecha_inicio
ππ6 B
<=
ππC E
fechaVigencia
ππF S
&&
ππT V
an
ππW Y
.
ππY Z
	fecha_fin
ππZ c
>=
ππd f
fechaVigencia
ππg t
)
ππt u
;
ππu v
}
∫∫ 	
public
¬¬ 
IEnumerable
¬¬ 
<
¬¬ 
Actor_negocio
¬¬ (
>
¬¬( ),
ObtenerActorDeNegocioPrincipal
¬¬* H
(
¬¬H I
int
¬¬I L
idParentRol
¬¬M X
,
¬¬X Y
int
¬¬Z ]
idRol
¬¬^ c
,
¬¬c d
bool
¬¬e i
	esVigente
¬¬j s
)
¬¬s t
{
√√ 	
return
ƒƒ 
_db
ƒƒ 
.
ƒƒ 
Actor_negocio
ƒƒ $
.
ƒƒ$ %
Include
ƒƒ% ,
(
ƒƒ, -
an
ƒƒ- /
=>
ƒƒ0 2
an
ƒƒ3 5
.
ƒƒ5 6
Actor
ƒƒ6 ;
)
ƒƒ; <
.
ƒƒ< =
Include
≈≈ 
(
≈≈ 
an
≈≈ 
=>
≈≈ 
an
≈≈  
.
≈≈  !
Actor
≈≈! &
.
≈≈& '

Tipo_actor
≈≈' 1
)
≈≈1 2
.
≈≈2 3
Include
∆∆ 
(
∆∆ 
an
∆∆ 
=>
∆∆ 
an
∆∆  
.
∆∆  !
Actor
∆∆! &
.
∆∆& '
Detalle_maestro
∆∆' 6
)
∆∆6 7
.
∆∆7 8
Include
«« 
(
«« 
an
«« 
=>
«« 
an
««  
.
««  !%
Parametro_actor_negocio
««! 8
)
««8 9
.
««9 :
Include
»» 
(
»» 
an
»» 
=>
»» 
an
»»  
.
»»  !
Actor_negocio_rol
»»! 2
.
»»2 3
Select
»»3 9
(
»»9 :
anr
»»: =
=>
»»> @
anr
»»A D
.
»»D E
Rol
»»E H
)
»»H I
)
»»I J
.
»»J K
Include
…… 
(
…… 
an
…… 
=>
…… 
an
……  
.
……  !
Rol
……! $
)
……$ %
.
   
Where
   
(
   
an
   
=>
   
an
   
.
    
id_rol
    &
==
  ' )
idRol
  * /
&&
  0 2
an
  3 5
.
  5 6

es_vigente
  6 @
==
  A C
	esVigente
  D M
)
  M N
.
  N O
Select
ÀÀ 
(
ÀÀ 
an
ÀÀ 
=>
ÀÀ 
an
ÀÀ 
.
ÀÀ  
Actor
ÀÀ  %
)
ÀÀ% &
.
ÀÀ& '

SelectMany
ÀÀ' 1
(
ÀÀ1 2
a
ÀÀ2 3
=>
ÀÀ4 6
a
ÀÀ7 8
.
ÀÀ8 9
Actor_negocio
ÀÀ9 F
)
ÀÀF G
.
ÀÀG H
Where
ÃÃ 
(
ÃÃ 
an
ÃÃ 
=>
ÃÃ 
an
ÃÃ 
.
ÃÃ 
id_rol
ÃÃ %
==
ÃÃ& (
idParentRol
ÃÃ) 4
&&
ÃÃ5 7
an
ÃÃ8 :
.
ÃÃ: ;

es_vigente
ÃÃ; E
==
ÃÃF H
	esVigente
ÃÃI R
)
ÃÃR S
;
ÃÃS T
}
ÕÕ 	
public
œœ 
async
œœ 
Task
œœ 
<
œœ 
IEnumerable
œœ %
<
œœ% &
ItemGenerico
œœ& 2
>
œœ2 3
>
œœ3 4J
<ObtenerActoresDeNegocioPrincipalesVigentesComoItemsGenericos
œœ5 q
(
œœq r
int
œœr u
idParentRolœœv Å
,œœÅ Ç
intœœÉ Ü
idRolœœá å
)œœå ç
{
–– 	
var
““ 
_dbAsync
““ 
=
““ 
new
““ 
SigescomEntities
““ /
(
““/ 0
)
““0 1
;
““1 2
return
”” 
await
”” 
_dbAsync
”” !
.
””! "
Actor_negocio
””" /
.
””/ 0
Where
‘‘ 
(
‘‘ 
an
‘‘ 
=>
‘‘ 
an
‘‘ 
.
‘‘ 
id_rol
‘‘ %
==
‘‘& (
idRol
‘‘) .
&&
‘‘/ 1
an
‘‘2 4
.
‘‘4 5

es_vigente
‘‘5 ?
)
‘‘? @
.
‘‘@ A
Select
‘‘A G
(
‘‘G H
an
‘‘H J
=>
‘‘K M
an
‘‘N P
.
‘‘P Q
Actor
‘‘Q V
)
‘‘V W
.
‘‘W X

SelectMany
‘‘X b
(
‘‘b c
a
‘‘c d
=>
‘‘e g
a
‘‘h i
.
‘‘i j
Actor_negocio
‘‘j w
)
‘‘w x
.
‘‘x y
Where
‘‘y ~
(
‘‘~ 
an‘‘ Å
=>‘‘Ç Ñ
an‘‘Ö á
.‘‘á à
id_rol‘‘à é
==‘‘è ë
idParentRol‘‘í ù
&&‘‘û †
an‘‘° £
.‘‘£ §

es_vigente‘‘§ Æ
)‘‘Æ Ø
.‘‘Ø ∞
Select‘‘∞ ∂
(‘‘∂ ∑
an‘‘∑ π
=>‘‘∫ º
new‘‘Ω ¿
ItemGenerico‘‘¡ Õ
{‘‘Œ œ
Id‘‘– “
=‘‘” ‘
an‘‘’ ◊
.‘‘◊ ÿ
id‘‘ÿ ⁄
,‘‘⁄ €
Nombre‘‘‹ ‚
=‘‘„ ‰
an‘‘Â Á
.‘‘Á Ë
Actor‘‘Ë Ì
.‘‘Ì Ó
primer_nombre‘‘Ó ˚
}‘‘¸ ˝
)‘‘˝ ˛
.‘‘˛ ˇ
ToListAsync‘‘ˇ ä
(‘‘ä ã
)‘‘ã å
;‘‘å ç
}
’’ 	
public
÷÷ 
async
÷÷ 
Task
÷÷ 
<
÷÷ 
IEnumerable
÷÷ %
<
÷÷% &
ItemGenerico
÷÷& 2
>
÷÷2 3
>
÷÷3 4R
DObtenerActoresDeNegocioPrincipalesVigentesComoItemsGenericosPorIdRol
÷÷5 y
(
÷÷y z
int
÷÷z }
idRol÷÷~ É
)÷÷É Ñ
{
◊◊ 	
var
ŸŸ 
_dbAsync
ŸŸ 
=
ŸŸ 
new
ŸŸ 
SigescomEntities
ŸŸ /
(
ŸŸ/ 0
)
ŸŸ0 1
;
ŸŸ1 2
return
⁄⁄ 
await
⁄⁄ 
_dbAsync
⁄⁄ !
.
⁄⁄! "
Actor_negocio
⁄⁄" /
.
⁄⁄/ 0
Where
€€ 
(
€€ 
an
€€ 
=>
€€ 
an
€€ 
.
€€ 
id_rol
€€ %
==
€€& (
idRol
€€) .
&&
€€/ 1
an
€€2 4
.
€€4 5

es_vigente
€€5 ?
)
€€? @
.
€€@ A
Select
€€A G
(
€€G H
an
€€H J
=>
€€K M
new
€€N Q
ItemGenerico
€€R ^
{
€€_ `
Id
€€a c
=
€€d e
an
€€f h
.
€€h i
id
€€i k
,
€€k l
Nombre
€€m s
=
€€t u
an
€€v x
.
€€x y
Actor
€€y ~
.
€€~ 
primer_nombre€€ å
}€€ç é
)€€é è
.€€è ê
ToListAsync€€ê õ
(€€õ ú
)€€ú ù
;€€ù û
;€€ü †
}
‹‹ 	
public
‚‚ 
int
‚‚ 
[
‚‚ 
]
‚‚ /
!ObtenerIdsActorDeNegocioPrincipal
‚‚ 6
(
‚‚6 7
int
‚‚7 :
idParentRol
‚‚; F
,
‚‚F G
int
‚‚H K
idRol
‚‚L Q
)
‚‚Q R
{
„„ 	
return
‰‰ 
_db
‰‰ 
.
‰‰ 
Actor_negocio
‰‰ $
.
‰‰$ %
Where
‰‰% *
(
‰‰* +
an
‰‰+ -
=>
‰‰. 0
an
‰‰1 3
.
‰‰3 4
id_rol
‰‰4 :
==
‰‰; =
idRol
‰‰> C
)
‰‰C D
.
‰‰D E
Select
‰‰E K
(
‰‰K L
an
‰‰L N
=>
‰‰O Q
an
‰‰R T
.
‰‰T U
Actor
‰‰U Z
)
‰‰Z [
.
‰‰[ \

SelectMany
‰‰\ f
(
‰‰f g
a
‰‰g h
=>
‰‰i k
a
‰‰l m
.
‰‰m n
Actor_negocio
‰‰n {
)
‰‰{ |
.
‰‰| }
Where‰‰} Ç
(‰‰Ç É
an‰‰É Ö
=>‰‰Ü à
an‰‰â ã
.‰‰ã å
id_rol‰‰å í
==‰‰ì ï
idParentRol‰‰ñ °
)‰‰° ¢
.‰‰¢ £
Select‰‰£ ©
(‰‰© ™
an‰‰™ ¨
=>‰‰≠ Ø
an‰‰∞ ≤
.‰‰≤ ≥
id‰‰≥ µ
)‰‰µ ∂
.‰‰∂ ∑
ToArray‰‰∑ æ
(‰‰æ ø
)‰‰ø ¿
;‰‰¿ ¡
}
ÂÂ 	
public
ÈÈ 
IEnumerable
ÈÈ 
<
ÈÈ 
Concepto_negocio
ÈÈ +
>
ÈÈ+ ,$
obtenerConceptosPorRol
ÈÈ- C
(
ÈÈC D
int
ÈÈD G
idRol
ÈÈH M
)
ÈÈM N
{
ÍÍ 	
return
ÎÎ 
null
ÎÎ 
;
ÎÎ 
}
ÏÏ 	
public
 
IEnumerable
 
<
 
Actor_negocio
 (
>
( )4
&obtenerActoresDeNegocioPrincipalPorRol
* P
(
P Q
int
Q T
idRol
U Z
)
Z [
{
ÒÒ 	
return
ÚÚ 
_db
ÚÚ 
.
ÚÚ 
Actor_negocio
ÚÚ $
.
ÚÚ$ %
Where
ÚÚ% *
(
ÚÚ* +
an
ÚÚ+ -
=>
ÚÚ. 0
an
ÚÚ1 3
.
ÚÚ3 4
id_rol
ÚÚ4 :
==
ÚÚ; =
idRol
ÚÚ> C
)
ÚÚC D
;
ÚÚD E
}
ÛÛ 	
public
ÙÙ 
List
ÙÙ 
<
ÙÙ 
Actor_negocio
ÙÙ !
>
ÙÙ! "M
?obtenerActoresDeNegocioPrincipalPorRolVigentesAhoraDatosBasicos
ÙÙ# b
(
ÙÙb c
int
ÙÙc f
idRol
ÙÙg l
)
ÙÙl m
{
ıı 	
return
ˆˆ 
_db
ˆˆ 
.
ˆˆ 
Actor_negocio
ˆˆ $
.
ˆˆ$ %
Include
ˆˆ% ,
(
ˆˆ, -
an
ˆˆ- /
=>
ˆˆ0 2
an
ˆˆ3 5
.
ˆˆ5 6
Actor
ˆˆ6 ;
)
ˆˆ; <
.
ˆˆ< =
Where
ˆˆ= B
(
ˆˆB C
an
ˆˆC E
=>
ˆˆF H
an
ˆˆI K
.
ˆˆK L
id_rol
ˆˆL R
==
ˆˆS U
idRol
ˆˆV [
&&
ˆˆ\ ^
an
ˆˆ_ a
.
ˆˆa b

es_vigente
ˆˆb l
==
ˆˆm o
true
ˆˆp t
)
ˆˆt u
.
ˆˆu v
ToList
ˆˆv |
(
ˆˆ| }
)
ˆˆ} ~
;
ˆˆ~ 
}
˜˜ 	
public
˘˘ 
int
˘˘ 
ObtenerIdActor
˘˘ !
(
˘˘! "
string
˘˘" ( 
documentoIdentidad
˘˘) ;
,
˘˘; <
int
˘˘= @&
idTipoDocumentoIdentidad
˘˘A Y
)
˘˘Y Z
{
˙˙ 	
int
˚˚ 
id
˚˚ 
=
˚˚ 
$num
˚˚ 
;
˚˚ 
id
¸¸ 
=
¸¸ 
_db
¸¸ 
.
¸¸ 
Actor
¸¸ 
.
¸¸ 
Where
¸¸  
(
¸¸  !
a
¸¸! "
=>
¸¸# %
a
¸¸& '
.
¸¸' ((
numero_documento_identidad
¸¸( B
==
¸¸C E 
documentoIdentidad
¸¸F X
&&
¸¸Y [
a
¸¸\ ]
.
¸¸] ^$
id_documento_identidad
¸¸^ t
==
¸¸u w'
idTipoDocumentoIdentidad¸¸x ê
)¸¸ê ë
.¸¸ë í
Select¸¸í ò
(¸¸ò ô
a¸¸ô ö
=>¸¸õ ù
a¸¸û ü
.¸¸ü †
id¸¸† ¢
)¸¸¢ £
.¸¸£ §
FirstOrDefault¸¸§ ≤
(¸¸≤ ≥
)¸¸≥ ¥
;¸¸¥ µ
return
˝˝ 
id
˝˝ 
;
˝˝ 
}
˛˛ 	
public
ÇÇ 
bool
ÇÇ 
ExisteActor
ÇÇ 
(
ÇÇ  
string
ÇÇ  & 
documentoIdentidad
ÇÇ' 9
)
ÇÇ9 :
{
ÉÉ 	
return
ÑÑ 
_db
ÑÑ 
.
ÑÑ 
Actor
ÑÑ 
.
ÑÑ 
Any
ÑÑ  
(
ÑÑ  !
a
ÑÑ! "
=>
ÑÑ# %
a
ÑÑ& '
.
ÑÑ' ((
numero_documento_identidad
ÑÑ( B
==
ÑÑC E 
documentoIdentidad
ÑÑF X
)
ÑÑX Y
;
ÑÑY Z
}
ÖÖ 	
public
áá 
bool
áá "
ExisteActorDeNegocio
áá (
(
áá( )
string
áá) / 
documentoIdentidad
áá0 B
)
ááB C
{
àà 	
return
ââ 
_db
ââ 
.
ââ 
Actor_negocio
ââ $
.
ââ$ %
Any
ââ% (
(
ââ( )
an
ââ) +
=>
ââ, .
an
ââ/ 1
.
ââ1 2
Actor
ââ2 7
.
ââ7 8(
numero_documento_identidad
ââ8 R
==
ââS U 
documentoIdentidad
ââV h
)
ââh i
;
ââi j
}
ää 	
public
åå 
bool
åå !
ExistActorDeNegocio
åå '
(
åå' (
string
åå( . 
documentoIdentidad
åå/ A
,
ååA B
DateTime
ååC K
fechaVigencia
ååL Y
)
ååY Z
{
çç 	
return
éé 
_db
éé 
.
éé 
Actor_negocio
éé $
.
éé$ %
Any
éé% (
(
éé( )
an
éé) +
=>
éé, .
an
éé/ 1
.
éé1 2
Actor
éé2 7
.
éé7 8(
numero_documento_identidad
éé8 R
==
ééS U 
documentoIdentidad
ééV h
&&
ééi k
an
éél n
.
één o
fecha_inicio
ééo {
<=
éé| ~
fechaVigenciaéé å
&&ééç è
anééê í
.ééí ì
	fecha_finééì ú
>=ééù ü
fechaVigenciaéé† ≠
)éé≠ Æ
;ééÆ Ø
}
èè 	
public
ëë 
bool
ëë %
actorDeNegocioEsVigente
ëë +
(
ëë+ ,
int
ëë, /
idProveedor
ëë0 ;
)
ëë; <
{
íí 	
return
ìì 
_db
ìì 
.
ìì 
Actor_negocio
ìì $
.
ìì$ %
Any
ìì% (
(
ìì( )
an
ìì) +
=>
ìì, .
an
ìì/ 1
.
ìì1 2
id
ìì2 4
==
ìì5 7
idProveedor
ìì8 C
&&
ììD F
an
ììG I
.
ììI J
fecha_inicio
ììJ V
<=
ììW Y
SqlFunctions
ììZ f
.
ììf g
GetDate
ììg n
(
ììn o
)
ììo p
&&
ììq s
an
ììt v
.
ììv w
	fecha_finììw Ä
>=ììÅ É
SqlFunctionsììÑ ê
.ììê ë
GetDateììë ò
(ììò ô
)ììô ö
)ììö õ
;ììõ ú
}
îî 	
public
óó 
Actor_negocio
óó (
ObtenerActorDeNegocioPorId
óó 7
(
óó7 8
int
óó8 ;
idActorNegocio
óó< J
,
óóJ K
int
óóL O
idRol
óóP U
)
óóU V
{
òò 	
return
ôô 
_db
ôô 
.
ôô 
Actor_negocio
ôô $
.
ôô$ %
Include
öö 
(
öö 
an
öö 
=>
öö 
an
öö  
.
öö  !
Actor
öö! &
)
öö& '
.
öö' (
Include
õõ 
(
õõ 
an
õõ 
=>
õõ 
an
õõ  
.
õõ  !
Actor
õõ! &
.
õõ& '
	Direccion
õõ' 0
)
õõ0 1
.
õõ1 2
Include
úú 
(
úú 
an
úú 
=>
úú 
an
úú  
.
úú  !
Actor
úú! &
.
úú& '

Tipo_actor
úú' 1
)
úú1 2
.
úú2 3
Include
ùù 
(
ùù 
an
ùù 
=>
ùù 
an
ùù  
.
ùù  !
Actor
ùù! &
.
ùù& '
Clase_actor
ùù' 2
)
ùù2 3
.
ùù3 4
Include
ûû 
(
ûû 
an
ûû 
=>
ûû 
an
ûû  
.
ûû  !
Actor
ûû! &
.
ûû& '
Detalle_maestro
ûû' 6
)
ûû6 7
.
ûû7 8
Include
üü 
(
üü 
an
üü 
=>
üü 
an
üü  
.
üü  !
Actor
üü! &
.
üü& '
	Direccion
üü' 0
.
üü0 1
Select
üü1 7
(
üü7 8
d
üü8 9
=>
üü: <
d
üü= >
.
üü> ?
Ubigeo
üü? E
)
üüE F
)
üüF G
.
üüG H
Include
†† 
(
†† 
an
†† 
=>
†† 
an
††  
.
††  !
Actor
††! &
.
††& '
	Direccion
††' 0
.
††0 1
Select
††1 7
(
††7 8
d
††8 9
=>
††: <
d
††= >
.
††> ?
Detalle_maestro
††? N
)
††N O
)
††O P
.
††P Q
Include
°° 
(
°° 
an
°° 
=>
°° 
an
°°  
.
°°  !
Actor
°°! &
.
°°& '
	Direccion
°°' 0
.
°°0 1
Select
°°1 7
(
°°7 8
d
°°8 9
=>
°°: <
d
°°= >
.
°°> ?
Detalle_maestro1
°°? O
)
°°O P
)
°°P Q
.
°°Q R
Include
¢¢ 
(
¢¢ 
an
¢¢ 
=>
¢¢ 
an
¢¢  
.
¢¢  !
Actor
¢¢! &
.
¢¢& '
	Direccion
¢¢' 0
.
¢¢0 1
Select
¢¢1 7
(
¢¢7 8
d
¢¢8 9
=>
¢¢: <
d
¢¢= >
.
¢¢> ?
Detalle_maestro2
¢¢? O
)
¢¢O P
)
¢¢P Q
.
¢¢Q R
Include
££ 
(
££ 
an
££ 
=>
££ 
an
££  
.
££  !
Actor
££! &
.
££& '
	Direccion
££' 0
.
££0 1
Select
££1 7
(
££7 8
d
££8 9
=>
££: <
d
££= >
.
££> ?
Detalle_maestro3
££? O
)
££O P
)
££P Q
.
££Q R
SingleOrDefault
§§ 
(
§§  
an
§§  "
=>
§§# %
an
§§& (
.
§§( )
id
§§) +
==
§§, .
idActorNegocio
§§/ =
&&
§§> @
an
§§A C
.
§§C D
id_rol
§§D J
==
§§K M
idRol
§§N S
&&
§§T V
an
§§W Y
.
§§Y Z

es_vigente
§§Z d
)
§§d e
;
§§e f
}
•• 	
public
¶¶ 
Actor_negocio
¶¶ +
obtenerActorDeNegocioConRoles
¶¶ :
(
¶¶: ;
int
¶¶; >
idActorNegocio
¶¶? M
,
¶¶M N
int
¶¶O R
idRol
¶¶S X
)
¶¶X Y
{
ßß 	
return
®® 
_db
®® 
.
®® 
Actor_negocio
®® $
.
®®$ %
Include
®®% ,
(
®®, -
an
®®- /
=>
®®0 2
an
®®3 5
.
®®5 6
Actor
®®6 ;
.
®®; <
Actor_negocio
®®< I
)
®®I J
.
®®J K
SingleOrDefault
®®K Z
(
®®Z [
an
®®[ ]
=>
®®^ `
an
®®a c
.
®®c d
id
®®d f
==
®®g i
idActorNegocio
®®j x
&&
®®y {
an
®®| ~
.
®®~ 
id_rol®® Ö
==®®Ü à
idRol®®â é
)®®é è
;®®è ê
}
©© 	
public
™™ 
Actor_negocio
™™ ?
1ObtenerActorDeNegocioVigentePorDocumentoIdentidad
™™ N
(
™™N O
string
™™O U 
documentoIdentidad
™™V h
,
™™h i
int
™™j m
idRol
™™n s
)
™™s t
{
´´ 	
return
¨¨ 
_db
¨¨ 
.
¨¨ 
Actor_negocio
¨¨ $
.
¨¨$ %
Include
≠≠ 
(
≠≠ 
an
≠≠ 
=>
≠≠ 
an
≠≠  
.
≠≠  !
Actor
≠≠! &
)
≠≠& '
.
≠≠' (
Include
ÆÆ 
(
ÆÆ 
an
ÆÆ 
=>
ÆÆ 
an
ÆÆ  
.
ÆÆ  !
Actor
ÆÆ! &
.
ÆÆ& '
	Direccion
ÆÆ' 0
)
ÆÆ0 1
.
ÆÆ1 2
Include
ØØ 
(
ØØ 
an
ØØ 
=>
ØØ 
an
ØØ  
.
ØØ  !
Actor
ØØ! &
.
ØØ& '

Tipo_actor
ØØ' 1
)
ØØ1 2
.
ØØ2 3
Include
∞∞ 
(
∞∞ 
an
∞∞ 
=>
∞∞ 
an
∞∞  
.
∞∞  !
Actor
∞∞! &
.
∞∞& '
Clase_actor
∞∞' 2
)
∞∞2 3
.
∞∞3 4
Include
±± 
(
±± 
an
±± 
=>
±± 
an
±±  
.
±±  !
Actor
±±! &
.
±±& '
Estado_legal
±±' 3
)
±±3 4
.
±±4 5
Include
≤≤ 
(
≤≤ 
an
≤≤ 
=>
≤≤ 
an
≤≤  
.
≤≤  !
Actor
≤≤! &
.
≤≤& '
Detalle_maestro
≤≤' 6
)
≤≤6 7
.
≤≤7 8
Include
≥≥ 
(
≥≥ 
an
≥≥ 
=>
≥≥ 
an
≥≥  
.
≥≥  !
Actor
≥≥! &
.
≥≥& '
	Direccion
≥≥' 0
.
≥≥0 1
Select
≥≥1 7
(
≥≥7 8
d
≥≥8 9
=>
≥≥: <
d
≥≥= >
.
≥≥> ?
Ubigeo
≥≥? E
)
≥≥E F
)
≥≥F G
.
≥≥G H
Include
¥¥ 
(
¥¥ 
an
¥¥ 
=>
¥¥ 
an
¥¥  
.
¥¥  !
Actor
¥¥! &
.
¥¥& '
	Direccion
¥¥' 0
.
¥¥0 1
Select
¥¥1 7
(
¥¥7 8
d
¥¥8 9
=>
¥¥: <
d
¥¥= >
.
¥¥> ?
Detalle_maestro
¥¥? N
)
¥¥N O
)
¥¥O P
.
¥¥P Q
Include
µµ 
(
µµ 
an
µµ 
=>
µµ 
an
µµ  
.
µµ  !
Actor
µµ! &
.
µµ& '
	Direccion
µµ' 0
.
µµ0 1
Select
µµ1 7
(
µµ7 8
d
µµ8 9
=>
µµ: <
d
µµ= >
.
µµ> ?
Detalle_maestro1
µµ? O
)
µµO P
)
µµP Q
.
µµQ R
Include
∂∂ 
(
∂∂ 
an
∂∂ 
=>
∂∂ 
an
∂∂  
.
∂∂  !
Actor
∂∂! &
.
∂∂& '
	Direccion
∂∂' 0
.
∂∂0 1
Select
∂∂1 7
(
∂∂7 8
d
∂∂8 9
=>
∂∂: <
d
∂∂= >
.
∂∂> ?
Detalle_maestro2
∂∂? O
)
∂∂O P
)
∂∂P Q
.
∂∂Q R
Include
∑∑ 
(
∑∑ 
an
∑∑ 
=>
∑∑ 
an
∑∑  
.
∑∑  !
Actor
∑∑! &
.
∑∑& '
	Direccion
∑∑' 0
.
∑∑0 1
Select
∑∑1 7
(
∑∑7 8
d
∑∑8 9
=>
∑∑: <
d
∑∑= >
.
∑∑> ?
Detalle_maestro3
∑∑? O
)
∑∑O P
)
∑∑P Q
.
∑∑Q R
SingleOrDefault
∏∏ 
(
∏∏  
an
∏∏  "
=>
∏∏# %
an
∏∏& (
.
∏∏( )
Actor
∏∏) .
.
∏∏. /(
numero_documento_identidad
∏∏/ I
==
∏∏J L 
documentoIdentidad
∏∏M _
&&
∏∏` b
an
∏∏c e
.
∏∏e f
id_rol
∏∏f l
==
∏∏m o
idRol
∏∏p u
&&
∏∏v x
an
∏∏y {
.
∏∏{ |

es_vigente∏∏| Ü
)∏∏Ü á
;∏∏á à
}
ππ 	
public
ªª 
IEnumerable
ªª 
<
ªª $
SelectorActorComercial
ªª 1
>
ªª1 2>
0ObtenerActoresComercialesVigentesPorRolYBusqueda
ªª3 c
(
ªªc d
int
ªªd g
idRol
ªªh m
,
ªªm n
string
ªªo u
cadenaBusquedaªªv Ñ
)ªªÑ Ö
{
ºº 	
try
ΩΩ 
{
ææ 
return
øø 
_db
øø 
.
øø 
Actor_negocio
øø (
.
¿¿  
Where
¿¿  %
(
¿¿% &
an
¿¿& (
=>
¿¿) +
an
¿¿, .
.
¿¿. /
id_rol
¿¿/ 5
==
¿¿6 8
idRol
¿¿9 >
&&
¿¿? A
an
¿¿B D
.
¿¿D E

es_vigente
¿¿E O
&&
¡¡- /
(
¡¡0 1
an
¡¡1 3
.
¡¡3 4
Actor
¡¡4 9
.
¡¡9 :(
numero_documento_identidad
¡¡: T
.
¡¡T U
Contains
¡¡U ]
(
¡¡] ^
cadenaBusqueda
¡¡^ l
)
¡¡l m
||
¡¡n p
an
¡¡q s
.
¡¡s t
Actor
¡¡t y
.
¡¡y z
primer_nombre¡¡z á
.¡¡á à
Replace¡¡à è
(¡¡è ê
$str¡¡ê ì
,¡¡ì î
$str¡¡ï ò
)¡¡ò ô
.¡¡ô ö
Contains¡¡ö ¢
(¡¡¢ £
cadenaBusqueda¡¡£ ±
)¡¡± ≤
)¡¡≤ ≥
)¡¡≥ ¥
.
¬¬  
Select
¬¬  &
(
¬¬& '
an
¬¬' )
=>
¬¬* ,
new
¬¬- 0$
SelectorActorComercial
¬¬1 G
(
¬¬G H
)
¬¬H I
{
√√  
Id
ƒƒ# %
=
ƒƒ& '
an
ƒƒ( *
.
ƒƒ* +
id
ƒƒ+ -
,
ƒƒ- .
NumeroDocumento
≈≈# 2
=
≈≈3 4
an
≈≈5 7
.
≈≈7 8
Actor
≈≈8 =
.
≈≈= >(
numero_documento_identidad
≈≈> X
,
≈≈X Y
RazonSocial
∆∆# .
=
∆∆/ 0
an
∆∆1 3
.
∆∆3 4
Actor
∆∆4 9
.
∆∆9 :
primer_nombre
∆∆: G
,
∆∆G H
}
««  
)
««  !
.
««! "
OrderBy
««" )
(
««) *
cnc
««* -
=>
««. 0
cnc
««1 4
.
««4 5
RazonSocial
««5 @
)
««@ A
;
««A B
}
»» 
catch
…… 
(
…… 
	Exception
…… 
e
…… 
)
…… 
{
   
throw
ÀÀ 
new
ÀÀ 
DatosException
ÀÀ (
(
ÀÀ( )
$str
ÀÀ) v
,
ÀÀv w
e
ÀÀx y
)
ÀÀy z
;
ÀÀz {
}
ÃÃ 
}
ÕÕ 	
public
ŒŒ 
IEnumerable
ŒŒ 
<
ŒŒ 
ItemGenerico
ŒŒ '
>
ŒŒ' (:
,ObtenerActoresComercialesPorCentroDeAtencion
ŒŒ) U
(
ŒŒU V
int
ŒŒV Y 
idCentroDeAtencion
ŒŒZ l
)
ŒŒl m
{
œœ 	
try
–– 
{
—— 
return
““ 
_db
““ 
.
““ #
Vinculo_Actor_Negocio
““ 0
.
““0 1
Where
““1 6
(
““6 7
v
““7 8
=>
““9 ;
v
““< =
.
““= >(
id_actor_negocio_principal
““> X
==
““Y [ 
idCentroDeAtencion
““\ n
&&
““o q
v
““r s
.
““s t
tipo_vinculo““t Ä
==““Å É
(““Ñ Ö
int““Ö à
)““à â
TipoVinculo““â î
.““î ï
Turno““ï ö
)““ö õ
.““õ ú
Select““ú ¢
(““¢ £
v““£ §
=>““• ß
v““® ©
.““© ™
Actor_negocio1““™ ∏
)““∏ π
.““π ∫
Select““∫ ¿
(““¿ ¡
an““¡ √
=>““ƒ ∆
new
”” 
ItemGenerico
””  
{
‘‘ 
Id
’’ 
=
’’ 
an
’’ 
.
’’ 
id
’’ 
,
’’ 
Nombre
÷÷ 
=
÷÷ 
an
÷÷ 
.
÷÷  
Actor
÷÷  %
.
÷÷% &
tercer_nombre
÷÷& 3
}
◊◊ 
)
◊◊ 
;
◊◊ 
}
ÿÿ 
catch
ŸŸ 
(
ŸŸ 
	Exception
ŸŸ 
e
ŸŸ 
)
ŸŸ 
{
⁄⁄ 
throw
€€ 
new
€€ 
DatosException
€€ (
(
€€( )
$str
€€) v
,
€€v w
e
€€x y
)
€€y z
;
€€z {
}
‹‹ 
}
›› 	
public
ﬂﬂ 
string
ﬂﬂ !
obtenerMaximoCodigo
ﬂﬂ )
(
ﬂﬂ) *
int
ﬂﬂ* -
idRol
ﬂﬂ. 3
)
ﬂﬂD E
{
‡‡ 	
try
·· 
{
‚‚ 
int
„„ 
idMaximo
„„ 
=
„„ 
_db
„„ "
.
„„" #
Actor_negocio
„„# 0
.
„„0 1
Where
„„1 6
(
„„6 7
an
„„7 9
=>
„„: <
an
„„T V
.
„„V W
id_rol
„„W ]
==
„„^ `
idRol
„„a f
)
„„f g
.
„„g h
Max
„„h k
(
„„k l
an
„„l n
=>
„„o q
an
„„r t
.
„„t u
id
„„u w
)
„„w x
;
„„x y
return
‰‰ 
_db
‰‰ 
.
‰‰ 
Actor_negocio
‰‰ (
.
‰‰( )
Where
‰‰) .
(
‰‰. /
an
‰‰/ 1
=>
‰‰2 4
an
‰‰5 7
.
‰‰7 8
id
‰‰8 :
==
‰‰; =
idMaximo
‰‰> F
)
‰‰F G
.
‰‰G H
Max
‰‰H K
(
‰‰K L
an
‰‰L N
=>
‰‰O Q
an
‰‰R T
.
‰‰T U
codigo_negocio
‰‰U c
)
‰‰c d
==
‰‰e g
null
‰‰h l
||
‰‰m o
_db
‰‰p s
.
‰‰s t
Actor_negocio‰‰t Å
.‰‰Å Ç
Where‰‰Ç á
(‰‰á à
an‰‰à ä
=>‰‰ã ç
an‰‰é ê
.‰‰ê ë
id‰‰ë ì
==‰‰î ñ
idMaximo‰‰ó ü
)‰‰ü †
.‰‰† °
Max‰‰° §
(‰‰§ •
an‰‰• ß
=>‰‰® ™
an‰‰´ ≠
.‰‰≠ Æ
codigo_negocio‰‰Æ º
)‰‰º Ω
==‰‰æ ¿
$str‰‰¡ √
?‰‰ƒ ≈
$str‰‰∆ …
:‰‰  À
_db‰‰Ã œ
.‰‰œ –
Actor_negocio‰‰– ›
.‰‰› ﬁ
Where‰‰ﬁ „
(‰‰„ ‰
an‰‰‰ Ê
=>‰‰Á È
an‰‰Í Ï
.‰‰Ï Ì
id‰‰Ì Ô
==‰‰ Ú
idMaximo‰‰Û ˚
)‰‰˚ ¸
.‰‰¸ ˝
Max‰‰˝ Ä
(‰‰Ä Å
an‰‰Å É
=>‰‰Ñ Ü
an‰‰á â
.‰‰â ä
codigo_negocio‰‰ä ò
)‰‰ò ô
;‰‰ô ö
}
ÂÂ 
catch
ÊÊ 
{
ÁÁ 
return
ËË 
$str
ËË 
;
ËË 
}
ÈÈ 
}
ÍÍ 	
public
ÔÔ /
!RespuestaVerificacionActorNegocio
ÔÔ 0
verificarActor
ÔÔ1 ?
(
ÔÔ? @
int
ÔÔ@ C"
idDocumentoIdentidad
ÔÔD X
,
ÔÔX Y
string
ÔÔZ `
numeroDocumento
ÔÔa p
,
ÔÔp q
int
ÔÔr u
idRol
ÔÔv {
)
ÔÔ{ |
{
 	
try
ÒÒ 
{
ÚÚ /
!RespuestaVerificacionActorNegocio
ÙÙ 1
	respuesta
ÙÙ2 ;
;
ÙÙ; <
Actor
ıı 
actor
ıı 
=
ıı 
_db
ıı !
.
ıı! "
Actor
ıı" '
.
ıı' (
Include
ıı( /
(
ıı/ 0
a
ıı0 1
=>
ıı2 4
a
ıı5 6
.
ıı6 7
Actor_negocio
ıı7 D
)
ııD E
.
ııE F
SingleOrDefault
ııF U
(
ııU V
a
ııV W
=>
ııX Z
a
ıı[ \
.
ıı\ ]$
id_documento_identidad
ıı] s
==
ııt v#
idDocumentoIdentidadııw ã
&&ııå é
aııè ê
.ııê ë*
numero_documento_identidadııë ´
==ıı¨ Æ
numeroDocumentoııØ æ
)ııæ ø
;ııø ¿
if
ˆˆ 
(
ˆˆ 
actor
ˆˆ 
!=
ˆˆ 
null
ˆˆ !
)
ˆˆ! "
{
˜˜ 
if
¯¯ 
(
¯¯ 
actor
¯¯ 
.
¯¯ 
Actor_negocio
¯¯ +
.
¯¯+ ,
Any
¯¯, /
(
¯¯/ 0
an
¯¯0 2
=>
¯¯3 5
an
¯¯6 8
.
¯¯8 9
id_rol
¯¯9 ?
==
¯¯@ B
idRol
¯¯C H
&&
¯¯I K
an
¯¯L N
.
¯¯N O

es_vigente
¯¯O Y
==
¯¯Z \
true
¯¯] a
)
¯¯a b
)
¯¯b c
{
˘˘ 
Actor_negocio
˙˙ %
actorNegocio
˙˙& 2
=
˙˙3 4
actor
˙˙5 :
.
˙˙: ;
Actor_negocio
˙˙; H
.
˙˙H I
SingleOrDefault
˙˙I X
(
˙˙X Y
an
˙˙Y [
=>
˙˙\ ^
an
˙˙_ a
.
˙˙a b
id_rol
˙˙b h
==
˙˙i k
idRol
˙˙l q
&&
˙˙r t
an
˙˙u w
.
˙˙w x

es_vigente˙˙x Ç
==˙˙É Ö
true˙˙Ü ä
)˙˙ä ã
;˙˙ã å
	respuesta
˚˚ !
=
˚˚" #
new
˚˚$ '/
!RespuestaVerificacionActorNegocio
˚˚( I
(
˚˚I J'
RespuestaVerificacionEnum
˚˚J c
.
˚˚c d 
ExisteActorNegocio
˚˚d v
,
˚˚v w
actorNegocio˚˚x Ñ
)˚˚Ñ Ö
;˚˚Ö Ü
}
¸¸ 
else
˝˝ 
{
˛˛ 
	respuesta
ˇˇ !
=
ˇˇ" #
new
ˇˇ$ '/
!RespuestaVerificacionActorNegocio
ˇˇ( I
(
ˇˇI J'
RespuestaVerificacionEnum
ˇˇJ c
.
ˇˇc d
ExisteSoloActor
ˇˇd s
,
ˇˇs t
actor
ˇˇu z
)
ˇˇz {
;
ˇˇ{ |
}
ÄÄ 
}
ÅÅ 
else
ÇÇ 
{
ÉÉ 
	respuesta
ÑÑ 
=
ÑÑ 
new
ÑÑ  #/
!RespuestaVerificacionActorNegocio
ÑÑ$ E
(
ÑÑE F'
RespuestaVerificacionEnum
ÑÑF _
.
ÑÑ_ `
NoExisteActor
ÑÑ` m
)
ÑÑm n
;
ÑÑn o
}
ÖÖ 
return
áá 
	respuesta
áá  
;
áá  !
}
ââ 
catch
ää 
(
ää 
	Exception
ää 
e
ää 
)
ää 
{
ãã 
return
åå 
new
åå /
!RespuestaVerificacionActorNegocio
åå <
(
åå< ='
RespuestaVerificacionEnum
åå= V
.
ååV W
NoSePudoVerificar
ååW h
,
ååh i
e
ååj k
.
ååk l
Message
åål s
)
åås t
;
ååt u
}
çç 
}
éé 	
public
êê 
int
êê 
[
êê 
]
êê 3
%obtenerAccionesPosiblesParaRolesHijos
êê :
(
êê: ;
string
êê; A
	idUsuario
êêB K
,
êêK L
int
êêM P

idRolPadre
êêQ [
,
êê[ \
int
êê] `
idTipoTransaccion
êêa r
)
êêr s
{
ëë 	
int
íí 
[
íí 
]
íí 
idsRolesHijos
íí 
=
íí  !
_db
íí" %
.
íí% &
Actor_negocio
íí& 3
.
íí3 4
SingleOrDefault
íí4 C
(
ííC D
an
ííD F
=>
ííG I
an
ííJ L
.
ííL M

id_usuario
ííM W
==
ííX Z
	idUsuario
íí[ d
)
ííd e
.
ííe f
Actor
ííf k
.
íík l
Actor_negocio
ííl y
.
ííy z
Where
ìì 
(
ìì 
an
ìì 
=>
ìì 
an
ìì 
.
ìì 
Rol
ìì "
.
ìì" #
id_rol_padre
ìì# /
==
ìì0 2

idRolPadre
ìì3 =
&&
ìì> @
an
ììA C
.
ììC D

es_vigente
ììD N
==
ììO Q
true
ììR V
)
ììV W
.
ììW X
Select
ììX ^
(
ìì^ _
an
ìì_ a
=>
ììb d
an
ììe g
.
ììg h
id_rol
ììh n
)
ììn o
.
ììo p
ToArray
ììp w
(
ììw x
)
ììx y
;
ììy z
return
òò 
_db
òò 
.
òò 
Rol
òò 
.
òò 
Where
òò  
(
òò  !
r
òò! "
=>
òò# %
idsRolesHijos
òò& 3
.
òò3 4
Contains
òò4 <
(
òò< =
r
òò= >
.
òò> ?
id
òò? A
)
òòA B
)
òòB C
.
òòC D

SelectMany
òòD N
(
òòN O
r
òòO P
=>
òòQ S
r
òòT U
.
òòU V
Accion_por_rol
òòV d
.
òòd e
Where
òòe j
(
òòj k
apr
òòk n
=>
òòo q
apr
òòr u
.
òòu v"
id_tipo_transaccionòòv â
==òòä å!
idTipoTransaccionòòç û
)òòû ü
.òòü †
Selectòò† ¶
(òò¶ ß
apròòß ™
=>òò´ ≠
apròòÆ ±
.òò± ≤!
id_accion_posibleòò≤ √
)òò√ ƒ
)òòƒ ≈
.òò≈ ∆
Distinctòò∆ Œ
(òòŒ œ
)òòœ –
.òò– —
ToArrayòò— ÿ
(òòÿ Ÿ
)òòŸ ⁄
;òò⁄ €
}
ùù 	
public
üü 
int
üü 
[
üü 
]
üü %
obtenerAccionesPosibles
üü ,
(
üü, -
string
üü- 3
	idUsuario
üü4 =
,
üü= >
int
üü? B
idTipoTransaccion
üüC T
)
üüT U
{
†† 	
throw
°° 
new
°° %
NotImplementedException
°° -
(
°°- .
)
°°. /
;
°°/ 0
}
¢¢ 	
public
§§ 
Actor_negocio
§§ #
obtenerActorDeNegocio
§§ 2
(
§§2 3
string
§§3 9
	idUsuario
§§: C
,
§§C D
int
§§E H
idRolEmpleado
§§I V
)
§§V W
{
•• 	
return
¶¶ 
_db
¶¶ 
.
¶¶ 
Actor_negocio
¶¶ $
.
¶¶$ %
SingleOrDefault
¶¶% 4
(
¶¶4 5
an
¶¶5 7
=>
¶¶8 :
an
¶¶; =
.
¶¶= >
id_rol
¶¶> D
==
¶¶E G
idRolEmpleado
¶¶H U
&&
¶¶V X
an
¶¶Y [
.
¶¶[ \

id_usuario
¶¶\ f
==
¶¶g i
	idUsuario
¶¶j s
)
¶¶s t
;
¶¶t u
}
ßß 	
public
©© 
List
©© 
<
©© 
Actor_negocio
©© !
>
©©! "4
&ObtenerActoresDeNegociosPorTransaccion
©©# I
(
©©I J
int
©©J M
idTransaccion
©©N [
)
©©[ \
{
™™ 	
throw
´´ 
new
´´ %
NotImplementedException
´´ -
(
´´- .
)
´´. /
;
´´/ 0
}
¨¨ 	
public
≥≥ 
OperationResult
≥≥ '
CrearVinculosActorNegocio
≥≥ 8
(
≥≥8 9
List
≥≥9 =
<
≥≥= >#
Vinculo_Actor_Negocio
≥≥> S
>
≥≥S T&
vinculosActoresDeNegocio
≥≥U m
)
≥≥m n
{
¥¥ 	
try
µµ 
{
∂∂ 
foreach
∑∑ 
(
∑∑ 
var
∑∑ #
vinculoActorDeNegocio
∑∑ 2
in
∑∑3 5&
vinculosActoresDeNegocio
∑∑6 N
)
∑∑N O
{
∏∏ 
_db
ππ 
.
ππ #
Vinculo_Actor_Negocio
ππ -
.
ππ- .
Add
ππ. 1
(
ππ1 2#
vinculoActorDeNegocio
ππ2 G
)
ππG H
;
ππH I
}
∫∫ 
return
ªª 
Save
ªª 
(
ªª 
)
ªª 
;
ªª 
}
ºº 
catch
ΩΩ 
(
ΩΩ 
	Exception
ΩΩ 
e
ΩΩ 
)
ΩΩ 
{
ææ 
throw
øø 
e
øø 
;
øø 
}
¿¿ 
}
¡¡ 	
public
¬¬ 
OperationResult
¬¬ ,
ActualizarVinculosActorNegocio
¬¬ =
(
¬¬= >
int
¬¬> A%
idActorNegocioPrincipal
¬¬B Y
,
¬¬Y Z
List
¬¬[ _
<
¬¬_ `#
Vinculo_Actor_Negocio
¬¬` u
>
¬¬u v'
vinculosActoresDeNegocio¬¬w è
,¬¬è ê
int¬¬ë î
tipovinculo¬¬ï †
)¬¬† °
{
√√ 	
try
ƒƒ 
{
≈≈ 
List
«« 
<
«« #
Vinculo_Actor_Negocio
«« *
>
««* +(
dbVinculosActoresDeNegocio
««, F
=
««G H
_db
««I L
.
««L M#
Vinculo_Actor_Negocio
««M b
.
««b c
Where
««c h
(
««h i
van
««i l
=>
««m o
van
««p s
.
««s t)
id_actor_negocio_principal««t é
==««è ë'
idActorNegocioPrincipal««í ©
&&««™ ¨
van««≠ ∞
.««∞ ±

es_vigente««± ª
==««º æ
true««ø √
&&««ƒ ∆
van«««  
.««  À
tipo_vinculo««À ◊
==««ÿ ⁄
tipovinculo««€ Ê
)««Ê Á
.««Á Ë
ToList««Ë Ó
(««Ó Ô
)««Ô 
;«« Ò
foreach
…… 
(
…… 
var
…… 
	dbVinculo
…… &
in
……' )(
dbVinculosActoresDeNegocio
……* D
)
……D E
{
   
if
ÃÃ 
(
ÃÃ 
!
ÃÃ &
vinculosActoresDeNegocio
ÃÃ 1
.
ÃÃ1 2
Any
ÃÃ2 5
(
ÃÃ5 6
van
ÃÃ6 9
=>
ÃÃ: <
van
ÃÃ= @
.
ÃÃ@ A(
id_actor_negocio_vinculado
ÃÃA [
==
ÃÃ\ ^
	dbVinculo
ÃÃ_ h
.
ÃÃh i)
id_actor_negocio_vinculadoÃÃi É
)ÃÃÉ Ñ
)ÃÃÑ Ö
{
ÕÕ 
	dbVinculo
ŒŒ !
.
ŒŒ! "
hasta
ŒŒ" '
=
ŒŒ( )
DateTimeUtil
ŒŒ* 6
.
ŒŒ6 7
FechaActual
ŒŒ7 B
(
ŒŒB C
)
ŒŒC D
;
ŒŒD E
	dbVinculo
œœ !
.
œœ! "

es_vigente
œœ" ,
=
œœ- .
false
œœ/ 4
;
œœ4 5
}
–– 
}
—— 
foreach
”” 
(
”” 
var
”” 
vinculo
”” $
in
””% '&
vinculosActoresDeNegocio
””( @
)
””@ A
{
‘‘ 
if
’’ 
(
’’ 
!
’’ (
dbVinculosActoresDeNegocio
’’ 3
.
’’3 4
Any
’’4 7
(
’’7 8
van
’’8 ;
=>
’’< >
van
’’? B
.
’’B C(
id_actor_negocio_vinculado
’’C ]
==
’’^ `
vinculo
’’a h
.
’’h i)
id_actor_negocio_vinculado’’i É
)’’É Ñ
)’’Ñ Ö
{
÷÷ 
_db
◊◊ 
.
◊◊ #
Vinculo_Actor_Negocio
◊◊ 1
.
◊◊1 2
Add
◊◊2 5
(
◊◊5 6
vinculo
◊◊6 =
)
◊◊= >
;
◊◊> ?
}
ÿÿ 
}
ŸŸ 
return
⁄⁄ 
Save
⁄⁄ 
(
⁄⁄ 
)
⁄⁄ 
;
⁄⁄ 
}
€€ 
catch
‹‹ 
(
‹‹ 
	Exception
‹‹ 
e
‹‹ 
)
‹‹ 
{
›› 
throw
ﬁﬁ 
e
ﬁﬁ 
;
ﬁﬁ 
}
ﬂﬂ 
}
‡‡ 	
public
‚‚ #
Vinculo_Actor_Negocio
‚‚ $<
.ObtenerVinculoActorNegocioSegunElTipoDeVinculo
‚‚% S
(
‚‚S T
int
‚‚T W
idActorDeNegocio
‚‚X h
,
‚‚h i
int
‚‚j m
tipoVinculo
‚‚n y
)
‚‚y z
{
„„ 	
return
‰‰ 
_db
‰‰ 
.
‰‰ #
Vinculo_Actor_Negocio
‰‰ ,
.
‰‰, -
SingleOrDefault
‰‰- <
(
‰‰< =
van
‰‰= @
=>
‰‰A C
van
‰‰D G
.
‰‰G H
id
‰‰H J
==
‰‰K M
idActorDeNegocio
‰‰N ^
&&
‰‰_ a
van
‰‰b e
.
‰‰e f
tipo_vinculo
‰‰f r
==
‰‰s u
tipoVinculo‰‰v Å
)‰‰Å Ç
;‰‰Ç É
}
ÂÂ 	
public
ÁÁ 
IEnumerable
ÁÁ 
<
ÁÁ #
Vinculo_Actor_Negocio
ÁÁ 0
>
ÁÁ0 1=
/ObtenerVinculosActorNegocioSegunElTipoDeVinculo
ÁÁ2 a
(
ÁÁa b
int
ÁÁb e
tipoVinculo
ÁÁf q
)
ÁÁq r
{
ËË 	
return
ÈÈ 
_db
ÈÈ 
.
ÈÈ #
Vinculo_Actor_Negocio
ÈÈ ,
.
ÈÈ, -
Where
ÈÈ- 2
(
ÈÈ2 3
van
ÈÈ3 6
=>
ÈÈ7 9
van
ÈÈ: =
.
ÈÈ= >
tipo_vinculo
ÈÈ> J
==
ÈÈK M
tipoVinculo
ÈÈN Y
)
ÈÈY Z
;
ÈÈZ [
}
ÍÍ 	
public
ÏÏ 
OperationResult
ÏÏ +
ActualizarVinculoActorNegocio
ÏÏ <
(
ÏÏ< =#
Vinculo_Actor_Negocio
ÏÏ= R$
updVinculoActorNegocio
ÏÏS i
)
ÏÏi j
{
ÌÌ 	
try
ÓÓ 
{
ÔÔ #
Vinculo_Actor_Negocio
 %#
dbVinculoActorNegocio
& ;
=
< =
_db
> A
.
A B#
Vinculo_Actor_Negocio
B W
.
W X
Single
X ^
(
^ _
van
_ b
=>
c e
van
f i
.
i j
id
j l
==
m o%
updVinculoActorNegociop Ü
.Ü á
idá â
)â ä
;ä ã
_db
ÒÒ 
.
ÒÒ 
Entry
ÒÒ 
(
ÒÒ #
dbVinculoActorNegocio
ÒÒ /
)
ÒÒ/ 0
.
ÒÒ0 1
CurrentValues
ÒÒ1 >
.
ÒÒ> ?
	SetValues
ÒÒ? H
(
ÒÒH I$
updVinculoActorNegocio
ÒÒI _
)
ÒÒ_ `
;
ÒÒ` a
var
ÚÚ 
result
ÚÚ 
=
ÚÚ 
Save
ÚÚ !
(
ÚÚ! "
)
ÚÚ" #
;
ÚÚ# $
result
ÛÛ 
.
ÛÛ 
data
ÛÛ 
=
ÛÛ #
dbVinculoActorNegocio
ÛÛ 3
.
ÛÛ3 4
id
ÛÛ4 6
;
ÛÛ6 7
return
ÙÙ 
result
ÙÙ 
;
ÙÙ 
}
ıı 
catch
ˆˆ 
(
ˆˆ 
	Exception
ˆˆ 
e
ˆˆ 
)
ˆˆ 
{
˜˜ 
throw
¯¯ 
e
¯¯ 
;
¯¯ 
}
˘˘ 
}
˙˙ 	
public
¸¸ 
IEnumerable
¸¸ 
<
¸¸ 
Actor_negocio
¸¸ (
>
¸¸( )J
<ObtenerActorDeNegocioIncluidoTransaccion1PorRolVigentesAhora
¸¸* f
(
¸¸f g
int
¸¸g j
idRol
¸¸k p
)
¸¸p q
{
˝˝ 	
return
˛˛ 
_db
˛˛ 
.
˛˛ 
Actor_negocio
˛˛ $
.
˛˛$ %
Include
ˇˇ 
(
ˇˇ 
an
ˇˇ 
=>
ˇˇ 
an
ˇˇ  
.
ˇˇ  !
Rol
ˇˇ! $
)
ˇˇ$ %
.
ˇˇ% &
Include
ÄÄ 
(
ÄÄ 
an
ÄÄ 
=>
ÄÄ 
an
ÄÄ  
.
ÄÄ  !
Actor
ÄÄ! &
)
ÄÄ& '
.
ÄÄ' (
Include
ÅÅ 
(
ÅÅ 
an
ÅÅ 
=>
ÅÅ 
an
ÅÅ  
.
ÅÅ  !
Actor
ÅÅ! &
.
ÅÅ& '
	Direccion
ÅÅ' 0
)
ÅÅ0 1
.
ÅÅ1 2
Include
ÇÇ 
(
ÇÇ 
an
ÇÇ 
=>
ÇÇ 
an
ÇÇ  
.
ÇÇ  !
Actor
ÇÇ! &
.
ÇÇ& '
	Direccion
ÇÇ' 0
.
ÇÇ0 1
Select
ÇÇ1 7
(
ÇÇ7 8
d
ÇÇ8 9
=>
ÇÇ: <
d
ÇÇ= >
.
ÇÇ> ?
Ubigeo
ÇÇ? E
)
ÇÇE F
)
ÇÇF G
.
ÇÇG H
Include
ÉÉ 
(
ÉÉ 
an
ÉÉ 
=>
ÉÉ 
an
ÉÉ  
.
ÉÉ  !
Actor
ÉÉ! &
.
ÉÉ& '
	Direccion
ÉÉ' 0
.
ÉÉ0 1
Select
ÉÉ1 7
(
ÉÉ7 8
d
ÉÉ8 9
=>
ÉÉ: <
d
ÉÉ= >
.
ÉÉ> ?
Detalle_maestro
ÉÉ? N
)
ÉÉN O
)
ÉÉO P
.
ÉÉP Q
Include
ÑÑ 
(
ÑÑ 
an
ÑÑ 
=>
ÑÑ 
an
ÑÑ  
.
ÑÑ  !
Actor
ÑÑ! &
.
ÑÑ& '
	Direccion
ÑÑ' 0
.
ÑÑ0 1
Select
ÑÑ1 7
(
ÑÑ7 8
d
ÑÑ8 9
=>
ÑÑ: <
d
ÑÑ= >
.
ÑÑ> ?
Detalle_maestro1
ÑÑ? O
)
ÑÑO P
)
ÑÑP Q
.
ÑÑQ R
Include
ÖÖ 
(
ÖÖ 
an
ÖÖ 
=>
ÖÖ 
an
ÖÖ  
.
ÖÖ  !
Actor
ÖÖ! &
.
ÖÖ& '
	Direccion
ÖÖ' 0
.
ÖÖ0 1
Select
ÖÖ1 7
(
ÖÖ7 8
d
ÖÖ8 9
=>
ÖÖ: <
d
ÖÖ= >
.
ÖÖ> ?
Detalle_maestro2
ÖÖ? O
)
ÖÖO P
)
ÖÖP Q
.
ÖÖQ R
Include
ÜÜ 
(
ÜÜ 
an
ÜÜ 
=>
ÜÜ 
an
ÜÜ  
.
ÜÜ  !
Actor
ÜÜ! &
.
ÜÜ& '
	Direccion
ÜÜ' 0
.
ÜÜ0 1
Select
ÜÜ1 7
(
ÜÜ7 8
d
ÜÜ8 9
=>
ÜÜ: <
d
ÜÜ= >
.
ÜÜ> ?
Detalle_maestro3
ÜÜ? O
)
ÜÜO P
)
ÜÜP Q
.
ÜÜQ R
Include
áá 
(
áá 
an
áá 
=>
áá 
an
áá  
.
áá  !
Actor
áá! &
.
áá& '

Tipo_actor
áá' 1
)
áá1 2
.
áá2 3
Include
àà 
(
àà 
an
àà 
=>
àà 
an
àà  
.
àà  !
Actor
àà! &
.
àà& '
Detalle_maestro
àà' 6
)
àà6 7
.
àà7 8
Include
ââ 
(
ââ 
an
ââ 
=>
ââ 
an
ââ  
.
ââ  !
Actor_negocio_rol
ââ! 2
)
ââ2 3
.
ââ3 4
Include
ää 
(
ää 
an
ää 
=>
ää 
an
ää  
.
ää  !
Actor_negocio_rol
ää! 2
.
ää2 3
Select
ää3 9
(
ää9 :
anr
ää: =
=>
ää> @
anr
ääA D
.
ääD E
Rol
ääE H
)
ääH I
)
ääI J
.
ääJ K
Include
ãã 
(
ãã 
an
ãã 
=>
ãã 
an
ãã  
.
ãã  !
Transaccion1
ãã! -
)
ãã- .
.
ãã. /
Include
åå 
(
åå 
an
åå 
=>
åå 
an
åå  
.
åå  !
Transaccion1
åå! -
.
åå- .
Select
åå. 4
(
åå4 5
t
åå5 6
=>
åå7 9
t
åå: ;
.
åå; <
Cuota
åå< A
)
ååA B
)
ååB C
.
ååC D
Where
çç 
(
çç 
an
çç 
=>
çç 
an
çç 
.
çç 
id_rol
çç %
==
çç& (
idRol
çç) .
&&
çç/ 1
an
çç2 4
.
çç4 5

es_vigente
çç5 ?
==
çç@ B
true
ççC G
)
ççG H
;
ççH I
}
èè 	
public
ëë 
IEnumerable
ëë 
<
ëë #
Vinculo_Actor_Negocio
ëë 0
>
ëë0 1+
ObtenerVinculosActorDeNegocio
ëë2 O
(
ëëO P
int
ëëP S
tipoVinculo
ëëT _
)
ëë_ `
{
íí 	
var
ìì 
temp
ìì 
=
ìì 
_db
ìì 
.
ìì #
Vinculo_Actor_Negocio
ìì 0
.
ìì0 1
Where
ìì1 6
(
ìì6 7
van
ìì7 :
=>
ìì; =
van
ìì> A
.
ììA B
tipo_vinculo
ììB N
==
ììO Q
tipoVinculo
ììR ]
&&
ìì^ `
van
ììa d
.
ììd e

es_vigente
ììe o
==
ììp r
true
ììs w
)
ììw x
;
ììx y
return
îî 
temp
îî 
;
îî 
}
ïï 	
public
óó 
IEnumerable
óó 
<
óó #
Vinculo_Actor_Negocio
óó 0
>
óó0 1+
ObtenerVinculosActorDeNegocio
óó2 O
(
óóO P
int
óóP S%
idActorNegocioPrincipal
óóT k
,
óók l
int
óóm p
tipoVinculo
óóq |
)
óó| }
{
òò 	
return
ôô 
_db
ôô 
.
ôô #
Vinculo_Actor_Negocio
ôô ,
.
ôô, -
Where
ôô- 2
(
ôô2 3
van
ôô3 6
=>
ôô7 9
van
ôô: =
.
ôô= >(
id_actor_negocio_principal
ôô> X
==
ôôY [%
idActorNegocioPrincipal
ôô\ s
&&
ôôt v
van
ôôw z
.
ôôz {
tipo_vinculoôô{ á
==ôôà ä
tipoVinculoôôã ñ
&&ôôó ô
vanôôö ù
.ôôù û

es_vigenteôôû ®
==ôô© ´
trueôô¨ ∞
)ôô∞ ±
;ôô± ≤
}
öö 	
public
úú 
async
úú 
Task
úú 
<
úú 
IEnumerable
úú %
<
úú% &
Actor_negocio
úú& 3
>
úú3 4
>
úú4 5C
5ObtenerActoresDeNegocioVigentesPorIdActorNegocioPadre
úú6 k
(
úúk l
int
úúl o"
idActorNegocioPadreúúp É
)úúÉ Ñ
{
ùù 	
var
ûû 
_dbAsync
ûû 
=
ûû 
new
ûû 
SigescomEntities
ûû /
(
ûû/ 0
)
ûû0 1
;
ûû1 2
return
üü 
await
üü 
_dbAsync
üü !
.
üü! "
Actor_negocio
üü" /
.
üü/ 0
Where
üü0 5
(
üü5 6
an
üü6 8
=>
üü9 ;
an
üü< >
.
üü> ?$
id_actor_negocio_padre
üü? U
==
üüV X!
idActorNegocioPadre
üüY l
&&
üüm o
an
üüp r
.
üür s

es_vigente
üüs }
)
üü} ~
.
üü~ 
ToListAsyncüü ä
(üüä ã
)üüã å
;üüå ç
}
†† 	
public
¢¢ 
IEnumerable
¢¢ 
<
¢¢ 
Actor_negocio
¢¢ (
>
¢¢( )_
QObtenerActoresDeNegocioSegunActorNegocioPrincipalYElTipoDeVinculoIncluyendoCuotas
¢¢* {
(
¢¢{ |
int
¢¢| '
idActorNegocioPrincipal¢¢Ä ó
,¢¢ó ò
int¢¢ô ú
tipoVinculo¢¢ù ®
)¢¢® ©
{
££ 	
return
¥¥ 
_db
¥¥ 
.
¥¥ #
Vinculo_Actor_Negocio
¥¥ ,
.
¥¥, -
Where
¥¥- 2
(
¥¥2 3
van
¥¥3 6
=>
¥¥7 9
van
¥¥: =
.
¥¥= >(
id_actor_negocio_principal
¥¥> X
==
¥¥Y [%
idActorNegocioPrincipal
¥¥\ s
&&
¥¥t v
van
¥¥w z
.
¥¥z {
tipo_vinculo¥¥{ á
==¥¥à ä
tipoVinculo¥¥ã ñ
)¥¥ñ ó
.
µµ# $
Select
µµ$ *
(
µµ* +
an
µµ+ -
=>
µµ. 0
an
µµ1 3
.
µµ3 4
Actor_negocio1
µµ4 B
)
µµB C
.
µµC D
Include
µµD K
(
µµK L
an
µµL N
=>
µµO Q
an
µµR T
.
µµT U
Transaccion1
µµU a
.
µµa b

SelectMany
µµb l
(
µµl m
c
µµm n
=>
µµo q
c
µµr s
.
µµs t
Cuota
µµt y
)
µµy z
.
∂∂" #
Where
∂∂# (
(
∂∂( )
c
∂∂) *
=>
∂∂+ -
c
∂∂. /
.
∂∂/ 0

por_cobrar
∂∂0 :
==
∂∂; =
true
∂∂> B
&&
∂∂C E
c
∂∂F G
.
∂∂G H
saldo
∂∂H M
>
∂∂N O
$num
∂∂P Q
)
∂∂Q R
.
∑∑" #
Sum
∑∑# &
(
∑∑& '
c
∑∑' (
=>
∑∑) +
c
∑∑, -
.
∑∑- .
saldo
∑∑. 3
)
∑∑3 4
)
∑∑4 5
;
∑∑5 6
}
∏∏ 	
public
∫∫ 
IEnumerable
∫∫ 
<
∫∫ 
int
∫∫ 
>
∫∫ F
8ObtenerIdsActoresDeNegocioPrincipalDeVinculoActorNegocio
∫∫  X
(
∫∫X Y
int
∫∫Y \
tipoVinculo
∫∫] h
)
∫∫h i
{
ªª 	
var
ΩΩ *
idsActoresDeNegocioPrincipal
ΩΩ ,
=
ΩΩ- .
_db
ΩΩ/ 2
.
ΩΩ2 3#
Vinculo_Actor_Negocio
ΩΩ3 H
.
ΩΩH I
Where
ΩΩI N
(
ΩΩN O
van
ΩΩO R
=>
ΩΩS U
van
ΩΩV Y
.
ΩΩY Z
tipo_vinculo
ΩΩZ f
==
ΩΩg i
tipoVinculo
ΩΩj u
)
ΩΩu v
.
ΩΩv w
Select
ΩΩw }
(
ΩΩ} ~
vanΩΩ~ Å
=>ΩΩÇ Ñ
vanΩΩÖ à
.ΩΩà â*
id_actor_negocio_principalΩΩâ £
)ΩΩ£ §
.ΩΩ§ •
DistinctΩΩ• ≠
(ΩΩ≠ Æ
)ΩΩÆ Ø
;ΩΩØ ∞
return
ææ *
idsActoresDeNegocioPrincipal
ææ /
;
ææ/ 0
}
øø 	
public
ƒƒ 
IEnumerable
ƒƒ 
<
ƒƒ 
CuentaBancaria
ƒƒ )
>
ƒƒ) *%
ObtenerCuentasBancarias
ƒƒ+ B
(
ƒƒB C
)
ƒƒC D
{
≈≈ 	
return
∆∆ 
_db
∆∆ 
.
∆∆ 
Actor_negocio
∆∆ $
.
∆∆$ %
Where
∆∆% *
(
∆∆* +
an
∆∆+ -
=>
∆∆. 0
an
∆∆1 3
.
∆∆3 4
id_rol
∆∆4 :
==
∆∆; =
ActorSettings
∆∆> K
.
∆∆K L
Default
∆∆L S
.
∆∆S T!
IdRolCuentaBancaria
∆∆T g
)
∆∆g h
.
∆∆h i
Select
∆∆i o
(
∆∆o p
an
∆∆p r
=>
∆∆s u
new
∆∆v y
CuentaBancaria∆∆z à
{
«« 
Id
»» 
=
»» 
an
»» 
.
»» 
id
»» 
,
»» 
IdActor
…… 
=
…… 
an
…… 
.
…… 
id_actor
…… %
,
……% &

TipoCuenta
   
=
   
new
    
ItemGenericoBase
  ! 1
{
  2 3
Id
  4 6
=
  7 8
an
  9 ;
.
  ; <
Actor
  < A
.
  A B$
id_documento_identidad
  B X
,
  X Y
Nombre
  Z `
=
  a b
an
  c e
.
  e f
Actor
  f k
.
  k l
Detalle_maestro
  l {
.
  { |
nombre  | Ç
}  É Ñ
,  Ñ Ö
EntidadFinanciera
ÀÀ !
=
ÀÀ" #
new
ÀÀ$ '
ItemGenericoBase
ÀÀ( 8
{
ÀÀ9 :
Id
ÀÀ; =
=
ÀÀ> ?
(
ÀÀ@ A
int
ÀÀA D
)
ÀÀD E
an
ÀÀE G
.
ÀÀG H
Actor
ÀÀH M
.
ÀÀM N'
id_detalle_multiproposito
ÀÀN g
,
ÀÀg h
Nombre
ÀÀi o
=
ÀÀp q
an
ÀÀr t
.
ÀÀt u
Actor
ÀÀu z
.
ÀÀz {
Detalle_maestro1ÀÀ{ ã
.ÀÀã å
nombreÀÀå í
}ÀÀì î
,ÀÀî ï
Titular
ÃÃ 
=
ÃÃ 
an
ÃÃ 
.
ÃÃ 
Actor
ÃÃ "
.
ÃÃ" #
segundo_nombre
ÃÃ# 1
,
ÃÃ1 2
Moneda
ÕÕ 
=
ÕÕ 
new
ÕÕ 
ItemGenericoBase
ÕÕ -
{
ÕÕ. /
Id
ÕÕ0 2
=
ÕÕ3 4
(
ÕÕ5 6
int
ÕÕ6 9
)
ÕÕ9 :
an
ÕÕ: <
.
ÕÕ< =
Actor
ÕÕ= B
.
ÕÕB C(
id_detalle_multiproposito1
ÕÕC ]
,
ÕÕ] ^
Nombre
ÕÕ_ e
=
ÕÕf g
an
ÕÕh j
.
ÕÕj k
Actor
ÕÕk p
.
ÕÕp q
Detalle_maestro2ÕÕq Å
.ÕÕÅ Ç
nombreÕÕÇ à
}ÕÕâ ä
,ÕÕä ã
NumeroCuenta
ŒŒ 
=
ŒŒ 
an
ŒŒ !
.
ŒŒ! "
Actor
ŒŒ" '
.
ŒŒ' ((
numero_documento_identidad
ŒŒ( B
,
ŒŒB C
	NumeroCCI
œœ 
=
œœ 
an
œœ 
.
œœ 
Actor
œœ $
.
œœ$ %
primer_nombre
œœ% 2
,
œœ2 3
Ubigeo
–– 
=
–– 
an
–– 
.
–– 
Actor
–– !
.
––! "(
informacion_multiproposito
––" <
,
––< =

EstaActivo
—— 
=
—— 
an
—— 
.
——  

es_vigente
——  *
}
““ 
)
““ 
;
““ 
}
”” 	
public
‘‘ 
IEnumerable
‘‘ 
<
‘‘ 
CuentaBancaria
‘‘ )
>
‘‘) *9
+ObtenerCuentasBancariasPorEntidadFinanciera
‘‘+ V
(
‘‘V W
int
‘‘W Z!
idEntidadFinanciera
‘‘[ n
)
‘‘n o
{
’’ 	
return
÷÷ 
_db
÷÷ 
.
÷÷ 
Actor_negocio
÷÷ $
.
÷÷$ %
Where
÷÷% *
(
÷÷* +
an
÷÷+ -
=>
÷÷. 0
an
÷÷1 3
.
÷÷3 4
id_rol
÷÷4 :
==
÷÷; =
ActorSettings
÷÷> K
.
÷÷K L
Default
÷÷L S
.
÷÷S T!
IdRolCuentaBancaria
÷÷T g
&&
÷÷h j
an
÷÷k m
.
÷÷m n
Actor
÷÷n s
.
÷÷s t(
id_detalle_multiproposito÷÷t ç
==÷÷é ê#
idEntidadFinanciera÷÷ë §
)÷÷§ •
.÷÷• ¶
Select÷÷¶ ¨
(÷÷¨ ≠
an÷÷≠ Ø
=>÷÷∞ ≤
new÷÷≥ ∂
CuentaBancaria÷÷∑ ≈
{
◊◊ 
Id
ÿÿ 
=
ÿÿ 
an
ÿÿ 
.
ÿÿ 
id
ÿÿ 
,
ÿÿ 
IdActor
ŸŸ 
=
ŸŸ 
an
ŸŸ 
.
ŸŸ 
id_actor
ŸŸ %
,
ŸŸ% &

TipoCuenta
⁄⁄ 
=
⁄⁄ 
new
⁄⁄  
ItemGenericoBase
⁄⁄! 1
{
⁄⁄2 3
Id
⁄⁄4 6
=
⁄⁄7 8
an
⁄⁄9 ;
.
⁄⁄; <
Actor
⁄⁄< A
.
⁄⁄A B$
id_documento_identidad
⁄⁄B X
,
⁄⁄X Y
Nombre
⁄⁄Z `
=
⁄⁄a b
an
⁄⁄c e
.
⁄⁄e f
Actor
⁄⁄f k
.
⁄⁄k l
Detalle_maestro
⁄⁄l {
.
⁄⁄{ |
nombre⁄⁄| Ç
}⁄⁄É Ñ
,⁄⁄Ñ Ö
EntidadFinanciera
€€ !
=
€€" #
new
€€$ '
ItemGenericoBase
€€( 8
{
€€9 :
Id
€€; =
=
€€> ?
(
€€@ A
int
€€A D
)
€€D E
an
€€E G
.
€€G H
Actor
€€H M
.
€€M N'
id_detalle_multiproposito
€€N g
,
€€g h
Nombre
€€i o
=
€€p q
an
€€r t
.
€€t u
Actor
€€u z
.
€€z {
Detalle_maestro1€€{ ã
.€€ã å
nombre€€å í
}€€ì î
,€€î ï
Titular
‹‹ 
=
‹‹ 
an
‹‹ 
.
‹‹ 
Actor
‹‹ "
.
‹‹" #
segundo_nombre
‹‹# 1
,
‹‹1 2
Moneda
›› 
=
›› 
new
›› 
ItemGenericoBase
›› -
{
››. /
Id
››0 2
=
››3 4
(
››5 6
int
››6 9
)
››9 :
an
››: <
.
››< =
Actor
››= B
.
››B C(
id_detalle_multiproposito1
››C ]
,
››] ^
Nombre
››_ e
=
››f g
an
››h j
.
››j k
Actor
››k p
.
››p q
Detalle_maestro2››q Å
.››Å Ç
nombre››Ç à
}››â ä
,››ä ã
NumeroCuenta
ﬁﬁ 
=
ﬁﬁ 
an
ﬁﬁ !
.
ﬁﬁ! "
Actor
ﬁﬁ" '
.
ﬁﬁ' ((
numero_documento_identidad
ﬁﬁ( B
,
ﬁﬁB C
	NumeroCCI
ﬂﬂ 
=
ﬂﬂ 
an
ﬂﬂ 
.
ﬂﬂ 
Actor
ﬂﬂ $
.
ﬂﬂ$ %
primer_nombre
ﬂﬂ% 2
,
ﬂﬂ2 3
Ubigeo
‡‡ 
=
‡‡ 
an
‡‡ 
.
‡‡ 
Actor
‡‡ !
.
‡‡! "(
informacion_multiproposito
‡‡" <
,
‡‡< =

EstaActivo
·· 
=
·· 
an
·· 
.
··  

es_vigente
··  *
}
‚‚ 
)
‚‚ 
;
‚‚ 
}
„„ 	
public
ÂÂ 
IEnumerable
ÂÂ 
<
ÂÂ 
ItemGenerico
ÂÂ '
>
ÂÂ' (B
4ObtenerCuentasBancariasConEntidadFinancieraConMoneda
ÂÂ) ]
(
ÂÂ] ^
)
ÂÂ^ _
{
ÊÊ 	
return
ÁÁ 
_db
ÁÁ 
.
ÁÁ 
Actor_negocio
ÁÁ $
.
ÁÁ$ %
Where
ÁÁ% *
(
ÁÁ* +
an
ÁÁ+ -
=>
ÁÁ. 0
an
ÁÁ1 3
.
ÁÁ3 4
id_rol
ÁÁ4 :
==
ÁÁ; =
ActorSettings
ÁÁ> K
.
ÁÁK L
Default
ÁÁL S
.
ÁÁS T!
IdRolCuentaBancaria
ÁÁT g
&&
ÁÁh j
an
ÁÁk m
.
ÁÁm n

es_vigente
ÁÁn x
)
ÁÁx y
.
ÁÁy z
SelectÁÁz Ä
(ÁÁÄ Å
anÁÁÅ É
=>ÁÁÑ Ü
newÁÁá ä
ItemGenericoÁÁã ó
{
ËË 
Id
ÈÈ 
=
ÈÈ 
an
ÈÈ 
.
ÈÈ 
id
ÈÈ 
,
ÈÈ 
Nombre
ÍÍ 
=
ÍÍ 
an
ÍÍ 
.
ÍÍ 
Actor
ÍÍ !
.
ÍÍ! "
Detalle_maestro1
ÍÍ" 2
.
ÍÍ2 3
codigo
ÍÍ3 9
+
ÍÍ: ;
$str
ÍÍ< A
+
ÍÍB C
an
ÍÍD F
.
ÍÍF G
Actor
ÍÍG L
.
ÍÍL M
Detalle_maestro2
ÍÍM ]
.
ÍÍ] ^
codigo
ÍÍ^ d
+
ÍÍe f
$str
ÍÍg l
+
ÍÍm n
an
ÍÍo q
.
ÍÍq r
Actor
ÍÍr w
.
ÍÍw x)
numero_documento_identidadÍÍx í
,ÍÍí ì
Valor
ÎÎ 
=
ÎÎ 
an
ÎÎ 
.
ÎÎ 
Actor
ÎÎ  
.
ÎÎ  !
Detalle_maestro1
ÎÎ! 1
.
ÎÎ1 2
id
ÎÎ2 4
.
ÎÎ4 5
ToString
ÎÎ5 =
(
ÎÎ= >
)
ÎÎ> ?
}
ÏÏ 
)
ÏÏ 
;
ÏÏ 
;
ÏÏ 
}
ÌÌ 	
}
ÔÔ 
} ’√
XD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\Actores\ConsultaActor_Datos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
." #
Sigescom# +
.+ ,
Actores, 3
{ 
public 

class 
ConsultaActor_Datos $
:% &&
IConsultaActor_Repositorio' A
{ 
public 
ActorComercial_ "
ObtenerActorComercial_ 5
(5 6
int6 9
idRol: ?
,? @
intA D
idActorComercialE U
)U V
{ 	
try 
{ 
SigescomEntities  
_db! $
=% &
new' *
SigescomEntities+ ;
(; <
)< =
;= >
var 
actorComercial "
=# $
_db% (
.( )
Actor_negocio) 6
.6 7
Where7 <
(< =
an= ?
=>@ B
anC E
.E F
id_rolF L
==M O
idRolP U
&&V X
anY [
.[ \
id\ ^
==_ a
idActorComercialb r
)r s
.s t
Select 
( 
actorDeNegocio )
=>* ,
new- 0
ActorComercial_1 @
{ 
Id 
= 
actorDeNegocio +
.+ ,
id, .
,. /
IdActor 
=  !
actorDeNegocio" 0
.0 1
id_actor1 9
,9 :
Codigo 
=  
actorDeNegocio! /
./ 0
codigo_negocio0 >
,> ?
Telefono  
=! "
actorDeNegocio# 1
.1 2
Actor2 7
.7 8
telefono8 @
,@ A
Correo 
=  
actorDeNegocio! /
./ 0
Actor0 5
.5 6
correo6 <
,< =
NombreComercial '
=( )
actorDeNegocio* 8
.8 9
Actor9 >
.> ?
segundo_nombre? M
,M N
NombreORazonSocial   *
=  + ,
actorDeNegocio  - ;
.  ; <
Actor  < A
.  A B
primer_nombre  B O
,  O P$
NumeroDocumentoIdentidad!! 0
=!!1 2
actorDeNegocio!!3 A
.!!A B
Actor!!B G
.!!G H&
numero_documento_identidad!!H b
,!!b c"
TipoDocumentoIdentidad"" .
=""/ 0
new""1 4
ItemGenerico""5 A
{## 
Id$$ 
=$$  
actorDeNegocio$$! /
.$$/ 0
Actor$$0 5
.$$5 6"
id_documento_identidad$$6 L
,$$L M
Nombre%% "
=%%# $
actorDeNegocio%%% 3
.%%3 4
Actor%%4 9
.%%9 :
Detalle_maestro%%: I
.%%I J
valor%%J O
,%%O P
Valor&& !
=&&" #
actorDeNegocio&&$ 2
.&&2 3
Actor&&3 8
.&&8 9
Detalle_maestro&&9 H
.&&H I
valor&&I N
}'' 
,'' 
TipoPersona(( #
=(($ %
new((& )
ItemGenerico((* 6
{)) 
Id** 
=**  
actorDeNegocio**! /
.**/ 0
Actor**0 5
.**5 6
id_tipo_actor**6 C
,**C D
Nombre++ "
=++# $
actorDeNegocio++% 3
.++3 4
Actor++4 9
.++9 :

Tipo_actor++: D
.++D E
nombre++E K
,++K L
Valor,, !
=,," #
$str,,$ &
}-- 
,-- 

ClaseActor.. "
=..# $
new..% (
ItemGenerico..) 5
{// 
Id00 
=00  
actorDeNegocio00! /
.00/ 0
Actor000 5
.005 6
id_clase_actor006 D
,00D E
Nombre11 "
=11# $
actorDeNegocio11% 3
.113 4
Actor114 9
.119 :
Clase_actor11: E
.11E F
nombre11F L
,11L M
Valor22 !
=22" #
$str22$ &
}33 
,33 
EstadoLegal44 #
=44$ %
new44& )
ItemGenerico44* 6
{55 
Id66 
=66  
actorDeNegocio66! /
.66/ 0
Actor660 5
.665 6
id_estado_legal666 E
,66E F
Nombre77 "
=77# $
actorDeNegocio77% 3
.773 4
Actor774 9
.779 :
Estado_legal77: F
.77F G
nombre77G M
,77M N
Valor88 !
=88" #
$str88$ &
}99 
,99 
FechaNacimiento:: '
=::( )
actorDeNegocio::* 8
.::8 9
Actor::9 >
.::> ?
fecha_nacimiento::? O
,::O P
Nacionalidad;; $
=;;% &
new;;' *
ItemGenerico;;+ 7
{<< 
Id== 
===  
actorDeNegocio==! /
.==/ 0
Actor==0 5
.==5 6
Detalle_maestro1==6 F
.==F G
id==G I
,==I J
Nombre>> "
=>># $
actorDeNegocio>>% 3
.>>3 4
Actor>>4 9
.>>9 :
Detalle_maestro1>>: J
.>>J K
nombre>>K Q
,>>Q R
Valor?? !
=??" #
$str??$ &
}@@ 
,@@ 
DomicilioFiscalAA '
=AA( )
newAA* -

Direccion_AA. 8
{BB 
IdCC 
=CC  
actorDeNegocioCC! /
.CC/ 0
ActorCC0 5
.CC5 6
	DireccionCC6 ?
.CC? @
FirstOrDefaultCC@ N
(CCN O
dCCO P
=>CCQ S
dCCT U
.CCU V
es_principalCCV b
)CCb c
.CCc d
idCCd f
,CCf g
PaisDD  
=DD! "
newDD# &
ItemGenericoDD' 3
{EE 
IdFF  "
=FF# $
actorDeNegocioFF% 3
.FF3 4
ActorFF4 9
.FF9 :
	DireccionFF: C
.FFC D
FirstOrDefaultFFD R
(FFR S
)FFS T
.FFT U
Detalle_maestro1FFU e
.FFe f
idFFf h
,FFh i
NombreGG  &
=GG' (
actorDeNegocioGG) 7
.GG7 8
ActorGG8 =
.GG= >
	DireccionGG> G
.GGG H
FirstOrDefaultGGH V
(GGV W
)GGW X
.GGX Y
Detalle_maestro1GGY i
.GGi j
nombreGGj p
,GGp q
ValorHH  %
=HH& '
$strHH( *
}II 
,II 
UbigeoJJ "
=JJ# $
newJJ% (
ItemGenericoJJ) 5
{KK 
IdLL  "
=LL# $
actorDeNegocioLL% 3
.LL3 4
ActorLL4 9
.LL9 :
	DireccionLL: C
.LLC D
FirstOrDefaultLLD R
(LLR S
dLLS T
=>LLU W
dLLX Y
.LLY Z
es_principalLLZ f
)LLf g
.LLg h
UbigeoLLh n
.LLn o
idLLo q
,LLq r
NombreMM  &
=MM' (
actorDeNegocioMM) 7
.MM7 8
ActorMM8 =
.MM= >
	DireccionMM> G
.MMG H
FirstOrDefaultMMH V
(MMV W
dMMW X
=>MMY [
dMM\ ]
.MM] ^
es_principalMM^ j
)MMj k
.MMk l
UbigeoMMl r
.MMr s
descripcion_larga	MMs Ñ
,
MMÑ Ö
ValorNN  %
=NN& '
$strNN( *
}OO 
,OO 
DetallePP #
=PP$ %
actorDeNegocioPP& 4
.PP4 5
ActorPP5 :
.PP: ;
	DireccionPP; D
.PPD E
FirstOrDefaultPPE S
(PPS T
dPPT U
=>PPV X
dPPY Z
.PPZ [
es_principalPP[ g
)PPg h
.PPh i
detallePPi p
}QQ 
}RR 
)RR 
.RR 
FirstOrDefaultRR %
(RR% &
)RR& '
;RR' (
ifSS 
(SS 
actorComercialSS "
!=SS# %
nullSS& *
)SS* +
{TT 
actorComercialUU "
.UU" #
ApellidoPaternoUU# 2
=UU3 4
actorComercialUU5 C
.UUC D
TipoPersonaUUD O
.UUO P
IdUUP R
==UUS U
ActorSettingsUUV c
.UUc d
DefaultUUd k
.UUk l&
IdTipoActorPersonaNatural	UUl Ö
?
UUÜ á
actorComercial
UUà ñ
.
UUñ ó 
NombreORazonSocial
UUó ©
.
UU© ™
Split
UU™ Ø
(
UUØ ∞
$char
UU∞ ≥
)
UU≥ ¥
[
UU¥ µ
$num
UUµ ∂
]
UU∂ ∑
:
UU∏ π
$str
UU∫ º
;
UUº Ω
actorComercialVV "
.VV" #
ApellidoMaternoVV# 2
=VV3 4
actorComercialVV5 C
.VVC D
TipoPersonaVVD O
.VVO P
IdVVP R
==VVS U
ActorSettingsVVV c
.VVc d
DefaultVVd k
.VVk l&
IdTipoActorPersonaNatural	VVl Ö
&&
VVÜ à
actorComercial
VVâ ó
.
VVó ò 
NombreORazonSocial
VVò ™
.
VV™ ´
Split
VV´ ∞
(
VV∞ ±
$char
VV± ¥
)
VV¥ µ
.
VVµ ∂
Count
VV∂ ª
(
VVª º
)
VVº Ω
>
VVæ ø
$num
VV¿ ¡
?
VV¬ √
actorComercial
VVƒ “
.
VV“ ” 
NombreORazonSocial
VV” Â
.
VVÂ Ê
Split
VVÊ Î
(
VVÎ Ï
$char
VVÏ Ô
)
VVÔ 
[
VV Ò
$num
VVÒ Ú
]
VVÚ Û
:
VVÙ ı
$str
VVˆ ˘
;
VV˘ ˙
actorComercialWW "
.WW" #
NombresWW# *
=WW+ ,
actorComercialWW- ;
.WW; <
TipoPersonaWW< G
.WWG H
IdWWH J
==WWK M
ActorSettingsWWN [
.WW[ \
DefaultWW\ c
.WWc d%
IdTipoActorPersonaNaturalWWd }
&&	WW~ Ä
actorComercial
WWÅ è
.
WWè ê 
NombreORazonSocial
WWê ¢
.
WW¢ £
Split
WW£ ®
(
WW® ©
$char
WW© ¨
)
WW¨ ≠
.
WW≠ Æ
Count
WWÆ ≥
(
WW≥ ¥
)
WW¥ µ
>
WW∂ ∑
$num
WW∏ π
?
WW∫ ª
actorComercial
WWº  
.
WW  À 
NombreORazonSocial
WWÀ ›
.
WW› ﬁ
Split
WWﬁ „
(
WW„ ‰
$char
WW‰ Á
)
WWÁ Ë
[
WWË È
$num
WWÈ Í
]
WWÍ Î
:
WWÏ Ì
$str
WWÓ 
;
WW Ò
actorComercialXX "
.XX" #
NombreORazonSocialXX# 5
=XX6 7
actorComercialXX8 F
.XXF G
NombreORazonSocialXXG Y
.XXY Z
ReplaceXXZ a
(XXa b
$strXXb e
,XXe f
$strXXg j
)XXj k
;XXk l
ifYY 
(YY 
idRolYY 
==YY  
ActorSettingsYY! .
.YY. /
DefaultYY/ 6
.YY6 7
IdRolEmpleadoYY7 D
)YYD E
{ZZ 
actorComercial[[ &
.[[& '
Roles[[' ,
=[[- .
new[[/ 2
List[[3 7
<[[7 8
ItemGenerico[[8 D
>[[D E
([[E F
)[[F G
;[[G H
foreach\\ 
(\\  !
var\\! $
rol\\% (
in\\) +
_db\\, /
.\\/ 0
Actor\\0 5
.\\5 6
Where\\6 ;
(\\; <
a\\< =
=>\\> @
a\\A B
.\\B C
id\\C E
==\\F H
actorComercial\\I W
.\\W X
IdActor\\X _
)\\_ `
.\\` a

SelectMany\\a k
(\\k l
a\\l m
=>\\n p
a\\q r
.\\r s
Actor_negocio	\\s Ä
)
\\Ä Å
.
\\Å Ç
Where
\\Ç á
(
\\á à
an
\\à ä
=>
\\ã ç
an
\\é ê
.
\\ê ë
Rol
\\ë î
.
\\î ï
id_rol_padre
\\ï °
==
\\¢ §
ActorSettings
\\• ≤
.
\\≤ ≥
Default
\\≥ ∫
.
\\∫ ª
IdRolEmpleado
\\ª »
&&
\\… À
an
\\Ã Œ
.
\\Œ œ

es_vigente
\\œ Ÿ
==
\\⁄ ‹
true
\\› ·
)
\\· ‚
.
\\‚ „
Select
\\„ È
(
\\È Í
an
\\Í Ï
=>
\\Ì Ô
an
\\ Ú
.
\\Ú Û
Rol
\\Û ˆ
)
\\ˆ ˜
.
\\˜ ¯
ToList
\\¯ ˛
(
\\˛ ˇ
)
\\ˇ Ä
)
\\Ä Å
{]] 
actorComercial^^ *
.^^* +
Roles^^+ 0
.^^0 1
Add^^1 4
(^^4 5
new^^5 8
ItemGenerico^^9 E
(^^E F
rol^^F I
.^^I J
id^^J L
,^^L M
rol^^N Q
.^^Q R
nombre^^R X
)^^X Y
)^^Y Z
;^^Z [
}__ 
}`` 
}aa 
returnbb 
actorComercialbb %
;bb% &
}cc 
catchdd 
(dd 
	Exceptiondd 
edd 
)dd 
{ee 
throwff 
newff 
DatosExceptionff (
(ff( )
$strff) T
,ffT U
effV W
)ffW X
;ffX Y
}gg 
}hh 	
publicjj 
ActorComercial_jj "
ObtenerActorComercial_jj 5
(jj5 6
intjj6 9
idRoljj: ?
,jj? @
stringjjA G
numeroDocumentojjH W
)jjW X
{kk 	
tryll 
{mm 
SigescomEntitiesnn  
_dbnn! $
=nn% &
newnn' *
SigescomEntitiesnn+ ;
(nn; <
)nn< =
;nn= >
varoo 
actorComercialoo "
=oo# $
_dboo% (
.oo( )
Actor_negociooo) 6
.oo6 7
Whereoo7 <
(oo< =
anoo= ?
=>oo@ B
anooC E
.ooE F
id_rolooF L
==ooM O
idRolooP U
&&ooV X
anooY [
.oo[ \

es_vigenteoo\ f
&&oog i
anooj l
.ool m
Actoroom r
.oor s'
numero_documento_identidad	oos ç
==
ooé ê
numeroDocumento
ooë †
)
oo† °
.
oo° ¢
Selectpp 
(pp 
actorDeNegociopp )
=>pp* ,
newpp- 0
ActorComercial_pp1 @
{qq 
Idrr 
=rr 
actorDeNegociorr +
.rr+ ,
idrr, .
,rr. /
IdActorss 
=ss  !
actorDeNegocioss" 0
.ss0 1
id_actorss1 9
,ss9 :
Codigott 
=tt  
actorDeNegociott! /
.tt/ 0
codigo_negociott0 >
,tt> ?
Telefonouu  
=uu! "
actorDeNegociouu# 1
.uu1 2
Actoruu2 7
.uu7 8
telefonouu8 @
,uu@ A
Correovv 
=vv  
actorDeNegociovv! /
.vv/ 0
Actorvv0 5
.vv5 6
correovv6 <
,vv< =
NombreComercialww '
=ww( )
actorDeNegocioww* 8
.ww8 9
Actorww9 >
.ww> ?
segundo_nombreww? M
,wwM N
NombreORazonSocialxx *
=xx+ ,
actorDeNegocioxx- ;
.xx; <
Actorxx< A
.xxA B
primer_nombrexxB O
,xxO P$
NumeroDocumentoIdentidadyy 0
=yy1 2
actorDeNegocioyy3 A
.yyA B
ActoryyB G
.yyG H&
numero_documento_identidadyyH b
,yyb c"
TipoDocumentoIdentidadzz .
=zz/ 0
newzz1 4
ItemGenericozz5 A
{{{ 
Id|| 
=||  
actorDeNegocio||! /
.||/ 0
Actor||0 5
.||5 6"
id_documento_identidad||6 L
,||L M
Nombre}} "
=}}# $
actorDeNegocio}}% 3
.}}3 4
Actor}}4 9
.}}9 :
Detalle_maestro}}: I
.}}I J
valor}}J O
,}}O P
Valor~~ !
=~~" #
actorDeNegocio~~$ 2
.~~2 3
Actor~~3 8
.~~8 9
Detalle_maestro~~9 H
.~~H I
valor~~I N
} 
, 
TipoPersona
ÄÄ #
=
ÄÄ$ %
new
ÄÄ& )
ItemGenerico
ÄÄ* 6
{
ÅÅ 
Id
ÇÇ 
=
ÇÇ  
actorDeNegocio
ÇÇ! /
.
ÇÇ/ 0
Actor
ÇÇ0 5
.
ÇÇ5 6
id_tipo_actor
ÇÇ6 C
,
ÇÇC D
Nombre
ÉÉ "
=
ÉÉ# $
actorDeNegocio
ÉÉ% 3
.
ÉÉ3 4
Actor
ÉÉ4 9
.
ÉÉ9 :

Tipo_actor
ÉÉ: D
.
ÉÉD E
nombre
ÉÉE K
,
ÉÉK L
Valor
ÑÑ !
=
ÑÑ" #
$str
ÑÑ$ &
}
ÖÖ 
,
ÖÖ 

ClaseActor
ÜÜ "
=
ÜÜ# $
new
ÜÜ% (
ItemGenerico
ÜÜ) 5
{
áá 
Id
àà 
=
àà  
actorDeNegocio
àà! /
.
àà/ 0
Actor
àà0 5
.
àà5 6
id_clase_actor
àà6 D
,
ààD E
Nombre
ââ "
=
ââ# $
actorDeNegocio
ââ% 3
.
ââ3 4
Actor
ââ4 9
.
ââ9 :
Clase_actor
ââ: E
.
ââE F
nombre
ââF L
,
ââL M
Valor
ää !
=
ää" #
$str
ää$ &
}
ãã 
,
ãã 
EstadoLegal
åå #
=
åå$ %
new
åå& )
ItemGenerico
åå* 6
{
çç 
Id
éé 
=
éé  
actorDeNegocio
éé! /
.
éé/ 0
Actor
éé0 5
.
éé5 6
id_estado_legal
éé6 E
,
ééE F
Nombre
èè "
=
èè# $
actorDeNegocio
èè% 3
.
èè3 4
Actor
èè4 9
.
èè9 :
Estado_legal
èè: F
.
èèF G
nombre
èèG M
,
èèM N
Valor
êê !
=
êê" #
$str
êê$ &
}
ëë 
,
ëë 
FechaNacimiento
íí '
=
íí( )
actorDeNegocio
íí* 8
.
íí8 9
Actor
íí9 >
.
íí> ?
fecha_nacimiento
íí? O
,
ííO P
Nacionalidad
ìì $
=
ìì% &
new
ìì' *
ItemGenerico
ìì+ 7
{
îî 
Id
ïï 
=
ïï  
actorDeNegocio
ïï! /
.
ïï/ 0
Actor
ïï0 5
.
ïï5 6
Detalle_maestro1
ïï6 F
.
ïïF G
id
ïïG I
,
ïïI J
Nombre
ññ "
=
ññ# $
actorDeNegocio
ññ% 3
.
ññ3 4
Actor
ññ4 9
.
ññ9 :
Detalle_maestro1
ññ: J
.
ññJ K
nombre
ññK Q
,
ññQ R
Valor
óó !
=
óó" #
$str
óó$ &
}
òò 
,
òò 
DomicilioFiscal
ôô '
=
ôô( )
new
ôô* -

Direccion_
ôô. 8
{
öö 
Id
õõ 
=
õõ  
actorDeNegocio
õõ! /
.
õõ/ 0
Actor
õõ0 5
.
õõ5 6
	Direccion
õõ6 ?
.
õõ? @
FirstOrDefault
õõ@ N
(
õõN O
d
õõO P
=>
õõQ S
d
õõT U
.
õõU V
es_principal
õõV b
)
õõb c
.
õõc d
id
õõd f
,
õõf g
Pais
úú  
=
úú! "
new
úú# &
ItemGenerico
úú' 3
{
ùù 
Id
ûû  "
=
ûû# $
actorDeNegocio
ûû% 3
.
ûû3 4
Actor
ûû4 9
.
ûû9 :
	Direccion
ûû: C
.
ûûC D
FirstOrDefault
ûûD R
(
ûûR S
)
ûûS T
.
ûûT U
Detalle_maestro1
ûûU e
.
ûûe f
id
ûûf h
,
ûûh i
Nombre
üü  &
=
üü' (
actorDeNegocio
üü) 7
.
üü7 8
Actor
üü8 =
.
üü= >
	Direccion
üü> G
.
üüG H
FirstOrDefault
üüH V
(
üüV W
)
üüW X
.
üüX Y
Detalle_maestro1
üüY i
.
üüi j
nombre
üüj p
,
üüp q
Valor
††  %
=
††& '
$str
††( *
}
°° 
,
°° 
Ubigeo
¢¢ "
=
¢¢# $
new
¢¢% (
ItemGenerico
¢¢) 5
{
££ 
Id
§§  "
=
§§# $
actorDeNegocio
§§% 3
.
§§3 4
Actor
§§4 9
.
§§9 :
	Direccion
§§: C
.
§§C D
FirstOrDefault
§§D R
(
§§R S
d
§§S T
=>
§§U W
d
§§X Y
.
§§Y Z
es_principal
§§Z f
)
§§f g
.
§§g h
Ubigeo
§§h n
.
§§n o
id
§§o q
,
§§q r
Nombre
••  &
=
••' (
actorDeNegocio
••) 7
.
••7 8
Actor
••8 =
.
••= >
	Direccion
••> G
.
••G H
FirstOrDefault
••H V
(
••V W
d
••W X
=>
••Y [
d
••\ ]
.
••] ^
es_principal
••^ j
)
••j k
.
••k l
Ubigeo
••l r
.
••r s 
descripcion_larga••s Ñ
,••Ñ Ö
Valor
¶¶  %
=
¶¶& '
$str
¶¶( *
}
ßß 
,
ßß 
Detalle
®® #
=
®®$ %
actorDeNegocio
®®& 4
.
®®4 5
Actor
®®5 :
.
®®: ;
	Direccion
®®; D
.
®®D E
FirstOrDefault
®®E S
(
®®S T
d
®®T U
=>
®®V X
d
®®Y Z
.
®®Z [
es_principal
®®[ g
)
®®g h
.
®®h i
detalle
®®i p
}
©© 
}
™™ 
)
™™ 
.
™™ 
FirstOrDefault
™™ %
(
™™% &
)
™™& '
;
™™' (
if
´´ 
(
´´ 
actorComercial
´´ "
!=
´´# %
null
´´& *
)
´´* +
{
¨¨ 
actorComercial
≠≠ "
.
≠≠" #
ApellidoPaterno
≠≠# 2
=
≠≠3 4
actorComercial
≠≠5 C
.
≠≠C D
TipoPersona
≠≠D O
.
≠≠O P
Id
≠≠P R
==
≠≠S U
ActorSettings
≠≠V c
.
≠≠c d
Default
≠≠d k
.
≠≠k l(
IdTipoActorPersonaNatural≠≠l Ö
?≠≠Ü á
actorComercial≠≠à ñ
.≠≠ñ ó"
NombreORazonSocial≠≠ó ©
.≠≠© ™
Split≠≠™ Ø
(≠≠Ø ∞
$char≠≠∞ ≥
)≠≠≥ ¥
[≠≠¥ µ
$num≠≠µ ∂
]≠≠∂ ∑
:≠≠∏ π
$str≠≠∫ º
;≠≠º Ω
actorComercial
ÆÆ "
.
ÆÆ" #
ApellidoMaterno
ÆÆ# 2
=
ÆÆ3 4
actorComercial
ÆÆ5 C
.
ÆÆC D
TipoPersona
ÆÆD O
.
ÆÆO P
Id
ÆÆP R
==
ÆÆS U
ActorSettings
ÆÆV c
.
ÆÆc d
Default
ÆÆd k
.
ÆÆk l(
IdTipoActorPersonaNaturalÆÆl Ö
&&ÆÆÜ à
actorComercialÆÆâ ó
.ÆÆó ò"
NombreORazonSocialÆÆò ™
.ÆÆ™ ´
SplitÆÆ´ ∞
(ÆÆ∞ ±
$charÆÆ± ¥
)ÆÆ¥ µ
.ÆÆµ ∂
CountÆÆ∂ ª
(ÆÆª º
)ÆÆº Ω
>ÆÆæ ø
$numÆÆ¿ ¡
?ÆÆ¬ √
actorComercialÆÆƒ “
.ÆÆ“ ”"
NombreORazonSocialÆÆ” Â
.ÆÆÂ Ê
SplitÆÆÊ Î
(ÆÆÎ Ï
$charÆÆÏ Ô
)ÆÆÔ 
[ÆÆ Ò
$numÆÆÒ Ú
]ÆÆÚ Û
:ÆÆÙ ı
$strÆÆˆ ˘
;ÆÆ˘ ˙
actorComercial
ØØ "
.
ØØ" #
Nombres
ØØ# *
=
ØØ+ ,
actorComercial
ØØ- ;
.
ØØ; <
TipoPersona
ØØ< G
.
ØØG H
Id
ØØH J
==
ØØK M
ActorSettings
ØØN [
.
ØØ[ \
Default
ØØ\ c
.
ØØc d'
IdTipoActorPersonaNatural
ØØd }
&&ØØ~ Ä
actorComercialØØÅ è
.ØØè ê"
NombreORazonSocialØØê ¢
.ØØ¢ £
SplitØØ£ ®
(ØØ® ©
$charØØ© ¨
)ØØ¨ ≠
.ØØ≠ Æ
CountØØÆ ≥
(ØØ≥ ¥
)ØØ¥ µ
>ØØ∂ ∑
$numØØ∏ π
?ØØ∫ ª
actorComercialØØº  
.ØØ  À"
NombreORazonSocialØØÀ ›
.ØØ› ﬁ
SplitØØﬁ „
(ØØ„ ‰
$charØØ‰ Á
)ØØÁ Ë
[ØØË È
$numØØÈ Í
]ØØÍ Î
:ØØÏ Ì
$strØØÓ 
;ØØ Ò
actorComercial
∞∞ "
.
∞∞" # 
NombreORazonSocial
∞∞# 5
=
∞∞6 7
actorComercial
∞∞8 F
.
∞∞F G 
NombreORazonSocial
∞∞G Y
.
∞∞Y Z
Replace
∞∞Z a
(
∞∞a b
$str
∞∞b e
,
∞∞e f
$str
∞∞g j
)
∞∞j k
;
∞∞k l
if
±± 
(
±± 
idRol
±± 
==
±±  
ActorSettings
±±! .
.
±±. /
Default
±±/ 6
.
±±6 7
IdRolEmpleado
±±7 D
)
±±D E
{
≤≤ 
actorComercial
≥≥ &
.
≥≥& '
Roles
≥≥' ,
=
≥≥- .
new
≥≥/ 2
List
≥≥3 7
<
≥≥7 8
ItemGenerico
≥≥8 D
>
≥≥D E
(
≥≥E F
)
≥≥F G
;
≥≥G H
foreach
¥¥ 
(
¥¥  !
var
¥¥! $
rol
¥¥% (
in
¥¥) +
_db
¥¥, /
.
¥¥/ 0
Actor_negocio
¥¥0 =
.
¥¥= >
Where
¥¥> C
(
¥¥C D
an
¥¥D F
=>
¥¥G I
an
¥¥J L
.
¥¥L M
Rol
¥¥M P
.
¥¥P Q
id_rol_padre
¥¥Q ]
==
¥¥^ `
ActorSettings
¥¥a n
.
¥¥n o
Default
¥¥o v
.
¥¥v w
IdRolEmpleado¥¥w Ñ
&&¥¥Ö á
an¥¥à ä
.¥¥ä ã

es_vigente¥¥ã ï
==¥¥ñ ò
true¥¥ô ù
)¥¥ù û
.¥¥û ü
Select¥¥ü •
(¥¥• ¶
an¥¥¶ ®
=>¥¥© ´
an¥¥¨ Æ
.¥¥Æ Ø
Rol¥¥Ø ≤
)¥¥≤ ≥
.¥¥≥ ¥
ToList¥¥¥ ∫
(¥¥∫ ª
)¥¥ª º
)¥¥º Ω
{
µµ 
actorComercial
∂∂ *
.
∂∂* +
Roles
∂∂+ 0
.
∂∂0 1
Add
∂∂1 4
(
∂∂4 5
new
∂∂5 8
ItemGenerico
∂∂9 E
(
∂∂E F
rol
∂∂F I
.
∂∂I J
id
∂∂J L
,
∂∂L M
rol
∂∂N Q
.
∂∂Q R
nombre
∂∂R X
)
∂∂X Y
)
∂∂Y Z
;
∂∂Z [
}
∑∑ 
}
∏∏ 
}
ππ 
return
∫∫ 
actorComercial
∫∫ %
;
∫∫% &
}
ªª 
catch
ºº 
(
ºº 
	Exception
ºº 
e
ºº 
)
ºº 
{
ΩΩ 
throw
ææ 
new
ææ 
DatosException
ææ (
(
ææ( )
$str
ææ) T
,
ææT U
e
ææV W
)
ææW X
;
ææX Y
}
øø 
}
¿¿ 	
public
¬¬ 
ActorComercial_
¬¬ $
ObtenerActorComercial_
¬¬ 5
(
¬¬5 6
int
¬¬6 9
idRol
¬¬: ?
,
¬¬? @
int
¬¬A D
idTipoDocumento
¬¬E T
,
¬¬T U
string
¬¬V \
numeroDocumento
¬¬] l
)
¬¬l m
{
√√ 	
try
ƒƒ 
{
≈≈ 
SigescomEntities
∆∆  
_db
∆∆! $
=
∆∆% &
new
∆∆' *
SigescomEntities
∆∆+ ;
(
∆∆; <
)
∆∆< =
;
∆∆= >
var
«« 
actorComercial
«« "
=
««# $
_db
««% (
.
««( )
Actor_negocio
««) 6
.
««6 7
Where
««7 <
(
««< =
an
««= ?
=>
««@ B
an
««C E
.
««E F
id_rol
««F L
==
««M O
idRol
««P U
&&
««V X
an
««Y [
.
««[ \

es_vigente
««\ f
&&
««g i
an
««j l
.
««l m
Actor
««m r
.
««r s%
id_documento_identidad««s â
==««ä å
idTipoDocumento««ç ú
&&««ù ü
an««† ¢
.««¢ £
Actor««£ ®
.««® ©*
numero_documento_identidad««© √
==««ƒ ∆
numeroDocumento««« ÷
)««÷ ◊
.««◊ ÿ
Select
»» 
(
»» 
actorDeNegocio
»» )
=>
»»* ,
new
»»- 0
ActorComercial_
»»1 @
{
…… 
Id
   
=
   
actorDeNegocio
   +
.
  + ,
id
  , .
,
  . /
IdActor
ÀÀ 
=
ÀÀ  !
actorDeNegocio
ÀÀ" 0
.
ÀÀ0 1
id_actor
ÀÀ1 9
,
ÀÀ9 :
Codigo
ÃÃ 
=
ÃÃ  
actorDeNegocio
ÃÃ! /
.
ÃÃ/ 0
codigo_negocio
ÃÃ0 >
,
ÃÃ> ?
Telefono
ÕÕ  
=
ÕÕ! "
actorDeNegocio
ÕÕ# 1
.
ÕÕ1 2
Actor
ÕÕ2 7
.
ÕÕ7 8
telefono
ÕÕ8 @
,
ÕÕ@ A
Correo
ŒŒ 
=
ŒŒ  
actorDeNegocio
ŒŒ! /
.
ŒŒ/ 0
Actor
ŒŒ0 5
.
ŒŒ5 6
correo
ŒŒ6 <
,
ŒŒ< =
NombreComercial
œœ '
=
œœ( )
actorDeNegocio
œœ* 8
.
œœ8 9
Actor
œœ9 >
.
œœ> ?
segundo_nombre
œœ? M
,
œœM N 
NombreORazonSocial
–– *
=
––+ ,
actorDeNegocio
––- ;
.
––; <
Actor
––< A
.
––A B
primer_nombre
––B O
,
––O P&
NumeroDocumentoIdentidad
—— 0
=
——1 2
actorDeNegocio
——3 A
.
——A B
Actor
——B G
.
——G H(
numero_documento_identidad
——H b
,
——b c$
TipoDocumentoIdentidad
““ .
=
““/ 0
new
““1 4
ItemGenerico
““5 A
{
”” 
Id
‘‘ 
=
‘‘  
actorDeNegocio
‘‘! /
.
‘‘/ 0
Actor
‘‘0 5
.
‘‘5 6$
id_documento_identidad
‘‘6 L
,
‘‘L M
Nombre
’’ "
=
’’# $
actorDeNegocio
’’% 3
.
’’3 4
Actor
’’4 9
.
’’9 :
Detalle_maestro
’’: I
.
’’I J
valor
’’J O
,
’’O P
Valor
÷÷ !
=
÷÷" #
actorDeNegocio
÷÷$ 2
.
÷÷2 3
Actor
÷÷3 8
.
÷÷8 9
Detalle_maestro
÷÷9 H
.
÷÷H I
valor
÷÷I N
}
◊◊ 
,
◊◊ 
TipoPersona
ÿÿ #
=
ÿÿ$ %
new
ÿÿ& )
ItemGenerico
ÿÿ* 6
{
ŸŸ 
Id
⁄⁄ 
=
⁄⁄  
actorDeNegocio
⁄⁄! /
.
⁄⁄/ 0
Actor
⁄⁄0 5
.
⁄⁄5 6
id_tipo_actor
⁄⁄6 C
,
⁄⁄C D
Nombre
€€ "
=
€€# $
actorDeNegocio
€€% 3
.
€€3 4
Actor
€€4 9
.
€€9 :

Tipo_actor
€€: D
.
€€D E
nombre
€€E K
,
€€K L
Valor
‹‹ !
=
‹‹" #
$str
‹‹$ &
}
›› 
,
›› 

ClaseActor
ﬁﬁ "
=
ﬁﬁ# $
new
ﬁﬁ% (
ItemGenerico
ﬁﬁ) 5
{
ﬂﬂ 
Id
‡‡ 
=
‡‡  
actorDeNegocio
‡‡! /
.
‡‡/ 0
Actor
‡‡0 5
.
‡‡5 6
id_clase_actor
‡‡6 D
,
‡‡D E
Nombre
·· "
=
··# $
actorDeNegocio
··% 3
.
··3 4
Actor
··4 9
.
··9 :
Clase_actor
··: E
.
··E F
nombre
··F L
,
··L M
Valor
‚‚ !
=
‚‚" #
$str
‚‚$ &
}
„„ 
,
„„ 
EstadoLegal
‰‰ #
=
‰‰$ %
new
‰‰& )
ItemGenerico
‰‰* 6
{
ÂÂ 
Id
ÊÊ 
=
ÊÊ  
actorDeNegocio
ÊÊ! /
.
ÊÊ/ 0
Actor
ÊÊ0 5
.
ÊÊ5 6
id_estado_legal
ÊÊ6 E
,
ÊÊE F
Nombre
ÁÁ "
=
ÁÁ# $
actorDeNegocio
ÁÁ% 3
.
ÁÁ3 4
Actor
ÁÁ4 9
.
ÁÁ9 :
Estado_legal
ÁÁ: F
.
ÁÁF G
nombre
ÁÁG M
,
ÁÁM N
Valor
ËË !
=
ËË" #
$str
ËË$ &
}
ÈÈ 
,
ÈÈ 
FechaNacimiento
ÍÍ '
=
ÍÍ( )
actorDeNegocio
ÍÍ* 8
.
ÍÍ8 9
Actor
ÍÍ9 >
.
ÍÍ> ?
fecha_nacimiento
ÍÍ? O
,
ÍÍO P
Nacionalidad
ÎÎ $
=
ÎÎ% &
new
ÎÎ' *
ItemGenerico
ÎÎ+ 7
{
ÏÏ 
Id
ÌÌ 
=
ÌÌ  
actorDeNegocio
ÌÌ! /
.
ÌÌ/ 0
Actor
ÌÌ0 5
.
ÌÌ5 6
Detalle_maestro1
ÌÌ6 F
.
ÌÌF G
id
ÌÌG I
,
ÌÌI J
Nombre
ÓÓ "
=
ÓÓ# $
actorDeNegocio
ÓÓ% 3
.
ÓÓ3 4
Actor
ÓÓ4 9
.
ÓÓ9 :
Detalle_maestro1
ÓÓ: J
.
ÓÓJ K
nombre
ÓÓK Q
,
ÓÓQ R
Valor
ÔÔ !
=
ÔÔ" #
$str
ÔÔ$ &
}
 
,
 
DomicilioFiscal
ÒÒ '
=
ÒÒ( )
new
ÒÒ* -

Direccion_
ÒÒ. 8
{
ÚÚ 
Id
ÛÛ 
=
ÛÛ  
actorDeNegocio
ÛÛ! /
.
ÛÛ/ 0
Actor
ÛÛ0 5
.
ÛÛ5 6
	Direccion
ÛÛ6 ?
.
ÛÛ? @
FirstOrDefault
ÛÛ@ N
(
ÛÛN O
d
ÛÛO P
=>
ÛÛQ S
d
ÛÛT U
.
ÛÛU V
es_principal
ÛÛV b
)
ÛÛb c
.
ÛÛc d
id
ÛÛd f
,
ÛÛf g
Pais
ÙÙ  
=
ÙÙ! "
new
ÙÙ# &
ItemGenerico
ÙÙ' 3
{
ıı 
Id
ˆˆ  "
=
ˆˆ# $
actorDeNegocio
ˆˆ% 3
.
ˆˆ3 4
Actor
ˆˆ4 9
.
ˆˆ9 :
	Direccion
ˆˆ: C
.
ˆˆC D
FirstOrDefault
ˆˆD R
(
ˆˆR S
)
ˆˆS T
.
ˆˆT U
Detalle_maestro1
ˆˆU e
.
ˆˆe f
id
ˆˆf h
,
ˆˆh i
Nombre
˜˜  &
=
˜˜' (
actorDeNegocio
˜˜) 7
.
˜˜7 8
Actor
˜˜8 =
.
˜˜= >
	Direccion
˜˜> G
.
˜˜G H
FirstOrDefault
˜˜H V
(
˜˜V W
)
˜˜W X
.
˜˜X Y
Detalle_maestro1
˜˜Y i
.
˜˜i j
nombre
˜˜j p
,
˜˜p q
Valor
¯¯  %
=
¯¯& '
$str
¯¯( *
}
˘˘ 
,
˘˘ 
Ubigeo
˙˙ "
=
˙˙# $
new
˙˙% (
ItemGenerico
˙˙) 5
{
˚˚ 
Id
¸¸  "
=
¸¸# $
actorDeNegocio
¸¸% 3
.
¸¸3 4
Actor
¸¸4 9
.
¸¸9 :
	Direccion
¸¸: C
.
¸¸C D
FirstOrDefault
¸¸D R
(
¸¸R S
d
¸¸S T
=>
¸¸U W
d
¸¸X Y
.
¸¸Y Z
es_principal
¸¸Z f
)
¸¸f g
.
¸¸g h
Ubigeo
¸¸h n
.
¸¸n o
id
¸¸o q
,
¸¸q r
Nombre
˝˝  &
=
˝˝' (
actorDeNegocio
˝˝) 7
.
˝˝7 8
Actor
˝˝8 =
.
˝˝= >
	Direccion
˝˝> G
.
˝˝G H
FirstOrDefault
˝˝H V
(
˝˝V W
d
˝˝W X
=>
˝˝Y [
d
˝˝\ ]
.
˝˝] ^
es_principal
˝˝^ j
)
˝˝j k
.
˝˝k l
Ubigeo
˝˝l r
.
˝˝r s 
descripcion_larga˝˝s Ñ
,˝˝Ñ Ö
Valor
˛˛  %
=
˛˛& '
$str
˛˛( *
}
ˇˇ 
,
ˇˇ 
Detalle
ÄÄ #
=
ÄÄ$ %
actorDeNegocio
ÄÄ& 4
.
ÄÄ4 5
Actor
ÄÄ5 :
.
ÄÄ: ;
	Direccion
ÄÄ; D
.
ÄÄD E
FirstOrDefault
ÄÄE S
(
ÄÄS T
d
ÄÄT U
=>
ÄÄV X
d
ÄÄY Z
.
ÄÄZ [
es_principal
ÄÄ[ g
)
ÄÄg h
.
ÄÄh i
detalle
ÄÄi p
}
ÅÅ 
}
ÇÇ 
)
ÇÇ 
.
ÇÇ 
FirstOrDefault
ÇÇ %
(
ÇÇ% &
)
ÇÇ& '
;
ÇÇ' (
if
ÉÉ 
(
ÉÉ 
actorComercial
ÉÉ "
!=
ÉÉ# %
null
ÉÉ& *
)
ÉÉ* +
{
ÑÑ 
actorComercial
ÖÖ "
.
ÖÖ" #
ApellidoPaterno
ÖÖ# 2
=
ÖÖ3 4
actorComercial
ÖÖ5 C
.
ÖÖC D
TipoPersona
ÖÖD O
.
ÖÖO P
Id
ÖÖP R
==
ÖÖS U
ActorSettings
ÖÖV c
.
ÖÖc d
Default
ÖÖd k
.
ÖÖk l(
IdTipoActorPersonaNaturalÖÖl Ö
?ÖÖÜ á
actorComercialÖÖà ñ
.ÖÖñ ó"
NombreORazonSocialÖÖó ©
.ÖÖ© ™
SplitÖÖ™ Ø
(ÖÖØ ∞
$charÖÖ∞ ≥
)ÖÖ≥ ¥
[ÖÖ¥ µ
$numÖÖµ ∂
]ÖÖ∂ ∑
:ÖÖ∏ π
$strÖÖ∫ º
;ÖÖº Ω
actorComercial
ÜÜ "
.
ÜÜ" #
ApellidoMaterno
ÜÜ# 2
=
ÜÜ3 4
actorComercial
ÜÜ5 C
.
ÜÜC D
TipoPersona
ÜÜD O
.
ÜÜO P
Id
ÜÜP R
==
ÜÜS U
ActorSettings
ÜÜV c
.
ÜÜc d
Default
ÜÜd k
.
ÜÜk l(
IdTipoActorPersonaNaturalÜÜl Ö
&&ÜÜÜ à
actorComercialÜÜâ ó
.ÜÜó ò"
NombreORazonSocialÜÜò ™
.ÜÜ™ ´
SplitÜÜ´ ∞
(ÜÜ∞ ±
$charÜÜ± ¥
)ÜÜ¥ µ
.ÜÜµ ∂
CountÜÜ∂ ª
(ÜÜª º
)ÜÜº Ω
>ÜÜæ ø
$numÜÜ¿ ¡
?ÜÜ¬ √
actorComercialÜÜƒ “
.ÜÜ“ ”"
NombreORazonSocialÜÜ” Â
.ÜÜÂ Ê
SplitÜÜÊ Î
(ÜÜÎ Ï
$charÜÜÏ Ô
)ÜÜÔ 
[ÜÜ Ò
$numÜÜÒ Ú
]ÜÜÚ Û
:ÜÜÙ ı
$strÜÜˆ ˘
;ÜÜ˘ ˙
actorComercial
áá "
.
áá" #
Nombres
áá# *
=
áá+ ,
actorComercial
áá- ;
.
áá; <
TipoPersona
áá< G
.
ááG H
Id
ááH J
==
ááK M
ActorSettings
ááN [
.
áá[ \
Default
áá\ c
.
áác d'
IdTipoActorPersonaNatural
áád }
&&áá~ Ä
actorComercialááÅ è
.ááè ê"
NombreORazonSocialááê ¢
.áá¢ £
Splitáá£ ®
(áá® ©
$charáá© ¨
)áá¨ ≠
.áá≠ Æ
CountááÆ ≥
(áá≥ ¥
)áá¥ µ
>áá∂ ∑
$numáá∏ π
?áá∫ ª
actorComercialááº  
.áá  À"
NombreORazonSocialááÀ ›
.áá› ﬁ
Splitááﬁ „
(áá„ ‰
$charáá‰ Á
)ááÁ Ë
[ááË È
$numááÈ Í
]ááÍ Î
:ááÏ Ì
$strááÓ 
;áá Ò
actorComercial
àà "
.
àà" # 
NombreORazonSocial
àà# 5
=
àà6 7
actorComercial
àà8 F
.
ààF G 
NombreORazonSocial
ààG Y
.
ààY Z
Replace
ààZ a
(
ààa b
$str
ààb e
,
ààe f
$str
ààg j
)
ààj k
;
ààk l
if
ââ 
(
ââ 
idRol
ââ 
==
ââ  
ActorSettings
ââ! .
.
ââ. /
Default
ââ/ 6
.
ââ6 7
IdRolEmpleado
ââ7 D
)
ââD E
{
ää 
actorComercial
ãã &
.
ãã& '
Roles
ãã' ,
=
ãã- .
new
ãã/ 2
List
ãã3 7
<
ãã7 8
ItemGenerico
ãã8 D
>
ããD E
(
ããE F
)
ããF G
;
ããG H
foreach
åå 
(
åå  !
var
åå! $
rol
åå% (
in
åå) +
_db
åå, /
.
åå/ 0
Actor_negocio
åå0 =
.
åå= >
Where
åå> C
(
ååC D
an
ååD F
=>
ååG I
an
ååJ L
.
ååL M
Rol
ååM P
.
ååP Q
id_rol_padre
ååQ ]
==
åå^ `
ActorSettings
ååa n
.
åån o
Default
ååo v
.
ååv w
IdRolEmpleadoååw Ñ
&&ååÖ á
anååà ä
.ååä ã

es_vigenteååã ï
==ååñ ò
trueååô ù
)ååù û
.ååû ü
Selectååü •
(åå• ¶
anåå¶ ®
=>åå© ´
anåå¨ Æ
.ååÆ Ø
RolååØ ≤
)åå≤ ≥
.åå≥ ¥
ToListåå¥ ∫
(åå∫ ª
)ååª º
)ååº Ω
{
çç 
actorComercial
éé *
.
éé* +
Roles
éé+ 0
.
éé0 1
Add
éé1 4
(
éé4 5
new
éé5 8
ItemGenerico
éé9 E
(
ééE F
rol
ééF I
.
ééI J
id
ééJ L
,
ééL M
rol
ééN Q
.
ééQ R
nombre
ééR X
)
ééX Y
)
ééY Z
;
ééZ [
}
èè 
}
êê 
}
ëë 
return
íí 
actorComercial
íí %
;
íí% &
}
ìì 
catch
îî 
(
îî 
	Exception
îî 
e
îî 
)
îî 
{
ïï 
throw
ññ 
new
ññ 
DatosException
ññ (
(
ññ( )
$str
ññ) T
,
ññT U
e
ññV W
)
ññW X
;
ññX Y
}
óó 
}
òò 	
}
öö 
}õõ º∂
WD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\Actores\VinculoActor_Datos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
." #
Actores# *
{ 
public 

partial 
class 
VinculoActor_Datos +
:, -%
IVinculoActor_Repositorio. G
{ 
public 
IEnumerable 
< !
Vinculo_Actor_Negocio 0
>0 19
-ObtenerVinculosActorNegocioParaActorPrincipal2 _
(_ `
int` c#
idActorNegocioPrincipald {
,{ |
DateTime	} Ö
fecha
Ü ã
,
ã å
TipoVinculo
ç ò
tipo
ô ù
)
ù û
{ 	
SigescomEntities 
_db  
=! "
new# &
SigescomEntities' 7
(7 8
)8 9
;9 :
return 
_db 
. !
Vinculo_Actor_Negocio ,
., -
Where- 2
(2 3
van3 6
=>7 9
van: =
.= >&
id_actor_negocio_principal> X
==Y [#
idActorNegocioPrincipal\ s
&&t v
vanw z
.z {
tipo_vinculo	{ á
==
à ä
(
ã å
int
å è
)
è ê
tipo
ê î
&&
ï ó
van
ò õ
.
õ ú
desde
ú °
<=
¢ §
fecha
• ™
&&
´ ≠
van
Æ ±
.
± ≤
hasta
≤ ∑
>=
∏ ∫
fecha
ª ¿
)
¿ ¡
;
¡ ¬
} 	
public 
OperationResult &
CaducarVinculoActorNegocio 9
(9 :
int: =
	idVinculo> G
,G H
DateTimeI Q
fechaCaducidadR `
)` a
{ 	
SigescomEntities 
_db  
=! "
new# &
SigescomEntities' 7
(7 8
)8 9
;9 :
var 
vinculo 
= 
_db 
. !
Vinculo_Actor_Negocio 3
.3 4
SingleOrDefault4 C
(C D
vanD G
=>H J
vanK N
.N O
idO Q
==R T
	idVinculoU ^
&&_ a
vanb e
.e f

es_vigentef p
)p q
;q r
vinculo 
. 
hasta 
= 
fechaCaducidad *
;* +
vinculo 
. 

es_vigente 
=  
false! &
;& '
_db 
. 
SaveChanges 
( 
) 
; 
return   
new   
OperationResult   &
(  & '
OperationResultEnum  ' :
.  : ;
Success  ; B
)  B C
;  C D
}!! 	
public## 
bool##  
ExisteVinculoVigente## (
(##( )
int##) ,#
idActorNegocioVinculado##- D
,##D E
int##F I#
idActorNegocioPrincipal##J a
)##a b
{$$ 	
SigescomEntities%% 
_db%%  
=%%! "
new%%# &
SigescomEntities%%' 7
(%%7 8
)%%8 9
;%%9 :
return&& 
_db&& 
.&& !
Vinculo_Actor_Negocio&& ,
.&&, -
Any&&- 0
(&&0 1
van&&1 4
=>&&5 7
van&&8 ;
.&&; <&
id_actor_negocio_vinculado&&< V
==&&W Y#
idActorNegocioVinculado&&Z q
&&&&r t
van&&u x
.&&x y'
id_actor_negocio_principal	&&y ì
==
&&î ñ%
idActorNegocioPrincipal
&&ó Æ
&&
&&Ø ±
van
&&≤ µ
.
&&µ ∂

es_vigente
&&∂ ¿
)
&&¿ ¡
;
&&¡ ¬
}'' 	
public)) 
OperationResult)) $
CrearVinculoActorNegocio)) 7
())7 8!
Vinculo_Actor_Negocio))8 M
vinculoActorNegocio))N a
)))a b
{** 	
try++ 
{,, 
SigescomEntities--  
_db--! $
=--% &
new--' *
SigescomEntities--+ ;
(--; <
)--< =
;--= >
_db.. 
... !
Vinculo_Actor_Negocio.. )
...) *
Add..* -
(..- .
vinculoActorNegocio... A
)..A B
;..B C
_db// 
.// 
SaveChanges// 
(//  
)//  !
;//! "
var00 
result00 
=00 
new00  
OperationResult00! 0
(000 1
OperationResultEnum001 D
.00D E
Success00E L
)00L M
;00M N
result11 
.11 
data11 
=11 
vinculoActorNegocio11 1
.111 2
id112 4
;114 5
return22 
result22 
;22 
}33 
catch44 
(44 
	Exception44 
e44 
)44 
{55 
throw66 
e66 
;66 
}77 
}88 	
public:: 
bool:: %
ExisteCodigoGrupoClientes:: -
(::- .
int::. 1
enumTipoVinculo::2 A
,::A B
string::C I
codigoGrupoClientes::J ]
)::] ^
{;; 	
SigescomEntities<< 
_db<<  
=<<! "
new<<# &
SigescomEntities<<' 7
(<<7 8
)<<8 9
;<<9 :
return== 
_db== 
.== !
Vinculo_Actor_Negocio== ,
.==, -
Where==- 2
(==2 3
van==3 6
=>==7 9
van==: =
.=== >
tipo_vinculo==> J
====K M
enumTipoVinculo==N ]
)==] ^
.==^ _
Any==_ b
(==b c
van==c f
=>==g i
van==j m
.==m n
Actor_negocio==n {
.=={ |
Actor	==| Å
.
==Å Ç(
numero_documento_identidad
==Ç ú
==
==ù ü!
codigoGrupoClientes
==† ≥
)
==≥ ¥
;
==¥ µ
}>> 	
public?? 
bool?? =
1ExisteNombreGrupoClientesEnGruposClientesVigentes?? E
(??E F
int??F I
enumTipoVinculo??J Y
,??Y Z
string??[ a
nombreGrupoClientes??b u
)??u v
{@@ 	
SigescomEntitiesAA 
_dbAA  
=AA! "
newAA# &
SigescomEntitiesAA' 7
(AA7 8
)AA8 9
;AA9 :
returnBB 
_dbBB 
.BB !
Vinculo_Actor_NegocioBB ,
.BB, -
WhereBB- 2
(BB2 3
vanBB3 6
=>BB7 9
vanBB: =
.BB= >
tipo_vinculoBB> J
==BBK M
enumTipoVinculoBBN ]
)BB] ^
.BB^ _
AnyBB_ b
(BBb c
vanBBc f
=>BBg i
vanBBj m
.BBm n
Actor_negocioBBn {
.BB{ |
Actor	BB| Å
.
BBÅ Ç
primer_nombre
BBÇ è
==
BBê í!
nombreGrupoClientes
BBì ¶
&&
BBß ©
van
BB™ ≠
.
BB≠ Æ
Actor_negocio
BBÆ ª
.
BBª º

es_vigente
BBº ∆
)
BB∆ «
;
BB« »
}CC 	
publicEE 
boolEE 9
-ExisteCodigoGrupoClientesExceptoGrupoClientesEE A
(EEA B
intEEB E
enumTipoVinculoEEF U
,EEU V
stringEEW ]
codigoGrupoClientesEE^ q
,EEq r
intEEs v
idGrupoClientes	EEw Ü
)
EEÜ á
{FF 	
SigescomEntitiesGG 
_dbGG  
=GG! "
newGG# &
SigescomEntitiesGG' 7
(GG7 8
)GG8 9
;GG9 :
returnHH 
_dbHH 
.HH !
Vinculo_Actor_NegocioHH ,
.HH, -
WhereHH- 2
(HH2 3
vanHH3 6
=>HH7 9
vanHH: =
.HH= >
tipo_vinculoHH> J
==HHK M
enumTipoVinculoHHN ]
)HH] ^
.HH^ _
AnyHH_ b
(HHb c
vanHHc f
=>HHg i
vanHHj m
.HHm n
Actor_negocioHHn {
.HH{ |
Actor	HH| Å
.
HHÅ Ç(
numero_documento_identidad
HHÇ ú
==
HHù ü!
codigoGrupoClientes
HH† ≥
&&
HH¥ ∂
van
HH∑ ∫
.
HH∫ ª
Actor_negocio
HHª »
.
HH» …
id
HH… À
!=
HHÃ Œ
idGrupoClientes
HHœ ﬁ
)
HHﬁ ﬂ
;
HHﬂ ‡
}II 	
publicJJ 
boolJJ Q
EExisteNombreGrupoClientesEnGruposClientesVigentesExceptoGrupoClientesJJ Y
(JJY Z
intJJZ ]
enumTipoVinculoJJ^ m
,JJm n
stringJJo u 
nombreGrupoClientes	JJv â
,
JJâ ä
int
JJã é
idGrupoClientes
JJè û
)
JJû ü
{KK 	
SigescomEntitiesLL 
_dbLL  
=LL! "
newLL# &
SigescomEntitiesLL' 7
(LL7 8
)LL8 9
;LL9 :
returnMM 
_dbMM 
.MM !
Vinculo_Actor_NegocioMM ,
.MM, -
WhereMM- 2
(MM2 3
vanMM3 6
=>MM7 9
vanMM: =
.MM= >
tipo_vinculoMM> J
==MMK M
enumTipoVinculoMMN ]
)MM] ^
.MM^ _
AnyMM_ b
(MMb c
vanMMc f
=>MMg i
vanMMj m
.MMm n
Actor_negocioMMn {
.MM{ |
Actor	MM| Å
.
MMÅ Ç
primer_nombre
MMÇ è
==
MMê í!
nombreGrupoClientes
MMì ¶
&&
MMß ©
van
MM™ ≠
.
MM≠ Æ
Actor_negocio
MMÆ ª
.
MMª º

es_vigente
MMº ∆
&&
MM« …
van
MM  Õ
.
MMÕ Œ
Actor_negocio
MMŒ €
.
MM€ ‹
id
MM‹ ﬁ
!=
MMﬂ ·
idGrupoClientes
MM‚ Ò
)
MMÒ Ú
;
MMÚ Û
}NN 	
publicPP 
boolPP B
6ExisteDeudaDeClienteEnOperacionesVentaConGrupoClientesPP J
(PPJ K
intPPK N
	idClientePPO X
,PPX Y
intPPZ ]
idGrupoClientesPP^ m
)PPm n
{QQ 	
SigescomEntitiesRR 
_dbRR  
=RR! "
newRR# &
SigescomEntitiesRR' 7
(RR7 8
)RR8 9
;RR9 :
returnSS 
_dbSS 
.SS 
TransaccionSS "
.SS" #
WhereSS# (
(SS( )
tSS) *
=>SS+ -
DiccionarioSS. 9
.SS9 ::
.TiposDeTransaccionOrdenesDeOperacionesDeVentasSS: h
.SSh i
ContainsSSi q
(SSq r
tSSr s
.SSs t 
id_tipo_transaccion	SSt á
)
SSá à
&&
SSâ ã
t
SSå ç
.
SSç é&
id_actor_negocio_externo
SSé ¶
==
SSß ©
	idCliente
SS™ ≥
&&
SS¥ ∂
t
SS∑ ∏
.
SS∏ π'
id_actor_negocio_externo1
SSπ “
==
SS” ’
idGrupoClientes
SS÷ Â
)
SSÂ Ê
.
SSÊ Á

SelectMany
SSÁ Ò
(
SSÒ Ú
t
SSÚ Û
=>
SSÙ ˆ
t
SS˜ ¯
.
SS¯ ˘
Cuota
SS˘ ˛
)
SS˛ ˇ
.
SSˇ Ä
Any
SSÄ É
(
SSÉ Ñ
c
SSÑ Ö
=>
SSÜ à
c
SSâ ä
.
SSä ã
pago_a_cuenta
SSã ò
-
SSô ö
c
SSõ ú
.
SSú ù
total
SSù ¢
>
SS£ §
$num
SS• ¶
)
SS¶ ß
;
SSß ®
}TT 	
publicVV 
boolVV 8
,ExisteDeudaDeGrupoClientesEnOperacionesVentaVV @
(VV@ A
intVVA D
idGrupoClientesVVE T
)VVT U
{WW 	
SigescomEntitiesXX 
_dbXX  
=XX! "
newXX# &
SigescomEntitiesXX' 7
(XX7 8
)XX8 9
;XX9 :
returnYY 
_dbYY 
.YY 
TransaccionYY "
.YY" #
WhereYY# (
(YY( )
tYY) *
=>YY+ -
DiccionarioYY. 9
.YY9 ::
.TiposDeTransaccionOrdenesDeOperacionesDeVentasYY: h
.YYh i
ContainsYYi q
(YYq r
tYYr s
.YYs t 
id_tipo_transaccion	YYt á
)
YYá à
&&
YYâ ã
t
YYå ç
.
YYç é'
id_actor_negocio_externo1
YYé ß
==
YY® ™
idGrupoClientes
YY´ ∫
)
YY∫ ª
.
YYª º

SelectMany
YYº ∆
(
YY∆ «
t
YY« »
=>
YY… À
t
YYÃ Õ
.
YYÕ Œ
Cuota
YYŒ ”
)
YY” ‘
.
YY‘ ’
Any
YY’ ÿ
(
YYÿ Ÿ
c
YYŸ ⁄
=>
YY€ ›
c
YYﬁ ﬂ
.
YYﬂ ‡
saldo
YY‡ Â
>
YYÊ Á
$num
YYË È
)
YYÈ Í
;
YYÍ Î
}ZZ 	
public\\ 
OperationResult\\ ;
/ActualizarActorPrincipalConVinculosActorNegocio\\ N
(\\N O
Actor_negocio\\O \#
actorNegocioConVinculos\\] t
)\\t u
{]] 	
try^^ 
{__ 
SigescomEntities``  
_db``! $
=``% &
new``' *
SigescomEntities``+ ;
(``; <
)``< =
;``= >
varaa #
dbActorNegocioPrincipalaa +
=aa, -
_dbaa. 1
.aa1 2
Actor_negocioaa2 ?
.aa? @
Includeaa@ G
(aaG H
anaaH J
=>aaK M
anaaN P
.aaP Q
ActoraaQ V
)aaV W
.aaW X
SingleaaX ^
(aa^ _
anaa_ a
=>aab d
anaae g
.aag h
idaah j
==aak m$
actorNegocioConVinculos	aan Ö
.
aaÖ Ü
id
aaÜ à
)
aaà â
;
aaâ ä
_dbbb 
.bb 
Entrybb 
(bb #
dbActorNegocioPrincipalbb 1
)bb1 2
.bb2 3
CurrentValuesbb3 @
.bb@ A
	SetValuesbbA J
(bbJ K#
actorNegocioConVinculosbbK b
)bbb c
;bbc d
_dbcc 
.cc 
Entrycc 
(cc #
dbActorNegocioPrincipalcc 1
.cc1 2
Actorcc2 7
)cc7 8
.cc8 9
CurrentValuescc9 F
.ccF G
	SetValuesccG P
(ccP Q#
actorNegocioConVinculosccQ h
.cch i
Actorcci n
)ccn o
;cco p!
Vinculo_Actor_Negocioee %0
$dbVinculoActoresDeNegocioResponsableee& J
=eeK L
_dbeeM P
.eeP Q!
Vinculo_Actor_NegocioeeQ f
.eef g
FirstOrDefaulteeg u
(eeu v
vaneev y
=>eez |
van	ee} Ä
.
eeÄ Å(
id_actor_negocio_vinculado
eeÅ õ
==
eeú û%
actorNegocioConVinculos
eeü ∂
.
ee∂ ∑
id
ee∑ π
&&
ee∫ º
van
eeΩ ¿
.
ee¿ ¡

es_vigente
ee¡ À
==
eeÃ Œ
true
eeœ ”
&&
ee‘ ÷
van
ee◊ ⁄
.
ee⁄ €
tipo_vinculo
ee€ Á
==
eeË Í
(
eeÎ Ï
int
eeÏ Ô
)
eeÔ 
TipoVinculo
ee ˚
.
ee˚ ¸
ResponsableGrupo
ee¸ å
)
eeå ç
;
eeç é0
$dbVinculoActoresDeNegocioResponsablegg 4
.gg4 5&
id_actor_negocio_principalgg5 O
=ggP Q#
actorNegocioConVinculosggR i
.ggi j#
Vinculo_Actor_Negocio1	ggj Ä
.
ggÄ Å
First
ggÅ Ü
(
ggÜ á
)
ggá à
.
ggà â(
id_actor_negocio_principal
ggâ £
;
gg£ §
Listii 
<ii !
Vinculo_Actor_Negocioii *
>ii* +&
dbVinculosActoresDeNegocioii, F
=iiG H
_dbiiI L
.iiL M!
Vinculo_Actor_NegocioiiM b
.iib c
Whereiic h
(iih i
vaniii l
=>iim o
vaniip s
.iis t'
id_actor_negocio_principal	iit é
==
iiè ë%
actorNegocioConVinculos
iií ©
.
ii© ™
id
ii™ ¨
&&
ii≠ Ø
van
ii∞ ≥
.
ii≥ ¥

es_vigente
ii¥ æ
==
iiø ¡
true
ii¬ ∆
&&
ii« …
van
ii  Õ
.
iiÕ Œ
tipo_vinculo
iiŒ ⁄
==
ii€ ›
(
iiﬁ ﬂ
int
iiﬂ ‚
)
ii‚ „
TipoVinculo
ii„ Ó
.
iiÓ Ô
MiembroGrupo
iiÔ ˚
)
ii˚ ¸
.
ii¸ ˝
ToList
ii˝ É
(
iiÉ Ñ
)
iiÑ Ö
;
iiÖ Ü
foreachjj 
(jj 
varjj 
	dbVinculojj &
injj' )&
dbVinculosActoresDeNegociojj* D
)jjD E
{kk 
ifll 
(ll 
!ll #
actorNegocioConVinculosll 0
.ll0 1!
Vinculo_Actor_Negocioll1 F
.llF G
AnyllG J
(llJ K
vanllK N
=>llO Q
vanllR U
.llU V&
id_actor_negocio_vinculadollV p
==llq s
	dbVinculollt }
.ll} ~'
id_actor_negocio_vinculado	ll~ ò
)
llò ô
)
llô ö
{mm 
	dbVinculonn !
.nn! "
hastann" '
=nn( )
DateTimeUtilnn* 6
.nn6 7
FechaActualnn7 B
(nnB C
)nnC D
;nnD E
	dbVinculooo !
.oo! "

es_vigenteoo" ,
=oo- .
falseoo/ 4
;oo4 5
}pp 
}qq 
foreachrr 
(rr 
varrr 
vinculorr $
inrr% '#
actorNegocioConVinculosrr( ?
.rr? @!
Vinculo_Actor_Negociorr@ U
)rrU V
{ss 
iftt 
(tt 
!tt &
dbVinculosActoresDeNegociott 3
.tt3 4
Anytt4 7
(tt7 8
vantt8 ;
=>tt< >
vantt? B
.ttB C&
id_actor_negocio_vinculadottC ]
==tt^ `
vinculotta h
.tth i'
id_actor_negocio_vinculado	tti É
)
ttÉ Ñ
)
ttÑ Ö
{uu 
_dbvv 
.vv !
Vinculo_Actor_Negociovv 1
.vv1 2
Addvv2 5
(vv5 6
vinculovv6 =
)vv= >
;vv> ?
}ww 
}xx 
_dbyy 
.yy 
SaveChangesyy 
(yy  
)yy  !
;yy! "
returnzz 
newzz 
OperationResultzz *
(zz* +
OperationResultEnumzz+ >
.zz> ?
Successzz? F
)zzF G
;zzG H
}{{ 
catch|| 
(|| 
	Exception|| 
e|| 
)|| 
{}} 
throw~~ 
e~~ 
;~~ 
} 
}
ÄÄ 	
public
ÇÇ 
IEnumerable
ÇÇ 
<
ÇÇ "
GrupoClientesResumen
ÇÇ /
>
ÇÇ/ 0#
ObtenerGruposClientes
ÇÇ1 F
(
ÇÇF G
)
ÇÇG H
{
ÉÉ 	
try
ÑÑ 
{
ÖÖ 
SigescomEntities
ÜÜ  
_db
ÜÜ! $
=
ÜÜ% &
new
ÜÜ' *
SigescomEntities
ÜÜ+ ;
(
ÜÜ; <
)
ÜÜ< =
;
ÜÜ= >
var
áá 
	resultado
áá 
=
áá 
_db
áá  #
.
áá# $
Actor_negocio
áá$ 1
.
áá1 2
Where
áá2 7
(
áá7 8
an
áá8 :
=>
áá; =
an
áá> @
.
áá@ A
id_rol
ááA G
==
ááH J
ActorSettings
ááK X
.
ááX Y
Default
ááY `
.
áá` a 
IdRolGrupoClientes
ááa s
)
áás t
.
áát u
Select
ááu {
(
áá{ |
an
áá| ~
=>áá Å
newááÇ Ö$
GrupoClientesResumenááÜ ö
{
àà 
Id
ââ 
=
ââ 
an
ââ 
.
ââ 
id
ââ 
,
ââ 
Codigo
ää 
=
ää 
an
ää 
.
ää  
Actor
ää  %
.
ää% &(
numero_documento_identidad
ää& @
,
ää@ A
Nombre
ãã 
=
ãã 
an
ãã 
.
ãã  
Actor
ãã  %
.
ãã% &
primer_nombre
ãã& 3
,
ãã3 4
	EsVigente
åå 
=
åå 
an
åå  "
.
åå" #

es_vigente
åå# -
,
åå- .
Tipo
çç 
=
çç 
an
çç 
.
çç 
Actor
çç #
.
çç# $
Detalle_maestro1
çç$ 4
.
çç4 5
nombre
çç5 ;
,
çç; <
Clasificacion
éé !
=
éé" #
an
éé$ &
.
éé& '
Actor
éé' ,
.
éé, -
Detalle_maestro2
éé- =
.
éé= >
nombre
éé> D
,
ééD E"
DocumentoResponsable
èè (
=
èè) *
an
èè+ -
.
èè- .$
Vinculo_Actor_Negocio1
èè. D
.
èèD E
FirstOrDefault
èèE S
(
èèS T
)
èèT U
.
èèU V
Actor_negocio
èèV c
.
èèc d
Actor
èèd i
.
èèi j
Detalle_maestro
èèj y
.
èèy z
valor
èèz 
+èèÄ Å
$strèèÇ á
+èèà â
anèèä å
.èèå ç&
Vinculo_Actor_Negocio1èèç £
.èè£ §
FirstOrDefaultèè§ ≤
(èè≤ ≥
)èè≥ ¥
.èè¥ µ
Actor_negocioèèµ ¬
.èè¬ √
Actorèè√ »
.èè» …*
numero_documento_identidadèè… „
,èè„ ‰
NombreResponsable
êê %
=
êê& '
an
êê( *
.
êê* +$
Vinculo_Actor_Negocio1
êê+ A
.
êêA B
FirstOrDefault
êêB P
(
êêP Q
)
êêQ R
.
êêR S
Actor_negocio
êêS `
.
êê` a
Actor
êêa f
.
êêf g
primer_nombre
êêg t
.
êêt u
Replace
êêu |
(
êê| }
$strêê} Ä
,êêÄ Å
$strêêÇ Ö
)êêÖ Ü
,êêÜ á!
TelefonoResponsable
ëë '
=
ëë( )
an
ëë* ,
.
ëë, -$
Vinculo_Actor_Negocio1
ëë- C
.
ëëC D
FirstOrDefault
ëëD R
(
ëëR S
)
ëëS T
.
ëëT U
Actor_negocio
ëëU b
.
ëëb c
Actor
ëëc h
.
ëëh i
telefono
ëëi q
,
ëëq r
CorreoResponsable
íí %
=
íí& '
an
íí( *
.
íí* +$
Vinculo_Actor_Negocio1
íí+ A
.
ííA B
FirstOrDefault
ííB P
(
ííP Q
)
ííQ R
.
ííR S
Actor_negocio
ííS `
.
íí` a
Actor
íía f
.
ííf g
correo
ííg m
,
íím n
Clientes
ìì 
=
ìì 
an
ìì !
.
ìì! "#
Vinculo_Actor_Negocio
ìì" 7
.
ìì7 8
Select
ìì8 >
(
ìì> ?
van
ìì? B
=>
ììC E
new
ììF I"
MiembroGrupoClientes
ììJ ^
{
îî 
Id
ïï 
=
ïï 
van
ïï  
.
ïï  !(
id_actor_negocio_vinculado
ïï! ;
,
ïï; <
	Documento
ññ !
=
ññ" #
van
ññ$ '
.
ññ' (
Actor_negocio1
ññ( 6
.
ññ6 7
Actor
ññ7 <
.
ññ< =
Detalle_maestro
ññ= L
.
ññL M
valor
ññM R
+
ññS T
$str
ññU Z
+
ññ[ \
van
ññ] `
.
ññ` a
Actor_negocio1
ñña o
.
ñño p
Actor
ññp u
.
ññu v)
numero_documento_identidadññv ê
,ññê ë
Nombre
óó 
=
óó  
van
óó! $
.
óó$ %
Actor_negocio1
óó% 3
.
óó3 4
Actor
óó4 9
.
óó9 :
primer_nombre
óó: G
.
óóG H
Replace
óóH O
(
óóO P
$str
óóP S
,
óóS T
$str
óóU X
)
óóX Y
,
óóY Z
	EsVigente
òò !
=
òò" #
van
òò$ '
.
òò' (

es_vigente
òò( 2
}
ôô 
)
ôô 
.
ôô 
ToList
ôô 
(
ôô 
)
ôô 
}
öö 
)
öö 
.
öö 
ToList
öö 
(
öö 
)
öö 
;
öö 
return
‡‡ 
	resultado
‡‡  
;
‡‡  !
}
·· 
catch
‚‚ 
(
‚‚ 
	Exception
‚‚ 
e
‚‚ 
)
‚‚ 
{
„„ 
throw
‰‰ 
new
‰‰ 
DatosException
‰‰ (
(
‰‰( )
$str
‰‰) W
,
‰‰W X
e
‰‰Y Z
)
‰‰Z [
;
‰‰[ \
}
ÂÂ 
}
ÊÊ 	
public
ËË 
GrupoClientes
ËË "
ObtenerGrupoClientes
ËË 1
(
ËË1 2
int
ËË2 5
enumTipoVinculo
ËË6 E
,
ËËE F
int
ËËG J
idGrupoCliente
ËËK Y
)
ËËY Z
{
ÈÈ 	
try
ÍÍ 
{
ÎÎ 
SigescomEntities
ÏÏ  
_db
ÏÏ! $
=
ÏÏ% &
new
ÏÏ' *
SigescomEntities
ÏÏ+ ;
(
ÏÏ; <
)
ÏÏ< =
;
ÏÏ= >
var
ÌÌ 
	resultado
ÌÌ 
=
ÌÌ 
_db
ÌÌ  #
.
ÌÌ# $
Actor_negocio
ÌÌ$ 1
.
ÌÌ1 2
Where
ÌÌ2 7
(
ÌÌ7 8
an
ÌÌ8 :
=>
ÌÌ; =
an
ÌÌ> @
.
ÌÌ@ A
id_rol
ÌÌA G
==
ÌÌH J
ActorSettings
ÌÌK X
.
ÌÌX Y
Default
ÌÌY `
.
ÌÌ` a 
IdRolGrupoClientes
ÌÌa s
&&
ÌÌt v
an
ÌÌw y
.
ÌÌy z
id
ÌÌz |
==
ÌÌ} 
idGrupoClienteÌÌÄ é
)ÌÌé è
.ÌÌè ê
SelectÌÌê ñ
(ÌÌñ ó
anÌÌó ô
=>ÌÌö ú
newÌÌù †
GrupoClientesÌÌ° Æ
{
ÓÓ 
Id
ÔÔ 
=
ÔÔ 
an
ÔÔ 
.
ÔÔ 
id
ÔÔ 
,
ÔÔ 
IdActor
 
=
 
an
  
.
  !
id_actor
! )
,
) *
Codigo
ÒÒ 
=
ÒÒ 
an
ÒÒ 
.
ÒÒ  
Actor
ÒÒ  %
.
ÒÒ% &(
numero_documento_identidad
ÒÒ& @
,
ÒÒ@ A
Nombre
ÚÚ 
=
ÚÚ 
an
ÚÚ 
.
ÚÚ  
Actor
ÚÚ  %
.
ÚÚ% &
primer_nombre
ÚÚ& 3
,
ÚÚ3 4
Tipo
ÛÛ 
=
ÛÛ 
new
ÛÛ 
ItemGenericoBase
ÛÛ /
{
ÙÙ 
Id
ıı 
=
ıı 
(
ıı 
int
ıı !
)
ıı! "
an
ıı" $
.
ıı$ %
Actor
ıı% *
.
ıı* +'
id_detalle_multiproposito
ıı+ D
,
ııD E
Nombre
ˆˆ 
=
ˆˆ  
an
ˆˆ! #
.
ˆˆ# $
Actor
ˆˆ$ )
.
ˆˆ) *
Detalle_maestro1
ˆˆ* :
.
ˆˆ: ;
nombre
ˆˆ; A
,
ˆˆA B
}
˜˜ 
,
˜˜ 
Clasificacion
¯¯ !
=
¯¯" #
new
¯¯$ '
ItemGenericoBase
¯¯( 8
{
˘˘ 
Id
˙˙ 
=
˙˙ 
(
˙˙ 
int
˙˙ !
)
˙˙! "
an
˙˙" $
.
˙˙$ %
Actor
˙˙% *
.
˙˙* +(
id_detalle_multiproposito1
˙˙+ E
,
˙˙E F
Nombre
˚˚ 
=
˚˚  
an
˚˚! #
.
˚˚# $
Actor
˚˚$ )
.
˚˚) *
Detalle_maestro2
˚˚* :
.
˚˚: ;
nombre
˚˚; A
,
˚˚A B
}
¸¸ 
,
¸¸ 
Responsable
˝˝ 
=
˝˝  !
new
˝˝" %
ActorComercial_
˝˝& 5
{
˛˛ 
Id
ˇˇ 
=
ˇˇ 
(
ˇˇ 
int
ˇˇ !
)
ˇˇ! "
an
ˇˇ" $
.
ˇˇ$ %$
Vinculo_Actor_Negocio1
ˇˇ% ;
.
ˇˇ; <
FirstOrDefault
ˇˇ< J
(
ˇˇJ K
)
ˇˇK L
.
ˇˇL M(
id_actor_negocio_principal
ˇˇM g
}
ÄÄ 
,
ÄÄ 
Clientes
ÅÅ 
=
ÅÅ 
an
ÅÅ !
.
ÅÅ! "#
Vinculo_Actor_Negocio
ÅÅ" 7
.
ÅÅ7 8
Where
ÅÅ8 =
(
ÅÅ= >
van
ÅÅ> A
=>
ÅÅB D
van
ÅÅE H
.
ÅÅH I

es_vigente
ÅÅI S
)
ÅÅS T
.
ÅÅT U
Select
ÅÅU [
(
ÅÅ[ \
van
ÅÅ\ _
=>
ÅÅ` b
new
ÅÅc f"
MiembroGrupoClientes
ÅÅg {
{
ÇÇ 
Id
ÉÉ 
=
ÉÉ 
van
ÉÉ  
.
ÉÉ  !(
id_actor_negocio_vinculado
ÉÉ! ;
,
ÉÉ; <
	Documento
ÑÑ !
=
ÑÑ" #
van
ÑÑ$ '
.
ÑÑ' (
Actor_negocio1
ÑÑ( 6
.
ÑÑ6 7
Actor
ÑÑ7 <
.
ÑÑ< =
Detalle_maestro
ÑÑ= L
.
ÑÑL M
valor
ÑÑM R
+
ÑÑS T
$str
ÑÑU Z
+
ÑÑ[ \
van
ÑÑ] `
.
ÑÑ` a
Actor_negocio1
ÑÑa o
.
ÑÑo p
Actor
ÑÑp u
.
ÑÑu v)
numero_documento_identidadÑÑv ê
,ÑÑê ë
Nombre
ÖÖ 
=
ÖÖ  
van
ÖÖ! $
.
ÖÖ$ %
Actor_negocio1
ÖÖ% 3
.
ÖÖ3 4
Actor
ÖÖ4 9
.
ÖÖ9 :
primer_nombre
ÖÖ: G
.
ÖÖG H
Replace
ÖÖH O
(
ÖÖO P
$str
ÖÖP S
,
ÖÖS T
$str
ÖÖU X
)
ÖÖX Y
,
ÖÖY Z
	EsVigente
ÜÜ !
=
ÜÜ" #
van
ÜÜ$ '
.
ÜÜ' (

es_vigente
ÜÜ( 2
}
áá 
)
áá 
.
áá 
ToList
áá 
(
áá 
)
áá 
}
àà 
)
àà 
.
àà 
SingleOrDefault
àà "
(
àà" #
)
àà# $
;
àà$ %
return
±± 
	resultado
±±  
;
±±  !
}
≤≤ 
catch
≥≥ 
(
≥≥ 
	Exception
≥≥ 
e
≥≥ 
)
≥≥ 
{
¥¥ 
throw
µµ 
new
µµ 
DatosException
µµ (
(
µµ( )
$str
µµ) Y
,
µµY Z
e
µµ[ \
)
µµ\ ]
;
µµ] ^
}
∂∂ 
}
∑∑ 	
public
∏∏ 
IEnumerable
∏∏ 
<
∏∏ 
ItemGenerico
∏∏ '
>
∏∏' (-
ObtenerGruposActoresComerciales
∏∏) H
(
∏∏H I
int
∏∏I L
[
∏∏L M
]
∏∏M N
idsRolesGrupos
∏∏O ]
)
∏∏] ^
{
ππ 	
try
∫∫ 
{
ªª 
SigescomEntities
ºº  
_db
ºº! $
=
ºº% &
new
ºº' *
SigescomEntities
ºº+ ;
(
ºº; <
)
ºº< =
;
ºº= >
var
ΩΩ 
	resultado
ΩΩ 
=
ΩΩ 
_db
ΩΩ  #
.
ΩΩ# $
Actor_negocio
ΩΩ$ 1
.
ΩΩ1 2
Where
ΩΩ2 7
(
ΩΩ7 8
an
ΩΩ8 :
=>
ΩΩ; =
idsRolesGrupos
ΩΩ> L
.
ΩΩL M
Contains
ΩΩM U
(
ΩΩU V
an
ΩΩV X
.
ΩΩX Y
id_rol
ΩΩY _
)
ΩΩ_ `
&&
ΩΩa c
an
ΩΩd f
.
ΩΩf g

es_vigente
ΩΩg q
)
ΩΩq r
.
ΩΩr s
Select
ΩΩs y
(
ΩΩy z
an
ΩΩz |
=>
ΩΩ} 
newΩΩÄ É
ItemGenericoΩΩÑ ê
{
ææ 
Id
øø 
=
øø 
an
øø 
.
øø 
id
øø 
,
øø 
Nombre
¿¿ 
=
¿¿ 
an
¿¿ 
.
¿¿  
Actor
¿¿  %
.
¿¿% &(
numero_documento_identidad
¿¿& @
+
¿¿A B
$str
¿¿C H
+
¿¿I J
an
¿¿K M
.
¿¿M N
Actor
¿¿N S
.
¿¿S T
primer_nombre
¿¿T a
}
¡¡ 
)
¡¡ 
.
¡¡ 
ToList
¡¡ 
(
¡¡ 
)
¡¡ 
;
¡¡ 
return
¬¬ 
	resultado
¬¬  
;
¬¬  !
}
√√ 
catch
ƒƒ 
(
ƒƒ 
	Exception
ƒƒ 
e
ƒƒ 
)
ƒƒ 
{
≈≈ 
throw
∆∆ 
new
∆∆ 
DatosException
∆∆ (
(
∆∆( )
$str
∆∆) W
,
∆∆W X
e
∆∆Y Z
)
∆∆Z [
;
∆∆[ \
}
«« 
}
»» 	
public
   
IEnumerable
   
<
   
ItemGenerico
   '
>
  ' (3
%ObtenerGruposActoresComercialesPorRol
  ) N
(
  N O
int
  O R

idRolGrupo
  S ]
)
  ] ^
{
ÀÀ 	
try
ÃÃ 
{
ÕÕ 
SigescomEntities
ŒŒ  
_db
ŒŒ! $
=
ŒŒ% &
new
ŒŒ' *
SigescomEntities
ŒŒ+ ;
(
ŒŒ; <
)
ŒŒ< =
;
ŒŒ= >
var
œœ 
	resultado
œœ 
=
œœ 
_db
œœ  #
.
œœ# $
Actor_negocio
œœ$ 1
.
œœ1 2
Where
œœ2 7
(
œœ7 8
an
œœ8 :
=>
œœ; =
an
œœ> @
.
œœ@ A
id_rol
œœA G
==
œœH J

idRolGrupo
œœK U
&&
œœV X
an
œœY [
.
œœ[ \

es_vigente
œœ\ f
)
œœf g
.
œœg h
Select
œœh n
(
œœn o
an
œœo q
=>
œœr t
new
œœu x
ItemGenericoœœy Ö
{
–– 
Id
—— 
=
—— 
an
—— 
.
—— 
id
—— 
,
—— 
Nombre
““ 
=
““ 
an
““ 
.
““  
Actor
““  %
.
““% &(
numero_documento_identidad
““& @
+
““A B
$str
““C H
+
““I J
an
““K M
.
““M N
Actor
““N S
.
““S T
primer_nombre
““T a
}
”” 
)
”” 
.
”” 
ToList
”” 
(
”” 
)
”” 
;
”” 
return
‘‘ 
	resultado
‘‘  
;
‘‘  !
}
’’ 
catch
÷÷ 
(
÷÷ 
	Exception
÷÷ 
e
÷÷ 
)
÷÷ 
{
◊◊ 
throw
ÿÿ 
new
ÿÿ 
DatosException
ÿÿ (
(
ÿÿ( )
$str
ÿÿ) W
,
ÿÿW X
e
ÿÿY Z
)
ÿÿZ [
;
ÿÿ[ \
}
ŸŸ 
}
⁄⁄ 	
public
‹‹ 
IEnumerable
‹‹ 
<
‹‹ 
ItemGenerico
‹‹ '
>
‹‹' (F
8ObtenerActoresComercialesDeGrupoActoresComercialesPorRol
‹‹) a
(
‹‹a b
int
‹‹b e
enumTipoVinculo
‹‹f u
,
‹‹u v
int
‹‹w z

idRolGrupo‹‹{ Ö
,‹‹Ö Ü
int‹‹á ä)
idGrupoActoresComerciales‹‹ã §
)‹‹§ •
{
›› 	
try
ﬁﬁ 
{
ﬂﬂ 
SigescomEntities
‡‡  
_db
‡‡! $
=
‡‡% &
new
‡‡' *
SigescomEntities
‡‡+ ;
(
‡‡; <
)
‡‡< =
;
‡‡= >
var
·· 
	resultado
·· 
=
·· 
_db
··  #
.
··# $#
Vinculo_Actor_Negocio
··$ 9
.
··9 :
Where
··: ?
(
··? @
van
··@ C
=>
··D F
van
··G J
.
··J K(
id_actor_negocio_principal
··K e
==
··f h(
idGrupoActoresComerciales··i Ç
&&··É Ö
enumTipoVinculo··Ü ï
==··ñ ò
van··ô ú
.··ú ù
tipo_vinculo··ù ©
&&··™ ¨
van··≠ ∞
.··∞ ±

es_vigente··± ª
&&··º æ
van··ø ¬
.··¬ √
Actor_negocio··√ –
.··– —
id_rol··— ◊
==··ÿ ⁄

idRolGrupo··€ Â
)··Â Ê
.··Ê Á
Select··Á Ì
(··Ì Ó
van··Ó Ò
=>··Ú Ù
new··ı ¯
ItemGenerico··˘ Ö
{
‚‚ 
Id
„„ 
=
„„ 
van
„„ 
.
„„ (
id_actor_negocio_vinculado
„„ 7
,
„„7 8
Nombre
‰‰ 
=
‰‰ 
van
‰‰  
.
‰‰  !
Actor_negocio1
‰‰! /
.
‰‰/ 0
Actor
‰‰0 5
.
‰‰5 6(
numero_documento_identidad
‰‰6 P
+
‰‰Q R
$str
‰‰S X
+
‰‰Y Z
van
‰‰[ ^
.
‰‰^ _
Actor_negocio1
‰‰_ m
.
‰‰m n
Actor
‰‰n s
.
‰‰s t
primer_nombre‰‰t Å
.‰‰Å Ç
Replace‰‰Ç â
(‰‰â ä
$str‰‰ä ç
,‰‰ç é
$str‰‰è í
)‰‰í ì
}
ÂÂ 
)
ÂÂ 
.
ÂÂ 
ToList
ÂÂ 
(
ÂÂ 
)
ÂÂ 
;
ÂÂ 
return
ÊÊ 
	resultado
ÊÊ  
;
ÊÊ  !
}
ÁÁ 
catch
ËË 
(
ËË 
	Exception
ËË 
e
ËË 
)
ËË 
{
ÈÈ 
throw
ÍÍ 
new
ÍÍ 
DatosException
ÍÍ (
(
ÍÍ( )
$str
ÍÍ) W
,
ÍÍW X
e
ÍÍY Z
)
ÍÍZ [
;
ÍÍ[ \
}
ÎÎ 
}
ÏÏ 	
public
ÓÓ 
IEnumerable
ÓÓ 
<
ÓÓ 
ItemGenerico
ÓÓ '
>
ÓÓ' (C
5ObtenerGruposActoresComercialesPorRolDeActorComercial
ÓÓ) ^
(
ÓÓ^ _
int
ÓÓ_ b
enumTipoVinculo
ÓÓc r
,
ÓÓr s
int
ÓÓt w

idRolGrupoÓÓx Ç
,ÓÓÇ É
intÓÓÑ á 
idActorComercialÓÓà ò
)ÓÓò ô
{
ÔÔ 	
try
 
{
ÒÒ 
SigescomEntities
ÚÚ  
_db
ÚÚ! $
=
ÚÚ% &
new
ÚÚ' *
SigescomEntities
ÚÚ+ ;
(
ÚÚ; <
)
ÚÚ< =
;
ÚÚ= >
var
ÛÛ 
	resultado
ÛÛ 
=
ÛÛ 
_db
ÛÛ  #
.
ÛÛ# $#
Vinculo_Actor_Negocio
ÛÛ$ 9
.
ÛÛ9 :
Where
ÛÛ: ?
(
ÛÛ? @
van
ÛÛ@ C
=>
ÛÛD F
van
ÛÛG J
.
ÛÛJ K(
id_actor_negocio_vinculado
ÛÛK e
==
ÛÛf h
idActorComercial
ÛÛi y
&&
ÛÛz |
enumTipoVinculoÛÛ} å
==ÛÛç è
vanÛÛê ì
.ÛÛì î
tipo_vinculoÛÛî †
&&ÛÛ° £
vanÛÛ§ ß
.ÛÛß ®

es_vigenteÛÛ® ≤
&&ÛÛ≥ µ
vanÛÛ∂ π
.ÛÛπ ∫
Actor_negocioÛÛ∫ «
.ÛÛ« »
id_rolÛÛ» Œ
==ÛÛœ —

idRolGrupoÛÛ“ ‹
&&ÛÛ› ﬂ
vanÛÛ‡ „
.ÛÛ„ ‰
Actor_negocioÛÛ‰ Ò
.ÛÛÒ Ú

es_vigenteÛÛÚ ¸
)ÛÛ¸ ˝
.ÛÛ˝ ˛
SelectÛÛ˛ Ñ
(ÛÛÑ Ö
vanÛÛÖ à
=>ÛÛâ ã
newÛÛå è
ItemGenericoÛÛê ú
{
ÙÙ 
Id
ıı 
=
ıı 
van
ıı 
.
ıı (
id_actor_negocio_principal
ıı 7
,
ıı7 8
Nombre
ˆˆ 
=
ˆˆ 
van
ˆˆ  
.
ˆˆ  !
Actor_negocio
ˆˆ! .
.
ˆˆ. /
Actor
ˆˆ/ 4
.
ˆˆ4 5(
numero_documento_identidad
ˆˆ5 O
+
ˆˆP Q
$str
ˆˆR W
+
ˆˆX Y
van
ˆˆZ ]
.
ˆˆ] ^
Actor_negocio
ˆˆ^ k
.
ˆˆk l
Actor
ˆˆl q
.
ˆˆq r
primer_nombre
ˆˆr 
}
˜˜ 
)
˜˜ 
.
˜˜ 
ToList
˜˜ 
(
˜˜ 
)
˜˜ 
;
˜˜ 
return
¯¯ 
	resultado
¯¯  
;
¯¯  !
}
˘˘ 
catch
˙˙ 
(
˙˙ 
	Exception
˙˙ 
e
˙˙ 
)
˙˙ 
{
˚˚ 
throw
¸¸ 
new
¸¸ 
DatosException
¸¸ (
(
¸¸( )
$str
¸¸) W
,
¸¸W X
e
¸¸Y Z
)
¸¸Z [
;
¸¸[ \
}
˝˝ 
}
˛˛ 	
}
ˇˇ 
}ÄÄ é·
PD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\Actores\Actor_Datos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
." #
Actores# *
{ 
public 

partial 
class 
Actor_Datos $
:% &
IActor_Repositorio' 9
{ 
public 
OperationResult &
DarDeBajaActorNegocioAhora 9
(9 :
int: =
idActorNegocio> L
,L M
intN Q
idRolR W
)W X
{ 	
try 
{ 
SigescomEntities  
_db! $
=% &
new' *
SigescomEntities+ ;
(; <
)< =
;= >
DateTime 
fechaActual $
=% &
DateTimeUtil' 3
.3 4
FechaActual4 ?
(? @
)@ A
;A B
var 
dbActorNegocio "
=# $
_db% (
.( )
Actor_negocio) 6
.6 7
Include7 >
(> ?
an? A
=>B D
anE G
.G H
ActorH M
.M N
Actor_negocioN [
)[ \
.\ ]
Single] c
(c d
ad e
=>f h
ai j
.j k
idk m
==n p
idActorNegocioq 
)	 Ä
;
Ä Å
dbActorNegocio 
. 
	fecha_fin (
=) *
fechaActual+ 6
;6 7
dbActorNegocio 
. 

es_vigente )
=* +
false, 1
;1 2
List 
< 
Actor_negocio "
>" #
dbRoles$ +
=, -
dbActorNegocio. <
.< =
Actor= B
.B C
Actor_negocioC P
.P Q
WhereQ V
(V W
anW Y
=>Z \
an] _
._ `
Rol` c
.c d
id_rol_padred p
==q s
idRolt y
&&z |
an} 
.	 Ä

es_vigente
Ä ä
==
ã ç
true
é í
)
í ì
.
ì î
ToList
î ö
(
ö õ
)
õ ú
;
ú ù
foreach   
(   
var   
dbRol   "
in  # %
dbRoles  & -
)  - .
{!! 
dbRol"" 
."" 
	fecha_fin"" #
=""$ %
fechaActual""& 1
;""1 2
dbRol## 
.## 

es_vigente## $
=##% &
false##' ,
;##, -
}$$ 
_db%% 
.%% 
SaveChanges%% 
(%%  
)%%  !
;%%! "
return&& 
new&& 
OperationResult&& *
(&&* +
OperationResultEnum&&+ >
.&&> ?
Success&&? F
)&&F G
;&&G H
}'' 
catch(( 
((( 
	Exception(( 
e(( 
)(( 
{)) 
throw** 
e** 
;** 
}++ 
},, 	
public.. 
OperationResult.. &
CrearParametroActorNegocio.. 9
(..9 :#
Parametro_actor_negocio..: Q!
parametroActorNegocio..R g
)..g h
{// 	
try00 
{11 
SigescomEntities22  
_db22! $
=22% &
new22' *
SigescomEntities22+ ;
(22; <
)22< =
;22= >
_db33 
.33 #
Parametro_actor_negocio33 +
.33+ ,
Add33, /
(33/ 0!
parametroActorNegocio330 E
)33E F
;33F G
_db44 
.44 
SaveChanges44 
(44  
)44  !
;44! "
var55 
result55 
=55 
new55  
OperationResult55! 0
(550 1
OperationResultEnum551 D
.55D E
Success55E L
)55L M
;55M N
result66 
.66 
data66 
=66 !
parametroActorNegocio66 3
.663 4
id664 6
;666 7
return77 
result77 
;77 
}88 
catch99 
(99 
	Exception99 
e99 
)99 
{:: 
throw;; 
e;; 
;;; 
}<< 
}== 	
public?? 
OperationResult?? +
ActualizarParametroActorNegocio?? >
(??> ?#
Parametro_actor_negocio??? V!
parametroActorNegocio??W l
)??l m
{@@ 	
tryAA 
{BB 
SigescomEntitiesCC  
_dbCC! $
=CC% &
newCC' *
SigescomEntitiesCC+ ;
(CC; <
)CC< =
;CC= >
varDD #
dbParametroActorNegocioDD +
=DD, -
_dbDD. 1
.DD1 2#
Parametro_actor_negocioDD2 I
.DDI J
SingleDDJ P
(DDP Q
anDDQ S
=>DDT V
anDDW Y
.DDY Z
idDDZ \
==DD] _!
parametroActorNegocioDD` u
.DDu v
idDDv x
)DDx y
;DDy z
_dbEE 
.EE 
EntryEE 
(EE #
dbParametroActorNegocioEE 1
)EE1 2
.EE2 3
CurrentValuesEE3 @
.EE@ A
	SetValuesEEA J
(EEJ K!
parametroActorNegocioEEK `
)EE` a
;EEa b
_dbFF 
.FF 
SaveChangesFF 
(FF  
)FF  !
;FF! "
varHH 
resultHH 
=HH 
newHH  
OperationResultHH! 0
(HH0 1
OperationResultEnumHH1 D
.HHD E
SuccessHHE L
)HHL M
;HHM N
resultII 
.II 
dataII 
=II !
parametroActorNegocioII 3
.II3 4
idII4 6
;II6 7
returnJJ 
resultJJ 
;JJ 
}KK 
catchLL 
(LL 
	ExceptionLL 
eLL 
)LL 
{MM 
throwNN 
eNN 
;NN 
}OO 
}PP 	
publicRR 
voidRR *
ResolverParametrosActorNegocioRR 2
(RR2 3
Actor_negocioRR3 @
dbActorNegocioRRA O
,RRO P
Actor_negocioRRQ ^
updActorNegocioRR_ n
,RRn o
SigescomEntities	RRp Ä
_db
RRÅ Ñ
)
RRÑ Ö
{SS 	
ListTT 
<TT #
Parametro_actor_negocioTT (
>TT( )
dbParametrosTT* 6
=TT7 8
dbActorNegocioTT9 G
.TTG H#
Parametro_actor_negocioTTH _
.TT_ `
ToListTT` f
(TTf g
)TTg h
;TTh i
ListUU 
<UU #
Parametro_actor_negocioUU (
>UU( )
updParametrosUU* 7
=UU8 9
updActorNegocioUU: I
.UUI J#
Parametro_actor_negocioUUJ a
.UUa b
ToListUUb h
(UUh i
)UUi j
;UUj k
foreachVV 
(VV 
varVV 
dbParametroVV $
inVV% '
dbParametrosVV( 4
)VV4 5
{WW 
ifYY 
(YY 
updParametrosYY !
.YY! "
AnyYY" %
(YY% &
pYY& '
=>YY( *
pYY+ ,
.YY, -
id_parametroYY- 9
==YY: <
dbParametroYY= H
.YYH I
id_parametroYYI U
)YYU V
)YYV W
{ZZ 
dbParametro[[ 
.[[  
id_valor_parametro[[  2
=[[3 4
updParametros[[5 B
.[[B C
Single[[C I
([[I J
pan[[J M
=>[[N P
pan[[Q T
.[[T U
id_parametro[[U a
==[[b d
dbParametro[[e p
.[[p q
id_parametro[[q }
)[[} ~
.[[~ 
id_valor_parametro	[[ ë
;
[[ë í
dbParametro\\ 
.\\  
valor\\  %
=\\& '
updParametros\\( 5
.\\5 6
Single\\6 <
(\\< =
pan\\= @
=>\\A C
pan\\D G
.\\G H
id_parametro\\H T
==\\U W
dbParametro\\X c
.\\c d
id_parametro\\d p
)\\p q
.\\q r
valor\\r w
;\\w x
}]] 
else^^ 
{__ 
_db`` 
.`` #
Parametro_actor_negocio`` /
.``/ 0
Remove``0 6
(``6 7
dbParametro``7 B
)``B C
;``C D
}aa 
}bb 
foreachdd 
(dd 
vardd 
updParametrodd %
indd& (
updParametrosdd) 6
)dd6 7
{ee 
ifff 
(ff 
!ff 
dbParametrosff !
.ff! "
Anyff" %
(ff% &
pff& '
=>ff( *
pff+ ,
.ff, -
id_parametroff- 9
==ff: <
updParametroff= I
.ffI J
id_parametroffJ V
)ffV W
)ffW X
{gg 
_dbhh 
.hh #
Parametro_actor_negociohh /
.hh/ 0
Addhh0 3
(hh3 4
updParametrohh4 @
)hh@ A
;hhA B
}ii 
}jj 
}kk 	
publicmm 
voidmm 
ResolverDireccionmm %
(mm% &
Actor_negociomm& 3
dbActorNegociomm4 B
,mmB C
Actor_negociommD Q
updActorNegociommR a
,mma b
SigescomEntitiesmmc s
_dbmmt w
)mmw x
{nn 	
Listoo 
<oo 
	Direccionoo 
>oo 
updDireccionesoo *
=oo+ ,
updActorNegociooo- <
.oo< =
Actoroo= B
.ooB C
	DireccionooC L
.ooL M
ToListooM S
(ooS T
)ooT U
;ooU V
Listpp 
<pp 
	Direccionpp 
>pp 
dbDireccionespp )
=pp* +
dbActorNegociopp, :
.pp: ;
Actorpp; @
.pp@ A
	DireccionppA J
.ppJ K
ToListppK Q
(ppQ R
)ppR S
;ppS T
foreachqq 
(qq 
varqq 
dbDireccionqq $
inqq% '
dbDireccionesqq( 5
)qq5 6
{rr 
iftt 
(tt 
updDireccionestt "
.tt" #
Anytt# &
(tt& '
dtt' (
=>tt) +
dtt, -
.tt- .
idtt. 0
==tt1 3
dbDirecciontt4 ?
.tt? @
idtt@ B
)ttB C
)ttC D
{uu 
varvv 
	direccionvv !
=vv" #
updDireccionesvv$ 2
.vv2 3
Singlevv3 9
(vv9 :
dvv: ;
=>vv< >
dvv? @
.vv@ A
idvvA C
==vvD F
dbDireccionvvG R
.vvR S
idvvS U
)vvU V
;vvV W
_dbww 
.ww 
Entryww 
(ww 
dbDireccionww )
)ww) *
.ww* +
CurrentValuesww+ 8
.ww8 9
	SetValuesww9 B
(wwB C
	direccionwwC L
)wwL M
;wwM N
}xx 
elseyy 
{zz 
_db{{ 
.{{ 
	Direccion{{ !
.{{! "
Remove{{" (
({{( )
dbDireccion{{) 4
){{4 5
;{{5 6
}|| 
}}} 
foreach 
( 
var 
updDireccion %
in& (
updDirecciones) 7
)7 8
{
ÄÄ 
if
ÅÅ 
(
ÅÅ 
!
ÅÅ 
dbDirecciones
ÅÅ "
.
ÅÅ" #
Any
ÅÅ# &
(
ÅÅ& '
d
ÅÅ' (
=>
ÅÅ) +
d
ÅÅ, -
.
ÅÅ- .
id
ÅÅ. 0
==
ÅÅ1 3
updDireccion
ÅÅ4 @
.
ÅÅ@ A
id
ÅÅA C
)
ÅÅC D
)
ÅÅD E
{
ÇÇ 
_db
ÉÉ 
.
ÉÉ 
	Direccion
ÉÉ !
.
ÉÉ! "
Add
ÉÉ" %
(
ÉÉ% &
updDireccion
ÉÉ& 2
)
ÉÉ2 3
;
ÉÉ3 4
}
ÑÑ 
}
ÖÖ 
}
ÜÜ 	
public
àà 
void
àà 
ResolverRoles
àà !
(
àà! "
Actor_negocio
àà" /
dbActorNegocio
àà0 >
,
àà> ?
Actor_negocio
àà@ M
updActorNegocio
ààN ]
,
àà] ^
SigescomEntities
àà_ o
_db
ààp s
)
ààs t
{
ââ 	
List
ää 
<
ää 
Actor_negocio
ää 
>
ää 
dbRoles
ää  '
=
ää( )
dbActorNegocio
ää* 8
.
ää8 9
Actor
ää9 >
.
ää> ?
Actor_negocio
ää? L
.
ääL M
Where
ääM R
(
ääR S
an
ääS U
=>
ääV X
an
ääY [
.
ää[ \
Rol
ää\ _
.
ää_ `
id_rol_padre
ää` l
==
ääm o
updActorNegocio
ääp 
.ää Ä
id_rolääÄ Ü
&&ääá â
anäää å
.ääå ç

es_vigenteääç ó
==ääò ö
trueääõ ü
)ääü †
.ää† °
ToListää° ß
(ääß ®
)ää® ©
;ää© ™
List
ãã 
<
ãã 
Actor_negocio
ãã 
>
ãã 
updRoles
ãã  (
=
ãã) *
updActorNegocio
ãã+ :
.
ãã: ;
Actor
ãã; @
.
ãã@ A
Actor_negocio
ããA N
.
ããN O
ToList
ããO U
(
ããU V
)
ããV W
;
ããW X
foreach
åå 
(
åå 
var
åå 
dbRol
åå 
in
åå !
dbRoles
åå" )
)
åå) *
{
çç 
if
èè 
(
èè 
!
èè 
updRoles
èè 
.
èè 
Any
èè !
(
èè! "
p
èè" #
=>
èè$ &
p
èè' (
.
èè( )
id_rol
èè) /
==
èè0 2
dbRol
èè3 8
.
èè8 9
id_rol
èè9 ?
)
èè? @
)
èè@ A
{
êê 
dbRol
ëë 
.
ëë 
	fecha_fin
ëë #
=
ëë$ %
DateTimeUtil
ëë& 2
.
ëë2 3
FechaActual
ëë3 >
(
ëë> ?
)
ëë? @
;
ëë@ A
dbRol
íí 
.
íí 

es_vigente
íí $
=
íí% &
false
íí' ,
;
íí, -
}
ìì 
}
îî 
foreach
ññ 
(
ññ 
var
ññ 
updRol
ññ 
in
ññ  "
updRoles
ññ# +
)
ññ+ ,
{
óó 
if
òò 
(
òò 
!
òò 
dbRoles
òò 
.
òò 
Any
òò  
(
òò  !
p
òò! "
=>
òò# %
p
òò& '
.
òò' (
id_rol
òò( .
==
òò/ 1
updRol
òò2 8
.
òò8 9
id_rol
òò9 ?
)
òò? @
)
òò@ A
{
ôô 
_db
öö 
.
öö 
Actor_negocio
öö %
.
öö% &
Add
öö& )
(
öö) *
updRol
öö* 0
)
öö0 1
;
öö1 2
}
õõ 
}
úú 
}
ùù 	
public
ûû 
void
ûû 
ResolverFoto
ûû  
(
ûû  !
Actor_negocio
ûû! .
dbActorNegocio
ûû/ =
,
ûû= >
Actor_negocio
ûû? L
updActorNegocio
ûûM \
,
ûû\ ]
SigescomEntities
ûû^ n
_db
ûûo r
)
ûûr s
{
üü 	
Foto
†† 
foto_upd
†† 
=
†† 
updActorNegocio
†† +
.
††+ ,
Actor
††, 1
.
††1 2
Foto
††2 6
??
††7 9
null
††: >
;
††> ?
Foto
°° 
foto_bd
°° 
=
°° 
dbActorNegocio
°° )
.
°°) *
Actor
°°* /
.
°°/ 0
Foto
°°0 4
??
°°5 7
null
°°8 <
;
°°< =
if
¢¢ 
(
¢¢ 
foto_upd
¢¢ 
!=
¢¢ 
null
¢¢  
)
¢¢  !
{
££ 
if
§§ 
(
§§ 
foto_bd
§§ 
!=
§§ 
null
§§ #
&&
§§$ &
foto_bd
§§' .
.
§§. /
imagen
§§/ 5
!=
§§6 8
foto_upd
§§9 A
.
§§A B
imagen
§§B H
)
§§H I
{
•• 
foto_upd
¶¶ 
.
¶¶ 
id
¶¶ 
=
¶¶  !
foto_bd
¶¶" )
.
¶¶) *
id
¶¶* ,
;
¶¶, -
_db
ßß 
.
ßß 
Entry
ßß 
(
ßß 
foto_bd
ßß %
)
ßß% &
.
ßß& '
CurrentValues
ßß' 4
.
ßß4 5
	SetValues
ßß5 >
(
ßß> ?
foto_upd
ßß? G
)
ßßG H
;
ßßH I
}
®® 
else
©© 
{
™™ 
_db
´´ 
.
´´ 
Foto
´´ 
.
´´ 
Add
´´  
(
´´  !
foto_upd
´´! )
)
´´) *
;
´´* +
}
¨¨ 
}
≠≠ 
}
ÆÆ 	
public
∞∞ 
OperationResult
∞∞ 
CrearActorNegocio
∞∞ 0
(
∞∞0 1
Actor_negocio
∞∞1 >
actorNegocio
∞∞? K
)
∞∞K L
{
±± 	
try
≤≤ 
{
≥≥ 
SigescomEntities
¥¥  
_db
¥¥! $
=
¥¥% &
new
¥¥' *
SigescomEntities
¥¥+ ;
(
¥¥; <
)
¥¥< =
;
¥¥= >
_db
µµ 
.
µµ 
Actor_negocio
µµ !
.
µµ! "
Add
µµ" %
(
µµ% &
actorNegocio
µµ& 2
)
µµ2 3
;
µµ3 4
_db
∂∂ 
.
∂∂ 
SaveChanges
∂∂ 
(
∂∂  
)
∂∂  !
;
∂∂! "
var
∑∑ 
result
∑∑ 
=
∑∑ 
new
∑∑  
OperationResult
∑∑! 0
(
∑∑0 1!
OperationResultEnum
∑∑1 D
.
∑∑D E
Success
∑∑E L
)
∑∑L M
;
∑∑M N
result
∏∏ 
.
∏∏ 
data
∏∏ 
=
∏∏ 
actorNegocio
∏∏ *
.
∏∏* +
id
∏∏+ -
;
∏∏- .
return
ππ 
result
ππ 
;
ππ 
}
∫∫ 
catch
ªª 
(
ªª 
	Exception
ªª 
e
ªª 
)
ªª 
{
ºº 
throw
ΩΩ 
e
ΩΩ 
;
ΩΩ 
}
ææ 
}
øø 	
public
¡¡ 
OperationResult
¡¡ 0
"CrearActorNegocioActualizandoActor
¡¡ A
(
¡¡A B
Actor_negocio
¡¡B O
actorNegocio
¡¡P \
)
¡¡\ ]
{
¬¬ 	
try
√√ 
{
ƒƒ 
SigescomEntities
≈≈  
_db
≈≈! $
=
≈≈% &
new
≈≈' *
SigescomEntities
≈≈+ ;
(
≈≈; <
)
≈≈< =
;
≈≈= >
List
∆∆ 
<
∆∆ 
Actor_negocio
∆∆ "
>
∆∆" #
updRoles
∆∆$ ,
=
∆∆- .
actorNegocio
∆∆/ ;
.
∆∆; <
Actor
∆∆< A
.
∆∆A B
Actor_negocio
∆∆B O
.
∆∆O P
ToList
∆∆P V
(
∆∆V W
)
∆∆W X
;
∆∆X Y
;
∆∆Z [
var
«« 
dbActor
«« 
=
«« 
_db
«« !
.
««! "
Actor
««" '
.
««' (
Include
««( /
(
««/ 0
a
««0 1
=>
««2 4
a
««5 6
.
««6 7
	Direccion
««7 @
)
««@ A
.
««A B
Single
««B H
(
««H I
a
««I J
=>
««K M
a
««N O
.
««O P
id
««P R
==
««S U
actorNegocio
««V b
.
««b c
id_actor
««c k
)
««k l
;
««l m
_db
…… 
.
…… 
Entry
…… 
(
…… 
dbActor
…… !
)
……! "
.
……" #
CurrentValues
……# 0
.
……0 1
	SetValues
……1 :
(
……: ;
actorNegocio
……; G
.
……G H
Actor
……H M
)
……M N
;
……N O
List
ÀÀ 
<
ÀÀ 
	Direccion
ÀÀ 
>
ÀÀ 
updDirecciones
ÀÀ  .
=
ÀÀ/ 0
actorNegocio
ÀÀ1 =
.
ÀÀ= >
Actor
ÀÀ> C
.
ÀÀC D
	Direccion
ÀÀD M
.
ÀÀM N
ToList
ÀÀN T
(
ÀÀT U
)
ÀÀU V
;
ÀÀV W
List
ÃÃ 
<
ÃÃ 
	Direccion
ÃÃ 
>
ÃÃ 
dbDirecciones
ÃÃ  -
=
ÃÃ. /
dbActor
ÃÃ0 7
.
ÃÃ7 8
	Direccion
ÃÃ8 A
.
ÃÃA B
ToList
ÃÃB H
(
ÃÃH I
)
ÃÃI J
;
ÃÃJ K
foreach
ÕÕ 
(
ÕÕ 
var
ÕÕ 
dbDireccion
ÕÕ (
in
ÕÕ) +
dbDirecciones
ÕÕ, 9
)
ÕÕ9 :
{
ŒŒ 
if
–– 
(
–– 
updDirecciones
–– &
.
––& '
Any
––' *
(
––* +
d
––+ ,
=>
––- /
d
––0 1
.
––1 2
id
––2 4
==
––5 7
dbDireccion
––8 C
.
––C D
id
––D F
)
––F G
)
––G H
{
—— 
var
““ 
	direccion
““ %
=
““& '
updDirecciones
““( 6
.
““6 7
Single
““7 =
(
““= >
d
““> ?
=>
““@ B
d
““C D
.
““D E
id
““E G
==
““H J
dbDireccion
““K V
.
““V W
id
““W Y
)
““Y Z
;
““Z [
_db
”” 
.
”” 
Entry
”” !
(
””! "
dbDireccion
””" -
)
””- .
.
””. /
CurrentValues
””/ <
.
””< =
	SetValues
””= F
(
””F G
	direccion
””G P
)
””P Q
;
””Q R
}
‘‘ 
else
’’ 
{
÷÷ 
_db
◊◊ 
.
◊◊ 
	Direccion
◊◊ %
.
◊◊% &
Remove
◊◊& ,
(
◊◊, -
dbDireccion
◊◊- 8
)
◊◊8 9
;
◊◊9 :
}
ÿÿ 
}
ŸŸ 
foreach
€€ 
(
€€ 
var
€€ 
updDireccion
€€ )
in
€€* ,
updDirecciones
€€- ;
)
€€; <
{
‹‹ 
if
›› 
(
›› 
!
›› 
dbDirecciones
›› &
.
››& '
Any
››' *
(
››* +
d
››+ ,
=>
››- /
d
››0 1
.
››1 2
id
››2 4
==
››5 7
updDireccion
››8 D
.
››D E
id
››E G
)
››G H
)
››H I
{
ﬁﬁ 
_db
ﬂﬂ 
.
ﬂﬂ 
	Direccion
ﬂﬂ %
.
ﬂﬂ% &
Add
ﬂﬂ& )
(
ﬂﬂ) *
updDireccion
ﬂﬂ* 6
)
ﬂﬂ6 7
;
ﬂﬂ7 8
}
‡‡ 
}
·· 
actorNegocio
„„ 
.
„„ 
Actor
„„ "
=
„„# $
dbActor
„„% ,
;
„„, -
_db
‰‰ 
.
‰‰ 
Actor_negocio
‰‰ !
.
‰‰! "
Add
‰‰" %
(
‰‰% &
actorNegocio
‰‰& 2
)
‰‰2 3
;
‰‰3 4
foreach
ÊÊ 
(
ÊÊ 
var
ÊÊ 
updRol
ÊÊ #
in
ÊÊ$ &
updRoles
ÊÊ' /
)
ÊÊ/ 0
{
ÁÁ 
_db
ËË 
.
ËË 
Actor_negocio
ËË %
.
ËË% &
Add
ËË& )
(
ËË) *
updRol
ËË* 0
)
ËË0 1
;
ËË1 2
}
ÈÈ 
_db
ÍÍ 
.
ÍÍ 
SaveChanges
ÍÍ 
(
ÍÍ  
)
ÍÍ  !
;
ÍÍ! "
var
ÎÎ 
result
ÎÎ 
=
ÎÎ 
new
ÎÎ  
OperationResult
ÎÎ! 0
(
ÎÎ0 1!
OperationResultEnum
ÎÎ1 D
.
ÎÎD E
Success
ÎÎE L
)
ÎÎL M
;
ÎÎM N
result
ÏÏ 
.
ÏÏ 
data
ÏÏ 
=
ÏÏ 
actorNegocio
ÏÏ *
.
ÏÏ* +
id
ÏÏ+ -
;
ÏÏ- .
return
ÌÌ 
result
ÌÌ 
;
ÌÌ 
}
ÓÓ 
catch
ÔÔ 
(
ÔÔ 
	Exception
ÔÔ 
e
ÔÔ 
)
ÔÔ 
{
 
throw
ÒÒ 
e
ÒÒ 
;
ÒÒ 
}
ÚÚ 
}
ÛÛ 	
public
ıı 
OperationResult
ıı $
ActualizarActorNegocio
ıı 5
(
ıı5 6
Actor_negocio
ıı6 C
updActorNegocio
ııD S
)
ııS T
{
ˆˆ 	
try
˜˜ 
{
¯¯ 
SigescomEntities
˘˘  
_db
˘˘! $
=
˘˘% &
new
˘˘' *
SigescomEntities
˘˘+ ;
(
˘˘; <
)
˘˘< =
;
˘˘= >
var
˙˙ 
dbActorNegocio
˙˙ "
=
˙˙# $
_db
˙˙% (
.
˙˙( )
Actor_negocio
˙˙) 6
.
˙˙6 7
Include
˙˙7 >
(
˙˙> ?
an
˙˙? A
=>
˙˙B D
an
˙˙E G
.
˙˙G H
Actor
˙˙H M
)
˙˙M N
.
˙˙N O
Include
˙˙O V
(
˙˙V W
an
˙˙W Y
=>
˙˙Z \
an
˙˙] _
.
˙˙_ `
Actor
˙˙` e
.
˙˙e f
	Direccion
˙˙f o
)
˙˙o p
.
˙˙p q
Include
˚˚ 
(
˚˚ 
an
˚˚ 
=>
˚˚ !
an
˚˚" $
.
˚˚$ %
Actor_negocio_rol
˚˚% 6
)
˚˚6 7
.
˚˚7 8
Include
˚˚8 ?
(
˚˚? @
an
˚˚@ B
=>
˚˚C E
an
˚˚F H
.
˚˚H I%
Parametro_actor_negocio
˚˚I `
)
˚˚` a
.
˚˚a b
Single
˚˚b h
(
˚˚h i
an
˚˚i k
=>
˚˚l n
an
˚˚o q
.
˚˚q r
id
˚˚r t
==
˚˚u w
updActorNegocio˚˚x á
.˚˚á à
id˚˚à ä
)˚˚ä ã
;˚˚ã å1
#ResolverActualizacionDeActorNegocio
˛˛ 3
(
˛˛3 4
dbActorNegocio
˛˛4 B
,
˛˛B C
updActorNegocio
˛˛D S
,
˛˛S T
_db
˛˛U X
)
˛˛X Y
;
˛˛Y Z,
ResolverParametrosActorNegocio
ÄÄ .
(
ÄÄ. /
dbActorNegocio
ÄÄ/ =
,
ÄÄ= >
updActorNegocio
ÄÄ? N
,
ÄÄN O
_db
ÄÄP S
)
ÄÄS T
;
ÄÄT U
_db
ÅÅ 
.
ÅÅ 
SaveChanges
ÅÅ 
(
ÅÅ  
)
ÅÅ  !
;
ÅÅ! "
var
ÇÇ 
result
ÇÇ 
=
ÇÇ 
new
ÇÇ  
OperationResult
ÇÇ! 0
(
ÇÇ0 1!
OperationResultEnum
ÇÇ1 D
.
ÇÇD E
Success
ÇÇE L
)
ÇÇL M
;
ÇÇM N
result
ÉÉ 
.
ÉÉ 
data
ÉÉ 
=
ÉÉ 
updActorNegocio
ÉÉ -
.
ÉÉ- .
id
ÉÉ. 0
;
ÉÉ0 1
return
ÑÑ 
result
ÑÑ 
;
ÑÑ 
}
ÖÖ 
catch
ÜÜ 
(
ÜÜ 
	Exception
ÜÜ 
e
ÜÜ 
)
ÜÜ 
{
áá 
throw
àà 
e
àà 
;
àà 
}
ââ 
}
ää 	
public
ãã 
OperationResult
ãã 0
"ActualizarActorNegocioCreandoActor
ãã A
(
ããA B
Actor_negocio
ããB O
updActorNegocio
ããP _
)
ãã_ `
{
åå 	
try
çç 
{
éé 
SigescomEntities
èè  
_db
èè! $
=
èè% &
new
èè' *
SigescomEntities
èè+ ;
(
èè; <
)
èè< =
;
èè= >
_db
ëë 
.
ëë 
Entry
ëë 
(
ëë 
updActorNegocio
ëë )
.
ëë) *
Actor
ëë* /
)
ëë/ 0
.
ëë0 1
State
ëë1 6
=
ëë7 8
EntityState
ëë9 D
.
ëëD E
Added
ëëE J
;
ëëJ K
var
ìì 
dbActorNegocio
ìì "
=
ìì# $
_db
ìì% (
.
ìì( )
Actor_negocio
ìì) 6
.
ìì6 7
Include
ìì7 >
(
ìì> ?
an
ìì? A
=>
ììB D
an
ììE G
.
ììG H
Actor
ììH M
)
ììM N
.
ììN O
Include
ììO V
(
ììV W
an
ììW Y
=>
ììZ \
an
ìì] _
.
ìì_ `
Actor
ìì` e
.
ììe f
	Direccion
ììf o
)
ììo p
.
ììp q
Include
îî 
(
îî 
an
îî 
=>
îî !
an
îî" $
.
îî$ %
Actor_negocio_rol
îî% 6
)
îî6 7
.
îî7 8
Include
îî8 ?
(
îî? @
an
îî@ B
=>
îîC E
an
îîF H
.
îîH I%
Parametro_actor_negocio
îîI `
)
îî` a
.
îîa b
Single
îîb h
(
îîh i
an
îîi k
=>
îîl n
an
îîo q
.
îîq r
id
îîr t
==
îîu w
updActorNegocioîîx á
.îîá à
idîîà ä
)îîä ã
;îîã åC
5ResolverActualizacionDeActorNegocioSinActualizarActor
óó E
(
óóE F
dbActorNegocio
óóF T
,
óóT U
updActorNegocio
óóV e
,
óóe f
_db
óóg j
)
óój k
;
óók l,
ResolverParametrosActorNegocio
ôô .
(
ôô. /
dbActorNegocio
ôô/ =
,
ôô= >
updActorNegocio
ôô? N
,
ôôN O
_db
ôôP S
)
ôôS T
;
ôôT U
_db
õõ 
.
õõ 
SaveChanges
õõ 
(
õõ  
)
õõ  !
;
õõ! "
var
úú 
result
úú 
=
úú 
new
úú  
OperationResult
úú! 0
(
úú0 1!
OperationResultEnum
úú1 D
.
úúD E
Success
úúE L
)
úúL M
;
úúM N
result
ùù 
.
ùù 
data
ùù 
=
ùù 
updActorNegocio
ùù -
.
ùù- .
id
ùù. 0
;
ùù0 1
return
ûû 
result
ûû 
;
ûû 
}
üü 
catch
†† 
(
†† 
	Exception
†† 
e
†† 
)
†† 
{
°° 
throw
¢¢ 
e
¢¢ 
;
¢¢ 
}
££ 
}
§§ 	
public
¶¶ 
void
¶¶ C
5ResolverActualizacionDeActorNegocioSinActualizarActor
¶¶ I
(
¶¶I J
Actor_negocio
¶¶J W
dbActorNegocio
¶¶X f
,
¶¶f g
Actor_negocio
¶¶h u
updActorNegocio¶¶v Ö
,¶¶Ö Ü 
SigescomEntities¶¶á ó
_db¶¶ò õ
)¶¶õ ú
{
ßß 	
updActorNegocio
®® 
.
®® 

id_usuario
®® &
=
®®' (
dbActorNegocio
®®) 7
.
®®7 8

id_usuario
®®8 B
;
®®B C
updActorNegocio
©© 
.
©© 
fecha_inicio
©© (
=
©©) *
dbActorNegocio
©©+ 9
.
©©9 :
fecha_inicio
©©: F
;
©©F G
updActorNegocio
™™ 
.
™™ 
	fecha_fin
™™ %
=
™™& '
dbActorNegocio
™™( 6
.
™™6 7
	fecha_fin
™™7 @
;
™™@ A
_db
≠≠ 
.
≠≠ 
Entry
≠≠ 
(
≠≠ 
dbActorNegocio
≠≠ $
)
≠≠$ %
.
≠≠% &
CurrentValues
≠≠& 3
.
≠≠3 4
	SetValues
≠≠4 =
(
≠≠= >
updActorNegocio
≠≠> M
)
≠≠M N
;
≠≠N O
}
ÆÆ 	
public
∞∞ 
OperationResult
∞∞ 1
#ActualizarActorNegocioIncluidoActor
∞∞ B
(
∞∞B C
Actor_negocio
∞∞C P
updActorNegocio
∞∞Q `
)
∞∞` a
{
±± 	
try
≤≤ 
{
≥≥ 
SigescomEntities
¥¥  
_db
¥¥! $
=
¥¥% &
new
¥¥' *
SigescomEntities
¥¥+ ;
(
¥¥; <
)
¥¥< =
;
¥¥= >
Actor_negocio
µµ 
dbActorNegocio
µµ ,
=
µµ- .
_db
µµ/ 2
.
µµ2 3
Actor_negocio
µµ3 @
.
µµ@ A
Include
µµA H
(
µµH I
an
µµI K
=>
µµL N
an
µµO Q
.
µµQ R
Actor
µµR W
)
µµW X
.
µµX Y
Single
µµY _
(
µµ_ `
an
µµ` b
=>
µµc e
an
µµf h
.
µµh i
id
µµi k
==
µµl n
updActorNegocio
µµo ~
.
µµ~ 
idµµ Å
)µµÅ Ç
;µµÇ É
_db
∂∂ 
.
∂∂ 
Entry
∂∂ 
(
∂∂ 
dbActorNegocio
∂∂ (
)
∂∂( )
.
∂∂) *
CurrentValues
∂∂* 7
.
∂∂7 8
	SetValues
∂∂8 A
(
∂∂A B
updActorNegocio
∂∂B Q
)
∂∂Q R
;
∂∂R S
_db
∑∑ 
.
∑∑ 
Entry
∑∑ 
(
∑∑ 
dbActorNegocio
∑∑ (
.
∑∑( )
Actor
∑∑) .
)
∑∑. /
.
∑∑/ 0
CurrentValues
∑∑0 =
.
∑∑= >
	SetValues
∑∑> G
(
∑∑G H
updActorNegocio
∑∑H W
.
∑∑W X
Actor
∑∑X ]
)
∑∑] ^
;
∑∑^ _
_db
∏∏ 
.
∏∏ 
SaveChanges
∏∏ 
(
∏∏  
)
∏∏  !
;
∏∏! "
var
ππ 
result
ππ 
=
ππ 
new
ππ  
OperationResult
ππ! 0
(
ππ0 1!
OperationResultEnum
ππ1 D
.
ππD E
Success
ππE L
)
ππL M
;
ππM N
result
∫∫ 
.
∫∫ 
data
∫∫ 
=
∫∫ 
updActorNegocio
∫∫ -
.
∫∫- .
id
∫∫. 0
;
∫∫0 1
return
ªª 
result
ªª 
;
ªª 
}
ºº 
catch
ΩΩ 
(
ΩΩ 
	Exception
ΩΩ 
e
ΩΩ 
)
ΩΩ 
{
ææ 
throw
øø 
e
øø 
;
øø 
}
¿¿ 
}
¡¡ 	
public
√√ 
OperationResult
√√ ?
1ActualizarActorNegocioSinTomarEnCuentaAParametros
√√ P
(
√√P Q
Actor_negocio
√√Q ^
updActorNegocio
√√_ n
)
√√n o
{
ƒƒ 	
try
≈≈ 
{
∆∆ 
SigescomEntities
««  
_db
««! $
=
««% &
new
««' *
SigescomEntities
««+ ;
(
««; <
)
««< =
;
««= >
var
»» 
dbActorNegocio
»» "
=
»»# $
_db
»»% (
.
»»( )
Actor_negocio
»») 6
.
»»6 7
Include
»»7 >
(
»»> ?
an
»»? A
=>
»»B D
an
»»E G
.
»»G H
Actor
»»H M
.
»»M N
Actor_negocio
»»N [
)
»»[ \
.
»»\ ]
Include
»»] d
(
»»d e
an
»»e g
=>
»»h j
an
»»k m
.
»»m n
Actor
»»n s
.
»»s t
	Direccion
»»t }
)
»»} ~
.
»»~ 
Include
…… 
(
…… 
an
…… 
=>
…… !
an
……" $
.
……$ %
Actor_negocio_rol
……% 6
)
……6 7
.
……7 8
Include
……8 ?
(
……? @
an
……@ B
=>
……C E
an
……F H
.
……H I%
Parametro_actor_negocio
……I `
)
……` a
.
……a b
Single
……b h
(
……h i
an
……i k
=>
……l n
an
……o q
.
……q r
id
……r t
==
……u w
updActorNegocio……x á
.……á à
id……à ä
)……ä ã
;……ã å1
#ResolverActualizacionDeActorNegocio
ÀÀ 3
(
ÀÀ3 4
dbActorNegocio
ÀÀ4 B
,
ÀÀB C
updActorNegocio
ÀÀD S
,
ÀÀS T
_db
ÀÀU X
)
ÀÀX Y
;
ÀÀY Z
_db
ÃÃ 
.
ÃÃ 
SaveChanges
ÃÃ 
(
ÃÃ  
)
ÃÃ  !
;
ÃÃ! "
var
ÕÕ 
result
ÕÕ 
=
ÕÕ 
new
ÕÕ  
OperationResult
ÕÕ! 0
(
ÕÕ0 1!
OperationResultEnum
ÕÕ1 D
.
ÕÕD E
Success
ÕÕE L
)
ÕÕL M
;
ÕÕM N
result
ŒŒ 
.
ŒŒ 
data
ŒŒ 
=
ŒŒ 
updActorNegocio
ŒŒ -
.
ŒŒ- .
id
ŒŒ. 0
;
ŒŒ0 1
return
œœ 
result
œœ 
;
œœ 
}
–– 
catch
—— 
(
—— 
	Exception
—— 
e
—— 
)
—— 
{
““ 
throw
”” 
e
”” 
;
”” 
}
‘‘ 
}
’’ 	
public
◊◊ 
void
◊◊ 1
#ResolverActualizacionDeActorNegocio
◊◊ 7
(
◊◊7 8
Actor_negocio
◊◊8 E
dbActorNegocio
◊◊F T
,
◊◊T U
Actor_negocio
◊◊V c
updActorNegocio
◊◊d s
,
◊◊s t
SigescomEntities◊◊u Ö
_db◊◊Ü â
)◊◊â ä
{
ÿÿ 	
updActorNegocio
⁄⁄ 
.
⁄⁄ 

id_usuario
⁄⁄ &
=
⁄⁄' (
dbActorNegocio
⁄⁄) 7
.
⁄⁄7 8

id_usuario
⁄⁄8 B
;
⁄⁄B C
updActorNegocio
€€ 
.
€€ 
fecha_inicio
€€ (
=
€€) *
dbActorNegocio
€€+ 9
.
€€9 :
fecha_inicio
€€: F
;
€€F G
updActorNegocio
‹‹ 
.
‹‹ 
	fecha_fin
‹‹ %
=
‹‹& '
dbActorNegocio
‹‹( 6
.
‹‹6 7
	fecha_fin
‹‹7 @
;
‹‹@ A
updActorNegocio
›› 
.
›› $
id_actor_negocio_padre
›› 2
=
››3 4
dbActorNegocio
››5 C
.
››C D$
id_actor_negocio_padre
››D Z
;
››Z [
_db
‡‡ 
.
‡‡ 
Entry
‡‡ 
(
‡‡ 
dbActorNegocio
‡‡ $
)
‡‡$ %
.
‡‡% &
CurrentValues
‡‡& 3
.
‡‡3 4
	SetValues
‡‡4 =
(
‡‡= >
updActorNegocio
‡‡> M
)
‡‡M N
;
‡‡N O
_db
„„ 
.
„„ 
Entry
„„ 
(
„„ 
dbActorNegocio
„„ $
.
„„$ %
Actor
„„% *
)
„„* +
.
„„+ ,
CurrentValues
„„, 9
.
„„9 :
	SetValues
„„: C
(
„„C D
updActorNegocio
„„D S
.
„„S T
Actor
„„T Y
)
„„Y Z
;
„„Z [
ResolverDireccion
ÂÂ 
(
ÂÂ 
dbActorNegocio
ÂÂ ,
,
ÂÂ, -
updActorNegocio
ÂÂ. =
,
ÂÂ= >
_db
ÂÂ? B
)
ÂÂB C
;
ÂÂC D
ResolverRoles
ÊÊ 
(
ÊÊ 
dbActorNegocio
ÊÊ (
,
ÊÊ( )
updActorNegocio
ÊÊ* 9
,
ÊÊ9 :
_db
ÊÊ; >
)
ÊÊ> ?
;
ÊÊ? @
ResolverFoto
ÁÁ 
(
ÁÁ 
dbActorNegocio
ÁÁ '
,
ÁÁ' (
updActorNegocio
ÁÁ) 8
,
ÁÁ8 9
_db
ÁÁ: =
)
ÁÁ= >
;
ÁÁ> ?
}
ËË 	
public
ÍÍ 
OperationResult
ÍÍ 8
*ActualizarActorNegocioYIdActorNegocioPadre
ÍÍ I
(
ÍÍI J
Actor_negocio
ÍÍJ W
updActorNegocio
ÍÍX g
)
ÍÍg h
{
ÎÎ 	
try
ÏÏ 
{
ÌÌ 
SigescomEntities
ÓÓ  
_db
ÓÓ! $
=
ÓÓ% &
new
ÓÓ' *
SigescomEntities
ÓÓ+ ;
(
ÓÓ; <
)
ÓÓ< =
;
ÓÓ= >
var
ÔÔ 
dbActorNegocio
ÔÔ "
=
ÔÔ# $
_db
ÔÔ% (
.
ÔÔ( )
Actor_negocio
ÔÔ) 6
.
ÔÔ6 7
Include
ÔÔ7 >
(
ÔÔ> ?
an
ÔÔ? A
=>
ÔÔB D
an
ÔÔE G
.
ÔÔG H
Actor
ÔÔH M
)
ÔÔM N
.
ÔÔN O
Include
ÔÔO V
(
ÔÔV W
an
ÔÔW Y
=>
ÔÔZ \
an
ÔÔ] _
.
ÔÔ_ `
Actor
ÔÔ` e
.
ÔÔe f
	Direccion
ÔÔf o
)
ÔÔo p
.
ÔÔp q
Include
 
(
 
an
 
=>
 !
an
" $
.
$ %
Actor_negocio_rol
% 6
)
6 7
.
7 8
Include
8 ?
(
? @
an
@ B
=>
C E
an
F H
.
H I%
Parametro_actor_negocio
I `
)
` a
.
a b
Single
b h
(
h i
an
i k
=>
l n
an
o q
.
q r
id
r t
==
u w
updActorNegociox á
.á à
idà ä
)ä ã
;ã åE
7ResolverActualizacionDeActorNegocioYIdActorNegocioPadre
ÒÒ G
(
ÒÒG H
dbActorNegocio
ÒÒH V
,
ÒÒV W
updActorNegocio
ÒÒX g
,
ÒÒg h
_db
ÒÒi l
)
ÒÒl m
;
ÒÒm n,
ResolverParametrosActorNegocio
ÚÚ .
(
ÚÚ. /
dbActorNegocio
ÚÚ/ =
,
ÚÚ= >
updActorNegocio
ÚÚ? N
,
ÚÚN O
_db
ÚÚP S
)
ÚÚS T
;
ÚÚT U
_db
ÛÛ 
.
ÛÛ 
SaveChanges
ÛÛ 
(
ÛÛ  
)
ÛÛ  !
;
ÛÛ! "
var
ÙÙ 
result
ÙÙ 
=
ÙÙ 
new
ÙÙ  
OperationResult
ÙÙ! 0
(
ÙÙ0 1!
OperationResultEnum
ÙÙ1 D
.
ÙÙD E
Success
ÙÙE L
)
ÙÙL M
;
ÙÙM N
result
ıı 
.
ıı 
data
ıı 
=
ıı 
updActorNegocio
ıı -
.
ıı- .
id
ıı. 0
;
ıı0 1
return
ˆˆ 
result
ˆˆ 
;
ˆˆ 
}
˜˜ 
catch
¯¯ 
(
¯¯ 
	Exception
¯¯ 
e
¯¯ 
)
¯¯ 
{
˘˘ 
throw
˙˙ 
e
˙˙ 
;
˙˙ 
}
˚˚ 
}
¸¸ 	
public
˛˛ 
void
˛˛ E
7ResolverActualizacionDeActorNegocioYIdActorNegocioPadre
˛˛ K
(
˛˛K L
Actor_negocio
˛˛L Y
dbActorNegocio
˛˛Z h
,
˛˛h i
Actor_negocio
˛˛j w
updActorNegocio˛˛x á
,˛˛á à 
SigescomEntities˛˛â ô
_db˛˛ö ù
)˛˛ù û
{
ˇˇ 	
updActorNegocio
ÅÅ 
.
ÅÅ 

id_usuario
ÅÅ &
=
ÅÅ' (
dbActorNegocio
ÅÅ) 7
.
ÅÅ7 8

id_usuario
ÅÅ8 B
;
ÅÅB C
updActorNegocio
ÇÇ 
.
ÇÇ 
fecha_inicio
ÇÇ (
=
ÇÇ) *
dbActorNegocio
ÇÇ+ 9
.
ÇÇ9 :
fecha_inicio
ÇÇ: F
;
ÇÇF G
updActorNegocio
ÉÉ 
.
ÉÉ 
	fecha_fin
ÉÉ %
=
ÉÉ& '
dbActorNegocio
ÉÉ( 6
.
ÉÉ6 7
	fecha_fin
ÉÉ7 @
;
ÉÉ@ A
_db
ÜÜ 
.
ÜÜ 
Entry
ÜÜ 
(
ÜÜ 
dbActorNegocio
ÜÜ $
)
ÜÜ$ %
.
ÜÜ% &
CurrentValues
ÜÜ& 3
.
ÜÜ3 4
	SetValues
ÜÜ4 =
(
ÜÜ= >
updActorNegocio
ÜÜ> M
)
ÜÜM N
;
ÜÜN O
_db
ââ 
.
ââ 
Entry
ââ 
(
ââ 
dbActorNegocio
ââ $
.
ââ$ %
Actor
ââ% *
)
ââ* +
.
ââ+ ,
CurrentValues
ââ, 9
.
ââ9 :
	SetValues
ââ: C
(
ââC D
updActorNegocio
ââD S
.
ââS T
Actor
ââT Y
)
ââY Z
;
ââZ [
ResolverDireccion
ãã 
(
ãã 
dbActorNegocio
ãã ,
,
ãã, -
updActorNegocio
ãã. =
,
ãã= >
_db
ãã? B
)
ããB C
;
ããC D
ResolverRoles
åå 
(
åå 
dbActorNegocio
åå (
,
åå( )
updActorNegocio
åå* 9
,
åå9 :
_db
åå; >
)
åå> ?
;
åå? @
ResolverFoto
çç 
(
çç 
dbActorNegocio
çç '
,
çç' (
updActorNegocio
çç) 8
,
çç8 9
_db
çç: =
)
çç= >
;
çç> ?
}
éé 	
public
êê 
bool
êê 
ExisteDocumento
êê #
(
êê# $
int
êê$ '"
idDocumentoIdentidad
êê( <
,
êê< =
string
êê> D
numeroDocumento
êêE T
)
êêT U
{
ëë 	
try
íí 
{
ìì 
SigescomEntities
îî  
_db
îî! $
=
îî% &
new
îî' *
SigescomEntities
îî+ ;
(
îî; <
)
îî< =
;
îî= >
return
ïï 
_db
ïï 
.
ïï 
Actor
ïï  
.
ïï  !
Any
ïï! $
(
ïï$ %
a
ïï% &
=>
ïï' )
a
ïï* +
.
ïï+ ,$
id_documento_identidad
ïï, B
==
ïïC E"
idDocumentoIdentidad
ïïF Z
&&
ïï[ ]
a
ïï^ _
.
ïï_ `(
numero_documento_identidad
ïï` z
==
ïï{ }
numeroDocumentoïï~ ç
)ïïç é
;ïïé è
}
ññ 
catch
óó 
(
óó 
	Exception
óó 
e
óó 
)
óó 
{
òò 
throw
ôô 
e
ôô 
;
ôô 
}
öö 
}
õõ 	
public
úú 
bool
úú 7
)ExisteActorConElMismoDocumentoYDistintoId
úú =
(
úú= >
int
úú> A
id
úúB D
,
úúD E
string
úúF L 
documentoIdentidad
úúM _
)
úú_ `
{
ùù 	
SigescomEntities
ûû 
_db
ûû  
=
ûû! "
new
ûû# &
SigescomEntities
ûû' 7
(
ûû7 8
)
ûû8 9
;
ûû9 :
return
üü 
_db
üü 
.
üü 
Actor
üü 
.
üü 
Any
üü  
(
üü  !
a
üü! "
=>
üü# %
a
üü& '
.
üü' ((
numero_documento_identidad
üü( B
==
üüC E 
documentoIdentidad
üüF X
&&
üüY [
a
üü\ ]
.
üü] ^
id
üü^ `
!=
üüa c
id
üüd f
)
üüf g
;
üüg h
}
†† 	
public
°° 
bool
°° <
.ExisteActorComercialConElMismoDocumentoVigente
°° B
(
°°B C
int
°°C F
idRol
°°G L
,
°°L M
string
°°N T 
documentoIdentidad
°°U g
)
°°g h
{
¢¢ 	
SigescomEntities
££ 
_db
££  
=
££! "
new
££# &
SigescomEntities
££' 7
(
££7 8
)
££8 9
;
££9 :
return
§§ 
_db
§§ 
.
§§ 
Actor_negocio
§§ $
.
§§$ %
Any
§§% (
(
§§( )
an
§§) +
=>
§§, .
an
§§/ 1
.
§§1 2
id_rol
§§2 8
==
§§9 ;
idRol
§§< A
&&
§§B D
an
§§E G
.
§§G H
Actor
§§H M
.
§§M N(
numero_documento_identidad
§§N h
==
§§i k 
documentoIdentidad
§§l ~
&&§§ Å
an§§Ç Ñ
.§§Ñ Ö

es_vigente§§Ö è
)§§è ê
;§§ê ë
}
•• 	
public
¶¶ 
bool
¶¶ <
.ExisteActorComercialConElMismoDocumentoVigente
¶¶ B
(
¶¶B C
int
¶¶C F'
idActorComercialDiferente
¶¶G `
,
¶¶` a
int
¶¶b e
idRol
¶¶f k
,
¶¶k l
string
¶¶m s!
documentoIdentidad¶¶t Ü
)¶¶Ü á
{
ßß 	
SigescomEntities
®® 
_db
®®  
=
®®! "
new
®®# &
SigescomEntities
®®' 7
(
®®7 8
)
®®8 9
;
®®9 :
return
©© 
_db
©© 
.
©© 
Actor_negocio
©© $
.
©©$ %
Any
©©% (
(
©©( )
an
©©) +
=>
©©, .
an
©©/ 1
.
©©1 2
id
©©2 4
!=
©©5 7'
idActorComercialDiferente
©©8 Q
&&
©©R T
an
©©U W
.
©©W X
id_rol
©©X ^
==
©©_ a
idRol
©©b g
&&
©©h j
an
©©k m
.
©©m n
Actor
©©n s
.
©©s t)
numero_documento_identidad©©t é
==©©è ë"
documentoIdentidad©©í §
&&©©• ß
an©©® ™
.©©™ ´

es_vigente©©´ µ
)©©µ ∂
;©©∂ ∑
}
™™ 	
public
´´ 
Actor_negocio
´´ #
ObtenerActorDeNegocio
´´ 2
(
´´2 3
int
´´3 6
idActorNegocio
´´7 E
)
´´E F
{
¨¨ 	
try
≠≠ 
{
ÆÆ 
SigescomEntities
ØØ  
_db
ØØ! $
=
ØØ% &
new
ØØ' *
SigescomEntities
ØØ+ ;
(
ØØ; <
)
ØØ< =
;
ØØ= >
return
∞∞ 
_db
∞∞ 
.
∞∞ 
Actor_negocio
∞∞ (
.
±± 
Include
±± 
(
±± 
an
±± 
=>
±±  "
an
±±# %
.
±±% &
Actor
±±& +
)
±±+ ,
.
≤≤ 
Include
≤≤ 
(
≤≤ 
an
≤≤ 
=>
≤≤  "
an
≤≤# %
.
≤≤% &
Actor
≤≤& +
.
≤≤+ ,
Detalle_maestro
≤≤, ;
)
≤≤; <
.
≥≥ 
Include
≥≥ 
(
≥≥ 
an
≥≥ 
=>
≥≥  "
an
≥≥# %
.
≥≥% &
Actor
≥≥& +
.
≥≥+ ,
	Direccion
≥≥, 5
)
≥≥5 6
.
¥¥ 
Include
¥¥ 
(
¥¥ 
an
¥¥ 
=>
¥¥  "
an
¥¥# %
.
¥¥% &
Actor
¥¥& +
.
¥¥+ ,
	Direccion
¥¥, 5
.
¥¥5 6
Select
¥¥6 <
(
¥¥< =
d
¥¥= >
=>
¥¥? A
d
¥¥B C
.
¥¥C D
Ubigeo
¥¥D J
)
¥¥J K
)
¥¥K L
.
µµ 
SingleOrDefault
µµ $
(
µµ$ %
an
µµ% '
=>
µµ( *
an
µµ+ -
.
µµ- .
id
µµ. 0
==
µµ1 3
idActorNegocio
µµ4 B
)
µµB C
;
µµC D
}
∂∂ 
catch
∑∑ 
(
∑∑ 
	Exception
∑∑ 
e
∑∑ 
)
∑∑ 
{
∏∏ 
throw
ππ 
e
ππ 
;
ππ 
}
∫∫ 
}
ªª 	
public
ºº 
IEnumerable
ºº 
<
ºº 
Actor_negocio
ºº (
>
ºº( )4
&ObtenerActorDeNegocioPrincipalVigentes
ºº* P
(
ººP Q
int
ººQ T
idParentRol
ººU `
,
ºº` a
int
ººb e
idRol
ººf k
)
ººk l
{
ΩΩ 	
SigescomEntities
ææ 
_db
ææ  
=
ææ! "
new
ææ# &
SigescomEntities
ææ' 7
(
ææ7 8
)
ææ8 9
;
ææ9 :
return
øø 
_db
øø 
.
øø 
Actor_negocio
øø $
.
øø$ %
Include
øø% ,
(
øø, -
an
øø- /
=>
øø0 2
an
øø3 5
.
øø5 6
Actor
øø6 ;
)
øø; <
.
øø< =
Include
¿¿ 
(
¿¿ 
an
¿¿ 
=>
¿¿ 
an
¿¿  
.
¿¿  !
Actor
¿¿! &
.
¿¿& '

Tipo_actor
¿¿' 1
)
¿¿1 2
.
¿¿2 3
Include
¡¡ 
(
¡¡ 
an
¡¡ 
=>
¡¡ 
an
¡¡  
.
¡¡  !
Actor
¡¡! &
.
¡¡& '
Detalle_maestro
¡¡' 6
)
¡¡6 7
.
¡¡7 8
Include
¬¬ 
(
¬¬ 
an
¬¬ 
=>
¬¬ 
an
¬¬  
.
¬¬  !%
Parametro_actor_negocio
¬¬! 8
)
¬¬8 9
.
¬¬9 :
Include
√√ 
(
√√ 
an
√√ 
=>
√√ 
an
√√  
.
√√  !
Actor_negocio_rol
√√! 2
.
√√2 3
Select
√√3 9
(
√√9 :
anr
√√: =
=>
√√> @
anr
√√A D
.
√√D E
Rol
√√E H
)
√√H I
)
√√I J
.
√√J K
Include
ƒƒ 
(
ƒƒ 
an
ƒƒ 
=>
ƒƒ 
an
ƒƒ  
.
ƒƒ  !
Rol
ƒƒ! $
)
ƒƒ$ %
.
≈≈ 
Where
≈≈ 
(
≈≈ 
an
≈≈ 
=>
≈≈ 
an
≈≈ 
.
≈≈  
id_rol
≈≈  &
==
≈≈' )
idRol
≈≈* /
&&
≈≈0 2
an
≈≈3 5
.
≈≈5 6

es_vigente
≈≈6 @
)
≈≈@ A
.
≈≈A B
Select
∆∆ 
(
∆∆ 
an
∆∆ 
=>
∆∆ 
an
∆∆ 
.
∆∆  
Actor
∆∆  %
)
∆∆% &
.
∆∆& '

SelectMany
∆∆' 1
(
∆∆1 2
a
∆∆2 3
=>
∆∆4 6
a
∆∆7 8
.
∆∆8 9
Actor_negocio
∆∆9 F
)
∆∆F G
.
∆∆G H
Where
«« 
(
«« 
an
«« 
=>
«« 
an
«« 
.
«« 
id_rol
«« %
==
««& (
idParentRol
««) 4
&&
««5 7
an
««8 :
.
««: ;

es_vigente
««; E
)
««E F
;
««F G
}
»» 	
public
…… 
ActorComercial_
…… #
ObtenerActorComercial
…… 4
(
……4 5
int
……5 8
id
……9 ;
)
……; <
{
   	
try
ÀÀ 
{
ÃÃ 
SigescomEntities
ÕÕ  
_db
ÕÕ! $
=
ÕÕ% &
new
ÕÕ' *
SigescomEntities
ÕÕ+ ;
(
ÕÕ; <
)
ÕÕ< =
;
ÕÕ= >
var
ŒŒ 
actorComercial
ŒŒ "
=
ŒŒ# $
_db
ŒŒ% (
.
ŒŒ( )
Actor_negocio
ŒŒ) 6
.
œœ 
Where
œœ 
(
œœ 
an
œœ 
=>
œœ  
an
œœ! #
.
œœ# $
id
œœ$ &
==
œœ' )
id
œœ* ,
)
œœ, -
.
œœ- .
Select
œœ. 4
(
œœ4 5
an
œœ5 7
=>
œœ8 :
new
œœ; >
ActorComercial_
œœ? N
{
–– 
Id
—— 
=
—— 
an
—— 
.
——  
id
——  "
,
——" #
IdActor
““ 
=
““  !
an
““" $
.
““$ %
id_actor
““% -
,
““- . 
NombreORazonSocial
”” *
=
””+ ,
an
””- /
.
””/ 0
Actor
””0 5
.
””5 6
primer_nombre
””6 C
,
””C D
NombreComercial
‘‘ '
=
‘‘( )
an
‘‘* ,
.
‘‘, -
Actor
‘‘- 2
.
‘‘2 3
segundo_nombre
‘‘3 A
,
‘‘A B&
NumeroDocumentoIdentidad
÷÷ 0
=
÷÷1 2
an
÷÷3 5
.
÷÷5 6
Actor
÷÷6 ;
.
÷÷; <(
numero_documento_identidad
÷÷< V
,
÷÷V W$
TipoDocumentoIdentidad
◊◊ .
=
◊◊/ 0
new
◊◊1 4
ItemGenerico
◊◊5 A
(
◊◊A B
)
◊◊B C
{
◊◊D E
Id
◊◊F H
=
◊◊I J
an
◊◊K M
.
◊◊M N
Actor
◊◊N S
.
◊◊S T$
id_documento_identidad
◊◊T j
,
◊◊j k
Nombre
◊◊l r
=
◊◊s t
an
◊◊u w
.
◊◊w x
Actor
◊◊x }
.
◊◊} ~
Detalle_maestro◊◊~ ç
.◊◊ç é
valor◊◊é ì
}◊◊î ï
,◊◊ï ñ
TipoPersona
ÿÿ #
=
ÿÿ$ %
new
ÿÿ& )
ItemGenerico
ÿÿ* 6
(
ÿÿ6 7
)
ÿÿ7 8
{
ÿÿ9 :
Id
ÿÿ; =
=
ÿÿ> ?
an
ÿÿ@ B
.
ÿÿB C
Actor
ÿÿC H
.
ÿÿH I
id_tipo_actor
ÿÿI V
,
ÿÿV W
Nombre
ÿÿX ^
=
ÿÿ_ `
an
ÿÿa c
.
ÿÿc d
Actor
ÿÿd i
.
ÿÿi j

Tipo_actor
ÿÿj t
.
ÿÿt u
nombre
ÿÿu {
}
ÿÿ| }
,
ÿÿ} ~
DomicilioFiscal
ŸŸ '
=
ŸŸ( )
new
ŸŸ* -

Direccion_
ŸŸ. 8
(
ŸŸ8 9
)
ŸŸ9 :
{
ŸŸ; <
Id
ŸŸ= ?
=
ŸŸ@ A
an
ŸŸB D
.
ŸŸD E
Actor
ŸŸE J
.
ŸŸJ K
	Direccion
ŸŸK T
.
ŸŸT U
FirstOrDefault
ŸŸU c
(
ŸŸc d
)
ŸŸd e
.
ŸŸe f
id
ŸŸf h
,
ŸŸh i
Pais
ŸŸj n
=
ŸŸo p
new
ŸŸq t
ItemGenericoŸŸu Å
(ŸŸÅ Ç
)ŸŸÇ É
{ŸŸÑ Ö
IdŸŸÜ à
=ŸŸâ ä
anŸŸã ç
.ŸŸç é
ActorŸŸé ì
.ŸŸì î
	DireccionŸŸî ù
.ŸŸù û
FirstOrDefaultŸŸû ¨
(ŸŸ¨ ≠
)ŸŸ≠ Æ
.ŸŸÆ Ø 
Detalle_maestro1ŸŸØ ø
.ŸŸø ¿
idŸŸ¿ ¬
,ŸŸ¬ √
NombreŸŸƒ  
=ŸŸÀ Ã
anŸŸÕ œ
.ŸŸœ –
ActorŸŸ– ’
.ŸŸ’ ÷
	DireccionŸŸ÷ ﬂ
.ŸŸﬂ ‡
FirstOrDefaultŸŸ‡ Ó
(ŸŸÓ Ô
)ŸŸÔ 
.ŸŸ Ò 
Detalle_maestro1ŸŸÒ Å
.ŸŸÅ Ç
nombreŸŸÇ à
}ŸŸâ ä
,ŸŸä ã
UbigeoŸŸå í
=ŸŸì î
newŸŸï ò
ItemGenericoŸŸô •
(ŸŸ• ¶
)ŸŸ¶ ß
{ŸŸ® ©
IdŸŸ™ ¨
=ŸŸ≠ Æ
anŸŸØ ±
.ŸŸ± ≤
ActorŸŸ≤ ∑
.ŸŸ∑ ∏
	DireccionŸŸ∏ ¡
.ŸŸ¡ ¬
FirstOrDefaultŸŸ¬ –
(ŸŸ– —
)ŸŸ— “
.ŸŸ“ ”
UbigeoŸŸ” Ÿ
.ŸŸŸ ⁄
idŸŸ⁄ ‹
,ŸŸ‹ ›
NombreŸŸﬁ ‰
=ŸŸÂ Ê
anŸŸÁ È
.ŸŸÈ Í
ActorŸŸÍ Ô
.ŸŸÔ 
	DireccionŸŸ ˘
.ŸŸ˘ ˙
FirstOrDefaultŸŸ˙ à
(ŸŸà â
)ŸŸâ ä
.ŸŸä ã
UbigeoŸŸã ë
.ŸŸë í!
descripcion_largaŸŸí £
}ŸŸ§ •
,ŸŸ• ¶
DetalleŸŸß Æ
=ŸŸØ ∞
anŸŸ± ≥
.ŸŸ≥ ¥
ActorŸŸ¥ π
.ŸŸπ ∫
	DireccionŸŸ∫ √
.ŸŸ√ ƒ
FirstOrDefaultŸŸƒ “
(ŸŸ“ ”
)ŸŸ” ‘
.ŸŸ‘ ’
detalleŸŸ’ ‹
}ŸŸ› ﬁ
}
⁄⁄ 
)
⁄⁄ 
.
⁄⁄ 
FirstOrDefault
⁄⁄ %
(
⁄⁄% &
)
⁄⁄& '
;
⁄⁄' (
actorComercial
€€ 
.
€€ 
ApellidoPaterno
€€ .
=
€€/ 0
actorComercial
€€1 ?
.
€€? @
TipoPersona
€€@ K
.
€€K L
Id
€€L N
==
€€O Q
ActorSettings
€€R _
.
€€_ `
Default
€€` g
.
€€g h(
IdTipoActorPersonaNatural€€h Å
?€€Ç É
actorComercial€€Ñ í
.€€í ì"
NombreORazonSocial€€ì •
.€€• ¶
Split€€¶ ´
(€€´ ¨
$char€€¨ Ø
)€€Ø ∞
[€€∞ ±
$num€€± ≤
]€€≤ ≥
:€€¥ µ
$str€€∂ ∏
;€€∏ π
actorComercial
‹‹ 
.
‹‹ 
ApellidoMaterno
‹‹ .
=
‹‹/ 0
actorComercial
‹‹1 ?
.
‹‹? @
TipoPersona
‹‹@ K
.
‹‹K L
Id
‹‹L N
==
‹‹O Q
ActorSettings
‹‹R _
.
‹‹_ `
Default
‹‹` g
.
‹‹g h(
IdTipoActorPersonaNatural‹‹h Å
&&‹‹Ç Ñ
actorComercial‹‹Ö ì
.‹‹ì î"
NombreORazonSocial‹‹î ¶
.‹‹¶ ß
Split‹‹ß ¨
(‹‹¨ ≠
$char‹‹≠ ∞
)‹‹∞ ±
.‹‹± ≤
Count‹‹≤ ∑
(‹‹∑ ∏
)‹‹∏ π
>‹‹∫ ª
$num‹‹º Ω
?‹‹æ ø
actorComercial‹‹¿ Œ
.‹‹Œ œ"
NombreORazonSocial‹‹œ ·
.‹‹· ‚
Split‹‹‚ Á
(‹‹Á Ë
$char‹‹Ë Î
)‹‹Î Ï
[‹‹Ï Ì
$num‹‹Ì Ó
]‹‹Ó Ô
:‹‹ Ò
$str‹‹Ú Ù
;‹‹Ù ı
actorComercial
›› 
.
›› 
Nombres
›› &
=
››' (
actorComercial
››) 7
.
››7 8
TipoPersona
››8 C
.
››C D
Id
››D F
==
››G I
ActorSettings
››J W
.
››W X
Default
››X _
.
››_ `'
IdTipoActorPersonaNatural
››` y
&&
››z |
actorComercial››} ã
.››ã å"
NombreORazonSocial››å û
.››û ü
Split››ü §
(››§ •
$char››• ®
)››® ©
.››© ™
Count››™ Ø
(››Ø ∞
)››∞ ±
>››≤ ≥
$num››¥ µ
?››∂ ∑
actorComercial››∏ ∆
.››∆ «"
NombreORazonSocial››« Ÿ
.››Ÿ ⁄
Split››⁄ ﬂ
(››ﬂ ‡
$char››‡ „
)››„ ‰
[››‰ Â
$num››Â Ê
]››Ê Á
:››Ë È
$str››Í Ï
;››Ï Ì
actorComercial
ﬁﬁ 
.
ﬁﬁ  
NombreORazonSocial
ﬁﬁ 1
=
ﬁﬁ2 3
actorComercial
ﬁﬁ4 B
.
ﬁﬁB C 
NombreORazonSocial
ﬁﬁC U
.
ﬁﬁU V
Replace
ﬁﬁV ]
(
ﬁﬁ] ^
$str
ﬁﬁ^ a
,
ﬁﬁa b
$str
ﬁﬁc f
)
ﬁﬁf g
;
ﬁﬁg h
return
ﬂﬂ 
actorComercial
ﬂﬂ %
;
ﬂﬂ% &
}
‡‡ 
catch
·· 
(
·· 
	Exception
·· 
e
·· 
)
·· 
{
‚‚ 
throw
„„ 
e
„„ 
;
„„ 
}
‰‰ 
}
ÂÂ 	
public
ÌÌ 
bool
ÌÌ +
ActorParticipaEnTransacciones
ÌÌ 1
(
ÌÌ1 2
int
ÌÌ2 5
idActorComercial
ÌÌ6 F
)
ÌÌF G
{
ÓÓ 	
SigescomEntities
ÔÔ 
_db
ÔÔ  
=
ÔÔ! "
new
ÔÔ# &
SigescomEntities
ÔÔ' 7
(
ÔÔ7 8
)
ÔÔ8 9
;
ÔÔ9 :
return
 
_db
 
.
 
Transaccion
 "
.
" #
Any
# &
(
& '
t
' (
=>
) +
t
, -
.
- .&
id_actor_negocio_interno
. F
==
G I
idActorComercial
J Z
||
[ ]
t
^ _
.
_ `&
id_actor_negocio_externo
` x
==
y {
idActorComercial| å
||ç è
tê ë
.ë í)
id_actor_negocio_interno1í ´
==¨ Æ 
idActorComercialØ ø
||¿ ¬
t√ ƒ
.ƒ ≈)
id_actor_negocio_externo1≈ ﬁ
==ﬂ · 
idActorComercial‚ Ú
)Ú Û
;Û Ù
}
ÒÒ 	
public
ÙÙ 
OperationResult
ÙÙ 
ActualizarActor
ÙÙ .
(
ÙÙ. /
Actor
ÙÙ/ 4
actor
ÙÙ5 :
)
ÙÙ: ;
{
ıı 	
try
ˆˆ 
{
˜˜ 
SigescomEntities
¯¯  
_db
¯¯! $
=
¯¯% &
new
¯¯' *
SigescomEntities
¯¯+ ;
(
¯¯; <
)
¯¯< =
;
¯¯= >
Actor
˘˘ 
dbActor
˘˘ 
=
˘˘ 
_db
˘˘  #
.
˘˘# $
Actor
˘˘$ )
.
˘˘) *
Single
˘˘* 0
(
˘˘0 1
m
˘˘1 2
=>
˘˘3 5
m
˘˘6 7
.
˘˘7 8
id
˘˘8 :
==
˘˘; =
actor
˘˘> C
.
˘˘C D
id
˘˘D F
)
˘˘F G
;
˘˘G H
_db
˙˙ 
.
˙˙ 
Entry
˙˙ 
(
˙˙ 
dbActor
˙˙ !
)
˙˙! "
.
˙˙" #
CurrentValues
˙˙# 0
.
˙˙0 1
	SetValues
˙˙1 :
(
˙˙: ;
actor
˙˙; @
)
˙˙@ A
;
˙˙A B
_db
˚˚ 
.
˚˚ 
SaveChanges
˚˚ 
(
˚˚  
)
˚˚  !
;
˚˚! "
var
¸¸ 
result
¸¸ 
=
¸¸ 
new
¸¸  
OperationResult
¸¸! 0
(
¸¸0 1!
OperationResultEnum
¸¸1 D
.
¸¸D E
Success
¸¸E L
)
¸¸L M
;
¸¸M N
result
˝˝ 
.
˝˝ 
data
˝˝ 
=
˝˝ 
actor
˝˝ #
.
˝˝# $
id
˝˝$ &
;
˝˝& '
return
˛˛ 
result
˛˛ 
;
˛˛ 
}
ˇˇ 
catch
ÄÄ 
(
ÄÄ 
	Exception
ÄÄ 
e
ÄÄ 
)
ÄÄ 
{
ÅÅ 
return
ÇÇ 
new
ÇÇ 
OperationResult
ÇÇ *
(
ÇÇ* +
e
ÇÇ+ ,
)
ÇÇ, -
;
ÇÇ- .
}
ÉÉ 
}
ÑÑ 	
public
ÜÜ 
IEnumerable
ÜÜ 
<
ÜÜ 
Actor_negocio
ÜÜ (
>
ÜÜ( )6
(ObtenerActorDeNegocioPorRolVigentesAhora
ÜÜ* R
(
ÜÜR S
int
ÜÜS V
idRol
ÜÜW \
)
ÜÜ\ ]
{
áá 	
SigescomEntities
àà 
_db
àà  
=
àà! "
new
àà# &
SigescomEntities
àà' 7
(
àà7 8
)
àà8 9
;
àà9 :
return
ââ 
_db
ââ 
.
ââ 
Actor_negocio
ââ $
.
ââ$ %
Include
ää 
(
ää 
an
ää 
=>
ää 
an
ää  
.
ää  !
Rol
ää! $
)
ää$ %
.
ää% &
Include
ãã 
(
ãã 
an
ãã 
=>
ãã 
an
ãã  
.
ãã  !
Actor
ãã! &
)
ãã& '
.
ãã' (
Include
åå 
(
åå 
an
åå 
=>
åå 
an
åå  
.
åå  !
Actor
åå! &
.
åå& '
	Direccion
åå' 0
)
åå0 1
.
åå1 2
Include
çç 
(
çç 
an
çç 
=>
çç 
an
çç  
.
çç  !
Actor
çç! &
.
çç& '
	Direccion
çç' 0
.
çç0 1
Select
çç1 7
(
çç7 8
d
çç8 9
=>
çç: <
d
çç= >
.
çç> ?
Ubigeo
çç? E
)
ççE F
)
ççF G
.
ççG H
Include
éé 
(
éé 
an
éé 
=>
éé 
an
éé  
.
éé  !
Actor
éé! &
.
éé& '
	Direccion
éé' 0
.
éé0 1
Select
éé1 7
(
éé7 8
d
éé8 9
=>
éé: <
d
éé= >
.
éé> ?
Detalle_maestro
éé? N
)
ééN O
)
ééO P
.
ééP Q
Include
èè 
(
èè 
an
èè 
=>
èè 
an
èè  
.
èè  !
Actor
èè! &
.
èè& '
	Direccion
èè' 0
.
èè0 1
Select
èè1 7
(
èè7 8
d
èè8 9
=>
èè: <
d
èè= >
.
èè> ?
Detalle_maestro1
èè? O
)
èèO P
)
èèP Q
.
èèQ R
Include
êê 
(
êê 
an
êê 
=>
êê 
an
êê  
.
êê  !
Actor
êê! &
.
êê& '
	Direccion
êê' 0
.
êê0 1
Select
êê1 7
(
êê7 8
d
êê8 9
=>
êê: <
d
êê= >
.
êê> ?
Detalle_maestro2
êê? O
)
êêO P
)
êêP Q
.
êêQ R
Include
ëë 
(
ëë 
an
ëë 
=>
ëë 
an
ëë  
.
ëë  !
Actor
ëë! &
.
ëë& '
	Direccion
ëë' 0
.
ëë0 1
Select
ëë1 7
(
ëë7 8
d
ëë8 9
=>
ëë: <
d
ëë= >
.
ëë> ?
Detalle_maestro3
ëë? O
)
ëëO P
)
ëëP Q
.
ëëQ R
Include
íí 
(
íí 
an
íí 
=>
íí 
an
íí  
.
íí  !
Actor
íí! &
.
íí& '

Tipo_actor
íí' 1
)
íí1 2
.
íí2 3
Include
ìì 
(
ìì 
an
ìì 
=>
ìì 
an
ìì  
.
ìì  !
Actor
ìì! &
.
ìì& '
Detalle_maestro
ìì' 6
)
ìì6 7
.
ìì7 8
Include
îî 
(
îî 
an
îî 
=>
îî 
an
îî  
.
îî  !
Actor_negocio_rol
îî! 2
)
îî2 3
.
îî3 4
Include
ïï 
(
ïï 
an
ïï 
=>
ïï 
an
ïï  
.
ïï  !
Actor_negocio_rol
ïï! 2
.
ïï2 3
Select
ïï3 9
(
ïï9 :
anr
ïï: =
=>
ïï> @
anr
ïïA D
.
ïïD E
Rol
ïïE H
)
ïïH I
)
ïïI J
.
ïïJ K
Where
ññ 
(
ññ 
an
ññ 
=>
ññ 
an
ññ 
.
ññ 
id_rol
ññ %
==
ññ& (
idRol
ññ) .
&&
ññ/ 1
an
ññ2 4
.
ññ4 5

es_vigente
ññ5 ?
==
ññ@ B
true
ññC G
)
ññG H
;
ññH I
}
òò 	
public
öö 
OperationResult
öö +
InvertirEsVigenteActorNegocio
öö <
(
öö< =
int
öö= @
idActorNegocio
ööA O
)
ööO P
{
õõ 	
try
úú 
{
ùù 
SigescomEntities
üü  
_db
üü! $
=
üü% &
new
üü' *
SigescomEntities
üü+ ;
(
üü; <
)
üü< =
;
üü= >
var
†† 
dbActorNegocio
†† "
=
††# $
_db
††% (
.
††( )
Actor_negocio
††) 6
.
††6 7
FirstOrDefault
††7 E
(
††E F
an
††F H
=>
††I K
an
††L N
.
††N O
id
††O Q
==
††R T
idActorNegocio
††U c
)
††c d
;
††d e
dbActorNegocio
°° 
.
°° 

es_vigente
°° )
=
°°* +
!
°°, -
dbActorNegocio
°°- ;
.
°°; <

es_vigente
°°< F
;
°°F G
_db
¢¢ 
.
¢¢ 
SaveChanges
¢¢ 
(
¢¢  
)
¢¢  !
;
¢¢! "
return
££ 
new
££ 
OperationResult
££ *
(
££* +!
OperationResultEnum
££+ >
.
££> ?
Success
££? F
)
££F G
;
££G H
}
§§ 
catch
•• 
(
•• 
	Exception
•• 
e
•• 
)
•• 
{
¶¶ 
throw
ßß 
new
ßß 
DatosException
ßß (
(
ßß( )
$str
ßß) S
,
ßßS T
e
ßßU V
)
ßßV W
;
ßßW X
}
®® 
}
©© 	
public
™™ 
OperationResult
™™ ,
InvertirIndicador1ActorNegocio
™™ =
(
™™= >
int
™™> A
idActorNegocio
™™B P
)
™™P Q
{
´´ 	
try
¨¨ 
{
≠≠ 
SigescomEntities
ÆÆ  
_db
ÆÆ! $
=
ÆÆ% &
new
ÆÆ' *
SigescomEntities
ÆÆ+ ;
(
ÆÆ; <
)
ÆÆ< =
;
ÆÆ= >
var
ØØ 
dbActorNegocio
ØØ "
=
ØØ# $
_db
ØØ% (
.
ØØ( )
Actor_negocio
ØØ) 6
.
ØØ6 7
FirstOrDefault
ØØ7 E
(
ØØE F
an
ØØF H
=>
ØØI K
an
ØØL N
.
ØØN O
id
ØØO Q
==
ØØR T
idActorNegocio
ØØU c
)
ØØc d
;
ØØd e
dbActorNegocio
∞∞ 
.
∞∞ 

indicador1
∞∞ )
=
∞∞* +
!
∞∞, -
dbActorNegocio
∞∞- ;
.
∞∞; <

indicador1
∞∞< F
;
∞∞F G
_db
±± 
.
±± 
SaveChanges
±± 
(
±±  
)
±±  !
;
±±! "
return
≤≤ 
new
≤≤ 
OperationResult
≤≤ *
(
≤≤* +!
OperationResultEnum
≤≤+ >
.
≤≤> ?
Success
≤≤? F
)
≤≤F G
;
≤≤G H
}
≥≥ 
catch
¥¥ 
(
¥¥ 
	Exception
¥¥ 
e
¥¥ 
)
¥¥ 
{
µµ 
throw
∂∂ 
new
∂∂ 
DatosException
∂∂ (
(
∂∂( )
$str
∂∂) X
,
∂∂X Y
e
∂∂Z [
)
∂∂[ \
;
∂∂\ ]
}
∑∑ 
}
ππ 	
public
ªª 
int
ªª 
[
ªª 
]
ªª 6
(ObtenerIdsActorDeNegocioVigentePrincipal
ªª =
(
ªª= >
int
ªª> A
idParentRol
ªªB M
,
ªªM N
int
ªªO R
idRol
ªªS X
)
ªªX Y
{
ºº 	
SigescomEntities
ææ 
_db
ææ  
=
ææ! "
new
ææ# &
SigescomEntities
ææ' 7
(
ææ7 8
)
ææ8 9
;
ææ9 :
return
øø 
_db
øø 
.
øø 
Actor_negocio
øø $
.
øø$ %
Where
øø% *
(
øø* +
an
øø+ -
=>
øø. 0
an
øø1 3
.
øø3 4
id_rol
øø4 :
==
øø; =
idRol
øø> C
&&
øøD F
an
øøG I
.
øøI J

es_vigente
øøJ T
)
øøT U
.
øøU V
Select
øøV \
(
øø\ ]
an
øø] _
=>
øø` b
an
øøc e
.
øøe f
Actor
øøf k
)
øøk l
.
øøl m

SelectMany
øøm w
(
øøw x
a
øøx y
=>
øøz |
a
øø} ~
.
øø~ 
Actor_negocioøø å
)øøå ç
.øøç é
Whereøøé ì
(øøì î
anøøî ñ
=>øøó ô
anøøö ú
.øøú ù
id_roløøù £
==øø§ ¶
idParentRoløøß ≤
)øø≤ ≥
.øø≥ ¥
Selectøø¥ ∫
(øø∫ ª
anøøª Ω
=>øøæ ¿
anøø¡ √
.øø√ ƒ
idøøƒ ∆
)øø∆ «
.øø« »
ToArrayøø» œ
(øøœ –
)øø– —
;øø— “
}
¿¿ 	
public
¬¬ 
string
¬¬ 0
"ObtenerExtensionJsonDeActorNegocio
¬¬ 8
(
¬¬8 9
int
¬¬9 <
idActorNegocio
¬¬= K
)
¬¬K L
{
√√ 	
try
ƒƒ 
{
≈≈ 
SigescomEntities
∆∆  
_db
∆∆! $
=
∆∆% &
new
∆∆' *
SigescomEntities
∆∆+ ;
(
∆∆; <
)
∆∆< =
;
∆∆= >
return
«« 
_db
«« 
.
«« 
Actor_negocio
«« (
.
««( )
Single
««) /
(
««/ 0
an
««0 2
=>
««3 5
an
««6 8
.
««8 9
id
««9 ;
==
««< >
idActorNegocio
««? M
)
««M N
.
««N O
extension_json
««O ]
;
««] ^
}
»» 
catch
…… 
(
…… 
	Exception
…… 
e
…… 
)
…… 
{
   
throw
ÀÀ 
new
ÀÀ 
DatosException
ÀÀ (
(
ÀÀ( )
$str
ÀÀ) k
,
ÀÀk l
e
ÀÀm n
)
ÀÀn o
;
ÀÀo p
}
ÃÃ 
}
ÕÕ 	
public
œœ 
IEnumerable
œœ 
<
œœ 
ResumenCliente
œœ )
>
œœ) *,
ObtenerResumenClientesVigentes
œœ+ I
(
œœI J
)
œœJ K
{
–– 	
SigescomEntities
—— 
_db
——  
=
——! "
new
——# &
SigescomEntities
——' 7
(
——7 8
)
——8 9
;
——9 :
return
““ 
_db
““ 
.
““ 
Actor_negocio
““ $
.
““$ %
Where
““% *
(
““* +
an
““+ -
=>
““. 0
an
““1 3
.
““3 4
id_rol
““4 :
==
““; =
ActorSettings
““> K
.
““K L
Default
““L S
.
““S T
IdRolCliente
““T `
&&
““a c
an
““d f
.
““f g

es_vigente
““g q
==
““r t
true
““u y
)
““y z
.
““z {
Select““{ Å
(““Å Ç
an““Ç Ñ
=>““Ö á
new
”” 
ResumenCliente
”” 
(
”” 
)
””  
{
‘‘ 
Id
’’ 
=
’’ 
an
’’ 
.
’’ 
id
’’ 
,
’’ 
Codigo
÷÷ 
=
÷÷ 
an
÷÷ 
.
÷÷ 
codigo_negocio
÷÷ *
,
÷÷* +
RazonSocial
◊◊ 
=
◊◊ 
an
◊◊  
.
◊◊  !
Actor
◊◊! &
.
◊◊& '
primer_nombre
◊◊' 4
.
◊◊4 5
Replace
◊◊5 <
(
◊◊< =
$str
◊◊= @
,
◊◊@ A
$str
◊◊B E
)
◊◊E F
,
◊◊F G&
NumeroDocumentoIdentidad
ÿÿ (
=
ÿÿ) *
an
ÿÿ+ -
.
ÿÿ- .
Actor
ÿÿ. 3
.
ÿÿ3 4(
numero_documento_identidad
ÿÿ4 N
,
ÿÿN O$
TipoDocumentoIdentidad
ŸŸ &
=
ŸŸ' (
an
ŸŸ) +
.
ŸŸ+ ,
Actor
ŸŸ, 1
.
ŸŸ1 2
Detalle_maestro
ŸŸ2 A
.
ŸŸA B
valor
ŸŸB G
,
ŸŸG H
TipoPersona
⁄⁄ 
=
⁄⁄ 
an
⁄⁄  
.
⁄⁄  !
Actor
⁄⁄! &
.
⁄⁄& '

Tipo_actor
⁄⁄' 1
.
⁄⁄1 2
nombre
⁄⁄2 8
,
⁄⁄8 9
Telefono
€€ 
=
€€ 
an
€€ 
.
€€ 
Actor
€€ #
.
€€# $
telefono
€€$ ,
,
€€, -
Correo
‹‹ 
=
‹‹ 
an
‹‹ 
.
‹‹ 
Actor
‹‹ !
.
‹‹! "
correo
‹‹" (
,
‹‹( )
DetalleDireccion
››  
=
››! "
an
››# %
.
››% &
Actor
››& +
.
››+ ,
	Direccion
››, 5
.
››5 6
FirstOrDefault
››6 D
(
››D E
)
››E F
.
››F G
detalle
››G N
,
››N O
UbigeoDireccion
ﬁﬁ 
=
ﬁﬁ  !
an
ﬁﬁ" $
.
ﬁﬁ$ %
Actor
ﬁﬁ% *
.
ﬁﬁ* +
	Direccion
ﬁﬁ+ 4
.
ﬁﬁ4 5
FirstOrDefault
ﬁﬁ5 C
(
ﬁﬁC D
)
ﬁﬁD E
.
ﬁﬁE F
Ubigeo
ﬁﬁF L
.
ﬁﬁL M
descripcion_larga
ﬁﬁM ^
,
ﬁﬁ^ _
}
ﬂﬂ 
)
ﬂﬂ 
;
ﬂﬂ 
}
‡‡ 	
}
·· 
}‰‰ ëÎ
[D:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\Almacen\InventarioActual_Datos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
." #
Almacen# *
{ 
public 

partial 
class "
InventarioActual_Datos /
:/ 0(
IInventarioActualRepositorio1 M
{ 
public 
IEnumerable 
< 
Detalle_transaccion .
>. /D
8ObtenerDetallesInventarioActualIncluyendoConceptoNegocio0 h
(h i
inti l"
idActorNegocioInterno	m Ç
)
Ç É
{ 	
try 
{ 
SigescomEntities  
_db! $
=% &
new' *
SigescomEntities+ ;
(; <
)< =
;= >
return 
_db 
. 
Transaccion &
.# $
Where$ )
() *
t* +
=>, .
t/ 0
.0 1$
id_actor_negocio_interno1 I
==J L!
idActorNegocioInternoM b
&&/ 1
t2 3
.3 4
id_tipo_transaccion4 G
==H J
TransaccionSettingsK ^
.^ _
Default_ f
.f g.
!IdTipoTransaccionInventarioActual	g à
)# $
.$ %

SelectMany% /
(/ 0
t0 1
=>2 4
t5 6
.6 7
Detalle_transaccion7 J
)J K
.$ %
Include% ,
(, -
dt- /
=>0 2
dt3 5
.5 6
Concepto_negocio6 F
)F G
;G H
} 
catch 
( 
	Exception 
e 
) 
{   
throw!! 
new!! 
DatosException!! (
(!!( )
$str!!) w
,!!w x
e!!y z
)!!z {
;!!{ |
}"" 
}## 	
public%% 
Transaccion%% 2
&ObtenerUltimaOperacionInventarioActual%% A
(%%A B
)%%B C
{&& 	
try'' 
{(( 
SigescomEntities))  
_db))! $
=))% &
new))' *
SigescomEntities))+ ;
()); <
)))< =
;))= >
return** 
_db** 
.** 
Transaccion** &
.**& '
Where**' ,
(**, -
t**- .
=>**/ 1
t**2 3
.**3 4
id_tipo_transaccion**4 G
==**H J
TransaccionSettings**K ^
.**^ _
Default**_ f
.**f g7
*IdTipoTransaccionOperacionInventarioActual	**g ë
)
**ë í
.
**í ì
OrderByDescending
**ì §
(
**§ •
t
**• ¶
=>
**ß ©
t
**™ ´
.
**´ ¨
id
**¨ Æ
)
**Æ Ø
.
**Ø ∞
FirstOrDefault
**∞ æ
(
**æ ø
)
**ø ¿
;
**¿ ¡
}++ 
catch,, 
(,, 
	Exception,, 
e,, 
),, 
{-- 
throw.. 
e.. 
;.. 
}// 
}00 	
public11 
IEnumerable11 
<11 !
InventarioVencimiento11 0
>110 1/
#ObtenerVencimientosInventarioActual112 U
(11U V
int11V Y
	idAlmacen11Z c
,11c d
DateTime11e m
vencimientoDesde11n ~
,11~ 
DateTime
11Ä à
vencimientoHasta
11â ô
)
11ô ö
{22 	
try33 
{44 
SigescomEntities55  
_db55! $
=55% &
new55' *
SigescomEntities55+ ;
(55; <
)55< =
;55= >
var66 

inventario66 
=66  
_db66! $
.66$ %
Transaccion66% 0
.660 1
Where661 6
(666 7
t667 8
=>669 ;
t66< =
.66= >
id_tipo_transaccion66> Q
==66R T
TransaccionSettings66U h
.66h i
Default66i p
.66p q.
!IdTipoTransaccionInventarioActual	66q í
&&
66ì ï
t
66ñ ó
.
66ó ò&
id_actor_negocio_interno
66ò ∞
==
66± ≥
	idAlmacen
66¥ Ω
)
66Ω æ
.
66æ ø

SelectMany
66ø …
(
66…  
t
66  À
=>
66Ã Œ
t
66œ –
.
66– —!
Detalle_transaccion
66— ‰
)
66‰ Â
.
66Â Ê
Where
66Ê Î
(
66Î Ï
dt
66Ï Ó
=>
66Ô Ò
dt
66Ú Ù
.
66Ù ı
vencimiento
66ı Ä
>=
66Å É
vencimientoDesde
66Ñ î
&&
66ï ó
dt
66ò ö
.
66ö õ
vencimiento
66õ ¶
<=
66ß ©
vencimientoHasta
66™ ∫
)
66∫ ª
.
66ª º
Select
66º ¬
(
66¬ √
dt
66√ ≈
=>
66∆ »
new
66… Ã#
InventarioVencimiento
66Õ ‚
(
66‚ „
)
66„ ‰
{77 
	IdAlmacen88 
=88 
dt88  "
.88" #
Transaccion88# .
.88. /$
id_actor_negocio_interno88/ G
,88G H
CodigoBarra99 
=99  !
dt99" $
.99$ %
Concepto_negocio99% 5
.995 6
codigo_barra996 B
,99B C
Concepto:: 
=:: 
dt:: !
.::! "
Concepto_negocio::" 2
.::2 3
nombre::3 9
,::9 :
Cantidad;; 
=;; 
dt;; !
.;;! "
cantidad;;" *
,;;* +
Familia<< 
=<< 
dt<<  
.<<  !
Concepto_negocio<<! 1
.<<1 2
Detalle_maestro4<<2 B
.<<B C
nombre<<C I
,<<I J
Lote== 
=== 
dt== 
.== 
lote== "
,==" #
UnidadMedida>>  
=>>! "
dt>># %
.>>% &
Concepto_negocio>>& 6
.>>6 7
Detalle_maestro>>7 F
.>>F G
codigo>>G M
,>>M N
FechaVencimiento?? $
=??% &
dt??' )
.??) *
vencimiento??* 5
}@@ 
)AA 
;AA 
returnBB 

inventarioBB !
;BB! "
}CC 
catchDD 
(DD 
	ExceptionDD 
eDD 
)DD 
{EE 
throwEE 
newEE 
DatosExceptionEE &
(EE& '
$strEE' G
,EEG H
eEEI J
)EEJ K
;EEK L
}EEM N
}FF 	
publicHH 
IEnumerableHH 
<HH !
InventarioVencimientoHH 0
>HH0 1/
#ObtenerVencimientosInventarioActualHH2 U
(HHU V
intHHV Y
	idAlmacenHHZ c
,HHc d
DateTimeHHe m

fechaDesdeHHn x
,HHx y
DateTime	HHz Ç

fechaHasta
HHÉ ç
,
HHç é
int
HHè í
[
HHí ì
]
HHì î
familias
HHï ù
)
HHù û
{II 	
tryJJ 
{KK 
SigescomEntitiesLL  
_dbLL! $
=LL% &
newLL' *
SigescomEntitiesLL+ ;
(LL; <
)LL< =
;LL= >
varMM 

inventarioMM 
=MM  
_dbMM! $
.MM$ %
TransaccionMM% 0
.MM0 1
WhereMM1 6
(MM6 7
tMM7 8
=>MM9 ;
tMM< =
.MM= >
id_tipo_transaccionMM> Q
==MMR T
TransaccionSettingsMMU h
.MMh i
DefaultMMi p
.MMp q.
!IdTipoTransaccionInventarioActual	MMq í
&&
MMì ï
t
MMñ ó
.
MMó ò&
id_actor_negocio_interno
MMò ∞
==
MM± ≥
	idAlmacen
MM¥ Ω
)
MMΩ æ
.
MMæ ø

SelectMany
MMø …
(
MM…  
t
MM  À
=>
MMÃ Œ
t
MMœ –
.
MM– —!
Detalle_transaccion
MM— ‰
)
MM‰ Â
.
MMÂ Ê
Where
MMÊ Î
(
MMÎ Ï
dt
MMÏ Ó
=>
MMÔ Ò
familias
MMÚ ˙
.
MM˙ ˚
Contains
MM˚ É
(
MMÉ Ñ
dt
MMÑ Ü
.
MMÜ á
Concepto_negocio
MMá ó
.
MMó ò 
id_concepto_basico
MMò ™
)
MM™ ´
&&
MM¨ Æ
dt
MMØ ±
.
MM± ≤
vencimiento
MM≤ Ω
>=
MMæ ¿

fechaDesde
MM¡ À
&&
MMÃ Œ
dt
MMœ —
.
MM— “
vencimiento
MM“ ›
<=
MMﬁ ‡

fechaHasta
MM· Î
)
MMÎ Ï
.
MMÏ Ì
Select
MMÌ Û
(
MMÛ Ù
dt
MMÙ ˆ
=>
MM˜ ˘
new
MM˙ ˝#
InventarioVencimiento
MM˛ ì
(
MMì î
)
MMî ï
{NN 
	IdAlmacenOO 
=OO 
dtOO  "
.OO" #
TransaccionOO# .
.OO. /$
id_actor_negocio_internoOO/ G
,OOG H
CodigoBarraPP 
=PP  !
dtPP" $
.PP$ %
Concepto_negocioPP% 5
.PP5 6
codigo_barraPP6 B
,PPB C
ConceptoQQ 
=QQ 
dtQQ !
.QQ! "
Concepto_negocioQQ" 2
.QQ2 3
nombreQQ3 9
,QQ9 :
CantidadRR 
=RR 
dtRR !
.RR! "
cantidadRR" *
,RR* +
FamiliaSS 
=SS 
dtSS  
.SS  !
Concepto_negocioSS! 1
.SS1 2
Detalle_maestro4SS2 B
.SSB C
nombreSSC I
,SSI J
LoteTT 
=TT 
dtTT 
.TT 
loteTT "
,TT" #
UnidadMedidaUU  
=UU! "
dtUU# %
.UU% &
Concepto_negocioUU& 6
.UU6 7
Detalle_maestroUU7 F
.UUF G
codigoUUG M
,UUM N
FechaVencimientoVV $
=VV% &
dtVV' )
.VV) *
vencimientoVV* 5
}WW 
)XX 
;XX 
returnYY 

inventarioYY !
;YY! "
}ZZ 
catch[[ 
([[ 
	Exception[[ 
e[[ 
)[[ 
{\\ 
throw\\ 
new\\ 
DatosException\\ &
(\\& '
$str\\' G
,\\G H
e\\I J
)\\J K
;\\K L
}\\M N
}]] 	
publicaa 
InventarioFisicoaa )
ObtenerInventarioFisicoActualaa  =
(aa= >
intaa> A
	idAlmacenaaB K
,aaK L
intaaM P

idConceptoaaQ [
)aa[ \
{bb 	
SigescomEntitiescc 
_dbcc  
=cc! "
newcc# &
SigescomEntitiescc' 7
(cc7 8
)cc8 9
;cc9 :
vardd 

inventariodd 
=dd 
_dbdd  
.dd  !
Transacciondd! ,
.dd, -
Wheredd- 2
(dd2 3
tdd3 4
=>dd5 7
tdd8 9
.dd9 :
id_tipo_transacciondd: M
==ddN P
TransaccionSettingsddQ d
.ddd e
Defaultdde l
.ddl m.
!IdTipoTransaccionInventarioActual	ddm é
&&
ddè ë
t
ddí ì
.
ddì î&
id_actor_negocio_interno
ddî ¨
==
dd≠ Ø
	idAlmacen
dd∞ π
)
ddπ ∫
.
dd∫ ª

SelectMany
ddª ≈
(
dd≈ ∆
t
dd∆ «
=>
dd« …
t
dd…  
.
dd  À!
Detalle_transaccion
ddÀ ﬁ
)
ddﬁ ﬂ
.
ddﬂ ‡
Where
dd‡ Â
(
ddÂ Ê
dt
ddÊ Ë
=>
ddË Í
dt
ddÍ Ï
.
ddÏ Ì!
id_concepto_negocio
ddÌ Ä
==
ddÄ Ç

idConcepto
ddÉ ç
)
ddç é
.
ddé è
GroupBy
ddè ñ
(
ddñ ó
dt
ddó ô
=>
ddö ú
new
ddù †
{
dd° ¢
dt
dd£ •
.
dd• ¶
Concepto_negocio
dd¶ ∂
.
dd∂ ∑
codigo_barra
dd∑ √
,
dd√ ƒ
dt
dd≈ «
.
dd« »
Concepto_negocio
dd» ÿ
.
ddÿ Ÿ
nombre
ddŸ ﬂ
}
dd‡ ·
)
dd· ‚
.
dd‚ „
Select
dd„ È
(
ddÈ Í
dt
ddÍ Ï
=>
ddÌ Ô
new
dd Û
InventarioFisico
ddÙ Ñ
(
ddÑ Ö
)
ddÖ Ü
{ee 
CodigoBarraff 
=ff 
dtff  
.ff  !
Keyff! $
.ff$ %
codigo_barraff% 1
,ff1 2
Conceptogg 
=gg 
dtgg 
.gg 
Keygg !
.gg! "
nombregg" (
,gg( )
Cantidadhh 
=hh 
dthh 
.hh 
Sumhh !
(hh! "
dhh" #
=>hh$ &
dhh' (
.hh( )
cantidadhh) 1
)hh1 2
,hh2 3
Familiaii 
=ii 
dtii 
.ii 
FirstOrDefaultii +
(ii+ ,
)ii, -
.ii- .
Concepto_negocioii. >
.ii> ?
Detalle_maestro4ii? O
.iiO P
nombreiiP V
,iiV W
UnidadMedidajj 
=jj 
dtjj !
.jj! "
FirstOrDefaultjj" 0
(jj0 1
)jj1 2
.jj2 3
Concepto_negociojj3 C
.jjC D
Detalle_maestrojjD S
.jjS T
codigojjT Z
}kk 
)ll 
.ll 
SingleOrDefaultll 
(ll 
)ll 
;ll  
returnnn 

inventarionn 
;nn 
}oo 	
publicqq  
InventarioValorizadoqq #-
!ObtenerInventarioValorizadoActualqq$ E
(qqE F
intqqF I
	idAlmacenqqJ S
,qqS T
intqqU X

idConceptoqqY c
)qqc d
{rr 	
SigescomEntitiesss 
_dbss  
=ss! "
newss# &
SigescomEntitiesss' 7
(ss7 8
)ss8 9
;ss9 :
vartt 

inventariott 
=tt 
_dbtt  
.tt  !
Transacciontt! ,
.tt, -
Wherett- 2
(tt2 3
ttt3 4
=>tt5 7
ttt8 9
.tt9 :
id_tipo_transacciontt: M
==ttN P
TransaccionSettingsttQ d
.ttd e
Defaulttte l
.ttl m.
!IdTipoTransaccionInventarioActual	ttm é
&&
ttè ë
t
ttí ì
.
ttì î&
id_actor_negocio_interno
ttî ¨
==
tt≠ Ø
	idAlmacen
tt∞ π
)
ttπ ∫
.
tt∫ ª

SelectMany
ttª ≈
(
tt≈ ∆
t
tt∆ «
=>
tt»  
t
ttÀ Ã
.
ttÃ Õ!
Detalle_transaccion
ttÕ ‡
)
tt‡ ·
.
tt· ‚
Where
tt‚ Á
(
ttÁ Ë
dt
ttË Í
=>
ttÎ Ì
dt
ttÓ 
.
tt Ò!
id_concepto_negocio
ttÒ Ñ
==
ttÖ á

idConcepto
ttà í
)
ttí ì
.
ttì î
GroupBy
ttî õ
(
ttõ ú
dt
ttú û
=>
ttü °
new
tt¢ •
{
tt¶ ß
dt
tt® ™
.
tt™ ´
Concepto_negocio
tt´ ª
.
ttª º
codigo_barra
ttº »
,
tt» …
dt
tt  Ã
.
ttÃ Õ
Concepto_negocio
ttÕ ›
.
tt› ﬁ
nombre
ttﬁ ‰
}
ttÂ Ê
)
ttÊ Á
.
ttÁ Ë
Select
ttË Ó
(
ttÓ Ô
dt
ttÔ Ò
=>
ttÚ Ù
new
ttı ¯"
InventarioValorizado
tt˘ ç
(
ttç é
)
tté è
{uu 
CodigoBarravv 
=vv 
dtvv  
.vv  !
Keyvv! $
.vv$ %
codigo_barravv% 1
,vv1 2
Conceptoww 
=ww 
dtww 
.ww 
Keyww !
.ww! "
nombreww" (
,ww( )
Cantidadxx 
=xx 
dtxx 
.xx 
Sumxx !
(xx! "
dxx" #
=>xx$ &
dxx' (
.xx( )
cantidadxx) 1
)xx1 2
,xx2 3
Familiayy 
=yy 
dtyy 
.yy 
FirstOrDefaultyy +
(yy+ ,
)yy, -
.yy- .
Concepto_negocioyy. >
.yy> ?
Detalle_maestro4yy? O
.yyO P
nombreyyP V
,yyV W
UnidadMedidazz 
=zz 
dtzz !
.zz! "
FirstOrDefaultzz" 0
(zz0 1
)zz1 2
.zz2 3
Concepto_negociozz3 C
.zzC D
Detalle_maestrozzD S
.zzS T
codigozzT Z
,zzZ [

ValorTotal{{ 
={{ 
dt{{ 
.{{  
Sum{{  #
({{# $
d{{$ %
=>{{% '
d{{( )
.{{) *
total{{* /
){{/ 0
,{{0 1
ValorUnitario|| 
=|| 
dt||  "
.||" #
Sum||# &
(||& '
d||' (
=>||( *
d||+ ,
.||, -
precio_unitario||- <
)||< =
}}} 
)~~ 
.~~ 
SingleOrDefault~~ 
(~~ 
)~~ 
;~~  
return
ÄÄ 

inventario
ÄÄ 
;
ÄÄ 
}
ÇÇ 	
public
ÉÉ 
IEnumerable
ÉÉ 
<
ÉÉ 
InventarioFisico
ÉÉ +
>
ÉÉ+ ,+
ObtenerInventarioFisicoActual
ÉÉ- J
(
ÉÉJ K
int
ÉÉK N
	idAlmacen
ÉÉO X
)
ÉÉX Y
{
ÑÑ 	
SigescomEntities
ÖÖ 
_db
ÖÖ  
=
ÖÖ! "
new
ÖÖ# &
SigescomEntities
ÖÖ' 7
(
ÖÖ7 8
)
ÖÖ8 9
;
ÖÖ9 :
var
ÜÜ 

inventario
ÜÜ 
=
ÜÜ 
_db
ÜÜ  
.
ÜÜ  !
Transaccion
ÜÜ! ,
.
ÜÜ, -
SingleOrDefault
ÜÜ- <
(
ÜÜ< =
t
ÜÜ= >
=>
ÜÜ? A
t
ÜÜB C
.
ÜÜC D!
id_tipo_transaccion
ÜÜD W
==
ÜÜX Z!
TransaccionSettings
ÜÜ[ n
.
ÜÜn o
Default
ÜÜo v
.
ÜÜv w0
!IdTipoTransaccionInventarioActualÜÜw ò
&&ÜÜô õ
tÜÜú ù
.ÜÜù û(
id_actor_negocio_internoÜÜû ∂
==ÜÜ∑ π
	idAlmacenÜÜ∫ √
)ÜÜ√ ƒ
.ÜÜƒ ≈#
Detalle_transaccionÜÜ≈ ÿ
.ÜÜÿ Ÿ
SelectÜÜŸ ﬂ
(ÜÜﬂ ‡
dtÜÜ‡ ‚
=>ÜÜ„ Â
newÜÜÊ È 
InventarioFisicoÜÜÍ ˙
(ÜÜ˙ ˚
)ÜÜ˚ ¸
{
áá 
CodigoBarra
àà 
=
àà 
dt
àà  
.
àà  !
Concepto_negocio
àà! 1
.
àà1 2
codigo_barra
àà2 >
,
àà> ?
Concepto
ââ 
=
ââ 
dt
ââ 
.
ââ 
Concepto_negocio
ââ .
.
ââ. /
nombre
ââ/ 5
,
ââ5 6
Cantidad
ää 
=
ää 
dt
ää 
.
ää 
cantidad
ää &
,
ää& '
Familia
ãã 
=
ãã 
dt
ãã 
.
ãã 
Concepto_negocio
ãã -
.
ãã- .
Detalle_maestro4
ãã. >
.
ãã> ?
nombre
ãã? E
,
ããE F
Lote
åå 
=
åå 
dt
åå 
.
åå 
lote
åå 
,
åå 
UnidadMedida
çç 
=
çç 
dt
çç !
.
çç! "
Concepto_negocio
çç" 2
.
çç2 3
Detalle_maestro
çç3 B
.
ççB C
codigo
ççC I
}
éé 
)
èè 
;
èè 
return
ëë 

inventario
ëë 
;
ëë 
}
íí 	
public
ìì 
IEnumerable
ìì 
<
ìì 
InventarioFisico
ìì +
>
ìì+ ,4
&ObtenerInventarioFisicoConceptosActual
ìì- S
(
ììS T
int
ììT W
	idAlmacen
ììX a
,
ììa b
int
ììc f
[
ììf g
]
ììg h
idsConceptos
ììi u
)
ììu v
{
îî 	
SigescomEntities
ïï 
_db
ïï  
=
ïï! "
new
ïï# &
SigescomEntities
ïï' 7
(
ïï7 8
)
ïï8 9
;
ïï9 :
var
ññ 

inventario
ññ 
=
ññ 
_db
ññ  
.
ññ  !
Transaccion
ññ! ,
.
ññ, -
SingleOrDefault
ññ- <
(
ññ< =
t
ññ= >
=>
ññ? A
t
ññB C
.
ññC D!
id_tipo_transaccion
ññD W
==
ññX Z!
TransaccionSettings
ññ[ n
.
ññn o
Default
ñño v
.
ññv w0
!IdTipoTransaccionInventarioActualññw ò
&&ññô õ
tññú ù
.ññù û(
id_actor_negocio_internoññû ∂
==ññ∑ π
	idAlmacenññ∫ √
)ññ√ ƒ
.ññƒ ≈#
Detalle_transaccionññ≈ ÿ
.ññÿ Ÿ
WhereññŸ ﬁ
(ññﬁ ﬂ
dtññﬂ ·
=>ññ· „
idsConceptosññ„ Ô
.ññÔ 
Containsññ ¯
(ññ¯ ˘
dtññ˘ ˚
.ññ˚ ¸#
id_concepto_negocioññ¸ è
)ññè ê
)ññê ë
.ññë í
Selectññí ò
(ññò ô
dtññô õ
=>ññú û
newññü ¢ 
InventarioFisicoññ£ ≥
(ññ≥ ¥
)ññ¥ µ
{
óó 

IdConcepto
òò 
=
òò 
dt
òò 
.
òò !
id_concepto_negocio
òò 2
,
òò2 3
CodigoBarra
ôô 
=
ôô 
dt
ôô  
.
ôô  !
Concepto_negocio
ôô! 1
.
ôô1 2
codigo_barra
ôô2 >
,
ôô> ?
Concepto
öö 
=
öö 
dt
öö 
.
öö 
Concepto_negocio
öö .
.
öö. /
nombre
öö/ 5
,
öö5 6
Cantidad
õõ 
=
õõ 
dt
õõ 
.
õõ 
cantidad
õõ &
,
õõ& '
Familia
úú 
=
úú 
dt
úú 
.
úú 
Concepto_negocio
úú -
.
úú- .
Detalle_maestro4
úú. >
.
úú> ?
nombre
úú? E
,
úúE F
Lote
ùù 
=
ùù 
dt
ùù 
.
ùù 
lote
ùù 
,
ùù 
UnidadMedida
ûû 
=
ûû 
dt
ûû !
.
ûû! "
Concepto_negocio
ûû" 2
.
ûû2 3
Detalle_maestro
ûû3 B
.
ûûB C
codigo
ûûC I
}
üü 
)
†† 
;
†† 
return
¢¢ 

inventario
¢¢ 
;
¢¢ 
}
££ 	
public
§§ 
IEnumerable
§§ 
<
§§  
InventarioSemaforo
§§ -
>
§§- .-
ObtenerInventarioSemaforoActual
§§/ N
(
§§N O
int
§§O R
	idAlmacen
§§S \
)
§§\ ]
{
•• 	
SigescomEntities
¶¶ 
_db
¶¶  
=
¶¶! "
new
¶¶# &
SigescomEntities
¶¶' 7
(
¶¶7 8
)
¶¶8 9
;
¶¶9 :
var
ßß 

inventario
ßß 
=
ßß 
_db
ßß  
.
ßß  !
Transaccion
ßß! ,
.
ßß, -
SingleOrDefault
ßß- <
(
ßß< =
t
ßß= >
=>
ßß? A
t
ßßB C
.
ßßC D!
id_tipo_transaccion
ßßD W
==
ßßX Z!
TransaccionSettings
ßß[ n
.
ßßn o
Default
ßßo v
.
ßßv w0
!IdTipoTransaccionInventarioActualßßw ò
&&ßßô õ
tßßú ù
.ßßù û(
id_actor_negocio_internoßßû ∂
==ßß∑ π
	idAlmacenßß∫ √
)ßß√ ƒ
.ßßƒ ≈#
Detalle_transaccionßß≈ ÿ
.ßßÿ Ÿ
SelectßßŸ ﬂ
(ßßﬂ ‡
dtßß‡ ‚
=>ßß„ Â
newßßÊ È"
InventarioSemaforoßßÍ ¸
(ßß¸ ˝
)ßß˝ ˛
{
®® 
CodigoBarra
©© 
=
©© 
dt
©©  
.
©©  !
Concepto_negocio
©©! 1
.
©©1 2
codigo_barra
©©2 >
,
©©> ?
Concepto
™™ 
=
™™ 
dt
™™ 
.
™™ 
Concepto_negocio
™™ .
.
™™. /
nombre
™™/ 5
,
™™5 6
Cantidad
´´ 
=
´´ 
dt
´´ 
.
´´ 
cantidad
´´ &
,
´´& '
Familia
¨¨ 
=
¨¨ 
dt
¨¨ 
.
¨¨ 
Concepto_negocio
¨¨ -
.
¨¨- .
Detalle_maestro4
¨¨. >
.
¨¨> ?
nombre
¨¨? E
,
¨¨E F
Lote
≠≠ 
=
≠≠ 
dt
≠≠ 
.
≠≠ 
lote
≠≠ 
,
≠≠ 
UnidadMedida
ÆÆ 
=
ÆÆ 
dt
ÆÆ !
.
ÆÆ! "
Concepto_negocio
ÆÆ" 2
.
ÆÆ2 3
Detalle_maestro
ÆÆ3 B
.
ÆÆB C
codigo
ÆÆC I
,
ÆÆI J
StockMinimo
ØØ 
=
ØØ 
dt
ØØ  
.
ØØ  !
Concepto_negocio
ØØ! 1
.
ØØ1 2
stock_minimo
ØØ2 >
}
∞∞ 
)
±± 
;
±± 
return
≤≤ 

inventario
≤≤ 
;
≤≤ 
}
≥≥ 	
public
¥¥ 
IEnumerable
¥¥ 
<
¥¥ "
InventarioValorizado
¥¥ /
>
¥¥/ 0/
!ObtenerInventarioValorizadoActual
¥¥1 R
(
¥¥R S
int
¥¥S V
	idAlmacen
¥¥W `
)
¥¥` a
{
µµ 	
SigescomEntities
∂∂ 
_db
∂∂  
=
∂∂! "
new
∂∂# &
SigescomEntities
∂∂' 7
(
∂∂7 8
)
∂∂8 9
;
∂∂9 :
var
∑∑ 

inventario
∑∑ 
=
∑∑ 
_db
∑∑  
.
∑∑  !
Transaccion
∑∑! ,
.
∑∑, -
SingleOrDefault
∑∑- <
(
∑∑< =
t
∑∑= >
=>
∑∑? A
t
∑∑B C
.
∑∑C D!
id_tipo_transaccion
∑∑D W
==
∑∑X Z!
TransaccionSettings
∑∑[ n
.
∑∑n o
Default
∑∑o v
.
∑∑v w0
!IdTipoTransaccionInventarioActual∑∑w ò
&&∑∑ô õ
t∑∑ú ù
.∑∑ù û(
id_actor_negocio_interno∑∑û ∂
==∑∑∑ π
	idAlmacen∑∑∫ √
)∑∑√ ƒ
.∑∑ƒ ≈#
Detalle_transaccion∑∑≈ ÿ
.∑∑ÿ Ÿ
Select∑∑Ÿ ﬂ
(∑∑ﬂ ‡
dt∑∑‡ ‚
=>∑∑„ Â
new∑∑Ê È$
InventarioValorizado∑∑Í ˛
(∑∑˛ ˇ
)∑∑ˇ Ä
{
∏∏ 
CodigoBarra
ππ 
=
ππ 
dt
ππ  
.
ππ  !
Concepto_negocio
ππ! 1
.
ππ1 2
codigo_barra
ππ2 >
,
ππ> ?
Concepto
∫∫ 
=
∫∫ 
dt
∫∫ 
.
∫∫ 
Concepto_negocio
∫∫ .
.
∫∫. /
nombre
∫∫/ 5
,
∫∫5 6
Cantidad
ªª 
=
ªª 
dt
ªª 
.
ªª 
cantidad
ªª &
,
ªª& '
Familia
ºº 
=
ºº 
dt
ºº 
.
ºº 
Concepto_negocio
ºº -
.
ºº- .
Detalle_maestro4
ºº. >
.
ºº> ?
nombre
ºº? E
,
ººE F
Lote
ΩΩ 
=
ΩΩ 
dt
ΩΩ 
.
ΩΩ 
lote
ΩΩ 
,
ΩΩ 
UnidadMedida
ææ 
=
ææ 
dt
ææ !
.
ææ! "
Concepto_negocio
ææ" 2
.
ææ2 3
Detalle_maestro
ææ3 B
.
ææB C
codigo
ææC I
,
ææI J

ValorTotal
øø 
=
øø 
dt
øø 
.
øø  
total
øø  %
,
øø% &
ValorUnitario
¿¿ 
=
¿¿ 
dt
¿¿  "
.
¿¿" #
precio_unitario
¿¿# 2
}
¡¡ 
)
¬¬ 
;
¬¬ 
return
ƒƒ 

inventario
ƒƒ 
;
ƒƒ 
}
≈≈ 	
public
∆∆ 
IEnumerable
∆∆ 
<
∆∆ 
InventarioFisico
∆∆ +
>
∆∆+ ,+
ObtenerInventarioFisicoActual
∆∆- J
(
∆∆J K
int
∆∆K N
	idAlmacen
∆∆O X
,
∆∆X Y
int
∆∆Z ]
[
∆∆] ^
]
∆∆^ _
familias
∆∆` h
)
∆∆h i
{
«« 	
SigescomEntities
»» 
_db
»»  
=
»»! "
new
»»# &
SigescomEntities
»»' 7
(
»»7 8
)
»»8 9
;
»»9 :
var
…… 

inventario
…… 
=
…… 
_db
……  
.
……  !
Transaccion
……! ,
.
……, -
SingleOrDefault
……- <
(
……< =
t
……= >
=>
……? A
t
……B C
.
……C D!
id_tipo_transaccion
……D W
==
……X Z!
TransaccionSettings
……[ n
.
……n o
Default
……o v
.
……v w0
!IdTipoTransaccionInventarioActual……w ò
&&……ô õ
t……ú ù
.……ù û(
id_actor_negocio_interno……û ∂
==……∑ π
	idAlmacen……∫ √
)……√ ƒ
.……ƒ ≈#
Detalle_transaccion……≈ ÿ
.……ÿ Ÿ
Where……Ÿ ﬁ
(……ﬁ ﬂ
dt……ﬂ ·
=>……‚ ‰
familias……Â Ì
.……Ì Ó
Contains……Ó ˆ
(……ˆ ˜
dt……˜ ˘
.……˘ ˙ 
Concepto_negocio……˙ ä
.……ä ã"
id_concepto_basico……ã ù
)……ù û
)……û ü
.……ü †
Select……† ¶
(……¶ ß
dt……ß ©
=>……™ ¨
new……≠ ∞ 
InventarioFisico……± ¡
(……¡ ¬
)……¬ √
{
   
CodigoBarra
ÀÀ 
=
ÀÀ 
dt
ÀÀ  
.
ÀÀ  !
Concepto_negocio
ÀÀ! 1
.
ÀÀ1 2
codigo_barra
ÀÀ2 >
,
ÀÀ> ?
Concepto
ÃÃ 
=
ÃÃ 
dt
ÃÃ 
.
ÃÃ 
Concepto_negocio
ÃÃ .
.
ÃÃ. /
nombre
ÃÃ/ 5
,
ÃÃ5 6
Cantidad
ÕÕ 
=
ÕÕ 
dt
ÕÕ 
.
ÕÕ 
cantidad
ÕÕ &
,
ÕÕ& '
Familia
ŒŒ 
=
ŒŒ 
dt
ŒŒ 
.
ŒŒ 
Concepto_negocio
ŒŒ -
.
ŒŒ- .
Detalle_maestro4
ŒŒ. >
.
ŒŒ> ?
nombre
ŒŒ? E
,
ŒŒE F
Lote
œœ 
=
œœ 
dt
œœ 
.
œœ 
lote
œœ 
,
œœ 
UnidadMedida
–– 
=
–– 
dt
–– !
.
––! "
Concepto_negocio
––" 2
.
––2 3
Detalle_maestro
––3 B
.
––B C
codigo
––C I
}
—— 
)
““ 
;
““ 
return
”” 

inventario
”” 
;
”” 
}
‘‘ 	
public
’’ 
IEnumerable
’’ 
<
’’ "
InventarioValorizado
’’ /
>
’’/ 0/
!ObtenerInventarioValorizadoActual
’’1 R
(
’’R S
int
’’S V
	idAlmacen
’’W `
,
’’` a
int
’’b e
[
’’e f
]
’’f g
familias
’’h p
)
’’p q
{
÷÷ 	
SigescomEntities
◊◊ 
_db
◊◊  
=
◊◊! "
new
◊◊# &
SigescomEntities
◊◊' 7
(
◊◊7 8
)
◊◊8 9
;
◊◊9 :
var
ÿÿ 

inventario
ÿÿ 
=
ÿÿ 
_db
ÿÿ  
.
ÿÿ  !
Transaccion
ÿÿ! ,
.
ÿÿ, -
SingleOrDefault
ÿÿ- <
(
ÿÿ< =
t
ÿÿ= >
=>
ÿÿ? A
t
ÿÿB C
.
ÿÿC D!
id_tipo_transaccion
ÿÿD W
==
ÿÿX Z!
TransaccionSettings
ÿÿ[ n
.
ÿÿn o
Default
ÿÿo v
.
ÿÿv w0
!IdTipoTransaccionInventarioActualÿÿw ò
&&ÿÿô õ
tÿÿú ù
.ÿÿù û(
id_actor_negocio_internoÿÿû ∂
==ÿÿ∑ π
	idAlmacenÿÿ∫ √
)ÿÿ√ ƒ
.ÿÿƒ ≈#
Detalle_transaccionÿÿ≈ ÿ
.ÿÿÿ Ÿ
WhereÿÿŸ ﬁ
(ÿÿﬁ ﬂ
dtÿÿﬂ ·
=>ÿÿ‚ ‰
familiasÿÿÂ Ì
.ÿÿÌ Ó
ContainsÿÿÓ ˆ
(ÿÿˆ ˜
dtÿÿ˜ ˘
.ÿÿ˘ ˙ 
Concepto_negocioÿÿ˙ ä
.ÿÿä ã"
id_concepto_basicoÿÿã ù
)ÿÿù û
)ÿÿû ü
.ÿÿü †
Selectÿÿ† ¶
(ÿÿ¶ ß
dtÿÿß ©
=>ÿÿ™ ¨
newÿÿ≠ ∞$
InventarioValorizadoÿÿ± ≈
(ÿÿ≈ ∆
)ÿÿ∆ «
{
ŸŸ 
CodigoBarra
⁄⁄ 
=
⁄⁄ 
dt
⁄⁄  
.
⁄⁄  !
Concepto_negocio
⁄⁄! 1
.
⁄⁄1 2
codigo_barra
⁄⁄2 >
,
⁄⁄> ?
Concepto
€€ 
=
€€ 
dt
€€ 
.
€€ 
Concepto_negocio
€€ .
.
€€. /
nombre
€€/ 5
,
€€5 6
Cantidad
‹‹ 
=
‹‹ 
dt
‹‹ 
.
‹‹ 
cantidad
‹‹ &
,
‹‹& '
Familia
›› 
=
›› 
dt
›› 
.
›› 
Concepto_negocio
›› -
.
››- .
Detalle_maestro4
››. >
.
››> ?
nombre
››? E
,
››E F
Lote
ﬁﬁ 
=
ﬁﬁ 
dt
ﬁﬁ 
.
ﬁﬁ 
lote
ﬁﬁ 
,
ﬁﬁ 
UnidadMedida
ﬂﬂ 
=
ﬂﬂ 
dt
ﬂﬂ !
.
ﬂﬂ! "
Concepto_negocio
ﬂﬂ" 2
.
ﬂﬂ2 3
Detalle_maestro
ﬂﬂ3 B
.
ﬂﬂB C
codigo
ﬂﬂC I
,
ﬂﬂI J

ValorTotal
‡‡ 
=
‡‡ 
dt
‡‡ 
.
‡‡  
total
‡‡  %
,
‡‡% &
ValorUnitario
·· 
=
·· 
dt
··  "
.
··" #
precio_unitario
··# 2
}
‚‚ 
)
„„ 
;
„„ 
return
‰‰ 

inventario
‰‰ 
;
‰‰ 
}
ÂÂ 	
public
ÊÊ 
IEnumerable
ÊÊ 
<
ÊÊ  
InventarioSemaforo
ÊÊ -
>
ÊÊ- .-
ObtenerInventarioSemaforoActual
ÊÊ/ N
(
ÊÊN O
int
ÊÊO R
	idAlmacen
ÊÊS \
,
ÊÊ\ ]
int
ÊÊ^ a
[
ÊÊa b
]
ÊÊb c
familias
ÊÊd l
)
ÊÊl m
{
ÁÁ 	
SigescomEntities
ËË 
_db
ËË  
=
ËË! "
new
ËË# &
SigescomEntities
ËË' 7
(
ËË7 8
)
ËË8 9
;
ËË9 :
var
ÈÈ 

inventario
ÈÈ 
=
ÈÈ 
_db
ÈÈ  
.
ÈÈ  !
Transaccion
ÈÈ! ,
.
ÈÈ, -
SingleOrDefault
ÈÈ- <
(
ÈÈ< =
t
ÈÈ= >
=>
ÈÈ? A
t
ÈÈB C
.
ÈÈC D!
id_tipo_transaccion
ÈÈD W
==
ÈÈX Z!
TransaccionSettings
ÈÈ[ n
.
ÈÈn o
Default
ÈÈo v
.
ÈÈv w0
!IdTipoTransaccionInventarioActualÈÈw ò
&&ÈÈô õ
tÈÈú ù
.ÈÈù û(
id_actor_negocio_internoÈÈû ∂
==ÈÈ∑ π
	idAlmacenÈÈ∫ √
)ÈÈ√ ƒ
.ÈÈƒ ≈#
Detalle_transaccionÈÈ≈ ÿ
.ÈÈÿ Ÿ
WhereÈÈŸ ﬁ
(ÈÈﬁ ﬂ
dtÈÈﬂ ·
=>ÈÈ‚ ‰
familiasÈÈÂ Ì
.ÈÈÌ Ó
ContainsÈÈÓ ˆ
(ÈÈˆ ˜
dtÈÈ˜ ˘
.ÈÈ˘ ˙ 
Concepto_negocioÈÈ˙ ä
.ÈÈä ã"
id_concepto_basicoÈÈã ù
)ÈÈù û
)ÈÈû ü
.ÈÈü †
SelectÈÈ† ¶
(ÈÈ¶ ß
dtÈÈß ©
=>ÈÈ™ ¨
newÈÈ≠ ∞"
InventarioSemaforoÈÈ± √
(ÈÈ√ ƒ
)ÈÈƒ ≈
{
ÍÍ 
CodigoBarra
ÎÎ 
=
ÎÎ 
dt
ÎÎ  
.
ÎÎ  !
Concepto_negocio
ÎÎ! 1
.
ÎÎ1 2
codigo_barra
ÎÎ2 >
,
ÎÎ> ?
Concepto
ÏÏ 
=
ÏÏ 
dt
ÏÏ 
.
ÏÏ 
Concepto_negocio
ÏÏ .
.
ÏÏ. /
nombre
ÏÏ/ 5
,
ÏÏ5 6
Cantidad
ÌÌ 
=
ÌÌ 
dt
ÌÌ 
.
ÌÌ 
cantidad
ÌÌ &
,
ÌÌ& '
Familia
ÓÓ 
=
ÓÓ 
dt
ÓÓ 
.
ÓÓ 
Concepto_negocio
ÓÓ -
.
ÓÓ- .
Detalle_maestro4
ÓÓ. >
.
ÓÓ> ?
nombre
ÓÓ? E
,
ÓÓE F
Lote
ÔÔ 
=
ÔÔ 
dt
ÔÔ 
.
ÔÔ 
lote
ÔÔ 
,
ÔÔ 
UnidadMedida
 
=
 
dt
 !
.
! "
Concepto_negocio
" 2
.
2 3
Detalle_maestro
3 B
.
B C
codigo
C I
,
I J
StockMinimo
ÒÒ 
=
ÒÒ 
dt
ÒÒ 
.
ÒÒ 
Concepto_negocio
ÒÒ /
.
ÒÒ/ 0
stock_minimo
ÒÒ0 <
}
ÚÚ 
)
ÛÛ 
;
ÛÛ 
return
ÙÙ 

inventario
ÙÙ 
;
ÙÙ 
}
ıı 	
public
˙˙ 
IEnumerable
˙˙ 
<
˙˙ 
InventarioFisico
˙˙ +
>
˙˙+ ,/
!ObtenerInventariosFisicosActuales
˙˙- N
(
˙˙N O
int
˙˙O R
[
˙˙R S
]
˙˙S T
idsAlmacenes
˙˙U a
)
˙˙a b
{
˚˚ 	
SigescomEntities
¸¸ 
_db
¸¸  
=
¸¸! "
new
¸¸# &
SigescomEntities
¸¸' 7
(
¸¸7 8
)
¸¸8 9
;
¸¸9 :
var
˝˝ 

inventario
˝˝ 
=
˝˝ 
_db
˝˝  
.
˝˝  !
Transaccion
˝˝! ,
.
˝˝, -
Where
˝˝- 2
(
˝˝2 3
t
˝˝3 4
=>
˝˝5 7
t
˝˝8 9
.
˝˝9 :!
id_tipo_transaccion
˝˝: M
==
˝˝N P!
TransaccionSettings
˝˝Q d
.
˝˝d e
Default
˝˝e l
.
˝˝l m0
!IdTipoTransaccionInventarioActual˝˝m é
&&˝˝è ë
idsAlmacenes˝˝í û
.˝˝û ü
Contains˝˝ü ß
(˝˝ß ®
t˝˝® ©
.˝˝© ™(
id_actor_negocio_interno˝˝™ ¬
)˝˝¬ √
)˝˝√ ƒ
.˝˝ƒ ≈

SelectMany˝˝≈ œ
(˝˝œ –
t˝˝– —
=>˝˝— ”
t˝˝‘ ’
.˝˝’ ÷#
Detalle_transaccion˝˝÷ È
)˝˝È Í
.˝˝Í Î
Select˝˝Î Ò
(˝˝Ò Ú
dt˝˝Ú Ù
=>˝˝ı ˜
new˝˝¯ ˚ 
InventarioFisico˝˝¸ å
(˝˝å ç
)˝˝ç é
{
˛˛ 
	IdAlmacen
ˇˇ 
=
ˇˇ 
dt
ˇˇ 
.
ˇˇ 
Transaccion
ˇˇ *
.
ˇˇ* +&
id_actor_negocio_interno
ˇˇ+ C
,
ˇˇC D
CodigoBarra
ÄÄ 
=
ÄÄ 
dt
ÄÄ  
.
ÄÄ  !
Concepto_negocio
ÄÄ! 1
.
ÄÄ1 2
codigo_barra
ÄÄ2 >
,
ÄÄ> ?
Concepto
ÅÅ 
=
ÅÅ 
dt
ÅÅ 
.
ÅÅ 
Concepto_negocio
ÅÅ .
.
ÅÅ. /
nombre
ÅÅ/ 5
,
ÅÅ5 6
Cantidad
ÇÇ 
=
ÇÇ 
dt
ÇÇ 
.
ÇÇ 
cantidad
ÇÇ &
,
ÇÇ& '
Familia
ÉÉ 
=
ÉÉ 
dt
ÉÉ 
.
ÉÉ 
Concepto_negocio
ÉÉ -
.
ÉÉ- .
Detalle_maestro4
ÉÉ. >
.
ÉÉ> ?
nombre
ÉÉ? E
,
ÉÉE F
Lote
ÑÑ 
=
ÑÑ 
dt
ÑÑ 
.
ÑÑ 
lote
ÑÑ 
,
ÑÑ 
UnidadMedida
ÖÖ 
=
ÖÖ 
dt
ÖÖ !
.
ÖÖ! "
Concepto_negocio
ÖÖ" 2
.
ÖÖ2 3
Detalle_maestro
ÖÖ3 B
.
ÖÖB C
codigo
ÖÖC I
}
ÜÜ 
)
áá 
;
áá 
return
àà 

inventario
àà 
;
àà 
}
ââ 	
public
ää 
IEnumerable
ää 
<
ää  
InventarioSemaforo
ää -
>
ää- .0
"ObtenerInventariosSemaforoActuales
ää/ Q
(
ääQ R
int
ääR U
[
ääU V
]
ääV W
idsAlmacenes
ääX d
)
ääd e
{
ãã 	
SigescomEntities
åå 
_db
åå  
=
åå! "
new
åå# &
SigescomEntities
åå' 7
(
åå7 8
)
åå8 9
;
åå9 :
var
çç 

inventario
çç 
=
çç 
_db
çç  
.
çç  !
Transaccion
çç! ,
.
çç, -
Where
çç- 2
(
çç2 3
t
çç3 4
=>
çç5 7
t
çç8 9
.
çç9 :!
id_tipo_transaccion
çç: M
==
ççN P!
TransaccionSettings
ççQ d
.
ççd e
Default
ççe l
.
ççl m0
!IdTipoTransaccionInventarioActualççm é
&&ççè ë
idsAlmacenesççí û
.ççû ü
Containsççü ß
(ççß ®
tçç® ©
.çç© ™(
id_actor_negocio_internoçç™ ¬
)çç¬ √
)çç√ ƒ
.ççƒ ≈

SelectManyçç≈ œ
(ççœ –
tçç– —
=>çç“ ‘
tçç’ ÷
.çç÷ ◊#
Detalle_transaccionçç◊ Í
)ççÍ Î
.ççÎ Ï
SelectççÏ Ú
(ççÚ Û
dtççÛ ı
=>ççˆ ¯
newçç˘ ¸"
InventarioSemaforoçç˝ è
(ççè ê
)ççê ë
{
éé 
	IdAlmacen
èè 
=
èè 
dt
èè 
.
èè 
Transaccion
èè *
.
èè* +&
id_actor_negocio_interno
èè+ C
,
èèC D
CodigoBarra
êê 
=
êê 
dt
êê  
.
êê  !
Concepto_negocio
êê! 1
.
êê1 2
codigo_barra
êê2 >
,
êê> ?
Concepto
ëë 
=
ëë 
dt
ëë 
.
ëë 
Concepto_negocio
ëë .
.
ëë. /
nombre
ëë/ 5
,
ëë5 6
Cantidad
íí 
=
íí 
dt
íí 
.
íí 
cantidad
íí &
,
íí& '
Familia
ìì 
=
ìì 
dt
ìì 
.
ìì 
Concepto_negocio
ìì -
.
ìì- .
Detalle_maestro4
ìì. >
.
ìì> ?
nombre
ìì? E
,
ììE F
Lote
îî 
=
îî 
dt
îî 
.
îî 
lote
îî 
,
îî 
UnidadMedida
ïï 
=
ïï 
dt
ïï !
.
ïï! "
Concepto_negocio
ïï" 2
.
ïï2 3
Detalle_maestro
ïï3 B
.
ïïB C
codigo
ïïC I
,
ïïI J
StockMinimo
ññ 
=
ññ 
dt
ññ  
.
ññ  !
Concepto_negocio
ññ! 1
.
ññ1 2
stock_minimo
ññ2 >
}
óó 
)
òò 
;
òò 
return
ôô 

inventario
ôô 
;
ôô 
}
öö 	
public
õõ 
IEnumerable
õõ 
<
õõ "
InventarioValorizado
õõ /
>
õõ/ 03
%ObtenerInventariosValorizadosActuales
õõ1 V
(
õõV W
int
õõW Z
[
õõZ [
]
õõ[ \
idsAlmacenes
õõ] i
)
õõi j
{
úú 	
SigescomEntities
ùù 
_db
ùù  
=
ùù! "
new
ùù# &
SigescomEntities
ùù' 7
(
ùù7 8
)
ùù8 9
;
ùù9 :
var
ûû 

inventario
ûû 
=
ûû 
_db
ûû  
.
ûû  !
Transaccion
ûû! ,
.
ûû, -
Where
ûû- 2
(
ûû2 3
t
ûû3 4
=>
ûû5 7
t
ûû8 9
.
ûû9 :!
id_tipo_transaccion
ûû: M
==
ûûN P!
TransaccionSettings
ûûQ d
.
ûûd e
Default
ûûe l
.
ûûl m0
!IdTipoTransaccionInventarioActualûûm é
&&ûûè ë
idsAlmacenesûûí û
.ûûû ü
Containsûûü ß
(ûûß ®
tûû® ©
.ûû© ™(
id_actor_negocio_internoûû™ ¬
)ûû¬ √
)ûû√ ƒ
.ûûƒ ≈

SelectManyûû≈ œ
(ûûœ –
tûû– —
=>ûû“ ‘
tûû’ ÷
.ûû÷ ◊#
Detalle_transaccionûû◊ Í
)ûûÍ Î
.ûûÎ Ï
SelectûûÏ Ú
(ûûÚ Û
dtûûÛ ı
=>ûûˆ ¯
newûû˘ ¸$
InventarioValorizadoûû˝ ë
(ûûë í
)ûûí ì
{
üü "
IdDetalleTransaccion
†† $
=
††$ %
dt
††& (
.
††( )
id
††) +
,
††+ ,
	IdAlmacen
°° 
=
°° 
dt
°° 
.
°° 
Transaccion
°° *
.
°°* +&
id_actor_negocio_interno
°°+ C
,
°°C D
CodigoBarra
¢¢ 
=
¢¢ 
dt
¢¢  
.
¢¢  !
Concepto_negocio
¢¢! 1
.
¢¢1 2
codigo_barra
¢¢2 >
,
¢¢> ?

IdConcepto
££ 
=
££ 
dt
££ 
.
££ !
id_concepto_negocio
££ 2
,
££2 3
Concepto
§§ 
=
§§ 
dt
§§ 
.
§§ 
Concepto_negocio
§§ .
.
§§. /
nombre
§§/ 5
,
§§5 6
Cantidad
•• 
=
•• 
dt
•• 
.
•• 
cantidad
•• &
,
••& '
Familia
¶¶ 
=
¶¶ 
dt
¶¶ 
.
¶¶ 
Concepto_negocio
¶¶ -
.
¶¶- .
Detalle_maestro4
¶¶. >
.
¶¶> ?
nombre
¶¶? E
,
¶¶E F
Lote
ßß 
=
ßß 
dt
ßß 
.
ßß 
lote
ßß 
,
ßß 
UnidadMedida
®® 
=
®® 
dt
®® !
.
®®! "
Concepto_negocio
®®" 2
.
®®2 3
Detalle_maestro
®®3 B
.
®®B C
codigo
®®C I
,
®®I J

ValorTotal
©© 
=
©© 
dt
©© 
.
©©  
total
©©  %
,
©©% &
ValorUnitario
™™ 
=
™™ 
dt
™™  "
.
™™" #
precio_unitario
™™# 2
}
´´ 
)
¨¨ 
;
¨¨ 
return
≠≠ 

inventario
≠≠ 
;
≠≠ 
}
ÆÆ 	
public
ØØ 
IEnumerable
ØØ 
<
ØØ 
InventarioFisico
ØØ +
>
ØØ+ ,/
!ObtenerInventariosFisicosActuales
ØØ- N
(
ØØN O
int
ØØO R
[
ØØR S
]
ØØS T
idsAlmacenes
ØØU a
,
ØØa b
int
ØØc f
[
ØØf g
]
ØØg h
familias
ØØi q
)
ØØq r
{
∞∞ 	
SigescomEntities
±± 
_db
±±  
=
±±! "
new
±±# &
SigescomEntities
±±' 7
(
±±7 8
)
±±8 9
;
±±9 :
var
≤≤ 

inventario
≤≤ 
=
≤≤ 
_db
≤≤  
.
≤≤  !
Transaccion
≤≤! ,
.
≤≤, -
Where
≤≤- 2
(
≤≤2 3
t
≤≤3 4
=>
≤≤5 7
t
≤≤8 9
.
≤≤9 :!
id_tipo_transaccion
≤≤: M
==
≤≤N P!
TransaccionSettings
≤≤Q d
.
≤≤d e
Default
≤≤e l
.
≤≤l m0
!IdTipoTransaccionInventarioActual≤≤m é
&&≤≤è ë
idsAlmacenes≤≤í û
.≤≤û ü
Contains≤≤ü ß
(≤≤ß ®
t≤≤® ©
.≤≤© ™(
id_actor_negocio_interno≤≤™ ¬
)≤≤¬ √
)≤≤√ ƒ
.≤≤ƒ ≈

SelectMany≤≤≈ œ
(≤≤œ –
t≤≤– —
=>≤≤“ ‘
t≤≤’ ÷
.≤≤÷ ◊#
Detalle_transaccion≤≤◊ Í
)≤≤Í Î
.≤≤Î Ï
Where≤≤Ï Ò
(≤≤Ò Ú
dt≤≤Ú Ù
=>≤≤ı ˜
familias≤≤¯ Ä
.≤≤Ä Å
Contains≤≤Å â
(≤≤â ä
dt≤≤ä å
.≤≤å ç 
Concepto_negocio≤≤ç ù
.≤≤ù û"
id_concepto_basico≤≤û ∞
)≤≤∞ ±
)≤≤± ≤
.≤≤≤ ≥
Select≤≤≥ π
(≤≤π ∫
dt≤≤∫ º
=>≤≤Ω ø
new≤≤¿ √ 
InventarioFisico≤≤ƒ ‘
(≤≤‘ ’
)≤≤’ ÷
{
≥≥ 
	IdAlmacen
¥¥ 
=
¥¥ 
dt
¥¥ 
.
¥¥ 
Transaccion
¥¥ *
.
¥¥* +&
id_actor_negocio_interno
¥¥+ C
,
¥¥C D
CodigoBarra
µµ 
=
µµ 
dt
µµ  
.
µµ  !
Concepto_negocio
µµ! 1
.
µµ1 2
codigo_barra
µµ2 >
,
µµ> ?
Concepto
∂∂ 
=
∂∂ 
dt
∂∂ 
.
∂∂ 
Concepto_negocio
∂∂ .
.
∂∂. /
nombre
∂∂/ 5
,
∂∂5 6
Cantidad
∑∑ 
=
∑∑ 
dt
∑∑ 
.
∑∑ 
cantidad
∑∑ &
,
∑∑& '
Familia
∏∏ 
=
∏∏ 
dt
∏∏ 
.
∏∏ 
Concepto_negocio
∏∏ -
.
∏∏- .
Detalle_maestro4
∏∏. >
.
∏∏> ?
nombre
∏∏? E
,
∏∏E F
Lote
ππ 
=
ππ 
dt
ππ 
.
ππ 
lote
ππ 
,
ππ 
UnidadMedida
∫∫ 
=
∫∫ 
dt
∫∫ !
.
∫∫! "
Concepto_negocio
∫∫" 2
.
∫∫2 3
Detalle_maestro
∫∫3 B
.
∫∫B C
codigo
∫∫C I
}
ªª 
)
ºº 
;
ºº 
return
ΩΩ 

inventario
ΩΩ 
;
ΩΩ 
}
ææ 	
public
øø 
IEnumerable
øø 
<
øø "
InventarioValorizado
øø /
>
øø/ 03
%ObtenerInventariosValorizadosActuales
øø1 V
(
øøV W
int
øøW Z
[
øøZ [
]
øø[ \
idsAlmacenes
øø] i
,
øøi j
int
øøk n
[
øøn o
]
øøo p
familias
øøq y
)
øøy z
{
¿¿ 	
SigescomEntities
¡¡ 
_db
¡¡  
=
¡¡! "
new
¡¡# &
SigescomEntities
¡¡' 7
(
¡¡7 8
)
¡¡8 9
;
¡¡9 :
var
¬¬ 

inventario
¬¬ 
=
¬¬ 
_db
¬¬  
.
¬¬  !
Transaccion
¬¬! ,
.
¬¬, -
Where
¬¬- 2
(
¬¬2 3
t
¬¬3 4
=>
¬¬5 7
t
¬¬8 9
.
¬¬9 :!
id_tipo_transaccion
¬¬: M
==
¬¬N P!
TransaccionSettings
¬¬Q d
.
¬¬d e
Default
¬¬e l
.
¬¬l m0
!IdTipoTransaccionInventarioActual¬¬m é
&&¬¬è ë
idsAlmacenes¬¬í û
.¬¬û ü
Contains¬¬ü ß
(¬¬ß ®
t¬¬® ©
.¬¬© ™(
id_actor_negocio_interno¬¬™ ¬
)¬¬¬ √
)¬¬√ ƒ
.¬¬ƒ ≈

SelectMany¬¬≈ œ
(¬¬œ –
t¬¬– —
=>¬¬“ ‘
t¬¬’ ÷
.¬¬÷ ◊#
Detalle_transaccion¬¬◊ Í
)¬¬Í Î
.¬¬Î Ï
Where¬¬Ï Ò
(¬¬Ò Ú
dt¬¬Ú Ù
=>¬¬ı ˜
familias¬¬¯ Ä
.¬¬Ä Å
Contains¬¬Å â
(¬¬â ä
dt¬¬ä å
.¬¬å ç 
Concepto_negocio¬¬ç ù
.¬¬ù û"
id_concepto_basico¬¬û ∞
)¬¬∞ ±
)¬¬± ≤
.¬¬≤ ≥
Select¬¬≥ π
(¬¬π ∫
dt¬¬∫ º
=>¬¬Ω ø
new¬¬¿ √$
InventarioValorizado¬¬ƒ ÿ
(¬¬ÿ Ÿ
)¬¬Ÿ ⁄
{
√√ 
	IdAlmacen
ƒƒ 
=
ƒƒ 
dt
ƒƒ 
.
ƒƒ 
Transaccion
ƒƒ *
.
ƒƒ* +&
id_actor_negocio_interno
ƒƒ+ C
,
ƒƒC D
CodigoBarra
≈≈ 
=
≈≈ 
dt
≈≈  
.
≈≈  !
Concepto_negocio
≈≈! 1
.
≈≈1 2
codigo_barra
≈≈2 >
,
≈≈> ?
Concepto
∆∆ 
=
∆∆ 
dt
∆∆ 
.
∆∆ 
Concepto_negocio
∆∆ .
.
∆∆. /
nombre
∆∆/ 5
,
∆∆5 6
Cantidad
«« 
=
«« 
dt
«« 
.
«« 
cantidad
«« &
,
««& '
Familia
»» 
=
»» 
dt
»» 
.
»» 
Concepto_negocio
»» -
.
»»- .
Detalle_maestro4
»». >
.
»»> ?
nombre
»»? E
,
»»E F
Lote
…… 
=
…… 
dt
…… 
.
…… 
lote
…… 
,
…… 
UnidadMedida
   
=
   
dt
   !
.
  ! "
Concepto_negocio
  " 2
.
  2 3
Detalle_maestro
  3 B
.
  B C
codigo
  C I
,
  I J

ValorTotal
ÀÀ 
=
ÀÀ 
dt
ÀÀ 
.
ÀÀ  
total
ÀÀ  %
,
ÀÀ% &
ValorUnitario
ÃÃ 
=
ÃÃ 
dt
ÃÃ  "
.
ÃÃ" #
precio_unitario
ÃÃ# 2
}
ÕÕ 
)
ŒŒ 
;
ŒŒ 
return
œœ 

inventario
œœ 
;
œœ 
}
–– 	
public
—— 
IEnumerable
—— 
<
——  
InventarioSemaforo
—— -
>
——- .0
"ObtenerInventariosSemaforoActuales
——/ Q
(
——Q R
int
——R U
[
——U V
]
——V W
idsAlmacenes
——X d
,
——d e
int
——f i
[
——i j
]
——j k
familias
——l t
)
——t u
{
““ 	
SigescomEntities
”” 
_db
””  
=
””! "
new
””# &
SigescomEntities
””' 7
(
””7 8
)
””8 9
;
””9 :
var
‘‘ 

inventario
‘‘ 
=
‘‘ 
_db
‘‘  
.
‘‘  !
Transaccion
‘‘! ,
.
‘‘, -
Where
‘‘- 2
(
‘‘2 3
t
‘‘3 4
=>
‘‘5 7
t
‘‘8 9
.
‘‘9 :!
id_tipo_transaccion
‘‘: M
==
‘‘N P!
TransaccionSettings
‘‘Q d
.
‘‘d e
Default
‘‘e l
.
‘‘l m0
!IdTipoTransaccionInventarioActual‘‘m é
&&‘‘è ë
idsAlmacenes‘‘í û
.‘‘û ü
Contains‘‘ü ß
(‘‘ß ®
t‘‘® ©
.‘‘© ™(
id_actor_negocio_interno‘‘™ ¬
)‘‘¬ √
)‘‘√ ƒ
.‘‘ƒ ≈

SelectMany‘‘≈ œ
(‘‘œ –
t‘‘– —
=>‘‘“ ‘
t‘‘’ ÷
.‘‘÷ ◊#
Detalle_transaccion‘‘◊ Í
)‘‘Í Î
.‘‘Î Ï
Where‘‘Ï Ò
(‘‘Ò Ú
dt‘‘Ú Ù
=>‘‘ı ˜
familias‘‘¯ Ä
.‘‘Ä Å
Contains‘‘Å â
(‘‘â ä
dt‘‘ä å
.‘‘å ç 
Concepto_negocio‘‘ç ù
.‘‘ù û"
id_concepto_basico‘‘û ∞
)‘‘∞ ±
)‘‘± ≤
.‘‘≤ ≥
Select‘‘≥ π
(‘‘π ∫
dt‘‘∫ º
=>‘‘Ω ø
new‘‘¿ √"
InventarioSemaforo‘‘ƒ ÷
(‘‘÷ ◊
)‘‘◊ ÿ
{
’’ 
	IdAlmacen
÷÷ 
=
÷÷ 
dt
÷÷ 
.
÷÷ 
Transaccion
÷÷ (
.
÷÷( )&
id_actor_negocio_interno
÷÷) A
,
÷÷A B
CodigoBarra
◊◊ 
=
◊◊ 
dt
◊◊  
.
◊◊  !
Concepto_negocio
◊◊! 1
.
◊◊1 2
codigo_barra
◊◊2 >
,
◊◊> ?
Concepto
ÿÿ 
=
ÿÿ 
dt
ÿÿ 
.
ÿÿ 
Concepto_negocio
ÿÿ .
.
ÿÿ. /
nombre
ÿÿ/ 5
,
ÿÿ5 6
Cantidad
ŸŸ 
=
ŸŸ 
dt
ŸŸ 
.
ŸŸ 
cantidad
ŸŸ &
,
ŸŸ& '
Familia
⁄⁄ 
=
⁄⁄ 
dt
⁄⁄ 
.
⁄⁄ 
Concepto_negocio
⁄⁄ -
.
⁄⁄- .
Detalle_maestro4
⁄⁄. >
.
⁄⁄> ?
nombre
⁄⁄? E
,
⁄⁄E F
Lote
€€ 
=
€€ 
dt
€€ 
.
€€ 
lote
€€ 
,
€€ 
UnidadMedida
‹‹ 
=
‹‹ 
dt
‹‹ !
.
‹‹! "
Concepto_negocio
‹‹" 2
.
‹‹2 3
Detalle_maestro
‹‹3 B
.
‹‹B C
codigo
‹‹C I
,
‹‹I J
StockMinimo
›› 
=
›› 
dt
››  
.
››  !
Concepto_negocio
››! 1
.
››1 2
stock_minimo
››2 >
}
ﬁﬁ 
)
ﬂﬂ 
;
ﬂﬂ 
return
‡‡ 

inventario
‡‡ 
;
‡‡ 
}
·· 	
public
ÂÂ 
IEnumerable
ÂÂ 
<
ÂÂ +
Reporte_Inventario_Valorizado
ÂÂ 8
>
ÂÂ8 9%
ObtenerInventarioActual
ÂÂ: Q
(
ÂÂQ R
int
ÂÂR U
	idAlmacen
ÂÂV _
,
ÂÂ_ `
int
ÂÂa d%
idCentroAtencionPrecios
ÂÂe |
)
ÂÂ| }
{
ÊÊ 	
try
ÁÁ 
{
ËË 
SigescomEntities
ÈÈ  
_db
ÈÈ! $
=
ÈÈ% &
new
ÈÈ' *
SigescomEntities
ÈÈ+ ;
(
ÈÈ; <
)
ÈÈ< =
;
ÈÈ= >
var
ÍÍ 
	resultado
ÍÍ 
=
ÍÍ 
_db
ÍÍ  #
.
ÍÍ# $
Transaccion
ÍÍ$ /
.
ÍÍ/ 0
Where
ÍÍ0 5
(
ÍÍ5 6
t
ÍÍ6 7
=>
ÍÍ8 :
t
ÍÍ; <
.
ÍÍ< =!
id_tipo_transaccion
ÍÍ= P
==
ÍÍQ S!
TransaccionSettings
ÍÍT g
.
ÍÍg h
Default
ÍÍh o
.
ÍÍo p0
!IdTipoTransaccionInventarioActualÍÍp ë
&&
ÎÎ1 3
t
ÎÎ4 5
.
ÎÎ5 6&
id_actor_negocio_interno
ÎÎ6 N
==
ÎÎO Q
	idAlmacen
ÎÎR [
&&
ÏÏ1 3
t
ÏÏ4 5
.
ÏÏ5 6
id_estado_actual
ÏÏ6 F
==
ÏÏG I
MaestroSettings
ÏÏJ Y
.
ÏÏY Z
Default
ÏÏZ a
.
ÏÏa b/
 IdDetalleMaestroEstadoConfirmadoÏÏb Ç
)ÏÏÇ É
.ÏÏÉ Ñ

SelectManyÏÏÑ é
(ÏÏé è
tÏÏè ê
=>ÏÏê í
tÏÏí ì
.ÏÏì î#
Detalle_transaccionÏÏî ß
)ÏÏß ®
.
ÌÌ& '
Where
ÌÌ' ,
(
ÌÌ, -
dt
ÌÌ- /
=>
ÌÌ0 2
dt
ÌÌ3 5
.
ÌÌ5 6
Concepto_negocio
ÌÌ6 F
.
ÌÌF G

es_vigente
ÌÌG Q
)
ÌÌQ R
.
ÓÓ 
Select
ÓÓ "
(
ÓÓ" #
riv
ÔÔ "
=>
ÔÔ# %
new
ÔÔ& )+
Reporte_Inventario_Valorizado
ÔÔ* G
(
ÔÔG H
)
ÔÔH I
{
  
IdConceptoNegocio
ÒÒ# 4
=
ÒÒ5 6
riv
ÒÒ7 :
.
ÒÒ: ;!
id_concepto_negocio
ÒÒ; N
,
ÒÒN O
Producto
ÚÚ# +
=
ÚÚ, -
riv
ÚÚ. 1
.
ÚÚ1 2
Concepto_negocio
ÚÚ2 B
.
ÚÚB C
nombre
ÚÚC I
,
ÚÚI J
Cantidad
ÛÛ# +
=
ÛÛ, -
riv
ÛÛ. 1
.
ÛÛ1 2
cantidad
ÛÛ2 :
,
ÛÛ: ;
Lote
ÙÙ# '
=
ÙÙ( )
riv
ÙÙ* -
.
ÙÙ- .
lote
ÙÙ. 2
,
ÙÙ2 3
CostoUnitario
ıı# 0
=
ıı0 1
riv
ıı2 5
.
ıı5 6
precio_unitario
ıı6 E
,
ııE F
PrecioVigente
ˆˆ# 0
=
ˆˆ1 2
riv
ˆˆ3 6
.
ˆˆ6 7
Concepto_negocio
ˆˆ7 G
.
ˆˆG H
Precio1
ˆˆH O
.
ˆˆO P
Where
ˆˆP U
(
ˆˆU V
p
ˆˆV W
=>
ˆˆX Z
p
ˆˆ[ \
.
ˆˆ\ ]
id_actor_negocio
ˆˆ] m
==
ˆˆn p&
idCentroAtencionPreciosˆˆq à
&&ˆˆâ ã
pˆˆå ç
.ˆˆç é

es_vigenteˆˆé ò
&&ˆˆô õ
pˆˆú ù
.ˆˆù û
id_tarifa_dˆˆû ©
==ˆˆ™ ¨
MaestroSettingsˆˆ≠ º
.ˆˆº Ω
DefaultˆˆΩ ƒ
.ˆˆƒ ≈,
IdDetalleMaestroTarifaNormalˆˆ≈ ·
)ˆˆ· ‚
.
˜˜: ;
OrderByDescending
˜˜; L
(
˜˜L M
p
˜˜M N
=>
˜˜O Q
p
˜˜R S
.
˜˜S T
id
˜˜T V
)
˜˜V W
.
¯¯: ;
FirstOrDefault
¯¯; I
(
¯¯I J
)
¯¯J K
,
¯¯K L1
#ValorCaracteristicasConceptoNegocio
˘˘# F
=
˘˘G H
riv
˘˘I L
.
˘˘L M
Concepto_negocio
˘˘M ]
.
˘˘] ^4
%Valor_caracteristica_concepto_negocio˘˘^ É
.˘˘É Ñ
Distinct˘˘Ñ å
(˘˘å ç
)˘˘ç é
}
˙˙  
)
˚˚ 
;
˚˚ 
return
¸¸ 
	resultado
¸¸  
;
¸¸  !
}
˝˝ 
catch
˛˛ 
(
˛˛ 
	Exception
˛˛ 
e
˛˛ 
)
˛˛ 
{
ˇˇ 
throw
ÄÄ 
e
ÄÄ 
;
ÄÄ 
}
ÅÅ 
}
ÇÇ 	
public
ÑÑ 
IEnumerable
ÑÑ 
<
ÑÑ +
Reporte_Inventario_Valorizado
ÑÑ 8
>
ÑÑ8 9@
2ObtenerInventarioActualPorCaracteristicasYFamilias
ÑÑ: l
(
ÑÑl m
int
ÑÑm p
	idAlmacen
ÑÑq z
,
ÑÑz {
int
ÑÑ| '
idCentroAtencionPreciosÑÑÄ ó
,ÑÑó ò
intÑÑô ú
[ÑÑú ù
]ÑÑù û+
idsValoresDeCaracteristicasÑÑü ∫
,ÑÑ∫ ª
intÑÑΩ ¿
[ÑÑ¿ ¡
]ÑÑ¡ ¬#
idsConceptosBasicosÑÑ√ ÷
)ÑÑ÷ ◊
{
ÖÖ 	
try
ÜÜ 
{
áá 
SigescomEntities
àà  
_db
àà! $
=
àà% &
new
àà' *
SigescomEntities
àà+ ;
(
àà; <
)
àà< =
;
àà= >
var
ää 
	resultado
ää 
=
ää 
_db
ää  #
.
ää# $
Transaccion
ää$ /
.
ää/ 0
Where
ää0 5
(
ää5 6
t
ää6 7
=>
ää8 :
t
ää; <
.
ää< =!
id_tipo_transaccion
ää= P
==
ääQ S!
TransaccionSettings
ääT g
.
ääg h
Default
ääh o
.
ääo p0
!IdTipoTransaccionInventarioActualääp ë
&&
ãã/ 1
t
ãã2 3
.
ãã3 4&
id_actor_negocio_interno
ãã4 L
==
ããM O
	idAlmacen
ããP Y
&&
åå/ 1
t
åå2 3
.
åå3 4
id_estado_actual
åå4 D
==
ååE G
MaestroSettings
ååH W
.
ååW X
Default
ååX _
.
åå_ `/
 IdDetalleMaestroEstadoConfirmadoåå` Ä
)ååÄ Å
.ååÅ Ç

SelectManyååÇ å
(ååå ç
tååç é
=>ååè ë
tååí ì
.ååì î#
Detalle_transaccionååî ß
)ååß ®
.
çç# $
Where
çç$ )
(
çç) *
dt
çç* ,
=>
çç- /
dt
çç0 2
.
çç2 3
Concepto_negocio
çç3 C
.
ççC D

es_vigente
ççD N
&&
éé# %
dt
éé& (
.
éé( )
Concepto_negocio
éé) 9
.
éé9 :3
%Valor_caracteristica_concepto_negocio
éé: _
.
éé_ `
Any
éé` c
(
ééc d
vccn
ééd h
=>
ééi k*
idsValoresDeCaracteristicaséél á
.ééá à
Containsééà ê
(ééê ë
vccnééë ï
.ééï ñ'
id_valor_caracteristicaééñ ≠
)éé≠ Æ
)ééÆ Ø
&&
èè# %!
idsConceptosBasicos
èè& 9
.
èè9 :
Contains
èè: B
(
èèB C
dt
èèC E
.
èèE F
Concepto_negocio
èèF V
.
èèV W
Detalle_maestro4
èèW g
.
èèg h
id
èèh j
)
èèj k
)
èèk l
.
êê 
Select
êê 
(
êê 
riv
ëë 
=>
ëë 
new
ëë  +
Reporte_Inventario_Valorizado
ëë! >
(
ëë> ?
)
ëë? @
{
íí 
IdConceptoNegocio
ìì +
=
ìì, -
riv
ìì. 1
.
ìì1 2!
id_concepto_negocio
ìì2 E
,
ììE F
Producto
îî "
=
îî# $
riv
îî% (
.
îî( )
Concepto_negocio
îî) 9
.
îî9 :
nombre
îî: @
,
îî@ A
Cantidad
ïï "
=
ïï# $
riv
ïï% (
.
ïï( )
cantidad
ïï) 1
,
ïï1 2
Lote
ññ 
=
ññ  
riv
ññ! $
.
ññ$ %
lote
ññ% )
,
ññ) *
CostoUnitario
óó '
=
óó( )
riv
óó* -
.
óó- .
precio_unitario
óó. =
,
óó= >
PrecioVigente
òò '
=
òò( )
riv
òò* -
.
òò- .
Concepto_negocio
òò. >
.
òò> ?
Precio1
òò? F
.
òòF G
Where
òòG L
(
òòL M
p
òòM N
=>
òòO Q
p
òòR S
.
òòS T
id_actor_negocio
òòT d
==
òòe g%
idCentroAtencionPrecios
òòh 
&&òòÄ Ç
pòòÉ Ñ
.òòÑ Ö

es_vigenteòòÖ è
&&òòê í
pòòì î
.òòî ï
id_tarifa_dòòï †
==òò° £
MaestroSettingsòò§ ≥
.òò≥ ¥
Defaultòò¥ ª
.òòª º,
IdDetalleMaestroTarifaNormalòòº ÿ
)òòÿ Ÿ
.òòŸ ⁄!
OrderByDescendingòò⁄ Î
(òòÎ Ï
pòòÏ Ì
=>òòÓ 
pòòÒ Ú
.òòÚ Û
idòòÛ ı
)òòı ˆ
.òòˆ ˜
FirstOrDefaultòò˜ Ö
(òòÖ Ü
)òòÜ á
,òòá à1
#ValorCaracteristicasConceptoNegocio
ôô =
=
ôô> ?
riv
ôô@ C
.
ôôC D
Concepto_negocio
ôôD T
.
ôôT U3
%Valor_caracteristica_concepto_negocio
ôôU z
.
ôôz {
Whereôô{ Ä
(ôôÄ Å
wôôÅ Ç
=>ôôÉ Ö+
idsValoresDeCaracteristicasôôÜ °
.ôô° ¢
Containsôô¢ ™
(ôô™ ´
wôô´ ¨
.ôô¨ ≠'
id_valor_caracteristicaôô≠ ƒ
)ôôƒ ≈
)ôô≈ ∆
.ôô∆ «
Distinctôô« œ
(ôôœ –
)ôô– —
}
öö 
)
õõ 
;
õõ 
return
úú 
	resultado
úú  
;
úú  !
}
ùù 
catch
ûû 
(
ûû 
	Exception
ûû 
e
ûû 
)
ûû 
{
üü 
throw
†† 
e
†† 
;
†† 
}
°° 
}
¢¢ 	
public
§§ 
IEnumerable
§§ 
<
§§ +
Reporte_Inventario_Valorizado
§§ 8
>
§§8 90
"ObtenerInventarioActualPorFamilias
§§: \
(
§§\ ]
int
§§] `
	idAlmacen
§§a j
,
§§j k
int
§§l o&
idCentroAtencionPrecios§§p á
,§§á à
int§§ä ç
[§§ç é
]§§é è#
idsConceptosBasicos§§ê £
)§§£ §
{
•• 	
try
¶¶ 
{
ßß 
SigescomEntities
®®  
_db
®®! $
=
®®% &
new
®®' *
SigescomEntities
®®+ ;
(
®®; <
)
®®< =
;
®®= >
var
™™ 
	resultado
™™ 
=
™™ 
_db
™™  #
.
™™# $
Transaccion
™™$ /
.
™™/ 0
Where
™™0 5
(
™™5 6
t
™™6 7
=>
™™8 :
t
™™; <
.
™™< =!
id_tipo_transaccion
™™= P
==
™™Q S!
TransaccionSettings
™™T g
.
™™g h
Default
™™h o
.
™™o p0
!IdTipoTransaccionInventarioActual™™p ë
&&
´´+ -
t
´´. /
.
´´/ 0&
id_actor_negocio_interno
´´0 H
==
´´I K
	idAlmacen
´´L U
&&
¨¨+ -
t
¨¨. /
.
¨¨/ 0
id_estado_actual
¨¨0 @
==
¨¨A C
MaestroSettings
¨¨D S
.
¨¨S T
Default
¨¨T [
.
¨¨[ \.
 IdDetalleMaestroEstadoConfirmado
¨¨\ |
)
¨¨| }
.
≠≠  

SelectMany
≠≠  *
(
≠≠* +
t
≠≠+ ,
=>
≠≠- /
t
≠≠0 1
.
≠≠1 2!
Detalle_transaccion
≠≠2 E
)
≠≠E F
.
ÆÆ  
Where
ÆÆ  %
(
ÆÆ% &
dt
ÆÆ& (
=>
ÆÆ) +
dt
ÆÆ, .
.
ÆÆ. /
Concepto_negocio
ÆÆ/ ?
.
ÆÆ? @

es_vigente
ÆÆ@ J
&&
ÆÆK M!
idsConceptosBasicos
ÆÆN a
.
ÆÆa b
Contains
ÆÆb j
(
ÆÆj k
dt
ÆÆk m
.
ÆÆm n
Concepto_negocio
ÆÆn ~
.
ÆÆ~ 
Detalle_maestro4ÆÆ è
.ÆÆè ê
idÆÆê í
)ÆÆí ì
)ÆÆì î
.
ØØ  
Select
ØØ  &
(
ØØ& '
riv
∞∞& )
=>
∞∞* ,
new
∞∞- 0+
Reporte_Inventario_Valorizado
∞∞1 N
(
∞∞N O
)
∞∞O P
{
±±& '
IdConceptoNegocio
≤≤* ;
=
≤≤< =
riv
≤≤> A
.
≤≤A B!
id_concepto_negocio
≤≤B U
,
≤≤U V
Producto
≥≥* 2
=
≥≥3 4
riv
≥≥5 8
.
≥≥8 9
Concepto_negocio
≥≥9 I
.
≥≥I J
nombre
≥≥J P
,
≥≥P Q
Cantidad
¥¥* 2
=
¥¥3 4
riv
¥¥5 8
.
¥¥8 9
cantidad
¥¥9 A
,
¥¥A B
Lote
µµ* .
=
µµ/ 0
riv
µµ1 4
.
µµ4 5
lote
µµ5 9
,
µµ9 :
CostoUnitario
∂∂* 7
=
∂∂8 9
riv
∂∂: =
.
∂∂= >
precio_unitario
∂∂> M
,
∂∂M N
PrecioVigente
∑∑* 7
=
∑∑8 9
riv
∑∑: =
.
∑∑= >
Concepto_negocio
∑∑> N
.
∑∑N O
Precio1
∑∑O V
.
∑∑V W
Where
∑∑W \
(
∑∑\ ]
p
∑∑] ^
=>
∑∑_ a
p
∑∑b c
.
∑∑c d
id_actor_negocio
∑∑d t
==
∑∑u w&
idCentroAtencionPrecios∑∑x è
&&∑∑ê í
p∑∑ì î
.∑∑î ï

es_vigente∑∑ï ü
&&∑∑† ¢
p∑∑£ §
.∑∑§ •
id_tarifa_d∑∑• ∞
==∑∑± ≥
MaestroSettings∑∑¥ √
.∑∑√ ƒ
Default∑∑ƒ À
.∑∑À Ã,
IdDetalleMaestroTarifaNormal∑∑Ã Ë
)∑∑Ë È
.∑∑È Í!
OrderByDescending∑∑Í ˚
(∑∑˚ ¸
p∑∑¸ ˝
=>∑∑˛ Ä
p∑∑Å Ç
.∑∑Ç É
id∑∑É Ö
)∑∑Ö Ü
.∑∑Ü á
FirstOrDefault∑∑á ï
(∑∑ï ñ
)∑∑ñ ó
,∑∑ó ò1
#ValorCaracteristicasConceptoNegocio
∏∏* M
=
∏∏N O
riv
∏∏P S
.
∏∏S T
Concepto_negocio
∏∏T d
.
∏∏d e4
%Valor_caracteristica_concepto_negocio∏∏e ä
.∏∏ä ã
Distinct∏∏ã ì
(∏∏ì î
)∏∏î ï
}
ππ& '
)
∫∫# $
.
∫∫$ %
ToList
∫∫% +
(
∫∫+ ,
)
∫∫, -
;
∫∫- .
return
ºº 
	resultado
ºº  
;
ºº  !
}
ΩΩ 
catch
ææ 
(
ææ 
	Exception
ææ 
e
ææ 
)
ææ 
{
øø 
throw
¿¿ 
e
¿¿ 
;
¿¿ 
}
¡¡ 
}
¬¬ 	
public
ƒƒ 
IEnumerable
ƒƒ 
<
ƒƒ +
Reporte_Inventario_Valorizado
ƒƒ 8
>
ƒƒ8 97
)ObtenerInventarioActualPorCaracteristicas
ƒƒ: c
(
ƒƒc d
int
ƒƒd g
	idAlmacen
ƒƒh q
,
ƒƒq r
int
ƒƒs v&
idCentroAtencionPreciosƒƒw é
,ƒƒé è
intƒƒê ì
[ƒƒì î
]ƒƒî ï+
idsValoresDeCaracteristicasƒƒñ ±
)ƒƒ± ≤
{
≈≈ 	
try
∆∆ 
{
«« 
SigescomEntities
»»  
_db
»»! $
=
»»% &
new
»»' *
SigescomEntities
»»+ ;
(
»»; <
)
»»< =
;
»»= >
var
   
	resultado
   
=
   
_db
ÃÃ 
.
ÃÃ 
Transaccion
ÃÃ $
.
ÕÕ  
Where
ÕÕ  %
(
ÕÕ% &
t
ÕÕ& '
=>
ÕÕ( *
t
ÕÕ+ ,
.
ÕÕ, -!
id_tipo_transaccion
ÕÕ- @
==
ÕÕA C!
TransaccionSettings
ÕÕD W
.
ÕÕW X
Default
ÕÕX _
.
ÕÕ_ `0
!IdTipoTransaccionInventarioActualÕÕ` Å
&&
ŒŒ, .
t
ŒŒ/ 0
.
ŒŒ0 1&
id_actor_negocio_interno
ŒŒ1 I
==
ŒŒJ L
	idAlmacen
ŒŒM V
&&
œœ, .
t
œœ/ 0
.
œœ0 1
id_estado_actual
œœ1 A
==
œœB D
MaestroSettings
œœE T
.
œœT U
Default
œœU \
.
œœ\ ].
 IdDetalleMaestroEstadoConfirmado
œœ] }
)
œœ} ~
.
––  

SelectMany
––  *
(
––* +
t
––+ ,
=>
––- /
t
––0 1
.
––1 2!
Detalle_transaccion
––2 E
)
––E F
.
——  
Where
——  %
(
——% &
dt
——& (
=>
——) +
dt
——, .
.
——. /
Concepto_negocio
——/ ?
.
——? @

es_vigente
——@ J
&&
——K M
dt
——N P
.
——P Q
Concepto_negocio
——Q a
.
——a b4
%Valor_caracteristica_concepto_negocio——b á
.
““- .
Any
““. 1
(
““1 2
vccn
““2 6
=>
““7 9)
idsValoresDeCaracteristicas
““: U
.
““U V
Contains
““V ^
(
““^ _
vccn
““_ c
.
““c d%
id_valor_caracteristica
““d {
)
““{ |
)
““| }
)
””& '
.
‘‘ 
Select
‘‘ 
(
‘‘ 
riv
’’ 
=>
’’ 
new
’’  +
Reporte_Inventario_Valorizado
’’! >
(
’’> ?
)
’’? @
{
÷÷ 
IdConceptoNegocio
◊◊ +
=
◊◊, -
riv
◊◊. 1
.
◊◊1 2!
id_concepto_negocio
◊◊2 E
,
◊◊E F
Producto
ÿÿ "
=
ÿÿ# $
riv
ÿÿ% (
.
ÿÿ( )
Concepto_negocio
ÿÿ) 9
.
ÿÿ9 :
nombre
ÿÿ: @
,
ÿÿ@ A
Lote
ŸŸ 
=
ŸŸ  
riv
ŸŸ! $
.
ŸŸ$ %
lote
ŸŸ% )
,
ŸŸ) *
Cantidad
⁄⁄ "
=
⁄⁄# $
riv
⁄⁄% (
.
⁄⁄( )
cantidad
⁄⁄) 1
,
⁄⁄1 2
CostoUnitario
€€ '
=
€€( )
riv
€€* -
.
€€- .
precio_unitario
€€. =
,
€€= >
PrecioVigente
‹‹ '
=
‹‹( )
riv
‹‹* -
.
‹‹- .
Concepto_negocio
‹‹. >
.
‹‹> ?
Precio1
‹‹? F
.
‹‹F G
Where
‹‹G L
(
‹‹L M
p
‹‹M N
=>
‹‹O Q
p
‹‹R S
.
‹‹S T
id_actor_negocio
‹‹T d
==
‹‹e g%
idCentroAtencionPrecios
‹‹h 
&&‹‹Ä Ç
p‹‹É Ñ
.‹‹Ñ Ö

es_vigente‹‹Ö è
&&‹‹ê í
p‹‹ì î
.‹‹î ï
id_tarifa_d‹‹ï †
==‹‹° £
MaestroSettings‹‹§ ≥
.‹‹≥ ¥
Default‹‹¥ ª
.‹‹ª º,
IdDetalleMaestroTarifaNormal‹‹º ÿ
)‹‹ÿ Ÿ
.‹‹Ÿ ⁄!
OrderByDescending‹‹⁄ Î
(‹‹Î Ï
p‹‹Ï Ì
=>‹‹Ó 
p‹‹Ò Ú
.‹‹Ú Û
id‹‹Û ı
)‹‹ı ˆ
.‹‹ˆ ˜
FirstOrDefault‹‹˜ Ö
(‹‹Ö Ü
)‹‹Ü á
,‹‹á à1
#ValorCaracteristicasConceptoNegocio
›› =
=
››> ?
riv
››@ C
.
››C D
Concepto_negocio
››D T
.
››T U3
%Valor_caracteristica_concepto_negocio
››U z
.
››z {
Where››{ Ä
(››Ä Å
w››Å Ç
=>››É Ö+
idsValoresDeCaracteristicas››Ü °
.››° ¢
Contains››¢ ™
(››™ ´
w››´ ¨
.››¨ ≠'
id_valor_caracteristica››≠ ƒ
)››ƒ ≈
)››≈ ∆
.››∆ «
Distinct››« œ
(››œ –
)››– —
}
ﬁﬁ 
)
ﬂﬂ 
;
ﬂﬂ 
return
‡‡ 
	resultado
‡‡  
;
‡‡  !
}
·· 
catch
‚‚ 
(
‚‚ 
	Exception
‚‚ 
e
‚‚ 
)
‚‚ 
{
„„ 
throw
‰‰ 
e
‰‰ 
;
‰‰ 
}
ÂÂ 
}
ÊÊ 	
public
ËË 

Dictionary
ËË 
<
ËË 
long
ËË 
,
ËË 
long
ËË  $
>
ËË$ %2
$ObtenerIdsInventarioActualPorAlmacen
ËË& J
(
ÈÈ 
)
ÈÈ 
{
ÍÍ 	
try
ÎÎ 
{
ÏÏ 
SigescomEntities
 #
_db
$ '
=
( )
new
* -
SigescomEntities
. >
(
> ?
)
? @
;
@ A

Dictionary
ÒÒ 
<
ÒÒ 
long
ÒÒ 
,
ÒÒ  
long
ÒÒ! %
>
ÒÒ% &+
idsAlmacenIdsInventarioFisico
ÒÒ' D
=
ÒÒE F
new
ÒÒG J

Dictionary
ÒÒK U
<
ÒÒU V
long
ÒÒV Z
,
ÒÒZ [
long
ÒÒ\ `
>
ÒÒ` a
(
ÒÒa b
)
ÒÒb c
;
ÒÒc d
var
ÚÚ 
transacciones
ÚÚ !
=
ÚÚ" #
_db
ÚÚ$ '
.
ÚÚ' (
Transaccion
ÚÚ( 3
.
ÚÚ3 4
Where
ÚÚ4 9
(
ÚÚ9 :
t
ÚÚ: ;
=>
ÚÚ< >
t
ÚÚ? @
.
ÚÚ@ A!
id_tipo_transaccion
ÚÚA T
==
ÚÚU W!
TransaccionSettings
ÚÚX k
.
ÚÚk l
Default
ÚÚl s
.
ÚÚs t0
!IdTipoTransaccionInventarioActualÚÚt ï
&&ÚÚñ ò
t
ÛÛ? @
.
ÛÛ@ A
id_estado_actual
ÛÛA Q
==
ÛÛR T
MaestroSettings
ÛÛU d
.
ÛÛd e
Default
ÛÛe l
.
ÛÛl m/
 IdDetalleMaestroEstadoConfirmadoÛÛm ç
)ÛÛç é
.ÛÛé è
SelectÛÛè ï
(ÛÛï ñ
tÛÛñ ó
=>ÛÛò ö
newÛÛõ û
{ÛÛü †
	IdAlmacenÛÛ° ™
=ÛÛ´ ¨
tÛÛ≠ Æ
.ÛÛÆ Ø(
id_actor_negocio_internoÛÛØ «
,ÛÛ« »"
IdInventarioActualÛÛ… €
=ÛÛ‹ ›
tÛÛﬁ ﬂ
.ÛÛﬂ ‡
idÛÛ‡ ‚
}ÛÛ„ ‰
)ÛÛ‰ Â
.ÛÛÂ Ê
ToListÛÛÊ Ï
(ÛÛÏ Ì
)ÛÛÌ Ó
;ÛÛÓ Ô
foreach
ÙÙ 
(
ÙÙ 
var
ÙÙ 
transaccion
ÙÙ (
in
ÙÙ) +
transacciones
ÙÙ, 9
)
ÙÙ9 :
{
ıı +
idsAlmacenIdsInventarioFisico
ˆˆ 1
.
ˆˆ1 2
Add
ˆˆ2 5
(
ˆˆ5 6
transaccion
ˆˆ6 A
.
ˆˆA B
	IdAlmacen
ˆˆB K
,
ˆˆK L
transaccion
ˆˆM X
.
ˆˆX Y 
IdInventarioActual
ˆˆY k
)
ˆˆk l
;
ˆˆl m
}
˜˜ 
return
¯¯ +
idsAlmacenIdsInventarioFisico
¯¯ 4
;
¯¯4 5
}
˘˘ 
catch
˙˙ 
(
˙˙ 
	Exception
˙˙ 
e
˙˙ 
)
˙˙ 
{
˚˚ 
throw
¸¸ 
new
¸¸ 
DatosException
¸¸ (
(
¸¸( )
$str
¸¸) i
,
¸¸i j
e
¸¸k l
)
¸¸l m
;
¸¸m n
}
˝˝ 
}
˛˛ 	
}
ˇˇ 
}ÄÄ ©Œ
WD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\Almacen\OrdenAlmacen_Datos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
." #
Almacen# *
{ 
public 

partial 
class 
OrdenAlmacen_Datos +
:, -%
IOrdenAlmacen_Repositorio. G
{ 
public 
IEnumerable 
< 
OrdenAlmacenResumen .
>. /!
ObtenerOrdenesAlmacen0 E
(E F
DateTimeF N

fechaDesdeO Y
,Y Z
DateTime[ c

fechaHastad n
,n o
boolp t
porIngresar	u Ä
,
Ä Å
int
Ç Ö
[
Ö Ü
]
Ü á
idsModoEntrega
à ñ
,
ñ ó
int
ò õ
[
õ ú
]
ú ù

idsEstados
û ®
,
® ©
int
™ ≠
[
≠ Æ
]
Æ Ø
idsAlmacenes
∞ º
)
º Ω
{ 	
try 
{ 
SigescomEntities  
_db! $
=% &
new' *
SigescomEntities+ ;
(; <
)< =
;= >
return 
_db 
. 
Tipo_transaccion +
.+ ,
Where, 1
(1 2
tt2 4
=>5 7
tt8 :
.: ;2
&Accion_de_negocio_por_tipo_transaccion; a
.a b
Whereb g
(g h
antth l
=>m o
anttp t
.t u!
id_accion_de_negocio	u â
==
ä å!
TransaccionSettings
ç †
.
† °
Default
° ®
.
® ©2
$IdAccionDeNegocioCompromisoDeAlmacen
© Õ
&&
Œ –
antt
— ’
.
’ ÷
valor
÷ €
==
‹ ﬁ
porIngresar
ﬂ Í
)
Í Î
.
Î Ï
Select
Ï Ú
(
Ú Û
at
Û ı
=>
ˆ ¯
at
˘ ˚
.
˚ ¸!
id_tipo_transaccion
¸ è
)
è ê
.
ê ë
Contains
ë ô
(
ô ö
tt
ö ú
.
ú ù
id
ù ü
)
ü †
&&
° £
!
§ •
tt
• ß
.
ß ®4
&Accion_de_negocio_por_tipo_transaccion
® Œ
.
Œ œ
Where
œ ‘
(
‘ ’
antt
’ Ÿ
=>
⁄ ‹
antt
› ·
.
· ‚"
id_accion_de_negocio
‚ ˆ
==
˜ ˘!
TransaccionSettings
˙ ç
.
ç é
Default
é ï
.
ï ñ2
$IdAccionDeNegocioCompromisoDeAlmacen
ñ ∫
&&
ª Ω
antt
æ ¬
.
¬ √
valor
√ »
)
» …
.
…  
Select
  –
(
– —
at
— ”
=>
‘ ÷
at
◊ Ÿ
.
Ÿ ⁄!
id_tipo_transaccion
⁄ Ì
)
Ì Ó
.
Ó Ô
	Intersect
Ô ¯
(
¯ ˘
tt
˘ ˚
.
˚ ¸4
&Accion_de_negocio_por_tipo_transaccion
¸ ¢
.
¢ £
Where
£ ®
(
® ©
antt
© ≠
=>
Æ ∞
antt
± µ
.
µ ∂"
id_accion_de_negocio
∂  
==
À Õ!
TransaccionSettings
Œ ·
.
· ‚
Default
‚ È
.
È Í2
$IdAccionDeNegocioCompromisoDeAlmacen
Í é
&&
è ë
!
í ì
antt
ì ó
.
ó ò
valor
ò ù
)
ù û
.
û ü
Select
ü •
(
• ¶
at
¶ ®
=>
© ´
at
¨ Æ
.
Æ Ø!
id_tipo_transaccion
Ø ¬
)
¬ √
)
√ ƒ
.
ƒ ≈
Contains
≈ Õ
(
Õ Œ
tt
Œ –
.
– —
id
— ”
)
” ‘
)
‘ ’
.
’ ÷

SelectMany
÷ ‡
(
‡ ·
tt
· „
=>
‰ Ê
tt
Á È
.
È Í
Transaccion
Í ı
)
ı ˆ
.
ˆ ˜
Where
˜ ¸
(
¸ ˝
t
˝ ˛
=>
ˇ Å
t
Ç É
.
É Ñ
fecha_inicio
Ñ ê
>=
ë ì

fechaDesde
î û
&&
ü °
t
¢ £
.
£ §
fecha_inicio
§ ∞
<=
± ≥

fechaHasta
¥ æ
&&
ø ¡
idsAlmacenes
¬ Œ
.
Œ œ
Contains
œ ◊
(
◊ ÿ
(
ÿ Ÿ
int
Ÿ ‹
)
‹ ›
t
› ﬁ
.
ﬁ ﬂ'
id_actor_negocio_interno1
ﬂ ¯
)
¯ ˘
&&
˙ ¸
idsModoEntrega
˝ ã
.
ã å
Contains
å î
(
î ï
t
ï ñ
.
ñ ó
enum1
ó ú
)
ú ù
&&
û †

idsEstados
° ´
.
´ ¨
Contains
¨ ¥
(
¥ µ
(
µ ∂
int
∂ π
)
π ∫
t
∫ ª
.
ª º 
id_estado_actual_1
º Œ
)
Œ œ
)
œ –
. 
Select 
( 
t 
=>  
new! $
OrdenAlmacenResumen% 8
(8 9
)9 :
{ 
Id 
= 
t 
. 
id !
,! "
Fecha 
= 
t  !
.! "
fecha_inicio" .
,. /'
EstablecimientoActorInterno 3
=4 5
t6 7
.7 8
Actor_negocio48 F
.F G
Actor_negocio2G U
.U V
ActorV [
.[ \
tercer_nombre\ i
,i j
NombreActorInterno *
=+ ,
t- .
.. /
Actor_negocio4/ =
.= >
Actor> C
.C D
primer_nombreD Q
.Q R
ReplaceR Y
(Y Z
$strZ ]
,] ^
$str_ b
)b c
,c d
TipoDocumento %
=& '
t( )
.) *
Comprobante* 5
.5 6
Detalle_maestro6 E
.E F
valorF K
,K L 
SerieNumeroDocumento ,
=- .
t/ 0
.0 1
Comprobante1 <
.< =
numero_serie= I
+J K
$strL O
+P Q
tR S
.S T
ComprobanteT _
._ `
numero` f
,f g
TipoOperacion   %
=  & '
t  ( )
.  ) *
Tipo_transaccion  * :
.  : ;
Tipo_transaccion2  ; L
.  L M
nombre  M S
,  S T
	Ordenante!! !
=!!" #
t!!$ %
.!!% &
Actor_negocio!!& 3
.!!3 4
Actor!!4 9
.!!9 :
Detalle_maestro!!: I
.!!I J
valor!!J O
+!!P Q
$str!!R V
+!!W X
t!!Y Z
.!!Z [
Actor_negocio!![ h
.!!h i
Actor!!i n
.!!n o'
numero_documento_identidad	!!o â
+
!!ä ã
$str
!!å ë
+
!!í ì
t
!!î ï
.
!!ï ñ
Actor_negocio
!!ñ £
.
!!£ §
Actor
!!§ ©
.
!!© ™
primer_nombre
!!™ ∑
.
!!∑ ∏
Replace
!!∏ ø
(
!!ø ¿
$str
!!¿ √
,
!!√ ƒ
$str
!!ƒ «
)
!!« »
,
!!» …
NombreActorExterno"" *
=""+ ,
t""- .
."". /
Actor_negocio1""/ =
.""= >
Actor""> C
.""C D
primer_nombre""D Q
.""Q R
Replace""R Y
(""Y Z
$str""Z ]
,""] ^
$str""_ b
)""b c
,""c d%
TipoDocumentoActorExterno## 1
=##2 3
t##4 5
.##5 6
Actor_negocio1##6 D
.##D E
Actor##E J
.##J K
Detalle_maestro##K Z
.##Z [
valor##[ `
,##` a!
DocumentoActorExterno$$ -
=$$. /
t$$0 1
.$$1 2
Actor_negocio1$$2 @
.$$@ A
Actor$$A F
.$$F G&
numero_documento_identidad$$G a
,$$a b
AliasOrigenDestino%% *
=%%+ ,
t%%- .
.%%. /!
Parametro_transaccion%%/ D
.%%D E
FirstOrDefault%%E S
(%%S T
pt%%T V
=>%%W Y
pt%%Z \
.%%\ ]
id_parametro%%] i
==%%j l
MaestroSettings%%m |
.%%| }
Default	%%} Ñ
.
%%Ñ Ö3
%IdDetalleMaestroParametroAliasCliente
%%Ö ™
)
%%™ ´
,
%%´ ¨
IdModoEntrega&& %
=&&& '
t&&( )
.&&) *
enum1&&* /
,&&/ 0
IdEstado''  
=''! "
(''# $
int''$ '
)''' (
t''( )
.'') *
id_estado_actual_1''* <
,''< =
Estado(( 
=((  
t((! "
.((" #
Detalle_maestro2((# 3
.((3 4
nombre((4 :
,((: ;
})) 
))) 
.)) 
OrderByDescending)) (
())( )
t))) *
=>))+ -
t)). /
.))/ 0
Fecha))0 5
)))5 6
;))6 7
}** 
catch++ 
(++ 
	Exception++ 
e++ 
)++ 
{,, 
throw-- 
new-- 
DatosException-- (
(--( )
$str--) [
,--[ \
e--] ^
)--^ _
;--_ `
}.. 
}// 	
public00 
IEnumerable00 
<00 
OrdenAlmacenResumen00 .
>00. /.
"ObtenerOrdenesAlmacenBidireccional000 R
(00R S
DateTime00S [

fechaDesde00\ f
,00f g
DateTime00h p

fechaHasta00q {
,00{ |
bool	00} Å
porIngresar
00Ç ç
,
00ç é
int
00è í
[
00í ì
]
00ì î
idsModoEntrega
00ï £
,
00£ §
int
00• ®
[
00® ©
]
00© ™

idsEstados
00´ µ
,
00µ ∂
int
00∑ ∫
[
00∫ ª
]
00ª º
idsAlmacenes
00Ω …
)
00…  
{11 	
try22 
{33 
SigescomEntities44  
_db44! $
=44% &
new44' *
SigescomEntities44+ ;
(44; <
)44< =
;44= >
return55 
_db55 
.55 
Tipo_transaccion55 +
.55+ ,
Where55, 1
(551 2
tt552 4
=>555 7
tt558 :
.55: ;2
&Accion_de_negocio_por_tipo_transaccion55; a
.55a b
Where55b g
(55g h
antt55h l
=>55m o
antt55p t
.55t u!
id_accion_de_negocio	55u â
==
55ä å!
TransaccionSettings
55ç †
.
55† °
Default
55° ®
.
55® ©2
$IdAccionDeNegocioCompromisoDeAlmacen
55© Õ
&&
55Œ –
antt
55— ’
.
55’ ÷
valor
55÷ €
)
55€ ‹
.
55‹ ›
Select
55› „
(
55„ ‰
at
55‰ Ê
=>
55Á È
at
55Í Ï
.
55Ï Ì!
id_tipo_transaccion
55Ì Ä
)
55Ä Å
.
55Å Ç
	Intersect
55Ç ã
(
55ã å
tt
55å é
.
55é è4
&Accion_de_negocio_por_tipo_transaccion
55è µ
.
55µ ∂
Where
55∂ ª
(
55ª º
antt
55º ¿
=>
55¡ √
antt
55ƒ »
.
55» …"
id_accion_de_negocio
55… ›
==
55ﬁ ‡!
TransaccionSettings
55· Ù
.
55Ù ı
Default
55ı ¸
.
55¸ ˝2
$IdAccionDeNegocioCompromisoDeAlmacen
55˝ °
&&
55¢ §
!
55• ¶
antt
55¶ ™
.
55™ ´
valor
55´ ∞
)
55∞ ±
.
55± ≤
Select
55≤ ∏
(
55∏ π
at
55π ª
=>
55º æ
at
55ø ¡
.
55¡ ¬!
id_tipo_transaccion
55¬ ’
)
55’ ÷
)
55÷ ◊
.
55◊ ÿ
Contains
55ÿ ‡
(
55‡ ·
tt
55· „
.
55„ ‰
id
55‰ Ê
)
55Ê Á
)
55Á Ë
.
55Ë È

SelectMany
55È Û
(
55Û Ù
tt
55Ù ˆ
=>
55˜ ˘
tt
55˙ ¸
.
55¸ ˝
Transaccion
55˝ à
)
55à â
.
55â ä
Where
55ä è
(
55è ê
t
55ê ë
=>
55í î
t
55ï ñ
.
55ñ ó
fecha_inicio
55ó £
>=
55§ ¶

fechaDesde
55ß ±
&&
55≤ ¥
t
55µ ∂
.
55∂ ∑
fecha_inicio
55∑ √
<=
55ƒ ∆

fechaHasta
55« —
&&
55“ ‘
(
55’ ÷
porIngresar
55÷ ·
?
55‚ „
idsAlmacenes
55‰ 
.
55 Ò
Contains
55Ò ˘
(
55˘ ˙
t
55˙ ˚
.
55˚ ¸&
id_actor_negocio_externo
55¸ î
)
55î ï
:
55ñ ó
idsAlmacenes
55ò §
.
55§ •
Contains
55• ≠
(
55≠ Æ
t
55Æ Ø
.
55Ø ∞&
id_actor_negocio_interno
55∞ »
)
55» …
)
55…  
&&
55À Õ
idsModoEntrega
55Œ ‹
.
55‹ ›
Contains
55› Â
(
55Â Ê
t
55Ê Á
.
55Á Ë
enum1
55Ë Ì
)
55Ì Ó
&&
55Ô Ò

idsEstados
55Ú ¸
.
55¸ ˝
Contains
55˝ Ö
(
55Ö Ü
(
55Ü á
int
55á ä
)
55ä ã
t
55ã å
.
55å ç 
id_estado_actual_1
55ç ü
)
55ü †
)
55† °
.66 
Select66 
(66 
t66 
=>66  
new66! $
OrdenAlmacenResumen66% 8
(668 9
)669 :
{77 
Id88 
=88 
t88 
.88 
id88 !
,88! "
Fecha99 
=99 
t99  !
.99! "
fecha_inicio99" .
,99. /'
EstablecimientoActorInterno:: 3
=::4 5
t::6 7
.::7 8
Actor_negocio2::8 F
.::F G
Actor_negocio2::G U
.::U V
Actor::V [
.::[ \
tercer_nombre::\ i
,::i j
NombreActorInterno;; *
=;;+ ,
t;;- .
.;;. /
Actor_negocio2;;/ =
.;;= >
Actor;;> C
.;;C D
primer_nombre;;D Q
.;;Q R
Replace;;R Y
(;;Y Z
$str;;Z ]
,;;] ^
$str;;_ b
);;b c
,;;c d%
TipoDocumentoActorInterno<< 1
=<<2 3
t<<4 5
.<<5 6
Actor_negocio2<<6 D
.<<D E
Actor<<E J
.<<J K
Detalle_maestro<<K Z
.<<Z [
valor<<[ `
,<<` a!
DocumentoActorInterno== -
===. /
t==0 1
.==1 2
Actor_negocio2==2 @
.==@ A
Actor==A F
.==F G&
numero_documento_identidad==G a
,==a b
TipoDocumento>> %
=>>& '
t>>( )
.>>) *
Comprobante>>* 5
.>>5 6
Detalle_maestro>>6 E
.>>E F
valor>>F K
,>>K L 
SerieNumeroDocumento?? ,
=??- .
t??/ 0
.??0 1
Comprobante??1 <
.??< =
numero_serie??= I
+??J K
$str??L O
+??P Q
t??R S
.??S T
Comprobante??T _
.??_ `
numero??` f
,??f g
TipoOperacion@@ %
=@@& '
t@@( )
.@@) *
Tipo_transaccion@@* :
.@@: ;
Tipo_transaccion2@@; L
.@@L M
nombre@@M S
,@@S T
	OrdenanteAA !
=AA" #
tAA$ %
.AA% &
Actor_negocioAA& 3
.AA3 4
ActorAA4 9
.AA9 :
Detalle_maestroAA: I
.AAI J
valorAAJ O
+AAP Q
$strAAR V
+AAW X
tAAY Z
.AAZ [
Actor_negocioAA[ h
.AAh i
ActorAAi n
.AAn o'
numero_documento_identidad	AAo â
+
AAä ã
$str
AAå ë
+
AAí ì
t
AAî ï
.
AAï ñ
Actor_negocio
AAñ £
.
AA£ §
Actor
AA§ ©
.
AA© ™
primer_nombre
AA™ ∑
.
AA∑ ∏
Replace
AA∏ ø
(
AAø ¿
$str
AA¿ √
,
AA√ ƒ
$str
AA≈ »
)
AA» …
,
AA…  '
EstablecimientoActorExternoBB 3
=BB4 5
tBB6 7
.BB7 8
Actor_negocio1BB8 F
.BBF G
Actor_negocio2BBG U
.BBU V
ActorBBV [
.BB[ \
tercer_nombreBB\ i
,BBi j
NombreActorExternoCC *
=CC+ ,
tCC- .
.CC. /
Actor_negocio1CC/ =
.CC= >
ActorCC> C
.CCC D
primer_nombreCCD Q
.CCQ R
ReplaceCCR Y
(CCY Z
$strCCZ ]
,CC] ^
$strCC_ b
)CCb c
,CCc d%
TipoDocumentoActorExternoDD 1
=DD2 3
tDD4 5
.DD5 6
Actor_negocio1DD6 D
.DDD E
ActorDDE J
.DDJ K
Detalle_maestroDDK Z
.DDZ [
valorDD[ `
,DD` a!
DocumentoActorExternoEE -
=EE. /
tEE0 1
.EE1 2
Actor_negocio1EE2 @
.EE@ A
ActorEEA F
.EEF G&
numero_documento_identidadEEG a
,EEa b
IdModoEntregaFF %
=FF& '
tFF( )
.FF) *
enum1FF* /
,FF/ 0
IdEstadoGG  
=GG! "
(GG# $
intGG$ '
)GG' (
tGG( )
.GG) *
id_estado_actual_1GG* <
,GG< =
EstadoHH 
=HH  
tHH! "
.HH" #
Detalle_maestro2HH# 3
.HH3 4
nombreHH4 :
,HH: ;
EsBidireccionalII '
=II( )
trueII* .
,II. /
PorIngresarJJ #
=JJ$ %
porIngresarJJ& 1
,JJ1 2
}KK 
)KK 
.KK 
OrderByDescendingKK (
(KK( )
tKK) *
=>KK+ -
tKK. /
.KK/ 0
FechaKK0 5
)KK5 6
;KK6 7
}LL 
catchMM 
(MM 
	ExceptionMM 
eMM 
)MM 
{NN 
throwOO 
newOO 
DatosExceptionOO (
(OO( )
$strOO) [
,OO[ \
eOO] ^
)OO^ _
;OO_ `
}PP 
}QQ 	
publicRR 
boolRR .
"VerificarOrdenAlmacenBidireccionalRR 6
(RR6 7
longRR7 ;
idOrdenAlmacenRR< J
)RRJ K
{SS 	
tryTT 
{UU 
SigescomEntitiesVV  
_dbVV! $
=VV% &
newVV' *
SigescomEntitiesVV+ ;
(VV; <
)VV< =
;VV= >
varWW *
accionesNegocioTipoTransaccionWW 2
=WW3 4
_dbWW5 8
.WW8 9
TransaccionWW9 D
.WWD E
FirstOrDefaultWWE S
(WWS T
tWWT U
=>WWV X
tWWY Z
.WWZ [
idWW[ ]
==WW^ `
idOrdenAlmacenWWa o
)WWo p
.WWp q
Tipo_transaccion	WWq Å
.
WWÅ Ç4
&Accion_de_negocio_por_tipo_transaccion
WWÇ ®
.
WW® ©
Where
WW© Æ
(
WWÆ Ø
antt
WWØ ≥
=>
WW¥ ∂
antt
WW∑ ª
.
WWª º"
id_accion_de_negocio
WWº –
==
WW— ”!
TransaccionSettings
WW‘ Á
.
WWÁ Ë
Default
WWË Ô
.
WWÔ 2
$IdAccionDeNegocioCompromisoDeAlmacen
WW î
)
WWî ï
.
WWï ñ
ToList
WWñ ú
(
WWú ù
)
WWù û
;
WWû ü
returnXX *
accionesNegocioTipoTransaccionXX 5
.XX5 6
SingleOrDefaultXX6 E
(XXE F
aXXF G
=>XXH J
aXXK L
.XXL M
valorXXM R
)XXR S
!=XXT V
nullXXW [
&&XX\ ^*
accionesNegocioTipoTransaccionXX_ }
.XX} ~
SingleOrDefault	XX~ ç
(
XXç é
a
XXé è
=>
XXê í
!
XXì î
a
XXî ï
.
XXï ñ
valor
XXñ õ
)
XXõ ú
!=
XXù ü
null
XX† §
;
XX§ •
}YY 
catchZZ 
(ZZ 
	ExceptionZZ 
eZZ 
)ZZ 
{[[ 
throw\\ 
new\\ 
LogicaException\\ )
(\\) *
$str\\* \
,\\\ ]
e\\^ _
)\\_ `
;\\` a
}]] 
}^^ 	
public__ 
OrdenAlmacen__ 
ObtenerOrdenAlmacen__ /
(__/ 0
long__0 4
idOrdenAlmacen__5 C
)__C D
{`` 	
tryaa 
{bb 
SigescomEntitiescc  
_dbcc! $
=cc% &
newcc' *
SigescomEntitiescc+ ;
(cc; <
)cc< =
;cc= >
vardd /
#idsTipoTransaccionCompromisoAlmacendd 7
=dd8 9
_dbdd: =
.dd= >2
&Accion_de_negocio_por_tipo_transacciondd> d
.ddd e
Wheredde j
(ddj k
anttddk o
=>ddp r
anttdds w
.ddw x!
id_accion_de_negocio	ddx å
==
ddç è!
TransaccionSettings
ddê £
.
dd£ §
Default
dd§ ´
.
dd´ ¨2
$IdAccionDeNegocioCompromisoDeAlmacen
dd¨ –
)
dd– —
.
dd— “
Select
dd“ ÿ
(
ddÿ Ÿ
antt
ddŸ ›
=>
ddﬁ ‡
antt
dd· Â
.
ddÂ Ê!
id_tipo_transaccion
ddÊ ˘
)
dd˘ ˙
.
dd˙ ˚
ToList
dd˚ Å
(
ddÅ Ç
)
ddÇ É
;
ddÉ Ñ
returnee 
_dbee 
.ee 
Transaccionee &
.ee& '
Whereee' ,
(ee, -
tee- .
=>ee/ 1
tee2 3
.ee3 4
idee4 6
==ee7 9
idOrdenAlmacenee: H
)eeH I
.ff 
Selectff 
(ff 
tff 
=>ff  
newff! $
OrdenAlmacenff% 1
(ff1 2
)ff2 3
{gg 
Idhh 
=hh 
thh 
.hh 
idhh !
,hh! "
Fechaii 
=ii 
tii  !
.ii! "
fecha_inicioii" .
,ii. /
IdActorInternojj &
=jj' (
(jj) *
intjj* -
)jj- .
tjj. /
.jj/ 0%
id_actor_negocio_interno1jj0 I
,jjI J'
EstablecimientoActorInternokk 3
=kk4 5
tkk6 7
.kk7 8
Actor_negocio4kk8 F
.kkF G
Actor_negocio2kkG U
.kkU V
ActorkkV [
.kk[ \
tercer_nombrekk\ i
,kki j
NombreActorInternoll *
=ll+ ,
tll- .
.ll. /
Actor_negocio4ll/ =
.ll= >
Actorll> C
.llC D
primer_nombrellD Q
,llQ R
TipoDocumentomm %
=mm& '
tmm( )
.mm) *
Comprobantemm* 5
.mm5 6
Detalle_maestromm6 E
.mmE F
valormmF K
,mmK L 
SerieNumeroDocumentonn ,
=nn- .
tnn/ 0
.nn0 1
Comprobantenn1 <
.nn< =
numero_serienn= I
+nnJ K
$strnnL O
+nnP Q
tnnR S
.nnS T
ComprobantennT _
.nn_ `
numeronn` f
,nnf g
IdTipoOperacionoo '
=oo( )
too* +
.oo+ ,
id_tipo_transaccionoo, ?
,oo? @
TipoOperacionpp %
=pp& '
tpp( )
.pp) *
Tipo_transaccionpp* :
.pp: ;
Tipo_transaccion2pp; L
.ppL M
nombreppM S
.ppS T
ToUpperppT [
(pp[ \
)pp\ ]
,pp] ^
	Ordenanteqq !
=qq" #
tqq$ %
.qq% &
Actor_negocioqq& 3
.qq3 4
Actorqq4 9
.qq9 :
Detalle_maestroqq: I
.qqI J
valorqqJ O
+qqP Q
$strqqR V
+qqW X
tqqY Z
.qqZ [
Actor_negocioqq[ h
.qqh i
Actorqqi n
.qqn o'
numero_documento_identidad	qqo â
+
qqä ã
$str
qqå ë
+
qqí ì
t
qqî ï
.
qqï ñ
Actor_negocio
qqñ £
.
qq£ §
Actor
qq§ ©
.
qq© ™
primer_nombre
qq™ ∑
.
qq∑ ∏
Replace
qq∏ ø
(
qqø ¿
$str
qq¿ √
,
qq√ ƒ
$str
qq≈ »
)
qq» …
,
qq…  
IdActorExternorr &
=rr' (
trr) *
.rr* +$
id_actor_negocio_externorr+ C
,rrC D
NombreActorExternoss *
=ss+ ,
tss- .
.ss. /
Actor_negocio1ss/ =
.ss= >
Actorss> C
.ssC D
primer_nombressD Q
.ssQ R
ReplacessR Y
(ssY Z
$strssZ ]
,ss] ^
$strss_ b
)ssb c
,ssc d%
TipoDocumentoActorExternott 1
=tt2 3
ttt4 5
.tt5 6
Actor_negocio1tt6 D
.ttD E
ActorttE J
.ttJ K
Detalle_maestrottK Z
.ttZ [
valortt[ `
,tt` a!
DocumentoActorExternouu -
=uu. /
tuu0 1
.uu1 2
Actor_negocio1uu2 @
.uu@ A
ActoruuA F
.uuF G&
numero_documento_identidaduuG a
,uua b
AliasOrigenDestinovv *
=vv+ ,
tvv- .
.vv. /!
Parametro_transaccionvv/ D
.vvD E
FirstOrDefaultvvE S
(vvS T
ptvvT V
=>vvW Y
ptvvZ \
.vv\ ]
id_parametrovv] i
==vvj l
MaestroSettingsvvm |
.vv| }
Default	vv} Ñ
.
vvÑ Ö3
%IdDetalleMaestroParametroAliasCliente
vvÖ ™
)
vv™ ´
,
vv´ ¨
EsBidireccionalww '
=ww( )
falseww* /
,ww/ 0
IdModoEntregaxx %
=xx& '
txx( )
.xx) *
enum1xx* /
,xx/ 0
IdEstadoyy  
=yy! "
(yy# $
intyy$ '
)yy' (
tyy( )
.yy) *
id_estado_actual_1yy* <
,yy< =
Estadozz 
=zz  
tzz! "
.zz" #
Detalle_maestro2zz# 3
.zz3 4
nombrezz4 :
,zz: ;

IdsOrdenes{{ "
={{# $
t{{% &
.{{& '
Transaccion11{{' 4
.{{4 5
Where{{5 :
({{: ;
tt{{; =
=>{{> @
tt{{A C
.{{C D
enum1{{D I
=={{J L
({{M N
int{{N Q
){{Q R#
IndicadorImpactoAlmacen{{R i
.{{i j3
&NoImpactaPorQueRevocaAOperacionInicial	{{j ê
&&
{{ë ì1
#idsTipoTransaccionCompromisoAlmacen
{{î ∑
.
{{∑ ∏
Contains
{{∏ ¿
(
{{¿ ¡
tt
{{¡ √
.
{{√ ƒ!
id_tipo_transaccion
{{ƒ ◊
)
{{◊ ÿ
)
{{ÿ Ÿ
.
{{Ÿ ⁄
Select
{{⁄ ‡
(
{{‡ ·
tt
{{· „
=>
{{‰ Ê
tt
{{Á È
.
{{È Í
id
{{Í Ï
)
{{Ï Ì
.
{{Ì Ó
ToList
{{Ó Ù
(
{{Ù ı
)
{{ı ˆ
,
{{ˆ ˜
Detalles||  
=||! "
t||# $
.||$ %
Detalle_transaccion||% 8
.||8 9
Where||9 >
(||> ?
dt||? A
=>||B D
dt||E G
.||G H
Concepto_negocio||H X
.||X Y
Detalle_maestro4||Y i
.||i j
valor||j o
==||p r
$str||s v
)||v w
.||w x
Select||x ~
(||~ 
dt	|| Å
=>
||Ç Ñ
new
||Ö à#
DetalleDeOrdenAlmacen
||â û
(
||û ü
)
||ü †
{}} 

IdConcepto~~ &
=~~' (
dt~~) +
.~~+ ,
id_concepto_negocio~~, ?
,~~? @
Concepto $
=% &
dt' )
.) *
Concepto_negocio* :
.: ;
nombre; A
,A B
Ordenado
ÄÄ $
=
ÄÄ% &
dt
ÄÄ' )
.
ÄÄ) *
cantidad
ÄÄ* 2
,
ÄÄ2 3
Revocado
ÅÅ $
=
ÅÅ% &
dt
ÅÅ' )
.
ÅÅ) *

cantidad_1
ÅÅ* 4
}
ÇÇ 
)
ÇÇ 
.
ÇÇ 
ToList
ÇÇ !
(
ÇÇ! "
)
ÇÇ" #
}
ÉÉ 
)
ÉÉ 
.
ÉÉ 
FirstOrDefault
ÉÉ %
(
ÉÉ% &
)
ÉÉ& '
;
ÉÉ' (
}
ÑÑ 
catch
ÖÖ 
(
ÖÖ 
	Exception
ÖÖ 
e
ÖÖ 
)
ÖÖ 
{
ÜÜ 
throw
áá 
new
áá 
DatosException
áá (
(
áá( )
$str
áá) X
,
ááX Y
e
ááZ [
)
áá[ \
;
áá\ ]
}
àà 
}
ââ 	
public
ää 
OrdenAlmacen
ää ,
ObtenerOrdenAlmacenBireccional
ää :
(
ää: ;
long
ää; ?
idOrdenAlmacen
ää@ N
,
ääN O
bool
ääP T
porIngresar
ääU `
)
ää` a
{
ãã 	
try
åå 
{
çç 
SigescomEntities
éé  
_db
éé! $
=
éé% &
new
éé' *
SigescomEntities
éé+ ;
(
éé; <
)
éé< =
;
éé= >
var
èè 1
#idsTipoTransaccionCompromisoAlmacen
èè 7
=
èè8 9
_db
èè: =
.
èè= >4
&Accion_de_negocio_por_tipo_transaccion
èè> d
.
èèd e
Where
èèe j
(
èèj k
antt
èèk o
=>
èèp r
antt
èès w
.
èèw x#
id_accion_de_negocioèèx å
==èèç è#
TransaccionSettingsèèê £
.èè£ §
Defaultèè§ ´
.èè´ ¨4
$IdAccionDeNegocioCompromisoDeAlmacenèè¨ –
)èè– —
.èè— “
Selectèè“ ÿ
(èèÿ Ÿ
anttèèŸ ›
=>èèﬁ ‡
anttèè· Â
.èèÂ Ê#
id_tipo_transaccionèèÊ ˘
)èè˘ ˙
.èè˙ ˚
ToListèè˚ Å
(èèÅ Ç
)èèÇ É
;èèÉ Ñ
return
êê 
_db
êê 
.
êê 
Transaccion
êê &
.
êê& '
Where
êê' ,
(
êê, -
t
êê- .
=>
êê/ 1
t
êê2 3
.
êê3 4
id
êê4 6
==
êê7 9
idOrdenAlmacen
êê: H
)
êêH I
.
ëë 
Select
ëë 
(
ëë 
t
ëë 
=>
ëë  
new
ëë! $
OrdenAlmacen
ëë% 1
(
ëë1 2
)
ëë2 3
{
íí 
Id
ìì 
=
ìì 
t
ìì 
.
ìì 
id
ìì !
,
ìì! "
Fecha
îî 
=
îî 
t
îî  !
.
îî! "
fecha_inicio
îî" .
,
îî. /
IdActorInterno
ïï &
=
ïï' (
(
ïï) *
int
ïï* -
)
ïï- .
t
ïï. /
.
ïï/ 0&
id_actor_negocio_interno
ïï0 H
,
ïïH I)
EstablecimientoActorInterno
ññ 3
=
ññ4 5
t
ññ6 7
.
ññ7 8
Actor_negocio2
ññ8 F
.
ññF G
Actor_negocio2
ññG U
.
ññU V
Actor
ññV [
.
ññ[ \
tercer_nombre
ññ\ i
,
ññi j 
NombreActorInterno
óó *
=
óó+ ,
t
óó- .
.
óó. /
Actor_negocio2
óó/ =
.
óó= >
Actor
óó> C
.
óóC D
primer_nombre
óóD Q
.
óóQ R
Replace
óóR Y
(
óóY Z
$str
óóZ ]
,
óó] ^
$str
óó_ b
)
óób c
,
óóc d'
TipoDocumentoActorInterno
òò 1
=
òò2 3
t
òò4 5
.
òò5 6
Actor_negocio2
òò6 D
.
òòD E
Actor
òòE J
.
òòJ K
Detalle_maestro
òòK Z
.
òòZ [
valor
òò[ `
,
òò` a#
DocumentoActorInterno
ôô -
=
ôô. /
t
ôô0 1
.
ôô1 2
Actor_negocio2
ôô2 @
.
ôô@ A
Actor
ôôA F
.
ôôF G(
numero_documento_identidad
ôôG a
,
ôôa b
TipoDocumento
öö %
=
öö& '
t
öö( )
.
öö) *
Comprobante
öö* 5
.
öö5 6
Detalle_maestro
öö6 E
.
ööE F
valor
ööF K
,
ööK L"
SerieNumeroDocumento
õõ ,
=
õõ- .
t
õõ/ 0
.
õõ0 1
Comprobante
õõ1 <
.
õõ< =
numero_serie
õõ= I
+
õõJ K
$str
õõL O
+
õõP Q
t
õõR S
.
õõS T
Comprobante
õõT _
.
õõ_ `
numero
õõ` f
,
õõf g
IdTipoOperacion
úú '
=
úú( )
t
úú* +
.
úú+ ,!
id_tipo_transaccion
úú, ?
,
úú? @
TipoOperacion
ùù %
=
ùù& '
t
ùù( )
.
ùù) *
Tipo_transaccion
ùù* :
.
ùù: ;
Tipo_transaccion2
ùù; L
.
ùùL M
nombre
ùùM S
.
ùùS T
ToUpper
ùùT [
(
ùù[ \
)
ùù\ ]
,
ùù] ^
	Ordenante
ûû !
=
ûû" #
t
ûû$ %
.
ûû% &
Actor_negocio
ûû& 3
.
ûû3 4
Actor
ûû4 9
.
ûû9 :
Detalle_maestro
ûû: I
.
ûûI J
valor
ûûJ O
+
ûûP Q
$str
ûûR V
+
ûûW X
t
ûûY Z
.
ûûZ [
Actor_negocio
ûû[ h
.
ûûh i
Actor
ûûi n
.
ûûn o)
numero_documento_identidadûûo â
+ûûä ã
$strûûå ë
+ûûí ì
tûûî ï
.ûûï ñ
Actor_negocioûûñ £
.ûû£ §
Actorûû§ ©
.ûû© ™
primer_nombreûû™ ∑
.ûû∑ ∏
Replaceûû∏ ø
(ûûø ¿
$strûû¿ √
,ûû√ ƒ
$strûû≈ »
)ûû» …
,ûû…  
IdActorExterno
üü &
=
üü' (
t
üü) *
.
üü* +&
id_actor_negocio_externo
üü+ C
,
üüC D)
EstablecimientoActorExterno
†† 3
=
††4 5
t
††6 7
.
††7 8
Actor_negocio1
††8 F
.
††F G
Actor_negocio2
††G U
.
††U V
Actor
††V [
.
††[ \
tercer_nombre
††\ i
,
††i j 
NombreActorExterno
°° *
=
°°+ ,
t
°°- .
.
°°. /
Actor_negocio1
°°/ =
.
°°= >
Actor
°°> C
.
°°C D
primer_nombre
°°D Q
.
°°Q R
Replace
°°R Y
(
°°Y Z
$str
°°Z ]
,
°°] ^
$str
°°_ b
)
°°b c
,
°°c d'
TipoDocumentoActorExterno
¢¢ 1
=
¢¢2 3
t
¢¢4 5
.
¢¢5 6
Actor_negocio1
¢¢6 D
.
¢¢D E
Actor
¢¢E J
.
¢¢J K
Detalle_maestro
¢¢K Z
.
¢¢Z [
valor
¢¢[ `
,
¢¢` a#
DocumentoActorExterno
££ -
=
££. /
t
££0 1
.
££1 2
Actor_negocio1
££2 @
.
££@ A
Actor
££A F
.
££F G(
numero_documento_identidad
££G a
,
££a b 
AliasOrigenDestino
§§ *
=
§§+ ,
t
§§- .
.
§§. /#
Parametro_transaccion
§§/ D
.
§§D E
FirstOrDefault
§§E S
(
§§S T
pt
§§T V
=>
§§W Y
pt
§§Z \
.
§§\ ]
id_parametro
§§] i
==
§§j l
MaestroSettings
§§m |
.
§§| }
Default§§} Ñ
.§§Ñ Ö5
%IdDetalleMaestroParametroAliasCliente§§Ö ™
)§§™ ´
,§§´ ¨
EsBidireccional
•• '
=
••( )
true
••* .
,
••. /
PorIngresar
¶¶ #
=
¶¶$ %
porIngresar
¶¶& 1
,
¶¶1 2
IdModoEntrega
ßß %
=
ßß& '
t
ßß( )
.
ßß) *
enum1
ßß* /
,
ßß/ 0
IdEstado
®®  
=
®®! "
(
®®# $
int
®®$ '
)
®®' (
t
®®( )
.
®®) * 
id_estado_actual_1
®®* <
,
®®< =
Estado
©© 
=
©©  
t
©©! "
.
©©" #
Detalle_maestro2
©©# 3
.
©©3 4
nombre
©©4 :
,
©©: ;

IdsOrdenes
™™ "
=
™™# $
t
™™% &
.
™™& '
Transaccion11
™™' 4
.
™™4 5
Where
™™5 :
(
™™: ;
tt
™™; =
=>
™™> @
tt
™™A C
.
™™C D
enum1
™™D I
==
™™J L
(
™™M N
int
™™N Q
)
™™Q R%
IndicadorImpactoAlmacen
™™R i
.
™™i j5
&NoImpactaPorQueRevocaAOperacionInicial™™j ê
&&™™ë ì3
#idsTipoTransaccionCompromisoAlmacen™™î ∑
.™™∑ ∏
Contains™™∏ ¿
(™™¿ ¡
tt™™¡ √
.™™√ ƒ#
id_tipo_transaccion™™ƒ ◊
)™™◊ ÿ
)™™ÿ Ÿ
.™™Ÿ ⁄
Select™™⁄ ‡
(™™‡ ·
tt™™· „
=>™™‰ Ê
tt™™Á È
.™™È Í
id™™Í Ï
)™™Ï Ì
.™™Ì Ó
ToList™™Ó Ù
(™™Ù ı
)™™ı ˆ
,™™ˆ ˜
Detalles
´´  
=
´´! "
t
´´# $
.
´´$ %!
Detalle_transaccion
´´% 8
.
´´8 9
Where
´´9 >
(
´´> ?
dt
´´? A
=>
´´B D
dt
´´E G
.
´´G H
Concepto_negocio
´´H X
.
´´X Y
Detalle_maestro4
´´Y i
.
´´i j
valor
´´j o
==
´´p r
$str
´´s v
)
´´v w
.
´´w x
Select
´´x ~
(
´´~ 
dt´´ Å
=>´´Ç Ñ
new´´Ö à%
DetalleDeOrdenAlmacen´´â û
(´´û ü
)´´ü †
{
¨¨ 

IdConcepto
≠≠ &
=
≠≠' (
dt
≠≠) +
.
≠≠+ ,!
id_concepto_negocio
≠≠, ?
,
≠≠? @
Concepto
ÆÆ $
=
ÆÆ% &
dt
ÆÆ' )
.
ÆÆ) *
Concepto_negocio
ÆÆ* :
.
ÆÆ: ;
nombre
ÆÆ; A
,
ÆÆA B
Ordenado
ØØ $
=
ØØ% &
dt
ØØ' )
.
ØØ) *
cantidad
ØØ* 2
,
ØØ2 3
Revocado
∞∞ $
=
∞∞% &
dt
∞∞' )
.
∞∞) *

cantidad_1
∞∞* 4
}
±± 
)
±± 
.
±± 
ToList
±± !
(
±±! "
)
±±" #
}
≤≤ 
)
≤≤ 
.
≤≤ 
FirstOrDefault
≤≤ %
(
≤≤% &
)
≤≤& '
;
≤≤' (
}
≥≥ 
catch
¥¥ 
(
¥¥ 
	Exception
¥¥ 
e
¥¥ 
)
¥¥ 
{
µµ 
throw
∂∂ 
new
∂∂ 
DatosException
∂∂ (
(
∂∂( )
$str
∂∂) X
,
∂∂X Y
e
∂∂Z [
)
∂∂[ \
;
∂∂\ ]
}
∑∑ 
}
∏∏ 	
public
ππ 
IEnumerable
ππ 
<
ππ !
OrdenDeOrdenAlmacen
ππ .
>
ππ. /*
ObtenerOrdenesDeOrdenAlmacen
ππ0 L
(
ππL M
long
ππM Q
[
ππQ R
]
ππR S

IdsOrdenes
ππT ^
)
ππ^ _
{
∫∫ 	
try
ªª 
{
ºº 
SigescomEntities
ΩΩ  
_db
ΩΩ! $
=
ΩΩ% &
new
ΩΩ' *
SigescomEntities
ΩΩ+ ;
(
ΩΩ; <
)
ΩΩ< =
;
ΩΩ= >
return
ææ 
_db
ææ 
.
ææ 
Transaccion
ææ &
.
ææ& '
Where
ææ' ,
(
ææ, -
t
ææ- .
=>
ææ/ 1

IdsOrdenes
ææ2 <
.
ææ< =
Contains
ææ= E
(
ææE F
t
ææF G
.
ææG H
id
ææH J
)
ææJ K
)
ææK L
.
øø 
Select
øø 
(
øø 
t
øø 
=>
øø  
new
øø! $!
OrdenDeOrdenAlmacen
øø% 8
(
øø8 9
)
øø9 :
{
¿¿ 
Id
¡¡ 
=
¡¡ 
t
¡¡ 
.
¡¡ 
id
¡¡ !
,
¡¡! "
Fecha
¬¬ 
=
¬¬ 
t
¬¬  !
.
¬¬! "
fecha_inicio
¬¬" .
,
¬¬. /
IdTipoTransaccion
√√ )
=
√√* +
t
√√, -
.
√√- .!
id_tipo_transaccion
√√. A
,
√√A B
TipoDocumento
ƒƒ %
=
ƒƒ& '
t
ƒƒ( )
.
ƒƒ) *
Comprobante
ƒƒ* 5
.
ƒƒ5 6
Detalle_maestro
ƒƒ6 E
.
ƒƒE F
nombre
ƒƒF L
,
ƒƒL M"
SerieNumeroDocumento
≈≈ ,
=
≈≈- .
t
≈≈/ 0
.
≈≈0 1
Comprobante
≈≈1 <
.
≈≈< =
numero_serie
≈≈= I
+
≈≈J K
$str
≈≈L O
+
≈≈P Q
t
≈≈R S
.
≈≈S T
Comprobante
≈≈T _
.
≈≈_ `
numero
≈≈` f
,
≈≈f g
TipoOperacion
∆∆ %
=
∆∆& '
t
∆∆( )
.
∆∆) *
Tipo_transaccion
∆∆* :
.
∆∆: ;
Tipo_transaccion2
∆∆; L
.
∆∆L M
nombre
∆∆M S
.
∆∆S T
ToUpper
∆∆T [
(
∆∆[ \
)
∆∆\ ]
}
«« 
)
«« 
;
«« 
}
»» 
catch
…… 
(
…… 
	Exception
…… 
e
…… 
)
…… 
{
   
throw
ÀÀ 
new
ÀÀ 
LogicaException
ÀÀ )
(
ÀÀ) *
$str
ÀÀ* \
,
ÀÀ\ ]
e
ÀÀ^ _
)
ÀÀ_ `
;
ÀÀ` a
}
ÃÃ 
}
ÕÕ 	
public
œœ 
IEnumerable
œœ 
<
œœ &
MovimientoDeOrdenAlmacen
œœ 3
>
œœ3 4.
 ObtenerMovimientosDeOrdenAlmacen
œœ5 U
(
œœU V
long
œœV Z
[
œœZ [
]
œœ[ \

IdsOrdenes
œœ] g
)
œœg h
{
–– 	
try
—— 
{
““ 
SigescomEntities
””  
_db
””! $
=
””% &
new
””' *
SigescomEntities
””+ ;
(
””; <
)
””< =
;
””= >
var
‘‘ 1
#idsTipoTransaccionMovimientoAlmacen
‘‘ 7
=
‘‘8 9
_db
‘‘: =
.
‘‘= >4
&Accion_de_negocio_por_tipo_transaccion
‘‘> d
.
‘‘d e
Where
‘‘e j
(
‘‘j k
antt
‘‘k o
=>
‘‘p r
antt
‘‘s w
.
‘‘w x#
id_accion_de_negocio‘‘x å
==‘‘ç è#
TransaccionSettings‘‘ê £
.‘‘£ §
Default‘‘§ ´
.‘‘´ ¨4
$IdAccionDeNegocioMovimientoEnAlmacen‘‘¨ –
)‘‘– —
.‘‘— “
Select‘‘“ ÿ
(‘‘ÿ Ÿ
antt‘‘Ÿ ›
=>‘‘ﬁ ‡
antt‘‘· Â
.‘‘Â Ê#
id_tipo_transaccion‘‘Ê ˘
)‘‘˘ ˙
.‘‘˙ ˚
ToList‘‘˚ Å
(‘‘Å Ç
)‘‘Ç É
;‘‘É Ñ
return
’’ 
_db
’’ 
.
’’ 
Transaccion
’’ &
.
’’& '
Where
’’' ,
(
’’, -
t
’’- .
=>
’’/ 1

IdsOrdenes
’’2 <
.
’’< =
Contains
’’= E
(
’’E F
(
’’F G
long
’’G K
)
’’K L
t
’’L M
.
’’M N'
id_transaccion_referencia
’’N g
)
’’g h
&&
’’i k2
#idsTipoTransaccionMovimientoAlmacen’’l è
.’’è ê
Contains’’ê ò
(’’ò ô
t’’ô ö
.’’ö õ#
id_tipo_transaccion’’õ Æ
)’’Æ Ø
)’’Ø ∞
.
÷÷ 
Select
÷÷ 
(
÷÷ 
t
÷÷ 
=>
÷÷  
new
÷÷! $&
MovimientoDeOrdenAlmacen
÷÷% =
(
÷÷= >
)
÷÷> ?
{
◊◊ 
Id
ÿÿ 
=
ÿÿ 
t
ÿÿ 
.
ÿÿ 
id
ÿÿ !
,
ÿÿ! "
IdOrden
ŸŸ 
=
ŸŸ  !
(
ŸŸ" #
long
ŸŸ# '
)
ŸŸ' (
t
ŸŸ( )
.
ŸŸ) *'
id_transaccion_referencia
ŸŸ* C
,
ŸŸC D
IdTipoComprobante
⁄⁄ )
=
⁄⁄* +
t
⁄⁄, -
.
⁄⁄- .
Comprobante
⁄⁄. 9
.
⁄⁄9 :!
id_tipo_comprobante
⁄⁄: M
,
⁄⁄M N
Fecha
€€ 
=
€€ 
t
€€  !
.
€€! "
fecha_inicio
€€" .
,
€€. /
Destinatario
‹‹ $
=
‹‹% &
t
‹‹' (
.
‹‹( )
Actor_negocio1
‹‹) 7
.
‹‹7 8
Actor
‹‹8 =
.
‹‹= >
Detalle_maestro
‹‹> M
.
‹‹M N
valor
‹‹N S
+
‹‹T U
$str
‹‹V Z
+
‹‹[ \
t
‹‹] ^
.
‹‹^ _
Actor_negocio1
‹‹_ m
.
‹‹m n
Actor
‹‹n s
.
‹‹s t)
numero_documento_identidad‹‹t é
+‹‹è ê
$str‹‹ë ñ
+‹‹ó ò
t‹‹ô ö
.‹‹ö õ
Actor_negocio1‹‹õ ©
.‹‹© ™
Actor‹‹™ Ø
.‹‹Ø ∞
primer_nombre‹‹∞ Ω
.‹‹Ω æ
Replace‹‹æ ≈
(‹‹≈ ∆
$str‹‹∆ …
,‹‹…  
$str‹‹À Œ
)‹‹Œ œ
,‹‹œ –"
SerieNumeroDocumento
›› ,
=
››- .
t
››/ 0
.
››0 1
Comprobante
››1 <
.
››< =
numero_serie
››= I
+
››J K
$str
››L O
+
››P Q
t
››R S
.
››S T
Comprobante
››T _
.
››_ `
numero
››` f
,
››f g
IdEstado
ﬁﬁ  
=
ﬁﬁ! "
(
ﬁﬁ# $
int
ﬁﬁ$ '
)
ﬁﬁ' (
t
ﬁﬁ( )
.
ﬁﬁ) *
id_estado_actual
ﬁﬁ* :
,
ﬁﬁ: ;
Detalles
ﬂﬂ  
=
ﬂﬂ! "
t
ﬂﬂ# $
.
ﬂﬂ$ %!
Detalle_transaccion
ﬂﬂ% 8
.
ﬂﬂ8 9
Where
ﬂﬂ9 >
(
ﬂﬂ> ?
dt
ﬂﬂ? A
=>
ﬂﬂB D
dt
ﬂﬂE G
.
ﬂﬂG H
Concepto_negocio
ﬂﬂH X
.
ﬂﬂX Y
Detalle_maestro4
ﬂﬂY i
.
ﬂﬂi j
valor
ﬂﬂj o
==
ﬂﬂp r
$str
ﬂﬂs v
)
ﬂﬂv w
.
ﬂﬂw x
Select
ﬂﬂx ~
(
ﬂﬂ~ 
dtﬂﬂ Å
=>ﬂﬂÇ Ñ
newﬂﬂÖ à%
DetalleDeOrdenAlmacenﬂﬂâ û
(ﬂﬂû ü
)ﬂﬂü †
{
‡‡ 

IdConcepto
·· &
=
··' (
dt
··) +
.
··+ ,!
id_concepto_negocio
··, ?
,
··? @
Concepto
‚‚ $
=
‚‚% &
dt
‚‚' )
.
‚‚) *
Concepto_negocio
‚‚* :
.
‚‚: ;
nombre
‚‚; A
,
‚‚A B
Cantidad
„„ $
=
„„% &
dt
„„' )
.
„„) *
cantidad
„„* 2
}
‰‰ 
)
‰‰ 
.
‰‰ 
ToList
‰‰ !
(
‰‰! "
)
‰‰" #
,
‰‰# $
}
ÂÂ 
)
ÂÂ 
;
ÂÂ 
}
ÊÊ 
catch
ÁÁ 
(
ÁÁ 
	Exception
ÁÁ 
e
ÁÁ 
)
ÁÁ 
{
ËË 
throw
ÈÈ 
new
ÈÈ 
LogicaException
ÈÈ )
(
ÈÈ) *
$str
ÈÈ* `
,
ÈÈ` a
e
ÈÈb c
)
ÈÈc d
;
ÈÈd e
}
ÍÍ 
}
ÎÎ 	
public
ÌÌ 
IEnumerable
ÌÌ 
<
ÌÌ &
MovimientoDeOrdenAlmacen
ÌÌ 3
>
ÌÌ3 4.
 ObtenerMovimientosDeOrdenAlmacen
ÌÌ5 U
(
ÌÌU V
long
ÌÌV Z
[
ÌÌZ [
]
ÌÌ[ \

IdsOrdenes
ÌÌ] g
,
ÌÌg h
bool
ÌÌi m
porIngresar
ÌÌn y
)
ÌÌy z
{
ÓÓ 	
try
ÔÔ 
{
 
SigescomEntities
ÒÒ  
_db
ÒÒ! $
=
ÒÒ% &
new
ÒÒ' *
SigescomEntities
ÒÒ+ ;
(
ÒÒ; <
)
ÒÒ< =
;
ÒÒ= >
var
ÚÚ 1
#idsTipoTransaccionMovimientoAlmacen
ÚÚ 7
=
ÚÚ8 9
_db
ÚÚ: =
.
ÚÚ= >4
&Accion_de_negocio_por_tipo_transaccion
ÚÚ> d
.
ÚÚd e
Where
ÚÚe j
(
ÚÚj k
antt
ÚÚk o
=>
ÚÚp r
antt
ÚÚs w
.
ÚÚw x#
id_accion_de_negocioÚÚx å
==ÚÚç è#
TransaccionSettingsÚÚê £
.ÚÚ£ §
DefaultÚÚ§ ´
.ÚÚ´ ¨4
$IdAccionDeNegocioMovimientoEnAlmacenÚÚ¨ –
&&ÚÚ— ”
anttÚÚ‘ ÿ
.ÚÚÿ Ÿ
valorÚÚŸ ﬁ
==ÚÚﬂ ·
porIngresarÚÚ‚ Ì
)ÚÚÌ Ó
.ÚÚÓ Ô
SelectÚÚÔ ı
(ÚÚı ˆ
anttÚÚˆ ˙
=>ÚÚ˚ ˝
anttÚÚ˛ Ç
.ÚÚÇ É#
id_tipo_transaccionÚÚÉ ñ
)ÚÚñ ó
.ÚÚó ò
ToListÚÚò û
(ÚÚû ü
)ÚÚü †
;ÚÚ† °
return
ÛÛ 
_db
ÛÛ 
.
ÛÛ 
Transaccion
ÛÛ &
.
ÛÛ& '
Where
ÛÛ' ,
(
ÛÛ, -
t
ÛÛ- .
=>
ÛÛ/ 1

IdsOrdenes
ÛÛ2 <
.
ÛÛ< =
Contains
ÛÛ= E
(
ÛÛE F
(
ÛÛF G
long
ÛÛG K
)
ÛÛK L
t
ÛÛL M
.
ÛÛM N'
id_transaccion_referencia
ÛÛN g
)
ÛÛg h
&&
ÛÛi k2
#idsTipoTransaccionMovimientoAlmacenÛÛl è
.ÛÛè ê
ContainsÛÛê ò
(ÛÛò ô
tÛÛô ö
.ÛÛö õ#
id_tipo_transaccionÛÛõ Æ
)ÛÛÆ Ø
)ÛÛØ ∞
.
ÙÙ 
Select
ÙÙ 
(
ÙÙ 
t
ÙÙ 
=>
ÙÙ  
new
ÙÙ! $&
MovimientoDeOrdenAlmacen
ÙÙ% =
(
ÙÙ= >
)
ÙÙ> ?
{
ıı 
Id
ˆˆ 
=
ˆˆ 
t
ˆˆ 
.
ˆˆ 
id
ˆˆ !
,
ˆˆ! "
IdOrden
˜˜ 
=
˜˜  !
(
˜˜" #
long
˜˜# '
)
˜˜' (
t
˜˜( )
.
˜˜) *'
id_transaccion_referencia
˜˜* C
,
˜˜C D
IdTipoComprobante
¯¯ )
=
¯¯* +
t
¯¯, -
.
¯¯- .
Comprobante
¯¯. 9
.
¯¯9 :!
id_tipo_comprobante
¯¯: M
,
¯¯M N
Fecha
˘˘ 
=
˘˘ 
t
˘˘  !
.
˘˘! "
fecha_inicio
˘˘" .
,
˘˘. /
Destinatario
˙˙ $
=
˙˙% &
t
˙˙' (
.
˙˙( )
Actor_negocio1
˙˙) 7
.
˙˙7 8
Actor
˙˙8 =
.
˙˙= >
Detalle_maestro
˙˙> M
.
˙˙M N
valor
˙˙N S
+
˙˙T U
$str
˙˙V Z
+
˙˙[ \
t
˙˙] ^
.
˙˙^ _
Actor_negocio1
˙˙_ m
.
˙˙m n
Actor
˙˙n s
.
˙˙s t)
numero_documento_identidad˙˙t é
+˙˙è ê
$str˙˙ë ñ
+˙˙ó ò
t˙˙ô ö
.˙˙ö õ
Actor_negocio1˙˙õ ©
.˙˙© ™
Actor˙˙™ Ø
.˙˙Ø ∞
primer_nombre˙˙∞ Ω
.˙˙Ω æ
Replace˙˙æ ≈
(˙˙≈ ∆
$str˙˙∆ …
,˙˙…  
$str˙˙À Œ
)˙˙Œ œ
,˙˙œ –"
SerieNumeroDocumento
˚˚ ,
=
˚˚- .
t
˚˚/ 0
.
˚˚0 1
Comprobante
˚˚1 <
.
˚˚< =
numero_serie
˚˚= I
+
˚˚J K
$str
˚˚L O
+
˚˚P Q
t
˚˚R S
.
˚˚S T
Comprobante
˚˚T _
.
˚˚_ `
numero
˚˚` f
,
˚˚f g
IdEstado
¸¸  
=
¸¸! "
(
¸¸# $
int
¸¸$ '
)
¸¸' (
t
¸¸( )
.
¸¸) *
id_estado_actual
¸¸* :
,
¸¸: ;
Detalles
˝˝  
=
˝˝! "
t
˝˝# $
.
˝˝$ %!
Detalle_transaccion
˝˝% 8
.
˝˝8 9
Where
˝˝9 >
(
˝˝> ?
dt
˝˝? A
=>
˝˝B D
dt
˝˝E G
.
˝˝G H
Concepto_negocio
˝˝H X
.
˝˝X Y
Detalle_maestro4
˝˝Y i
.
˝˝i j
valor
˝˝j o
==
˝˝p r
$str
˝˝s v
)
˝˝v w
.
˝˝w x
Select
˝˝x ~
(
˝˝~ 
dt˝˝ Å
=>˝˝Ç Ñ
new˝˝Ö à%
DetalleDeOrdenAlmacen˝˝â û
(˝˝û ü
)˝˝ü †
{
˛˛ 

IdConcepto
ˇˇ &
=
ˇˇ' (
dt
ˇˇ) +
.
ˇˇ+ ,!
id_concepto_negocio
ˇˇ, ?
,
ˇˇ? @
Concepto
ÄÄ $
=
ÄÄ% &
dt
ÄÄ' )
.
ÄÄ) *
Concepto_negocio
ÄÄ* :
.
ÄÄ: ;
nombre
ÄÄ; A
,
ÄÄA B
Cantidad
ÅÅ $
=
ÅÅ% &
dt
ÅÅ' )
.
ÅÅ) *
cantidad
ÅÅ* 2
}
ÇÇ 
)
ÇÇ 
.
ÇÇ 
ToList
ÇÇ !
(
ÇÇ! "
)
ÇÇ" #
,
ÇÇ# $
}
ÉÉ 
)
ÉÉ 
;
ÉÉ 
}
ÑÑ 
catch
ÖÖ 
(
ÖÖ 
	Exception
ÖÖ 
e
ÖÖ 
)
ÖÖ 
{
ÜÜ 
throw
áá 
new
áá 
LogicaException
áá )
(
áá) *
$str
áá* `
,
áá` a
e
ááb c
)
áác d
;
áád e
}
àà 
}
ââ 	
public
ãã 
IEnumerable
ãã 
<
ãã &
MovimientoDeOrdenAlmacen
ãã 3
>
ãã3 4/
!ObtenerNotasCreditoDeOrdenAlmacen
ãã5 V
(
ããV W
long
ããW [
idOrdenAlmacen
ãã\ j
)
ããj k
{
åå 	
try
çç 
{
éé 
SigescomEntities
èè  
_db
èè! $
=
èè% &
new
èè' *
SigescomEntities
èè+ ;
(
èè; <
)
èè< =
;
èè= >
return
êê 
_db
êê 
.
êê 
Transaccion
êê &
.
êê& '
Where
êê' ,
(
êê, -
t
êê- .
=>
êê/ 1
t
êê2 3
.
êê3 4'
id_transaccion_referencia
êê4 M
==
êêN P
idOrdenAlmacen
êêQ _
&&
êê` b
t
êêc d
.
êêd e!
id_tipo_transaccion
êêe x
==
êêy {"
TransaccionSettingsêê| è
.êêè ê
Defaultêêê ó
.êêó òB
2IdTipoDeTransaccionOrdenDeDevolucionPorItemEnVentaêêò  
)êê  À
.
ëë 
Select
ëë 
(
ëë 
t
ëë 
=>
ëë  
new
ëë! $&
MovimientoDeOrdenAlmacen
ëë% =
(
ëë= >
)
ëë> ?
{
íí 
Id
ìì 
=
ìì 
t
ìì 
.
ìì 
id
ìì !
,
ìì! "
IdOrden
îî 
=
îî  !
(
îî" #
long
îî# '
)
îî' (
t
îî( )
.
îî) *'
id_transaccion_referencia
îî* C
,
îîC D
IdTipoComprobante
ïï )
=
ïï* +
t
ïï, -
.
ïï- .
Comprobante
ïï. 9
.
ïï9 :!
id_tipo_comprobante
ïï: M
,
ïïM N
Fecha
ññ 
=
ññ 
t
ññ  !
.
ññ! "
fecha_inicio
ññ" .
,
ññ. /
Destinatario
óó $
=
óó% &
t
óó' (
.
óó( )
Actor_negocio1
óó) 7
.
óó7 8
Actor
óó8 =
.
óó= >
Detalle_maestro
óó> M
.
óóM N
valor
óóN S
+
óóT U
$str
óóV Z
+
óó[ \
t
óó] ^
.
óó^ _
Actor_negocio1
óó_ m
.
óóm n
Actor
óón s
.
óós t)
numero_documento_identidadóót é
+óóè ê
$stróóë ñ
+óóó ò
tóóô ö
.óóö õ
Actor_negocio1óóõ ©
.óó© ™
Actoróó™ Ø
.óóØ ∞
primer_nombreóó∞ Ω
.óóΩ æ
Replaceóóæ ≈
(óó≈ ∆
$stróó∆ …
,óó…  
$stróóÀ Œ
)óóŒ œ
,óóœ –"
SerieNumeroDocumento
òò ,
=
òò- .
t
òò/ 0
.
òò0 1
Comprobante
òò1 <
.
òò< =
numero_serie
òò= I
+
òòJ K
$str
òòL O
+
òòP Q
t
òòR S
.
òòS T
Comprobante
òòT _
.
òò_ `
numero
òò` f
,
òòf g
IdEstado
ôô  
=
ôô! "
(
ôô# $
int
ôô$ '
)
ôô' (
t
ôô( )
.
ôô) *
id_estado_actual
ôô* :
,
ôô: ;
Detalles
öö  
=
öö! "
t
öö# $
.
öö$ %!
Detalle_transaccion
öö% 8
.
öö8 9
Where
öö9 >
(
öö> ?
dt
öö? A
=>
ööB D
dt
ööE G
.
ööG H
Concepto_negocio
ööH X
.
ööX Y
Detalle_maestro4
ööY i
.
ööi j
valor
ööj o
==
ööp r
$str
öös v
)
ööv w
.
ööw x
Select
ööx ~
(
öö~ 
dtöö Å
=>ööÇ Ñ
newööÖ à%
DetalleDeOrdenAlmacenööâ û
(ööû ü
)ööü †
{
õõ 

IdConcepto
úú &
=
úú' (
dt
úú) +
.
úú+ ,!
id_concepto_negocio
úú, ?
,
úú? @
Concepto
ùù $
=
ùù% &
dt
ùù' )
.
ùù) *
Concepto_negocio
ùù* :
.
ùù: ;
nombre
ùù; A
,
ùùA B
Cantidad
ûû $
=
ûû% &
dt
ûû' )
.
ûû) *
cantidad
ûû* 2
}
üü 
)
üü 
.
üü 
ToList
üü !
(
üü! "
)
üü" #
,
üü# $
}
†† 
)
†† 
;
†† 
}
°° 
catch
¢¢ 
(
¢¢ 
	Exception
¢¢ 
e
¢¢ 
)
¢¢ 
{
££ 
throw
§§ 
new
§§ 
LogicaException
§§ )
(
§§) *
$str
§§* `
,
§§` a
e
§§b c
)
§§c d
;
§§d e
}
•• 
}
¶¶ 	
public
®® 
IEnumerable
®® 
<
®® &
MovimientoDeOrdenAlmacen
®® 3
>
®®3 49
+ObtenerMovimientosConfirmadosDeOrdenAlmacen
®®5 `
(
®®` a
long
®®a e
[
®®e f
]
®®f g

IdsOrdenes
®®h r
)
®®r s
{
©© 	
try
™™ 
{
´´ 
SigescomEntities
¨¨  
_db
¨¨! $
=
¨¨% &
new
¨¨' *
SigescomEntities
¨¨+ ;
(
¨¨; <
)
¨¨< =
;
¨¨= >
var
≠≠ 1
#idsTipoTransaccionMovimientoAlmacen
≠≠ 7
=
≠≠8 9
_db
≠≠: =
.
≠≠= >4
&Accion_de_negocio_por_tipo_transaccion
≠≠> d
.
≠≠d e
Where
≠≠e j
(
≠≠j k
antt
≠≠k o
=>
≠≠p r
antt
≠≠s w
.
≠≠w x#
id_accion_de_negocio≠≠x å
==≠≠ç è#
TransaccionSettings≠≠ê £
.≠≠£ §
Default≠≠§ ´
.≠≠´ ¨4
$IdAccionDeNegocioMovimientoEnAlmacen≠≠¨ –
)≠≠– —
.≠≠— “
Select≠≠“ ÿ
(≠≠ÿ Ÿ
antt≠≠Ÿ ›
=>≠≠ﬁ ‡
antt≠≠· Â
.≠≠Â Ê#
id_tipo_transaccion≠≠Ê ˘
)≠≠˘ ˙
.≠≠˙ ˚
ToList≠≠˚ Å
(≠≠Å Ç
)≠≠Ç É
;≠≠É Ñ
return
ÆÆ 
_db
ÆÆ 
.
ÆÆ 
Transaccion
ÆÆ &
.
ÆÆ& '
Where
ÆÆ' ,
(
ÆÆ, -
t
ÆÆ- .
=>
ÆÆ/ 1

IdsOrdenes
ÆÆ2 <
.
ÆÆ< =
Contains
ÆÆ= E
(
ÆÆE F
(
ÆÆF G
long
ÆÆG K
)
ÆÆK L
t
ÆÆL M
.
ÆÆM N'
id_transaccion_referencia
ÆÆN g
)
ÆÆg h
&&
ÆÆi k2
#idsTipoTransaccionMovimientoAlmacenÆÆl è
.ÆÆè ê
ContainsÆÆê ò
(ÆÆò ô
tÆÆô ö
.ÆÆö õ#
id_tipo_transaccionÆÆõ Æ
)ÆÆÆ Ø
&&ÆÆ∞ ≤
tÆÆ≥ ¥
.ÆÆ¥ µ 
id_estado_actualÆÆµ ≈
==ÆÆ∆ »
MaestroSettingsÆÆ… ÿ
.ÆÆÿ Ÿ
DefaultÆÆŸ ‡
.ÆÆ‡ ·0
 IdDetalleMaestroEstadoConfirmadoÆÆ· Å
)ÆÆÅ Ç
.
ØØ 
Select
ØØ 
(
ØØ 
t
ØØ 
=>
ØØ  
new
ØØ! $&
MovimientoDeOrdenAlmacen
ØØ% =
(
ØØ= >
)
ØØ> ?
{
∞∞ 
Id
±± 
=
±± 
t
±± 
.
±± 
id
±± !
,
±±! "
IdOrden
≤≤ 
=
≤≤  !
(
≤≤" #
long
≤≤# '
)
≤≤' (
t
≤≤( )
.
≤≤) *'
id_transaccion_referencia
≤≤* C
,
≤≤C D
IdTipoComprobante
≥≥ )
=
≥≥* +
t
≥≥, -
.
≥≥- .
Comprobante
≥≥. 9
.
≥≥9 :!
id_tipo_comprobante
≥≥: M
,
≥≥M N
Fecha
¥¥ 
=
¥¥ 
t
¥¥  !
.
¥¥! "
fecha_inicio
¥¥" .
,
¥¥. /
Destinatario
µµ $
=
µµ% &
t
µµ' (
.
µµ( )
Actor_negocio1
µµ) 7
.
µµ7 8
Actor
µµ8 =
.
µµ= >
Detalle_maestro
µµ> M
.
µµM N
valor
µµN S
+
µµT U
$str
µµV Z
+
µµ[ \
t
µµ] ^
.
µµ^ _
Actor_negocio1
µµ_ m
.
µµm n
Actor
µµn s
.
µµs t)
numero_documento_identidadµµt é
+µµè ê
$strµµë ñ
+µµó ò
tµµô ö
.µµö õ
Actor_negocio1µµõ ©
.µµ© ™
Actorµµ™ Ø
.µµØ ∞
primer_nombreµµ∞ Ω
.µµΩ æ
Replaceµµæ ≈
(µµ≈ ∆
$strµµ∆ …
,µµ…  
$strµµÀ Œ
)µµŒ œ
,µµœ –"
SerieNumeroDocumento
∂∂ ,
=
∂∂- .
t
∂∂/ 0
.
∂∂0 1
Comprobante
∂∂1 <
.
∂∂< =
numero_serie
∂∂= I
+
∂∂J K
$str
∂∂L O
+
∂∂P Q
t
∂∂R S
.
∂∂S T
Comprobante
∂∂T _
.
∂∂_ `
numero
∂∂` f
,
∂∂f g
IdEstado
∑∑  
=
∑∑! "
(
∑∑# $
int
∑∑$ '
)
∑∑' (
t
∑∑( )
.
∑∑) *
id_estado_actual
∑∑* :
,
∑∑: ;
Detalles
∏∏  
=
∏∏! "
t
∏∏# $
.
∏∏$ %!
Detalle_transaccion
∏∏% 8
.
∏∏8 9
Where
∏∏9 >
(
∏∏> ?
dt
∏∏? A
=>
∏∏B D
dt
∏∏E G
.
∏∏G H
Concepto_negocio
∏∏H X
.
∏∏X Y
Detalle_maestro4
∏∏Y i
.
∏∏i j
valor
∏∏j o
==
∏∏p r
$str
∏∏s v
)
∏∏v w
.
∏∏w x
Select
∏∏x ~
(
∏∏~ 
dt∏∏ Å
=>∏∏Ç Ñ
new∏∏Ö à%
DetalleDeOrdenAlmacen∏∏â û
(∏∏û ü
)∏∏ü †
{
ππ 

IdConcepto
∫∫ &
=
∫∫' (
dt
∫∫) +
.
∫∫+ ,!
id_concepto_negocio
∫∫, ?
,
∫∫? @
Concepto
ªª $
=
ªª% &
dt
ªª' )
.
ªª) *
Concepto_negocio
ªª* :
.
ªª: ;
nombre
ªª; A
,
ªªA B
Cantidad
ºº $
=
ºº% &
dt
ºº' )
.
ºº) *
cantidad
ºº* 2
}
ΩΩ 
)
ΩΩ 
.
ΩΩ 
ToList
ΩΩ !
(
ΩΩ! "
)
ΩΩ" #
,
ΩΩ# $
}
ææ 
)
ææ 
;
ææ 
}
øø 
catch
¿¿ 
(
¿¿ 
	Exception
¿¿ 
e
¿¿ 
)
¿¿ 
{
¡¡ 
throw
¬¬ 
new
¬¬ 
LogicaException
¬¬ )
(
¬¬) *
$str
¬¬* `
,
¬¬` a
e
¬¬b c
)
¬¬c d
;
¬¬d e
}
√√ 
}
ƒƒ 	
public
∆∆ 
OrdenAlmacen
∆∆ <
.ObtenerOrdenAlmacenConIdMovimientoOrdenAlmacen
∆∆ J
(
∆∆J K
long
∆∆K O&
IdMovimientoOrdenAlmacen
∆∆P h
)
∆∆h i
{
«« 	
try
»» 
{
…… 
SigescomEntities
    
_db
  ! $
=
  % &
new
  ' *
SigescomEntities
  + ;
(
  ; <
)
  < =
;
  = >
var
ÀÀ 1
#idsTipoTransaccionCompromisoAlmacen
ÀÀ 7
=
ÀÀ8 9
_db
ÀÀ: =
.
ÀÀ= >4
&Accion_de_negocio_por_tipo_transaccion
ÀÀ> d
.
ÀÀd e
Where
ÀÀe j
(
ÀÀj k
antt
ÀÀk o
=>
ÀÀp r
antt
ÀÀs w
.
ÀÀw x#
id_accion_de_negocioÀÀx å
==ÀÀç è#
TransaccionSettingsÀÀê £
.ÀÀ£ §
DefaultÀÀ§ ´
.ÀÀ´ ¨4
$IdAccionDeNegocioCompromisoDeAlmacenÀÀ¨ –
)ÀÀ– —
.ÀÀ— “
SelectÀÀ“ ÿ
(ÀÀÿ Ÿ
anttÀÀŸ ›
=>ÀÀﬁ ‡
anttÀÀ· Â
.ÀÀÂ Ê#
id_tipo_transaccionÀÀÊ ˘
)ÀÀ˘ ˙
.ÀÀ˙ ˚
ToListÀÀ˚ Å
(ÀÀÅ Ç
)ÀÀÇ É
;ÀÀÉ Ñ
return
ÃÃ 
_db
ÃÃ 
.
ÃÃ 
Transaccion
ÃÃ &
.
ÃÃ& '
Where
ÃÃ' ,
(
ÃÃ, -
t
ÃÃ- .
=>
ÃÃ/ 1
t
ÃÃ2 3
.
ÃÃ3 4
id
ÃÃ4 6
==
ÃÃ7 9&
IdMovimientoOrdenAlmacen
ÃÃ: R
)
ÃÃR S
.
ÃÃS T
Select
ÃÃT Z
(
ÃÃZ [
t
ÃÃ[ \
=>
ÃÃ] _
t
ÃÃ` a
.
ÃÃa b
Transaccion3
ÃÃb n
)
ÃÃn o
.
ÕÕ 
Select
ÕÕ 
(
ÕÕ 
t
ÕÕ 
=>
ÕÕ 
new
ÕÕ  #
OrdenAlmacen
ÕÕ$ 0
(
ÕÕ0 1
)
ÕÕ1 2
{
ŒŒ 
Id
œœ 
=
œœ 
t
œœ 
.
œœ 
id
œœ  
,
œœ  !
Fecha
–– 
=
–– 
t
––  
.
––  !
fecha_inicio
––! -
,
––- .)
EstablecimientoActorInterno
—— 2
=
——3 4
t
——5 6
.
——6 7
Actor_negocio4
——7 E
.
——E F
Actor_negocio2
——F T
.
——T U
Actor
——U Z
.
——Z [
tercer_nombre
——[ h
,
——h i
IdActorInterno
““ %
=
““& '
(
““( )
int
““) ,
)
““, -
t
““- .
.
““. /'
id_actor_negocio_interno1
““/ H
,
““H I 
NombreActorInterno
”” )
=
””* +
t
””, -
.
””- .
Actor_negocio4
””. <
.
””< =
Actor
””= B
.
””B C
primer_nombre
””C P
,
””P Q
TipoDocumento
‘‘ $
=
‘‘% &
t
‘‘' (
.
‘‘( )
Comprobante
‘‘) 4
.
‘‘4 5
Detalle_maestro
‘‘5 D
.
‘‘D E
valor
‘‘E J
,
‘‘J K"
SerieNumeroDocumento
’’ +
=
’’, -
t
’’. /
.
’’/ 0
Comprobante
’’0 ;
.
’’; <
numero_serie
’’< H
+
’’I J
$str
’’K N
+
’’O P
t
’’Q R
.
’’R S
Comprobante
’’S ^
.
’’^ _
numero
’’_ e
,
’’e f
IdTipoOperacion
÷÷ &
=
÷÷' (
t
÷÷) *
.
÷÷* +!
id_tipo_transaccion
÷÷+ >
,
÷÷> ?
TipoOperacion
◊◊ $
=
◊◊% &
t
◊◊' (
.
◊◊( )
Tipo_transaccion
◊◊) 9
.
◊◊9 :
Tipo_transaccion2
◊◊: K
.
◊◊K L
nombre
◊◊L R
.
◊◊R S
ToUpper
◊◊S Z
(
◊◊Z [
)
◊◊[ \
,
◊◊\ ]
	Ordenante
ÿÿ  
=
ÿÿ! "
t
ÿÿ# $
.
ÿÿ$ %
Actor_negocio
ÿÿ% 2
.
ÿÿ2 3
Actor
ÿÿ3 8
.
ÿÿ8 9
Detalle_maestro
ÿÿ9 H
.
ÿÿH I
valor
ÿÿI N
+
ÿÿO P
$str
ÿÿQ U
+
ÿÿV W
t
ÿÿX Y
.
ÿÿY Z
Actor_negocio
ÿÿZ g
.
ÿÿg h
Actor
ÿÿh m
.
ÿÿm n)
numero_documento_identidadÿÿn à
+ÿÿâ ä
$strÿÿã ê
+ÿÿë í
tÿÿì î
.ÿÿî ï
Actor_negocioÿÿï ¢
.ÿÿ¢ £
Actorÿÿ£ ®
.ÿÿ® ©
primer_nombreÿÿ© ∂
.ÿÿ∂ ∑
Replaceÿÿ∑ æ
(ÿÿæ ø
$strÿÿø ¬
,ÿÿ¬ √
$strÿÿƒ «
)ÿÿ« »
,ÿÿ» …
IdActorExterno
ŸŸ %
=
ŸŸ& '
t
ŸŸ( )
.
ŸŸ) *&
id_actor_negocio_externo
ŸŸ* B
,
ŸŸB C#
DocumentoActorExterno
⁄⁄ ,
=
⁄⁄- .
t
⁄⁄/ 0
.
⁄⁄0 1
Actor_negocio1
⁄⁄1 ?
.
⁄⁄? @
Actor
⁄⁄@ E
.
⁄⁄E F
Detalle_maestro
⁄⁄F U
.
⁄⁄U V
valor
⁄⁄V [
+
⁄⁄\ ]
$str
⁄⁄^ b
+
⁄⁄c d
t
⁄⁄e f
.
⁄⁄f g
Actor_negocio1
⁄⁄g u
.
⁄⁄u v
Actor
⁄⁄v {
.
⁄⁄{ |)
numero_documento_identidad⁄⁄| ñ
,⁄⁄ñ ó 
NombreActorExterno
€€ )
=
€€* +
t
€€, -
.
€€- .
Actor_negocio1
€€. <
.
€€< =
Actor
€€= B
.
€€B C
primer_nombre
€€C P
.
€€P Q
Replace
€€Q X
(
€€X Y
$str
€€Y \
,
€€\ ]
$str
€€^ a
)
€€a b
,
€€b c 
AliasOrigenDestino
‹‹ )
=
‹‹* +
t
‹‹, -
.
‹‹- .#
Parametro_transaccion
‹‹. C
.
‹‹C D
FirstOrDefault
‹‹D R
(
‹‹R S
pt
‹‹S U
=>
‹‹V X
pt
‹‹Y [
.
‹‹[ \
id_parametro
‹‹\ h
==
‹‹i k
MaestroSettings
‹‹l {
.
‹‹{ |
Default‹‹| É
.‹‹É Ñ5
%IdDetalleMaestroParametroAliasCliente‹‹Ñ ©
)‹‹© ™
,‹‹™ ´
IdModoEntrega
›› $
=
››% &
t
››' (
.
››( )
enum1
››) .
,
››. /
IdEstado
ﬁﬁ 
=
ﬁﬁ  !
(
ﬁﬁ" #
int
ﬁﬁ# &
)
ﬁﬁ& '
t
ﬁﬁ' (
.
ﬁﬁ( ) 
id_estado_actual_1
ﬁﬁ) ;
,
ﬁﬁ; <
Estado
ﬂﬂ 
=
ﬂﬂ 
t
ﬂﬂ  !
.
ﬂﬂ! "
Detalle_maestro
ﬂﬂ" 1
.
ﬂﬂ1 2
nombre
ﬂﬂ2 8
,
ﬂﬂ8 9

IdsOrdenes
‡‡ !
=
‡‡" #
t
‡‡$ %
.
‡‡% &
Transaccion11
‡‡& 3
.
‡‡3 4
Where
‡‡4 9
(
‡‡9 :
tt
‡‡: <
=>
‡‡= ?
tt
‡‡@ B
.
‡‡B C
enum1
‡‡C H
==
‡‡I K
(
‡‡L M
int
‡‡M P
)
‡‡P Q%
IndicadorImpactoAlmacen
‡‡Q h
.
‡‡h i5
&NoImpactaPorQueRevocaAOperacionInicial‡‡i è
&&‡‡ê í3
#idsTipoTransaccionCompromisoAlmacen‡‡ì ∂
.‡‡∂ ∑
Contains‡‡∑ ø
(‡‡ø ¿
tt‡‡¿ ¬
.‡‡¬ √#
id_tipo_transaccion‡‡√ ÷
)‡‡÷ ◊
)‡‡◊ ÿ
.‡‡ÿ Ÿ
Select‡‡Ÿ ﬂ
(‡‡ﬂ ‡
tt‡‡‡ ‚
=>‡‡„ Â
tt‡‡Ê Ë
.‡‡Ë È
id‡‡È Î
)‡‡Î Ï
.‡‡Ï Ì
ToList‡‡Ì Û
(‡‡Û Ù
)‡‡Ù ı
,‡‡ı ˆ
Detalles
·· 
=
··  !
t
··" #
.
··# $!
Detalle_transaccion
··$ 7
.
··7 8
Where
··8 =
(
··= >
dt
··> @
=>
··A C
dt
··D F
.
··F G
Concepto_negocio
··G W
.
··W X
Detalle_maestro4
··X h
.
··h i
valor
··i n
==
··o q
$str
··r u
)
··u v
.
··v w
Select
··w }
(
··} ~
dt··~ Ä
=>··Å É
new··Ñ á%
DetalleDeOrdenAlmacen··à ù
(··ù û
)··û ü
{
‚‚ 

IdConcepto
„„ %
=
„„& '
dt
„„( *
.
„„* +!
id_concepto_negocio
„„+ >
,
„„> ?
Concepto
‰‰ #
=
‰‰$ %
dt
‰‰& (
.
‰‰( )
Concepto_negocio
‰‰) 9
.
‰‰9 :
nombre
‰‰: @
,
‰‰@ A
Ordenado
ÂÂ #
=
ÂÂ$ %
dt
ÂÂ& (
.
ÂÂ( )
cantidad
ÂÂ) 1
,
ÂÂ1 2
Revocado
ÊÊ #
=
ÊÊ$ %
dt
ÊÊ& (
.
ÊÊ( )

cantidad_1
ÊÊ) 3
}
ÁÁ 
)
ÁÁ 
.
ÁÁ 
ToList
ÁÁ  
(
ÁÁ  !
)
ÁÁ! "
}
ËË 
)
ËË 
.
ËË 
FirstOrDefault
ËË $
(
ËË$ %
)
ËË% &
;
ËË& '
}
ÈÈ 
catch
ÍÍ 
(
ÍÍ 
	Exception
ÍÍ 
e
ÍÍ 
)
ÍÍ 
{
ÎÎ 
throw
ÏÏ 
new
ÏÏ 
LogicaException
ÏÏ )
(
ÏÏ) *
$str
ÏÏ* `
,
ÏÏ` a
e
ÏÏb c
)
ÏÏc d
;
ÏÏd e
}
ÌÌ 
}
ÓÓ 	
public
ÔÔ 
IEnumerable
ÔÔ 
<
ÔÔ #
DetalleDeOrdenAlmacen
ÔÔ 0
>
ÔÔ0 14
&ObtenerStockActualDetallesOrdenAlmacen
ÔÔ2 X
(
ÔÔX Y
int
ÔÔY \
[
ÔÔ\ ]
]
ÔÔ] ^
idsConceptos
ÔÔ_ k
,
ÔÔk l
int
ÔÔl o
	idAlmacen
ÔÔp y
)
ÔÔy z
{
 	
try
ÒÒ 
{
ÚÚ 
SigescomEntities
ÛÛ  
_db
ÛÛ! $
=
ÛÛ% &
new
ÛÛ' *
SigescomEntities
ÛÛ+ ;
(
ÛÛ; <
)
ÛÛ< =
;
ÛÛ= >
return
ÙÙ 
_db
ÙÙ 
.
ÙÙ 
Transaccion
ÙÙ &
.
ÙÙ& '
Where
ÙÙ' ,
(
ÙÙ, -
t
ÙÙ- .
=>
ÙÙ/ 1
t
ÙÙ2 3
.
ÙÙ3 4!
id_tipo_transaccion
ÙÙ4 G
==
ÙÙH J!
TransaccionSettings
ÙÙK ^
.
ÙÙ^ _
Default
ÙÙ_ f
.
ÙÙf g0
!IdTipoTransaccionInventarioActualÙÙg à
&&ÙÙâ ã
tÙÙå ç
.ÙÙç é(
id_actor_negocio_internoÙÙé ¶
==ÙÙß ©
	idAlmacenÙÙ™ ≥
)ÙÙ≥ ¥
.ÙÙ¥ µ

SelectManyÙÙµ ø
(ÙÙø ¿
tÙÙ¿ ¡
=>ÙÙ¬ ƒ
tÙÙ≈ ∆
.ÙÙ∆ «#
Detalle_transaccionÙÙ« ⁄
)ÙÙ⁄ €
.ÙÙ€ ‹
WhereÙÙ‹ ·
(ÙÙ· ‚
dtÙÙ‚ ‰
=>ÙÙÂ Á
idsConceptosÙÙË Ù
.ÙÙÙ ı
ContainsÙÙı ˝
(ÙÙ˝ ˛
dtÙÙ˛ Ä
.ÙÙÄ Å#
id_concepto_negocioÙÙÅ î
)ÙÙî ï
)ÙÙï ñ
.
ıı 
Select
ıı 
(
ıı 
dt
ıı 
=>
ıı !
new
ıı" %#
DetalleDeOrdenAlmacen
ıı& ;
(
ıı; <
)
ıı< =
{
ˆˆ 

IdConcepto
˜˜ "
=
˜˜# $
dt
˜˜% '
.
˜˜' (!
id_concepto_negocio
˜˜( ;
,
˜˜; <
StockActual
¯¯ #
=
¯¯$ %
dt
¯¯& (
.
¯¯( )
cantidad
¯¯) 1
}
˘˘ 
)
˘˘ 
;
˘˘ 
}
˙˙ 
catch
˚˚ 
(
˚˚ 
	Exception
˚˚ 
e
˚˚ 
)
˚˚ 
{
¸¸ 
throw
˝˝ 
new
˝˝ 
LogicaException
˝˝ )
(
˝˝) *
$str
˝˝* `
,
˝˝` a
e
˝˝b c
)
˝˝c d
;
˝˝d e
}
˛˛ 
}
ˇˇ 	
}
ÅÅ 
}ÇÇ †+
ZD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\Concepto\Caracteristica_Datos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
." #
	Conceptos# ,
{ 
public 

partial 
class  
Caracteristica_Datos -
:. /'
ICaracteristica_Repositorio0 K
{ 
public )
ConceptoConSusCaracteristicas ,B
6ObtenerConceptoNegocioConSusCaracteristicasYSusValores- c
(c d
intd g
idConceptoNegocioh y
)y z
{ 	
try 
{ 
SigescomEntities  
_db! $
=% &
new' *
SigescomEntities+ ;
(; <
)< =
;= >
var 
concepto 
= 
_db "
." #
Concepto_negocio# 3
.3 4
Where4 9
(9 :
cn: <
=>= ?
cn@ B
.B C
idC E
==F H
idConceptoNegocioI Z
)Z [
.[ \
Select\ b
(b c
cc d
=>e g
newh k*
ConceptoConSusCaracteristicas	l â
(
â ä
)
ä ã
{ 

IdConcepto 
=  
c! "
." #
id# %
,% &,
 NombreConceptoSinCaracteristicas 4
=5 6
c7 8
.8 9
Detalle_maestro49 I
.I J
nombreJ P
+Q R
$strS V
+W X
cY Z
.Z [
sufijo[ a
} 
) 
. 
FirstOrDefault !
(! "
)" #
;# $
concepto 
. 
Caracteristicas (
=) *
new+ .
List/ 3
<3 4
ItemGenerico4 @
>@ A
(A B
)B C
;C D
var 
caracteristicas #
=$ %
_db& )
.) *
Concepto_negocio* :
.: ;
Single; A
(A B
cnB D
=>E G
cnH J
.J K
idK M
==N P
idConceptoNegocioQ b
)b c
.c d
Detalle_maestro4d t
.t u$
Caracteristica_concepto	u å
.
å ç
Select
ç ì
(
ì î
cc
î ñ
=>
ó ô
cc
ö ú
.
ú ù
Detalle_maestro1
ù ≠
)
≠ Æ
.
Æ Ø
Where
Ø ¥
(
¥ µ
dm
µ ∑
=>
∏ ∫
dm
ª Ω
.
Ω æ

es_vigente
æ »
)
» …
.
…  
Select
  –
(
– —
c
— “
=>
” ’
new
÷ Ÿ
ItemGenerico
⁄ Ê
(
Ê Á
)
Á Ë
{ 
Id   
=   
c   
.   
id   
,   
Nombre!! 
=!! 
c!! 
.!! 
nombre!! %
}"" 
)"" 
."" 
ToList"" 
("" 
)"" 
;"" 
var## 1
%valoresCaracteristicasConceptoNegocio## 9
=##: ;
_db##< ?
.##? @1
%Valor_caracteristica_concepto_negocio##@ e
.##e f
Where##f k
(##k l
cn##l n
=>##o q
cn##r t
.##t u 
id_concepto_negocio	##u à
==
##â ã
idConceptoNegocio
##å ù
)
##ù û
.
##û ü
Select
##ü •
(
##• ¶
c
##¶ ß
=>
##® ™
new
##´ Æ
ItemGenerico
##Ø ª
(
##ª º
)
##º Ω
{$$ 
Id%% 
=%% 
c%% 
.%%  
Valor_caracteristica%% /
.%%/ 0
id_caracteristica%%0 A
,%%A B
Valor&& 
=&& 
c&& 
.&&  
Valor_caracteristica&& 2
.&&2 3
valor&&3 8
}'' 
)'' 
.'' 
ToList'' 
('' 
)'' 
;'' 
foreach(( 
((( 
var(( 
item(( !
in((" $1
%valoresCaracteristicasConceptoNegocio((% J
)((J K
{)) 
concepto** 
.** 
Caracteristicas** ,
.**, -
Add**- 0
(**0 1
new**1 4
ItemGenerico**5 A
(**A B
)**B C
{**D E
Id**F H
=**I J
item**K O
.**O P
Id**P R
,**R S
Nombre**T Z
=**[ \
caracteristicas**] l
.**l m
Single**m s
(**s t
c**t u
=>**v x
c**y z
.**z {
Id**{ }
==	**~ Ä
item
**Å Ö
.
**Ö Ü
Id
**Ü à
)
**à â
.
**â ä
Nombre
**ä ê
,
**ê ë
Valor
**í ó
=
**ò ô
item
**ö û
.
**û ü
Valor
**ü §
}
**• ¶
)
**¶ ß
;
**ß ®
}++ 
return,, 
concepto,, 
;,,  
}-- 
catch.. 
(.. 
	Exception.. 
e.. 
).. 
{// 
throw00 
new00 
DatosException00 (
(00( )
$str00) u
)00u v
;00v w
}11 
}22 	
}44 
}55 „Q
\D:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\Establecimientos\Sucursal_Datos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
." #
Establecimientos# 3
{ 
public 

partial 
class 
Sucursal_Datos '
:( )!
ISucursal_Repositorio* ?
{ 
public 
IEnumerable 
< $
EstablecimientoComercial 3
>3 46
*ObtenerEstablecimientosComercialesVigentes5 _
(_ `
)` a
{ 	
int 
[ 
] 
idsRoles 
= 
new 
int  #
[# $
]$ %
{% &
ActorSettings' 4
.4 5
Default5 <
.< =
IdRolSucursal= J
,J K
ActorSettingsL Y
.Y Z
DefaultZ a
.a b
	IdRolSedeb k
}k l
;l m
SigescomEntities 
_db  
=! "
new# &
SigescomEntities' 7
(7 8
)8 9
;9 :
return 
_db 
. 
Actor_negocio $
. 
Where 
( 
an 
=> 
idsRoles %
.% &
Contains& .
(. /
an/ 1
.1 2
id_rol2 8
)8 9
&&: <
an= ?
.? @

es_vigente@ J
==K M
trueN R
)R S
.S T
SelectT Z
(Z [
an[ ]
=>] _
new` c$
EstablecimientoComerciald |
(| }
)} ~
{	 Ä
Id
Å É
=
Ñ Ö
an
Ü à
.
à â
id
â ã
,
ã å
Nombre 
= 
an 
. 
Actor 
. 
primer_nombre +
,+ ,
NombreInterno 
= 
an 
. 
Actor $
.$ %
tercer_nombre% 2
,2 3
} 
) 
; 
} 	
public%% 
IEnumerable%% 
<%% 
ItemGenerico%% '
>%%' (H
<ObtenerActoresDeNegocioPorRolVigentesAhoraComosItemGenericos%%) e
(%%e f
int%%f i
[%%i j
]%%j k
idsRol%%l r
)%%r s
{&& 	
SigescomEntities'' 
_db''  
=''! "
new''# &
SigescomEntities''' 7
(''7 8
)''8 9
;''9 :
return)) 
_db)) 
.)) 
Actor_negocio)) $
.** 
Where** 
(** 
an** 
=>** 
idsRol** #
.**# $
Contains**$ ,
(**, -
an**- /
.**/ 0
id_rol**0 6
)**6 7
&&**8 :
an**; =
.**= >

es_vigente**> H
==**I K
true**L P
)**P Q
.**Q R
Select**R X
(**X Y
an**Y [
=>**\ ^
new**_ b
ItemGenerico**c o
{**p q
Id**r t
=**u v
an**w y
.**y z
id**z |
,**| }
Nombre	**~ Ñ
=
**Ö Ü
an
**á â
.
**â ä
Actor
**ä è
.
**è ê
tercer_nombre
**ê ù
}
**û ü
)
**ü †
;
**† °
}++ 	
public-- 
IEnumerable-- 
<-- #
ItemGenericoConSubItems-- 2
>--2 3H
<ObtenerActoresDeNegocioPorRolVigentesAhoraComosItemGenericos--4 p
(--p q
int--q t
[--t u
]--u v"
idsRolesActoresPadres	--w å
,
--å ç
int
--é ë)
idRolSecundarioActoresHijos
--í ≠
,
--≠ Æ
int
--Ø ≤(
idRolPrincipalActoresHijos
--≥ Õ
)
--Õ Œ
{.. 	
SigescomEntities// 
_db//  
=//! "
new//# &
SigescomEntities//' 7
(//7 8
)//8 9
;//9 :
return11 
_db11 
.11 
Actor_negocio11 $
.22 
Where22 
(22 
an22 
=>22 !
idsRolesActoresPadres22 2
.222 3
Contains223 ;
(22; <
an22< >
.22> ?
id_rol22? E
)22E F
&&22G I
an22J L
.22L M

es_vigente22M W
==22X Z
true22[ _
)22_ `
.22` a
Select22a g
(22g h
an22h j
=>22k m
new22n q$
ItemGenericoConSubItems	22r â
{33 
Id44 
=44 
an44 
.44 
id44 
,44 
Nombre55 
=55 
an55 
.55  
Actor55  %
.55% &
primer_nombre55& 3
,553 4
SubItems66 
=66 
an66 !
.66! "
Actor_negocio166" 0
.660 1
Where661 6
(666 7
anh667 :
=>66; =
anh66> A
.66A B
id_rol66B H
==66I K&
idRolPrincipalActoresHijos66L f
&&66g i
anh66j m
.66m n

es_vigente66n x
&&66y {
anh66| 
.	66 Ä
Actor
66Ä Ö
.
66Ö Ü
Actor_negocio
66Ü ì
.
66ì î
Count
66î ô
(
66ô ö
aa
66ö ú
=>
66ù ü
aa
66† ¢
.
66¢ £
id_rol
66£ ©
==
66™ ¨)
idRolSecundarioActoresHijos
66≠ »
&&
66… À
aa
66Ã Œ
.
66Œ œ

es_vigente
66œ Ÿ
)
66Ÿ ⁄
>
66€ ‹
$num
66› ﬁ
)
66ﬁ ﬂ
.77 
Select77 
(77 
anh77 
=>77  "
new77# &
ItemGenerico77' 3
{774 5
Id776 8
=779 :
anh77; >
.77> ?
id77? A
,77A B
Nombre77C I
=77J K
anh77L O
.77O P
Actor77P U
.77U V
primer_nombre77V c
}77d e
)77e f
.77f g
ToList77g m
(77m n
)77n o
}88 
)88 
;88 
}:: 	
public<< 
Actor_negocio<< \
PObtenerActorDeNegocioInclusiveDireccionesYTipoDocumentoIdentidadYFotoYParametros<< m
(<<m n
int<<n q
idActorNegocio	<<r Ä
)
<<Ä Å
{== 	
try>> 
{?? 
SigescomEntities@@ 
_db@@  
=@@! "
new@@# &
SigescomEntities@@' 7
(@@7 8
)@@8 9
;@@9 :
returnAA 
_dbAA 
.AA 
Actor_negocioAA (
.BB 
IncludeBB 
(BB 
anBB 
=>BB  "
anBB# %
.BB% &
ActorBB& +
)BB+ ,
.CC 
IncludeCC 
(CC 
anCC 
=>CC  "
anCC# %
.CC% &
ActorCC& +
.CC+ ,
Detalle_maestroCC, ;
)CC; <
.DD 
IncludeDD 
(DD 
anDD 
=>DD  "
anDD# %
.DD% &
ActorDD& +
.DD+ ,
	DireccionDD, 5
)DD5 6
.EE 
IncludeEE 
(EE 
anEE 
=>EE  "
anEE# %
.EE% &
ActorEE& +
.EE+ ,
	DireccionEE, 5
.EE5 6
SelectEE6 <
(EE< =
dEE= >
=>EE? A
dEEB C
.EEC D
UbigeoEED J
)EEJ K
)EEK L
.FF 
IncludeFF 
(FF 
anFF 
=>FF  "
anFF# %
.FF% &
ActorFF& +
.FF+ ,
FotoFF, 0
)FF0 1
.GG 
IncludeGG 
(GG 
anGG 
=>GG  "
anGG# %
.GG% &#
Parametro_actor_negocioGG& =
)GG= >
.HH 
SingleOrDefaultHH $
(HH$ %
anHH% '
=>HH( *
anHH+ -
.HH- .
idHH. 0
==HH1 3
idActorNegocioHH4 B
)HHB C
;HHC D
}II 
catchJJ 
(JJ 
	ExceptionJJ 
eJJ 
)JJ 
{KK 
throwLL 
eLL 
;LL 
}MM 
}NN 	
publicQQ #
Parametro_actor_negocioQQ &@
4ObtenerParametroCentroDeAtencionParaObtencionPreciosQQ' [
(QQ[ \
intQQ\ _&
idEstablecimientoComencialQQ` z
)QQz {
{RR 	
SigescomEntitiesSS 
_dbSS  
=SS! "
newSS# &
SigescomEntitiesSS' 7
(SS7 8
)SS8 9
;SS9 :
returnTT 
_dbTT 
.TT #
Parametro_actor_negocioTT .
.TT. /
FirstOrDefaultTT/ =
(TT= >
pcnTT> A
=>TTB D
pcnTTE H
.TTH I
id_actor_negocioTTI Y
==TTY [&
idEstablecimientoComencialTT\ v
&&TTw y
pcnTTz }
.TT} ~
id_parametro	TT~ ä
==
TTã ç
MaestroSettings
TTé ù
.
TTù û
Default
TTû •
.
TT• ¶M
?IdDetalleMaestroParametroIdCentroDeAtencionParaObtencionPrecios
TT¶ Â
)
TTÂ Ê
;
TTÊ Á
}UU 	
publicVV #
Parametro_actor_negocioVV &@
4ObtenerParametroCentroDeAtencionParaObtencionDeStockVV' [
(VV[ \
intVV\ _&
idEstablecimientoComencialVV` z
)VVz {
{WW 	
SigescomEntitiesXX 
_dbXX  
=XX! "
newXX# &
SigescomEntitiesXX' 7
(XX7 8
)XX8 9
;XX9 :
returnYY 
_dbYY 
.YY #
Parametro_actor_negocioYY .
.YY. /
FirstOrDefaultYY/ =
(YY= >
pcnYY> A
=>YYB D
pcnYYE H
.YYH I
id_actor_negocioYYI Y
==YYZ \&
idEstablecimientoComencialYY] w
&&YYx z
pcnYY{ ~
.YY~ 
id_parametro	YY ã
==
YYå é
MaestroSettings
YYè û
.
YYû ü
Default
YYü ¶
.
YY¶ ßK
=IdDetalleMaestroParametroIdCentroDeAtencionParaObtencionStock
YYß ‰
)
YY‰ Â
;
YYÂ Ê
}ZZ 	
}[[ 
}\\ ¥
XD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\Establecimientos\Sede_Datos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
." #
Establecimientos# 3
{ 
public		 

partial		 
class		 

Sede_Datos		 #
:		$ %
ISede_Repositorio		& 7
{

 
} 
} ŒÚ
cD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\Establecimientos\Establecimiento_Datos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
." #
Establecimientos# 3
{ 
public 

partial 
class !
Establecimiento_Datos .
:/ 0(
IEstablecimiento_Repositorio1 M
{ 
public 
IEnumerable 
< $
EstablecimientoComercial 3
>3 46
*ObtenerEstablecimientosComercialesVigentes5 _
(_ `
)` a
{ 	
int 
[ 
] 
idsRoles 
= 
new 
int  #
[# $
]$ %
{% &
ActorSettings' 4
.4 5
Default5 <
.< =
IdRolSucursal= J
,J K
ActorSettingsL Y
.Y Z
DefaultZ a
.a b
	IdRolSedeb k
}k l
;l m
SigescomEntities 
_db  
=! "
new# &
SigescomEntities' 7
(7 8
)8 9
;9 :
return 
_db 
. 
Actor_negocio $
. 
Where 
( 
an 
=> 
idsRoles %
.% &
Contains& .
(. /
an/ 1
.1 2
id_rol2 8
)8 9
&&: <
an= ?
.? @

es_vigente@ J
==K M
trueN R
)R S
.S T
SelectT Z
(Z [
an[ ]
=>^ `
newa d$
EstablecimientoComerciale }
(} ~
)~ 
{
Ä Å
Id 
= 
an 
. 
id 
, 
IdActor 
= 
an  
.  !
id_actor! )
,) *
Codigo 
= 
an 
.  
codigo_negocio  .
,. /
DocumentoIdentidad &
=' (
an) +
.+ ,
Actor, 1
.1 2&
numero_documento_identidad2 L
,L M
IdEstadoLegal !
=" #
an$ &
.& '
Actor' ,
., -
id_estado_legal- <
,< =
IdClaseActor  
=! "
an# %
.% &
Actor& +
.+ ,
id_clase_actor, :
,: ;
IdTipoPersona !
=" #
an$ &
.& '
Actor' ,
., -
id_tipo_actor- :
,: ;

ClaseActor 
=  
an! #
.# $
Actor$ )
.) *
Clase_actor* 5
.5 6
nombre6 <
,< =
TipoPersona 
=  !
an" $
.$ %
Actor% *
.* +

Tipo_actor+ 5
.5 6
nombre6 <
,< =
Nombre 
= 
an 
.  
Actor  %
.% &
primer_nombre& 3
,3 4
NombreComercial #
=$ %
an& (
.( )
Actor) .
.. /
segundo_nombre/ =
,= >
NombreInterno   !
=  " #
an  $ &
.  & '
Actor  ' ,
.  , -
tercer_nombre  - :
}!! 
)!! 
;!! 
}"" 	
public$$ 
IEnumerable$$ 
<$$ -
!EstablecimientoComercialExtendido$$ <
>$$< =@
4ObtenerEstablecimientosComercialesExtendidosVigentes$$> r
($$r s
)$$s t
{%% 	
int&& 
[&& 
]&& 
idsRoles&& 
=&& 
new&&  
int&&! $
[&&$ %
]&&% &
{&&' (
ActorSettings&&) 6
.&&6 7
Default&&7 >
.&&> ?
IdRolSucursal&&? L
,&&L M
ActorSettings&&N [
.&&[ \
Default&&\ c
.&&c d
	IdRolSede&&d m
}&&n o
;&&o p
SigescomEntities'' 
_db''  
=''! "
new''# &
SigescomEntities''' 7
(''7 8
)''8 9
;''9 :
var(( 
establecimientos((  
=((  !
_db((" %
.((% &
Actor_negocio((& 3
.)) 
Where)) 
()) 
an)) 
=>)) 
idsRoles)) %
.))% &
Contains))& .
()). /
an))/ 1
.))1 2
id_rol))2 8
)))8 9
&&)): <
an))= ?
.))? @

es_vigente))@ J
==))K M
true))N R
)))R S
.))S T
Select))T Z
())Z [
an))[ ]
=>))^ `
new))a d.
!EstablecimientoComercialExtendido	))e Ü
(
))Ü á
)
))á à
{** 
Id++ 
=++ 
an++ 
.++ 
id++ 
,++ 
IdActor,, 
=,, 
an,,  
.,,  !
id_actor,,! )
,,,) *
Codigo-- 
=-- 
an-- 
.--  
codigo_negocio--  .
,--. /
DocumentoIdentidad.. &
=..' (
an..) +
...+ ,
Actor.., 1
...1 2&
numero_documento_identidad..2 L
,..L M
IdEstadoLegal// !
=//" #
an//$ &
.//& '
Actor//' ,
.//, -
id_estado_legal//- <
,//< =
IdClaseActor00  
=00! "
an00# %
.00% &
Actor00& +
.00+ ,
id_clase_actor00, :
,00: ;
IdTipoPersona11 !
=11" #
an11$ &
.11& '
Actor11' ,
.11, -
id_tipo_actor11- :
,11: ;

ClaseActor22 
=22  
an22! #
.22# $
Actor22$ )
.22) *
Clase_actor22* 5
.225 6
nombre226 <
,22< =
TipoPersona33 
=33  !
an33" $
.33$ %
Actor33% *
.33* +

Tipo_actor33+ 5
.335 6
nombre336 <
,33< =
Nombre44 
=44 
an44 
.44  
Actor44  %
.44% &
primer_nombre44& 3
,443 4
NombreComercial55 #
=55$ %
an55& (
.55( )
Actor55) .
.55. /
segundo_nombre55/ =
,55= >
NombreInterno66 !
=66" #
an66$ &
.66& '
Actor66' ,
.66, -
tercer_nombre66- :
,66: ;
EsSede77 
=77 
an77 
.77  
id_rol77  &
==77' )
ActorSettings77* 7
.777 8
Default778 ?
.77? @
	IdRolSede77@ I
,77I J

EsSucursal88 
=88  
an88! #
.88# $
id_rol88$ *
==88+ -
ActorSettings88. ;
.88; <
Default88< C
.88C D
IdRolSucursal88D Q
,88Q R
ExtensionJson99 !
=99" #
an99$ &
.99& '
extension_json99' 5
,995 6#
InformacionPublicitaria:: +
=::, -
an::. 0
.::0 1
Actor::1 6
.::6 7&
informacion_multiproposito::7 Q
??::Q S
$str::S U
,::U V
Telefono;; 
=;; 
an;; !
.;;! "
Actor;;" '
.;;' (
telefono;;( 0
,;;0 1
Correo<< 
=<< 
an<< 
.<<  
Actor<<  %
.<<% &
correo<<& ,
,<<, -
DomicilioFiscal== #
===$ %
new==& )

Direccion_==* 4
(==4 5
)==5 6
{==7 8
Id==9 ;
===< =
an==> @
.==@ A
Actor==A F
.==F G
	Direccion==G P
.==P Q
FirstOrDefault==Q _
(==_ `
)==` a
.==a b
id==b d
,==d e
Pais==f j
===k l
new==m p
ItemGenerico==q }
(==} ~
)==~ 
{
==Ä Å
Id
==Ç Ñ
=
==Ö Ü
an
==á â
.
==â ä
Actor
==ä è
.
==è ê
	Direccion
==ê ô
.
==ô ö
FirstOrDefault
==ö ®
(
==® ©
)
==© ™
.
==™ ´
Detalle_maestro1
==´ ª
.
==ª º
id
==º æ
,
==æ ø
Nombre
==¿ ∆
=
==« »
an
==… À
.
==À Ã
Actor
==Ã —
.
==— “
	Direccion
==“ €
.
==€ ‹
FirstOrDefault
==‹ Í
(
==Í Î
)
==Î Ï
.
==Ï Ì
Detalle_maestro1
==Ì ˝
.
==˝ ˛
nombre
==˛ Ñ
}
==Ö Ü
,
==Ü á
Ubigeo
==à é
=
==è ê
new
==ë î
ItemGenerico
==ï °
(
==° ¢
)
==¢ £
{
==§ •
Id
==¶ ®
=
==© ™
an
==´ ≠
.
==≠ Æ
Actor
==Æ ≥
.
==≥ ¥
	Direccion
==¥ Ω
.
==Ω æ
FirstOrDefault
==æ Ã
(
==Ã Õ
)
==Õ Œ
.
==Œ œ
Ubigeo
==œ ’
.
==’ ÷
id
==÷ ÿ
,
==ÿ Ÿ
Nombre
==⁄ ‡
=
==· ‚
an
==„ Â
.
==Â Ê
Actor
==Ê Î
.
==Î Ï
	Direccion
==Ï ı
.
==ı ˆ
FirstOrDefault
==ˆ Ñ
(
==Ñ Ö
)
==Ö Ü
.
==Ü á
Ubigeo
==á ç
.
==ç é
descripcion_larga
==é ü
}
==† °
,
==° ¢
Detalle
==£ ™
=
==´ ¨
an
==≠ Ø
.
==Ø ∞
Actor
==∞ µ
.
==µ ∂
	Direccion
==∂ ø
.
==ø ¿
FirstOrDefault
==¿ Œ
(
==Œ œ
)
==œ –
.
==– —
detalle
==— ÿ
}
==Ÿ ⁄
,
==⁄ €-
!CodigoSunatTipoDocumentoIdentidad>> 5
=>>6 7
an>>8 :
.>>: ;
Actor>>; @
.>>@ A
Detalle_maestro>>A P
.>>P Q
codigo>>Q W
,>>W X(
CodigoTipoDocumentoIdentidad?? 0
=??1 2
an??3 5
.??5 6
Actor??6 ;
.??; <
Detalle_maestro??< K
.??K L
valor??L Q
,??Q R
NombreTipoDocumento@@ '
=@@( )
an@@* ,
.@@, -
Actor@@- 2
.@@2 3
Detalle_maestro@@3 B
.@@B C
nombre@@C I
}BB 
)BB 
;BB  
EstablecerParametrosDD  
(DD  !
establecimientosDD! 1
,DD1 2
_dbDD3 6
)DD6 7
;DD7 8
returnEE 
establecimientosEE #
;EE# $
}FF 	
publicLL 
IEnumerableLL 
<LL 
ItemGenericoLL '
>LL' (H
<ObtenerEstablecimientosComercialesVigentesComoItemsGenericosLL) e
(LLe f
)LLf g
{MM 	
intNN 
[NN 
]NN 
idsRolesNN 
=NN 
newNN  
intNN! $
[NN$ %
]NN% &
{NN' (
ActorSettingsNN) 6
.NN6 7
DefaultNN7 >
.NN> ?
IdRolSucursalNN? L
,NNL M
ActorSettingsNNN [
.NN[ \
DefaultNN\ c
.NNc d
	IdRolSedeNNd m
}NNn o
;NNo p
SigescomEntitiesOO 
_dbOO  
=OO! "
newOO# &
SigescomEntitiesOO' 7
(OO7 8
)OO8 9
;OO9 :
returnPP 
_dbPP 
.PP 
Actor_negocioPP $
.QQ 
WhereQQ 
(QQ 
anQQ 
=>QQ 
idsRolesQQ %
.QQ% &
ContainsQQ& .
(QQ. /
anQQ/ 1
.QQ1 2
id_rolQQ2 8
)QQ8 9
&&QQ: <
anQQ= ?
.QQ? @

es_vigenteQQ@ J
==QQK M
trueQQN R
)QQR S
.QQS T
SelectQQT Z
(QQZ [
anQQ[ ]
=>QQ^ `
newQQa d
ItemGenericoQQe q
{QQr s
IdQQt v
=QQw x
anQQy {
.QQ{ |
idQQ| ~
,QQ~ 
Nombre
QQÄ Ü
=
QQá à
an
QQâ ã
.
QQã å
Actor
QQå ë
.
QQë í
tercer_nombre
QQí ü
}
QQ† °
)
QQ° ¢
;
QQ¢ £
}RR 	
publicTT $
EstablecimientoComercialTT '+
ObtenerEstablecimientoComercialTT( G
(TTG H
intTTH K
idTTL N
)TTN O
{UU 	
SigescomEntitiesVV 
_dbVV  
=VV! "
newVV# &
SigescomEntitiesVV' 7
(VV7 8
)VV8 9
;VV9 :
returnWW 
_dbWW 
.WW 
Actor_negocioWW $
.XX 
WhereXX 
(XX 
anXX 
=>XX 
anXX 
.XX  
idXX  "
==XX# %
idXX& (
)XX( )
.XX) *
SelectXX* 0
(XX0 1
anXX1 3
=>XX4 6
newXX7 :$
EstablecimientoComercialXX; S
(XXS T
)XXT U
{YY 
Id[[ 
=[[ 
an[[ 
.[[ 
id[[ 
,[[ 
IdActor\\ 
=\\ 
an\\  
.\\  !
id_actor\\! )
,\\) *
Codigo]] 
=]] 
an]] 
.]]  
codigo_negocio]]  .
,]]. /
DocumentoIdentidad^^ &
=^^' (
an^^) +
.^^+ ,
Actor^^, 1
.^^1 2&
numero_documento_identidad^^2 L
,^^L M
IdEstadoLegal__ !
=__" #
an__$ &
.__& '
Actor__' ,
.__, -
id_estado_legal__- <
,__< =
IdClaseActor``  
=``! "
an``# %
.``% &
Actor``& +
.``+ ,
id_clase_actor``, :
,``: ;
IdTipoPersonaaa !
=aa" #
anaa$ &
.aa& '
Actoraa' ,
.aa, -
id_tipo_actoraa- :
,aa: ;

ClaseActorbb 
=bb  
anbb! #
.bb# $
Actorbb$ )
.bb) *
Clase_actorbb* 5
.bb5 6
nombrebb6 <
,bb< =
TipoPersonacc 
=cc  !
ancc" $
.cc$ %
Actorcc% *
.cc* +

Tipo_actorcc+ 5
.cc5 6
nombrecc6 <
,cc< =
Nombredd 
=dd 
andd 
.dd  
Actordd  %
.dd% &
primer_nombredd& 3
,dd3 4
NombreComercialee #
=ee$ %
anee& (
.ee( )
Actoree) .
.ee. /
segundo_nombreee/ =
,ee= >
NombreInternoff !
=ff" #
anff$ &
.ff& '
Actorff' ,
.ff, -
tercer_nombreff- :
,ff: ;
}gg 
)gg 
.gg 
FirstOrDefaultgg !
(gg! "
)gg" #
;gg# $
}hh 	
publicii 
ItemGenericoii ;
/ObtenerEstablecimientoComercialComoItemGenericoii K
(iiK L
intiiL O
idiiP R
)iiR S
{jj 	
SigescomEntitieskk 
_dbkk  
=kk! "
newkk# &
SigescomEntitieskk' 7
(kk7 8
)kk8 9
;kk9 :
returnll 
_dbll 
.ll 
Actor_negocioll $
.mm 
Wheremm 
(mm 
anmm 
=>mm 
anmm 
.mm  
idmm  "
==mm# %
idmm% '
)mm' (
.mm( )
Selectmm) /
(mm/ 0
anmm0 2
=>mm3 5
newmm6 9
ItemGenericomm: F
(mmF G
)mmG H
{nn 
Idpp 
=pp 
anpp 
.pp 
idpp 
,pp 
Codigoqq 
=qq 
anqq 
.qq  
codigo_negocioqq  .
,qq. /
Nombrerr 
=rr 
anrr 
.rr  
Actorrr  %
.rr% &
primer_nombrerr& 3
}tt 
)tt 
.tt 
FirstOrDefaulttt !
(tt! "
)tt" #
;tt# $
}uu 	
publicww -
!EstablecimientoComercialExtendidoww 04
(ObtenerEstablecimientoComercialExtendidoww1 Y
(wwY Z
intwwZ ]
idww^ `
)ww` a
{xx 	
SigescomEntitiesyy 
_dbyy  
=yy! "
newyy# &
SigescomEntitiesyy' 7
(yy7 8
)yy8 9
;yy9 :
varzz 
establecimientozz 
=zz  
_dbzz! $
.zz$ %
Actor_negociozz% 2
.{{ 
Where{{ 
({{ 
an{{ 
=>{{ 
an{{ 
.{{  
id{{  "
=={{# %
id{{& (
){{( )
.{{) *
Select{{* 0
({{0 1
an{{1 3
=>{{4 6
new{{7 :-
!EstablecimientoComercialExtendido{{; \
({{\ ]
){{] ^
{|| 
Id}} 
=}} 
an}} 
.}} 
id}} 
,}} 
IdActor~~ 
=~~ 
an~~  
.~~  !
id_actor~~! )
,~~) *
Codigo 
= 
an 
.  
codigo_negocio  .
,. / 
DocumentoIdentidad
ÄÄ &
=
ÄÄ' (
an
ÄÄ) +
.
ÄÄ+ ,
Actor
ÄÄ, 1
.
ÄÄ1 2(
numero_documento_identidad
ÄÄ2 L
,
ÄÄL M
IdEstadoLegal
ÅÅ !
=
ÅÅ" #
an
ÅÅ$ &
.
ÅÅ& '
Actor
ÅÅ' ,
.
ÅÅ, -
id_estado_legal
ÅÅ- <
,
ÅÅ< =
IdClaseActor
ÇÇ  
=
ÇÇ! "
an
ÇÇ# %
.
ÇÇ% &
Actor
ÇÇ& +
.
ÇÇ+ ,
id_clase_actor
ÇÇ, :
,
ÇÇ: ;
IdTipoPersona
ÉÉ !
=
ÉÉ" #
an
ÉÉ$ &
.
ÉÉ& '
Actor
ÉÉ' ,
.
ÉÉ, -
id_tipo_actor
ÉÉ- :
,
ÉÉ: ;
Nombre
ÑÑ 
=
ÑÑ 
an
ÑÑ 
.
ÑÑ  
Actor
ÑÑ  %
.
ÑÑ% &
primer_nombre
ÑÑ& 3
,
ÑÑ3 4

ClaseActor
ÖÖ 
=
ÖÖ  
an
ÖÖ! #
.
ÖÖ# $
Actor
ÖÖ$ )
.
ÖÖ) *
Clase_actor
ÖÖ* 5
.
ÖÖ5 6
nombre
ÖÖ6 <
,
ÖÖ< =
TipoPersona
ÜÜ 
=
ÜÜ  !
an
ÜÜ" $
.
ÜÜ$ %
Actor
ÜÜ% *
.
ÜÜ* +

Tipo_actor
ÜÜ+ 5
.
ÜÜ5 6
nombre
ÜÜ6 <
,
ÜÜ< =
NombreComercial
áá #
=
áá$ %
an
áá& (
.
áá( )
Actor
áá) .
.
áá. /
segundo_nombre
áá/ =
,
áá= >
NombreInterno
àà !
=
àà" #
an
àà$ &
.
àà& '
Actor
àà' ,
.
àà, -
tercer_nombre
àà- :
,
àà: ;
EsSede
ââ 
=
ââ 
an
ââ 
.
ââ  
id_rol
ââ  &
==
ââ' )
ActorSettings
ââ* 7
.
ââ7 8
Default
ââ8 ?
.
ââ? @
	IdRolSede
ââ@ I
,
ââI J

EsSucursal
ää 
=
ää  
an
ää! #
.
ää# $
id_rol
ää$ *
==
ää+ -
ActorSettings
ää. ;
.
ää; <
Default
ää< C
.
ääC D
IdRolSucursal
ääD Q
,
ääQ R
ExtensionJson
ãã !
=
ãã! "
an
ãã# %
.
ãã% &
extension_json
ãã& 4
,
ãã4 5%
InformacionPublicitaria
åå +
=
åå, -
an
åå. 0
.
åå0 1
Actor
åå1 6
.
åå6 7(
informacion_multiproposito
åå7 Q
??
ååR T
$str
ååU W
,
ååW X
Telefono
çç 
=
çç 
an
çç !
.
çç! "
Actor
çç" '
.
çç' (
telefono
çç( 0
,
çç0 1
Correo
éé 
=
éé 
an
éé 
.
éé  
Actor
éé  %
.
éé% &
correo
éé& ,
,
éé, -
DomicilioFiscal
èè #
=
èè$ %
new
èè& )

Direccion_
èè* 4
(
èè4 5
)
èè5 6
{
èè7 8
Id
èè9 ;
=
èè< =
an
èè> @
.
èè@ A
Actor
èèA F
.
èèF G
	Direccion
èèG P
.
èèP Q
FirstOrDefault
èèQ _
(
èè_ `
)
èè` a
.
èèa b
id
èèb d
,
èèd e
Pais
èèf j
=
èèk l
new
èèm p
ItemGenerico
èèq }
(
èè} ~
)
èè~ 
{èèÄ Å
IdèèÇ Ñ
=èèÖ Ü
anèèá â
.èèâ ä
Actorèèä è
.èèè ê
	Direccionèèê ô
.èèô ö
FirstOrDefaultèèö ®
(èè® ©
)èè© ™
.èè™ ´ 
Detalle_maestro1èè´ ª
.èèª º
idèèº æ
,èèæ ø
Nombreèè¿ ∆
=èè« »
anèè… À
.èèÀ Ã
ActorèèÃ —
.èè— “
	Direccionèè“ €
.èè€ ‹
FirstOrDefaultèè‹ Í
(èèÍ Î
)èèÎ Ï
.èèÏ Ì 
Detalle_maestro1èèÌ ˝
.èè˝ ˛
nombreèè˛ Ñ
,èèÑ Ö
ValorèèÜ ã
=èèå ç
$strèèé ê
}èèë í
,èèí ì
Ubigeoèèî ö
=èèõ ú
newèèù †
ItemGenericoèè° ≠
(èè≠ Æ
)èèÆ Ø
{èè∞ ±
Idèè≤ ¥
=èèµ ∂
anèè∑ π
.èèπ ∫
Actorèè∫ ø
.èèø ¿
	Direccionèè¿ …
.èè…  
FirstOrDefaultèè  ÿ
(èèÿ Ÿ
)èèŸ ⁄
.èè⁄ €
Ubigeoèè€ ·
.èè· ‚
idèè‚ ‰
,èè‰ Â
NombreèèÊ Ï
=èèÌ Ó
anèèÔ Ò
.èèÒ Ú
ActorèèÚ ˜
.èè˜ ¯
	Direccionèè¯ Å
.èèÅ Ç
FirstOrDefaultèèÇ ê
(èèê ë
)èèë í
.èèí ì
Ubigeoèèì ô
.èèô ö!
descripcion_largaèèö ´
,èè´ ¨
Valorèè¨ ±
=èè± ≤
anèè≥ µ
.èèµ ∂
Actorèè∂ ª
.èèª º
	Direccionèèº ≈
.èè≈ ∆
FirstOrDefaultèè∆ ‘
(èè‘ ’
)èè’ ÷
.èè÷ ◊
Ubigeoèè◊ ›
.èè› ﬁ!
descripcion_cortaèèﬁ Ô
}èè Ò
,èèÒ Ú
DetalleèèÛ ˙
=èè˚ ¸
anèè˝ ˇ
.èèˇ Ä
ActorèèÄ Ö
.èèÖ Ü
	DireccionèèÜ è
.èèè ê
FirstOrDefaultèèê û
(èèû ü
)èèü †
.èè† °
detalleèè° ®
}èè© ™
,èè™ ´/
!CodigoSunatTipoDocumentoIdentidad
êê 5
=
êê6 7
an
êê8 :
.
êê: ;
Actor
êê; @
.
êê@ A
Detalle_maestro
êêA P
.
êêP Q
codigo
êêQ W
,
êêW X*
CodigoTipoDocumentoIdentidad
ëë 0
=
ëë1 2
an
ëë3 5
.
ëë5 6
Actor
ëë6 ;
.
ëë; <
Detalle_maestro
ëë< K
.
ëëK L
valor
ëëL Q
,
ëëQ R!
NombreTipoDocumento
íí '
=
íí( )
an
íí* ,
.
íí, -
Actor
íí- 2
.
íí2 3
Detalle_maestro
íí3 B
.
ííB C
nombre
ííC I
}
ìì 
)
ìì 
.
ìì 
FirstOrDefault
ìì !
(
ìì! "
)
ìì" #
;
ìì# $"
EstablecerParametros
ïï  
(
ïï  !
establecimiento
ïï! 0
,
ïï0 1
_db
ïï2 5
)
ïï5 6
;
ïï6 7
return
ññ 
establecimiento
ññ "
;
ññ" #
}
óó 	
public
ôô 6
(EstablecimientoComercialExtendidoConLogo
ôô 7=
/ObtenerEstablecimientoComercialExtendidoConLogo
ôô8 g
(
ôôg h
int
ôôh k
id
ôôl n
)
ôôn o
{
öö 	
SigescomEntities
õõ 
_db
õõ  
=
õõ! "
new
õõ# &
SigescomEntities
õõ' 7
(
õõ7 8
)
õõ8 9
;
õõ9 :
var
úú 
establecimiento
úú 
=
úú  !
_db
úú" %
.
úú% &
Actor_negocio
úú& 3
.
ùù 
Where
ùù 
(
ùù 
an
ùù 
=>
ùù 
an
ùù 
.
ùù  
id
ùù  "
==
ùù# %
id
ùù& (
)
ùù( )
.
ùù) *
Select
ùù* 0
(
ùù0 1
an
ùù1 3
=>
ùù4 6
new
ùù7 :6
(EstablecimientoComercialExtendidoConLogo
ùù; c
(
ùùc d
)
ùùd e
{
ûû 
Id
üü 
=
üü 
an
üü 
.
üü 
id
üü 
,
üü 
IdActor
†† 
=
†† 
an
††  
.
††  !
id_actor
††! )
,
††) *
Codigo
°° 
=
°° 
an
°° 
.
°°  
codigo_negocio
°°  .
,
°°. / 
DocumentoIdentidad
¢¢ &
=
¢¢' (
an
¢¢) +
.
¢¢+ ,
Actor
¢¢, 1
.
¢¢1 2(
numero_documento_identidad
¢¢2 L
,
¢¢L M
IdEstadoLegal
££ !
=
££" #
an
££$ &
.
££& '
Actor
££' ,
.
££, -
id_estado_legal
££- <
,
££< =
IdClaseActor
§§  
=
§§! "
an
§§# %
.
§§% &
Actor
§§& +
.
§§+ ,
id_clase_actor
§§, :
,
§§: ;
IdTipoPersona
•• !
=
••" #
an
••$ &
.
••& '
Actor
••' ,
.
••, -
id_tipo_actor
••- :
,
••: ;

ClaseActor
¶¶ 
=
¶¶  
an
¶¶! #
.
¶¶# $
Actor
¶¶$ )
.
¶¶) *
Clase_actor
¶¶* 5
.
¶¶5 6
nombre
¶¶6 <
,
¶¶< =
TipoPersona
ßß 
=
ßß  !
an
ßß" $
.
ßß$ %
Actor
ßß% *
.
ßß* +

Tipo_actor
ßß+ 5
.
ßß5 6
nombre
ßß6 <
,
ßß< =
Nombre
®® 
=
®® 
an
®® 
.
®®  
Actor
®®  %
.
®®% &
primer_nombre
®®& 3
,
®®3 4
NombreComercial
©© #
=
©©$ %
an
©©& (
.
©©( )
Actor
©©) .
.
©©. /
segundo_nombre
©©/ =
,
©©= >
NombreInterno
™™ !
=
™™" #
an
™™$ &
.
™™& '
Actor
™™' ,
.
™™, -
tercer_nombre
™™- :
,
™™: ;
EsSede
´´ 
=
´´ 
an
´´ 
.
´´  
id_rol
´´  &
==
´´' )
ActorSettings
´´* 7
.
´´7 8
Default
´´8 ?
.
´´? @
	IdRolSede
´´@ I
,
´´I J

EsSucursal
¨¨ 
=
¨¨  
an
¨¨! #
.
¨¨# $
id_rol
¨¨$ *
==
¨¨+ -
ActorSettings
¨¨. ;
.
¨¨; <
Default
¨¨< C
.
¨¨C D
IdRolSucursal
¨¨D Q
,
¨¨Q R
ExtensionJson
≠≠ !
=
≠≠" #
an
≠≠$ &
.
≠≠& '
extension_json
≠≠' 5
,
≠≠5 6%
InformacionPublicitaria
ÆÆ +
=
ÆÆ, -
an
ÆÆ. 0
.
ÆÆ0 1
Actor
ÆÆ1 6
.
ÆÆ6 7(
informacion_multiproposito
ÆÆ7 Q
??
ÆÆR T
$str
ÆÆU W
,
ÆÆW X
Telefono
ØØ 
=
ØØ 
an
ØØ !
.
ØØ! "
Actor
ØØ" '
.
ØØ' (
telefono
ØØ( 0
,
ØØ0 1
Correo
∞∞ 
=
∞∞ 
an
∞∞ 
.
∞∞  
Actor
∞∞  %
.
∞∞% &
correo
∞∞& ,
,
∞∞, -
	Domicilio
±± 
=
±± 
an
±±  "
.
±±" #
Actor
±±# (
.
±±( )
	Direccion
±±) 2
.
±±2 3
FirstOrDefault
±±3 A
(
±±A B
)
±±B C
,
±±C D
DomicilioFiscal
≤≤ #
=
≤≤$ %
new
≤≤& )

Direccion_
≤≤* 4
(
≤≤4 5
)
≤≤5 6
{
≤≤7 8
Id
≤≤9 ;
=
≤≤< =
an
≤≤> @
.
≤≤@ A
Actor
≤≤A F
.
≤≤F G
	Direccion
≤≤G P
.
≤≤P Q
FirstOrDefault
≤≤Q _
(
≤≤_ `
)
≤≤` a
.
≤≤a b
id
≤≤b d
,
≤≤d e
Pais
≤≤f j
=
≤≤k l
new
≤≤m p
ItemGenerico
≤≤q }
(
≤≤} ~
)
≤≤~ 
{≤≤Ä Å
Id≤≤Ç Ñ
=≤≤Ö Ü
an≤≤á â
.≤≤â ä
Actor≤≤ä è
.≤≤è ê
	Direccion≤≤ê ô
.≤≤ô ö
FirstOrDefault≤≤ö ®
(≤≤® ©
)≤≤© ™
.≤≤™ ´ 
Detalle_maestro1≤≤´ ª
.≤≤ª º
id≤≤º æ
,≤≤æ ø
Nombre≤≤¿ ∆
=≤≤« »
an≤≤… À
.≤≤À Ã
Actor≤≤Ã —
.≤≤— “
	Direccion≤≤“ €
.≤≤€ ‹
FirstOrDefault≤≤‹ Í
(≤≤Í Î
)≤≤Î Ï
.≤≤Ï Ì 
Detalle_maestro1≤≤Ì ˝
.≤≤˝ ˛
nombre≤≤˛ Ñ
}≤≤Ö Ü
,≤≤Ü á
Ubigeo≤≤à é
=≤≤è ê
new≤≤ë î
ItemGenerico≤≤ï °
(≤≤° ¢
)≤≤¢ £
{≤≤§ •
Id≤≤¶ ®
=≤≤© ™
an≤≤´ ≠
.≤≤≠ Æ
Actor≤≤Æ ≥
.≤≤≥ ¥
	Direccion≤≤¥ Ω
.≤≤Ω æ
FirstOrDefault≤≤æ Ã
(≤≤Ã Õ
)≤≤Õ Œ
.≤≤Œ œ
Ubigeo≤≤œ ’
.≤≤’ ÷
id≤≤÷ ÿ
,≤≤ÿ Ÿ
Nombre≤≤⁄ ‡
=≤≤· ‚
an≤≤„ Â
.≤≤Â Ê
Actor≤≤Ê Î
.≤≤Î Ï
	Direccion≤≤Ï ı
.≤≤ı ˆ
FirstOrDefault≤≤ˆ Ñ
(≤≤Ñ Ö
)≤≤Ö Ü
.≤≤Ü á
Ubigeo≤≤á ç
.≤≤ç é!
descripcion_larga≤≤é ü
}≤≤† °
,≤≤° ¢
Detalle≤≤£ ™
=≤≤´ ¨
an≤≤≠ Ø
.≤≤Ø ∞
Actor≤≤∞ µ
.≤≤µ ∂
	Direccion≤≤∂ ø
.≤≤ø ¿
FirstOrDefault≤≤¿ Œ
(≤≤Œ œ
)≤≤œ –
.≤≤– —
detalle≤≤— ÿ
}≤≤Ÿ ⁄
,≤≤⁄ €/
!CodigoSunatTipoDocumentoIdentidad
≥≥ 5
=
≥≥6 7
an
≥≥8 :
.
≥≥: ;
Actor
≥≥; @
.
≥≥@ A
Detalle_maestro
≥≥A P
.
≥≥P Q
codigo
≥≥Q W
,
≥≥W X*
CodigoTipoDocumentoIdentidad
¥¥ 0
=
¥¥1 2
an
¥¥3 5
.
¥¥5 6
Actor
¥¥6 ;
.
¥¥; <
Detalle_maestro
¥¥< K
.
¥¥K L
valor
¥¥L Q
,
¥¥Q R!
NombreTipoDocumento
µµ '
=
µµ( )
an
µµ* ,
.
µµ, -
Actor
µµ- 2
.
µµ2 3
Detalle_maestro
µµ3 B
.
µµB C
nombre
µµC I
,
µµI J
IdLogo
∂∂ 
=
∂∂ 
an
∂∂ 
.
∂∂  
Actor
∂∂  %
.
∂∂% &
id_foto
∂∂& -
,
∂∂- .
Logo
∑∑ 
=
∑∑ 
an
∑∑ 
.
∑∑ 
Actor
∑∑ #
.
∑∑# $
Foto
∑∑$ (
.
∑∑( )
imagen
∑∑) /
}
ππ 
)
ππ 
.
ππ 
FirstOrDefault
ππ !
(
ππ! "
)
ππ" #
;
ππ# $"
EstablecerParametros
ªª  
(
ªª  !
establecimiento
ªª! 0
,
ªª0 1
_db
ªª2 5
)
ªª5 6
;
ªª6 7
return
ºº 
establecimiento
ºº "
;
ºº" #
}
ΩΩ 	
public
ææ 
Modelo
ææ 
.
ææ 
ClasesNegocio
ææ #
.
ææ# $
Core
ææ$ (
.
ææ( )
Establecimientos
ææ) 9
.
ææ9 :-
EstablecimientoComercialConLogo
ææ: Y5
&ObtenerEstablecimientoComercialConLogoææZ Ä
(ææÄ Å
intææÅ Ñ!
idEstablecimientoææÖ ñ
)ææñ ó
{
øø 	
try
¿¿ 
{
¡¡ 
SigescomEntities
¬¬  
_db
¬¬! $
=
¬¬% &
new
¬¬' *
SigescomEntities
¬¬+ ;
(
¬¬; <
)
¬¬< =
;
¬¬= >
return
√√ 
_db
√√ 
.
√√ 
Actor_negocio
√√ (
.
√√( )
Where
√√) .
(
√√. /
an
√√/ 1
=>
√√2 4
an
√√5 7
.
√√7 8
id
√√8 :
==
√√; =
idEstablecimiento
√√> O
)
√√O P
.
√√P Q
Select
√√Q W
(
√√W X
an
√√X Z
=>
√√[ ]
new
√√^ a
Modelo
√√b h
.
√√h i
ClasesNegocio
√√i v
.
√√v w
Core
√√w {
.
√√{ |
Establecimientos√√| å
.√√å ç/
EstablecimientoComercialConLogo√√ç ¨
(√√¨ ≠
)√√≠ Æ
{
ƒƒ 
Id
≈≈ 
=
≈≈ 
an
≈≈ 
.
≈≈ 
id
≈≈ 
,
≈≈ 
IdActor
∆∆ 
=
∆∆ 
an
∆∆  
.
∆∆  !
id_actor
∆∆! )
,
∆∆) *
Codigo
«« 
=
«« 
an
«« 
.
««  
codigo_negocio
««  .
,
««. / 
DocumentoIdentidad
»» &
=
»»' (
an
»») +
.
»»+ ,
Actor
»», 1
.
»»1 2(
numero_documento_identidad
»»2 L
,
»»L M
IdEstadoLegal
…… !
=
……" #
an
……$ &
.
……& '
Actor
……' ,
.
……, -
id_estado_legal
……- <
,
……< =
IdClaseActor
    
=
  ! "
an
  # %
.
  % &
Actor
  & +
.
  + ,
id_clase_actor
  , :
,
  : ;
IdTipoPersona
ÀÀ !
=
ÀÀ" #
an
ÀÀ$ &
.
ÀÀ& '
Actor
ÀÀ' ,
.
ÀÀ, -
id_tipo_actor
ÀÀ- :
,
ÀÀ: ;

ClaseActor
ÃÃ 
=
ÃÃ  
an
ÃÃ! #
.
ÃÃ# $
Actor
ÃÃ$ )
.
ÃÃ) *
Clase_actor
ÃÃ* 5
.
ÃÃ5 6
nombre
ÃÃ6 <
,
ÃÃ< =
TipoPersona
ÕÕ 
=
ÕÕ  !
an
ÕÕ" $
.
ÕÕ$ %
Actor
ÕÕ% *
.
ÕÕ* +

Tipo_actor
ÕÕ+ 5
.
ÕÕ5 6
nombre
ÕÕ6 <
,
ÕÕ< =
Nombre
ŒŒ 
=
ŒŒ 
an
ŒŒ 
.
ŒŒ  
Actor
ŒŒ  %
.
ŒŒ% &
primer_nombre
ŒŒ& 3
,
ŒŒ3 4
NombreComercial
œœ #
=
œœ$ %
an
œœ& (
.
œœ( )
Actor
œœ) .
.
œœ. /
segundo_nombre
œœ/ =
,
œœ= >
NombreInterno
–– !
=
––" #
an
––$ &
.
––& '
Actor
––' ,
.
––, -
tercer_nombre
––- :
,
––: ;
IdLogo
—— 
=
—— 
an
—— 
.
——  
Actor
——  %
.
——% &
id_foto
——& -
,
——- .
Logo
““ 
=
““ 
an
““ 
.
““ 
Actor
““ #
.
““# $
Foto
““$ (
.
““( )
imagen
““) /
}
”” 
)
”” 
.
”” 
FirstOrDefault
”” !
(
””! "
)
””" #
;
””# $
}
‘‘ 
catch
’’ 
(
’’ 
	Exception
’’ 
e
’’ 
)
’’ 
{
÷÷ 
throw
◊◊ 
e
◊◊ 
;
◊◊ 
}
ÿÿ 
}
ŸŸ 	
public
⁄⁄ 
void
⁄⁄ "
EstablecerParametros
⁄⁄ (
(
⁄⁄( )/
!EstablecimientoComercialExtendido
⁄⁄) J
establecimiento
⁄⁄K Z
,
⁄⁄Z [
SigescomEntities
⁄⁄\ l
_db
⁄⁄m p
)
⁄⁄p q
{
€€ 	
var
‹‹ 

parametros
‹‹ 
=
‹‹ 
_db
‹‹  
.
‹‹  !
Actor_negocio
‹‹! .
.
‹‹. /
FirstOrDefault
‹‹/ =
(
‹‹= >
an
‹‹> @
=>
‹‹A C
an
‹‹D F
.
‹‹F G
id
‹‹G I
==
‹‹J L
establecimiento
‹‹M \
.
‹‹\ ]
Id
‹‹] _
)
‹‹_ `
.
‹‹` a%
Parametro_actor_negocio
‹‹a x
.
‹‹x y
ToList
‹‹y 
(‹‹ Ä
)‹‹Ä Å
;‹‹Å Ç"
EstablecerParametros
››  
(
››  !

parametros
››! +
,
››+ ,
establecimiento
››- <
)
››< =
;
››= >
}
ﬁﬁ 	
public
·· 
void
·· "
EstablecerParametros
·· (
(
··( )
IEnumerable
··) 4
<
··4 5/
!EstablecimientoComercialExtendido
··5 V
>
··V W
establecimientos
··X h
,
··h i
SigescomEntities
··j z
_db
··{ ~
)
··~ 
{
‚‚ 	
var
‰‰ !
idsEstablecimientos
‰‰ #
=
‰‰$ %
establecimientos
‰‰& 6
.
‰‰6 7
Select
‰‰7 =
(
‰‰= >
e
‰‰> ?
=>
‰‰@ B
e
‰‰C D
.
‰‰D E
Id
‰‰E G
)
‰‰G H
.
‰‰H I
Distinct
‰‰I Q
(
‰‰Q R
)
‰‰R S
.
‰‰S T
ToArray
‰‰T [
(
‰‰[ \
)
‰‰\ ]
;
‰‰] ^
var
ÊÊ 

parametros
ÊÊ 
=
ÊÊ 
_db
ÊÊ  
.
ÊÊ  !
Actor_negocio
ÊÊ! .
.
ÊÊ. /
Where
ÊÊ/ 4
(
ÊÊ4 5
an
ÊÊ5 7
=>
ÊÊ8 :!
idsEstablecimientos
ÊÊ; N
.
ÊÊN O
Contains
ÊÊO W
(
ÊÊW X
an
ÊÊY [
.
ÊÊ[ \
id
ÊÊ\ ^
)
ÊÊ^ _
)
ÊÊ_ `
.
ÊÊ` a

SelectMany
ÊÊa k
(
ÊÊk l
e
ÊÊl m
=>
ÊÊm o
e
ÊÊp q
.
ÊÊq r&
Parametro_actor_negocioÊÊr â
)ÊÊâ ä
.ÊÊä ã
ToListÊÊã ë
(ÊÊë í
)ÊÊí ì
;ÊÊì î
foreach
ÁÁ 
(
ÁÁ 
var
ÁÁ 
establecimiento
ÁÁ (
in
ÁÁ) +
establecimientos
ÁÁ, <
)
ÁÁ< =
{
ËË "
EstablecerParametros
ÈÈ $
(
ÈÈ$ %

parametros
ÈÈ% /
.
ÈÈ/ 0
Where
ÈÈ0 5
(
ÈÈ5 6
p
ÈÈ6 7
=>
ÈÈ7 9
p
ÈÈ: ;
.
ÈÈ; <
id_actor_negocio
ÈÈ< L
==
ÈÈL N
establecimiento
ÈÈO ^
.
ÈÈ^ _
Id
ÈÈ_ a
)
ÈÈa b
.
ÈÈb c
ToList
ÈÈc i
(
ÈÈi j
)
ÈÈj k
,
ÈÈk l
establecimiento
ÈÈm |
)
ÈÈ| }
;
ÈÈ} ~
}
ÍÍ 
}
ÏÏ 	
public
ÓÓ 
void
ÓÓ "
EstablecerParametros
ÓÓ (
(
ÓÓ( )
List
ÓÓ) -
<
ÓÓ- .%
Parametro_actor_negocio
ÓÓ. E
>
ÓÓE F

parametros
ÓÓG Q
,
ÓÓQ R/
!EstablecimientoComercialExtendido
ÓÓS t
establecimientoÓÓu Ñ
)ÓÓÑ Ö
{
ÔÔ 	
var
 
parametroPrecio
 
=
  !

parametros
" ,
.
, -
SingleOrDefault
- <
(
< =
pcn
= @
=>
A C
pcn
D G
.
G H
id_parametro
H T
==
U W
MaestroSettings
X g
.
g h
Default
h o
.
o pN
?IdDetalleMaestroParametroIdCentroDeAtencionParaObtencionPreciosp Ø
)Ø ∞
;∞ ±
establecimiento
ÚÚ 
.
ÚÚ 6
(IdCentroDeAtencionParaObtencionDePrecios
ÚÚ D
=
ÚÚE F
parametroPrecio
ÚÚG V
!=
ÚÚW Y
null
ÚÚZ ^
?
ÚÚ_ `
(
ÚÚa b
int
ÚÚb e
?
ÚÚe f
)
ÚÚf g
Convert
ÚÚg n
.
ÚÚn o
ToInt32
ÚÚo v
(
ÚÚv w
parametroPrecioÚÚw Ü
.ÚÚÜ á
valorÚÚá å
)ÚÚå ç
:ÚÚé è
nullÚÚê î
;ÚÚî ï
var
ÙÙ 
parametroStock
ÙÙ 
=
ÙÙ  

parametros
ÙÙ! +
.
ÙÙ+ ,
SingleOrDefault
ÙÙ, ;
(
ÙÙ; <
pcn
ÙÙ< ?
=>
ÙÙ@ B
pcn
ÙÙC F
.
ÙÙF G
id_parametro
ÙÙG S
==
ÙÙT V
MaestroSettings
ÙÙW f
.
ÙÙf g
Default
ÙÙg n
.
ÙÙn oL
=IdDetalleMaestroParametroIdCentroDeAtencionParaObtencionStockÙÙo ¨
)ÙÙ¨ ≠
;ÙÙ≠ Æ
establecimiento
ˆˆ 
.
ˆˆ 4
&IdCentroDeAtencionParaObtencionDeStock
ˆˆ B
=
ˆˆC D
parametroStock
ˆˆE S
!=
ˆˆT V
null
ˆˆW [
?
ˆˆ\ ]
(
ˆˆ^ _
int
ˆˆ_ b
?
ˆˆb c
)
ˆˆc d
Convert
ˆˆd k
.
ˆˆk l
ToInt32
ˆˆl s
(
ˆˆs t
parametroStockˆˆt Ç
.ˆˆÇ É
valorˆˆÉ à
)ˆˆà â
:ˆˆä ã
nullˆˆå ê
;ˆˆê ë
}
˜˜ 	
public
¯¯ 
IEnumerable
¯¯ 
<
¯¯ %
ItemGenericoConSubItems
¯¯ 2
>
¯¯2 3L
>ObtenerEstablecimientosConSusCentrosDeAtencionVigentesSegunRol
¯¯4 r
(
¯¯r s
int
¯¯s v&
idRolDeCentroDeAtencion¯¯w é
)¯¯é è
{
˘˘ 	
var
˙˙ #
idsRolesActoresPadres
˙˙ %
=
˙˙& '
new
˙˙( +
int
˙˙, /
[
˙˙/ 0
]
˙˙0 1
{
˙˙2 3
ActorSettings
˙˙4 A
.
˙˙A B
Default
˙˙B I
.
˙˙I J
IdRolSucursal
˙˙J W
,
˙˙W X
ActorSettings
˙˙Y f
.
˙˙f g
Default
˙˙g n
.
˙˙n o
	IdRolSede
˙˙o x
}
˙˙y z
;
˙˙z {
var
˚˚ (
idRolPrincipalActoresHijos
˚˚ *
=
˚˚+ ,
ActorSettings
˚˚- :
.
˚˚: ;
Default
˚˚; B
.
˚˚B C!
IdRolEntidadInterna
˚˚C V
;
˚˚V W
var
¸¸ )
idRolSecundarioActoresHijos
¸¸ +
=
¸¸, -%
idRolDeCentroDeAtencion
¸¸. E
;
¸¸E F
SigescomEntities
˝˝ 
_db
˝˝  
=
˝˝! "
new
˝˝# &
SigescomEntities
˝˝' 7
(
˝˝7 8
)
˝˝8 9
;
˝˝9 :
return
ˇˇ 
_db
ˇˇ 
.
ˇˇ 
Actor_negocio
ˇˇ $
.
ÄÄ 
Where
ÄÄ 
(
ÄÄ 
an
ÄÄ 
=>
ÄÄ #
idsRolesActoresPadres
ÄÄ 2
.
ÄÄ2 3
Contains
ÄÄ3 ;
(
ÄÄ; <
an
ÄÄ< >
.
ÄÄ> ?
id_rol
ÄÄ? E
)
ÄÄE F
&&
ÄÄG I
an
ÄÄJ L
.
ÄÄL M

es_vigente
ÄÄM W
==
ÄÄX Z
true
ÄÄ[ _
)
ÄÄ_ `
.
ÄÄ` a
Select
ÄÄa g
(
ÄÄg h
an
ÄÄh j
=>
ÄÄk m
new
ÄÄn q&
ItemGenericoConSubItemsÄÄr â
{
ÅÅ 
Id
ÇÇ 
=
ÇÇ 
an
ÇÇ 
.
ÇÇ 
id
ÇÇ 
,
ÇÇ 
Nombre
ÉÉ 
=
ÉÉ 
an
ÉÉ 
.
ÉÉ  
Actor
ÉÉ  %
.
ÉÉ% &
primer_nombre
ÉÉ& 3
,
ÉÉ3 4
SubItems
ÑÑ 
=
ÑÑ 
an
ÑÑ !
.
ÑÑ! "
Actor_negocio1
ÑÑ" 0
.
ÑÑ0 1
Where
ÑÑ1 6
(
ÑÑ6 7
anh
ÑÑ7 :
=>
ÑÑ; =
anh
ÑÑ> A
.
ÑÑA B
id_rol
ÑÑB H
==
ÑÑI K(
idRolPrincipalActoresHijos
ÑÑL f
&&
ÑÑg i
anh
ÑÑj m
.
ÑÑm n

es_vigente
ÑÑn x
&&
ÑÑy {
anh
ÑÑ| 
.ÑÑ Ä
ActorÑÑÄ Ö
.ÑÑÖ Ü
Actor_negocioÑÑÜ ì
.ÑÑì î
CountÑÑî ô
(ÑÑô ö
aaÑÑö ú
=>ÑÑù ü
aaÑÑ† ¢
.ÑÑ¢ £
id_rolÑÑ£ ©
==ÑÑ™ ¨+
idRolSecundarioActoresHijosÑÑ≠ »
&&ÑÑ… À
aaÑÑÃ Œ
.ÑÑŒ œ

es_vigenteÑÑœ Ÿ
)ÑÑŸ ⁄
>ÑÑ€ ‹
$numÑÑ› ﬁ
)ÑÑﬁ ﬂ
.
ÖÖ 
Select
ÖÖ 
(
ÖÖ 
anh
ÖÖ 
=>
ÖÖ  "
new
ÖÖ# &
ItemGenerico
ÖÖ' 3
{
ÖÖ4 5
Id
ÖÖ6 8
=
ÖÖ9 :
anh
ÖÖ; >
.
ÖÖ> ?
id
ÖÖ? A
,
ÖÖA B
Nombre
ÖÖC I
=
ÖÖJ K
anh
ÖÖL O
.
ÖÖO P
Actor
ÖÖP U
.
ÖÖU V
primer_nombre
ÖÖV c
}
ÖÖd e
)
ÖÖe f
.
ÖÖf g
ToList
ÖÖg m
(
ÖÖm n
)
ÖÖn o
}
ÜÜ 
)
ÜÜ 
;
ÜÜ 
}
àà 	
public
çç %
Parametro_actor_negocio
çç &B
4ObtenerParametroCentroDeAtencionParaObtencionPrecios
çç' [
(
çç[ \
int
çç\ _(
idEstablecimientoComencial
çç` z
)
ççz {
{
éé 	
SigescomEntities
èè 
_db
èè  
=
èè! "
new
èè# &
SigescomEntities
èè' 7
(
èè7 8
)
èè8 9
;
èè9 :
return
êê 
_db
êê 
.
êê %
Parametro_actor_negocio
êê .
.
êê. /
FirstOrDefault
êê/ =
(
êê= >
pcn
êê> A
=>
êêB D
pcn
êêE H
.
êêH I
id_actor_negocio
êêI Y
==
êêY [(
idEstablecimientoComencial
êê\ v
&&
êêw y
pcn
êêz }
.
êê} ~
id_parametroêê~ ä
==êêã ç
MaestroSettingsêêé ù
.êêù û
Defaultêêû •
.êê• ¶O
?IdDetalleMaestroParametroIdCentroDeAtencionParaObtencionPreciosêê¶ Â
)êêÂ Ê
;êêÊ Á
}
ëë 	
public
íí %
Parametro_actor_negocio
íí &B
4ObtenerParametroCentroDeAtencionParaObtencionDeStock
íí' [
(
íí[ \
int
íí\ _(
idEstablecimientoComencial
íí` z
)
ííz {
{
ìì 	
SigescomEntities
îî 
_db
îî  
=
îî! "
new
îî# &
SigescomEntities
îî' 7
(
îî7 8
)
îî8 9
;
îî9 :
return
ïï 
_db
ïï 
.
ïï %
Parametro_actor_negocio
ïï .
.
ïï. /
FirstOrDefault
ïï/ =
(
ïï= >
pcn
ïï> A
=>
ïïB D
pcn
ïïE H
.
ïïH I
id_actor_negocio
ïïI Y
==
ïïZ \(
idEstablecimientoComencial
ïï] w
&&
ïïx z
pcn
ïï{ ~
.
ïï~ 
id_parametroïï ã
==ïïå é
MaestroSettingsïïè û
.ïïû ü
Defaultïïü ¶
.ïï¶ ßM
=IdDetalleMaestroParametroIdCentroDeAtencionParaObtencionStockïïß ‰
)ïï‰ Â
;ïïÂ Ê
}
ññ 	
}
öö 
}õõ ß+
ZD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\Compras\ConsultaCompras_Datos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
." #
Compras# *
{

 
public 

partial 
class !
ConsultaCompras_Datos .
:. /(
IConsultaCompras_Repositorio0 L
{ 
public 
IEnumerable 
< 
PrecioComercial *
>* +I
=ObtenerValorUnitarioDePrimeraOrdenDeCompraConPrecioMayorACero, i
(i j
intj m
[m n
]n o
idConceptosp {
){ |
{ 	
SigescomEntities 
_db  
=! "
new# &
SigescomEntities' 7
(7 8
)8 9
;9 :
var 
partialResult 
= 
_db  #
.# $
Detalle_transaccion$ 7
.7 8
Where8 =
(= >
dt> @
=>A C
idConceptosD O
.O P
ContainsP X
(X Y
dtY [
.[ \
id_concepto_negocio\ o
)o p
&&q s
dtt v
.v w
Transaccion	w Ç
.
Ç É!
id_tipo_transaccion
É ñ
==
ó ô!
TransaccionSettings
ö ≠
.
≠ Æ
Default
Æ µ
.
µ ∂,
IdTipoTransaccionOrdenDeCompra
∂ ‘
)
‘ ’
.
’ ÷
GroupBy
÷ ›
(
› ﬁ
dt
ﬁ ‡
=>
· „
new
‰ Á
{
Ë È
dt
Í Ï
.
Ï Ì!
id_concepto_negocio
Ì Ä
}
Å Ç
)
Ç É
.
É Ñ
Select
Ñ ä
(
ä ã
dt
ã ç
=>
é ê
new
ë î
{
ï ñ

IdConcepto 
= 
dt 
.  
Key  #
.# $
id_concepto_negocio$ 7
,7 8
Detalle 
= 
dt 
. 
FirstOrDefault +
(+ ,
d, -
=>. 0
d1 2
.2 3
precio_unitario3 B
>C D
$numE F
)F G
} 
) 
. 
ToList 
( 
) 
; 
var 
result 
= 
partialResult %
.% &
Select& ,
(, -
r- .
=>. 0
new1 4
PrecioComercial5 D
(D E
)E F
{G H

IdConcepto 
= 
r 
. 

IdConcepto (
,( )
Precio 
= 
TransaccionSettings ,
., -
Default- 4
.4 5
AplicaLeyAmazonia5 F
?F G
(H I
rI J
.J K
DetalleK R
!=R T
nullT X
?X Y
rZ [
.[ \
Detalle\ c
.c d
precio_unitariod s
:s t
$numt u
)u v
:w x
(y z
rz {
.{ |
Detalle	| É
!=
Ñ Ü
null
á ã
?
ã å
(
ç é
r
é è
.
è ê
Detalle
ê ó
.
ó ò
total
ò ù
-
û ü
r
† °
.
° ¢
Detalle
¢ ©
.
© ™
igv
™ ≠
)
≠ Æ
/
Ø ∞
r
± ≤
.
≤ ≥
Detalle
≥ ∫
.
∫ ª
cantidad
ª √
:
ƒ ≈
$num
∆ «
)
« »
} 
) 
; 
return 
result 
; 
} 	
public   
decimal   6
*ObtenerValorUnitarioDePrimeraOrdenDeCompra   A
(  A B
int  B E

idConcepto  F P
)  P Q
{!! 	
SigescomEntities"" 
_db""  
=""! "
new""# &
SigescomEntities""' 7
(""7 8
)""8 9
;""9 :
var## 
result## 
=## 
_db## 
.## 
Detalle_transaccion## 0
.##0 1
Where##1 6
(##6 7
dt##7 9
=>##: <
dt##= ?
.##? @
id_concepto_negocio##@ S
==##T V

idConcepto##W a
&&##b d
dt##e g
.##g h
Transaccion##h s
.##s t 
id_tipo_transaccion	##t á
==
##à ä!
TransaccionSettings
##ã û
.
##û ü
Default
##ü ¶
.
##¶ ß,
IdTipoTransaccionOrdenDeCompra
##ß ≈
)
##≈ ∆
.
##∆ «
Select
##« Õ
(
##Õ Œ
dt
##Œ –
=>
##— ”!
TransaccionSettings
##‘ Á
.
##Á Ë
Default
##Ë Ô
.
##Ô 
AplicaLeyAmazonia
## Å
?
##Ç É
dt
##Ñ Ü
.
##Ü á
precio_unitario
##á ñ
:
##ñ ó
(
##ó ò
dt
##ò ö
.
##ö õ
total
##õ †
-
##† °
dt
##° £
.
##£ §
igv
##§ ß
)
##ß ®
/
##® ©
dt
##© ´
.
##´ ¨
cantidad
##¨ ¥
)
##¥ µ
.
##µ ∂
FirstOrDefault
##∂ ƒ
(
##ƒ ≈
)
##≈ ∆
;
##∆ «
return$$ 
result$$ 
;$$ 
}%% 	
}'' 
}(( Ø±
dD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\CentroDeAtencion\CentroDeAtencion_Datos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
." #
Empleado# +
{ 
public 

partial 
class "
CentroDeAtencion_Datos /
:/ 0)
ICentroDeAtencion_Repositorio1 N
{ 
public 
List 
< 
CentroDeAtencion $
>$ %0
$ObtenerCentrosDeAtencionProgramados_& J
(J K
intK N

idEmpleadoO Y
)Y Z
{ 	
var 
fechaActual 
= 
DateTimeUtil *
.* +
FechaActual+ 6
(6 7
)7 8
;8 9
var 
tipoVinculo 
= 
TipoVinculo )
.) *
Turno* /
;/ 0
SigescomEntities 
_db  
=! "
new# &
SigescomEntities' 7
(7 8
)8 9
;9 :
return 
_db 
. !
Vinculo_Actor_Negocio ,
., -
Where- 2
(2 3
van3 6
=>7 9
van: =
.= >&
id_actor_negocio_vinculado> X
==Y [

idEmpleado\ f
&&g i
vanj m
.m n
tipo_vinculon z
=={ }
(~ 
int	 Ç
)
Ç É
tipoVinculo
É é
&&
è ë
van
í ï
.
ï ñ
desde
ñ õ
<=
ú û
fechaActual
ü ™
&&
´ ≠
van
Æ ±
.
± ≤
hasta
≤ ∑
>=
∏ ∫
fechaActual
ª ∆
&&
« …
van
  Õ
.
Õ Œ

es_vigente
Œ ÿ
)
ÿ Ÿ
.
Ÿ ⁄
Select
⁄ ‡
(
‡ ·
van
· ‰
=>
Â Á
van
Ë Î
.
Î Ï
Actor_negocio
Ï ˘
)
˘ ˙
.
˙ ˚
Select
˚ Å
(
Å Ç
an
Ç Ñ
=>
Ö á
new
à ã
CentroDeAtencion
å ú
{
ù û
Id
ü °
=
¢ £
an
§ ¶
.
¶ ß
id
ß ©
,
© ™
IdActor
´ ≤
=
≤ ≥
an
¥ ∂
.
∂ ∑
id_actor
∑ ø
,
ø ¿
Codigo
¡ «
=
» …
an
  Ã
.
Ã Õ
codigo_negocio
Õ €
,
€ ‹&
EstablecimientoComercial
› ı
=
ˆ ˜
new
¯ ˚&
EstablecimientoComercial
¸ î
{
ï ñ
Id
ó ô
=
ö õ
(
ú ù
int
ù †
)
† °
an
° £
.
£ §$
id_actor_negocio_padre
§ ∫
,
∫ ª
Nombre
º ¬
=
√ ƒ
an
≈ «
.
« »
Actor_negocio2
» ÷
.
÷ ◊
Actor
◊ ‹
.
‹ ›
primer_nombre
› Í
,
Í Î
NombreInterno
Ï ˘
=
˘ ˙
an
˙ ¸
.
¸ ˝
Actor_negocio2
˝ ã
.
ã å
Actor
å ë
.
ë í
tercer_nombre
í ü
}
† °
,
° ¢
Nombre
£ ©
=
™ ´
an
¨ Æ
.
Æ Ø
Actor
Ø ¥
.
¥ µ
primer_nombre
µ ¬
,
¬ √
ExtensionJson
ƒ —
=
“ ”
an
‘ ÷
.
÷ ◊
extension_json
◊ Â
}
Ê Á
)
Á Ë
.
Ë È
ToList
È Ô
(
Ô 
)
 Ò
;
Ò Ú
} 	
public 
Actor_negocio !
ObtenerActorDeNegocio 2
(2 3
int3 6
idActorNegocio7 E
)E F
{ 	
try 
{ 
SigescomEntities    
_db  ! $
=  % &
new  ' *
SigescomEntities  + ;
(  ; <
)  < =
;  = >
return!! 
_db!! 
.!! 
Actor_negocio!! (
."" 
Include"" 
("" 
an"" 
=>""  "
an""# %
.""% &
Actor""& +
)""+ ,
.## 
Include## 
(## 
an## 
=>##  "
an### %
.##% &
Actor##& +
.##+ ,
Detalle_maestro##, ;
)##; <
.$$ 
Include$$ 
($$ 
an$$ 
=>$$  "
an$$# %
.$$% &
Actor$$& +
.$$+ ,
	Direccion$$, 5
)$$5 6
.%% 
Include%% 
(%% 
an%% 
=>%%  "
an%%# %
.%%% &
Actor%%& +
.%%+ ,
	Direccion%%, 5
.%%5 6
Select%%6 <
(%%< =
d%%= >
=>%%? A
d%%B C
.%%C D
Ubigeo%%D J
)%%J K
)%%K L
.&& 
SingleOrDefault&& $
(&&$ %
an&&% '
=>&&( *
an&&+ -
.&&- .
id&&. 0
==&&1 3
idActorNegocio&&4 B
)&&B C
;&&C D
}'' 
catch(( 
((( 
	Exception(( 
e(( 
)(( 
{)) 
throw** 
e** 
;** 
}++ 
},, 	
public-- 
CentroDeAtencion-- $
ObtenerCentroDeAtencion_--  8
(--8 9
int--9 <
idCentroAtencion--= M
)--M N
{.. 	
try// 
{00 
SigescomEntities11  
_db11! $
=11% &
new11' *
SigescomEntities11+ ;
(11; <
)11< =
;11= >
return33 
_db33 
.33 
Actor_negocio33 (
.33( )
Where33) .
(33. /
an33/ 1
=>332 4
an335 7
.337 8
id338 :
==33; =
idCentroAtencion33> N
)33N O
.33O P
Select33P V
(33V W
an33W Y
=>33Z \
new33] `
CentroDeAtencion33a q
{44 
Id55 
=55 
an55 
.55 
id55 
,55 
IdActor66 
=66 
an66  
.66  !
id_actor66! )
,66) *
Codigo77 
=77 
an77 
.77  
codigo_negocio77  .
,77. /$
EstablecimientoComercial88 ,
=88- .
new88/ 2$
EstablecimientoComercial883 K
{99 
Id:: 
=:: 
(:: 
int:: !
)::! "
an::" $
.::$ %"
id_actor_negocio_padre::% ;
,::; <
Nombre;; 
=;;  
an;;! #
.;;# $
Actor_negocio2;;$ 2
.;;2 3
Actor;;3 8
.;;8 9
primer_nombre;;9 F
,;;F G
NombreInterno<< %
=<<& '
an<<( *
.<<* +
Actor_negocio2<<+ 9
.<<9 :
Actor<<: ?
.<<? @
tercer_nombre<<@ M
}== 
,== 
Nombre>> 
=>> 
an>> 
.>>  
Actor>>  %
.>>% &
primer_nombre>>& 3
,>>3 4
ExtensionJson?? !
=??" #
an??$ &
.??& '
extension_json??' 5
}@@ 
)@@ 
.@@ 
FirstOrDefault@@ !
(@@! "
)@@" #
;@@# $
}AA 
catchBB 
(BB 
	ExceptionBB 
eBB 
)BB 
{CC 
throwDD 
newDD 
DatosExceptionDD (
(DD( )
$strDD) W
,DDW X
eDDY Z
)DDZ [
;DD[ \
}EE 
}FF 	
publicJJ 
IEnumerableJJ 
<JJ 
CentroDeAtencionJJ +
>JJ+ ,,
 ObtenerCentrosDeAtencionVigentesJJ- M
(JJM N
)JJN O
{KK 	
tryLL 
{MM 
SigescomEntitiesNN  
_dbNN! $
=NN% &
newNN' *
SigescomEntitiesNN+ ;
(NN; <
)NN< =
;NN= >
intOO 
idRolOO 
=OO 
ActorSettingsOO )
.OO) *
DefaultOO* 1
.OO1 2
IdRolEntidadInternaOO2 E
;OOE F
varQQ 
centrosDeAtencionQQ %
=QQ& '
_dbQQ( +
.QQ+ ,
Actor_negocioQQ, 9
.QQ9 :
WhereQQ: ?
(QQ? @
anQQ@ B
=>QQC E
anQQF H
.QQH I
id_rolQQI O
==QQP R
idRolQQS X
&&QQY [
anQQ\ ^
.QQ^ _

es_vigenteQQ_ i
==QQj l
trueQQm q
)QQq r
.QQr s
SelectQQs y
(QQy z
anQQz |
=>QQ} 
new
QQÄ É
CentroDeAtencion
QQÑ î
{RR 
IdSS 
=SS 
anSS 
.SS 
idSS 
,SS 
IdActorTT 
=TT 
anTT  
.TT  !
id_actorTT! )
,TT) *
CodigoUU 
=UU 
anUU 
.UU  
codigo_negocioUU  .
,UU. /$
EstablecimientoComercialVV ,
=VV- .
newVV/ 2$
EstablecimientoComercialVV3 K
{WW 
IdXX 
=XX 
(XX 
intXX !
)XX! "
anXX" $
.XX$ %"
id_actor_negocio_padreXX% ;
,XX; <
NombreYY 
=YY  
anYY! #
.YY# $
Actor_negocio2YY$ 2
.YY2 3
ActorYY3 8
.YY8 9
primer_nombreYY9 F
,YYF G
NombreInternoZZ %
=ZZ& '
anZZ( *
.ZZ* +
Actor_negocio2ZZ+ 9
.ZZ9 :
ActorZZ: ?
.ZZ? @
tercer_nombreZZ@ M
}[[ 
,[[ 
Nombre\\ 
=\\ 
an\\ 
.\\  
Actor\\  %
.\\% &
primer_nombre\\& 3
,\\3 4
ExtensionJson]] !
=]]" #
an]]$ &
.]]& '
extension_json]]' 5
}^^ 
)^^ 
.^^ 
ToList^^ 
(^^ 
)^^ 
;^^ 
return__ 
centrosDeAtencion__ (
;__( )
}`` 
catchaa 
(aa 
	Exceptionaa 
eaa 
)aa 
{bb 
throwcc 
ecc 
;cc 
}dd 
}ee 	
publicgg 
IEnumerablegg 
<gg %
CentroDeAtencionExtendidogg 4
>gg4 56
*ObtenerCentrosDeAtencionExtendidosVigentesgg6 `
(gg` a
)gga b
{hh 	
tryii 
{jj 
SigescomEntitieskk  
_dbkk! $
=kk% &
newkk' *
SigescomEntitieskk+ ;
(kk; <
)kk< =
;kk= >
intll 
idRolll 
=ll 
ActorSettingsll )
.ll) *
Defaultll* 1
.ll1 2
IdRolEntidadInternall2 E
;llE F
varnn 
centrosDeAtencionnn %
=nn% &
_dbnn' *
.nn* +
Actor_negocionn+ 8
.nn8 9
Wherenn9 >
(nn> ?
annn? A
=>nnB D
annnE G
.nnG H
id_rolnnH N
==nnO Q
idRolnnR W
&&nnX Z
annn[ ]
.nn] ^

es_vigentenn^ h
==nni k
truennl p
)nnp q
.nnq r
Selectnnr x
(nnx y
annny {
=>nn| ~
new	nn Ç'
CentroDeAtencionExtendido
nnÉ ú
{oo 
Idpp 
=pp 
anpp 
.pp 
idpp 
,pp 
IdActorqq 
=qq 
anqq  
.qq  !
id_actorqq! )
,qq) *
Codigorr 
=rr 
anrr 
.rr  
codigo_negociorr  .
,rr. /$
EstablecimientoComercialss ,
=ss- .
newss/ 2$
EstablecimientoComercialss3 K
{tt 
Iduu 
=uu 
(uu 
intuu !
)uu! "
anuu" $
.uu$ %"
id_actor_negocio_padreuu% ;
,uu; <
Nombrevv 
=vv  
anvv! #
.vv# $
Actor_negocio2vv$ 2
.vv2 3
Actorvv3 8
.vv8 9
primer_nombrevv9 F
,vvF G
NombreInternoww %
=ww& '
anww( *
.ww* +
Actor_negocio2ww+ 9
.ww9 :
Actorww: ?
.ww? @
tercer_nombreww@ M
}xx 
,xx 
Nombreyy 
=yy 
anyy 
.yy  
Actoryy  %
.yy% &
primer_nombreyy& 3
,yy3 4
ExtensionJsonzz !
=zz" #
anzz$ &
.zz& '
extension_jsonzz' 5
,zz5 6
DocumentoIdentidad{{ &
={{' (
an{{) +
.{{+ ,
Actor{{, 1
.{{1 2&
numero_documento_identidad{{2 L
,{{L M
RolesHijosVigentes|| &
=||' (
an||) +
.||+ ,
Actor||, 1
.||1 2
Actor_negocio||2 ?
.||? @
Where||@ E
(||E F
an_||F I
=>||J L
an_||M P
.||P Q
Rol||Q T
.||T U
id_rol_padre||U a
==||b d
ActorSettings||e r
.||r s
Default||s z
.||z { 
IdRolEntidadInterna	||{ é
&&
||è ë
an_
||í ï
.
||ï ñ

es_vigente
||ñ †
==
||° £
true
||§ ®
)
||® ©
.
||© ™
Select
||™ ∞
(
||∞ ±
an__
||± µ
=>
||∂ ∏
an__
||π Ω
.
||Ω æ
Rol
||æ ¡
)
||¡ ¬
.
||¬ √
Select
||√ …
(
||…  
r
||  À
=>
||Ã Œ
new
||œ “
ItemGenerico
||” ﬂ
(
||ﬂ ‡
)
||‡ ·
{
||‚ „
Id
||‰ Ê
=
||Á Ë
r
||È Í
.
||Í Î
id
||Î Ì
,
||Ì Ó
Nombre
||Ô ı
=
||ˆ ˜
r
||¯ ˘
.
||˘ ˙
nombre
||˙ Ä
}
||Å Ç
)
||Ç É
,
||É Ñ
}}} 
)}} 
.}} 
ToList}} 
(}} 
)}} 
;}}  
EstablecerParametros $
($ %
centrosDeAtencion% 6
,6 7
_db8 ;
); <
;< =
return
ÄÄ 
centrosDeAtencion
ÄÄ (
;
ÄÄ( )
}
ÅÅ 
catch
ÇÇ 
(
ÇÇ 
	Exception
ÇÇ 
e
ÇÇ 
)
ÇÇ 
{
ÉÉ 
throw
ÑÑ 
e
ÑÑ 
;
ÑÑ 
}
ÖÖ 
}
ÜÜ 	
public
àà 
void
àà "
EstablecerParametros
àà (
(
àà( )
IEnumerable
àà) 4
<
àà4 5'
CentroDeAtencionExtendido
àà5 N
>
ààN O
centrosDeAtencion
ààP a
,
ààa b
SigescomEntities
ààc s
_db
ààt w
)
ààw x
{
ââ 	
var
ää !
idsEstablecimientos
ää #
=
ää$ %
centrosDeAtencion
ää& 7
.
ää7 8
Select
ää8 >
(
ää> ?
ca
ää? A
=>
ääB D
ca
ääE G
.
ääG H&
EstablecimientoComercial
ääH `
.
ää` a
Id
ääa c
)
ääc d
.
ääd e
Distinct
ääe m
(
ääm n
)
ään o
.
ääo p
ToArray
ääp w
(
ääw x
)
ääx y
;
ääy z
var
ãã -
parametrosDeLosEstablecimientos
ãã /
=
ãã0 1
_db
ãã2 5
.
ãã5 6
Actor_negocio
ãã6 C
.
ããC D
Where
ããD I
(
ããI J
an
ããJ L
=>
ããM O!
idsEstablecimientos
ããP c
.
ããc d
Contains
ããd l
(
ããl m
an
ããm o
.
ãão p
id
ããp r
)
ããr s
)
ããs t
.
ããt u

SelectMany
ããu 
(ãã Ä
eããÄ Å
=>ããÇ Ñ
eããÖ Ü
.ããÜ á'
Parametro_actor_negocioããá û
)ããû ü
.ããü †
ToListãã† ¶
(ãã¶ ß
)ããß ®
;ãã® ©
foreach
çç 
(
çç 
var
çç 
centroDeAtencion
çç )
in
çç* ,
centrosDeAtencion
çç- >
)
çç> ?
{
éé 
var
èè +
parametrosDeSuEstablecimiento
èè 1
=
èè2 3-
parametrosDeLosEstablecimientos
èè4 S
.
èèS T
Where
èèT Y
(
èèY Z
p
èèZ [
=>
èè\ ^
p
èè_ `
.
èè` a
id_actor_negocio
èèa q
==
èèr t
centroDeAtencionèèu Ö
.èèÖ Ü(
EstablecimientoComercialèèÜ û
.èèû ü
Idèèü °
)èè° ¢
.èè¢ £
ToListèè£ ©
(èè© ™
)èè™ ´
;èè´ ¨"
EstablecerParametros
êê $
(
êê$ %+
parametrosDeSuEstablecimiento
êê% B
,
êêB C
centroDeAtencion
êêD T
)
êêT U
;
êêU V
}
ìì 
}
îî 	
public
ññ 
void
ññ "
EstablecerParametros
ññ (
(
ññ( )'
CentroDeAtencionExtendido
ññ) B
centroDeAtencion
ññC S
,
ññS T
SigescomEntities
ññU e
_db
ññf i
)
ññi j
{
óó 	
var
òò +
parametrosDeSuEstablecimiento
òò -
=
òò. /
_db
òò0 3
.
òò3 4
Actor_negocio
òò4 A
.
òòA B
FirstOrDefault
òòB P
(
òòP Q
an
òòQ S
=>
òòT V
an
òòW Y
.
òòY Z
id
òòZ \
==
òò] _
centroDeAtencion
òò` p
.
òòp q'
EstablecimientoComercialòòq â
.òòâ ä
Idòòä å
)òòå ç
.òòç é'
Parametro_actor_negocioòòé •
.òò• ¶
ToListòò¶ ¨
(òò¨ ≠
)òò≠ Æ
;òòÆ Ø"
EstablecerParametros
ôô  
(
ôô  !+
parametrosDeSuEstablecimiento
ôô! >
,
ôô> ?
centroDeAtencion
ôô@ P
)
ôôP Q
;
ôôQ R
}
öö 	
public
úú 
void
úú "
EstablecerParametros
úú (
(
úú( )
List
úú) -
<
úú- .%
Parametro_actor_negocio
úú. E
>
úúE F+
parametrosDeSuEstablecimiento
úúG d
,
úúd e'
CentroDeAtencionExtendido
úúf  
centroDeAtencionúúÄ ê
)úúê ë
{
ùù 	
var
ûû +
parametroCentroAtencionPrecio
ûû -
=
ûû. /+
parametrosDeSuEstablecimiento
ûû0 M
.
ûûM N
FirstOrDefault
ûûN \
(
ûû\ ]
p
ûû] ^
=>
ûû_ a
p
ûûb c
.
ûûc d
id_parametro
ûûd p
==
ûûq s
MaestroSettingsûût É
.ûûÉ Ñ
DefaultûûÑ ã
.ûûã åO
?IdDetalleMaestroParametroIdCentroDeAtencionParaObtencionPreciosûûå À
)ûûÀ Ã
;ûûÃ Õ
var
üü *
parametroCentroAtencionStock
üü ,
=
üü- .+
parametrosDeSuEstablecimiento
üü/ L
.
üüL M
FirstOrDefault
üüM [
(
üü[ \
p
üü\ ]
=>
üü^ `
p
üüa b
.
üüb c
id_parametro
üüc o
==
üüp r
MaestroSettingsüüs Ç
.üüÇ É
DefaultüüÉ ä
.üüä ãM
=IdDetalleMaestroParametroIdCentroDeAtencionParaObtencionStocküüã »
)üü» …
;üü…  
centroDeAtencion
†† 
.
†† 3
%EsCentroAtencionParaObtencioDePrecios
†† B
=
††C D+
parametroCentroAtencionPrecio
††E b
!=
††c e
null
††f j
?
††k l
(
††m n
System
††n t
.
††t u
Convert
††u |
.
††| }
ToInt32††} Ñ
(††Ñ Ö-
parametroCentroAtencionPrecio††Ö ¢
.††¢ £
valor††£ ®
)††® ©
==††™ ¨ 
centroDeAtencion††≠ Ω
.††Ω æ
Id††æ ¿
)††¿ ¡
:††¬ √
false††ƒ …
;††…  
centroDeAtencion
°° 
.
°° 1
#EsCentroAtencionParaObtencioDeStock
°° @
=
°°A B*
parametroCentroAtencionStock
°°C _
!=
°°` b
null
°°c g
?
°°h i
(
°°j k
System
°°k q
.
°°q r
Convert
°°r y
.
°°y z
ToInt32°°z Å
(°°Å Ç,
parametroCentroAtencionStock°°Ç û
.°°û ü
valor°°ü §
)°°§ •
==°°¶ ® 
centroDeAtencion°°© π
.°°π ∫
Id°°∫ º
)°°º Ω
:°°æ ø
false°°¿ ≈
;°°≈ ∆
}
¢¢ 	
public
££ 
List
££ 
<
££ '
CentroDeAtencionExtendido
££ -
>
££- .1
#ObtenerCentrosDeAtencionProgramados
££/ R
(
££R S
int
££S V

idEmpleado
££W a
)
££a b
{
§§ 	
var
•• 
fechaActual
•• 
=
•• 
DateTimeUtil
•• *
.
••* +
FechaActual
••+ 6
(
••6 7
)
••7 8
;
••8 9
var
¶¶ 
tipoVinculo
¶¶ 
=
¶¶ 
TipoVinculo
¶¶ )
.
¶¶) *
Turno
¶¶* /
;
¶¶/ 0
SigescomEntities
ßß 
_db
ßß  
=
ßß! "
new
ßß# &
SigescomEntities
ßß' 7
(
ßß7 8
)
ßß8 9
;
ßß9 :
int
®® 
idRol
®® 
=
®® 
ActorSettings
®® %
.
®®% &
Default
®®& -
.
®®- .!
IdRolEntidadInterna
®®. A
;
®®A B
var
™™ 

resultados
™™ 
=
™™ 
_db
™™  
.
™™  !#
Vinculo_Actor_Negocio
™™! 6
.
™™6 7
Where
™™7 <
(
™™< =
van
™™= @
=>
™™A C
van
™™D G
.
™™G H(
id_actor_negocio_vinculado
™™H b
==
™™c e

idEmpleado
™™f p
&&
™™q s
van
™™t w
.
™™w x
tipo_vinculo™™x Ñ
==™™Ö á
(™™à â
int™™â å
)™™å ç
tipoVinculo™™ç ò
&&™™ô õ
van™™ú ü
.™™ü †
desde™™† •
<=™™¶ ®
fechaActual™™© ¥
&&™™µ ∑
van™™∏ ª
.™™ª º
hasta™™º ¡
>=™™¬ ƒ
fechaActual™™≈ –
&&™™— ”
van™™‘ ◊
.™™◊ ÿ

es_vigente™™ÿ ‚
)™™‚ „
.™™„ ‰
Select™™‰ Í
(™™Í Î
van™™Î Ó
=>™™Ô Ò
van™™Ú ı
.™™ı ˆ
Actor_negocio™™ˆ É
)™™É Ñ
.™™Ñ Ö
Where™™Ö ä
(™™ä ã
an™™ã ç
=>™™é ê
an™™ë ì
.™™ì î
id_rol™™î ö
==™™õ ù
idRol™™û £
)™™£ §
.™™§ •
Select™™• ´
(™™´ ¨
an™™¨ Æ
=>™™Ø ±
new™™≤ µ)
CentroDeAtencionExtendido™™∂ œ
{
´´ 
Id
¨¨ 
=
¨¨ 
an
¨¨ 
.
¨¨ 
id
¨¨ 
,
¨¨ 
IdActor
≠≠ 
=
≠≠ 
an
≠≠ 
.
≠≠ 
id_actor
≠≠ %
,
≠≠% &
Codigo
ÆÆ 
=
ÆÆ 
an
ÆÆ 
.
ÆÆ 
codigo_negocio
ÆÆ *
,
ÆÆ* +&
EstablecimientoComercial
ØØ (
=
ØØ) *
new
ØØ+ .&
EstablecimientoComercial
ØØ/ G
{
∞∞ 
Id
±± 
=
±± 
(
±± 
int
±± 
)
±± 
an
±±  
.
±±  !$
id_actor_negocio_padre
±±! 7
,
±±7 8
Nombre
≤≤ 
=
≤≤ 
an
≤≤ 
.
≤≤  
Actor_negocio2
≤≤  .
.
≤≤. /
Actor
≤≤/ 4
.
≤≤4 5
primer_nombre
≤≤5 B
,
≤≤B C
NombreInterno
≥≥ !
=
≥≥" #
an
≥≥$ &
.
≥≥& '
Actor_negocio2
≥≥' 5
.
≥≥5 6
Actor
≥≥6 ;
.
≥≥; <
tercer_nombre
≥≥< I
}
¥¥ 
,
¥¥ 
Nombre
µµ 
=
µµ 
an
µµ 
.
µµ 
Actor
µµ !
.
µµ! "
primer_nombre
µµ" /
,
µµ/ 0
ExtensionJson
∂∂ 
=
∂∂ 
an
∂∂  "
.
∂∂" #
extension_json
∂∂# 1
,
∂∂1 2 
DocumentoIdentidad
∑∑ "
=
∑∑# $
an
∑∑% '
.
∑∑' (
Actor
∑∑( -
.
∑∑- .(
numero_documento_identidad
∑∑. H
,
∑∑H I 
RolesHijosVigentes
∏∏ "
=
∏∏# $
an
∏∏% '
.
∏∏' (
Actor
∏∏( -
.
∏∏- .
Actor_negocio
∏∏. ;
.
∏∏; <
Where
∏∏< A
(
∏∏A B
an_
∏∏B E
=>
∏∏F H
an_
∏∏I L
.
∏∏L M
Rol
∏∏M P
.
∏∏P Q
id_rol_padre
∏∏Q ]
==
∏∏^ `
ActorSettings
∏∏a n
.
∏∏n o
Default
∏∏o v
.
∏∏v w"
IdRolEntidadInterna∏∏w ä
&&∏∏ã ç
an_∏∏é ë
.∏∏ë í

es_vigente∏∏í ú
==∏∏ù ü
true∏∏† §
)∏∏§ •
.∏∏• ¶
Select∏∏¶ ¨
(∏∏¨ ≠
an__∏∏≠ ±
=>∏∏≤ ¥
an__∏∏µ π
.∏∏π ∫
Rol∏∏∫ Ω
)∏∏Ω æ
.∏∏æ ø
Select∏∏ø ≈
(∏∏≈ ∆
r∏∏∆ «
=>∏∏»  
new∏∏À Œ
ItemGenerico∏∏œ €
(∏∏€ ‹
)∏∏‹ ›
{∏∏ﬁ ﬂ
Id∏∏‡ ‚
=∏∏„ ‰
r∏∏Â Ê
.∏∏Ê Á
id∏∏Á È
,∏∏È Í
Nombre∏∏Î Ò
=∏∏Ú Û
r∏∏Ù ı
.∏∏ı ˆ
nombre∏∏ˆ ¸
}∏∏˝ ˛
)∏∏˛ ˇ
,∏∏ˇ Ä
}
ππ 
)
ππ 
.
ππ 
ToList
ππ 
(
ππ 
)
ππ 
;
ππ 
return
∫∫ 

resultados
∫∫ 
;
∫∫ 
}
ªª 	
public
ºº '
CentroDeAtencionExtendido
ºº (&
_ObtenerCentroDeAtencion
ºº) A
(
ººA B
int
ººB E
id
ººF H
)
ººH I
{
ΩΩ 	
try
ææ 
{
øø 
SigescomEntities
¿¿  
_db
¿¿! $
=
¿¿% &
new
¿¿' *
SigescomEntities
¿¿+ ;
(
¿¿; <
)
¿¿< =
;
¿¿= >
int
¡¡ 
idRol
¡¡ 
=
¡¡ 
ActorSettings
¡¡ )
.
¡¡) *
Default
¡¡* 1
.
¡¡1 2!
IdRolEntidadInterna
¡¡2 E
;
¡¡E F
var
√√ 
centroDeAtencion
√√ $
=
√√% &
_db
√√& )
.
√√) *
Actor_negocio
√√* 7
.
√√7 8
Where
√√8 =
(
√√= >
an
√√> @
=>
√√A C
an
√√D F
.
√√F G
id
√√G I
==
√√J L
id
√√M O
&&
√√P R
an
√√S U
.
√√U V
id_rol
√√V \
==
√√] _
idRol
√√` e
)
√√e f
.
√√f g
Select
√√g m
(
√√m n
an
√√n p
=>
√√q s
new
√√t w(
CentroDeAtencionExtendido√√x ë
{
ƒƒ 
Id
≈≈ 
=
≈≈ 
an
≈≈ 
.
≈≈ 
id
≈≈ 
,
≈≈ 
IdActor
∆∆ 
=
∆∆ 
an
∆∆  
.
∆∆  !
id_actor
∆∆! )
,
∆∆) *
Codigo
«« 
=
«« 
an
«« 
.
««  
codigo_negocio
««  .
,
««. /&
EstablecimientoComercial
»» ,
=
»»- .
new
»»/ 2&
EstablecimientoComercial
»»3 K
{
…… 
Id
   
=
   
(
   
int
   !
)
  ! "
an
  " $
.
  $ %$
id_actor_negocio_padre
  % ;
,
  ; <
Nombre
ÀÀ 
=
ÀÀ  
an
ÀÀ! #
.
ÀÀ# $
Actor_negocio2
ÀÀ$ 2
.
ÀÀ2 3
Actor
ÀÀ3 8
.
ÀÀ8 9
primer_nombre
ÀÀ9 F
,
ÀÀF G
NombreInterno
ÃÃ %
=
ÃÃ% &
an
ÃÃ' )
.
ÃÃ) *
Actor_negocio2
ÃÃ* 8
.
ÃÃ8 9
Actor
ÃÃ9 >
.
ÃÃ> ?
tercer_nombre
ÃÃ? L
}
ÕÕ 
,
ÕÕ 
Nombre
ŒŒ 
=
ŒŒ 
an
ŒŒ 
.
ŒŒ  
Actor
ŒŒ  %
.
ŒŒ% &
primer_nombre
ŒŒ& 3
,
ŒŒ3 4
ExtensionJson
œœ !
=
œœ" #
an
œœ$ &
.
œœ& '
extension_json
œœ' 5
,
œœ5 6 
DocumentoIdentidad
–– &
=
––& '
an
––( *
.
––* +
Actor
––+ 0
.
––0 1(
numero_documento_identidad
––1 K
,
––K L 
RolesHijosVigentes
—— &
=
——& '
an
——( *
.
——* +
Actor
——+ 0
.
——0 1
Actor_negocio
——1 >
.
——> ?
Where
——? D
(
——D E
an_
——E H
=>
——I K
an_
——L O
.
——O P
Rol
——P S
.
——S T
id_rol_padre
——T `
==
——a c
ActorSettings
——d q
.
——q r
Default
——r y
.
——y z"
IdRolEntidadInterna——z ç
&&——é ê
an_——ë î
.——î ï

es_vigente——ï ü
==——† ¢
true——£ ß
)——ß ®
.——® ©
Select——© Ø
(——Ø ∞
an__——∞ ¥
=>——µ ∑
an__——∏ º
.——º Ω
Rol——Ω ¿
)——¿ ¡
.——¡ ¬
Select——¬ »
(——» …
r——…  
=>——  Ã
new——Õ –
ItemGenerico——— ›
(——› ﬁ
)——ﬁ ﬂ
{——‡ ·
Id——· „
=——„ ‰
r——Â Ê
.——Ê Á
id——Á È
,——È Í
Nombre——Î Ò
=——Ò Ú
r——Û Ù
.——Ù ı
nombre——ı ˚
}——¸ ˝
)——˝ ˛
,——˛ ˇ
}
““ 
)
““ 
.
““ 
FirstOrDefault
““ !
(
““! "
)
““" #
;
““# $"
EstablecerParametros
‘‘ $
(
‘‘$ %
centroDeAtencion
‘‘% 5
,
‘‘5 6
_db
‘‘7 :
)
‘‘: ;
;
‘‘; <
return
’’ 
centroDeAtencion
’’ '
;
’’' (
}
÷÷ 
catch
◊◊ 
(
◊◊ 
	Exception
◊◊ 
e
◊◊ 
)
◊◊ 
{
ÿÿ 
throw
ŸŸ 
e
ŸŸ 
;
ŸŸ 
}
⁄⁄ 
}
€€ 	
public
›› 
int
›› S
EObtenerIdDelCentroDeAtencionQueTieneLosPreciosSegunIdCentroDeAtencion
›› X
(
››X Y
int
››Y \
idCentroAtencion
››] m
)
››m n
{
ﬁﬁ 	
try
ﬂﬂ 
{
‡‡ 
SigescomEntities
··  
_db
··! $
=
··% &
new
··' *
SigescomEntities
··+ ;
(
··; <
)
··< =
;
··= >
int
‚‚ 
idRol
‚‚ 
=
‚‚ 
ActorSettings
‚‚ )
.
‚‚) *
Default
‚‚* 1
.
‚‚1 2!
IdRolEntidadInterna
‚‚2 E
;
‚‚E F
var
‰‰ 
parametroPrecio
‰‰ #
=
‰‰$ %
_db
‰‰& )
.
‰‰) *
Actor_negocio
‰‰* 7
.
‰‰7 8
Where
‰‰8 =
(
‰‰= >
an
‰‰> @
=>
‰‰A C
an
‰‰D F
.
‰‰F G
id
‰‰G I
==
‰‰J L
idCentroAtencion
‰‰M ]
&&
‰‰^ `
an
‰‰a c
.
‰‰c d
id_rol
‰‰d j
==
‰‰k m
idRol
‰‰n s
)
‰‰s t
.
‰‰t u
FirstOrDefault‰‰u É
(‰‰É Ñ
)‰‰Ñ Ö
.‰‰Ö Ü
Actor_negocio2‰‰Ü î
.‰‰î ï'
Parametro_actor_negocio‰‰ï ¨
.‰‰¨ ≠
SingleOrDefault‰‰≠ º
(‰‰º Ω
pcn‰‰Ω ¿
=>‰‰¡ √
pcn‰‰ƒ «
.‰‰« »
id_parametro‰‰» ‘
==‰‰’ ◊
MaestroSettings‰‰ÿ Á
.‰‰Á Ë
Default‰‰Ë Ô
.‰‰Ô O
?IdDetalleMaestroParametroIdCentroDeAtencionParaObtencionPrecios‰‰ Ø
)‰‰Ø ∞
;‰‰∞ ±
int
ÂÂ 6
(IdCentroDeAtencionParaObtencionDePrecios
ÂÂ <
=
ÂÂ= >
parametroPrecio
ÂÂ? N
!=
ÂÂO Q
null
ÂÂR V
?
ÂÂW X
Convert
ÂÂY `
.
ÂÂ` a
ToInt32
ÂÂa h
(
ÂÂh i
parametroPrecio
ÂÂi x
.
ÂÂx y
valor
ÂÂy ~
)
ÂÂ~ 
:ÂÂÄ Å
$numÂÂÇ É
;ÂÂÉ Ñ
return
ÊÊ 6
(IdCentroDeAtencionParaObtencionDePrecios
ÊÊ ?
;
ÊÊ? @
}
ÁÁ 
catch
ËË 
(
ËË 
	Exception
ËË 
e
ËË 
)
ËË 
{
ÈÈ 
throw
ÍÍ 
e
ÍÍ 
;
ÍÍ 
}
ÎÎ 
}
ÏÏ 	
public
ÓÓ 
IEnumerable
ÓÓ 
<
ÓÓ 
CentroDeAtencion
ÓÓ +
>
ÓÓ+ ,K
=ObtenerCentrosDeAtencionConPrecioDeCadaEstablecimientoVigente
ÓÓ- j
(
ÓÓj k
)
ÓÓk l
{
ÔÔ 	
try
 
{
ÒÒ 
int
ÚÚ 
[
ÚÚ 
]
ÚÚ %
idsRolesEstablecimiento
ÚÚ -
=
ÚÚ. /
new
ÚÚ0 3
int
ÚÚ4 7
[
ÚÚ7 8
]
ÚÚ8 9
{
ÚÚ: ;
ActorSettings
ÚÚ< I
.
ÚÚI J
Default
ÚÚJ Q
.
ÚÚQ R
IdRolSucursal
ÚÚR _
,
ÚÚ_ `
ActorSettings
ÚÚa n
.
ÚÚn o
Default
ÚÚo v
.
ÚÚv w
	IdRolSedeÚÚw Ä
}ÚÚÅ Ç
;ÚÚÇ É
SigescomEntities
ÛÛ  
_db
ÛÛ! $
=
ÛÛ% &
new
ÛÛ' *
SigescomEntities
ÛÛ+ ;
(
ÛÛ; <
)
ÛÛ< =
;
ÛÛ= >
var
ÙÙ )
idsCentrosAtencionConPrecio
ÙÙ /
=
ÙÙ0 1
_db
ÙÙ2 5
.
ÙÙ5 6
Actor_negocio
ÙÙ6 C
.
ÙÙC D
Where
ÙÙD I
(
ÙÙI J
an
ÙÙJ L
=>
ÙÙM O%
idsRolesEstablecimiento
ÙÙP g
.
ÙÙg h
Contains
ÙÙh p
(
ÙÙp q
an
ÙÙq s
.
ÙÙs t
id_rol
ÙÙt z
)
ÙÙz {
&&
ÙÙ| ~
anÙÙ Å
.ÙÙÅ Ç

es_vigenteÙÙÇ å
==ÙÙç è
trueÙÙê î
)ÙÙî ï
.ÙÙï ñ

SelectManyÙÙñ †
(ÙÙ† °
anÙÙ° £
=>ÙÙ§ ¶
anÙÙß ©
.ÙÙ© ™'
Parametro_actor_negocioÙÙ™ ¡
)ÙÙ¡ ¬
.ÙÙ¬ √
WhereÙÙ√ »
(ÙÙ» …
panÙÙ… Ã
=>ÙÙÕ œ
panÙÙ– ”
.ÙÙ” ‘
id_parametroÙÙ‘ ‡
==ÙÙ· „
MaestroSettingsÙÙ‰ Û
.ÙÙÛ Ù
DefaultÙÙÙ ˚
.ÙÙ˚ ¸O
?IdDetalleMaestroParametroIdCentroDeAtencionParaObtencionPreciosÙÙ¸ ª
)ÙÙª º
.ÙÙº Ω
SelectÙÙΩ √
(ÙÙ√ ƒ
panÙÙƒ «
=>ÙÙ»  
panÙÙÀ Œ
.ÙÙŒ œ
valorÙÙœ ‘
)ÙÙ‘ ’
.ÙÙ’ ÷
ToListÙÙ÷ ‹
(ÙÙ‹ ›
)ÙÙ› ﬁ
.ÙÙﬁ ﬂ
SelectÙÙﬂ Â
(ÙÙÂ Ê
intÙÙÊ È
.ÙÙÈ Í
ParseÙÙÍ Ô
)ÙÙÔ 
.ÙÙ Ò
ToListÙÙÒ ˜
(ÙÙ˜ ¯
)ÙÙ¯ ˘
;ÙÙ˘ ˙
var
ıı 7
)centrosAtencionVigentesDeEstablecimientos
ıı =
=
ıı> ?
_db
ıı@ C
.
ııC D
Actor_negocio
ııD Q
.
ˆˆ 
Where
ˆˆ 
(
ˆˆ 
an
ˆˆ 
=>
ˆˆ  )
idsCentrosAtencionConPrecio
ˆˆ! <
.
ˆˆ< =
Contains
ˆˆ= E
(
ˆˆE F
an
ˆˆF H
.
ˆˆH I
id
ˆˆI K
)
ˆˆK L
)
ˆˆL M
.
ˆˆM N
Select
ˆˆN T
(
ˆˆT U
an
ˆˆU W
=>
ˆˆX Z
new
ˆˆ[ ^
CentroDeAtencion
ˆˆ_ o
(
ˆˆo p
)
ˆˆp q
{
˜˜ 
Id
¯¯ 
=
¯¯ 
an
¯¯ 
.
¯¯  
id
¯¯  "
,
¯¯" #
IdActor
˘˘ 
=
˘˘  !
an
˘˘" $
.
˘˘$ %
id_actor
˘˘% -
,
˘˘- .
Codigo
˙˙ 
=
˙˙  
an
˙˙! #
.
˙˙# $
codigo_negocio
˙˙$ 2
,
˙˙2 3&
EstablecimientoComercial
˚˚ 0
=
˚˚1 2
new
˚˚3 6&
EstablecimientoComercial
˚˚7 O
{
¸¸ 
Id
˝˝ 
=
˝˝  
(
˝˝! "
int
˝˝" %
)
˝˝% &
an
˝˝& (
.
˝˝( )$
id_actor_negocio_padre
˝˝) ?
,
˝˝? @
Nombre
˛˛ "
=
˛˛# $
an
˛˛% '
.
˛˛' (
Actor_negocio2
˛˛( 6
.
˛˛6 7
Actor
˛˛7 <
.
˛˛< =
primer_nombre
˛˛= J
,
˛˛J K
NombreInterno
ˇˇ )
=
ˇˇ* +
an
ˇˇ, .
.
ˇˇ. /
Actor_negocio2
ˇˇ/ =
.
ˇˇ= >
Actor
ˇˇ> C
.
ˇˇC D
tercer_nombre
ˇˇD Q
}
ÄÄ 
,
ÄÄ 
Nombre
ÅÅ 
=
ÅÅ  
an
ÅÅ! #
.
ÅÅ# $
Actor
ÅÅ$ )
.
ÅÅ) *
primer_nombre
ÅÅ* 7
,
ÅÅ7 8
ExtensionJson
ÇÇ %
=
ÇÇ& '
an
ÇÇ( *
.
ÇÇ* +
extension_json
ÇÇ+ 9
}
ÉÉ 
)
ÉÉ 
;
ÉÉ 
return
ÑÑ 7
)centrosAtencionVigentesDeEstablecimientos
ÑÑ @
;
ÑÑ@ A
}
ÖÖ 
catch
ÜÜ 
(
ÜÜ 
	Exception
ÜÜ 
e
ÜÜ 
)
ÜÜ 
{
áá 
throw
àà 
e
àà 
;
àà 
}
ââ 
}
ää 	
public
åå 
int
åå P
BObtenerIdDelCentroDeAtencionQueTieneElStockSegunIdCentroDeAtencion
åå U
(
ååU V
int
ååV Y
idCentroAtencion
ååZ j
)
ååj k
{
çç 	
try
éé 
{
èè 
SigescomEntities
êê  
_db
êê! $
=
êê% &
new
êê' *
SigescomEntities
êê+ ;
(
êê; <
)
êê< =
;
êê= >
int
ëë 
idRol
ëë 
=
ëë 
ActorSettings
ëë )
.
ëë) *
Default
ëë* 1
.
ëë1 2!
IdRolEntidadInterna
ëë2 E
;
ëëE F
var
íí 
parametroPrecio
íí #
=
íí$ %
_db
íí& )
.
íí) *
Actor_negocio
íí* 7
.
íí7 8
Where
íí8 =
(
íí= >
an
íí> @
=>
ííA C
an
ííD F
.
ííF G
id
ííG I
==
ííJ L
idCentroAtencion
ííM ]
&&
íí^ `
an
íía c
.
ííc d
id_rol
ííd j
==
íík m
idRol
íín s
)
íís t
.
íít u
FirstOrDefaultííu É
(ííÉ Ñ
)ííÑ Ö
.ííÖ Ü
Actor_negocio2ííÜ î
.ííî ï'
Parametro_actor_negocioííï ¨
.íí¨ ≠
SingleOrDefaultíí≠ º
(ííº Ω
pcnííΩ ¿
=>íí¡ √
pcnííƒ «
.íí« »
id_parametroíí» ‘
==íí’ ◊
MaestroSettingsííÿ Á
.ííÁ Ë
DefaultííË Ô
.ííÔ M
=IdDetalleMaestroParametroIdCentroDeAtencionParaObtencionStockíí ≠
)íí≠ Æ
;ííÆ Ø
int
ìì 4
&IdCentroDeAtencionParaObtencionDeStock
ìì :
=
ìì; <
parametroPrecio
ìì= L
!=
ììM O
null
ììP T
?
ììU V
Convert
ììW ^
.
ìì^ _
ToInt32
ìì_ f
(
ììf g
parametroPrecio
ììg v
.
ììv w
valor
ììw |
)
ìì| }
:
ìì~ 
$numììÄ Å
;ììÅ Ç
return
îî 4
&IdCentroDeAtencionParaObtencionDeStock
îî =
;
îî= >
}
ïï 
catch
ññ 
(
ññ 
	Exception
ññ 
e
ññ 
)
ññ 
{
óó 
throw
òò 
e
òò 
;
òò 
}
ôô 
}
öö 	
public
úú 
string
úú -
ObtenerNombreDeCentroDeAtencion
úú 5
(
úú5 6
int
úú6 9
id
úú: <
)
úú< =
{
ùù 	
try
ûû 
{
üü 
SigescomEntities
††  
_db
††! $
=
††% &
new
††' *
SigescomEntities
††+ ;
(
††; <
)
††< =
;
††= >
int
°° 
idRol
°° 
=
°° 
ActorSettings
°° )
.
°°) *
Default
°°* 1
.
°°1 2!
IdRolEntidadInterna
°°2 E
;
°°E F
return
¢¢ 
_db
¢¢ 
.
¢¢ 
Actor_negocio
¢¢ (
.
¢¢( )
SingleOrDefault
¢¢) 8
(
¢¢8 9
an
¢¢9 ;
=>
¢¢< >
an
¢¢? A
.
¢¢A B
id
¢¢B D
==
¢¢E G
id
¢¢H J
&&
¢¢K M
an
¢¢N P
.
¢¢P Q
id_rol
¢¢Q W
==
¢¢X Z
idRol
¢¢[ `
)
¢¢` a
.
¢¢a b
Actor
¢¢b g
.
¢¢g h
primer_nombre
¢¢h u
.
¢¢u v
Replace
¢¢v }
(
¢¢} ~
$str¢¢~ Å
,¢¢Å Ç
$str¢¢É Ü
)¢¢Ü á
;¢¢á à
}
££ 
catch
§§ 
(
§§ 
	Exception
§§ 
e
§§ 
)
§§ 
{
•• 
throw
¶¶ 
new
¶¶ 
DatosException
¶¶ (
(
¶¶( )
$str
¶¶) R
,
¶¶R S
e
¶¶T U
)
¶¶U V
;
¶¶V W
}
ßß 
}
®® 	
public
™™ '
CentroDeAtencionExtendido
™™ (D
6ObtenerCentroDeAtencionExtendidosSegunSerieComprobante
™™) _
(
™™_ `
int
™™` c 
idSerieComprobante
™™d v
)
™™v w
{
´´ 	
try
¨¨ 
{
≠≠ 
SigescomEntities
ÆÆ  
_db
ÆÆ! $
=
ÆÆ% &
new
ÆÆ' *
SigescomEntities
ÆÆ+ ;
(
ÆÆ; <
)
ÆÆ< =
;
ÆÆ= >
int
ØØ 
idRol
ØØ 
=
ØØ 
ActorSettings
ØØ )
.
ØØ) *
Default
ØØ* 1
.
ØØ1 2!
IdRolEntidadInterna
ØØ2 E
;
ØØE F
var
∞∞ 
centroDeAtencion
∞∞ $
=
∞∞$ %
_db
∞∞& )
.
∞∞) *
Serie_comprobante
∞∞* ;
.
∞∞; <
Where
∞∞< A
(
∞∞A B
sc
∞∞B D
=>
∞∞E G
sc
∞∞H J
.
∞∞J K
id
∞∞K M
==
∞∞N P 
idSerieComprobante
∞∞Q c
)
∞∞c d
.
∞∞d e
Select
∞∞e k
(
∞∞k l
an
∞∞l n
=>
∞∞o q
an
∞∞r t
.
∞∞t u
Actor_negocio∞∞u Ç
)∞∞Ç É
.∞∞É Ñ
Select∞∞Ñ ä
(∞∞ä ã
an∞∞ã ç
=>∞∞é ê
new∞∞ë î)
CentroDeAtencionExtendido∞∞ï Æ
{
±± 
Id
≤≤ 
=
≤≤ 
an
≤≤ 
.
≤≤ 
id
≤≤ 
,
≤≤ 
IdActor
≥≥ 
=
≥≥ 
an
≥≥  
.
≥≥  !
id_actor
≥≥! )
,
≥≥) *
Codigo
¥¥ 
=
¥¥ 
an
¥¥ 
.
¥¥  
codigo_negocio
¥¥  .
,
¥¥. /&
EstablecimientoComercial
µµ ,
=
µµ- .
new
µµ/ 2&
EstablecimientoComercial
µµ3 K
{
∂∂ 
Id
∑∑ 
=
∑∑ 
(
∑∑ 
int
∑∑ !
)
∑∑! "
an
∑∑" $
.
∑∑$ %$
id_actor_negocio_padre
∑∑% ;
,
∑∑; <
Nombre
∏∏ 
=
∏∏  
an
∏∏! #
.
∏∏# $
Actor_negocio2
∏∏$ 2
.
∏∏2 3
Actor
∏∏3 8
.
∏∏8 9
primer_nombre
∏∏9 F
,
∏∏F G
NombreInterno
ππ %
=
ππ& '
an
ππ( *
.
ππ* +
Actor_negocio2
ππ+ 9
.
ππ9 :
Actor
ππ: ?
.
ππ? @
tercer_nombre
ππ@ M
}
∫∫ 
,
∫∫ 
Nombre
ªª 
=
ªª 
an
ªª 
.
ªª  
Actor
ªª  %
.
ªª% &
primer_nombre
ªª& 3
,
ªª3 4
ExtensionJson
ºº !
=
ºº" #
an
ºº$ &
.
ºº& '
extension_json
ºº' 5
,
ºº5 6 
DocumentoIdentidad
ΩΩ &
=
ΩΩ' (
an
ΩΩ) +
.
ΩΩ+ ,
Actor
ΩΩ, 1
.
ΩΩ1 2(
numero_documento_identidad
ΩΩ2 L
,
ΩΩL M 
RolesHijosVigentes
ææ &
=
ææ' (
an
ææ) +
.
ææ+ ,
Actor
ææ, 1
.
ææ1 2
Actor_negocio
ææ2 ?
.
ææ? @
Where
ææ@ E
(
ææE F
an_
ææF I
=>
ææJ L
an_
ææM P
.
ææP Q
Rol
ææQ T
.
ææT U
id_rol_padre
ææU a
==
ææb d
ActorSettings
ææe r
.
æær s
Default
ææs z
.
ææz {"
IdRolEntidadInternaææ{ é
&&ææè ë
an_ææí ï
.ææï ñ

es_vigenteææñ †
==ææ° £
trueææ§ ®
)ææ® ©
.ææ© ™
Selectææ™ ∞
(ææ∞ ±
an__ææ± µ
=>ææ∂ ∏
an__ææπ Ω
.ææΩ æ
Rolæææ ¡
)ææ¡ ¬
.ææ¬ √
Selectææ√ …
(ææ…  
rææ  À
=>ææÃ Œ
newææœ “
ItemGenericoææ” ﬂ
(ææﬂ ‡
)ææ‡ ·
{ææ‚ „
Idææ‰ Ê
=ææÁ Ë
rææÈ Í
.ææÍ Î
idææÎ Ì
,ææÌ Ó
NombreææÔ ı
=ææˆ ˜
rææ¯ ˘
.ææ˘ ˙
nombreææ˙ Ä
}ææÅ Ç
)ææÇ É
,ææÉ Ñ
}
øø 
)
øø 
.
øø 
FirstOrDefault
øø !
(
øø! "
)
øø" #
;
øø# $"
EstablecerParametros
¿¿ $
(
¿¿$ %
centroDeAtencion
¿¿% 5
,
¿¿5 6
_db
¿¿7 :
)
¿¿: ;
;
¿¿; <
return
¡¡ 
centroDeAtencion
¡¡ '
;
¡¡' (
}
¬¬ 
catch
√√ 
(
√√ 
	Exception
√√ 
e
√√ 
)
√√ 
{
ƒƒ 
throw
≈≈ 
e
≈≈ 
;
≈≈ 
}
∆∆ 
}
«« 	
public
   
IEnumerable
   
<
   '
CentroDeAtencionExtendido
   4
>
  4 5S
EObtenerCentrosDeAtencionExtendidosVigentesPorEstablecimientoComercial
  6 {
(
  { |
int  } Ä!
idEstablecimiento  Å í
)  í ì
{
ÀÀ 	
int
ÃÃ 
idRol
ÃÃ 
=
ÃÃ 
ActorSettings
ÃÃ %
.
ÃÃ% &
Default
ÃÃ& -
.
ÃÃ- .!
IdRolEntidadInterna
ÃÃ. A
;
ÃÃA B
SigescomEntities
ÕÕ 
_db
ÕÕ  
=
ÕÕ! "
new
ÕÕ# &
SigescomEntities
ÕÕ' 7
(
ÕÕ7 8
)
ÕÕ8 9
;
ÕÕ9 :
return
ŒŒ 
_db
ŒŒ 
.
ŒŒ 
Actor_negocio
ŒŒ $
.
ŒŒ$ %
Where
ŒŒ% *
(
ŒŒ* +
an
ŒŒ+ -
=>
ŒŒ. 0
an
ŒŒ1 3
.
ŒŒ3 4

es_vigente
ŒŒ4 >
==
ŒŒ? A
true
ŒŒB F
&&
ŒŒG I
an
ŒŒJ L
.
ŒŒL M
id_rol
ŒŒM S
==
ŒŒT V
idRol
ŒŒW \
&&
ŒŒ] _
an
ŒŒ` b
.
ŒŒb c$
id_actor_negocio_padre
ŒŒc y
==
ŒŒz | 
idEstablecimientoŒŒ} é
)ŒŒé è
.ŒŒè ê
SelectŒŒê ñ
(ŒŒñ ó
anŒŒó ô
=>ŒŒö ú
newŒŒù †)
CentroDeAtencionExtendidoŒŒ° ∫
{
œœ 
Id
–– 
=
–– 
an
–– 
.
–– 
id
–– 
,
–– 
IdActor
—— 
=
—— 
an
—— 
.
—— 
id_actor
—— %
,
——% &
Codigo
““ 
=
““ 
an
““ 
.
““ 
codigo_negocio
““ *
,
““* +&
EstablecimientoComercial
”” (
=
””) *
new
””+ .&
EstablecimientoComercial
””/ G
{
‘‘ 
Id
’’ 
=
’’ 
(
’’ 
int
’’ 
)
’’ 
an
’’  
.
’’  !$
id_actor_negocio_padre
’’! 7
,
’’7 8
Nombre
÷÷ 
=
÷÷ 
an
÷÷ 
.
÷÷  
Actor_negocio2
÷÷  .
.
÷÷. /
Actor
÷÷/ 4
.
÷÷4 5
primer_nombre
÷÷5 B
,
÷÷B C
NombreInterno
◊◊ !
=
◊◊" #
an
◊◊$ &
.
◊◊& '
Actor_negocio2
◊◊' 5
.
◊◊5 6
Actor
◊◊6 ;
.
◊◊; <
tercer_nombre
◊◊< I
}
ÿÿ 
,
ÿÿ 
Nombre
ŸŸ 
=
ŸŸ 
an
ŸŸ 
.
ŸŸ 
Actor
ŸŸ !
.
ŸŸ! "
primer_nombre
ŸŸ" /
,
ŸŸ/ 0
ExtensionJson
⁄⁄ 
=
⁄⁄ 
an
⁄⁄  "
.
⁄⁄" #
extension_json
⁄⁄# 1
,
⁄⁄1 2 
DocumentoIdentidad
€€ "
=
€€# $
an
€€% '
.
€€' (
Actor
€€( -
.
€€- .(
numero_documento_identidad
€€. H
,
€€H I 
RolesHijosVigentes
‹‹ "
=
‹‹# $
an
‹‹% '
.
‹‹' (
Actor
‹‹( -
.
‹‹- .
Actor_negocio
‹‹. ;
.
‹‹; <
Where
‹‹< A
(
‹‹A B
an_
‹‹B E
=>
‹‹F H
an_
‹‹I L
.
‹‹L M
Rol
‹‹M P
.
‹‹P Q
id_rol_padre
‹‹Q ]
==
‹‹^ `
ActorSettings
‹‹a n
.
‹‹n o
Default
‹‹o v
.
‹‹v w"
IdRolEntidadInterna‹‹w ä
&&‹‹ã ç
an_‹‹é ë
.‹‹ë í

es_vigente‹‹í ú
==‹‹ù ü
true‹‹† §
)‹‹§ •
.‹‹• ¶
Select‹‹¶ ¨
(‹‹¨ ≠
an__‹‹≠ ±
=>‹‹≤ ¥
an__‹‹µ π
.‹‹π ∫
Rol‹‹∫ Ω
)‹‹Ω æ
.‹‹æ ø
Select‹‹ø ≈
(‹‹≈ ∆
r‹‹∆ «
=>‹‹»  
new‹‹À Œ
ItemGenerico‹‹œ €
(‹‹€ ‹
)‹‹‹ ›
{‹‹ﬁ ﬂ
Id‹‹‡ ‚
=‹‹„ ‰
r‹‹Â Ê
.‹‹Ê Á
id‹‹Á È
,‹‹È Í
Nombre‹‹Î Ò
=‹‹Ú Û
r‹‹Ù ı
.‹‹ı ˆ
nombre‹‹ˆ ¸
}‹‹˝ ˛
)‹‹˛ ˇ
,‹‹ˇ Ä
}
›› 
)
›› 
.
›› 
ToList
›› 
(
›› 
)
›› 
;
›› 
}
ﬁﬁ 	
public
·· 
IEnumerable
·· 
<
·· 
ItemGenerico
·· +
>
··+ ,D
6ObtenerCentrosDeAtencionComoItemsGenericosSegunRolHijo
··- c
(
··c d
int
··d g
	idRolHijo
··h q
,
··q r
bool
··s w
	esVigente··x Å
)··Å Ç
{
‚‚ 	
SigescomEntities
„„ 
_db
„„  
=
„„! "
new
„„# &
SigescomEntities
„„' 7
(
„„7 8
)
„„8 9
;
„„9 :
var
‰‰ 
idParentRol
‰‰ 
=
‰‰ 
ActorSettings
‰‰ +
.
‰‰+ ,
Default
‰‰, 3
.
‰‰3 4!
IdRolEntidadInterna
‰‰4 G
;
‰‰G H
var
ÂÂ 
centrosDeAtencion
ÂÂ !
=
ÂÂ" #
_db
ÂÂ$ '
.
ÂÂ' (
Actor_negocio
ÂÂ( 5
.
ÊÊ 
Where
ÊÊ 
(
ÊÊ 
an
ÊÊ 
=>
ÊÊ 
an
ÊÊ 
.
ÊÊ  
id_rol
ÊÊ  &
==
ÊÊ' )
	idRolHijo
ÊÊ* 3
&&
ÊÊ4 6
an
ÊÊ7 9
.
ÊÊ9 :

es_vigente
ÊÊ: D
==
ÊÊE G
	esVigente
ÊÊH Q
)
ÊÊQ R
.
ÊÊR S
Select
ÁÁ 
(
ÁÁ 
an
ÁÁ 
=>
ÁÁ 
an
ÁÁ 
.
ÁÁ  
Actor
ÁÁ  %
)
ÁÁ% &
.
ÁÁ& '

SelectMany
ÁÁ' 1
(
ÁÁ1 2
a
ÁÁ2 3
=>
ÁÁ4 6
a
ÁÁ7 8
.
ÁÁ8 9
Actor_negocio
ÁÁ9 F
)
ÁÁF G
.
ÁÁG H
Where
ËË 
(
ËË 
an
ËË 
=>
ËË 
an
ËË 
.
ËË 
id_rol
ËË %
==
ËË& (
idParentRol
ËË) 4
&&
ËË5 7
an
ËË8 :
.
ËË: ;

es_vigente
ËË; E
==
ËËF H
	esVigente
ËËI R
)
ËËR S
.
ËËS T
Select
ËËT Z
(
ËËZ [
an
ËË[ ]
=>
ËË^ `
new
ËËa d
ItemGenerico
ËËe q
{
ÈÈ 
Id
ÍÍ 
=
ÍÍ 
an
ÍÍ 
.
ÍÍ 
id
ÍÍ 
,
ÍÍ 
Codigo
ÎÎ 
=
ÎÎ 
an
ÎÎ 
.
ÎÎ  
codigo_negocio
ÎÎ  .
,
ÎÎ. /
Nombre
ÏÏ 
=
ÏÏ 
an
ÏÏ 
.
ÏÏ  
Actor
ÏÏ  %
.
ÏÏ% &
primer_nombre
ÏÏ& 3
,
ÏÏ3 4
}
ÌÌ 
)
ÌÌ 
.
ÌÌ 
ToList
ÌÌ 
(
ÌÌ 
)
ÌÌ 
;
ÌÌ 
return
ÓÓ 
centrosDeAtencion
ÓÓ $
;
ÓÓ$ %
}
ÔÔ 	
public
 
IEnumerable
 
<
 
ItemGenerico
 '
>
' (G
9ObtenerCentrosDeAtencionComoItemsGenericosSegunRolesHijos
) b
(
b c
int
c f
[
f g
]
g h
idsRolesHijo
i u
,
u v
bool
w {
	esVigente| Ö
)Ö Ü
{
ÒÒ 	
SigescomEntities
ÚÚ 
_db
ÚÚ  
=
ÚÚ! "
new
ÚÚ# &
SigescomEntities
ÚÚ' 7
(
ÚÚ7 8
)
ÚÚ8 9
;
ÚÚ9 :
var
ÛÛ 
idParentRol
ÛÛ 
=
ÛÛ 
ActorSettings
ÛÛ +
.
ÛÛ+ ,
Default
ÛÛ, 3
.
ÛÛ3 4!
IdRolEntidadInterna
ÛÛ4 G
;
ÛÛG H
var
ÙÙ 
centrosDeAtencion
ÙÙ !
=
ÙÙ" #
_db
ÙÙ$ '
.
ÙÙ' (
Actor_negocio
ÙÙ( 5
.
ıı 
Where
ıı 
(
ıı 
an
ıı 
=>
ıı 
idsRolesHijo
ıı )
.
ıı) *
Contains
ıı* 2
(
ıı2 3
an
ıı3 5
.
ıı5 6
id_rol
ıı6 <
)
ıı< =
&&
ıı> @
an
ııA C
.
ııC D

es_vigente
ııD N
==
ııO Q
	esVigente
ııR [
)
ıı[ \
.
ıı\ ]
Select
ˆˆ 
(
ˆˆ 
an
ˆˆ 
=>
ˆˆ 
an
ˆˆ 
.
ˆˆ  
Actor
ˆˆ  %
)
ˆˆ% &
.
ˆˆ& '

SelectMany
ˆˆ' 1
(
ˆˆ1 2
a
ˆˆ2 3
=>
ˆˆ4 6
a
ˆˆ7 8
.
ˆˆ8 9
Actor_negocio
ˆˆ9 F
)
ˆˆF G
.
ˆˆG H
Where
˜˜ 
(
˜˜ 
an
˜˜ 
=>
˜˜ 
an
˜˜ 
.
˜˜ 
id_rol
˜˜ %
==
˜˜& (
idParentRol
˜˜) 4
&&
˜˜5 7
an
˜˜8 :
.
˜˜: ;

es_vigente
˜˜; E
==
˜˜F H
	esVigente
˜˜I R
)
˜˜R S
.
˜˜S T
Select
˜˜T Z
(
˜˜Z [
an
˜˜[ ]
=>
˜˜^ `
new
˜˜a d
ItemGenerico
˜˜e q
{
¯¯ 
Id
˘˘ 
=
˘˘ 
an
˘˘ 
.
˘˘ 
id
˘˘ 
,
˘˘ 
Codigo
˙˙ 
=
˙˙ 
an
˙˙ 
.
˙˙  
codigo_negocio
˙˙  .
,
˙˙. /
Nombre
˚˚ 
=
˚˚ 
an
˚˚ 
.
˚˚  
Actor
˚˚  %
.
˚˚% &
primer_nombre
˚˚& 3
,
˚˚3 4
}
¸¸ 
)
¸¸ 
.
¸¸ 
ToList
¸¸ 
(
¸¸ 
)
¸¸ 
;
¸¸ 
return
˝˝ 
centrosDeAtencion
˝˝ $
;
˝˝$ %
}
˛˛ 	
public
ˇˇ 
IEnumerable
ˇˇ 
<
ˇˇ 
CentroDeAtencion
ˇˇ +
>
ˇˇ+ ,2
$ObtenerCentrosDeAtencionSegunRolHijo
ˇˇ- Q
(
ˇˇQ R
int
ˇˇR U
	idRolHijo
ˇˇV _
,
ˇˇ_ `
bool
ˇˇa e
	esVigente
ˇˇf o
)
ˇˇo p
{
ÄÄ 	
SigescomEntities
ÅÅ 
_db
ÅÅ  
=
ÅÅ! "
new
ÅÅ# &
SigescomEntities
ÅÅ' 7
(
ÅÅ7 8
)
ÅÅ8 9
;
ÅÅ9 :
var
ÇÇ 
idParentRol
ÇÇ 
=
ÇÇ 
ActorSettings
ÇÇ +
.
ÇÇ+ ,
Default
ÇÇ, 3
.
ÇÇ3 4!
IdRolEntidadInterna
ÇÇ4 G
;
ÇÇG H
var
ÉÉ 
centrosDeAtencion
ÉÉ !
=
ÉÉ" #
_db
ÉÉ$ '
.
ÉÉ' (
Actor_negocio
ÉÉ( 5
.
ÑÑ 
Where
ÑÑ 
(
ÑÑ 
an
ÑÑ 
=>
ÑÑ 
an
ÑÑ 
.
ÑÑ  
id_rol
ÑÑ  &
==
ÑÑ' )
	idRolHijo
ÑÑ* 3
&&
ÑÑ4 6
an
ÑÑ7 9
.
ÑÑ9 :

es_vigente
ÑÑ: D
==
ÑÑE G
	esVigente
ÑÑH Q
)
ÑÑQ R
.
ÑÑR S
Select
ÖÖ 
(
ÖÖ 
an
ÖÖ 
=>
ÖÖ 
an
ÖÖ 
.
ÖÖ  
Actor
ÖÖ  %
)
ÖÖ% &
.
ÖÖ& '

SelectMany
ÖÖ' 1
(
ÖÖ1 2
a
ÖÖ2 3
=>
ÖÖ4 6
a
ÖÖ7 8
.
ÖÖ8 9
Actor_negocio
ÖÖ9 F
)
ÖÖF G
.
ÖÖG H
Where
ÜÜ 
(
ÜÜ 
an
ÜÜ 
=>
ÜÜ 
an
ÜÜ 
.
ÜÜ 
id_rol
ÜÜ %
==
ÜÜ& (
idParentRol
ÜÜ) 4
&&
ÜÜ5 7
an
ÜÜ8 :
.
ÜÜ: ;

es_vigente
ÜÜ; E
==
ÜÜF H
	esVigente
ÜÜI R
)
ÜÜR S
.
ÜÜS T
Select
ÜÜT Z
(
ÜÜZ [
an
ÜÜ[ ]
=>
ÜÜ^ `
new
ÜÜa d
CentroDeAtencion
ÜÜe u
{
áá 
Id
àà 
=
àà 
an
àà 
.
àà 
id
àà 
,
àà 
IdActor
ââ 
=
ââ 
an
ââ  
.
ââ  !
id_actor
ââ! )
,
ââ) *
Codigo
ää 
=
ää 
an
ää 
.
ää  
codigo_negocio
ää  .
,
ää. /&
EstablecimientoComercial
ãã ,
=
ãã- .
new
ãã/ 2&
EstablecimientoComercial
ãã3 K
{
åå 
Id
çç 
=
çç 
(
çç 
int
çç !
)
çç! "
an
çç" $
.
çç$ %$
id_actor_negocio_padre
çç% ;
,
çç; <
Nombre
éé 
=
éé  
an
éé! #
.
éé# $
Actor_negocio2
éé$ 2
.
éé2 3
Actor
éé3 8
.
éé8 9
primer_nombre
éé9 F
,
ééF G
NombreInterno
èè %
=
èè& '
an
èè( *
.
èè* +
Actor_negocio2
èè+ 9
.
èè9 :
Actor
èè: ?
.
èè? @
tercer_nombre
èè@ M
}
êê 
,
êê 
Nombre
ëë 
=
ëë 
an
ëë 
.
ëë  
Actor
ëë  %
.
ëë% &
primer_nombre
ëë& 3
,
ëë3 4
ExtensionJson
íí !
=
íí" #
an
íí$ &
.
íí& '
extension_json
íí' 5
}
ìì 
)
ìì 
.
ìì 
ToList
ìì 
(
ìì 
)
ìì 
;
ìì 
return
îî 
centrosDeAtencion
îî $
;
îî$ %
}
ïï 	
public
ññ 
IEnumerable
ññ 
<
ññ '
CentroDeAtencionExtendido
ññ 4
>
ññ4 5<
.ObtenerCentrosDeAtencionExtendidosSegunRolHijo
ññ6 d
(
ññd e
int
ññe h
	idRolHijo
ññi r
,
ññr s
bool
ññt x
	esVigenteññy Ç
)ññÇ É
{
óó 	
SigescomEntities
òò 
_db
òò  
=
òò! "
new
òò# &
SigescomEntities
òò' 7
(
òò7 8
)
òò8 9
;
òò9 :
var
ôô 
idParentRol
ôô 
=
ôô 
ActorSettings
ôô +
.
ôô+ ,
Default
ôô, 3
.
ôô3 4!
IdRolEntidadInterna
ôô4 G
;
ôôG H
var
öö 
centrosDeAtencion
öö !
=
öö" #
_db
öö$ '
.
öö' (
Actor_negocio
öö( 5
.
õõ 
Where
õõ 
(
õõ 
an
õõ 
=>
õõ 
an
õõ 
.
õõ  
id_rol
õõ  &
==
õõ' )
	idRolHijo
õõ* 3
&&
õõ4 6
an
õõ7 9
.
õõ9 :

es_vigente
õõ: D
==
õõE G
	esVigente
õõH Q
)
õõQ R
.
õõR S
Select
úú 
(
úú 
an
úú 
=>
úú 
an
úú 
.
úú  
Actor
úú  %
)
úú% &
.
úú& '

SelectMany
úú' 1
(
úú1 2
a
úú2 3
=>
úú4 6
a
úú7 8
.
úú8 9
Actor_negocio
úú9 F
)
úúF G
.
úúG H
Where
ùù 
(
ùù 
an
ùù 
=>
ùù 
an
ùù 
.
ùù 
id_rol
ùù %
==
ùù& (
idParentRol
ùù) 4
&&
ùù5 7
an
ùù8 :
.
ùù: ;

es_vigente
ùù; E
==
ùùF H
	esVigente
ùùI R
)
ùùR S
.
ùùS T
Select
ùùT Z
(
ùùZ [
an
ùù[ ]
=>
ùù^ `
new
ùùa d'
CentroDeAtencionExtendido
ùùe ~
{
ûû 
Id
üü 
=
üü 
an
üü 
.
üü 
id
üü 
,
üü 
IdActor
†† 
=
†† 
an
††  
.
††  !
id_actor
††! )
,
††) *
Codigo
°° 
=
°° 
an
°° 
.
°°  
codigo_negocio
°°  .
,
°°. /&
EstablecimientoComercial
¢¢ ,
=
¢¢- .
new
¢¢/ 2&
EstablecimientoComercial
¢¢3 K
{
££ 
Id
§§ 
=
§§ 
(
§§ 
int
§§ !
)
§§! "
an
§§" $
.
§§$ %$
id_actor_negocio_padre
§§% ;
,
§§; <
Nombre
•• 
=
••  
an
••! #
.
••# $
Actor_negocio2
••$ 2
.
••2 3
Actor
••3 8
.
••8 9
primer_nombre
••9 F
,
••F G
NombreInterno
¶¶ %
=
¶¶& '
an
¶¶( *
.
¶¶* +
Actor_negocio2
¶¶+ 9
.
¶¶9 :
Actor
¶¶: ?
.
¶¶? @
tercer_nombre
¶¶@ M
}
ßß 
,
ßß 
Nombre
®® 
=
®® 
an
®® 
.
®®  
Actor
®®  %
.
®®% &
primer_nombre
®®& 3
,
®®3 4
ExtensionJson
©© !
=
©©" #
an
©©$ &
.
©©& '
extension_json
©©' 5
,
©©5 6 
DocumentoIdentidad
™™ &
=
™™' (
an
™™) +
.
™™+ ,
Actor
™™, 1
.
™™1 2(
numero_documento_identidad
™™2 L
,
™™L M 
RolesHijosVigentes
´´ &
=
´´' (
an
´´) +
.
´´+ ,
Actor
´´, 1
.
´´1 2
Actor_negocio
´´2 ?
.
´´? @
Where
´´@ E
(
´´E F
an_
´´F I
=>
´´J L
an_
´´M P
.
´´P Q
Rol
´´Q T
.
´´T U
id_rol_padre
´´U a
==
´´b d
ActorSettings
´´e r
.
´´r s
Default
´´s z
.
´´z {"
IdRolEntidadInterna´´{ é
&&´´è ë
an_´´í ï
.´´ï ñ

es_vigente´´ñ †
==´´° £
true´´§ ®
)´´® ©
.´´© ™
Select´´™ ∞
(´´∞ ±
an__´´± µ
=>´´∂ ∏
an__´´π Ω
.´´Ω æ
Rol´´æ ¡
)´´¡ ¬
.´´¬ √
Select´´√ …
(´´…  
r´´  À
=>´´Ã Œ
new´´œ “
ItemGenerico´´” ﬂ
(´´ﬂ ‡
)´´‡ ·
{´´‚ „
Id´´‰ Ê
=´´Á Ë
r´´È Í
.´´Í Î
id´´Î Ì
,´´Ì Ó
Nombre´´Ô ı
=´´ˆ ˜
r´´¯ ˘
.´´˘ ˙
nombre´´˙ Ä
}´´Å Ç
)´´Ç É
,´´É Ñ
}
¨¨ 
)
¨¨ 
.
¨¨ 
ToList
¨¨ 
(
¨¨ 
)
¨¨ 
;
¨¨ "
EstablecerParametros
ÆÆ  
(
ÆÆ  !
centrosDeAtencion
ÆÆ! 2
,
ÆÆ2 3
_db
ÆÆ4 7
)
ÆÆ7 8
;
ÆÆ8 9
return
∞∞ 
centrosDeAtencion
∞∞ $
;
∞∞$ %
}
≤≤ 	
public
¥¥ 
IEnumerable
¥¥ 
<
¥¥ '
CentroDeAtencionExtendido
¥¥ 4
>
¥¥4 5Z
KObtenerCentrosDeAtencionExtendidosVigentesSegunRolYEstablecimientoComercial¥¥6 Å
(¥¥Å Ç
int¥¥Ç Ö
idRol¥¥Ü ã
,¥¥ã å
int¥¥ç ê!
idEstablecimiento¥¥ë ¢
)¥¥¢ £
{
µµ 	
var
∂∂ 
idParentRol
∂∂ 
=
∂∂ 
ActorSettings
∂∂ +
.
∂∂+ ,
Default
∂∂, 3
.
∂∂3 4!
IdRolEntidadInterna
∂∂4 G
;
∂∂G H
SigescomEntities
∑∑ 
_db
∑∑  
=
∑∑! "
new
∑∑# &
SigescomEntities
∑∑' 7
(
∑∑7 8
)
∑∑8 9
;
∑∑9 :
var
∏∏ 
centrosDeAtencion
∏∏ !
=
∏∏" #
_db
∏∏$ '
.
∏∏' (
Actor_negocio
∏∏( 5
.
∏∏5 6
Where
∏∏6 ;
(
∏∏; <
an
∏∏< >
=>
∏∏? A
an
∏∏B D
.
∏∏D E
id_rol
∏∏E K
==
∏∏L N
idRol
∏∏O T
&&
∏∏U W
an
∏∏X Z
.
∏∏Z [

es_vigente
∏∏[ e
)
∏∏e f
.
∏∏f g
Select
ππ 
(
ππ 
an
ππ 
=>
ππ 
an
ππ 
.
ππ  
Actor
ππ  %
)
ππ% &
.
ππ& '

SelectMany
ππ' 1
(
ππ1 2
a
ππ2 3
=>
ππ4 6
a
ππ7 8
.
ππ8 9
Actor_negocio
ππ9 F
)
ππF G
.
ππG H
Where
∫∫ 
(
∫∫ 
an
∫∫ 
=>
∫∫ 
an
∫∫ 
.
∫∫ $
id_actor_negocio_padre
∫∫ 5
==
∫∫6 8
idEstablecimiento
∫∫9 J
&&
∫∫K M
an
∫∫N P
.
∫∫P Q
id_rol
∫∫Q W
==
∫∫X Z
idParentRol
∫∫[ f
&&
∫∫g i
an
∫∫j l
.
∫∫l m

es_vigente
∫∫m w
)
∫∫w x
.
∫∫x y
Select
∫∫y 
(∫∫ Ä
an∫∫Ä Ç
=>∫∫É Ö
new∫∫Ü â)
CentroDeAtencionExtendido∫∫ä £
{
ªª 
Id
ºº 
=
ºº 
an
ºº 
.
ºº 
id
ºº 
,
ºº 
IdActor
ΩΩ 
=
ΩΩ 
an
ΩΩ  
.
ΩΩ  !
id_actor
ΩΩ! )
,
ΩΩ) *
Codigo
ææ 
=
ææ 
an
ææ 
.
ææ  
codigo_negocio
ææ  .
,
ææ. /&
EstablecimientoComercial
øø ,
=
øø- .
new
øø/ 2&
EstablecimientoComercial
øø3 K
{
¿¿ 
Id
¡¡ 
=
¡¡ 
(
¡¡ 
int
¡¡ !
)
¡¡! "
an
¡¡" $
.
¡¡$ %$
id_actor_negocio_padre
¡¡% ;
,
¡¡; <
Nombre
¬¬ 
=
¬¬  
an
¬¬! #
.
¬¬# $
Actor_negocio2
¬¬$ 2
.
¬¬2 3
Actor
¬¬3 8
.
¬¬8 9
primer_nombre
¬¬9 F
,
¬¬F G
NombreInterno
√√ %
=
√√& '
an
√√( *
.
√√* +
Actor_negocio2
√√+ 9
.
√√9 :
Actor
√√: ?
.
√√? @
tercer_nombre
√√@ M
}
ƒƒ 
,
ƒƒ 
Nombre
≈≈ 
=
≈≈ 
an
≈≈ 
.
≈≈  
Actor
≈≈  %
.
≈≈% &
primer_nombre
≈≈& 3
,
≈≈3 4
ExtensionJson
∆∆ !
=
∆∆" #
an
∆∆$ &
.
∆∆& '
extension_json
∆∆' 5
,
∆∆5 6 
DocumentoIdentidad
«« &
=
««' (
an
««) +
.
««+ ,
Actor
««, 1
.
««1 2(
numero_documento_identidad
««2 L
,
««L M 
RolesHijosVigentes
»» &
=
»»' (
an
»») +
.
»»+ ,
Actor
»», 1
.
»»1 2
Actor_negocio
»»2 ?
.
»»? @
Where
»»@ E
(
»»E F
an_
»»F I
=>
»»J L
an_
»»M P
.
»»P Q
Rol
»»Q T
.
»»T U
id_rol_padre
»»U a
==
»»b d
ActorSettings
»»e r
.
»»r s
Default
»»s z
.
»»z {"
IdRolEntidadInterna»»{ é
&&»»è ë
an_»»í ï
.»»ï ñ

es_vigente»»ñ †
==»»° £
true»»§ ®
)»»® ©
.»»© ™
Select»»™ ∞
(»»∞ ±
an__»»± µ
=>»»∂ ∏
an__»»π Ω
.»»Ω æ
Rol»»æ ¡
)»»¡ ¬
.»»¬ √
Select»»√ …
(»»…  
r»»  À
=>»»Ã Œ
new»»œ “
ItemGenerico»»” ﬂ
(»»ﬂ ‡
)»»‡ ·
{»»‚ „
Id»»‰ Ê
=»»Á Ë
r»»È Í
.»»Í Î
id»»Î Ì
,»»Ì Ó
Nombre»»Ô ı
=»»ˆ ˜
r»»¯ ˘
.»»˘ ˙
nombre»»˙ Ä
}»»Å Ç
)»»Ç É
,»»É Ñ
}
…… 
)
…… 
.
…… 
ToList
…… 
(
…… 
)
…… 
;
…… "
EstablecerParametros
ÀÀ  
(
ÀÀ  !
centrosDeAtencion
ÀÀ! 2
,
ÀÀ2 3
_db
ÀÀ4 7
)
ÀÀ7 8
;
ÀÀ8 9
return
ÕÕ 
centrosDeAtencion
ÕÕ $
;
ÕÕ$ %
}
œœ 	
public
—— 
int
—— 
[
—— 
]
—— T
FObtenerIdsDeCentrosDeAtencionVigentesSegunRolYEstablecimientoComercial
—— [
(
——[ \
int
——\ _
idRol
——` e
,
——e f
int
——g j!
idActorNegocioPadre
——k ~
)
——~ 
{
““ 	
var
”” 
idParentRol
”” 
=
”” 
ActorSettings
”” +
.
””+ ,
Default
””, 3
.
””3 4!
IdRolEntidadInterna
””4 G
;
””G H
SigescomEntities
‘‘ 
_db
‘‘  
=
‘‘! "
new
‘‘# &
SigescomEntities
‘‘' 7
(
‘‘7 8
)
‘‘8 9
;
‘‘9 :
return
’’ 
_db
’’ 
.
’’ 
Actor_negocio
’’ $
.
÷÷ 
Where
÷÷ 
(
÷÷ 
an
÷÷ 
=>
÷÷ 
an
÷÷ 
.
÷÷  
id_rol
÷÷  &
==
÷÷' )
idRol
÷÷* /
&&
÷÷0 2
an
÷÷3 5
.
÷÷5 6

es_vigente
÷÷6 @
)
÷÷@ A
.
÷÷A B
Select
◊◊ 
(
◊◊ 
an
◊◊ 
=>
◊◊ 
an
◊◊ 
.
◊◊  
Actor
◊◊  %
)
◊◊% &
.
◊◊& '

SelectMany
◊◊' 1
(
◊◊1 2
a
◊◊2 3
=>
◊◊4 6
a
◊◊7 8
.
◊◊8 9
Actor_negocio
◊◊9 F
)
◊◊F G
.
◊◊G H
Where
ÿÿ 
(
ÿÿ 
an
ÿÿ 
=>
ÿÿ 
an
ÿÿ 
.
ÿÿ $
id_actor_negocio_padre
ÿÿ 5
==
ÿÿ6 8!
idActorNegocioPadre
ÿÿ9 L
&&
ÿÿM O
an
ÿÿP R
.
ÿÿR S
id_rol
ÿÿS Y
==
ÿÿZ \
idParentRol
ÿÿ] h
&&
ÿÿi k
an
ÿÿl n
.
ÿÿn o

es_vigente
ÿÿo y
)
ÿÿy z
.
ÿÿz {
Selectÿÿ{ Å
(ÿÿÅ Ç
anÿÿÇ Ñ
=>ÿÿÖ á
anÿÿà ä
.ÿÿä ã
idÿÿã ç
)ÿÿç é
.ÿÿé è
ToArrayÿÿè ñ
(ÿÿñ ó
)ÿÿó ò
;ÿÿò ô
}
ŸŸ 	
public
€€ 
IEnumerable
€€ 
<
€€ '
CentroDeAtencionExtendido
€€ 4
>
€€4 5U
GObtenerCentrosDeAtencionExtendidosVigentesSegunRolIdsDeEstablecimientos
€€6 }
(
€€} ~
int€€~ Å
idRol€€Ç á
,€€á à
List€€â ç
<€€ç é
int€€é ë
>€€ë í#
idsEstablecimientos€€ì ¶
)€€¶ ß
{
‹‹ 	
var
›› 
idParentRol
›› 
=
›› 
ActorSettings
›› +
.
››+ ,
Default
››, 3
.
››3 4!
IdRolEntidadInterna
››4 G
;
››G H
SigescomEntities
ﬁﬁ 
_db
ﬁﬁ  
=
ﬁﬁ! "
new
ﬁﬁ# &
SigescomEntities
ﬁﬁ' 7
(
ﬁﬁ7 8
)
ﬁﬁ8 9
;
ﬁﬁ9 :
var
ﬂﬂ 
centrosDeAtencion
ﬂﬂ !
=
ﬂﬂ" #
_db
ﬂﬂ$ '
.
ﬂﬂ' (
Actor_negocio
ﬂﬂ( 5
.
‡‡ 
Where
‡‡ 
(
‡‡ 
an
‡‡ 
=>
‡‡ 
an
‡‡ 
.
‡‡  
id_rol
‡‡  &
==
‡‡' )
idRol
‡‡* /
&&
‡‡0 2
an
‡‡3 5
.
‡‡5 6

es_vigente
‡‡6 @
)
‡‡@ A
.
‡‡A B
Select
·· 
(
·· 
an
·· 
=>
·· 
an
·· 
.
··  
Actor
··  %
)
··% &
.
··& '

SelectMany
··' 1
(
··1 2
a
··2 3
=>
··4 6
a
··7 8
.
··8 9
Actor_negocio
··9 F
)
··F G
.
··G H
Where
‚‚ 
(
‚‚ 
an
‚‚ 
=>
‚‚ !
idsEstablecimientos
‚‚ /
.
‚‚/ 0
Contains
‚‚0 8
(
‚‚8 9
(
‚‚9 :
int
‚‚: =
)
‚‚= >
an
‚‚> @
.
‚‚@ A$
id_actor_negocio_padre
‚‚A W
)
‚‚W X
&&
‚‚Y [
an
‚‚\ ^
.
‚‚^ _
id_rol
‚‚_ e
==
‚‚f h
idParentRol
‚‚i t
&&
‚‚u w
an
‚‚x z
.
‚‚z {

es_vigente‚‚{ Ö
)‚‚Ö Ü
.‚‚Ü á
Select‚‚á ç
(‚‚ç é
an‚‚é ê
=>‚‚ë ì
new‚‚î ó)
CentroDeAtencionExtendido‚‚ò ±
{
„„ 
Id
‰‰ 
=
‰‰ 
an
‰‰ 
.
‰‰ 
id
‰‰ 
,
‰‰ 
IdActor
ÂÂ 
=
ÂÂ 
an
ÂÂ  
.
ÂÂ  !
id_actor
ÂÂ! )
,
ÂÂ) *
Codigo
ÊÊ 
=
ÊÊ 
an
ÊÊ 
.
ÊÊ  
codigo_negocio
ÊÊ  .
,
ÊÊ. /&
EstablecimientoComercial
ÁÁ ,
=
ÁÁ- .
new
ÁÁ/ 2&
EstablecimientoComercial
ÁÁ3 K
{
ËË 
Id
ÈÈ 
=
ÈÈ 
(
ÈÈ 
int
ÈÈ !
)
ÈÈ! "
an
ÈÈ" $
.
ÈÈ$ %$
id_actor_negocio_padre
ÈÈ% ;
,
ÈÈ; <
Nombre
ÍÍ 
=
ÍÍ  
an
ÍÍ! #
.
ÍÍ# $
Actor_negocio2
ÍÍ$ 2
.
ÍÍ2 3
Actor
ÍÍ3 8
.
ÍÍ8 9
primer_nombre
ÍÍ9 F
,
ÍÍF G
NombreInterno
ÎÎ %
=
ÎÎ& '
an
ÎÎ( *
.
ÎÎ* +
Actor_negocio2
ÎÎ+ 9
.
ÎÎ9 :
Actor
ÎÎ: ?
.
ÎÎ? @
tercer_nombre
ÎÎ@ M
}
ÏÏ 
,
ÏÏ 
Nombre
ÌÌ 
=
ÌÌ 
an
ÌÌ 
.
ÌÌ  
Actor
ÌÌ  %
.
ÌÌ% &
primer_nombre
ÌÌ& 3
,
ÌÌ3 4
ExtensionJson
ÓÓ !
=
ÓÓ" #
an
ÓÓ$ &
.
ÓÓ& '
extension_json
ÓÓ' 5
,
ÓÓ5 6 
DocumentoIdentidad
ÔÔ &
=
ÔÔ' (
an
ÔÔ) +
.
ÔÔ+ ,
Actor
ÔÔ, 1
.
ÔÔ1 2(
numero_documento_identidad
ÔÔ2 L
,
ÔÔL M 
RolesHijosVigentes
 &
=
' (
an
) +
.
+ ,
Actor
, 1
.
1 2
Actor_negocio
2 ?
.
? @
Where
@ E
(
E F
an_
F I
=>
J L
an_
M P
.
P Q
Rol
Q T
.
T U
id_rol_padre
U a
==
b d
ActorSettings
e r
.
r s
Default
s z
.
z {"
IdRolEntidadInterna{ é
&&è ë
an_í ï
.ï ñ

es_vigenteñ †
==° £
true§ ®
)® ©
.© ™
Select™ ∞
(∞ ±
an__± µ
=>∂ ∏
an__π Ω
.Ω æ
Rolæ ¡
)¡ ¬
.¬ √
Select√ …
(…  
r  À
=>Ã Œ
newœ “
ItemGenerico” ﬂ
(ﬂ ‡
)‡ ·
{‚ „
Id‰ Ê
=Á Ë
rÈ Í
.Í Î
idÎ Ì
,Ì Ó
NombreÔ ı
=ˆ ˜
r¯ ˘
.˘ ˙
nombre˙ Ä
}Å Ç
)Ç É
,É Ñ
}
ÒÒ 
)
ÒÒ 
.
ÒÒ 
ToList
ÒÒ 
(
ÒÒ 
)
ÒÒ 
;
ÒÒ "
EstablecerParametros
ÚÚ  
(
ÚÚ  !
centrosDeAtencion
ÚÚ! 2
,
ÚÚ2 3
_db
ÚÚ4 7
)
ÚÚ7 8
;
ÚÚ8 9
return
ÛÛ 
centrosDeAtencion
ÛÛ $
;
ÛÛ$ %
;
ÛÛ& '
}
ÙÙ 	
public
ˆˆ '
CentroDeAtencionExtendido
ˆˆ (Y
KObtenerCentroDeAtencionExtendidoPorIdDeCentroDeAtencionEIdDeEstablecimiento
ˆˆ) t
(
ˆˆt u
int
ˆˆu x
idCentroAtencionˆˆy â
,ˆˆâ ä
intˆˆã é!
idEstablecimientoˆˆè †
)ˆˆ† °
{
˜˜ 	
try
¯¯ 
{
˘˘ 
var
˙˙ 
idRol
˙˙ 
=
˙˙ 
ActorSettings
˙˙ )
.
˙˙) *
Default
˙˙* 1
.
˙˙1 2!
IdRolEntidadInterna
˙˙2 E
;
˙˙E F
SigescomEntities
˚˚ 
_db
˚˚  
=
˚˚! "
new
˚˚# &
SigescomEntities
˚˚' 7
(
˚˚7 8
)
˚˚8 9
;
˚˚9 :
var
¸¸ 
centroDeAtencion
¸¸ $
=
¸¸$ %
_db
¸¸& )
.
¸¸) *
Actor_negocio
¸¸* 7
.
¸¸7 8
Include
¸¸8 ?
(
¸¸? @
an
¸¸@ B
=>
¸¸C E
an
¸¸F H
.
¸¸H I
Actor_negocio_rol
¸¸I Z
)
¸¸Z [
.
¸¸[ \
Include
¸¸\ c
(
¸¸c d
an
¸¸d f
=>
¸¸g i
an
¸¸j l
.
¸¸l m
Actor
¸¸m r
)
¸¸r s
.
¸¸s t
Include
¸¸t {
(
¸¸{ |
an
¸¸| ~
=>¸¸ Å
an¸¸Ç Ñ
.¸¸Ñ Ö
Actor¸¸Ö ä
.¸¸ä ã
Actor_negocio¸¸ã ò
)¸¸ò ô
.¸¸ô ö
Include
˝˝ 
(
˝˝ 
an
˝˝ 
=>
˝˝ 
an
˝˝  
.
˝˝  !
Actor
˝˝! &
.
˝˝& '
	Direccion
˝˝' 0
)
˝˝0 1
.
˝˝1 2
Where
˝˝2 7
(
˝˝7 8
an
˝˝8 :
=>
˝˝; =
an
˝˝> @
.
˝˝@ A
id
˝˝A C
==
˝˝D F
idCentroAtencion
˝˝G W
&&
˝˝X Z
an
˝˝[ ]
.
˝˝] ^
id_rol
˝˝^ d
==
˝˝e g
idRol
˝˝h m
&&
˝˝n p
an
˝˝q s
.
˝˝s t%
id_actor_negocio_padre˝˝t ä
==˝˝ã ç!
idEstablecimiento˝˝é ü
)˝˝ü †
.˝˝† °
Select˝˝° ß
(˝˝ß ®
an˝˝® ™
=>˝˝´ ≠
new˝˝Æ ±)
CentroDeAtencionExtendido˝˝≤ À
{
˛˛ 
Id
ˇˇ 
=
ˇˇ 
an
ˇˇ 
.
ˇˇ 
id
ˇˇ 
,
ˇˇ 
IdActor
ÄÄ 
=
ÄÄ 
an
ÄÄ  
.
ÄÄ  !
id_actor
ÄÄ! )
,
ÄÄ) *
Codigo
ÅÅ 
=
ÅÅ 
an
ÅÅ 
.
ÅÅ  
codigo_negocio
ÅÅ  .
,
ÅÅ. /&
EstablecimientoComercial
ÇÇ ,
=
ÇÇ- .
new
ÇÇ/ 2&
EstablecimientoComercial
ÇÇ3 K
{
ÉÉ 
Id
ÑÑ 
=
ÑÑ 
(
ÑÑ 
int
ÑÑ !
)
ÑÑ! "
an
ÑÑ" $
.
ÑÑ$ %$
id_actor_negocio_padre
ÑÑ% ;
,
ÑÑ; <
Nombre
ÖÖ 
=
ÖÖ  
an
ÖÖ! #
.
ÖÖ# $
Actor_negocio2
ÖÖ$ 2
.
ÖÖ2 3
Actor
ÖÖ3 8
.
ÖÖ8 9
primer_nombre
ÖÖ9 F
,
ÖÖF G
NombreInterno
ÜÜ %
=
ÜÜ& '
an
ÜÜ( *
.
ÜÜ* +
Actor_negocio2
ÜÜ+ 9
.
ÜÜ9 :
Actor
ÜÜ: ?
.
ÜÜ? @
tercer_nombre
ÜÜ@ M
}
áá 
,
áá 
Nombre
àà 
=
àà 
an
àà 
.
àà  
Actor
àà  %
.
àà% &
primer_nombre
àà& 3
,
àà3 4
ExtensionJson
ââ !
=
ââ" #
an
ââ$ &
.
ââ& '
extension_json
ââ' 5
,
ââ5 6 
DocumentoIdentidad
ää &
=
ää' (
an
ää) +
.
ää+ ,
Actor
ää, 1
.
ää1 2(
numero_documento_identidad
ää2 L
,
ääL M 
RolesHijosVigentes
ãã &
=
ãã' (
an
ãã) +
.
ãã+ ,
Actor
ãã, 1
.
ãã1 2
Actor_negocio
ãã2 ?
.
ãã? @
Where
ãã@ E
(
ããE F
an_
ããF I
=>
ããJ L
an_
ããM P
.
ããP Q
Rol
ããQ T
.
ããT U
id_rol_padre
ããU a
==
ããb d
ActorSettings
ããe r
.
ããr s
Default
ããs z
.
ããz {"
IdRolEntidadInternaãã{ é
&&ããè ë
an_ããí ï
.ããï ñ

es_vigenteããñ †
==ãã° £
trueãã§ ®
)ãã® ©
.ãã© ™
Selectãã™ ∞
(ãã∞ ±
an__ãã± µ
=>ãã∂ ∏
an__ããπ Ω
.ããΩ æ
Rolããæ ¡
)ãã¡ ¬
.ãã¬ √
Selectãã√ …
(ãã…  
rãã  À
=>ããÃ Œ
newããœ “
ItemGenericoãã” ﬂ
(ããﬂ ‡
)ãã‡ ·
{ãã‚ „
Idãã‰ Ê
=ããÁ Ë
rããÈ Í
.ããÍ Î
idããÎ Ì
,ããÌ Ó
NombreããÔ ı
=ããˆ ˜
rãã¯ ˘
.ãã˘ ˙
nombreãã˙ Ä
}ããÅ Ç
)ããÇ É
,ããÉ Ñ
}
åå 
)
åå 
.
åå 
FirstOrDefault
åå !
(
åå! "
)
åå" #
;
åå# $"
EstablecerParametros
çç $
(
çç$ %
centroDeAtencion
çç% 5
,
çç5 6
_db
çç7 :
)
çç: ;
;
çç; <
return
éé 
centroDeAtencion
éé '
;
éé' (
}
èè 
catch
êê 
(
êê 
	Exception
êê 
e
êê 
)
êê 
{
ëë 
throw
íí 
e
íí 
;
íí 
}
ìì 
}
îî 	
public
ññ 
bool
ññ #
TieneInventarioActual
ññ )
(
ññ) *
int
ññ* - 
idCentroDeAtencion
ññ. @
)
ññ@ A
{
óó 	
try
òò 
{
ôô 
SigescomEntities
öö  
_db
öö! $
=
öö% &
new
öö' *
SigescomEntities
öö+ ;
(
öö; <
)
öö< =
;
öö= >
return
úú 
_db
úú 
.
úú 
Transaccion
úú &
.
úú& '
Any
úú' *
(
úú* +
t
úú+ ,
=>
úú- /
t
úú0 1
.
úú1 2&
id_actor_negocio_interno
úú2 J
==
úúK M 
idCentroDeAtencion
úúN `
&&
ùù0 2
t
ùù3 4
.
ùù4 5!
id_tipo_transaccion
ùù5 H
==
ùùI K!
TransaccionSettings
ùùL _
.
ùù_ `
Default
ùù` g
.
ùùg h0
!IdTipoTransaccionInventarioActualùùh â
&&
ûû0 2
t
ûû3 4
.
ûû4 5
id_estado_actual
ûû5 E
==
ûûF H
MaestroSettings
ûûI X
.
ûûX Y
Default
ûûY `
.
ûû` a/
 IdDetalleMaestroEstadoConfirmadoûûa Å
)ûûÅ Ç
;ûûÇ É
}
üü 
catch
†† 
(
†† 
	Exception
†† 
e
†† 
)
†† 
{
°° 
throw
¢¢ 
new
¢¢ 
DatosException
¢¢ (
(
¢¢( )
$str
¢¢) r
,
¢¢r s
e
¢¢t u
)
¢¢u v
;
¢¢v w
}
££ 
}
§§ 	
public
¶¶ 
OperationResult
¶¶ M
?ActualizarDocumentoIdentidadDeTodosLosCentrosDeAtencionVigentes
¶¶ ^
(
¶¶^ _
string
¶¶_ e 
documentoIdentidad
¶¶f x
)
¶¶x y
{
ßß 	
SigescomEntities
®® 
_db
®®  
=
®®! "
new
®®# &
SigescomEntities
®®' 7
(
®®7 8
)
®®8 9
;
®®9 :
var
©© 
idRol
©© 
=
©© 
ActorSettings
©© %
.
©©% &
Default
©©& -
.
©©- .!
IdRolEntidadInterna
©©. A
;
©©A B
var
™™ 
actores
™™ 
=
™™ 
_db
™™ 
.
™™ 
Actor_negocio
™™ +
.
™™+ ,
Where
™™, 1
(
™™1 2
an
™™2 4
=>
™™5 7
an
™™8 :
.
™™: ;
id_rol
™™; A
==
™™B D
idRol
™™E J
&&
™™K M
an
™™N P
.
™™P Q

es_vigente
™™Q [
==
™™\ ^
true
™™_ c
)
™™c d
.
™™d e
Select
™™e k
(
™™k l
an
™™l n
=>
™™o q
an
™™r t
.
™™t u
Actor
™™u z
)
™™z {
.
™™{ |
ToList™™| Ç
(™™Ç É
)™™É Ñ
;™™Ñ Ö
actores
´´ 
.
´´ 
ForEach
´´ 
(
´´ 
a
´´ 
=>
´´  
a
´´! "
.
´´" #(
numero_documento_identidad
´´# =
=
´´> ? 
documentoIdentidad
´´@ R
)
´´R S
;
´´S T
_db
¨¨ 
.
¨¨ 
SaveChanges
¨¨ 
(
¨¨ 
)
¨¨ 
;
¨¨ 
return
≠≠ 
new
≠≠ 
OperationResult
≠≠ &
(
≠≠& '!
OperationResultEnum
≠≠' :
.
≠≠: ;
Success
≠≠; B
)
≠≠B C
;
≠≠C D
}
ÆÆ 	
}
ØØ 
}∞∞ ËS
TD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\Empleado\Empleado_Datos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
." #
Empleado# +
{ 
public 

partial 
class 
Empleado_Datos '
:' (!
IEmpleado_Repositorio) >
{ 
public 
	Empleado_ 
ObtenerEmpleado (
(( )
string) /
	idUsuario0 9
)9 :
{ 	
SigescomEntities 
_db  
=! "
new# &
SigescomEntities' 7
(7 8
)8 9
;9 :
var 
empleado 
= 
_db 
. 
Actor_negocio ,
., -
Where- 2
(2 3
an3 5
=>6 8
an9 ;
.; <
id_rol< B
==C E
ActorSettingsF S
.S T
DefaultT [
.[ \
IdRolEmpleado\ i
&&j l
anm o
.o p

id_usuariop z
=={ }
	idUsuario	~ á
)
á à
.
à â
ToList
â è
(
è ê
)
ê ë
.
ë í
Select
í ò
(
ò ô
an
ô õ
=>
ú û
new
ü ¢
	Empleado_
£ ¨
{ 
Id 
= 
an 
. 
id 
, 
IdActor 
= 
an 
. 
id_actor %
,% &
Nombres 
= 
an 
. 
Actor "
." #
primer_nombre# 0
.0 1
Split1 6
(6 7
$char7 :
): ;
[; <
$num< =
]= >
,> ?
ApellidoPaterno 
=  !
an" $
.$ %
Actor% *
.* +
primer_nombre+ 8
.8 9
Split9 >
(> ?
$char? B
)B C
[C D
$numD E
]E F
,F G
ApellidoMaterno 
=  !
an" $
.$ %
Actor% *
.* +
primer_nombre+ 8
.8 9
Split9 >
(> ?
$char? B
)B C
[C D
$numD E
]E F
,F G
NombreCorto 
= 
an  
.  !
Actor! &
.& '
tercer_nombre' 4
,4 5$
NumeroDocumentoIdentidad (
=) *
an+ -
.- .
Actor. 3
.3 4&
numero_documento_identidad4 N
,N O"
TipoDocumentoIdentidad &
=' (
new) ,
ItemGenerico- 9
{: ;
Id< >
=? @
anA C
.C D
ActorD I
.I J"
id_documento_identidadJ `
,` a
Nombreb h
=i j
ank m
.m n
Actorn s
.s t
Detalle_maestro	t É
.
É Ñ
nombre
Ñ ä
}
ã å
,
å ç
Roles 
= 
an 
. 
Actor  
.  !
Actor_negocio! .
.. /
Where/ 4
(4 5
_an5 8
=>9 ;
_an< ?
.? @

es_vigente@ J
)J K
.K L
SelectL R
(R S
__anS W
=>X Z
new[ ^
RolDeNegocio__ l
{ 
Id 
= 
__an 
. 
Rol !
.! "
id" $
,$ %
Nombre   
=   
__an   !
.  ! "
Rol  " %
.  % &
nombre  & ,
}!! 
)!! 
}"" 
)"" 
."" 
FirstOrDefault"" 
("" 
)"" 
;""  
return## 
empleado## 
;## 
}$$ 	
public%% 
	Empleado_%% 
ObtenerEmpleado%% (
(%%( )
int%%) ,
id%%- /
)%%/ 0
{&& 	
SigescomEntities'' 
_db''  
=''! "
new''# &
SigescomEntities''' 7
(''7 8
)''8 9
;''9 :
var)) 
empleado)) 
=)) 
_db)) 
.)) 
Actor_negocio)) ,
.)), -
Include))- 4
())4 5
an))5 7
=>))8 :
an)); =
.))= >
Actor))> C
)))C D
.))D E
Include))E L
())L M
an))M O
=>))P R
an))S U
.))U V
Actor))V [
.))[ \
Detalle_maestro))\ k
)))k l
.))l m
Where))m r
())r s
an))s u
=>))v x
an))y {
.)){ |
id))| ~
==	)) Å
id
))Ç Ñ
&&
))Ö á
an
))à ä
.
))ä ã
id_rol
))ã ë
==
))í î
ActorSettings
))ï ¢
.
))¢ £
Default
))£ ™
.
))™ ´
IdRolEmpleado
))´ ∏
)
))∏ π
.
))π ∫
ToList
))∫ ¿
(
))¿ ¡
)
))¡ ¬
.
))¬ √
Select
))√ …
(
))…  
an
))  Ã
=>
))Õ œ
new
))– ”
	Empleado_
))‘ ›
{** 
Id++ 
=++ 
an++ 
.++ 
id++ 
,++ 
IdActor,, 
=,, 
an,, 
.,, 
id_actor,, %
,,,% &
Nombres-- 
=-- 
an-- 
.-- 
Actor-- "
.--" #
primer_nombre--# 0
.--0 1
Split--1 6
(--6 7
$char--7 :
)--: ;
[--; <
$num--< =
]--= >
,--> ?
ApellidoPaterno.. 
=..  !
an.." $
...$ %
Actor..% *
...* +
primer_nombre..+ 8
...8 9
Split..9 >
(..> ?
$char..? B
)..B C
[..C D
$num..D E
]..E F
,..F G
ApellidoMaterno// 
=//  !
an//" $
.//$ %
Actor//% *
.//* +
primer_nombre//+ 8
.//8 9
Split//9 >
(//> ?
$char//? B
)//B C
[//C D
$num//D E
]//E F
,//F G
NombreCorto00 
=00 
an00  
.00  !
Actor00! &
.00& '
tercer_nombre00' 4
,004 5$
NumeroDocumentoIdentidad11 (
=11) *
an11+ -
.11- .
Actor11. 3
.113 4&
numero_documento_identidad114 N
,11N O"
TipoDocumentoIdentidad22 &
=22' (
new22) ,
ItemGenerico22- 9
{22: ;
Id22< >
=22? @
an22A C
.22C D
Actor22D I
.22I J"
id_documento_identidad22J `
,22` a
Nombre22b h
=22i j
an22k m
.22m n
Actor22n s
.22s t
Detalle_maestro	22t É
.
22É Ñ
nombre
22Ñ ä
}
22ã å
,
22å ç
Roles33 
=33 
an33 
.33 
Actor33  
.33  !
Actor_negocio33! .
.33. /
Where33/ 4
(334 5
_an335 8
=>339 ;
_an33< ?
.33? @

es_vigente33@ J
)33J K
.33K L
Select33L R
(33R S
__an33S W
=>33X Z
new33[ ^
RolDeNegocio_33_ l
{44 
Id55 
=55 
__an55 
.55 
Rol55 !
.55! "
id55" $
,55$ %
Nombre66 
=66 
__an66 !
.66! "
Rol66" %
.66% &
nombre66& ,
}77 
)77 
}88 
)88 
.88 
FirstOrDefault88 
(88 
)88 
;88  
return99 
empleado99 
;99 
}:: 	
public<< 
int<< 
	ObtenerId<< 
(<< 
string<< #
	idUsuario<<$ -
)<<- .
{== 	
SigescomEntities>> 
_db>>  
=>>! "
new>># &
SigescomEntities>>' 7
(>>7 8
)>>8 9
;>>9 :
try@@ 
{AA 
returnBB 
_dbBB 
.BB 
Actor_negocioBB (
.BB( )
SingleOrDefaultBB) 8
(BB8 9
anBB9 ;
=>BB< >
anBB? A
.BBA B

id_usuarioBBB L
==BBM O
	idUsuarioBBP Y
&&BBZ \
anBB] _
.BB_ `

es_vigenteBB` j
)BBj k
.BBk l
idBBl n
;BBn o
}CC 
catchDD 
(DD 
	ExceptionDD 
eDD 
)DD 
{EE 
throwFF 
newFF 
DatosExceptionFF (
(FF( )
$strFF) v
+FFw x
	idUsuario	FFy Ç
,
FFÇ É
e
FFÑ Ö
)
FFÖ Ü
;
FFÜ á
}GG 
}HH 	
publicJJ 
stringJJ 
ObtenerNombreJJ #
(JJ# $
stringJJ$ *
	idUsuarioJJ+ 4
)JJ4 5
{KK 	
SigescomEntitiesLL 
_dbLL  
=LL! "
newLL# &
SigescomEntitiesLL' 7
(LL7 8
)LL8 9
;LL9 :
tryNN 
{OO 
varPP 
usuarioPP 
=PP 
_dbPP !
.PP! "
Actor_negocioPP" /
.PP/ 0
SingleOrDefaultPP0 ?
(PP? @
anPP@ B
=>PPC E
anPPF H
.PPH I

id_usuarioPPI S
==PPT V
	idUsuarioPPW `
&&PPa c
anPPd f
.PPf g

es_vigentePPg q
)PPq r
;PPr s
returnQQ 
usuarioQQ 
.QQ 
PrimerNombreQQ +
+QQ, -
$strQQ. 1
+QQ2 3
usuarioQQ4 ;
.QQ; <
SegundoNombreQQ< I
+QQJ K
$strQQL O
+QQP Q
usuarioQQR Y
.QQY Z
TercerNombreQQZ f
;QQf g
}RR 
catchSS 
(SS 
	ExceptionSS 
eSS 
)SS 
{TT 
throwUU 
newUU 
DatosExceptionUU (
(UU( )
$strUU) z
+UU{ |
	idUsuario	UU} Ü
,
UUÜ á
e
UUà â
)
UUâ ä
;
UUä ã
}VV 
}WW 	
}XX 
}YY ®‘
UD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\Hotel\HotelReporte_Datos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
{ 
public 

class 
HotelReporte_Datos #
:$ %%
IHotelReporte_Repositorio& ?
{ 
public 
IEnumerable 
< 
RegistroHuesped *
>* +$
ObtenerRegistroHuespedes, D
(D E
intE H
idEstablecimientoI Z
,Z [
DateTime\ d

fechaDesdee o
,o p
DateTimeq y

fechaHasta	z Ñ
)
Ñ Ö
{ 	
SigescomEntities 
_db  
=! "
new# &
SigescomEntities' 7
(7 8
)8 9
;9 :
var 
registroHuespedes !
=" #
_db$ '
.' (
Estado_transaccion( :
.: ;
Where; @
(@ A
etA C
=>D F
etG I
.I J
fechaJ O
>=P R

fechaDesdeS ]
&&^ `
eta c
.c d
fechad i
<=j l

fechaHastam w
&&x z
({ |
et| ~
.~ 
	id_estado	 à
==
â ã
MaestroSettings
å õ
.
õ ú
Default
ú £
.
£ §-
IdDetalleMaestroEstadoCheckedIn
§ √
||
ƒ ∆
et
« …
.
…  
	id_estado
  ”
==
‘ ÷
MaestroSettings
◊ Ê
.
Ê Á
Default
Á Ó
.
Ó Ô3
%IdDetalleMaestroEstadoEntradaCambiado
Ô î
)
î ï
&&
ñ ò
et
ô õ
.
õ ú
Transaccion
ú ß
.
ß ®!
id_tipo_transaccion
® ª
==
º æ
HotelSettings
ø Ã
.
Ã Õ
Default
Õ ‘
.
‘ ’3
%IdTipoTransaccionAtencionDeHabitacion
’ ˙
&&
˚ ˝
et
˛ Ä
.
Ä Å
Transaccion
Å å
.
å ç
Actor_negocio2
ç õ
.
õ ú
Actor_negocio2
ú ™
.
™ ´$
id_actor_negocio_padre
´ ¡
==
¬ ƒ
idEstablecimiento
≈ ÷
)
÷ ◊
.
◊ ÿ

SelectMany
ÿ ‚
(
‚ „
et
„ Â
=>
Ê Ë
et
È Î
.
Î Ï
Transaccion
Ï ˜
.
˜ ¯+
Actor_negocio_por_transaccion
¯ ï
)
ï ñ
. 
Select 
( 
ant 
=> 
new "
RegistroHuesped# 2
(2 3
)3 4
{ 

IdAtencion 
=  
ant! $
.$ %
Transaccion% 0
.0 1
id1 3
,3 4
Huesped 
= 
ant !
.! "
Actor_negocio" /
./ 0
Actor0 5
.5 6
primer_nombre6 C
.C D
ReplaceD K
(K L
$strL O
,O P
$strQ T
)T U
,U V
EsMasculino   
=    !
ant  " %
.  % &
Actor_negocio  & 3
.  3 4
Actor  4 9
.  9 :
id_clase_actor  : H
==  I K
ActorSettings  L Y
.  Y Z
Default  Z a
.  a b!
IdClaseActorMasculino  b w
,  w x
IdPais!! 
=!! 
ant!!  
.!!  !
Actor_negocio!!! .
.!!. /
Actor!!/ 4
.!!4 5
	Direccion!!5 >
.!!> ?
FirstOrDefault!!? M
(!!M N
)!!N O
.!!O P
	id_nacion!!P Y
,!!Y Z
Nacionalidad""  
=""! "
ant""# &
.""& '
Actor_negocio""' 4
.""4 5
Actor""5 :
."": ;
Detalle_maestro1""; K
.""K L
valor""L Q
,""Q R
Pais## 
=## 
ant## 
.## 
Actor_negocio## ,
.##, -
Actor##- 2
.##2 3
	Direccion##3 <
.##< =
FirstOrDefault##= K
(##K L
)##L M
.##M N
Detalle_maestro1##N ^
.##^ _
nombre##_ e
,##e f
Ubigeo$$ 
=$$ 
ant$$  
.$$  !
Actor_negocio$$! .
.$$. /
Actor$$/ 4
.$$4 5
	Direccion$$5 >
.$$> ?
FirstOrDefault$$? M
($$M N
)$$N O
.$$O P
Ubigeo$$P V
.$$V W
descripcion_larga$$W h
,$$h i 
TipoDocumentoCliente%% (
=%%) *
ant%%+ .
.%%. /
Actor_negocio%%/ <
.%%< =
Actor%%= B
.%%B C
Detalle_maestro%%C R
.%%R S
valor%%S X
,%%X Y"
NumeroDocumentoCliente&& *
=&&+ ,
ant&&- 0
.&&0 1
Actor_negocio&&1 >
.&&> ?
Actor&&? D
.&&D E&
numero_documento_identidad&&E _
,&&_ `#
EstadoIngresoReferencia'' +
='', -
ant''. 1
.''1 2
Transaccion''2 =
.''= >
Transaccion3''> J
.''J K
Estado_transaccion''K ]
.''] ^
FirstOrDefault''^ l
(''l m
et''m o
=>''p r
et''s u
.''u v
	id_estado''v 
==
''Ä Ç
MaestroSettings
''É í
.
''í ì
Default
''ì ö
.
''ö õ-
IdDetalleMaestroEstadoCheckedIn
''õ ∫
)
''∫ ª
,
''ª º
EstadoIngreso(( !
=((" #
ant(($ '
.((' (
Transaccion((( 3
.((3 4
Estado_transaccion((4 F
.((F G
FirstOrDefault((G U
(((U V
et((V X
=>((Y [
et((\ ^
.((^ _
	id_estado((_ h
==((i k
MaestroSettings((l {
.(({ |
Default	((| É
.
((É Ñ-
IdDetalleMaestroEstadoCheckedIn
((Ñ £
)
((£ §
,
((§ •
EstadoSalida))  
=))! "
ant))# &
.))& '
Transaccion))' 2
.))2 3
Estado_transaccion))3 E
.))E F
FirstOrDefault))F T
())T U
et))U W
=>))X Z
et))[ ]
.))] ^
	id_estado))^ g
==))h j
MaestroSettings))k z
.))z {
Default	)){ Ç
.
))Ç É.
 IdDetalleMaestroEstadoCheckedOut
))É £
)
))£ §
,
))§ •
FechaFinAtencion** $
=**% &
ant**' *
.*** +
Transaccion**+ 6
.**6 7
	fecha_fin**7 @
,**@ A
IdTipoHabitacion++ $
=++% &
ant++' *
.++* +
Transaccion+++ 6
.++6 7
Actor_negocio2++7 E
.++E F
Concepto_negocio++F V
.++V W
id++W Y
,++Y Z
TipoHabitacion,, "
=,,# $
ant,,% (
.,,( )
Transaccion,,) 4
.,,4 5
Actor_negocio2,,5 C
.,,C D
Concepto_negocio,,D T
.,,T U
sufijo,,U [
,,,[ \
CodigoHabitacion-- $
=--% &
ant--' *
.--* +
Transaccion--+ 6
.--6 7
Actor_negocio2--7 E
.--E F
Actor--F K
.--K L&
numero_documento_identidad--L f
,--f g
ImporteTotal..  
=..! "
ant..# &
...& '
Transaccion..' 2
...2 3
importe_total..3 @
,..@ A
Noches// 
=// 
(// 
int// !
)//! "
ant//" %
.//% &
Transaccion//& 1
.//1 2
	cantidad1//2 ;
,//; <
IdMotivoViaje00 !
=00" #
(00$ %
int00% (
)00( )
ant00) ,
.00, -
id_detalle_maestro00- ?
}11 
)11 
;11 
return22 
registroHuespedes22 $
;22$ %
}33 	
public55 
IEnumerable55 
<55 
RegistroHuesped55 *
>55* +,
 ObtenerRegistroHuespedesCompleto55, L
(55L M
int55M P
idEstablecimiento55Q b
,55b c
DateTime55d l

fechaDesde55m w
,55w x
DateTime	55y Å

fechaHasta
55Ç å
)
55å ç
{66 	
SigescomEntities77 
_db77  
=77! "
new77# &
SigescomEntities77' 7
(777 8
)778 9
;779 :
var88 
registroHuespedes88 !
=88" #
_db88$ '
.88' (
Estado_transaccion88( :
.88: ;
Where88; @
(88@ A
et88A C
=>88D F
et88G I
.88I J
fecha88J O
>=88P R

fechaDesde88S ]
&&88^ `
et88a c
.88c d
fecha88d i
<=88j l

fechaHasta88m w
&&88x z
(88{ |
et88| ~
.88~ 
	id_estado	88 à
==
88â ã
MaestroSettings
88å õ
.
88õ ú
Default
88ú £
.
88£ §-
IdDetalleMaestroEstadoCheckedIn
88§ √
||
88ƒ ∆
et
88« …
.
88…  
	id_estado
88  ”
==
88‘ ÷
MaestroSettings
88◊ Ê
.
88Ê Á
Default
88Á Ó
.
88Ó Ô3
%IdDetalleMaestroEstadoEntradaCambiado
88Ô î
)
88î ï
&&
88ñ ò
et
88ô õ
.
88õ ú
Transaccion
88ú ß
.
88ß ®!
id_tipo_transaccion
88® ª
==
88º æ
HotelSettings
88ø Ã
.
88Ã Õ
Default
88Õ ‘
.
88‘ ’3
%IdTipoTransaccionAtencionDeHabitacion
88’ ˙
&&
88˚ ˝
et
88˛ Ä
.
88Ä Å
Transaccion
88Å å
.
88å ç
Actor_negocio2
88ç õ
.
88õ ú
Actor_negocio2
88ú ™
.
88™ ´$
id_actor_negocio_padre
88´ ¡
==
88¬ ƒ
idEstablecimiento
88≈ ÷
)
88÷ ◊
.
88◊ ÿ

SelectMany
88ÿ ‚
(
88‚ „
et
88„ Â
=>
88Ê Ë
et
88È Î
.
88Î Ï
Transaccion
88Ï ˜
.
88˜ ¯+
Actor_negocio_por_transaccion
88¯ ï
)
88ï ñ
.99 
Select99 
(99 
ant99 
=>99 
new99 "
RegistroHuesped99# 2
(992 3
)993 4
{:: 

IdAtencion;; 
=;;  
ant;;! $
.;;$ %
Transaccion;;% 0
.;;0 1
id;;1 3
,;;3 4
Huesped<< 
=<< 
ant<< !
.<<! "
Actor_negocio<<" /
.<</ 0
Actor<<0 5
.<<5 6
primer_nombre<<6 C
.<<C D
Replace<<D K
(<<K L
$str<<L O
,<<O P
$str<<Q T
)<<T U
,<<U V
EsMasculino== 
===  !
ant==" %
.==% &
Actor_negocio==& 3
.==3 4
Actor==4 9
.==9 :
id_clase_actor==: H
====I K
ActorSettings==L Y
.==Y Z
Default==Z a
.==a b!
IdClaseActorMasculino==b w
,==w x
Nacionalidad>>  
=>>! "
ant>># &
.>>& '
Actor_negocio>>' 4
.>>4 5
Actor>>5 :
.>>: ;
Detalle_maestro1>>; K
.>>K L
valor>>L Q
,>>Q R
IdPais?? 
=?? 
ant??  
.??  !
Actor_negocio??! .
.??. /
Actor??/ 4
.??4 5
	Direccion??5 >
.??> ?
FirstOrDefault??? M
(??M N
)??N O
.??O P
	id_nacion??P Y
,??Y Z
IdUbigeo@@ 
=@@ 
ant@@ "
.@@" #
Actor_negocio@@# 0
.@@0 1
Actor@@1 6
.@@6 7
	Direccion@@7 @
.@@@ A
FirstOrDefault@@A O
(@@O P
)@@P Q
.@@Q R
	id_ubigeo@@R [
,@@[ \ 
TipoDocumentoClienteCC (
=CC) *
antCC+ .
.CC. /
Actor_negocioCC/ <
.CC< =
ActorCC= B
.CCB C
Detalle_maestroCCC R
.CCR S
valorCCS X
,CCX Y"
NumeroDocumentoClienteDD *
=DD+ ,
antDD- 0
.DD0 1
Actor_negocioDD1 >
.DD> ?
ActorDD? D
.DDD E&
numero_documento_identidadDDE _
,DD_ `#
EstadoIngresoReferenciaEE +
=EE, -
antEE. 1
.EE1 2
TransaccionEE2 =
.EE= >
Transaccion3EE> J
.EEJ K
Estado_transaccionEEK ]
.EE] ^
FirstOrDefaultEE^ l
(EEl m
etEEm o
=>EEp r
etEEs u
.EEu v
	id_estadoEEv 
==
EEÄ Ç
MaestroSettings
EEÉ í
.
EEí ì
Default
EEì ö
.
EEö õ-
IdDetalleMaestroEstadoCheckedIn
EEõ ∫
)
EE∫ ª
,
EEª º
EstadoIngresoFF !
=FF" #
antFF$ '
.FF' (
TransaccionFF( 3
.FF3 4
Estado_transaccionFF4 F
.FFF G
FirstOrDefaultFFG U
(FFU V
etFFV X
=>FFY [
etFF\ ^
.FF^ _
	id_estadoFF_ h
==FFi k
MaestroSettingsFFl {
.FF{ |
Default	FF| É
.
FFÉ Ñ-
IdDetalleMaestroEstadoCheckedIn
FFÑ £
)
FF£ §
,
FF§ •
EstadoSalidaGG  
=GG! "
antGG# &
.GG& '
TransaccionGG' 2
.GG2 3
Estado_transaccionGG3 E
.GGE F
FirstOrDefaultGGF T
(GGT U
etGGU W
=>GGX Z
etGG[ ]
.GG] ^
	id_estadoGG^ g
==GGh j
MaestroSettingsGGk z
.GGz {
Default	GG{ Ç
.
GGÇ É.
 IdDetalleMaestroEstadoCheckedOut
GGÉ £
)
GG£ §
,
GG§ •
FechaFinAtencionHH $
=HH% &
antHH' *
.HH* +
TransaccionHH+ 6
.HH6 7
	fecha_finHH7 @
,HH@ A
IdTipoHabitacionII $
=II% &
antII' *
.II* +
TransaccionII+ 6
.II6 7
Actor_negocio2II7 E
.IIE F
Concepto_negocioIIF V
.IIV W
idIIW Y
,IIY Z
TipoHabitacionJJ "
=JJ# $
antJJ% (
.JJ( )
TransaccionJJ) 4
.JJ4 5
Actor_negocio2JJ5 C
.JJC D
Concepto_negocioJJD T
.JJT U
sufijoJJU [
,JJ[ \
CodigoHabitacionKK $
=KK% &
antKK' *
.KK* +
TransaccionKK+ 6
.KK6 7
Actor_negocio2KK7 E
.KKE F
ActorKKF K
.KKK L&
numero_documento_identidadKKL f
,KKf g
ImporteTotalLL  
=LL! "
antLL# &
.LL& '
TransaccionLL' 2
.LL2 3
importe_totalLL3 @
,LL@ A
NochesMM 
=MM 
(MM 
intMM !
)MM! "
antMM" %
.MM% &
TransaccionMM& 1
.MM1 2
	cantidad1MM2 ;
,MM; <
IdMotivoViajeNN !
=NN" #
(NN$ %
intNN% (
)NN( )
antNN) ,
.NN, -
id_detalle_maestroNN- ?
}OO 
)OO 
.OO 
ToListOO 
(OO 
)OO 
;OO 
varPP 
idUbigeosHuespedesPP "
=PP# $
registroHuespedesPP% 6
.PP6 7
SelectPP7 =
(PP= >
rhPP> @
=>PPA C
rhPPD F
.PPF G
IdUbigeoPPG O
)PPO P
.PPP Q
ToListPPQ W
(PPW X
)PPX Y
;PPY Z
varQQ 
ubigeosQQ 
=QQ 
_dbQQ 
.QQ 
UbigeoQQ $
.QQ$ %
WhereQQ% *
(QQ* +
uQQ+ ,
=>QQ- /
idUbigeosHuespedesQQ0 B
.QQB C
ContainsQQC K
(QQK L
uQQL M
.QQM N
idQQN P
)QQP Q
)QQQ R
.QQR S
SelectQQS Y
(QQY Z
uQQZ [
=>QQ\ ^
newQQ_ b
{RR 
IdSS 
=SS 
uSS 
.SS 
idSS 
,SS 
IdRegionTT 
=TT 
uTT 
.TT 
	id_regionTT &
,TT& '
IdProvinciaUU 
=UU 
uUU 
.UU  
id_provinciaUU  ,
,UU, -
NombreVV 
=VV 
uVV 
.VV 
descripcion_largaVV ,
}WW 
)WW 
.WW 
ToListWW 
(WW 
)WW 
;WW 
varXX 
idPaisesHuespedesXX !
=XX" #
registroHuespedesXX$ 5
.XX5 6
SelectXX6 <
(XX< =
rhXX= ?
=>XX@ B
rhXXC E
.XXE F
IdPaisXXF L
)XXL M
.XXM N
ToListXXN T
(XXT U
)XXU V
;XXV W
varYY 
paisesContinentesYY !
=YY" #
_dbYY$ '
.YY' (
Detalle_maestroYY( 7
.YY7 8
WhereYY8 =
(YY= >
dmYY> @
=>YYA C
idPaisesHuespedesYYD U
.YYU V
ContainsYYV ^
(YY^ _
dmYY_ a
.YYa b
idYYb d
)YYd e
)YYe f
.YYf g
SelectYYg m
(YYm n
dmYYn p
=>YYq s
newYYt w
{ZZ 
IdPais[[ 
=[[ 
dm[[ 
.[[ 
id[[ 
,[[ 

NombrePais\\ 
=\\ 
dm\\ 
.\\  
nombre\\  &
,\\& '
IdContinente]] 
=]] 
dm]] !
.]]! "$
Detalle_detalle_maestro1]]" :
.]]: ;
FirstOrDefault]]; I
(]]I J
)]]J K
.]]K L
Detalle_maestro]]L [
.]][ \
id]]\ ^
,]]^ _

Continente^^ 
=^^ 
dm^^ 
.^^  $
Detalle_detalle_maestro1^^  8
.^^8 9
FirstOrDefault^^9 G
(^^G H
)^^H I
.^^I J
Detalle_maestro^^J Y
.^^Y Z
nombre^^Z `
,^^` a
}__ 
)__ 
.__ 
ToList__ 
(__ 
)__ 
;__ 
registroHuespedes`` 
.`` 
ForEach`` %
(``% &
rh``& (
=>``) +
{aa 
rhbb 
.bb 
IdRegionUbigeobb !
=bb" #
ubigeosbb$ +
.bb+ ,
Singlebb, 2
(bb2 3
ubb3 4
=>bb5 7
ubb8 9
.bb9 :
Idbb: <
==bb= ?
rhbb@ B
.bbB C
IdUbigeobbC K
)bbK L
.bbL M
IdRegionbbM U
;bbU V
rhcc 
.cc 
IdProvinciaUbigeocc $
=cc% &
ubigeoscc' .
.cc. /
Singlecc/ 5
(cc5 6
ucc6 7
=>cc8 :
ucc; <
.cc< =
Idcc= ?
==cc@ B
rhccC E
.ccE F
IdUbigeoccF N
)ccN O
.ccO P
IdProvinciaccP [
;cc[ \
rhdd 
.dd 
Ubigeodd 
=dd 
ubigeosdd #
.dd# $
Singledd$ *
(dd* +
udd+ ,
=>dd- /
udd0 1
.dd1 2
Iddd2 4
==dd5 7
rhdd8 :
.dd: ;
IdUbigeodd; C
)ddC D
.ddD E
NombreddE K
;ddK L
rhee 
.ee 
Paisee 
=ee 
paisesContinentesee +
.ee+ ,
Singleee, 2
(ee2 3
pcee3 5
=>ee6 8
pcee9 ;
.ee; <
IdPaisee< B
==eeC E
rheeF H
.eeH I
IdPaiseeI O
)eeO P
.eeP Q

NombrePaiseeQ [
;ee[ \
rhff 
.ff 
IdContinenteff 
=ff  !
paisesContinentesff" 3
.ff3 4
Singleff4 :
(ff: ;
pcff; =
=>ff> @
pcffA C
.ffC D
IdPaisffD J
==ffK M
rhffN P
.ffP Q
IdPaisffQ W
)ffW X
.ffX Y
IdContinenteffY e
;ffe f
rhgg 
.gg 

Continentegg 
=gg 
paisesContinentesgg  1
.gg1 2
Singlegg2 8
(gg8 9
pcgg9 ;
=>gg< >
pcgg? A
.ggA B
IdPaisggB H
==ggI K
rhggL N
.ggN O
IdPaisggO U
)ggU V
.ggV W

ContinenteggW a
;gga b
}hh 
)hh 
;hh 
returnii 
registroHuespedesii $
;ii$ %
}jj 	
publicll 
IEnumerablell 
<ll 
Ingresoll "
>ll" #
ObtenerIngresosll$ 3
(ll3 4
intll4 7
idEstablecimientoll8 I
,llI J
DateTimellK S

fechaDesdellT ^
,ll^ _
DateTimell` h

fechaHastalli s
)lls t
{mm 	
SigescomEntitiesnn 
_dbnn  
=nn! "
newnn# &
SigescomEntitiesnn' 7
(nn7 8
)nn8 9
;nn9 :
varoo 
ingresosoo 
=oo 
_dboo 
.oo 
Estado_transaccionoo 1
.oo1 2
Whereoo2 7
(oo7 8
etoo8 :
=>oo; =
etoo> @
.oo@ A
fechaooA F
>=ooG I

fechaDesdeooJ T
&&ooU W
etooX Z
.ooZ [
fechaoo[ `
<=ooa c

fechaHastaood n
&&ooo q
(oor s
etoos u
.oou v
	id_estadooov 
==
ooÄ Ç
MaestroSettings
ooÉ í
.
ooí ì
Default
ooì ö
.
ooö õ-
IdDetalleMaestroEstadoCheckedIn
ooõ ∫
||
ooª Ω
et
ooæ ¿
.
oo¿ ¡
	id_estado
oo¡  
==
ooÀ Õ
MaestroSettings
ooŒ ›
.
oo› ﬁ
Default
ooﬁ Â
.
ooÂ Ê3
%IdDetalleMaestroEstadoEntradaCambiado
ooÊ ã
)
ooã å
&&
ooç è
et
ooê í
.
ooí ì
Transaccion
ooì û
.
ooû ü!
id_tipo_transaccion
ooü ≤
==
oo≥ µ
HotelSettings
oo∂ √
.
oo√ ƒ
Default
ooƒ À
.
ooÀ Ã3
%IdTipoTransaccionAtencionDeHabitacion
ooÃ Ò
&&
ooÚ Ù
et
ooı ˜
.
oo˜ ¯
Transaccion
oo¯ É
.
ooÉ Ñ
Actor_negocio2
ooÑ í
.
ooí ì
Actor_negocio2
ooì °
.
oo° ¢$
id_actor_negocio_padre
oo¢ ∏
==
ooπ ª
idEstablecimiento
ooº Õ
)
ooÕ Œ
.
ooŒ œ
Select
ooœ ’
(
oo’ ÷
et
oo÷ ÿ
=>
ooŸ €
et
oo‹ ﬁ
.
ooﬁ ﬂ
Transaccion
ooﬂ Í
)
ooÍ Î
.pp 
Selectpp $
(pp$ %
tpp% &
=>pp' )
newpp* -
Ingresopp. 5
(pp5 6
)pp6 7
{qq 
Fecharr! &
=rr' (
trr) *
.rr* +
Estado_transaccionrr+ =
.rr= >
FirstOrDefaultrr> L
(rrL M
etrrM O
=>rrP R
etrrS U
.rrU V
	id_estadorrV _
==rr` b
MaestroSettingsrrc r
.rrr s
Defaultrrs z
.rrz {,
IdDetalleMaestroEstadoCheckedIn	rr{ ö
||
rrõ ù
et
rrû †
.
rr† °
	id_estado
rr° ™
==
rr´ ≠
MaestroSettings
rrÆ Ω
.
rrΩ æ
Default
rræ ≈
.
rr≈ ∆3
%IdDetalleMaestroEstadoEntradaCambiado
rr∆ Î
)
rrÎ Ï
.
rrÏ Ì
fecha
rrÌ Ú
,
rrÚ Û
Codigoss! '
=ss( )
tss* +
.ss+ ,
codigoss, 2
,ss2 3
	Huespedestt! *
=tt+ ,
ttt- .
.tt. /)
Actor_negocio_por_transacciontt/ L
.ttL M
SelectttM S
(ttS T
anptttT X
=>ttY [
newtt\ _
Huespedtt` g
(ttg h
)tth i
{uu! "
Nombrevv% +
=vv, -
anptvv. 2
.vv2 3
Actor_negociovv3 @
.vv@ A
ActorvvA F
.vvF G
primer_nombrevvG T
.vvT U
ReplacevvU \
(vv\ ]
$strvv] `
,vv` a
$strvvb e
)vve f
,vvf g
ExtensionJsonww% 2
=ww3 4
anptww5 9
.ww9 :
extension_jsonww: H
,wwH I
}xx! "
)xx" #
,xx# $
TipoHabitacionyy! /
=yy0 1
tyy2 3
.yy3 4
Actor_negocio2yy4 B
.yyB C
Concepto_negocioyyC S
.yyS T
sufijoyyT Z
,yyZ [
CodigoHabitacionzz! 1
=zz2 3
tzz4 5
.zz5 6
Actor_negocio2zz6 D
.zzD E
ActorzzE J
.zzJ K&
numero_documento_identidadzzK e
,zze f
Noches{{! '
={{( )
({{* +
int{{+ .
){{. /
t{{/ 0
.{{0 1
	cantidad1{{1 :
}|| 
)}} 
;}} 
return~~ 
ingresos~~ 
;~~ 
} 	
public
ÄÄ 
IEnumerable
ÄÄ 
<
ÄÄ 
Salida
ÄÄ !
>
ÄÄ! "
ObtenerSalidas
ÄÄ# 1
(
ÄÄ1 2
int
ÄÄ2 5
idEstablecimiento
ÄÄ6 G
,
ÄÄG H
DateTime
ÄÄI Q

fechaDesde
ÄÄR \
,
ÄÄ\ ]
DateTime
ÄÄ^ f

fechaHasta
ÄÄg q
)
ÄÄq r
{
ÅÅ 	
SigescomEntities
ÇÇ 
_db
ÇÇ  
=
ÇÇ! "
new
ÇÇ# &
SigescomEntities
ÇÇ' 7
(
ÇÇ7 8
)
ÇÇ8 9
;
ÇÇ9 :
var
ÉÉ 
salidas
ÉÉ 
=
ÉÉ 
_db
ÉÉ 
.
ÉÉ  
Estado_transaccion
ÉÉ 0
.
ÉÉ0 1
Where
ÉÉ1 6
(
ÉÉ6 7
et
ÉÉ7 9
=>
ÉÉ: <
et
ÉÉ= ?
.
ÉÉ? @
fecha
ÉÉ@ E
>=
ÉÉF H

fechaDesde
ÉÉI S
&&
ÉÉT V
et
ÉÉW Y
.
ÉÉY Z
fecha
ÉÉZ _
<=
ÉÉ` b

fechaHasta
ÉÉc m
&&
ÉÉn p
et
ÉÉq s
.
ÉÉs t
	id_estado
ÉÉt }
==ÉÉ~ Ä
MaestroSettingsÉÉÅ ê
.ÉÉê ë
DefaultÉÉë ò
.ÉÉò ô0
 IdDetalleMaestroEstadoCheckedOutÉÉô π
&&ÉÉ∫ º
etÉÉΩ ø
.ÉÉø ¿
TransaccionÉÉ¿ À
.ÉÉÀ Ã#
id_tipo_transaccionÉÉÃ ﬂ
==ÉÉ‡ ‚
HotelSettingsÉÉ„ 
.ÉÉ Ò
DefaultÉÉÒ ¯
.ÉÉ¯ ˘5
%IdTipoTransaccionAtencionDeHabitacionÉÉ˘ û
&&ÉÉü °
etÉÉ¢ §
.ÉÉ§ •
TransaccionÉÉ• ∞
.ÉÉ∞ ±
Actor_negocio2ÉÉ± ø
.ÉÉø ¿
Actor_negocio2ÉÉ¿ Œ
.ÉÉŒ œ&
id_actor_negocio_padreÉÉœ Â
==ÉÉÊ Ë!
idEstablecimientoÉÉÈ ˙
)ÉÉ˙ ˚
.ÉÉ˚ ¸
SelectÉÉ¸ Ç
(ÉÉÇ É
etÉÉÉ Ö
=>ÉÉÜ à
etÉÉâ ã
.ÉÉã å
TransaccionÉÉå ó
)ÉÉó ò
.
ÑÑ 
Select
ÑÑ $
(
ÑÑ$ %
t
ÑÑ% &
=>
ÑÑ' )
new
ÑÑ* -
Salida
ÑÑ. 4
(
ÑÑ4 5
)
ÑÑ5 6
{
ÖÖ %
EstadoIngresoReferencia
ÜÜ! 8
=
ÜÜ9 :
t
ÜÜ; <
.
ÜÜ< =
Transaccion3
ÜÜ= I
.
ÜÜI J 
Estado_transaccion
ÜÜJ \
.
ÜÜ\ ]
FirstOrDefault
ÜÜ] k
(
ÜÜk l
et
ÜÜl n
=>
ÜÜo q
et
ÜÜr t
.
ÜÜt u
	id_estado
ÜÜu ~
==ÜÜ Å
MaestroSettingsÜÜÇ ë
.ÜÜë í
DefaultÜÜí ô
.ÜÜô ö/
IdDetalleMaestroEstadoCheckedInÜÜö π
)ÜÜπ ∫
,ÜÜ∫ ª
EstadoIngreso
áá! .
=
áá/ 0
t
áá1 2
.
áá2 3 
Estado_transaccion
áá3 E
.
ááE F
FirstOrDefault
ááF T
(
ááT U
et
ááU W
=>
ááX Z
et
áá[ ]
.
áá] ^
	id_estado
áá^ g
==
ááh j
MaestroSettings
áák z
.
ááz {
Defaultáá{ Ç
.ááÇ É/
IdDetalleMaestroEstadoCheckedInááÉ ¢
)áá¢ £
,áá£ §
FechaSalida
àà! ,
=
àà- .
t
àà/ 0
.
àà0 1 
Estado_transaccion
àà1 C
.
ààC D
FirstOrDefault
ààD R
(
ààR S
et
ààS U
=>
ààV X
et
ààY [
.
àà[ \
	id_estado
àà\ e
==
ààf h
MaestroSettings
àài x
.
ààx y
Defaultàày Ä
.ààÄ Å0
 IdDetalleMaestroEstadoCheckedOutààÅ °
)àà° ¢
.àà¢ £
fechaàà£ ®
,àà® ©
Codigo
ââ! '
=
ââ( )
t
ââ* +
.
ââ+ ,
codigo
ââ, 2
,
ââ2 3
	Huespedes
ää! *
=
ää+ ,
t
ää- .
.
ää. /+
Actor_negocio_por_transaccion
ää/ L
.
ääL M
Select
ääM S
(
ääS T
anpt
ääT X
=>
ääY [
new
ää\ _
Huesped
ää` g
(
ääg h
)
ääh i
{
ãã! "
Nombre
åå% +
=
åå, -
anpt
åå. 2
.
åå2 3
Actor_negocio
åå3 @
.
åå@ A
Actor
ååA F
.
ååF G
primer_nombre
ååG T
.
ååT U
Replace
ååU \
(
åå\ ]
$str
åå] `
,
åå` a
$str
ååb e
)
ååe f
,
ååf g
ExtensionJson
çç% 2
=
çç3 4
anpt
çç5 9
.
çç9 :
extension_json
çç: H
,
ççH I
}
éé! "
)
éé" #
,
éé# $
TipoHabitacion
èè! /
=
èè0 1
t
èè2 3
.
èè3 4
Actor_negocio2
èè4 B
.
èèB C
Concepto_negocio
èèC S
.
èèS T
sufijo
èèT Z
,
èèZ [
CodigoHabitacion
êê! 1
=
êê2 3
t
êê4 5
.
êê5 6
Actor_negocio2
êê6 D
.
êêD E
Actor
êêE J
.
êêJ K(
numero_documento_identidad
êêK e
,
êêe f
Noches
ëë! '
=
ëë( )
(
ëë* +
int
ëë+ .
)
ëë. /
t
ëë/ 0
.
ëë0 1
	cantidad1
ëë1 :
,
ëë: ;
Importe
íí! (
=
íí) *
t
íí+ ,
.
íí, -
importe_total
íí- :
}
îî 
)
ïï 
;
ïï 
return
ññ 
salidas
ññ 
;
ññ 
}
óó 	
public
òò 
IEnumerable
òò 
<
òò 
Anulada
òò "
>
òò" #
ObtenerAnuladas
òò$ 3
(
òò3 4
int
òò4 7
idEstablecimiento
òò8 I
,
òòI J
DateTime
òòK S

fechaDesde
òòT ^
,
òò^ _
DateTime
òò` h

fechaHasta
òòi s
)
òòs t
{
ôô 	
SigescomEntities
öö 
_db
öö  
=
öö! "
new
öö# &
SigescomEntities
öö' 7
(
öö7 8
)
öö8 9
;
öö9 :
var
õõ 
anuladas
õõ 
=
õõ 
_db
õõ 
.
õõ  
Estado_transaccion
õõ 1
.
õõ1 2
Where
õõ2 7
(
õõ7 8
et
õõ8 :
=>
õõ; =
et
õõ> @
.
õõ@ A
fecha
õõA F
>=
õõG I

fechaDesde
õõJ T
&&
õõU W
et
õõX Z
.
õõZ [
fecha
õõ[ `
<=
õõa c

fechaHasta
õõd n
&&
õõo q
et
õõr t
.
õõt u
	id_estado
õõu ~
==õõ Å
MaestroSettingsõõÇ ë
.õõë í
Defaultõõí ô
.õõô ö-
IdDetalleMaestroEstadoAnuladoõõö ∑
&&õõ∏ ∫
etõõª Ω
.õõΩ æ
Transaccionõõæ …
.õõ…  #
id_tipo_transaccionõõ  ›
==õõﬁ ‡
HotelSettingsõõ· Ó
.õõÓ Ô
DefaultõõÔ ˆ
.õõˆ ˜5
%IdTipoTransaccionAtencionDeHabitacionõõ˜ ú
&&õõù ü
etõõ† ¢
.õõ¢ £
Transaccionõõ£ Æ
.õõÆ Ø
Actor_negocio2õõØ Ω
.õõΩ æ
Actor_negocio2õõæ Ã
.õõÃ Õ&
id_actor_negocio_padreõõÕ „
==õõ‰ Ê!
idEstablecimientoõõÁ ¯
)õõ¯ ˘
.õõ˘ ˙
Selectõõ˙ Ä
(õõÄ Å
etõõÅ É
=>õõÑ Ü
etõõá â
.õõâ ä
Transaccionõõä ï
)õõï ñ
.
úú 
Select
úú $
(
úú$ %
t
úú% &
=>
úú' )
new
úú* -
Anulada
úú. 5
(
úú5 6
)
úú6 7
{
ùù 
FechaRegistro
ûû! .
=
ûû/ 0
t
ûû1 2
.
ûû2 3$
fecha_registro_sistema
ûû3 I
,
ûûI J
Fecha
üü! &
=
üü' (
t
üü) *
.
üü* + 
Estado_transaccion
üü+ =
.
üü= >
FirstOrDefault
üü> L
(
üüL M
et
üüM O
=>
üüP R
et
üüS U
.
üüU V
	id_estado
üüV _
==
üü` b
MaestroSettings
üüc r
.
üür s
Default
üüs z
.
üüz {,
IdDetalleMaestroEstadoAnuladoüü{ ò
)üüò ô
.üüô ö
fechaüüö ü
,üüü †
Codigo
††! '
=
††( )
t
††* +
.
††+ ,
codigo
††, 2
,
††2 3
TipoHabitacion
°°! /
=
°°0 1
t
°°2 3
.
°°3 4
Actor_negocio2
°°4 B
.
°°B C
Concepto_negocio
°°C S
.
°°S T
sufijo
°°T Z
,
°°Z [
CodigoHabitacion
¢¢! 1
=
¢¢2 3
t
¢¢4 5
.
¢¢5 6
Actor_negocio2
¢¢6 D
.
¢¢D E
Actor
¢¢E J
.
¢¢J K(
numero_documento_identidad
¢¢K e
,
¢¢e f
Empleado
££! )
=
££* +
t
££, -
.
££- . 
Estado_transaccion
££. @
.
££@ A
FirstOrDefault
££A O
(
££O P
et
££P R
=>
££S U
et
££V X
.
££X Y
	id_estado
££Y b
==
££c e
MaestroSettings
££f u
.
££u v
Default
££v }
.
££} ~,
IdDetalleMaestroEstadoAnulado££~ õ
)££õ ú
.££ú ù
Actor_negocio££ù ™
.££™ ´
Actor££´ ∞
.££∞ ±
tercer_nombre££± æ
,££æ ø
}
§§ 
)
•• 
;
•• 
return
¶¶ 
anuladas
¶¶ 
;
¶¶ 
}
ßß 	
public
®® 
IEnumerable
®® 
<
®® 
	Facturada
®® $
>
®®$ %
ObtenerFacturadas
®®& 7
(
®®7 8
int
®®8 ;
idEstablecimiento
®®< M
,
®®M N
DateTime
®®O W

fechaDesde
®®X b
,
®®b c
DateTime
®®d l

fechaHasta
®®m w
)
®®w x
{
©© 	
SigescomEntities
™™ 
_db
™™  
=
™™! "
new
™™# &
SigescomEntities
™™' 7
(
™™7 8
)
™™8 9
;
™™9 :
var
´´  
eventosTransaccion
´´ "
=
´´# $
_db
´´% (
.
´´( ) 
Evento_transaccion
´´) ;
.
´´; <
Where
´´< A
(
´´A B
et
´´B D
=>
´´E G
et
´´H J
.
´´J K
fecha
´´K P
>=
´´Q S

fechaDesde
´´T ^
&&
´´_ a
et
´´b d
.
´´d e
fecha
´´e j
<=
´´k m

fechaHasta
´´n x
&&
´´y {
et
´´| ~
.
´´~ 
	id_evento´´ à
==´´â ã
MaestroSettings´´å õ
.´´õ ú
Default´´ú £
.´´£ §/
IdDetalleMaestroEstadoFacturado´´§ √
&&´´ƒ ∆
(´´« »
et´´»  
.´´  À
Transaccion´´À ÷
.´´÷ ◊#
id_tipo_transaccion´´◊ Í
==´´Î Ì
HotelSettings´´Ó ˚
.´´˚ ¸
Default´´¸ É
.´´É Ñ5
%IdTipoTransaccionAtencionDeHabitacion´´Ñ ©
||´´™ ¨
et´´≠ Ø
.´´Ø ∞
Transaccion´´∞ ª
.´´ª º#
id_tipo_transaccion´´º œ
==´´– “
HotelSettings´´” ‡
.´´‡ ·
Default´´· Ë
.´´Ë È0
 IdTipoTransaccionAtencionDeHotel´´È â
)´´â ä
&&´´ã ç
(´´é è
et´´è ë
.´´ë í
Transaccion´´í ù
.´´ù û
Actor_negocio2´´û ¨
.´´¨ ≠
Actor_negocio2´´≠ ª
.´´ª º&
id_actor_negocio_padre´´º “
==´´” ’!
idEstablecimiento´´÷ Á
||´´Ë Í
et´´Î Ì
.´´Ì Ó
Transaccion´´Ó ˘
.´´˘ ˙
Actor_negocio2´´˙ à
.´´à â&
id_actor_negocio_padre´´â ü
==´´† ¢!
idEstablecimiento´´£ ¥
)´´¥ µ
)´´µ ∂
.
¨¨ 
Select
¨¨ 
(
¨¨ 
et
¨¨ 
=>
¨¨ 
new
¨¨ 
EventoAtencion
¨¨ -
{
≠≠ 
Id
ÆÆ 
=
ÆÆ 
et
ÆÆ 
.
ÆÆ 
id
ÆÆ 
,
ÆÆ 
Fecha
ØØ 
=
ØØ 
et
ØØ 
.
ØØ 
fecha
ØØ !
,
ØØ! "
ModoFacturacion
∞∞  
=
∞∞! "
et
∞∞# %
.
∞∞% &
Transaccion
∞∞& 1
.
∞∞1 2
enum1
∞∞2 7
,
∞∞7 8

IdAtencion
±± 
=
±± 
et
±±  
.
±±  !
Transaccion
±±! ,
.
±±, -
id
±±- /
,
±±/ 0
}
≤≤ 
)
≤≤ 
.
≤≤ 
ToList
≤≤ 
(
≤≤ 
)
≤≤ 
;
≤≤ 
var
≥≥ %
idsAtencionesOrdenVenta
≥≥ '
=
≥≥( ) 
eventosTransaccion
≥≥* <
.
≥≥< =
Select
≥≥= C
(
≥≥C D
et
≥≥D F
=>
≥≥G I
et
≥≥J L
.
≥≥L M

IdAtencion
≥≥M W
)
≥≥W X
;
≥≥X Y
var
¥¥ 
ordenesVentas
¥¥ 
=
¥¥ 
_db
¥¥  #
.
¥¥# $
Transaccion
¥¥$ /
.
¥¥/ 0
Where
¥¥0 5
(
¥¥5 6
t
¥¥6 7
=>
¥¥8 :
t
¥¥; <
.
¥¥< =!
id_tipo_transaccion
¥¥= P
==
¥¥Q S!
TransaccionSettings
¥¥T g
.
¥¥g h
Default
¥¥h o
.
¥¥o p,
IdTipoTransaccionOrdenDeVenta¥¥p ç
&&¥¥é ê'
idsAtencionesOrdenVenta¥¥ë ®
.¥¥® ©
Contains¥¥© ±
(¥¥± ≤
(¥¥≤ ≥
long¥¥≥ ∑
)¥¥∑ ∏
t¥¥∏ π
.¥¥π ∫)
id_transaccion_referencia¥¥∫ ”
)¥¥” ‘
)¥¥‘ ’
.¥¥’ ÷
Select¥¥÷ ‹
(¥¥‹ ›
t¥¥› ﬁ
=>¥¥ﬂ ·
new¥¥‚ Â
{
µµ 
Id
∂∂ 
=
∂∂ 
t
∂∂ 
.
∂∂ 
id
∂∂ 
,
∂∂ 
IdReferencia
∑∑ 
=
∑∑ 
t
∑∑  
.
∑∑  !'
id_transaccion_referencia
∑∑! :
,
∑∑: ;
TipoComprobante
∏∏ 
=
∏∏  !
t
∏∏" #
.
∏∏# $
Comprobante
∏∏$ /
.
∏∏/ 0
Detalle_maestro
∏∏0 ?
.
∏∏? @
valor
∏∏@ E
,
∏∏E F%
SerieYNumeroComprobante
ππ '
=
ππ( )
t
ππ* +
.
ππ+ ,
Comprobante
ππ, 7
.
ππ7 8
numero_serie
ππ8 D
+
ππE F
$str
ππG J
+
ππK L
t
ππM N
.
ππN O
Comprobante
ππO Z
.
ππZ [
numero
ππ[ a
,
ππa b
Cliente
∫∫ 
=
∫∫ 
t
∫∫ 
.
∫∫ 
Actor_negocio1
∫∫ *
.
∫∫* +
Actor
∫∫+ 0
.
∫∫0 1(
numero_documento_identidad
∫∫1 K
+
∫∫L M
$str
∫∫N S
+
∫∫T U
t
∫∫V W
.
∫∫W X
Actor_negocio1
∫∫X f
.
∫∫f g
Actor
∫∫g l
.
∫∫l m
primer_nombre
∫∫m z
.
∫∫z {
Replace∫∫{ Ç
(∫∫Ç É
$str∫∫É Ü
,∫∫Ü á
$str∫∫à ã
)∫∫ã å
,∫∫å ç
FechaOperacion
ªª 
=
ªª  
t
ªª! "
.
ªª" #
fecha_inicio
ªª# /
,
ªª/ 0
Importe
ºº 
=
ºº 
t
ºº 
.
ºº 
importe_total
ºº )
,
ºº) *
}
ΩΩ 
)
ΩΩ 
.
ΩΩ 
ToList
ΩΩ 
(
ΩΩ 
)
ΩΩ 
;
ΩΩ 
var
ææ 
idsOrdenVenta
ææ 
=
ææ 
ordenesVentas
ææ  -
.
ææ- .
Select
ææ. 4
(
ææ4 5
et
ææ5 7
=>
ææ8 :
et
ææ; =
.
ææ= >
Id
ææ> @
)
ææ@ A
;
ææA B
var
øø 
notasCredito
øø 
=
øø 
_db
øø "
.
øø" #
Transaccion
øø# .
.
øø. /
Where
øø/ 4
(
øø4 5
t
øø5 6
=>
øø7 9
idsOrdenVenta
øø: G
.
øøG H
Contains
øøH P
(
øøP Q
(
øøQ R
long
øøR V
)
øøV W
t
øøW X
.
øøX Y'
id_transaccion_referencia
øøY r
)
øør s
)
øøs t
.
øøt u
Select
øøu {
(
øø{ |
t
øø| }
=>øø~ Ä
newøøÅ Ñ
{
¿¿ 
IdReferencia
¡¡ 
=
¡¡ 
t
¡¡  
.
¡¡  !'
id_transaccion_referencia
¡¡! :
,
¡¡: ;
TipoComprobante
¬¬ 
=
¬¬  !
t
¬¬" #
.
¬¬# $
Comprobante
¬¬$ /
.
¬¬/ 0
Detalle_maestro
¬¬0 ?
.
¬¬? @
valor
¬¬@ E
,
¬¬E F%
SerieYNumeroComprobante
√√ '
=
√√( )
t
√√* +
.
√√+ ,
Comprobante
√√, 7
.
√√7 8
numero_serie
√√8 D
+
√√E F
$str
√√G J
+
√√K L
t
√√M N
.
√√N O
Comprobante
√√O Z
.
√√Z [
numero
√√[ a
,
√√a b
Cliente
ƒƒ 
=
ƒƒ 
t
ƒƒ 
.
ƒƒ 
Actor_negocio1
ƒƒ *
.
ƒƒ* +
Actor
ƒƒ+ 0
.
ƒƒ0 1(
numero_documento_identidad
ƒƒ1 K
+
ƒƒL M
$str
ƒƒN S
+
ƒƒT U
t
ƒƒV W
.
ƒƒW X
Actor_negocio1
ƒƒX f
.
ƒƒf g
Actor
ƒƒg l
.
ƒƒl m
primer_nombre
ƒƒm z
.
ƒƒz {
Replaceƒƒ{ Ç
(ƒƒÇ É
$strƒƒÉ Ü
,ƒƒÜ á
$strƒƒà ã
)ƒƒã å
,ƒƒå ç
FechaOperacion
≈≈ 
=
≈≈  
t
≈≈! "
.
≈≈" #
fecha_inicio
≈≈# /
,
≈≈/ 0
Importe
∆∆ 
=
∆∆ 
t
∆∆ 
.
∆∆ 
importe_total
∆∆ )
,
∆∆) *
}
«« 
)
«« 
.
«« 
ToList
«« 
(
«« 
)
«« 
;
«« 
var
»» "
atencionesHabitacion
»» $
=
»»% &)
ObtenerAtencionesHabitacion
»»' B
(
»»B C
_db
»»C F
,
»»F G 
eventosTransaccion
»»H Z
)
»»Z [
;
»»[ \
var
…… 

facturadas
…… 
=
…… 
ordenesVentas
…… *
.
……* +
Select
……+ 1
(
……1 2
ov
……2 4
=>
……5 7
new
……8 ;
	Facturada
……< E
(
……E F
)
……F G
{
   
IdEventoFacturado
ÀÀ !
=
ÀÀ" # 
eventosTransaccion
ÀÀ$ 6
.
ÀÀ6 7
First
ÀÀ7 <
(
ÀÀ< =
et
ÀÀ= ?
=>
ÀÀ@ B
et
ÀÀC E
.
ÀÀE F

IdAtencion
ÀÀF P
==
ÀÀQ S
ov
ÀÀT V
.
ÀÀV W
IdReferencia
ÀÀW c
)
ÀÀc d
.
ÀÀd e
Id
ÀÀe g
,
ÀÀg h
Facturacion
ÃÃ 
=
ÃÃ  
eventosTransaccion
ÃÃ 0
.
ÃÃ0 1
First
ÃÃ1 6
(
ÃÃ6 7
et
ÃÃ7 9
=>
ÃÃ: <
et
ÃÃ= ?
.
ÃÃ? @

IdAtencion
ÃÃ@ J
==
ÃÃK M
ov
ÃÃN P
.
ÃÃP Q
IdReferencia
ÃÃQ ]
)
ÃÃ] ^
.
ÃÃ^ _
ModoFacturacion
ÃÃ_ n
==
ÃÃo q
(
ÃÃr s
int
ÃÃs v
)
ÃÃv w#
ModoFacturacionHotelÃÃw ã
.ÃÃã å
GlobalÃÃå í
?ÃÃì î
$strÃÃï û
:ÃÃü †
$strÃÃ° ±
,ÃÃ± ≤
Fecha
ÕÕ 
=
ÕÕ  
eventosTransaccion
ÕÕ *
.
ÕÕ* +
First
ÕÕ+ 0
(
ÕÕ0 1
et
ÕÕ1 3
=>
ÕÕ4 6
et
ÕÕ7 9
.
ÕÕ9 :

IdAtencion
ÕÕ: D
==
ÕÕE G
ov
ÕÕH J
.
ÕÕJ K
IdReferencia
ÕÕK W
)
ÕÕW X
.
ÕÕX Y
Fecha
ÕÕY ^
,
ÕÕ^ _
Codigo
ŒŒ 
=
ŒŒ "
atencionesHabitacion
ŒŒ -
.
ŒŒ- .
First
ŒŒ. 3
(
ŒŒ3 4
ai
ŒŒ4 6
=>
ŒŒ7 9
ai
ŒŒ: <
.
ŒŒ< =
Id
ŒŒ= ?
==
ŒŒ@ B 
eventosTransaccion
ŒŒC U
.
ŒŒU V
First
ŒŒV [
(
ŒŒ[ \
et
ŒŒ\ ^
=>
ŒŒ_ a
et
ŒŒb d
.
ŒŒd e

IdAtencion
ŒŒe o
==
ŒŒp r
ov
ŒŒs u
.
ŒŒu v
IdReferenciaŒŒv Ç
)ŒŒÇ É
.ŒŒÉ Ñ

IdAtencionŒŒÑ é
)ŒŒé è
.ŒŒè ê
CodigoŒŒê ñ
,ŒŒñ ó
TipoComprobante
œœ 
=
œœ  !
ov
œœ" $
.
œœ$ %
TipoComprobante
œœ% 4
,
œœ4 5%
SerieYNumeroComprobante
–– '
=
––( )
ov
––* ,
.
––, -%
SerieYNumeroComprobante
––- D
,
––D E
Cliente
—— 
=
—— 
ov
—— 
.
—— 
Cliente
—— $
,
——$ %
FechaOperacion
““ 
=
““  
ov
““! #
.
““# $
FechaOperacion
““$ 2
,
““2 3
Importe
”” 
=
”” 
ov
”” 
.
”” 
Importe
”” $
,
””$ %

Habitacion
‘‘ 
=
‘‘ "
atencionesHabitacion
‘‘ 1
.
‘‘1 2
First
‘‘2 7
(
‘‘7 8
ai
‘‘8 :
=>
‘‘; =
ai
‘‘> @
.
‘‘@ A
Id
‘‘A C
==
‘‘D F 
eventosTransaccion
‘‘G Y
.
‘‘Y Z
First
‘‘Z _
(
‘‘_ `
et
‘‘` b
=>
‘‘c e
et
‘‘f h
.
‘‘h i

IdAtencion
‘‘i s
==
‘‘t v
ov
‘‘w y
.
‘‘y z
IdReferencia‘‘z Ü
)‘‘Ü á
.‘‘á à

IdAtencion‘‘à í
)‘‘í ì
.‘‘ì î

Habitacion‘‘î û
,‘‘û ü
}
’’ 
)
’’ 
.
’’ 
ToList
’’ 
(
’’ 
)
’’ 
;
’’ 
foreach
÷÷ 
(
÷÷ 
var
÷÷ 
notaCredito
÷÷ $
in
÷÷% '
notasCredito
÷÷( 4
)
÷÷4 5
{
◊◊ 

facturadas
ÿÿ 
.
ÿÿ 
Add
ÿÿ 
(
ÿÿ 
new
ÿÿ "
	Facturada
ÿÿ# ,
(
ÿÿ, -
)
ÿÿ- .
{
ŸŸ 
IdEventoFacturado
⁄⁄ %
=
⁄⁄& ' 
eventosTransaccion
⁄⁄( :
.
⁄⁄: ;
First
⁄⁄; @
(
⁄⁄@ A
et
⁄⁄A C
=>
⁄⁄D F
et
⁄⁄G I
.
⁄⁄I J

IdAtencion
⁄⁄J T
==
⁄⁄U W
ordenesVentas
⁄⁄X e
.
⁄⁄e f
First
⁄⁄f k
(
⁄⁄k l
ov
⁄⁄l n
=>
⁄⁄o q
ov
⁄⁄r t
.
⁄⁄t u
Id
⁄⁄u w
==
⁄⁄x z
notaCredito⁄⁄{ Ü
.⁄⁄Ü á
IdReferencia⁄⁄á ì
)⁄⁄ì î
.⁄⁄î ï
IdReferencia⁄⁄ï °
)⁄⁄° ¢
.⁄⁄¢ £
Id⁄⁄£ •
,⁄⁄• ¶
Facturacion
€€ 
=
€€  ! 
eventosTransaccion
€€" 4
.
€€4 5
First
€€5 :
(
€€: ;
et
€€; =
=>
€€> @
et
€€A C
.
€€C D

IdAtencion
€€D N
==
€€O Q
ordenesVentas
€€R _
.
€€_ `
First
€€` e
(
€€e f
ov
€€f h
=>
€€i k
ov
€€l n
.
€€n o
Id
€€o q
==
€€r t
notaCredito€€u Ä
.€€Ä Å
IdReferencia€€Å ç
)€€ç é
.€€é è
IdReferencia€€è õ
)€€õ ú
.€€ú ù
ModoFacturacion€€ù ¨
==€€≠ Ø
(€€∞ ±
int€€± ¥
)€€¥ µ$
ModoFacturacionHotel€€µ …
.€€…  
Global€€  –
?€€— “
$str€€” ‹
:€€› ﬁ
$str€€ﬂ Ô
,€€Ô 
Fecha
‹‹ 
=
‹‹  
eventosTransaccion
‹‹ .
.
‹‹. /
First
‹‹/ 4
(
‹‹4 5
et
‹‹5 7
=>
‹‹8 :
et
‹‹; =
.
‹‹= >

IdAtencion
‹‹> H
==
‹‹I K
ordenesVentas
‹‹L Y
.
‹‹Y Z
First
‹‹Z _
(
‹‹_ `
ov
‹‹` b
=>
‹‹c e
ov
‹‹f h
.
‹‹h i
Id
‹‹i k
==
‹‹l n
notaCredito
‹‹o z
.
‹‹z {
IdReferencia‹‹{ á
)‹‹á à
.‹‹à â
IdReferencia‹‹â ï
)‹‹ï ñ
.‹‹ñ ó
Fecha‹‹ó ú
,‹‹ú ù
Codigo
›› 
=
›› "
atencionesHabitacion
›› 1
.
››1 2
First
››2 7
(
››7 8
ai
››8 :
=>
››; =
ai
››> @
.
››@ A
Id
››A C
==
››D F 
eventosTransaccion
››G Y
.
››Y Z
First
››Z _
(
››_ `
et
››` b
=>
››c e
et
››f h
.
››h i

IdAtencion
››i s
==
››t v
ordenesVentas››w Ñ
.››Ñ Ö
First››Ö ä
(››ä ã
ov››ã ç
=>››é ê
ov››ë ì
.››ì î
Id››î ñ
==››ó ô
notaCredito››ö •
.››• ¶
IdReferencia››¶ ≤
)››≤ ≥
.››≥ ¥
IdReferencia››¥ ¿
)››¿ ¡
.››¡ ¬

IdAtencion››¬ Ã
)››Ã Õ
.››Õ Œ
Codigo››Œ ‘
,››‘ ’
TipoComprobante
ﬁﬁ #
=
ﬁﬁ$ %
notaCredito
ﬁﬁ& 1
.
ﬁﬁ1 2
TipoComprobante
ﬁﬁ2 A
,
ﬁﬁA B%
SerieYNumeroComprobante
ﬂﬂ +
=
ﬂﬂ, -
notaCredito
ﬂﬂ. 9
.
ﬂﬂ9 :%
SerieYNumeroComprobante
ﬂﬂ: Q
,
ﬂﬂQ R
Cliente
‡‡ 
=
‡‡ 
notaCredito
‡‡ )
.
‡‡) *
Cliente
‡‡* 1
,
‡‡1 2
FechaOperacion
·· "
=
··# $
notaCredito
··% 0
.
··0 1
FechaOperacion
··1 ?
,
··? @
Importe
‚‚ 
=
‚‚ 
notaCredito
‚‚ )
.
‚‚) *
Importe
‚‚* 1
*
‚‚2 3
-
‚‚4 5
$num
‚‚5 6
,
‚‚6 7

Habitacion
„„ 
=
„„  "
atencionesHabitacion
„„! 5
.
„„5 6
First
„„6 ;
(
„„; <
ai
„„< >
=>
„„? A
ai
„„B D
.
„„D E
Id
„„E G
==
„„H J 
eventosTransaccion
„„K ]
.
„„] ^
First
„„^ c
(
„„c d
et
„„d f
=>
„„g i
et
„„j l
.
„„l m

IdAtencion
„„m w
==
„„x z
ordenesVentas„„{ à
.„„à â
First„„â é
(„„é è
ov„„è ë
=>„„í î
ov„„ï ó
.„„ó ò
Id„„ò ö
==„„õ ù
notaCredito„„û ©
.„„© ™
IdReferencia„„™ ∂
)„„∂ ∑
.„„∑ ∏
IdReferencia„„∏ ƒ
)„„ƒ ≈
.„„≈ ∆

IdAtencion„„∆ –
)„„– —
.„„— “

Habitacion„„“ ‹
,„„‹ ›
}
‰‰ 
)
‰‰ 
;
‰‰ 
}
ÂÂ 
return
ÊÊ 

facturadas
ÊÊ 
;
ÊÊ 
}
ÁÁ 	
public
ËË 
IEnumerable
ËË 
<
ËË 
NoFacturada
ËË &
>
ËË& '!
ObtenerNoFacturadas
ËË( ;
(
ËË; <
int
ËË< ?
idEstablecimiento
ËË@ Q
,
ËËQ R
DateTime
ËËS [

fechaDesde
ËË\ f
,
ËËf g
DateTime
ËËh p

fechaHasta
ËËq {
)
ËË{ |
{
ÈÈ 	
SigescomEntities
ÍÍ 
_db
ÍÍ  
=
ÍÍ! "
new
ÍÍ# &
SigescomEntities
ÍÍ' 7
(
ÍÍ7 8
)
ÍÍ8 9
;
ÍÍ9 :
var
ÎÎ 
noFacturadas
ÎÎ 
=
ÎÎ 
_db
ÎÎ "
.
ÎÎ" #
Transaccion
ÎÎ# .
.
ÎÎ. /
Where
ÎÎ/ 4
(
ÎÎ4 5
t
ÎÎ5 6
=>
ÎÎ7 9
t
ÎÎ: ;
.
ÎÎ; <$
fecha_registro_sistema
ÎÎ< R
>=
ÎÎS U

fechaDesde
ÎÎV `
&&
ÎÎa c
t
ÎÎd e
.
ÎÎe f$
fecha_registro_sistema
ÎÎf |
<=
ÎÎ} 

fechaHastaÎÎÄ ä
&&ÎÎã ç
tÎÎé è
.ÎÎè ê#
id_tipo_transaccionÎÎê £
==ÎÎ§ ¶
HotelSettingsÎÎß ¥
.ÎÎ¥ µ
DefaultÎÎµ º
.ÎÎº Ω5
%IdTipoTransaccionAtencionDeHabitacionÎÎΩ ‚
&&ÎÎ„ Â
tÎÎÊ Á
.ÎÎÁ Ë
Actor_negocio2ÎÎË ˆ
.ÎÎˆ ˜
Actor_negocio2ÎÎ˜ Ö
.ÎÎÖ Ü&
id_actor_negocio_padreÎÎÜ ú
==ÎÎù ü!
idEstablecimientoÎÎ† ±
&&ÎÎ≤ ¥
tÎÎµ ∂
.ÎÎ∂ ∑ 
id_estado_actualÎÎ∑ «
!=ÎÎ»  
MaestroSettingsÎÎÀ ⁄
.ÎÎ⁄ €
DefaultÎÎ€ ‚
.ÎÎ‚ „-
IdDetalleMaestroEstadoAnuladoÎÎ„ Ä
&&ÎÎÅ É
!ÎÎÑ Ö
tÎÎÖ Ü
.ÎÎÜ á

indicador2ÎÎá ë
&&ÎÎí î
tÎÎï ñ
.ÎÎñ ó
importe_totalÎÎó §
>ÎÎ• ¶
$numÎÎß ®
)ÎÎ® ©
.
ÏÏ 
Select
ÏÏ $
(
ÏÏ$ %
t
ÏÏ% &
=>
ÏÏ' )
new
ÏÏ* -
NoFacturada
ÏÏ. 9
(
ÏÏ9 :
)
ÏÏ: ;
{
ÌÌ 
FechaRegistro
ÓÓ! .
=
ÓÓ/ 0
t
ÓÓ1 2
.
ÓÓ2 3$
fecha_registro_sistema
ÓÓ3 I
,
ÓÓI J
Codigo
ÔÔ! '
=
ÔÔ( )
t
ÔÔ* +
.
ÔÔ+ ,
codigo
ÔÔ, 2
,
ÔÔ2 3
	Huespedes
! *
=
+ ,
t
- .
.
. /+
Actor_negocio_por_transaccion
/ L
.
L M
Select
M S
(
S T
anpt
T X
=>
Y [
new
\ _
Huesped
` g
(
g h
)
h i
{
ÒÒ! "
Nombre
ÚÚ% +
=
ÚÚ, -
anpt
ÚÚ. 2
.
ÚÚ2 3
Actor_negocio
ÚÚ3 @
.
ÚÚ@ A
Actor
ÚÚA F
.
ÚÚF G
primer_nombre
ÚÚG T
.
ÚÚT U
Replace
ÚÚU \
(
ÚÚ\ ]
$str
ÚÚ] `
,
ÚÚ` a
$str
ÚÚb e
)
ÚÚe f
,
ÚÚf g
ExtensionJson
ÛÛ% 2
=
ÛÛ3 4
anpt
ÛÛ5 9
.
ÛÛ9 :
extension_json
ÛÛ: H
,
ÛÛH I
}
ÙÙ! "
)
ÙÙ" #
,
ÙÙ# $
TipoHabitacion
ıı! /
=
ıı0 1
t
ıı2 3
.
ıı3 4
Actor_negocio2
ıı4 B
.
ııB C
Concepto_negocio
ııC S
.
ııS T
sufijo
ııT Z
,
ııZ [
CodigoHabitacion
ˆˆ! 1
=
ˆˆ2 3
t
ˆˆ4 5
.
ˆˆ5 6
Actor_negocio2
ˆˆ6 D
.
ˆˆD E
Actor
ˆˆE J
.
ˆˆJ K(
numero_documento_identidad
ˆˆK e
,
ˆˆe f
Importe
˜˜! (
=
˜˜) *
t
˜˜+ ,
.
˜˜, -
importe_total
˜˜- :
,
˜˜: ;
Estado
¯¯! '
=
¯¯( )
t
¯¯* +
.
¯¯+ , 
Estado_transaccion
¯¯, >
.
¯¯> ?
OrderByDescending
¯¯? P
(
¯¯P Q
et
¯¯Q S
=>
¯¯T V
et
¯¯W Y
.
¯¯Y Z
fecha
¯¯Z _
)
¯¯_ `
.
¯¯` a
FirstOrDefault
¯¯a o
(
¯¯o p
)
¯¯p q
.
¯¯q r
Detalle_maestro¯¯r Å
.¯¯Å Ç
nombre¯¯Ç à
}
˘˘ 
)
˙˙ 
;
˙˙ 
return
˚˚ 
noFacturadas
˚˚ 
;
˚˚  
}
¸¸ 	
public
˝˝ 
IEnumerable
˝˝ 
<
˝˝ 
	Incidente
˝˝ $
>
˝˝$ %
ObtenerIncidentes
˝˝& 7
(
˝˝7 8
int
˝˝8 ;
idEstablecimiento
˝˝< M
,
˝˝M N
DateTime
˝˝O W

fechaDesde
˝˝X b
,
˝˝b c
DateTime
˝˝d l

fechaHasta
˝˝m w
)
˝˝w x
{
˛˛ 	
SigescomEntities
ˇˇ 
_db
ˇˇ  
=
ˇˇ! "
new
ˇˇ# &
SigescomEntities
ˇˇ' 7
(
ˇˇ7 8
)
ˇˇ8 9
;
ˇˇ9 :
var
ÄÄ  
eventosTransaccion
ÄÄ "
=
ÄÄ# $
_db
ÄÄ% (
.
ÄÄ( ) 
Evento_transaccion
ÄÄ) ;
.
ÄÄ; <
Where
ÄÄ< A
(
ÄÄA B
et
ÄÄB D
=>
ÄÄE G
et
ÄÄH J
.
ÄÄJ K
fecha
ÄÄK P
>=
ÄÄQ S

fechaDesde
ÄÄT ^
&&
ÄÄ_ a
et
ÄÄb d
.
ÄÄd e
fecha
ÄÄe j
<=
ÄÄk m

fechaHasta
ÄÄn x
&&
ÄÄy {
et
ÄÄ| ~
.
ÄÄ~ 
	id_eventoÄÄ à
==ÄÄâ ã
MaestroSettingsÄÄå õ
.ÄÄõ ú
DefaultÄÄú £
.ÄÄ£ §/
IdDetalleMaestroEstadoIncidenteÄÄ§ √
&&ÄÄƒ ∆
(ÄÄ« »
etÄÄ»  
.ÄÄ  À
TransaccionÄÄÀ ÷
.ÄÄ÷ ◊#
id_tipo_transaccionÄÄ◊ Í
==ÄÄÎ Ì
HotelSettingsÄÄÓ ˚
.ÄÄ˚ ¸
DefaultÄÄ¸ É
.ÄÄÉ Ñ5
%IdTipoTransaccionAtencionDeHabitacionÄÄÑ ©
||ÄÄ™ ¨
etÄÄ≠ Ø
.ÄÄØ ∞
TransaccionÄÄ∞ ª
.ÄÄª º#
id_tipo_transaccionÄÄº œ
==ÄÄ– “
HotelSettingsÄÄ” ‡
.ÄÄ‡ ·
DefaultÄÄ· Ë
.ÄÄË È0
 IdTipoTransaccionAtencionDeHotelÄÄÈ â
)ÄÄâ ä
&&ÄÄã ç
(ÄÄé è
etÄÄè ë
.ÄÄë í
TransaccionÄÄí ù
.ÄÄù û
Actor_negocio2ÄÄû ¨
.ÄÄ¨ ≠
Actor_negocio2ÄÄ≠ ª
.ÄÄª º&
id_actor_negocio_padreÄÄº “
==ÄÄ” ’!
idEstablecimientoÄÄ÷ Á
||ÄÄË Í
etÄÄÎ Ì
.ÄÄÌ Ó
TransaccionÄÄÓ ˘
.ÄÄ˘ ˙
Actor_negocio2ÄÄ˙ à
.ÄÄà â&
id_actor_negocio_padreÄÄâ ü
==ÄÄ† ¢!
idEstablecimientoÄÄ£ ¥
)ÄÄ¥ µ
)ÄÄµ ∂
.
ÅÅ 
Select
ÅÅ 
(
ÅÅ 
et
ÅÅ 
=>
ÅÅ 
new
ÅÅ 
EventoAtencion
ÅÅ -
{
ÇÇ 
Id
ÉÉ 
=
ÉÉ 
et
ÉÉ 
.
ÉÉ 
id
ÉÉ 
,
ÉÉ 
Fecha
ÑÑ 
=
ÑÑ 
et
ÑÑ 
.
ÑÑ 
fecha
ÑÑ !
,
ÑÑ! "
Justificacion
ÖÖ 
=
ÖÖ  
et
ÖÖ! #
.
ÖÖ# $

comentario
ÖÖ$ .
,
ÖÖ. /
Empleado
ÜÜ 
=
ÜÜ 
et
ÜÜ 
.
ÜÜ 
Actor_negocio
ÜÜ ,
.
ÜÜ, -
Actor
ÜÜ- 2
.
ÜÜ2 3
primer_nombre
ÜÜ3 @
.
ÜÜ@ A
Replace
ÜÜA H
(
ÜÜH I
$str
ÜÜI L
,
ÜÜL M
$str
ÜÜN Q
)
ÜÜQ R
,
ÜÜR S
ModoFacturacion
áá  
=
áá! "
et
áá# %
.
áá% &
Transaccion
áá& 1
.
áá1 2
enum1
áá2 7
,
áá7 8

IdAtencion
àà 
=
àà 
et
àà  
.
àà  !
Transaccion
àà! ,
.
àà, -
id
àà- /
,
àà/ 0
}
ââ 
)
ââ 
.
ââ 
ToList
ââ 
(
ââ 
)
ââ 
;
ââ 
var
ää 

idsEventos
ää 
=
ää  
eventosTransaccion
ää /
.
ää/ 0
Select
ää0 6
(
ää6 7
et
ää7 9
=>
ää: <
et
ää= ?
.
ää? @
Id
ää@ B
)
ääB C
;
ääC D
var
ãã 
notasCredito
ãã 
=
ãã 
_db
ãã "
.
ãã" #
Transaccion
ãã# .
.
ãã. /
Where
ãã/ 4
(
ãã4 5
t
ãã5 6
=>
ãã7 9

idsEventos
ãã: D
.
ããD E
Contains
ããE M
(
ããM N
(
ããN O
int
ããO R
)
ããR S
t
ããS T
.
ããT U"
id_evento_referencia
ããU i
)
ããi j
)
ããj k
.
ããk l
Select
ããl r
(
ããr s
t
ããs t
=>
ããu w
new
ããx {
{
åå  
IdEventoReferencia
çç "
=
çç# $
t
çç% &
.
çç& '"
id_evento_referencia
çç' ;
,
çç; <%
IdTransaccionReferencia
éé '
=
éé( )
t
éé* +
.
éé+ ,'
id_transaccion_referencia
éé, E
,
ééE F
TipoComprobante
èè 
=
èè  !
t
èè" #
.
èè# $
Comprobante
èè$ /
.
èè/ 0
Detalle_maestro
èè0 ?
.
èè? @
nombre
èè@ F
,
èèF G%
SerieYNumeroComprobante
êê '
=
êê( )
t
êê* +
.
êê+ ,
Comprobante
êê, 7
.
êê7 8
numero_serie
êê8 D
+
êêE F
$str
êêG J
+
êêK L
t
êêM N
.
êêN O
Comprobante
êêO Z
.
êêZ [
numero
êê[ a
,
êêa b
Observacion
ëë 
=
ëë 
t
ëë 
.
ëë  

comentario
ëë  *
,
ëë* +
Importe
íí 
=
íí 
t
íí 
.
íí 
importe_total
íí )
}
ìì 
)
ìì 
.
ìì 
ToList
ìì 
(
ìì 
)
ìì 
;
ìì 
var
îî %
idsAtencionesOrdenVenta
îî '
=
îî( ) 
eventosTransaccion
îî* <
.
îî< =
Select
îî= C
(
îîC D
et
îîD F
=>
îîG I
et
îîJ L
.
îîL M

IdAtencion
îîM W
)
îîW X
.
îîX Y
ToList
îîY _
(
îî_ `
)
îî` a
;
îîa b
var
ïï /
!idsAtencionesOrdenVentaReferencia
ïï 1
=
ïï2 3
_db
ïï4 7
.
ïï7 8
Transaccion
ïï8 C
.
ïïC D
Where
ïïD I
(
ïïI J
t
ïïJ K
=>
ïïL N%
idsAtencionesOrdenVenta
ïïP g
.
ïïg h
Contains
ïïh p
(
ïïp q
(
ïïq r
long
ïïr v
)
ïïv w
t
ïïw x
.
ïïx y
id
ïïy {
)
ïï{ |
)
ïï| }
.
ïï} ~
Selectïï~ Ñ
(ïïÑ Ö
tïïÖ Ü
=>ïïá â
tïïä ã
.ïïã å
Transaccion3ïïå ò
)ïïò ô
.ïïô ö
Whereïïö ü
(ïïü †
tïï† °
=>ïï¢ §
tïï• ¶
.ïï¶ ß 
id_estado_actualïïß ∑
==ïï∏ ∫
MaestroSettingsïïª  
.ïï  À
DefaultïïÀ “
.ïï“ ”4
$IdDetalleMaestroEstadoSalidaCambiadoïï” ˜
)ïï˜ ¯
.ïï¯ ˘
Selectïï˘ ˇ
(ïïˇ Ä
tïïÄ Å
=>ïïÇ Ñ
tïïÖ Ü
.ïïÜ á
idïïá â
)ïïâ ä
.ïïä ã
ToListïïã ë
(ïïë í
)ïïí ì
;ïïì î
if
ññ 
(
ññ /
!idsAtencionesOrdenVentaReferencia
ññ 1
!=
ññ2 4
null
ññ5 9
)
ññ9 :%
idsAtencionesOrdenVenta
ññ; R
.
ññR S
AddRange
ññS [
(
ññ[ \/
!idsAtencionesOrdenVentaReferencia
ññ\ }
)
ññ} ~
;
ññ~ 
var
óó 
ordenesVentas
óó 
=
óó 
_db
óó "
.
óó" #
Transaccion
óó# .
.
óó. /
Where
óó/ 4
(
óó4 5
t
óó5 6
=>
óó7 9
t
óó: ;
.
óó; <!
id_tipo_transaccion
óó< O
==
óóP R!
TransaccionSettings
óóS f
.
óóf g
Default
óóg n
.
óón o,
IdTipoTransaccionOrdenDeVentaóóo å
&&óóç è'
idsAtencionesOrdenVentaóóê ß
.óóß ®
Containsóó® ∞
(óó∞ ±
(óó± ≤
longóó≤ ∂
)óó∂ ∑
tóó∑ ∏
.óó∏ π)
id_transaccion_referenciaóóπ “
)óó“ ”
)óó” ‘
.óó‘ ’
Whereóó’ ⁄
(óó⁄ €
tóó€ ‹
=>óó› ﬂ
tóó‡ ·
.óó· ‚#
Detalle_transaccionóó‚ ı
.óóı ˆ
Anyóóˆ ˘
(óó˘ ˙
dtóó˙ ¸
=>óó˝ ˇ
dtóóÄ Ç
.óóÇ É 
Concepto_negocioóóÉ ì
.óóì î"
id_concepto_basicoóóî ¶
==óóß ©
HotelSettingsóó™ ∑
.óó∑ ∏
Defaultóó∏ ø
.óóø ¿1
!IdDetalleMaestroFamiliaHabitacionóó¿ ·
)óó· ‚
)óó‚ „
.óó„ ‰
Selectóó‰ Í
(óóÍ Î
tóóÎ Ï
=>óóÌ Ô
newóó Û
{
òò 
Id
ôô 
=
ôô 
t
ôô 
.
ôô 
id
ôô 
,
ôô 
IdReferencia
öö 
=
öö 
t
öö  
.
öö  !'
id_transaccion_referencia
öö! :
,
öö: ;
TipoComprobante
õõ 
=
õõ  !
t
õõ" #
.
õõ# $
Comprobante
õõ$ /
.
õõ/ 0
Detalle_maestro
õõ0 ?
.
õõ? @
valor
õõ@ E
,
õõE F%
SerieYNumeroComprobante
úú '
=
úú( )
t
úú* +
.
úú+ ,
Comprobante
úú, 7
.
úú7 8
numero_serie
úú8 D
+
úúE F
$str
úúG J
+
úúK L
t
úúM N
.
úúN O
Comprobante
úúO Z
.
úúZ [
numero
úú[ a
,
úúa b
Importe
ùù 
=
ùù 
t
ùù 
.
ùù 
importe_total
ùù )
,
ùù) *
MontoHospedaje
ûû 
=
ûû  
t
ûû! "
.
ûû" #!
Detalle_transaccion
ûû# 6
.
ûû6 7
Where
ûû7 <
(
ûû< =
d
ûû= >
=>
ûû? A
d
ûûB C
.
ûûC D
Concepto_negocio
ûûD T
.
ûûT U 
id_concepto_basico
ûûU g
==
ûûh j
HotelSettings
ûûk x
.
ûûx y
Defaultûûy Ä
.ûûÄ Å1
!IdDetalleMaestroFamiliaHabitacionûûÅ ¢
)ûû¢ £
.ûû£ §
Sumûû§ ß
(ûûß ®
dûû® ©
=>ûû™ ¨
dûû≠ Æ
.ûûÆ Ø
totalûûØ ¥
)ûû¥ µ
}
üü 
)
üü 
.
üü 
ToList
üü 
(
üü 
)
üü 
;
üü 
var
†† !
atencionesIncidente
†† #
=
††$ %)
ObtenerAtencionesHabitacion
††& A
(
††A B
_db
††B E
,
††E F 
eventosTransaccion
††G Y
)
††Y Z
;
††Z [
var
°° 

incidentes
°° 
=
°° 
notasCredito
°° )
.
°°) *
Select
°°* 0
(
°°0 1
nc
°°1 3
=>
°°4 6
new
°°7 :
	Incidente
°°; D
(
°°D E
)
°°E F
{
¢¢ 
Fecha
££ 
=
££  
eventosTransaccion
££ *
.
££* +
First
££+ 0
(
££0 1
et
££1 3
=>
££4 6
et
££7 9
.
££9 :
Id
££: <
==
££= ?
nc
££@ B
.
££B C 
IdEventoReferencia
££C U
)
££U V
.
££V W
Fecha
££W \
,
££\ ]
Codigo
§§ 
=
§§ !
atencionesIncidente
§§ ,
.
§§, -
First
§§- 2
(
§§2 3
ai
§§3 5
=>
§§6 8
ai
§§9 ;
.
§§; <
Id
§§< >
==
§§@ B 
eventosTransaccion
§§C U
.
§§U V
First
§§V [
(
§§[ \
et
§§\ ^
=>
§§_ a
et
§§b d
.
§§d e
Id
§§e g
==
§§h j
nc
§§k m
.
§§m n!
IdEventoReferencia§§n Ä
)§§Ä Å
.§§Å Ç

IdAtencion§§Ç å
)§§å ç
.§§ç é
Codigo§§é î
,§§î ï
TipoComprobante
•• 
=
••  !
ordenesVentas
••" /
.
••/ 0
First
••0 5
(
••5 6
ov
••6 8
=>
••9 ;
ov
••< >
.
••> ?
Id
••? A
==
••B D
nc
••E G
.
••G H%
IdTransaccionReferencia
••H _
)
••_ `
.
••` a
TipoComprobante
••a p
,
••p q%
SerieYNumeroComprobante
¶¶ '
=
¶¶( )
ordenesVentas
¶¶* 7
.
¶¶7 8
First
¶¶8 =
(
¶¶= >
ov
¶¶> @
=>
¶¶A C
ov
¶¶D F
.
¶¶F G
Id
¶¶G I
==
¶¶J L
nc
¶¶M O
.
¶¶O P%
IdTransaccionReferencia
¶¶P g
)
¶¶g h
.
¶¶h i&
SerieYNumeroComprobante¶¶i Ä
,¶¶Ä Å
Importe
ßß 
=
ßß 
ordenesVentas
ßß '
.
ßß' (
First
ßß( -
(
ßß- .
ov
ßß. 0
=>
ßß1 3
ov
ßß4 6
.
ßß6 7
Id
ßß7 9
==
ßß: <
nc
ßß= ?
.
ßß? @%
IdTransaccionReferencia
ßß@ W
)
ßßW X
.
ßßX Y
Importe
ßßY `
,
ßß` a
MontoHospedaje
®® 
=
®®  
ordenesVentas
®®! .
.
®®. /
First
®®/ 4
(
®®4 5
ov
®®5 7
=>
®®8 :
ov
®®; =
.
®®= >
Id
®®> @
==
®®A C
nc
®®D F
.
®®F G%
IdTransaccionReferencia
®®G ^
)
®®^ _
.
®®_ `
MontoHospedaje
®®` n
,
®®n o
Devuelto
©© 
=
©© 
nc
©© 
.
©© 
Importe
©© %
,
©©% &

Habitacion
™™ 
=
™™ !
atencionesIncidente
™™ 0
.
™™0 1
First
™™1 6
(
™™6 7
ai
™™7 9
=>
™™: <
ai
™™= ?
.
™™? @
Id
™™@ B
==
™™C E 
eventosTransaccion
™™F X
.
™™X Y
First
™™Y ^
(
™™^ _
et
™™_ a
=>
™™b d
et
™™e g
.
™™g h
Id
™™h j
==
™™k m
nc
™™n p
.
™™p q!
IdEventoReferencia™™q É
)™™É Ñ
.™™Ñ Ö

IdAtencion™™Ö è
)™™è ê
.™™ê ë

Habitacion™™ë õ
,™™õ ú&
TipoComprobanteDescuento
´´ (
=
´´) *
nc
´´+ -
.
´´- .
TipoComprobante
´´. =
,
´´= >.
 SerieYNumeroComprobanteDescuento
¨¨ 0
=
¨¨1 2
nc
¨¨3 5
.
¨¨5 6%
SerieYNumeroComprobante
¨¨6 M
,
¨¨M N
Solucion
≠≠ 
=
≠≠ 
nc
≠≠ 
.
≠≠ 
Observacion
≠≠ )
,
≠≠) *
Empleado
ÆÆ 
=
ÆÆ  
eventosTransaccion
ÆÆ -
.
ÆÆ- .
First
ÆÆ. 3
(
ÆÆ3 4
et
ÆÆ4 6
=>
ÆÆ7 9
et
ÆÆ: <
.
ÆÆ< =
Id
ÆÆ= ?
==
ÆÆ@ B
nc
ÆÆC E
.
ÆÆE F 
IdEventoReferencia
ÆÆF X
)
ÆÆX Y
.
ÆÆY Z
Empleado
ÆÆZ b
,
ÆÆb c
Justificacion
ØØ 
=
ØØ  
eventosTransaccion
ØØ  2
.
ØØ2 3
First
ØØ3 8
(
ØØ8 9
et
ØØ9 ;
=>
ØØ< >
et
ØØ? A
.
ØØA B
Id
ØØB D
==
ØØE G
nc
ØØH J
.
ØØJ K 
IdEventoReferencia
ØØK ]
)
ØØ] ^
.
ØØ^ _
Justificacion
ØØ_ l
,
ØØl m
}
∞∞ 
)
∞∞ 
.
∞∞ 
ToList
∞∞ 
(
∞∞ 
)
∞∞ 
;
∞∞ 
return
±± 

incidentes
±± 
;
±± 
}
≤≤ 	
public
≥≥ 
List
≥≥ 
<
≥≥  
AtencionHabitacion
≥≥ &
>
≥≥& ')
ObtenerAtencionesHabitacion
≥≥( C
(
≥≥C D
SigescomEntities
≥≥D T
_db
≥≥U X
,
≥≥X Y
List
≥≥Z ^
<
≥≥^ _
EventoAtencion
≥≥_ m
>
≥≥m n!
eventosTransaccion≥≥o Å
)≥≥Å Ç
{
¥¥ 	
var
µµ #
idsAtencionHabitacion
µµ %
=
µµ& ' 
eventosTransaccion
µµ( :
.
µµ: ;
Where
µµ; @
(
µµ@ A
et
µµA C
=>
µµD F
et
µµG I
.
µµI J
ModoFacturacion
µµJ Y
==
µµZ \
(
µµ] ^
int
µµ^ a
)
µµa b"
ModoFacturacionHotel
µµb v
.
µµv w

Individualµµw Å
)µµÅ Ç
.µµÇ É
SelectµµÉ â
(µµâ ä
etµµä å
=>µµç è
etµµê í
.µµí ì

IdAtencionµµì ù
)µµù û
;µµû ü
var
∂∂ "
atencionesHabitacion
∂∂ $
=
∂∂% &
_db
∂∂' *
.
∂∂* +
Transaccion
∂∂+ 6
.
∂∂6 7
Where
∂∂7 <
(
∂∂< =
t
∂∂= >
=>
∂∂? A#
idsAtencionHabitacion
∂∂B W
.
∂∂W X
Contains
∂∂X `
(
∂∂` a
t
∂∂a b
.
∂∂b c
id
∂∂c e
)
∂∂e f
)
∂∂f g
.
∂∂g h
Select
∂∂h n
(
∂∂n o
t
∂∂o p
=>
∂∂q s
new
∂∂t w!
AtencionHabitacion∂∂x ä
{
∑∑ 
Id
∏∏ 
=
∏∏ 
t
∏∏ 
.
∏∏ 
id
∏∏ 
,
∏∏ 
Codigo
ππ 
=
ππ 
t
ππ 
.
ππ 
codigo
ππ !
,
ππ! "

Habitacion
∫∫ 
=
∫∫ 
t
∫∫ 
.
∫∫ 
Actor_negocio2
∫∫ -
.
∫∫- .
Concepto_negocio
∫∫. >
.
∫∫> ?
sufijo
∫∫? E
+
∫∫F G
$str
∫∫H K
+
∫∫L M
t
∫∫N O
.
∫∫O P
Actor_negocio2
∫∫P ^
.
∫∫^ _
Actor
∫∫_ d
.
∫∫d e(
numero_documento_identidad
∫∫e 
,∫∫ Ä
}
ªª 
)
ªª 
.
ªª 
ToList
ªª 
(
ªª 
)
ªª 
;
ªª 
var
ºº 
idsAtencionHotel
ºº  
=
ºº! " 
eventosTransaccion
ºº# 5
.
ºº5 6
Where
ºº6 ;
(
ºº; <
et
ºº< >
=>
ºº? A
et
ººB D
.
ººD E
ModoFacturacion
ººE T
==
ººU W
(
ººX Y
int
ººY \
)
ºº\ ]"
ModoFacturacionHotel
ºº] q
.
ººq r
Global
ººr x
)
ººx y
.
ººy z
Selectººz Ä
(ººÄ Å
etººÅ É
=>ººÑ Ü
etººá â
.ººâ ä

IdAtencionººä î
)ººî ï
;ººï ñ
var
ΩΩ ,
atencionesHotelConHabitaciones
ΩΩ .
=
ΩΩ/ 0
_db
ΩΩ1 4
.
ΩΩ4 5
Transaccion
ΩΩ5 @
.
ΩΩ@ A
Where
ΩΩA F
(
ΩΩF G
t
ΩΩG H
=>
ΩΩI K
idsAtencionHotel
ΩΩL \
.
ΩΩ\ ]
Contains
ΩΩ] e
(
ΩΩe f
t
ΩΩf g
.
ΩΩg h
id
ΩΩh j
)
ΩΩj k
)
ΩΩk l
.
ΩΩl m
Select
ΩΩm s
(
ΩΩs t
t
ΩΩt u
=>
ΩΩv x
new
ΩΩy |
{
ææ 
Id
øø 
=
øø 
t
øø 
.
øø 
id
øø 
,
øø 
Codigo
¿¿ 
=
¿¿ 
t
¿¿ 
.
¿¿ 
codigo
¿¿ !
,
¿¿! "
Habitaciones
¡¡ 
=
¡¡ 
t
¡¡  
.
¡¡  !
Transaccion1
¡¡! -
.
¡¡- .
Where
¡¡. 3
(
¡¡3 4
t1
¡¡4 6
=>
¡¡7 9
t1
¡¡: <
.
¡¡< =
importe_total
¡¡= J
>
¡¡K L
$num
¡¡M N
)
¡¡N O
.
¡¡O P
Select
¡¡P V
(
¡¡V W
t1
¡¡W Y
=>
¡¡Z \
new
¡¡] `
{
¬¬ 
IdTipoHabitacion
√√ $
=
√√% &
t1
√√' )
.
√√) *
Actor_negocio2
√√* 8
.
√√8 9!
id_concepto_negocio
√√9 L
,
√√L M
TipoHabitacion
ƒƒ "
=
ƒƒ# $
t1
ƒƒ% '
.
ƒƒ' (
Actor_negocio2
ƒƒ( 6
.
ƒƒ6 7
Concepto_negocio
ƒƒ7 G
.
ƒƒG H
sufijo
ƒƒH N
,
ƒƒN O
CodigoHabitacion
≈≈ $
=
≈≈% &
t1
≈≈' )
.
≈≈) *
Actor_negocio2
≈≈* 8
.
≈≈8 9
Actor
≈≈9 >
.
≈≈> ?(
numero_documento_identidad
≈≈? Y
,
≈≈Y Z
}
∆∆ 
)
∆∆ 
.
∆∆ 
ToList
∆∆ 
(
∆∆ 
)
∆∆ 
}
«« 
)
«« 
.
«« 
ToList
«« 
(
«« 
)
«« 
;
«« 
var
»» 
atencionesHotel
»» 
=
»»  !
new
»»" %
List
»»& *
<
»»* + 
AtencionHabitacion
»»+ =
>
»»= >
(
»»> ?
)
»»? @
;
»»@ A
for
…… 
(
…… 
int
…… 
i
…… 
=
…… 
$num
…… 
;
…… 
i
…… 
<
…… ,
atencionesHotelConHabitaciones
……  >
.
……> ?
Count
……? D
;
……D E
i
……F G
++
……G I
)
……I J
{
   
string
ÀÀ 

habitacion
ÀÀ !
=
ÀÀ" #
$str
ÀÀ$ &
;
ÀÀ& '
var
ÃÃ (
idTiposHabitacionDistintos
ÃÃ .
=
ÃÃ/ 0,
atencionesHotelConHabitaciones
ÃÃ1 O
[
ÃÃO P
i
ÃÃP Q
]
ÃÃQ R
.
ÃÃR S
Habitaciones
ÃÃS _
.
ÃÃ_ `
Select
ÃÃ` f
(
ÃÃf g
h
ÃÃg h
=>
ÃÃi k
h
ÃÃl m
.
ÃÃm n
IdTipoHabitacion
ÃÃn ~
)
ÃÃ~ 
.ÃÃ Ä
DistinctÃÃÄ à
(ÃÃà â
)ÃÃâ ä
;ÃÃä ã
foreach
ÕÕ 
(
ÕÕ 
var
ÕÕ 
idTipoHabitacion
ÕÕ -
in
ÕÕ. 0(
idTiposHabitacionDistintos
ÕÕ1 K
)
ÕÕK L
{
ŒŒ 
var
œœ 
codigosHabitacion
œœ )
=
œœ* +,
atencionesHotelConHabitaciones
œœ, J
[
œœJ K
i
œœK L
]
œœL M
.
œœM N
Habitaciones
œœN Z
.
œœZ [
Where
œœ[ `
(
œœ` a
h
œœa b
=>
œœc e
h
œœf g
.
œœg h
IdTipoHabitacion
œœh x
==
œœy {
idTipoHabitacionœœ| å
)œœå ç
.œœç é
Selectœœé î
(œœî ï
hœœï ñ
=>œœó ô
hœœö õ
.œœõ ú 
CodigoHabitacionœœú ¨
)œœ¨ ≠
.œœ≠ Æ
ToListœœÆ ¥
(œœ¥ µ
)œœµ ∂
;œœ∂ ∑

habitacion
–– 
+=
–– !,
atencionesHotelConHabitaciones
––" @
[
––@ A
i
––A B
]
––B C
.
––C D
Habitaciones
––D P
.
––P Q
First
––Q V
(
––V W
h
––W X
=>
––Y [
h
––\ ]
.
––] ^
IdTipoHabitacion
––^ n
==
––o q
idTipoHabitacion––r Ç
)––Ç É
.––É Ñ
TipoHabitacion––Ñ í
+––ì î
$str––ï ò
+––ô ö
String––õ °
.––° ¢
Join––¢ ¶
(––¶ ß
$str––ß ™
,––™ ´!
codigosHabitacion––¨ Ω
)––Ω æ
+––ø ¿
$str––¡ ∆
;––∆ «
}
—— 

habitacion
““ 
=
““ 

habitacion
““ '
.
““' (
	Substring
““( 1
(
““1 2
$num
““2 3
,
““3 4

habitacion
““5 ?
.
““? @
Length
““@ F
-
““G H
$num
““I J
)
““J K
;
““K L
atencionesHotel
”” 
.
””  
Add
””  #
(
””# $
new
””$ ' 
AtencionHabitacion
””( :
(
””: ;
)
””; <
{
‘‘ 
Id
’’ 
=
’’ ,
atencionesHotelConHabitaciones
’’ 7
[
’’7 8
i
’’8 9
]
’’9 :
.
’’: ;
Id
’’; =
,
’’= >
Codigo
÷÷ 
=
÷÷ ,
atencionesHotelConHabitaciones
÷÷ ;
[
÷÷; <
i
÷÷< =
]
÷÷= >
.
÷÷> ?
Codigo
÷÷? E
,
÷÷E F

Habitacion
◊◊ 
=
◊◊  

habitacion
◊◊! +
}
ÿÿ 
)
ÿÿ 
;
ÿÿ 
}
ŸŸ "
atencionesHabitacion
⁄⁄  
.
⁄⁄  !
AddRange
⁄⁄! )
(
⁄⁄) *
atencionesHotel
⁄⁄* 9
)
⁄⁄9 :
;
⁄⁄: ;
return
€€ "
atencionesHabitacion
€€ '
;
€€' (
}
‹‹ 	
public
›› 
IEnumerable
›› 
<
›› 
Reserva
›› "
>
››" #(
ObtenerReservasConfirmadas
››$ >
(
››> ?
int
››? B
idEstablecimiento
››C T
,
››T U
DateTime
››V ^

fechaDesde
››_ i
,
››i j
DateTime
››k s

fechaHasta
››t ~
)
››~ 
{
ﬁﬁ 	
SigescomEntities
ﬂﬂ 
_db
ﬂﬂ  
=
ﬂﬂ! "
new
ﬂﬂ# &
SigescomEntities
ﬂﬂ' 7
(
ﬂﬂ7 8
)
ﬂﬂ8 9
;
ﬂﬂ9 :
var
‡‡ 
reservas
‡‡ 
=
‡‡ 
_db
‡‡ 
.
‡‡  
Estado_transaccion
‡‡ 1
.
‡‡1 2
Where
‡‡2 7
(
‡‡7 8
et
‡‡8 :
=>
‡‡; =
et
‡‡> @
.
‡‡@ A
Transaccion
‡‡A L
.
‡‡L M
fecha_inicio
‡‡M Y
>=
‡‡Z \

fechaDesde
‡‡] g
&&
‡‡h j
et
‡‡k m
.
‡‡m n
Transaccion
‡‡n y
.
‡‡y z
fecha_inicio‡‡z Ü
<=‡‡á â

fechaHasta‡‡ä î
&&‡‡ï ó
et‡‡ò ö
.‡‡ö õ
Transaccion‡‡õ ¶
.‡‡¶ ß 
id_estado_actual‡‡ß ∑
==‡‡∏ ∫
MaestroSettings‡‡ª  
.‡‡  À
Default‡‡À “
.‡‡“ ”0
 IdDetalleMaestroEstadoConfirmado‡‡” Û
&&‡‡Ù ˆ
et‡‡˜ ˘
.‡‡˘ ˙
Transaccion‡‡˙ Ö
.‡‡Ö Ü#
id_tipo_transaccion‡‡Ü ô
==‡‡ö ú
HotelSettings‡‡ù ™
.‡‡™ ´
Default‡‡´ ≤
.‡‡≤ ≥5
%IdTipoTransaccionAtencionDeHabitacion‡‡≥ ÿ
&&‡‡Ÿ €
et‡‡‹ ﬁ
.‡‡ﬁ ﬂ
Transaccion‡‡ﬂ Í
.‡‡Í Î
Actor_negocio2‡‡Î ˘
.‡‡˘ ˙
Actor_negocio2‡‡˙ à
.‡‡à â&
id_actor_negocio_padre‡‡â ü
==‡‡† ¢!
idEstablecimiento‡‡£ ¥
)‡‡¥ µ
.‡‡µ ∂
Select‡‡∂ º
(‡‡º Ω
et‡‡Ω ø
=>‡‡¿ ¬
et‡‡√ ≈
.‡‡≈ ∆
Transaccion‡‡∆ —
)‡‡— “
.
·· 
Select
·· 
(
·· 
t
·· 
=>
·· 
new
··  
Reserva
··! (
(
··( )
)
··) *
{
‚‚ 
Codigo
„„ 
=
„„ 
t
„„ 
.
„„ 
codigo
„„ %
,
„„% &
FechaIngreso
‰‰  
=
‰‰! "
t
‰‰# $
.
‰‰$ %
fecha_inicio
‰‰% 1
,
‰‰1 2
FechaSalida
ÂÂ 
=
ÂÂ  !
t
ÂÂ" #
.
ÂÂ# $
	fecha_fin
ÂÂ$ -
,
ÂÂ- .
Noches
ÊÊ 
=
ÊÊ 
(
ÊÊ 
int
ÊÊ !
)
ÊÊ! "
t
ÊÊ" #
.
ÊÊ# $
	cantidad1
ÊÊ$ -
,
ÊÊ- .
TipoHabitacion
ÁÁ "
=
ÁÁ# $
t
ÁÁ% &
.
ÁÁ& '
Actor_negocio2
ÁÁ' 5
.
ÁÁ5 6
Concepto_negocio
ÁÁ6 F
.
ÁÁF G
sufijo
ÁÁG M
,
ÁÁM N
CodigoHabitacion
ËË $
=
ËË% &
t
ËË' (
.
ËË( )
Actor_negocio2
ËË) 7
.
ËË7 8
Actor
ËË8 =
.
ËË= >(
numero_documento_identidad
ËË> X
,
ËËX Y
Importe
ÈÈ 
=
ÈÈ 
t
ÈÈ 
.
ÈÈ  
importe_total
ÈÈ  -
,
ÈÈ- .
FechaRegistro
ÍÍ !
=
ÍÍ" #
t
ÍÍ$ %
.
ÍÍ% & 
Estado_transaccion
ÍÍ& 8
.
ÍÍ8 9
FirstOrDefault
ÍÍ9 G
(
ÍÍG H
et
ÍÍH J
=>
ÍÍK M
et
ÍÍN P
.
ÍÍP Q
	id_estado
ÍÍQ Z
==
ÍÍ[ ]
MaestroSettings
ÍÍ^ m
.
ÍÍm n
Default
ÍÍn u
.
ÍÍu v/
 IdDetalleMaestroEstadoConfirmadoÍÍv ñ
)ÍÍñ ó
.ÍÍó ò
fechaÍÍò ù
,ÍÍù û
Responsable
ÎÎ 
=
ÎÎ  !
t
ÎÎ" #
.
ÎÎ# $
Actor_negocio3
ÎÎ$ 2
.
ÎÎ2 3
Actor
ÎÎ3 8
.
ÎÎ8 9
primer_nombre
ÎÎ9 F
.
ÎÎF G
Replace
ÎÎG N
(
ÎÎN O
$str
ÎÎO R
,
ÎÎR S
$str
ÎÎT W
)
ÎÎW X
,
ÎÎX Y
ModoFacturacion
ÏÏ #
=
ÏÏ$ %
t
ÏÏ& '
.
ÏÏ' (
enum1
ÏÏ( -
,
ÏÏ- .
}
ÌÌ 
)
ÌÌ 
;
ÌÌ 
return
ÓÓ 
reservas
ÓÓ 
;
ÓÓ 
}
ÔÔ 	
public
 
IEnumerable
 
<
 
Reserva
 "
>
" #9
+ObtenerReservasConfirmadasPorTipoHabitacion
$ O
(
O P
int
P S
idEstablecimiento
T e
,
e f
DateTime
g o

fechaDesde
p z
,
z {
DateTime| Ñ

fechaHastaÖ è
,è ê
intë î
[î ï
]ï ñ"
idsTiposHabitacionó ©
)© ™
{
ÒÒ 	
SigescomEntities
ÚÚ 
_db
ÚÚ  
=
ÚÚ! "
new
ÚÚ# &
SigescomEntities
ÚÚ' 7
(
ÚÚ7 8
)
ÚÚ8 9
;
ÚÚ9 :
var
ÛÛ 
reservas
ÛÛ 
=
ÛÛ 
_db
ÛÛ 
.
ÛÛ  
Estado_transaccion
ÛÛ 1
.
ÛÛ1 2
Where
ÛÛ2 7
(
ÛÛ7 8
et
ÛÛ8 :
=>
ÛÛ; =
et
ÛÛ> @
.
ÛÛ@ A
fecha
ÛÛA F
>=
ÛÛG I

fechaDesde
ÛÛJ T
&&
ÛÛU W
et
ÛÛX Z
.
ÛÛZ [
fecha
ÛÛ[ `
<=
ÛÛa c

fechaHasta
ÛÛd n
&&
ÛÛo q
et
ÛÛr t
.
ÛÛt u
TransaccionÛÛu Ä
.ÛÛÄ Å 
id_estado_actualÛÛÅ ë
==ÛÛí î
MaestroSettingsÛÛï §
.ÛÛ§ •
DefaultÛÛ• ¨
.ÛÛ¨ ≠0
 IdDetalleMaestroEstadoConfirmadoÛÛ≠ Õ
&&ÛÛŒ –
etÛÛ— ”
.ÛÛ” ‘
TransaccionÛÛ‘ ﬂ
.ÛÛﬂ ‡#
id_tipo_transaccionÛÛ‡ Û
==ÛÛÙ ˆ
HotelSettingsÛÛ˜ Ñ
.ÛÛÑ Ö
DefaultÛÛÖ å
.ÛÛå ç5
%IdTipoTransaccionAtencionDeHabitacionÛÛç ≤
&&ÛÛ≥ µ
etÛÛ∂ ∏
.ÛÛ∏ π
TransaccionÛÛπ ƒ
.ÛÛƒ ≈
Actor_negocio2ÛÛ≈ ”
.ÛÛ” ‘
Actor_negocio2ÛÛ‘ ‚
.ÛÛ‚ „&
id_actor_negocio_padreÛÛ„ ˘
==ÛÛ˙ ¸!
idEstablecimientoÛÛ˝ é
&&ÛÛè ë"
idsTiposHabitacionÛÛí §
.ÛÛ§ •
ContainsÛÛ• ≠
(ÛÛ≠ Æ
(ÛÛÆ Ø
intÛÛØ ≤
)ÛÛ≤ ≥
etÛÛ≥ µ
.ÛÛµ ∂
TransaccionÛÛ∂ ¡
.ÛÛ¡ ¬
Actor_negocio2ÛÛ¬ –
.ÛÛ– —#
id_concepto_negocioÛÛ— ‰
)ÛÛ‰ Â
)ÛÛÂ Ê
.ÛÛÊ Á
SelectÛÛÁ Ì
(ÛÛÌ Ó
etÛÛÓ 
=>ÛÛÒ Û
etÛÛÙ ˆ
.ÛÛˆ ˜
TransaccionÛÛ˜ Ç
)ÛÛÇ É
.
ÙÙ 
Select
ÙÙ 
(
ÙÙ 
t
ÙÙ 
=>
ÙÙ 
new
ÙÙ  
Reserva
ÙÙ! (
(
ÙÙ( )
)
ÙÙ) *
{
ıı 
Codigo
ˆˆ 
=
ˆˆ 
t
ˆˆ 
.
ˆˆ 
codigo
ˆˆ %
,
ˆˆ% &
FechaIngreso
˜˜  
=
˜˜! "
t
˜˜# $
.
˜˜$ %
fecha_inicio
˜˜% 1
,
˜˜1 2
FechaSalida
¯¯ 
=
¯¯  !
t
¯¯" #
.
¯¯# $
	fecha_fin
¯¯$ -
,
¯¯- .
Noches
˘˘ 
=
˘˘ 
(
˘˘ 
int
˘˘ !
)
˘˘! "
t
˘˘" #
.
˘˘# $
	cantidad1
˘˘$ -
,
˘˘- .
TipoHabitacion
˙˙ "
=
˙˙# $
t
˙˙% &
.
˙˙& '
Actor_negocio2
˙˙' 5
.
˙˙5 6
Concepto_negocio
˙˙6 F
.
˙˙F G
sufijo
˙˙G M
,
˙˙M N
CodigoHabitacion
˚˚ $
=
˚˚% &
t
˚˚' (
.
˚˚( )
Actor_negocio2
˚˚) 7
.
˚˚7 8
Actor
˚˚8 =
.
˚˚= >(
numero_documento_identidad
˚˚> X
,
˚˚X Y
Importe
¸¸ 
=
¸¸ 
t
¸¸ 
.
¸¸  
importe_total
¸¸  -
,
¸¸- .
FechaRegistro
˝˝ !
=
˝˝" #
t
˝˝$ %
.
˝˝% & 
Estado_transaccion
˝˝& 8
.
˝˝8 9
FirstOrDefault
˝˝9 G
(
˝˝G H
et
˝˝H J
=>
˝˝K M
et
˝˝N P
.
˝˝P Q
	id_estado
˝˝Q Z
==
˝˝[ ]
MaestroSettings
˝˝^ m
.
˝˝m n
Default
˝˝n u
.
˝˝u v/
 IdDetalleMaestroEstadoConfirmado˝˝v ñ
)˝˝ñ ó
.˝˝ó ò
fecha˝˝ò ù
,˝˝ù û
Responsable
˛˛ 
=
˛˛  !
t
˛˛" #
.
˛˛# $
Actor_negocio3
˛˛$ 2
.
˛˛2 3
Actor
˛˛3 8
.
˛˛8 9
primer_nombre
˛˛9 F
.
˛˛F G
Replace
˛˛G N
(
˛˛N O
$str
˛˛O R
,
˛˛R S
$str
˛˛T W
)
˛˛W X
,
˛˛X Y
ModoFacturacion
ˇˇ #
=
ˇˇ$ %
t
ˇˇ& '
.
ˇˇ' (
enum1
ˇˇ( -
,
ˇˇ- .
}
ÄÄ 
)
ÄÄ 
;
ÄÄ 
return
ÅÅ 
reservas
ÅÅ 
;
ÅÅ 
}
ÇÇ 	
}
ÉÉ 
}ÑÑ ¶e
mD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\LibrosElectronicos\LibrosElectronicosAdsoftDatos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
{ 
public 

partial 
class )
LibrosElectronicosAdsoftDatos 6
:7 80
$ILibrosElectronicosAdsoftRepositorio9 ]
{ 
public 
IEnumerable 
< 
VentaClienteAdsoft -
>- . 
ObtenerVentasCliente/ C
(C D
intD G
[G H
]H I 
idsTiposComprobantesJ ^
,^ _
int` c
[c d
]d e
idsTiposTransaccionf y
,y z
DateTime	{ É

fechaDesde
Ñ é
,
é è
DateTime
ê ò

fechaHasta
ô £
)
£ §
{ 	
try 
{ 
SigescomEntities  
_db! $
=% &
new' *
SigescomEntities+ ;
(; <
)< =
;= >
return 
_db 
. 
Transaccion &
. 
Where !
(! "
t" #
=>$ &
t' (
.( )
fecha_inicio) 5
>=6 8

fechaDesde9 C
&&D F
tG H
.H I
fecha_inicioI U
<=V X

fechaHastaY c
&& 
idsTiposTransaccion 2
.2 3
Contains3 ;
(; <
t< =
.= >
id_tipo_transaccion> Q
)Q R
&&  
idsTiposComprobantes 3
.3 4
Contains4 <
(< =
t= >
.> ?
Comprobante? J
.J K
id_tipo_comprobanteK ^
)^ _
)_ `
. 
Select #
(# $
t$ %
=>& (
new) ,
VentaClienteAdsoft- ?
(? @
)@ A
{   
Id!!  "
=!!# $
t!!% &
.!!& '
id!!' )
,!!) *
Anyo""  $
=""% &
t""' (
.""( )
fecha_inicio"") 5
.""5 6
Year""6 :
,"": ;
Mes##  #
=##$ %
t##& '
.##' (
fecha_inicio##( 4
.##4 5
Month##5 :
,##: ;
Dia$$  #
=$$$ %
t$$& '
.$$' (
fecha_inicio$$( 4
.$$4 5
Day$$5 8
,$$8 9
IdTipoTransaccion%%  1
=%%2 3
t%%4 5
.%%5 6
id_tipo_transaccion%%6 I
,%%I J
IdTipoComprobante&&  1
=&&2 3
t&&4 5
.&&5 6
Comprobante&&6 A
.&&A B
id_tipo_comprobante&&B U
,&&U V
CodigoComprobante''  1
=''2 3
t''4 5
.''5 6
Comprobante''6 A
.''A B
Detalle_maestro''B Q
.''Q R
codigo''R X
,''X Y
IdSerie((  '
=((( )
t((* +
.((+ ,
Comprobante((, 7
.((7 8 
id_serie_comprobante((8 L
,((L M
NumeroSerie))  +
=)), -
t)). /
.))/ 0
Comprobante))0 ;
.)); <
numero_serie))< H
,))H I
IdTipoDocumento**  /
=**0 1
t**2 3
.**3 4
Actor_negocio1**4 B
.**B C
Actor**C H
.**H I"
id_documento_identidad**I _
,**_ `
NumeroComprobante++  1
=++2 3
t++4 5
.++5 6
Comprobante++6 A
.++A B
numero++B H
,++H I!
IdActorNegocioExterno,,  5
=,,6 7
t,,8 9
.,,9 :$
id_actor_negocio_externo,,: R
,,,R S
CodigoDocumento--  /
=--0 1
t--2 3
.--3 4
Actor_negocio1--4 B
.--B C
Actor--C H
.--H I
Detalle_maestro--I X
.--X Y
codigo--Y _
,--_ `
NumeroDocumento..  /
=..0 1
t..2 3
...3 4
Actor_negocio1..4 B
...B C
Actor..C H
...H I&
numero_documento_identidad..I c
,..c d
PrimerNombre//  ,
=//- .
t/// 0
.//0 1
Actor_negocio1//1 ?
.//? @
Actor//@ E
.//E F
primer_nombre//F S
,//S T
ValorIgv00  (
=00) *
t00+ ,
.00, -
importe800- 5
,005 6
ValorIcbper11  +
=11, -
t11. /
.11/ 0
	importe10110 9
,119 :

ValorVenta22  *
=22+ ,
t22- .
.22. /
importe_total22/ <
-22= >
t22? @
.22@ A
importe822A I
-22J K
t22L M
.22M N
	importe1022N W
,22W X
Total33  %
=33& '
t33( )
.33) *
importe_total33* 7
,337 8
IdEstadoActual44  .
=44/ 0
(441 2
int442 5
)445 6
t446 7
.447 8
id_estado_actual448 H
,44H I$
IdEstadoAnteriorAlActual55  8
=559 :
t55; <
.55< =
Estado_transaccion55= O
.55O P
OrderByDescending55P a
(55a b
est55b e
=>55f h
est55i l
.55l m
id55m o
)55o p
.55p q
Skip55q u
(55u v
$num55v w
)55w x
.55x y
Take55y }
(55} ~
$num55~ 
)	55 Ä
.
55Ä Å
FirstOrDefault
55Å è
(
55è ê
)
55ê ë
.
55ë í
	id_estado
55í õ
,
55õ ú
CodigoMoneda66  ,
=66- .
t66/ 0
.660 1
Detalle_maestro1661 A
.66A B
codigo66B H
}88 
)99 
;99 
}:: 
catch;; 
(;; 
	Exception;; 
e;; 
);; 
{<< 
throw== 
new== 
DatosException== (
(==( )
$str==) N
,==N O
e==P Q
)==Q R
;==R S
}>> 
}?? 	
publicAA 
IEnumerableAA 
<AA 
VentaClienteAdsoftAA -
>AA- .Q
EObtenerVentasClienteConOperacionDeReferenciaSegunElEstadoQueDebeTenerAA/ t
(AAt u
intAAu x
[AAx y
]AAy z!
idsTiposComprobantes	AA{ è
,
AAè ê
int
AAë î
[
AAî ï
]
AAï ñ!
idsTiposTransaccion
AAó ™
,
AA™ ´
DateTime
AA¨ ¥

fechaDesde
AAµ ø
,
AAø ¿
DateTime
AA¡ …

fechaHasta
AA  ‘
)
AA‘ ’
{BB 	
tryCC 
{DD 
SigescomEntitiesEE  
_dbEE! $
=EE% &
newEE' *
SigescomEntitiesEE+ ;
(EE; <
)EE< =
;EE= >
returnFF 
_dbFF 
.FF 
TransaccionFF &
.GG 
WhereGG !
(GG! "
tGG" #
=>GG$ &
tGG' (
.GG( )
fecha_inicioGG) 5
>=GG6 8

fechaDesdeGG9 C
&&GGD F
tGGG H
.GGH I
fecha_inicioGGI U
<=GGV X

fechaHastaGGY c
&&HH 
idsTiposTransaccionHH 2
.HH2 3
ContainsHH3 ;
(HH; <
tHH< =
.HH= >
id_tipo_transaccionHH> Q
)HHQ R
&&II  
idsTiposComprobantesII 3
.II3 4
ContainsII4 <
(II< =
tII= >
.II> ?
ComprobanteII? J
.IIJ K
id_tipo_comprobanteIIK ^
)II^ _
)II_ `
.JJ 
SelectJJ #
(JJ# $
tJJ$ %
=>JJ& (
newJJ) ,
VentaClienteAdsoftJJ- ?
(JJ? @
)JJ@ A
{KK 
IdLL  "
=LL# $
tLL% &
.LL& '
idLL' )
,LL) *
AnyoMM  $
=MM% &
tMM' (
.MM( )
fecha_inicioMM) 5
.MM5 6
YearMM6 :
,MM: ;
MesNN  #
=NN$ %
tNN& '
.NN' (
fecha_inicioNN( 4
.NN4 5
MonthNN5 :
,NN: ;
DiaOO  #
=OO$ %
tOO& '
.OO' (
fecha_inicioOO( 4
.OO4 5
DayOO5 8
,OO8 9
FechaEmisionPP  ,
=PP- .
tPP/ 0
.PP0 1
fecha_inicioPP1 =
,PP= >
IdTipoComprobanteQQ  1
=QQ2 3
tQQ4 5
.QQ5 6
ComprobanteQQ6 A
.QQA B
id_tipo_comprobanteQQB U
,QQU V
CodigoComprobanteRR  1
=RR2 3
tRR4 5
.RR5 6
ComprobanteRR6 A
.RRA B
Detalle_maestroRRB Q
.RRQ R
codigoRRR X
,RRX Y
IdSerieSS  '
=SS( )
tSS* +
.SS+ ,
ComprobanteSS, 7
.SS7 8 
id_serie_comprobanteSS8 L
,SSL M
NumeroSerieTT  +
=TT, -
tTT. /
.TT/ 0
ComprobanteTT0 ;
.TT; <
numero_serieTT< H
,TTH I
IdTipoDocumentoUU  /
=UU0 1
tUU2 3
.UU3 4
Actor_negocio1UU4 B
.UUB C
ActorUUC H
.UUH I"
id_documento_identidadUUI _
,UU_ `
NumeroComprobanteVV  1
=VV2 3
tVV4 5
.VV5 6
ComprobanteVV6 A
.VVA B
numeroVVB H
,VVH I!
IdActorNegocioExternoWW  5
=WW6 7
tWW8 9
.WW9 :$
id_actor_negocio_externoWW: R
,WWR S
CodigoDocumentoXX  /
=XX0 1
tXX2 3
.XX3 4
Actor_negocio1XX4 B
.XXB C
ActorXXC H
.XXH I
Detalle_maestroXXI X
.XXX Y
codigoXXY _
,XX_ `
NumeroDocumentoYY  /
=YY0 1
tYY2 3
.YY3 4
Actor_negocio1YY4 B
.YYB C
ActorYYC H
.YYH I&
numero_documento_identidadYYI c
,YYc d
PrimerNombreZZ  ,
=ZZ- .
tZZ/ 0
.ZZ0 1
Actor_negocio1ZZ1 ?
.ZZ? @
ActorZZ@ E
.ZZE F
primer_nombreZZF S
,ZZS T
ValorIgv[[  (
=[[) *
t[[+ ,
.[[, -
importe8[[- 5
,[[5 6
ValorIcbper\\  +
=\\, -
t\\. /
.\\/ 0
	importe10\\0 9
,\\9 :

ValorVenta]]  *
=]]+ ,
t]]- .
.]]. /
importe_total]]/ <
-]]= >
t]]? @
.]]@ A
importe8]]A I
-]]J K
t]]L M
.]]M N
	importe10]]N W
,]]W X
Total^^  %
=^^& '
t^^( )
.^^) *
importe_total^^* 7
,^^7 8
IdEstadoActual__  .
=__/ 0
(__1 2
int__2 5
)__5 6
t__6 7
.__7 8
id_estado_actual__8 H
,__H I$
IdEstadoAnteriorAlActual``  8
=``9 :
t``; <
.``< =
Estado_transaccion``= O
.``O P
OrderByDescending``P a
(``a b
est``b e
=>``f h
est``i l
.``l m
id``m o
)``o p
.``p q
Skip``q u
(``u v
$num``v w
)``w x
.``x y
Take``y }
(``} ~
$num``~ 
)	`` Ä
.
``Ä Å
FirstOrDefault
``Å è
(
``è ê
)
``ê ë
.
``ë í
	id_estado
``í õ
,
``õ ú
CodigoMonedaaa  ,
=aa- .
taa/ 0
.aa0 1
Detalle_maestro1aa1 A
.aaA B
codigoaaB H
,aaH I!
NumeroSerieReferenciabb  5
=bb6 7
tbb8 9
.bb9 :
Transaccion3bb: F
.bbF G
ComprobantebbG R
.bbR S
numero_seriebbS _
,bb_ `'
NumeroComprobanteReferenciacc  ;
=cc< =
tcc> ?
.cc? @
Transaccion3cc@ L
.ccL M
ComprobanteccM X
.ccX Y
numeroccY _
,cc_ `"
FechaEmisionReferenciadd  6
=dd7 8
tdd9 :
.dd: ;
Transaccion3dd; G
.ddG H
fecha_inicioddH T
,ddT U'
CodigoComprobanteReferenciaee  ;
=ee< =
tee> ?
.ee? @
Transaccion3ee@ L
.eeL M
ComprobanteeeM X
.eeX Y
Detalle_maestroeeY h
.eeh i
codigoeei o
}ff 
)gg 
;gg 
}hh 
catchii 
(ii 
	Exceptionii 
eii 
)ii 
{jj 
throwkk 
newkk 
DatosExceptionkk (
(kk( )
$strkk) N
,kkN O
ekkP Q
)kkQ R
;kkR S
}ll 
}mm 	
}oo 
}pp ‘O
nD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\LibrosElectronicos\LibrosElectronicosFoxcontDatos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
{ 
public 

partial 
class *
LibrosElectronicosFoxcontDatos 7
:8 91
%ILibrosElectronicosFoxcontRepositorio: _
{ 
public 
IEnumerable 
< 
VentaClienteFoxcom -
>- .&
ObtenerVentasClienteFoxcom/ I
(I J
intJ M
[M N
]N O 
idsTiposComprobantesP d
,d e
intf i
[i j
]j k
idsTiposTransaccionl 
,	 Ä
DateTime
Å â

fechaDesde
ä î
,
î ï
DateTime
ñ û

fechaHasta
ü ©
)
© ™
{ 	
try 
{ 
SigescomEntities  
_db! $
=% &
new' *
SigescomEntities+ ;
(; <
)< =
;= >
return 
_db 
. 
Transaccion &
. 
Where 
( 
t 
=> 
t  !
.! "
fecha_inicio" .
>=/ 1

fechaDesde2 <
&&= ?
t@ A
.A B
fecha_inicioB N
<=O Q

fechaHastaR \
&& 
idsTiposTransaccion *
.* +
Contains+ 3
(3 4
t4 5
.5 6
id_tipo_transaccion6 I
)I J
&&  
idsTiposComprobantes +
.+ ,
Contains, 4
(4 5
t5 6
.6 7
Comprobante7 B
.B C
id_tipo_comprobanteC V
)V W
)W X
. 
Select 
( 
t 
=>  
new! $
VentaClienteFoxcom% 7
(7 8
)8 9
{   
Id!! 
=!! 
t!! 
.!! 
id!! !
,!!! "
FechaEmision"" $
=""% &
t""' (
.""( )
fecha_inicio"") 5
,""5 6
IdTipoComprobante## )
=##* +
t##, -
.##- .
Comprobante##. 9
.##9 :
id_tipo_comprobante##: M
,##M N
CodigoComprobante$$ )
=$$* +
t$$, -
.$$- .
Comprobante$$. 9
.$$9 :
Detalle_maestro$$: I
.$$I J
codigo$$J P
,$$P Q
NumeroSerie%% #
=%%$ %
t%%& '
.%%' (
Comprobante%%( 3
.%%3 4
numero_serie%%4 @
,%%@ A
NumeroComprobante&& )
=&&* +
t&&, -
.&&- .
Comprobante&&. 9
.&&9 :
numero&&: @
,&&@ A!
IdActorNegocioExterno'' -
=''. /
t''0 1
.''1 2$
id_actor_negocio_externo''2 J
,''J K
CodigoDocumento(( '
=((( )
t((* +
.((+ ,
Actor_negocio1((, :
.((: ;
Actor((; @
.((@ A
Detalle_maestro((A P
.((P Q
codigo((Q W
,((W X
NumeroDocumento)) '
=))( )
t))* +
.))+ ,
Actor_negocio1)), :
.)): ;
Actor)); @
.))@ A&
numero_documento_identidad))A [
,))[ \
RazonSocial** #
=**$ %
t**& '
.**' (
Actor_negocio1**( 6
.**6 7
Actor**7 <
.**< =
primer_nombre**= J
.**J K
Replace**K R
(**R S
$str**S V
,**V W
$str**X [
)**[ \
,**\ ]
Igv++ 
=++ 
t++ 
.++  
importe8++  (
,++( )
Icbper,, 
=,,  
t,,! "
.,," #
	importe10,,# ,
,,,, -

ValorVenta-- "
=--# $
t--% &
.--& '
importe_total--' 4
---5 6
t--7 8
.--8 9
importe8--9 A
---B C
t--D E
.--E F
	importe10--F O
,--O P
Total.. 
=.. 
t..  !
...! "
importe_total.." /
,../ 0
IdEstadoActual// &
=//' (
(//) *
int//* -
)//- .
t//. /
./// 0
id_estado_actual//0 @
,//@ A
}00 
)00 
;00 
}11 
catch22 
(22 
	Exception22 
e22 
)22 
{33 
throw44 
new44 
DatosException44 (
(44( )
$str44) N
,44N O
e44P Q
)44Q R
;44R S
}55 
}66 	
public77 
IEnumerable77 
<77 
VentaClienteFoxcom77 -
>77- .<
0ObtenerVentasClienteFoxcomConOperacionReferencia77/ _
(77_ `
int77` c
[77c d
]77d e 
idsTiposComprobantes77f z
,77z {
int77| 
[	77 Ä
]
77Ä Å!
idsTiposTransaccion
77Ç ï
,
77ï ñ
DateTime
77ó ü

fechaDesde
77† ™
,
77™ ´
DateTime
77¨ ¥

fechaHasta
77µ ø
)
77ø ¿
{88 	
try99 
{:: 
SigescomEntities;;  
_db;;! $
=;;% &
new;;' *
SigescomEntities;;+ ;
(;;; <
);;< =
;;;= >
return<< 
_db<< 
.<< 
Transaccion<< &
.== 
Where== 
(== 
t== 
=>== 
t==  !
.==! "
fecha_inicio==" .
>===/ 1

fechaDesde==2 <
&&=== ?
t==@ A
.==A B
fecha_inicio==B N
<===O Q

fechaHasta==R \
&&>> 
idsTiposTransaccion>> *
.>>* +
Contains>>+ 3
(>>3 4
t>>4 5
.>>5 6
id_tipo_transaccion>>6 I
)>>I J
&&??  
idsTiposComprobantes?? +
.??+ ,
Contains??, 4
(??4 5
t??5 6
.??6 7
Comprobante??7 B
.??B C
id_tipo_comprobante??C V
)??V W
)??W X
.@@ 
Select@@ 
(@@ 
t@@ 
=>@@  
new@@! $
VentaClienteFoxcom@@% 7
(@@7 8
)@@8 9
{AA 
IdBB 
=BB 
tBB 
.BB 
idBB !
,BB! "
FechaEmisionCC $
=CC% &
tCC' (
.CC( )
fecha_inicioCC) 5
,CC5 6
IdTipoComprobanteDD )
=DD* +
tDD, -
.DD- .
ComprobanteDD. 9
.DD9 :
id_tipo_comprobanteDD: M
,DDM N
CodigoComprobanteEE )
=EE* +
tEE, -
.EE- .
ComprobanteEE. 9
.EE9 :
Detalle_maestroEE: I
.EEI J
codigoEEJ P
,EEP Q
NumeroSerieFF #
=FF$ %
tFF& '
.FF' (
ComprobanteFF( 3
.FF3 4
numero_serieFF4 @
,FF@ A
NumeroComprobanteGG )
=GG* +
tGG, -
.GG- .
ComprobanteGG. 9
.GG9 :
numeroGG: @
,GG@ A!
IdActorNegocioExternoHH -
=HH. /
tHH0 1
.HH1 2$
id_actor_negocio_externoHH2 J
,HHJ K
CodigoDocumentoII '
=II( )
tII* +
.II+ ,
Actor_negocio1II, :
.II: ;
ActorII; @
.II@ A
Detalle_maestroIIA P
.IIP Q
codigoIIQ W
,IIW X
NumeroDocumentoJJ '
=JJ( )
tJJ* +
.JJ+ ,
Actor_negocio1JJ, :
.JJ: ;
ActorJJ; @
.JJ@ A&
numero_documento_identidadJJA [
,JJ[ \
RazonSocialKK #
=KK$ %
tKK& '
.KK' (
Actor_negocio1KK( 6
.KK6 7
ActorKK7 <
.KK< =
primer_nombreKK= J
.KKJ K
ReplaceKKK R
(KKR S
$strKKS V
,KKV W
$strKKX [
)KK[ \
,KK\ ]
IgvLL 
=LL 
tLL 
.LL  
importe8LL  (
,LL( )
IcbperMM 
=MM  
tMM! "
.MM" #
	importe10MM# ,
,MM, -

ValorVentaNN "
=NN# $
tNN% &
.NN& '
importe_totalNN' 4
-NN5 6
tNN7 8
.NN8 9
importe8NN9 A
-NNB C
tNND E
.NNE F
	importe10NNF O
,NNO P
TotalOO 
=OO 
tOO  !
.OO! "
importe_totalOO" /
,OO/ 0
IdEstadoActualPP &
=PP' (
(PP) *
intPP* -
)PP- .
tPP. /
.PP/ 0
id_estado_actualPP0 @
,PP@ A'
CodigoComprobanteReferenciaQQ 3
=QQ4 5
tQQ6 7
.QQ7 8
Transaccion3QQ8 D
.QQD E
ComprobanteQQE P
.QQP Q
Detalle_maestroQQQ `
.QQ` a
codigoQQa g
,QQg h!
NumeroSerieReferenciaRR -
=RR. /
tRR0 1
.RR1 2
Transaccion3RR2 >
.RR> ?
ComprobanteRR? J
.RRJ K
numero_serieRRK W
,RRW X'
NumeroComprobanteReferenciaSS 3
=SS4 5
tSS6 7
.SS7 8
Transaccion3SS8 D
.SSD E
ComprobanteSSE P
.SSP Q
numeroSSQ W
,SSW X"
FechaEmisionReferenciaTT .
=TT/ 0
tTT1 2
.TT2 3
Transaccion3TT3 ?
.TT? @
fecha_inicioTT@ L
,TTL M
}UU 
)UU 
;UU 
}VV 
catchWW 
(WW 
	ExceptionWW 
eWW 
)WW 
{XX 
throwYY 
newYY 
DatosExceptionYY (
(YY( )
$strYY) N
,YYN O
eYYP Q
)YYQ R
;YYR S
}ZZ 
}[[ 	
}\\ 
}]] æg
PD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\Pedido\Pedido_Datos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
." #
Sigescom# +
.+ ,
Pedido, 2
{3 4
public 

class 
Pedido_Datos 
: 
RepositorioBase -
,- .
IPedidoRepositorio. @
{ 
public 
IEnumerable 
< 
ResumenOrdenPedido -
>- .!
ObtenerOrdenesPedidos/ D
(D E
DateTimeE M

fechaDesdeN X
,X Y
DateTimeZ b

fechaHastac m
,m n
into r
idTipoTransaccion	s Ñ
,
Ñ Ö
int
Ü â
[
â ä
]
ä ã
	idEstados
å ï
)
ï ñ
{ 	
var 
resumen 
= 
_db 
. 
Transaccion )
.) *
Where* /
(/ 0
t0 1
=>2 4
t5 6
.6 7
id_tipo_transaccion7 J
==K M
idTipoTransaccionN _
&&` b
tc d
.d e
fecha_inicioe q
>=r t

fechaDesdeu 
&&
Ä Ç
t
É Ñ
.
Ñ Ö
fecha_inicio
Ö ë
<=
í î

fechaHasta
ï ü
&&
† ¢
	idEstados
£ ¨
.
¨ ≠
Contains
≠ µ
(
µ ∂
(
∂ ∑
int
∑ ∫
)
∫ ª
t
ª º
.
º Ω
id_estado_actual
Ω Õ
)
Õ Œ
)
Œ œ
.
œ –
Select
– ÷
(
÷ ◊
rop
◊ ⁄
=>
€ ›
new
ﬁ · 
ResumenOrdenPedido
‚ Ù
(
Ù ı
)
ı ˆ
{ 
DocumentoCliente  
=! "
rop# &
.& '
Actor_negocio1' 5
.5 6
Actor6 ;
.; <&
numero_documento_identidad< V
,V W
NombreCliente 
= 
rop  #
.# $
Actor_negocio1$ 2
.2 3
Actor3 8
.8 9
primer_nombre9 F
.F G
ReplaceG N
(N O
$strO R
,R S
$strT W
)W X
,X Y
Comprobante 
= 
rop !
.! "
Comprobante" -
.- .
numero_serie. :
+; <
$str= @
+A B
ropC F
.F G
ComprobanteG R
.R S
numeroS Y
,Y Z
Alias 
= 
rop 
. !
Parametro_transaccion 2
.2 3
FirstOrDefault3 A
(A B
ppB D
=>E G
ppH J
.J K
id_parametroK W
==W Y
MaestroSettingsY h
.h i
Defaulti p
.p q2
%IdDetalleMaestroParametroAliasCliente	q ñ
)
ñ ó
!=
ò ö
null
õ ü
?
† °
rop
¢ •
.
• ¶#
Parametro_transaccion
¶ ª
.
ª º
FirstOrDefault
º  
(
  À
pcn
À Œ
=>
œ —
pcn
“ ’
.
’ ÷
id_parametro
÷ ‚
==
„ Â
MaestroSettings
Ê ı
.
ı ˆ
Default
ˆ ˝
.
˝ ˛3
%IdDetalleMaestroParametroAliasCliente
˛ £
)
£ §
.
§ •
valor
• ™
:
´ ¨
null
≠ ±
,
± ≤
Estado 
= 
rop 
. 
Detalle_maestro ,
., -
nombre- 3
,3 4
Vendedor 
= 
rop 
. 
Actor_negocio ,
., -
Actor- 2
.2 3
primer_nombre3 @
.@ A
ReplaceA H
(H I
$strI L
,L M
$strN Q
)Q R
,R S
FechaInicio 
= 
rop !
.! "
fecha_inicio" .
,. /
Id 
= 
rop 
. 
id 
, 
TipoComprobante 
=  !
rop" %
.% &
Comprobante& 1
.1 2
Detalle_maestro2 A
.A B
valorB G
,G H
IdEstado 
= 
( 
int 
)  
rop  #
.# $
id_estado_actual$ 4
,4 5
Total   
=   
rop   
.   
importe_total   '
.  ' (
ToString  ( 0
(  0 1
)  1 2
,  2 3
}!! 
)!! 
.!! 
OrderByDescending!!  
(!!  !
lp!!! #
=>!!# %
lp!!% '
.!!' (
FechaInicio!!( 3
)!!3 4
;!!4 5
return## 
resumen## 
;## 
}$$ 	
public&& 
Transaccion&&  
ObtenerOrdenDePedido&& /
(&&/ 0
int&&0 3
idOrdenPedido&&4 A
)&&A B
{'' 	
try(( 
{)) 
return** 
_db** 
.** 
Transaccion** &
.**& '
Include++ 
(++ 
sbt++ 
=>++  "
sbt++# &
.++& '
Detalle_transaccion++' :
)++: ;
.++; <
Include,, 
(,, 
sbt,, 
=>,,  "
sbt,,# &
.,,& '
Comprobante,,' 2
),,2 3
.,,3 4
Include-- 
(-- 
sbt-- 
=>--  "
sbt--# &
.--& '
Comprobante--' 2
.--2 3
Detalle_maestro--3 B
)--B C
.--C D
Include.. 
(.. 
sbt.. 
=>..  "
sbt..# &
...& '!
Parametro_transaccion..' <
)..< =
...= >
Include// 
(// 
sbt// 
=>//  "
sbt//# &
.//& '
Actor_negocio//' 4
)//4 5
.//5 6
Include00 
(00 
sbt00 
=>00  "
sbt00# &
.00& '
Actor_negocio100' 5
)005 6
.006 7
Include11 
(11 
sbt11 
=>11  "
sbt11# &
.11& '
Actor_negocio211' 5
)115 6
.116 7
SingleOrDefault22 #
(22# $
t22$ %
=>22& (
t22) *
.22* +
id22+ -
==22. 0
idOrdenPedido221 >
)22> ?
;22? @
}33 
catch44 
(44 
	Exception44 
ex44 
)44  
{55 
throw66 
new66 
DatosException66 (
(66( )
$str66) B
,66B C
ex66D F
)66F G
;66G H
}77 
}88 	
public99 
Transaccion99 
ObtenerTransaccion99 -
(99- .
long99. 2
id993 5
)995 6
{:: 	
try;; 
{<< 
return== 
_db== 
.== 
Transaccion== &
.==& '
SingleOrDefault==' 6
(==6 7
st==7 9
=>==: <
st=== ?
.==? @
id==@ B
====C E
id==F H
)==H I
;==I J
}>> 
catch?? 
(?? 
	Exception?? 
e?? 
)?? 
{@@ 
throwAA 
eAA 
;AA 
}BB 
}CC 	
publicGG 
IEnumerableGG 
<GG 
PedidosInvalidadosGG -
>GG- .-
!ObtenerOrdenesDePedidoInvalidadosGG/ P
(GGP Q
DateTimeGGQ Y

fechaDesdeGGZ d
,GGd e
DateTimeGGf n

fechaHastaGGo y
,GGy z
intGG{ ~
[GG~ 
]	GG Ä
idsPuntosVenta
GGÅ è
)
GGè ê
{HH 	
varII 
resumenII 
=II 
_dbII 
.II 
TransaccionII )
.II) *
WhereII* /
(II/ 0
tII0 1
=>II2 4
tII5 6
.II6 7
fecha_inicioII7 C
>=IID F

fechaDesdeIIG Q
&&IIR T
tIIU V
.IIV W
fecha_inicioIIW c
<=IId f

fechaHastaIIg q
&&IIr t
tIIu v
.IIv w 
id_tipo_transaccion	IIw ä
==
IIã ç
PedidoSettings
IIé ú
.
IIú ù
Default
IIù §
.
II§ •*
IdTipoTransaccionOrdenPedido
II• ¡
&&
II¬ ƒ
t
II≈ ∆
.
II∆ «
id_estado_actual
II« ◊
==
II◊ Ÿ
MaestroSettings
IIŸ Ë
.
IIË È
Default
IIÈ 
.
II Ò.
 IdDetalleMaestroEstadoInvalidado
IIÒ ë
&&
IIí î
idsPuntosVenta
IIï £
.
II£ §
Contains
II§ ¨
(
II¨ ≠
t
II≠ Æ
.
IIÆ Ø&
id_actor_negocio_interno
IIØ «
)
II« »
)
II» …
.
II…  
Select
II  –
(
II– —
rop
II— ‘
=>
II’ ◊
new
IIÿ € 
PedidosInvalidados
II‹ Ó
(
IIÓ Ô
)
IIÔ 
{JJ 
DocumentoClienteKK  
=KK! "
ropKK# &
.KK& '
Actor_negocio1KK' 5
.KK5 6
ActorKK6 ;
.KK; <&
numero_documento_identidadKK< V
,KKV W
NombreClienteLL 
=LL 
ropLL  #
.LL# $
Actor_negocio1LL$ 2
.LL2 3
ActorLL3 8
.LL8 9
primer_nombreLL9 F
.LLF G
ReplaceLLG N
(LLN O
$strLLO R
,LLR S
$strLLT W
)LLW X
,LLX Y
ComprobanteMM 
=MM 
ropMM !
.MM! "
ComprobanteMM" -
.MM- .
numero_serieMM. :
+MM; <
$strMM= @
+MMA B
ropMMC F
.MMF G
ComprobanteMMG R
.MMR S
numeroMMS Y
,MMY Z
AliasNN 
=NN 
ropNN 
.NN !
Parametro_transaccionNN 1
.NN1 2
FirstOrDefaultNN2 @
(NN@ A
ppNNA C
=>NND F
ppNNG I
.NNI J
id_parametroNNJ V
==NNW Y
MaestroSettingsNNZ i
.NNi j
DefaultNNj q
.NNq r2
%IdDetalleMaestroParametroAliasCliente	NNr ó
)
NNó ò
!=
NNô õ
null
NNú †
?
NN° ¢
rop
NN£ ¶
.
NN¶ ß#
Parametro_transaccion
NNß º
.
NNº Ω
FirstOrDefault
NNΩ À
(
NNÀ Ã
pcn
NNÃ œ
=>
NN– “
pcn
NN” ÷
.
NN÷ ◊
id_parametro
NN◊ „
==
NN‰ Ê
MaestroSettings
NNÁ ˆ
.
NNˆ ˜
Default
NN˜ ˛
.
NN˛ ˇ3
%IdDetalleMaestroParametroAliasCliente
NNˇ §
)
NN§ •
.
NN• ¶
valor
NN¶ ´
:
NN¨ ≠
null
NNÆ ≤
,
NN≤ ≥
VendedorOO 
=OO 
ropOO 
.OO 
Actor_negocioOO ,
.OO, -
ActorOO- 2
.OO2 3
primer_nombreOO3 @
.OO@ A
ReplaceOOA H
(OOH I
$strOOI L
,OOL M
$strOON Q
)OOQ R
,OOR S
FechaEmisionPP 
=PP 
ropPP "
.PP" #
fecha_inicioPP# /
,PP/ 0
IdQQ 
=QQ 
ropQQ 
.QQ 
idQQ 
,QQ 
IdEstadoRR 
=RR 
(RR 
intRR 
)RR  
ropRR  #
.RR# $
id_estado_actualRR$ 4
,RR4 5
FechaInvalidacionSS !
=SS" #
ropSS$ '
.SS' (
Estado_transaccionSS( :
.SS: ;
FirstOrDefaultSS; I
(SSI J
etSSJ L
=>SSL N
etSSN P
.SSP Q
	id_estadoSSQ Z
==SSZ \
MaestroSettingsSS\ k
.SSk l
DefaultSSl s
.SSs t-
 IdDetalleMaestroEstadoInvalidado	SSt î
)
SSî ï
.
SSï ñ
fecha
SSñ õ
,
SSõ ú
ObservacionTT 
=TT 
ropTT !
.TT! "
Estado_transaccionTT" 4
.TT4 5
FirstOrDefaultTT5 C
(TTC D
etTTD F
=>TTF H
etTTH J
.TTJ K
	id_estadoTTK T
==TTT V
MaestroSettingsTTV e
.TTe f
DefaultTTf m
.TTm n-
 IdDetalleMaestroEstadoInvalidado	TTn é
)
TTé è
.
TTè ê

comentario
TTê ö
,
TTö õ
TotalUU 
=UU 
ropUU 
.UU 
importe_totalUU )
,UU) *
}VV 
)VV 
.VV 
OrderByVV 
(VV 
lpVV 
=>VV 
lpVV 
.VV  
FechaInvalidacionVV  1
)VV1 2
;VV2 3
returnXX 
resumenXX 
;XX 
}YY 	
}ZZ 
}[[ å
RD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\Restaurant\Mesa_Datos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
." #

Restaurant# -
{ 
public 

partial 
class 

Mesa_Datos #
:$ %
IMesa_Repositorio& 7
{ 
public 
Actor_negocio 
ObtenerMesa (
(( )
int) ,
id- /
)/ 0
{ 	
try 
{ 
SigescomEntities  
_db! $
=% &
new' *
SigescomEntities+ ;
(; <
)< =
;= >
return 
_db 
. 
Actor_negocio (
.( )
FirstOrDefault) 7
(7 8
an8 :
=>; =
an> @
.@ A
idA C
==D F
idG I
)I J
;J K
} 
catch 
( 
	Exception 
e 
) 
{ 
throw 
new 
DatosException (
(( )
$str) A
,A B
eC D
)D E
;E F
}   
}!! 	
public"" 
int"" $
ObtenerIdEstablecimiento"" +
(""+ ,
int"", /
idMesa""0 6
)""6 7
{## 	
try$$ 
{%% 
SigescomEntities&&  
_db&&! $
=&&% &
new&&' *
SigescomEntities&&+ ;
(&&; <
)&&< =
;&&= >
return'' 
_db'' 
.'' 
Actor_negocio'' (
.''( )
Where'') .
(''. /
an''/ 1
=>''2 4
an''5 7
.''7 8
id''8 :
=='': <
idMesa''< B
)''B C
.''C D
Select''D J
(''J K
an''K M
=>''M O
an''P R
.''R S
Actor_negocio2''S a
.''a b
Actor_negocio2''b p
.''p q
id''q s
)''s t
.''t u
FirstOrDefault	''u É
(
''É Ñ
)
''Ñ Ö
;
''Ö Ü
}(( 
catch)) 
()) 
	Exception)) 
e)) 
))) 
{** 
throw++ 
new++ 
DatosException++ (
(++( )
$str++) R
,++R S
e++T U
)++U V
;++V W
},, 
}-- 	
}// 
}00 ¥
VD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\Restaurant\Ambiente_Datos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
." #

Restaurant# -
{ 
public 

partial 
class 
Ambiente_Datos '
:( )!
IAmbiente_Repositorio* ?
{ 
} 
} Öæ
VD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\Restaurant\Atencion_Datos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
." #

Restaurant# -
{ 
public 

partial 
class 
Atencion_Datos '
:( )!
IAtencion_Repositorio* ?
{ 
public 
OperationResult 
GuardarCambioDeMesa 2
(2 3
AtencionRestaurante3 F
atencionG O
,O P
MesaQ U
	nuevaMesaV _
)_ `
{ 	
try 
{ 
SigescomEntities  
_db! $
=% &
new' *
SigescomEntities+ ;
(; <
)< =
;= >
var 

atencionDb 
=  
_db! $
.$ %
Transaccion% 0
.0 1
FirstOrDefault1 ?
(? @
t@ A
=>B D
tE F
.F G
idG I
==J L
atencionM U
.U V
IdV X
)X Y
;Y Z

atencionDb 
. %
id_actor_negocio_interno1 4
=5 6
	nuevaMesa7 @
.@ A
IdA C
;C D
var 
mesaAnteriorDb "
=# $
_db% (
.( )
Actor_negocio) 6
.6 7
FirstOrDefault7 E
(E F
anF H
=>I K
anL N
.N O
idO Q
==R T
atencionU ]
.] ^
Mesa^ b
.b c
Idc e
)e f
;f g
mesaAnteriorDb 
. 

indicador1 )
=* +
false, 1
;1 2
var   
mesaNuevaDb   
=    !
_db  " %
.  % &
Actor_negocio  & 3
.  3 4
FirstOrDefault  4 B
(  B C
an  C E
=>  F H
an  I K
.  K L
id  L N
==  O Q
	nuevaMesa  R [
.  [ \
Id  \ ^
)  ^ _
;  _ `
mesaNuevaDb!! 
.!! 

indicador1!! &
=!!' (
true!!) -
;!!- .
_db## 
.## 
SaveChanges## 
(##  
)##  !
;##! "
return$$ 
new$$ 
OperationResult$$ *
($$* +
OperationResultEnum$$+ >
.$$> ?
Success$$? F
)$$F G
;$$G H
}%% 
catch&& 
(&& 
	Exception&& 
e&& 
)&& 
{'' 
throw(( 
new(( 
DatosException(( (
(((( )
$str(() Q
,((Q R
e((S T
)((T U
;((U V
})) 
}** 	
public,, 
AtencionRestaurante,, "(
ObtenerAtencionDeMesaOcupada,,# ?
(,,? @
int,,@ C
idMesa,,D J
),,J K
{-- 	
try.. 
{// 
SigescomEntities00  
_db00! $
=00% &
new00' *
SigescomEntities00+ ;
(00; <
)00< =
;00= >
var11  
tipoTransaccionOrden11 (
=11) *
RestauranteSettings11+ >
.11> ?
Default11? F
.11F G/
#IdTipoTransaccionOrdenDeRestaurante11G j
;11j k
AtencionRestaurante22 #
atencion22$ ,
=22- .
_db22/ 2
.222 3
Transaccion223 >
.33 
Where33 
(33 
t33 
=>33 
t33  !
.33! "%
id_actor_negocio_interno133" ;
==33< >
idMesa33? E
&&33F H
(33I J
!33J K
t33K L
.33L M
Evento_transaccion33M _
.33_ `
Select33` f
(33f g
tt33g i
=>33j l
tt33m o
.33o p
	id_evento33p y
)33y z
.33z {
Contains	33{ É
(
33É Ñ
MaestroSettings
33Ñ ì
.
33ì î
Default
33î õ
.
33õ ú-
IdDetalleMaestroEstadoFacturado
33ú ª
)
33ª º
&&
33Ω ø
!
33¿ ¡
(
33¡ ¬
t
33¬ √
.
33√ ƒ
id_estado_actual
33ƒ ‘
==
33’ ◊
MaestroSettings
33ÿ Á
.
33Á Ë
Default
33Ë Ô
.
33Ô +
IdDetalleMaestroEstadoCerrado
33 ç
&&
33é ê
t
33ë í
.
33í ì
importe_total
33ì †
==
33° £
$num
33§ •
)
33• ¶
)
33¶ ß
)
33ß ®
.
33® ©
Select
33© Ø
(
33Ø ∞
transaccion
33∞ ª
=>
33º æ
new
33ø ¬!
AtencionRestaurante
33√ ÷
(
33÷ ◊
)
33◊ ÿ
{44 
Id55 
=55 
transaccion55 (
.55( )
id55) +
,55+ ,
ImporteAtencion66 '
=66( )
transaccion66* 5
.665 6
importe_total666 C
,66C D
Mesa77 
=77 
new77 "
Mesa77# '
(77' (
)77( )
{88 
Id99 
=99  
(99! "
int99" %
)99% &
transaccion99& 1
.991 2%
id_actor_negocio_interno1992 K
,99K L

IdAmbiente:: &
=::' (
(::) *
int::* -
)::- .
transaccion::. 9
.::9 :
Actor_negocio4::: H
.::H I"
id_actor_negocio_padre::I _
,::_ `
JsonData;; $
=;;% &
transaccion;;' 2
.;;2 3
Actor_negocio4;;3 A
.;;A B
extension_json;;B P
}<< 
,<< 

TipoDePago== "
===# $
transaccion==% 0
.==0 1
enum1==1 6
,==6 7
Ordenes>> 
=>>  !
transaccion>>" -
.>>- .
Transaccion1>>. :
.>>: ;
Where>>; @
(>>@ A
to>>A C
=>>>D F
to>>G I
.>>I J
id_tipo_transaccion>>J ]
==>>^ ` 
tipoTransaccionOrden>>a u
)>>u v
.>>v w
Select>>w }
(>>} ~
to	>>~ Ä
=>
>>Å É
new
>>Ñ á
Orden_Atencion
>>à ñ
(
>>ñ ó
)
>>ó ò
{?? 
Id@@ 
=@@  
to@@! #
.@@# $
id@@$ &
,@@& '
CodigoAA "
=AA# $
toAA% '
.AA' (
codigoAA( .
,AA. /
EstadoBB "
=BB# $
(BB% &
intBB& )
)BB) *
toBB* ,
.BB, -
id_estado_actualBB- =
,BB= >

IdAtencionCC &
=CC' (
(CC) *
longCC* .
)CC. /
toCC/ 1
.CC1 2 
id_transaccion_padreCC2 F
,CCF G
ImporteOrdenDD (
=DD) *
toDD+ -
.DD- .
importe_totalDD. ;
,DD; <
IdMesaEE "
=EE# $
(EE% &
intEE& )
)EE) *
transaccionEE* 5
.EE5 6%
id_actor_negocio_interno1EE6 O
,EEO P
MozoFF  
=FF! "
newFF# &
ItemGenericoFF' 3
(FF3 4
)FF4 5
{GG 
IdHH  "
=HH# $
toHH% '
.HH' ($
id_actor_negocio_internoHH( @
,HH@ A
NombreII  &
=II' (
toII) +
.II+ ,
Actor_negocio2II, :
.II: ;
ActorII; @
.II@ A
tercer_nombreIIA N
,IIN O
}JJ 
,JJ 
FechaHoraRegistroKK -
=KK. /
toKK0 2
.KK2 3
fecha_inicioKK3 ?
,KK? @
DetallesDeOrdenLL +
=LL, -
toLL. 0
.LL0 1
Detalle_transaccionLL1 D
.LLD E
SelectLLE K
(LLK L
dtLLL N
=>LLO Q
newLLR U
DetalleOrdenLLV b
(LLb c
)LLc d
{MM 
IdNN  "
=NN# $
dtNN% '
.NN' (
idNN( *
,NN* +
PrecioOO  &
=OO' (
dtOO) +
.OO+ ,
precio_unitarioOO, ;
,OO; <
CantidadPP  (
=PP) *
dtPP+ -
.PP- .
cantidadPP. 6
,PP6 7
ImporteQQ  '
=QQ( )
dtQQ* ,
.QQ, -
totalQQ- 2
,QQ2 3
EstadoRR  &
=RR' (
(RR) *
intRR* -
)RR- .
dtRR. 0
.RR0 1#
indicadorMultipropositoRR1 H
,RRH I
EsBienSS  &
=SS' (
dtSS) +
.SS+ ,
Concepto_negocioSS, <
.SS< =
Detalle_maestro4SS= M
.SSM N
valorSSN S
==SST V
$strSSW Z
,SSZ [&
DetalleItemRestauranteJsonTT  :
=TT; <
dtTT= ?
.TT? @
detalleTT@ G
,TTG H

NombreItemUU  *
=UU+ ,
dtUU- /
.UU/ 0
Concepto_negocioUU0 @
.UU@ A
nombreUUA G
,UUG H
IdItemVV  &
=VV' (
dtVV) +
.VV+ ,
id_concepto_negocioVV, ?
,VV? @
IdTransaccionWW  -
=WW. /
dtWW0 2
.WW2 3
id_transaccionWW3 A
}XX 
)XX 
}YY 
)YY 
,YY 
EstadoZZ 
=ZZ  
(ZZ! "
intZZ" %
)ZZ% &
transaccionZZ& 1
.ZZ1 2
id_estado_actualZZ2 B
,ZZB C
EsAtencionConMesa[[ )
=[[* +
![[, -
transaccion[[- 8
.[[8 9

indicador1[[9 C
,[[D E!
EsAtencionPorDelivery\\ -
=\\. /
transaccion\\0 ;
.\\; <

indicador2\\< F
}]] 
)]] 
.]] 
FirstOrDefault]] %
(]]% &
)]]& '
;]]' (
	Data_Mesa__ 
dataMesa__ "
=__# $
JsonConvert__% 0
.__0 1
DeserializeObject__1 B
<__B C
	Data_Mesa__C L
>__L M
(__M N
atencion__N V
.__V W
Mesa__W [
.__[ \
JsonData__\ d
)__d e
;__e f
atencion`` 
.`` 
Mesa`` 
.`` 
Nombre`` $
=``% &
dataMesa``' /
.``/ 0
nombre``0 6
;``6 7
atencionaa 
.aa 
Ordenesaa  
.aa  !
ToListaa! '
(aa' (
)aa( )
.aa) *
ForEachaa* 1
(aa1 2
oaa2 3
=>aa4 6
oaa7 8
.aa8 9

NombreMesaaa9 C
=aaD E
dataMesaaaF N
.aaN O
nombreaaO U
)aaU V
;aaV W
returnbb 
atencionbb 
;bb  
}cc 
catchdd 
(dd 
	Exceptiondd 
edd 
)dd 
{ee 
throwff 
newff 
DatosExceptionff (
(ff( )
$strff) M
,ffM N
effO P
)ffP Q
;ffQ R
}gg 
}hh 	
privatejj 
voidjj )
AgregarEstadoCerradoAAtencionjj 2
(jj2 3
SigescomEntitiesjj3 C
_dbjjD G
,jjG H
longjjI M
idAtencionACerrarjjN _
,jj_ `
intjja d

idEmpleadojje o
,jjo p
stringjjq w

comentario	jjx Ç
)
jjÇ É
{kk 	
Estado_transaccionll !
estadoCerradoAtencionll 4
=ll5 6
newll7 :
Estado_transaccionll; M
(llM N
)llN O
{mm 
id_transaccionnn 
=nn  
idAtencionACerrarnn! 2
,nn2 3
	id_estadooo 
=oo 
MaestroSettingsoo +
.oo+ ,
Defaultoo, 3
.oo3 4)
IdDetalleMaestroEstadoCerradooo4 Q
,ooQ R
fechapp 
=pp 
DateTimeUtilpp $
.pp$ %
FechaActualpp% 0
(pp0 1
)pp1 2
,pp2 3
id_empleadoqq 
=qq 

idEmpleadoqq (
,qq( )

comentariorr 
=rr 

comentariorr '
}ss 
;ss 
_dbtt 
.tt 
Estado_transacciontt "
.tt" #
Addtt# &
(tt& '!
estadoCerradoAtenciontt' <
)tt< =
;tt= >
}uu 	
privateww 
voidww (
AgregarEstadoCerradoAOrdenesww 1
(ww1 2
SigescomEntitiesww2 B
_dbwwC F
,wwF G
longwwH L
[wwL M
]wwM N
idOrdenesACerrarwwO _
,ww_ `
intwwa d

idEmpleadowwe o
,wwo p
stringwwq w

comentario	wwx Ç
)
wwÇ É
{xx 	
foreachyy 
(yy 
varyy 
idOrdenyy  
inyy! #
idOrdenesACerraryy$ 4
)yy4 5
{zz 
Estado_transaccion{{ "
estadoCerradoOrden{{# 5
={{6 7
new{{8 ;
Estado_transaccion{{< N
({{N O
){{O P
{|| 
id_transaccion}} "
=}}# $
idOrden}}% ,
,}}, -
	id_estado~~ 
=~~ 
MaestroSettings~~  /
.~~/ 0
Default~~0 7
.~~7 8)
IdDetalleMaestroEstadoCerrado~~8 U
,~~U V
fecha 
= 
DateTimeUtil (
.( )
FechaActual) 4
(4 5
)5 6
,6 7
id_empleado
ÄÄ 
=
ÄÄ  !

idEmpleado
ÄÄ" ,
,
ÄÄ, -

comentario
ÅÅ 
=
ÅÅ  

comentario
ÅÅ! +
}
ÇÇ 
;
ÇÇ 
_db
ÉÉ 
.
ÉÉ  
Estado_transaccion
ÉÉ &
.
ÉÉ& '
Add
ÉÉ' *
(
ÉÉ* + 
estadoCerradoOrden
ÉÉ+ =
)
ÉÉ= >
;
ÉÉ> ?
}
ÑÑ 
}
ÖÖ 	
private
ÜÜ 
void
ÜÜ $
AtenderDetallesDeOrden
ÜÜ +
(
ÜÜ+ ,
SigescomEntities
ÜÜ, <
_db
ÜÜ= @
,
ÜÜ@ A
long
ÜÜB F
[
ÜÜF G
]
ÜÜG H 
idDetallesAAtender
ÜÜI [
)
ÜÜ[ \
{
áá 	
var
àà 
detalles
àà 
=
àà 
_db
àà 
.
àà !
Detalle_transaccion
àà 2
.
àà2 3
Where
àà3 8
(
àà8 9
dt
àà9 ;
=>
àà< > 
idDetallesAAtender
àà? Q
.
ààQ R
Contains
ààR Z
(
ààZ [
dt
àà[ ]
.
àà] ^
id
àà^ `
)
àà` a
)
ààa b
.
ààb c
ToList
ààc i
(
àài j
)
ààj k
;
ààk l
detalles
ää 
.
ää 
ForEach
ää 
(
ää 
d
ää 
=>
ää !
d
ää" #
.
ää# $%
indicadorMultiproposito
ää$ ;
=
ää< =
(
ää> ?
int
ää? B
)
ääB C$
EstadoDeDetalleDeOrden
ääC Y
.
ääY Z
Atendido
ääZ b
)
ääb c
;
ääc d
foreach
ãã 
(
ãã 
var
ãã 
detalle
ãã  
in
ãã! #
detalles
ãã$ ,
)
ãã, -
{
åå 
detalle
çç 
.
çç %
indicadorMultiproposito
çç /
=
çç0 1
(
çç2 3
int
çç3 6
)
çç6 7$
EstadoDeDetalleDeOrden
çç7 M
.
ççM N
Atendido
ççN V
;
ççV W
_db
éé 
.
éé 
Entry
éé 
(
éé 
detalle
éé !
)
éé! "
.
éé" #
State
éé# (
=
éé) *
EntityState
éé+ 6
.
éé6 7
Modified
éé7 ?
;
éé? @
}
èè 
}
êê 	
private
ëë 
void
ëë 
LiberarMesa
ëë  
(
ëë  !
SigescomEntities
ëë! 1
_db
ëë2 5
,
ëë5 6
int
ëë7 :
idMesa
ëë; A
)
ëëA B
{
íí 	
var
ìì 
mesa
ìì 
=
ìì 
_db
ìì 
.
ìì 
Actor_negocio
ìì (
.
ìì( )
FirstOrDefault
ìì) 7
(
ìì7 8
an
ìì8 :
=>
ìì; =
an
ìì> @
.
ìì@ A
id
ììA C
==
ììD F
idMesa
ììG M
)
ììM N
;
ììN O
mesa
îî 
.
îî 

indicador1
îî 
=
îî 
false
îî #
;
îî# $
_db
ïï 
.
ïï 
Entry
ïï 
(
ïï 
mesa
ïï 
)
ïï 
.
ïï 
State
ïï !
=
ïï" #
EntityState
ïï$ /
.
ïï/ 0
Modified
ïï0 8
;
ïï8 9
}
óó 	
public
òò 
OperationResult
òò 4
&CerrarAtencionYOrdenesYAtenderDetalles
òò E
(
òòE F
long
òòF J
idAtencionACerrar
òòK \
,
òò\ ]
long
òò^ b
[
òòb c
]
òòc d
idsOrdenesACerrar
òòe v
,
òòv w
long
òòx |
[
òò| }
]
òò} ~"
idsDetallesAAtenderòò í
,òòí ì
intòòî ó
idMesaòòò û
,òòû ü
boolòò† §
liberarMesaòò• ∞
,òò∞ ±
intòò≤ µ

idEmpleadoòò∂ ¿
)òò¿ ¡
{
ôô 	
try
öö 
{
õõ 
SigescomEntities
úú  
_db
úú! $
=
úú% &
new
úú' *
SigescomEntities
úú+ ;
(
úú; <
)
úú< =
;
úú= >+
AgregarEstadoCerradoAAtencion
ùù -
(
ùù- .
_db
ùù. 1
,
ùù1 2
idAtencionACerrar
ùù3 D
,
ùùD E

idEmpleado
ùùF P
,
ùùP Q
$str
ùùR m
)
ùùm n
;
ùùn o*
AgregarEstadoCerradoAOrdenes
ûû ,
(
ûû, -
_db
ûû- 0
,
ûû0 1
idsOrdenesACerrar
ûû2 C
,
ûûC D

idEmpleado
ûûE O
,
ûûO P
$strûûQ Ö
)ûûÖ Ü
;ûûÜ á$
AtenderDetallesDeOrden
üü &
(
üü& '
_db
üü' *
,
üü* +!
idsDetallesAAtender
üü, ?
)
üü? @
;
üü@ A
if
†† 
(
†† 
liberarMesa
†† 
)
††  
{
°° 
LiberarMesa
¢¢ 
(
¢¢  
_db
¢¢  #
,
¢¢# $
idMesa
¢¢% +
)
¢¢+ ,
;
¢¢, -
}
££ 
_db
•• 
.
•• 
SaveChanges
•• 
(
••  
)
••  !
;
••! "
return
¶¶ 
new
¶¶ 
OperationResult
¶¶ *
(
¶¶* +!
OperationResultEnum
¶¶+ >
.
¶¶> ?
Success
¶¶? F
)
¶¶F G
;
¶¶G H
}
ßß 
catch
®® 
(
®® 
	Exception
®® 
e
®® 
)
®® 
{
©© 
throw
™™ 
new
™™ 
DatosException
™™ (
(
™™( )
$str
™™) M
,
™™M N
e
™™O P
)
™™P Q
;
™™Q R
}
´´ 
}
¨¨ 	
public
ÆÆ !
AtencionRestaurante
ÆÆ "L
>ObtenerAtencionConDatosMinimosDeOrdenYDetallesSoloParaCerrarla
ÆÆ# a
(
ÆÆa b
long
ÆÆb f

idAtencion
ÆÆg q
)
ÆÆq r
{
ØØ 	
try
∞∞ 
{
±± 
SigescomEntities
≤≤  
_db
≤≤! $
=
≤≤% &
new
≤≤' *
SigescomEntities
≤≤+ ;
(
≤≤; <
)
≤≤< =
;
≤≤= >
var
≥≥ "
tipoTransaccionOrden
≥≥ (
=
≥≥) *!
RestauranteSettings
≥≥+ >
.
≥≥> ?
Default
≥≥? F
.
≥≥F G1
#IdTipoTransaccionOrdenDeRestaurante
≥≥G j
;
≥≥j k!
AtencionRestaurante
¥¥ #
atencion
¥¥$ ,
=
¥¥- .
_db
¥¥/ 2
.
¥¥2 3
Transaccion
¥¥3 >
.
µµ 
Where
µµ 
(
µµ 
t
µµ 
=>
µµ 
t
µµ  !
.
µµ! "
id
µµ" $
==
µµ% '

idAtencion
µµ( 2
)
µµ2 3
.
µµ3 4
Select
µµ4 :
(
µµ: ;
transaccion
µµ; F
=>
µµG I
new
µµJ M!
AtencionRestaurante
µµN a
(
µµa b
)
µµb c
{
∂∂ 
Id
∑∑ 
=
∑∑ 
transaccion
∑∑ (
.
∑∑( )
id
∑∑) +
,
∑∑+ ,
ImporteAtencion
∏∏ '
=
∏∏( )
transaccion
∏∏* 5
.
∏∏5 6
importe_total
∏∏6 C
,
∏∏C D

TipoDePago
ππ "
=
ππ# $
transaccion
ππ% 0
.
ππ0 1
enum1
ππ1 6
,
ππ6 7
Mesa
∫∫ 
=
∫∫ 
new
∫∫ "
Mesa
∫∫# '
(
∫∫' (
)
∫∫( )
{
ªª 
Id
ºº 
=
ºº  
(
ºº! "
int
ºº" %
)
ºº% &
transaccion
ºº& 1
.
ºº1 2'
id_actor_negocio_interno1
ºº2 K
}
ΩΩ 
,
ΩΩ 
Ordenes
ææ 
=
ææ  !
transaccion
ææ" -
.
ææ- .
Transaccion1
ææ. :
.
ææ: ;
Where
ææ; @
(
ææ@ A
to
ææA C
=>
ææD F
to
ææG I
.
ææI J!
id_tipo_transaccion
ææJ ]
==
ææ^ `"
tipoTransaccionOrden
ææa u
)
ææu v
.
ææv w
Select
ææw }
(
ææ} ~
toææ~ Ä
=>ææÅ É
newææÑ á
Orden_Atencionææà ñ
(ææñ ó
)ææó ò
{
øø 
Id
¿¿ 
=
¿¿  
to
¿¿! #
.
¿¿# $
id
¿¿$ &
,
¿¿& '
Estado
¡¡ "
=
¡¡# $
(
¡¡% &
int
¡¡& )
)
¡¡) *
to
¡¡* ,
.
¡¡, -
id_estado_actual
¡¡- =
,
¡¡= >
ImporteOrden
¬¬ (
=
¬¬) *
to
¬¬+ -
.
¬¬- .
importe_total
¬¬. ;
,
¬¬; <
DetallesDeOrden
√√ +
=
√√, -
to
√√. 0
.
√√0 1!
Detalle_transaccion
√√1 D
.
√√D E
Select
√√E K
(
√√K L
dt
√√L N
=>
√√O Q
new
√√R U
DetalleOrden
√√V b
(
√√b c
)
√√c d
{
ƒƒ 
Id
≈≈  "
=
≈≈# $
dt
≈≈% '
.
≈≈' (
id
≈≈( *
,
≈≈* +
Estado
∆∆  &
=
∆∆' (
(
∆∆) *
int
∆∆* -
)
∆∆- .
dt
∆∆. 0
.
∆∆0 1%
indicadorMultiproposito
∆∆1 H
,
∆∆H I
}
«« 
)
«« 
}
»» 
)
»» 
,
»» 
Estado
…… 
=
……  
(
……! "
int
……" %
)
……% &
transaccion
……& 1
.
……1 2
id_estado_actual
……2 B
,
……B C
EsAtencionConMesa
   )
=
  * +
!
  , -
transaccion
  - 8
.
  8 9

indicador1
  9 C
,
  C D#
EsAtencionPorDelivery
ÀÀ -
=
ÀÀ. /
transaccion
ÀÀ0 ;
.
ÀÀ; <

indicador2
ÀÀ< F
,
ÀÀF G

Confirmado
ÃÃ "
=
ÃÃ# $
transaccion
ÃÃ% 0
.
ÃÃ0 1 
Evento_transaccion
ÃÃ1 C
.
ÃÃC D
Select
ÃÃD J
(
ÃÃJ K
ev
ÃÃK M
=>
ÃÃN P
ev
ÃÃQ S
.
ÃÃS T
	id_evento
ÃÃT ]
)
ÃÃ] ^
.
ÃÃ^ _
Contains
ÃÃ_ g
(
ÃÃg h
MaestroSettings
ÃÃh w
.
ÃÃw x
Default
ÃÃx 
.ÃÃ Ä0
 IdDetalleMaestroEstadoConfirmadoÃÃÄ †
)ÃÃ† °
}
ÕÕ 
)
ÕÕ 
.
ÕÕ 
FirstOrDefault
ÕÕ %
(
ÕÕ% &
)
ÕÕ& '
;
ÕÕ' (
return
ŒŒ 
atencion
ŒŒ 
;
ŒŒ  
}
œœ 
catch
–– 
(
–– 
	Exception
–– 
e
–– 
)
–– 
{
—— 
throw
““ 
new
““ 
DatosException
““ (
(
““( )
$str
““) M
,
““M N
e
““O P
)
““P Q
;
““Q R
}
”” 
}
‘‘ 	
}
’’ 
}÷÷ à
jD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\Transaccion\ConsultaDetallesTransaccion_Datos.cs
	namespace

 	
Tsp


 
.

 
Sigescom

 
.

 
AccesoDatos

 "
.

" #
Transacciones

# 0
{ 
public 

partial 
class -
!ConsultaDetallesTransaccion_Datos :
:; <3
'IConsultaDetalleTransaccion_Repositorio= d
{ 
public 
IEnumerable 
< 
Detalle_transaccion .
>. /%
ObtenerDetalleTransaccion0 I
(I J
intJ M!
idActorNegocioInternoN c
,c d
inte h
idTipoTransaccioni z
,z {
int| 
idUltimoEstado
Ä é
,
é è
int
ê ì
[
ì î
]
î ï
idsConceptos
ñ ¢
)
¢ £
{ 	
try 
{ 
SigescomEntities 
_db  
=! "
new# &
SigescomEntities' 7
(7 8
)8 9
;9 :
return 
_db 
. 
Detalle_transaccion .
. 
Where 
( 
dt 
=>  
dt! #
.# $
Transaccion$ /
./ 0$
id_actor_negocio_interno0 H
==I K!
idActorNegocioInternoL a
&& 
dt 
. 
Transaccion %
.% &
id_tipo_transaccion& 9
==: <
idTipoTransaccion= N
&& 
dt 
. 
Transaccion %
.% &
id_estado_actual& 6
==7 9
idUltimoEstado: H
&& 
idsConceptos #
.# $
Contains$ ,
(, -
dt- /
./ 0
id_concepto_negocio0 C
)C D
)D E
;E F
} 
catch 
( 
	Exception 
e 
) 
{ 
throw 
new 
DatosException (
(( )
$str) r
,r s
et u
)u v
;v w
} 
}   	
}"" 
}## ¡
jD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\Transaccion\EliminarDetallesTransaccion_Datos.cs
	namespace

 	
Tsp


 
.

 
Sigescom

 
.

 
AccesoDatos

 "
.

" #
Transacciones

# 0
{ 
public 

partial 
class -
!EliminarDetallesTransaccion_Datos :
:; <3
'IEliminarDetalleTransaccion_Repositorio= d
{ 
public 
OperationResult /
#EliminarDetallesDeTransaccionMasivo B
(B C
ListC G
<G H
Detalle_transaccionH [
>[ \!
detallesDeTransaccion] r
)r s
{ 	
try 
{ 
SigescomEntities  
_db! $
=% &
new' *
SigescomEntities+ ;
(; <
)< =
;= >
if 
( !
detallesDeTransaccion )
.) *
Count* /
>0 1
$num2 3
)3 4
{ 
List 
< 
string 
>  
comandosSQL! ,
=- .
new/ 2
List3 7
<7 8
string8 >
>> ?
(? @
)@ A
;A B
List 
< 
SqlParameter %
>% &
parametrosSql' 4
=5 6
new7 :
List; ?
<? @
SqlParameter@ L
>L M
(M N
)N O
;O P
foreach 
( 
var  
detalle! (
in) +!
detallesDeTransaccion, A
)A B
{ 
var 
comandoActual )
=* +
(, -
$str- U
+V W
detalleX _
._ `
id` b
+c d
$stre h
)h i
;i j
comandosSQL #
.# $
Add$ '
(' (
comandoActual( 5
)5 6
;6 7
}   
string!! 
comandoAEjecutar!! +
=!!, -
$str!!. 0
;!!0 1
foreach"" 
("" 
var""  
item""! %
in""& (
comandosSQL"") 4
)""4 5
{## 
comandoAEjecutar$$ (
+=$$) +
item$$, 0
;$$0 1
}%% 
var&& 
	resultado&& !
=&&" #
_db&&$ '
.&&' (
Database&&( 0
.&&0 1
ExecuteSqlCommand&&1 B
(&&B C
comandoAEjecutar&&C S
,&&S T
parametrosSql&&U b
.&&b c
ToArray&&c j
(&&j k
)&&k l
)&&l m
;&&m n
}'' 
var(( 
resultadoDetails(( $
=((% &
new((' *
OperationResult((+ :
(((: ;
OperationResultEnum((; N
.((N O
Success((O V
)((V W
;((W X
return)) 
resultadoDetails)) '
;))' (
}** 
catch++ 
(++ 
	Exception++ 
e++ 
)++ 
{,, 
throw-- 
new-- 
DatosException-- (
(--( )
$str--) U
,--U V
e--W X
)--X Y
;--Y Z
}.. 
}// 	
}11 
}22 ã$
gD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\Transaccion\CrearDetallesTransaccion_Datos.cs
	namespace

 	
Tsp


 
.

 
Sigescom

 
.

 
AccesoDatos

 "
.

" #
Transacciones

# 0
{ 
public 

partial 
class *
CrearDetallesTransaccion_Datos 7
:8 90
$ICrearDetalleTransaccion_Repositorio: ^
{ 
public 
OperationResult ,
 CrearDetallesDeTransaccionMasivo ?
(? @
List@ D
<D E
Detalle_transaccionE X
>X Y!
detallesDeTransaccionZ o
)o p
{ 	
try 
{ 
SigescomEntities  
_db! $
=% &
new' *
SigescomEntities+ ;
(; <
)< =
;= >
if 
( !
detallesDeTransaccion )
.) *
Count* /
>0 1
$num2 3
)3 4
{ 
List 
< 
string 
>  
comandosSQL! ,
=- .
new/ 2
List3 7
<7 8
string8 >
>> ?
(? @
)@ A
;A B
List 
< 
SqlParameter %
>% &
parametrosSql' 4
=5 6
new7 :
List; ?
<? @
SqlParameter@ L
>L M
(M N
)N O
;O P
foreach 
( 
var  
detalle! (
in) +!
detallesDeTransaccion, A
)A B
{ 
var 
comandoActual )
=* +
(, -
$str	- …
+
  À
detalle
Ã ”
.
” ‘
id_transaccion
‘ ‚
+
„ ‰
$str
Â Ë
+
È Í
detalle
Î Ú
.
Ú Û
cantidad
Û ˚
+
¸ ˝
$str
˛ Å
+
Ç É
detalle
Ñ ã
.
ã å!
id_concepto_negocio
å ü
+
† °
$str
¢ ¶
+
ß ®
detalle
© ∞
.
∞ ±
detalle
± ∏
.
∏ π
Replace
π ¿
(
¿ ¡
$str
¡ ƒ
,
ƒ ≈
$str
∆  
)
  À
+
Ã Õ
$str
Œ “
+
” ‘
detalle
’ ‹
.
‹ ›
precio_unitario
› Ï
+
Ì Ó
$str
Ô Ú
+
Û Ù
detalle
ı ¸
.
¸ ˝
total
˝ Ç
+
É Ñ
$str
Ö à
+
â ä
detalle
ã í
.
í ì!
cantidad_secundaria
ì ¶
+
ß ®
$str
© ¨
+
≠ Æ
detalle
Ø ∂
.
∂ ∑
isc
∑ ∫
+
ª º
$str
Ω ¿
+
¡ ¬
detalle
√  
.
  À
igv
À Œ
+
œ –
$str
— ‘
+
’ ÷
detalle
◊ ﬁ
.
ﬁ ﬂ
	descuento
ﬂ Ë
+
È Í
$str
Î Ô
)
Ô 
;
 Ò
comandosSQL #
.# $
Add$ '
(' (
comandoActual( 5
)5 6
;6 7
}   
string!! 
comandoAEjecutar!! +
=!!, -
$str!!. 0
;!!0 1
foreach"" 
("" 
var""  
item""! %
in""& (
comandosSQL"") 4
)""4 5
{## 
comandoAEjecutar$$ (
+=$$) +
item$$, 0
;$$0 1
}%% 
var&& 
	resultado&& !
=&&" #
_db&&$ '
.&&' (
Database&&( 0
.&&0 1
ExecuteSqlCommand&&1 B
(&&B C
comandoAEjecutar&&C S
,&&S T
parametrosSql&&U b
.&&b c
ToArray&&c j
(&&j k
)&&k l
)&&l m
;&&m n
}'' 
var(( 
resultadoDetails(( $
=((% &
new((' *
OperationResult((+ :
(((: ;
OperationResultEnum((; N
.((N O
Success((O V
)((V W
;((W X
return)) 
resultadoDetails)) '
;))' (
}** 
catch++ 
(++ 
	Exception++ 
e++ 
)++ 
{,, 
throw-- 
new-- 
DatosException-- (
(--( )
$str--) U
,--U V
e--W X
)--X Y
;--Y Z
}.. 
}// 	
}11 
}22 ≤
dD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\Transaccion\ActualizarTransaccion_Datos.cs
	namespace		 	
Tsp		
 
.		 
Sigescom		 
.		 
AccesoDatos		 "
.		" #
Transacciones		# 0
{ 
public 

partial 
class '
ActualizarTransaccion_Datos 4
:5 6.
"IActualizarTransaccion_Repositorio7 Y
{ 
public 
OperationResult #
ActualizarTransacciones 6
(6 7
List7 ;
<; <
Transaccion< G
>G H
transaccionesI V
)V W
{ 	
SigescomEntities 
_db  
=! "
new# &
SigescomEntities' 7
(7 8
)8 9
;9 :
try 
{ 
foreach 
( 
var  
transaccion! ,
in- /
transacciones0 =
)= >
{ 
Transaccion #
dbTransaccion1$ 2
=3 4
_db5 8
.8 9
Transaccion9 D
.D E
SingleE K
(K L
mL M
=>N P
mQ R
.R S
idS U
==V X
transaccionY d
.d e
ide g
)g h
;h i
_db 
. 
Entry !
(! "
dbTransaccion1" 0
)0 1
.1 2
CurrentValues2 ?
.? @
	SetValues@ I
(I J
transaccionJ U
)U V
;V W
} 
_db 
. 
SaveChanges 
(  
)  !
;! "
var 
	resultado 
= 
new  #
OperationResult$ 3
(3 4
OperationResultEnum4 G
.G H
SuccessH O
)O P
;P Q
return 
	resultado $
;$ %
} 
catch 
( 
	Exception  
e! "
)" #
{ 
throw   
new   
DatosException   ,
(  , -
$str  - P
,  P Q
e  R S
)  S T
;  T U
}!! 
}## 	
}%% 
}&& ◊#
lD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\Transaccion\ActualizarDetallesTransaccion_Datos.cs
	namespace		 	
Tsp		
 
.		 
Sigescom		 
.		 
AccesoDatos		 "
.		" #
Transacciones		# 0
{ 
public 

partial 
class /
#ActualizarDetallesTransaccion_Datos <
:= >5
)IActualizarDetalleTransaccion_Repositorio? h
{ 
public 
OperationResult .
"ActualizarValorUnitarioyValorTotal A
(A B
ListB F
<F G
MovimientoAlmacenG X
>X Y
detallesZ b
)b c
{ 	
SigescomEntities 
_db  
=! "
new# &
SigescomEntities' 7
(7 8
)8 9
;9 :
try 
{ 
detalles 
. 
ForEach  
(  !
d! "
=># %
{& '
d( )
.) *
ImporteUnitario* 9
=: ;
Math< @
.@ A
RoundA F
(F G
dG H
.H I
ImporteUnitarioI X
,X Y
$numZ \
)\ ]
;] ^
d_ `
.` a
ImporteTotala m
=n o
Mathp t
.t u
Roundu z
(z {
d{ |
.| }
ImporteTotal	} â
,
â ä
$num
ã ç
)
ç é
;
é è
}
ê ë
)
ë í
;
í ì
string 
updateCommand (
=) *
$str+ L
;L M
List 
< 
string 
>  
commands! )
=* +
new, /
List0 4
<4 5
string5 ;
>; <
(< =
)= >
;> ?
foreach 
( 
var  
detalle! (
in) +
detalles, 4
)4 5
{ 
commands  
.  !
Add! $
($ %
Environment% 0
.0 1
NewLine1 8
+9 :
updateCommand; H
+I J
$strK _
+` a
detalleb i
.i j
ImporteUnitarioj y
+z {
$str	{ Ü
+
á à
detalle
â ê
.
ê ë
ImporteTotal
ë ù
+
û ü
$str
† Æ
+
Æ Ø
detalle
∞ ∑
.
∑ ∏"
IdDetalleTransaccion
∏ Ã
)
Ã Õ
;
Õ Œ
} 
var 
rondas 
=  
Math! %
.% &
Ceiling& -
(- .
(. /
double/ 5
)5 6
commands6 >
.> ?
Count? D
/E F
$numG K
)K L
;L M
for   
(   
int   
a   
=    
$num  ! "
;  " #
a  $ %
<  & '
rondas  ( .
;  . /
a  0 1
++  1 3
)  3 4
{!! 
var"" 
subList"" #
=""$ %
commands""& .
."". /
Skip""/ 3
(""3 4
a""4 5
*""6 7
$num""8 <
)""< =
.""= >
Take""> B
(""B C
$num""C G
)""G H
;""H I
string## 
com## "
=### $
$str##% '
;##' (
foreach$$ 
($$  !
var$$! $
item$$% )
in$$* ,
subList$$- 4
)$$4 5
{%% 
com&& 
+=&&  "
item&&# '
;&&' (
}'' 
_db(( 
.(( 
Database(( $
.(($ %
ExecuteSqlCommand((% 6
(((6 7
com((7 :
)((: ;
;((; <
})) 
var** 
resultadoDetails** (
=**) *
new**+ .
OperationResult**/ >
(**> ?
OperationResultEnum**? R
.**R S
Success**S Z
)**Z [
;**[ \
return++ 
resultadoDetails++ +
;+++ ,
},, 
catch-- 
(-- 
	Exception--  
e--! "
)--" #
{.. 
throw// 
new// 
DatosException// ,
(//, -
$str//- Z
,//Z [
e//\ ]
)//] ^
;//^ _
}00 
}22 	
}44 
}55 Úl
_D:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\Transaccion\CrearTransaccion_Datos.cs
	namespace		 	
Tsp		
 
.		 
Sigescom		 
.		 
AccesoDatos		 "
.		" #
Transacciones		# 0
{ 
public 

partial 
class $
CrearTransacciones_Datos 1
:1 2)
ICrearTransaccion_Repositorio3 P
{ 
public 
OperationResult 
CrearTransacciones 1
(1 2
List2 6
<6 7
Transaccion7 B
>B C
transaccionesD Q
)Q R
{ 	
try 
{ 
SigescomEntities  
_db! $
=% &
new' *
SigescomEntities+ ;
(; <
)< =
;= >
foreach 
( 
var 
item !
in" $
transacciones% 2
)2 3
{ 
_db 
. 
Transaccion #
.# $
Add$ '
(' (
item( ,
), -
;- .
} 
_db 
. 
SaveChanges 
(  
)  !
;! "
return 
new 
OperationResult *
(* +
OperationResultEnum+ >
.> ?
Success? F
)F G
;G H
} 
catch 
( 
	Exception 
e 
) 
{ 
return 
new 
OperationResult *
(* +
e+ ,
), -
;- .
} 
}   	
public## 
OperationResult## 8
,CrearTransaccionesYDetallesTransaccionMasivo## K
(##K L
List##L P
<##P Q
Transaccion##Q \
>##\ ]
transacciones##^ k
)##k l
{$$ 	
try%% 
{'' 
SigescomEntities((  
_db((! $
=((% &
new((' *
SigescomEntities((+ ;
(((; <
)((< =
;((= >
string** 
commandInsert** $
=**% &
$str**' P
;**P Q
List++ 
<++ 
string++ 
>++ 
comandosSQL++ (
=++) *
new+++ .
List++/ 3
<++3 4
string++4 :
>++: ;
(++; <
)++< =
;++= >
List,, 
<,, 
SqlParameter,, !
>,,! "
parametrosSql,,# 0
=,,1 2
new,,3 6
List,,7 ;
<,,; <
SqlParameter,,< H
>,,H I
(,,I J
),,J K
;,,K L
foreach-- 
(-- 
var-- 
transaccion-- (
in--) +
transacciones--, 9
)--9 :
{.. 
long// 
idTransaccion// &
;//& '
var00 
detalles00  
=00! "
transaccion00# .
.00. /
Detalle_transaccion00/ B
;00B C
transaccion11 
.11  
Detalle_transaccion11  3
=114 5
null116 :
;11: ;
_db22 
.22 
Transaccion22 #
.22# $
Add22$ '
(22' (
transaccion22( 3
)223 4
;224 5
_db33 
.33 
SaveChanges33 #
(33# $
)33$ %
;33% &
idTransaccion44 !
=44" #
transaccion44$ /
.44/ 0
id440 2
;442 3
string55 
comandoActual55 (
=55) *
$str55+ -
;55- .
foreach66 
(66 
var66  
detalleTransaccion66! 3
in664 6
detalles667 ?
)66? @
{77 
bool88 
	tieneLote88 &
=88' (
!88) *
String88* 0
.880 1
IsNullOrEmpty881 >
(88> ?
detalleTransaccion88? Q
.88Q R
lote88R V
)88V W
;88W X
comandoActual99 %
=99& '
(99( )
Environment99) 4
.994 5
NewLine995 <
+99= >
$str99? C
+99D E
idTransaccion99F S
+99T U
$str99V Z
+99[ \
detalleTransaccion99] o
.99o p
cantidad99p x
+99y z
$str99{ 
+
99Ä Å 
detalleTransaccion
99Ç î
.
99î ï!
id_concepto_negocio
99ï ®
+
99© ™
$str
99´ Ø
+
99∞ ±
$str
99≤ µ
+
99∂ ∑
(
99∏ π
string
99π ø
.
99ø ¿
IsNullOrEmpty
99¿ Õ
(
99Õ Œ 
detalleTransaccion
99Œ ‡
.
99‡ ·
detalle
99· Ë
)
99Ë È
?
99Í Î
$str
99Ï Ó
:
99Ô  
detalleTransaccion
99Ò É
.
99É Ñ
detalle
99Ñ ã
.
99ã å
Replace
99å ì
(
99ì î
$str
99î ó
,
99ó ò
$str
99ô ù
)
99ù û
)
99û ü
+
99† °
$str
99¢ ß
+
99® ©
$str
99™ Æ
+
99Ø ∞ 
detalleTransaccion
99± √
.
99√ ƒ
precio_unitario
99ƒ ”
+
99‘ ’
$str
99÷ ⁄
+
99€ ‹ 
detalleTransaccion
99› Ô
.
99Ô 
total
99 ı
+
99ˆ ˜
$str
99¯ Ñ
+
99Ö Ü 
detalleTransaccion
99á ô
.
99ô ö!
cantidad_secundaria
99ö ≠
+
99Æ Ø
$str
99∞ √
+
99ƒ ≈ 
detalleTransaccion
99∆ ÿ
.
99ÿ Ÿ
isc
99Ÿ ‹
+
99› ﬁ
$str
99ﬂ „
+
99‰ Â 
detalleTransaccion
99Ê ¯
.
99¯ ˘
igv
99˘ ¸
+
99˝ ˛
$str
99ˇ É
+
99Ñ Ö 
detalleTransaccion
99Ü ò
.
99ò ô
	descuento
99ô ¢
+
99£ §
$str
99• ©
+
99™ ´
(
99¨ ≠
	tieneLote
99≠ ∂
?
99∑ ∏
(
99π ∫
$str
99∫ Ω
+
99æ ø 
detalleTransaccion
99¿ “
.
99“ ”
lote
99” ◊
+
99ÿ Ÿ
$str
99⁄ ﬂ
)
99ﬂ ‡
:
99· ‚
$str
99„ È
)
99È Í
+
99Î Ï
$str
99Ì Ñ
)
99Ñ Ö
;
99Ö Ü
comandosSQL:: #
.::# $
Add::$ '
(::' (
comandoActual::( 5
)::5 6
;::6 7
};; 
}<< 
string== 
comandoAEjecutar== '
===( )
$str==* ,
;==, -
var>> 
rondas>> 
=>> 
Math>> !
.>>! "
Ceiling>>" )
(>>) *
(>>* +
double>>+ 1
)>>1 2
comandosSQL>>2 =
.>>= >
Count>>> C
/>>D E
$num>>F J
)>>J K
;>>K L
for?? 
(?? 
int?? 
a?? 
=?? 
$num?? 
;?? 
a??  !
<??" #
rondas??$ *
;??* +
a??, -
++??- /
)??/ 0
{@@ 
varAA !
subListaDeComandosSQLAA -
=AA. /
comandosSQLAA0 ;
.AA; <
SkipAA< @
(AA@ A
aAAA B
*AAC D
$numAAE I
)AAI J
.AAJ K
TakeAAK O
(AAO P
$numAAP T
)AAT U
;AAU V
stringBB 
comandoBB "
=BB# $
$strBB% '
;BB' (
foreachCC 
(CC 
varCC  
itemCC! %
inCC& (!
subListaDeComandosSQLCC) >
)CC> ?
{DD 
comandoEE 
+=EE  "
itemEE# '
;EE' (
}FF 
comandoGG 
=GG 
comandoGG %
.GG% &
	SubstringGG& /
(GG/ 0
$numGG0 1
,GG1 2
comandoGG3 :
.GG: ;
LengthGG; A
-GGB C
$numGGD E
)GGE F
;GGF G
comandoAEjecutarHH $
+=HH% '
commandInsertHH( 5
+HH6 7
comandoHH8 ?
;HH? @
}II 
varJJ 
	resultadoJJ 
=JJ 
_dbJJ  #
.JJ# $
DatabaseJJ$ ,
.JJ, -
ExecuteSqlCommandJJ- >
(JJ> ?
comandoAEjecutarJJ? O
,JJO P
parametrosSqlJJQ ^
.JJ^ _
ToArrayJJ_ f
(JJf g
)JJg h
)JJh i
;JJi j
varKK 
resultKK 
=KK 
newKK  
OperationResultKK! 0
(KK0 1
OperationResultEnumKK1 D
.KKD E
SuccessKKE L
)KKL M
;KKM N
returnLL 
resultLL 
;LL 
}MM 
catchNN 
(NN 
	ExceptionNN 
eNN 
)NN 
{OO 
throwPP 
newPP 
DatosExceptionPP (
(PP( )
$strPP) c
,PPc d
ePPe f
)PPf g
;PPg h
}QQ 
}RR 	
publicYY 
OperationResultYY 6
*CrearTransaccionYDetallesTransaccionMasivoYY I
(YYI J
TransaccionYYJ U
transaccionYYV a
,YYa b
ListYYc g
<YYg h
Detalle_transaccionYYh {
>YY{ | 
detallesTransaccion	YY} ê
)
YYê ë
{ZZ 	
try[[ 
{\\ 
SigescomEntities]]  
_db]]! $
=]]% &
new]]' *
SigescomEntities]]+ ;
(]]; <
)]]< =
;]]= >
List^^ 
<^^ 
string^^ 
>^^ 
comandosSQL^^ (
=^^) *
new^^+ .
List^^/ 3
<^^3 4
string^^4 :
>^^: ;
(^^; <
)^^< =
;^^= >
List__ 
<__ 
SqlParameter__ !
>__! "
parametrosSql__# 0
=__1 2
new__3 6
List__7 ;
<__; <
SqlParameter__< H
>__H I
(__I J
)__J K
;__K L
long`` 
idTransaccion`` "
;``" #
_dbbb 
.bb 
Transaccionbb 
.bb  
Addbb  #
(bb# $
transaccionbb$ /
)bb/ 0
;bb0 1
_dbcc 
.cc 
SaveChangescc 
(cc  
)cc  !
;cc! "
vardd 

resultSavedd 
=dd  
newdd! $
OperationResultdd% 4
(dd4 5
OperationResultEnumdd5 H
.ddH I
SuccessddI P
)ddP Q
;ddQ R
idTransaccionee 
=ee 
transaccionee  +
.ee+ ,
idee, .
;ee. /
foreachgg 
(gg 
vargg 
detalleTransacciongg /
ingg0 2
detallesTransacciongg3 F
)ggF G
{hh 
varii 
comandoActualii %
=ii& '
(ii( )
Environmentii) 4
.ii4 5
NewLineii5 <
+ii= >
$strii? j
+iik l
idTransaccioniim z
+ii{ |
$str	ii} Å
+
iiÇ É 
detalleTransaccion
iiÑ ñ
.
iiñ ó
cantidad
iió ü
+
ii† °
$str
ii¢ ¶
+
iiß ® 
detalleTransaccion
ii© ª
.
iiª º!
id_concepto_negocio
iiº œ
+
ii– —
$str
ii“ ÷
+
ii◊ ÿ
$str
iiŸ ‹
+
ii› ﬁ 
detalleTransaccion
iiﬂ Ò
.
iiÒ Ú
detalle
iiÚ ˘
.
ii˘ ˙
Replace
ii˙ Å
(
iiÅ Ç
$str
iiÇ Ö
,
iiÖ Ü
$str
iiá ã
)
iiã å
+
iiç é
$str
iiè î
+
iiï ñ
$str
iió õ
+
iiú ù 
detalleTransaccion
iiû ∞
.
ii∞ ±
precio_unitario
ii± ¿
+
ii¡ ¬
$str
ii√ «
+
ii» … 
detalleTransaccion
ii  ‹
.
ii‹ ›
total
ii› ‚
+
ii„ ‰
$str
iiÂ Ò
+
iiÚ Û 
detalleTransaccion
iiÙ Ü
.
iiÜ á!
cantidad_secundaria
iiá ö
+
iiõ ú
$str
iiù Æ
+
iiØ ∞ 
detalleTransaccion
ii± √
.
ii√ ƒ
isc
iiƒ «
+
ii» …
$str
ii  Œ
+
iiœ – 
detalleTransaccion
ii— „
.
ii„ ‰
igv
ii‰ Á
+
iiË È
$str
iiÍ Ó
+
iiÔ  
detalleTransaccion
iiÒ É
.
iiÉ Ñ
	descuento
iiÑ ç
+
iié è
$str
iiê Ø
)
iiØ ∞
;
ii∞ ±
comandosSQLjj 
.jj  
Addjj  #
(jj# $
comandoActualjj$ 1
)jj1 2
;jj2 3
}kk 
stringll 
comandoAEjecutarll '
=ll( )
$strll* ,
;ll, -
foreachmm 
(mm 
varmm 
itemmm !
inmm" $
comandosSQLmm% 0
)mm0 1
{nn 
comandoAEjecutaroo $
+=oo% '
itemoo( ,
;oo, -
}pp 
varqq 
	resultadoqq 
=qq 
_dbqq  #
.qq# $
Databaseqq$ ,
.qq, -
ExecuteSqlCommandqq- >
(qq> ?
comandoAEjecutarqq? O
,qqO P
parametrosSqlqqQ ^
.qq^ _
ToArrayqq_ f
(qqf g
)qqg h
)qqh i
;qqi j
varss 
resultss 
=ss 
newss  
OperationResultss! 0
(ss0 1
OperationResultEnumss1 D
.ssD E
SuccessssE L
)ssL M
;ssM N
returntt 
resulttt 
;tt 
}uu 
catchvv 
(vv 
	Exceptionvv 
evv 
)vv 
{ww 
throwxx 
newxx 
DatosExceptionxx (
(xx( )
$strxx) _
,xx_ `
exxa b
)xxb c
;xxc d
}zz 
}{{ 	
}|| 
}}} Ûá
bD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\Transaccion\ConsultaTransaccion_Datos.cs
	namespace

 	
Tsp


 
.

 
Sigescom

 
.

 
AccesoDatos

 "
.

" #
Transacciones

# 0
{ 
public 

partial 
class %
ConsultaTransaccion_Datos 2
:3 4,
 IConsultaTransaccion_Repositorio5 U
{ 
public 
DateTime 
? *
ObtenerFechaPrimeraTransaccion 7
(7 8
int8 ;
	idAlmacen< E
)E F
{ 	
SigescomEntities 
_db  
=! "
new# &
SigescomEntities' 7
(7 8
)8 9
;9 :
var 
result 
= 
_db 
. 
Transaccion (
.( )
OrderBy) 0
(0 1
t1 2
=>3 5
t6 7
.7 8
fecha_inicio8 D
)D E
.E F
FirstOrDefaultF T
(T U
tU V
=>W Y
tZ [
.[ \$
id_actor_negocio_interno\ t
==u w
	idAlmacen	x Å
)
Å Ç
;
Ç É
return 
result 
!= 
null !
?" #
($ %
DateTime% -
?- .
). /
result/ 5
.5 6
fecha_inicio6 B
:C D
nullE I
;I J
} 	
public 
IEnumerable 
< 
Transaccion &
>& 'K
?ObtenerTransaccionesSegunTipoYConTipoTransaccionPadreDiferenteA( g
(g h
inth k
idTipoTransaccionl }
,} ~
int	 Ç$
idTipoTransaccionPadre
É ô
)
ô ö
{ 	
SigescomEntities 
_db  
=! "
new# &
SigescomEntities' 7
(7 8
)8 9
;9 :
var 
result 
= 
_db 
. 
Transaccion (
.( )
Where) .
(. /
t/ 0
=>1 3
t4 5
.5 6
id_tipo_transaccion6 I
==J L
idTipoTransaccionM ^
&&_ a
tb c
.c d 
id_transaccion_padred x
!=y {
null	| Ä
&&
Å É
t
Ñ Ö
.
Ö Ü
Transaccion2
Ü í
.
í ì!
id_tipo_transaccion
ì ¶
!=
ß ©$
idTipoTransaccionPadre
™ ¿
)
¿ ¡
;
¡ ¬
return 
result 
; 
} 	
public 
IEnumerable 
< 
Transaccion &
>& '%
ObtenerTransaccionesPadre( A
(A B
longB F
[F G
]G H!
idsTransaccionesHijasI ^
)^ _
{ 	
SigescomEntities 
_db  
=! "
new# &
SigescomEntities' 7
(7 8
)8 9
;9 :
var 
result 
= 
_db 
. 
Transaccion (
.( )
Where) .
(. /
t/ 0
=>1 3!
idsTransaccionesHijas4 I
.I J
ContainsJ R
(R S
tS T
.T U
idU W
)W X
)X Y
.Y Z
SelectZ `
(` a
ta b
=>c e
tf g
.g h
Transaccion2h t
)t u
;u v
return   
result   
;   
}!! 	
public"" 
IEnumerable"" 
<"" 6
*TransaccionPorSerieDeComprobanteYCategoria"" E
>""E F?
3ObtenerTransaccionesPorSerieDeComprobanteYCategoria""G z
(""z {
int""{ ~
[""~ 
]	"" Ä
idsPuntosDeVentas
""Å í
,
""í ì
int
""î ó
[
""ó ò
]
""ò ô!
idsTiposTransaccion
""ö ≠
,
""≠ Æ
int
""Ø ≤
idEstadoActual
""≥ ¡
,
""¡ ¬
DateTime
""√ À

fechaDesde
""Ã ÷
,
""÷ ◊
DateTime
""ÿ ‡

fechaHasta
""· Î
)
""Î Ï
{## 	
try$$ 
{%% 
SigescomEntities&&  
_db&&! $
=&&% &
new&&' *
SigescomEntities&&+ ;
(&&; <
)&&< =
;&&= >
var'' 
ventasPorFamilia'' $
=''% &
_db''' *
.''* +
Transaccion''+ 6
.''6 7
Where''7 <
(''< =
t''= >
=>''? A
t''B C
.''C D
fecha_inicio''D P
>=''Q S

fechaDesde''T ^
&&''_ a
t''b c
.''c d
fecha_inicio''d p
<=''q s

fechaHasta''t ~
&&	'' Å!
idsTiposTransaccion
''Ç ï
.
''ï ñ
Contains
''ñ û
(
''û ü
t
''ü †
.
''† °!
id_tipo_transaccion
''° ¥
)
''¥ µ
&&
''∂ ∏
t
''π ∫
.
''∫ ª
id_estado_actual
''ª À
==
''Ã Œ
idEstadoActual
''œ ›
&&
''ﬁ ‡
idsPuntosDeVentas
''· Ú
.
''Ú Û
Contains
''Û ˚
(
''˚ ¸
t
''¸ ˝
.
''˝ ˛&
id_actor_negocio_interno
''˛ ñ
)
''ñ ó
)
''ó ò
.(( 

SelectMany(( 
((( 
t(( 
=>((  
t((! "
.((" #
Detalle_transaccion((# 6
)((6 7
.((7 8
Select((8 >
(((> ?
dt((? A
=>((B D
new((E H
{)) 
IdTipoComprobante** %
=**& '
dt**( *
.*** +
Transaccion**+ 6
.**6 7
Comprobante**7 B
.**B C
id_tipo_comprobante**C V
,**V W"
NombreCortoComprobante++ *
=+++ ,
dt++- /
.++/ 0
Transaccion++0 ;
.++; <
Comprobante++< G
.++G H
Detalle_maestro++H W
.++W X
valor++X ]
,++] ^
Serie,, 
=,, 
dt,, 
.,, 
Transaccion,, *
.,,* +
Comprobante,,+ 6
.,,6 7
numero_serie,,7 C
,,,C D
	IdFamilia-- 
=-- 
dt--  "
.--" #
Concepto_negocio--# 3
.--3 4
id_concepto_basico--4 F
,--F G
Cantidad.. 
=.. 
dt.. !
...! "
cantidad.." *
,..* +
Importe// 
=// 
dt//  
.//  !
total//! &
}00 
)00 
.00 
ToList00 
(00 
)00 
;00 
var11 
idsFamiliaDeVentas11 &
=11' (
ventasPorFamilia11) 9
.119 :
Select11: @
(11@ A
v11A B
=>11C E
v11F G
.11G H
	IdFamilia11H Q
)11Q R
.11R S
ToList11S Y
(11Y Z
)11Z [
;11[ \
var22  
familiasConCategoria22 (
=22) *
_db22+ .
.22. /
Detalle_maestro22/ >
.22> ?
Where22? D
(22D E
dm22E G
=>22H J
idsFamiliaDeVentas22K ]
.22] ^
Contains22^ f
(22f g
dm22g i
.22i j
id22j l
)22l m
)22m n
.22n o

SelectMany22o y
(22y z
d22z {
=>22| ~
d	22 Ä
.
22Ä Å 
Categoria_concepto
22Å ì
)
22ì î
.
22î ï
Select
22ï õ
(
22õ ú
cc
22ú û
=>
22ü °
new
22¢ •
{33 
	IdFamilia44 
=44 
cc44  "
.44" #
Detalle_maestro44# 2
.442 3
id443 5
,445 6
IdCategoria55 
=55  !
cc55" $
.55$ %
Detalle_maestro155% 5
.555 6
id556 8
,558 9
	Categoria66 
=66 
cc66  "
.66" #
Detalle_maestro166# 3
.663 4
nombre664 :
}77 
)77 
.77 
ToList77 
(77 
)77 
;77 
var88 
	resultado88 
=88 
ventasPorFamilia88  0
.880 1
Select881 7
(887 8
v888 9
=>88: <
new88= @
{99 
v:: 
.:: 
IdTipoComprobante:: '
,::' (
v;; 
.;; "
NombreCortoComprobante;; ,
,;;, -
v<< 
.<< 
Serie<< 
,<< 
v== 
.== 
Cantidad== 
,== 
v>> 
.>> 
Importe>> 
,>> 
IdCategoria?? 
=??  ! 
familiasConCategoria??" 6
.??6 7
SingleOrDefault??7 F
(??F G
f??G H
=>??I K
f??L M
.??M N
	IdFamilia??N W
==??X Z
v??[ \
.??\ ]
	IdFamilia??] f
)??f g
==??h j
null??k o
???p q
$num??r s
:??t u!
familiasConCategoria	??v ä
.
??ä ã
Single
??ã ë
(
??ë í
f
??í ì
=>
??î ñ
f
??ó ò
.
??ò ô
	IdFamilia
??ô ¢
==
??£ •
v
??¶ ß
.
??ß ®
	IdFamilia
??® ±
)
??± ≤
.
??≤ ≥
IdCategoria
??≥ æ
,
??æ ø
	Categoria@@ 
=@@  
familiasConCategoria@@  4
.@@4 5
SingleOrDefault@@5 D
(@@D E
f@@E F
=>@@G I
f@@J K
.@@K L
	IdFamilia@@L U
==@@V X
v@@Y Z
.@@Z [
	IdFamilia@@[ d
)@@d e
==@@f h
null@@i m
?@@n o
$str@@p t
:@@u v!
familiasConCategoria	@@w ã
.
@@ã å
Single
@@å í
(
@@í ì
f
@@ì î
=>
@@ï ó
f
@@ò ô
.
@@ô ö
	IdFamilia
@@ö £
==
@@§ ¶
v
@@ß ®
.
@@® ©
	IdFamilia
@@© ≤
)
@@≤ ≥
.
@@≥ ¥
	Categoria
@@¥ Ω
,
@@Ω æ
}AA 
)AA 
.AA 
GroupByAA 
(AA 
vAA 
=>AA 
newAA  #
{BB 
vCC 
.CC 
IdTipoComprobanteCC '
,CC' (
vDD 
.DD "
NombreCortoComprobanteDD ,
,DD, -
vEE 
.EE 
SerieEE 
,EE 
vFF 
.FF 
IdCategoriaFF !
,FF! "
vGG 
.GG 
	CategoriaGG 
}HH 
)HH 
.HH 
SelectHH 
(HH 
vfHH 
=>HH 
newHH  #6
*TransaccionPorSerieDeComprobanteYCategoriaHH$ N
{II 
IdCategoriaJJ 
=JJ  !
vfJJ" $
.JJ$ %
KeyJJ% (
.JJ( )
IdCategoriaJJ) 4
,JJ4 5
	CategoriaKK 
=KK 
vfKK  "
.KK" #
KeyKK# &
.KK& '
	CategoriaKK' 0
,KK0 1
IdTipoComprobanteLL %
=LL& '
vfLL( *
.LL* +
KeyLL+ .
.LL. /
IdTipoComprobanteLL/ @
,LL@ A"
NombreCortoComprobanteMM *
=MM+ ,
vfMM- /
.MM/ 0
KeyMM0 3
.MM3 4"
NombreCortoComprobanteMM4 J
,MMJ K
SerieNN 
=NN 
vfNN 
.NN 
KeyNN "
.NN" #
SerieNN# (
,NN( )
CantidadOO 
=OO 
vfOO !
.OO! "
SumOO" %
(OO% &
fOO& '
=>OO( *
fOO+ ,
.OO, -
CantidadOO- 5
)OO5 6
,OO6 7
ImportePP 
=PP 
vfPP  
.PP  !
SumPP! $
(PP$ %
fPP% &
=>PP' )
fPP* +
.PP+ ,
ImportePP, 3
)PP3 4
,PP4 5
}QQ 
)QQ 
;QQ 
returnRR 
	resultadoRR  
;RR  !
}SS 
catchTT 
(TT 
	ExceptionTT 
eTT 
)TT 
{UU 
throwVV 
newVV 
DatosExceptionVV (
(VV( )
$strVV) n
,VVn o
eVVp q
)VVq r
;VVr s
}XX 
}YY 	
publicZZ 
IEnumerableZZ 
<ZZ 5
)TransaccionPorSerieDeComprobanteYConceptoZZ D
>ZZD E>
2ObtenerTransaccionesPorSerieDeComprobanteYConceptoZZF x
(ZZx y
intZZy |
[ZZ| }
]ZZ} ~
	idsSeries	ZZ à
,
ZZà â
int
ZZä ç
[
ZZç é
]
ZZé è!
idsTiposTransaccion
ZZê £
,
ZZ£ §
int
ZZ• ®
idEstadoActual
ZZ© ∑
,
ZZ∑ ∏
DateTime
ZZπ ¡

fechaDesde
ZZ¬ Ã
,
ZZÃ Õ
DateTime
ZZŒ ÷

fechaHasta
ZZ◊ ·
)
ZZ· ‚
{[[ 	
try\\ 
{]] 
SigescomEntities^^  
_db^^! $
=^^% &
new^^' *
SigescomEntities^^+ ;
(^^; <
)^^< =
;^^= >
var__ 
	resultado__ 
=__ 
_db__  #
.__# $
Transaccion__$ /
.__/ 0
Where__0 5
(__5 6
t__6 7
=>__8 :
t__; <
.__< =
fecha_inicio__= I
>=__J L

fechaDesde__M W
&&__X Z
t__[ \
.__\ ]
fecha_inicio__] i
<=__j l

fechaHasta__m w
&&__x z 
idsTiposTransaccion	__{ é
.
__é è
Contains
__è ó
(
__ó ò
t
__ò ô
.
__ô ö!
id_tipo_transaccion
__ö ≠
)
__≠ Æ
&&
__Ø ±
t
__≤ ≥
.
__≥ ¥
id_estado_actual
__¥ ƒ
==
__≈ «
idEstadoActual
__» ÷
&&
__◊ Ÿ
	idsSeries
__⁄ „
.
__„ ‰
Contains
__‰ Ï
(
__Ï Ì
(
__Ì Ó
int
__Ó Ò
)
__Ò Ú
t
__Ú Û
.
__Û Ù
Comprobante
__Ù ˇ
.
__ˇ Ä"
id_serie_comprobante
__Ä î
)
__î ï
)
__ï ñ
.`` 

SelectMany`` 
(`` 
t`` 
=>``  
t``! "
.``" #
Detalle_transaccion``# 6
)``6 7
.aa 
GroupByaa 
(aa 
dtaa 
=>aa 
newaa "
{bb 
dtcc 
.cc 
Transaccioncc "
.cc" #
Comprobantecc# .
.cc. /
id_tipo_comprobantecc/ B
,ccB C
dtdd 
.dd 
Transacciondd "
.dd" #
Comprobantedd# .
.dd. /
Detalle_maestrodd/ >
.dd> ?
valordd? D
,ddD E
dtee 
.ee 
Transaccionee "
.ee" #
Comprobanteee# .
.ee. /
numero_serieee/ ;
,ee; <

IdConceptoff 
=ff  
dtff! #
.ff# $
Concepto_negocioff$ 4
.ff4 5
idff5 7
,ff7 8
NombreConceptogg "
=gg# $
dtgg% '
.gg' (
Concepto_negociogg( 8
.gg8 9
nombregg9 ?
}hh 
)hh 
.hh 
Selecthh 
(hh 
ghh 
=>hh 
newhh "5
)TransaccionPorSerieDeComprobanteYConceptohh# L
{ii 
IdTipoComprobantejj %
=jj& '
gjj( )
.jj) *
Keyjj* -
.jj- .
id_tipo_comprobantejj. A
,jjA B"
NombreCortoComprobantekk *
=kk+ ,
gkk- .
.kk. /
Keykk/ 2
.kk2 3
valorkk3 8
,kk8 9
Seriell 
=ll 
gll 
.ll 
Keyll !
.ll! "
numero_seriell" .
,ll. /

IdConceptomm 
=mm  
gmm! "
.mm" #
Keymm# &
.mm& '

IdConceptomm' 1
,mm1 2
Conceptonn 
=nn 
gnn  
.nn  !
Keynn! $
.nn$ %
NombreConceptonn% 3
,nn3 4
Cantidadoo 
=oo 
goo  
.oo  !
Sumoo! $
(oo$ %
coo% &
=>oo' )
coo* +
.oo+ ,
cantidadoo, 4
)oo4 5
,oo5 6
Importepp 
=pp 
gpp 
.pp  
Sumpp  #
(pp# $
tpp$ %
=>pp& (
tpp) *
.pp* +
totalpp+ 0
)pp0 1
}qq 
)qq 
.qq 
ToListqq 
(qq 
)qq 
;qq 
returnrr 
	resultadorr  
;rr  !
}ss 
catchtt 
(tt 
	Exceptiontt 
ett 
)tt 
{uu 
throwvv 
newvv 
DatosExceptionvv (
(vv( )
$strvv) m
,vvm n
evvo p
)vvp q
;vvq r
}xx 
}yy 	
}zz 
}{{ ÷C
ZD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\Almacen\MaestrosAlmacen_Datos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
." #
Almacen# *
{ 
public 

partial 
class  
MaestroAlmacen_Datos -
:- .(
IMaestrosAlmacen_Repositorio/ K
{ 
public 
int 
[ 
] *
ObtenerIdsConceptosComerciales 3
(3 4
)4 5
{ 	
try 
{ 
SigescomEntities  
_db! $
=% &
new' *
SigescomEntities+ ;
(; <
)< =
;= >
return 
_db 
.  
Concepto_negocio_rol /
. 
Include  
(  !
cnr! $
=>% '
cnr( +
.+ ,
Rol, /
)/ 0
. 
Include  
(  !
cnr! $
=>% '
cnr( +
.+ ,
Concepto_negocio, <
)< =
. 
Include  
(  !
cnr! $
=>% '
cnr( +
.+ ,
Concepto_negocio, <
.< =
Detalle_maestro= L
)L M
. 
Include  
(  !
cnr! $
=>% '
cnr( +
.+ ,
Concepto_negocio, <
.< =
Detalle_maestro4= M
)M N
. 
Where 
( 
cnr "
=># %
cnr& )
.) *
id_rol* 0
==1 3
ConceptoSettings4 D
.D E
DefaultE L
.L M
IdRolMercaderiaM \
)\ ]
.] ^
ToList^ d
(d e
)e f
. 
Select 
(  
cnr  #
=>$ &
cnr' *
.* +
Concepto_negocio+ ;
); <
.   
Where   
(   
cnr   "
=>  # %
cnr  & )
.  ) *

es_vigente  * 4
)  4 5
.  5 6
Select  6 <
(  < =
cn  = ?
=>  @ B
cn  C E
.  E F
id  F H
)  H I
.  I J
ToArray  J Q
(  Q R
)  R S
;  S T
}!! 
catch"" 
("" 
	Exception"" 
e"" 
)"" 
{## 
throw$$ 
e$$ 
;$$ 
}%% 
}&& 	
public'' 
int'' 
['' 
]'' 
ObtenerIdsAlmacenes'' (
(''( )
)'') *
{(( 	
SigescomEntities)) 
_db))  
=))! "
new))# &
SigescomEntities))' 7
())7 8
)))8 9
;))9 :
return++ 
_db++ 
.++ 
Actor_negocio++ $
.++$ %
Where++% *
(++* +
an+++ -
=>++. 0
an++1 3
.++3 4
id_rol++4 :
==++; =
ActorSettings++> K
.++K L
Default++L S
.++S T
IdRolAlmacen++T `
)++` a
.++a b
Select++b h
(++h i
an++i k
=>++l n
an++o q
.++q r
Actor++r w
)++w x
.++x y

SelectMany	++y É
(
++É Ñ
a
++Ñ Ö
=>
++Ü à
a
++â ä
.
++ä ã
Actor_negocio
++ã ò
)
++ò ô
.
++ô ö
Where
++ö ü
(
++ü †
an
++† ¢
=>
++£ •
an
++¶ ®
.
++® ©
id_rol
++© Ø
==
++∞ ≤
ActorSettings
++≥ ¿
.
++¿ ¡
Default
++¡ »
.
++» …!
IdRolEntidadInterna
++… ‹
)
++‹ ›
.
++› ﬁ
Select
++ﬁ ‰
(
++‰ Â
an
++Â Á
=>
++Ë Í
an
++Î Ì
.
++Ì Ó
id
++Ó 
)
++ Ò
.
++Ò Ú
ToArray
++Ú ˘
(
++˘ ˙
)
++˙ ˚
;
++˚ ¸
},, 	
public11 
decimal11 
ObtenerStockMinimo11 )
(11) *
int11* -

idConcepto11. 8
)118 9
{22 	
SigescomEntities33 
_db33  
=33! "
new33# &
SigescomEntities33' 7
(337 8
)338 9
;339 :
return44 
_db44 
.44 
Concepto_negocio44 '
.44' (
Single44( .
(44. /
c44/ 0
=>441 3
c444 5
.445 6
id446 8
==449 ;

idConcepto44< F
)44F G
.44G H
stock_minimo44H T
;44T U
}55 	
public77 
IEnumerable77 
<77 
ItemGenerico77 '
>77' (9
-ObtenerConceptosNegocioComercializablesBienes77) V
(77V W
)77W X
{88 	
SigescomEntities99 
_db99  
=99! "
new99# &
SigescomEntities99' 7
(997 8
)998 9
;999 :
return:: 
_db:: 
.::  
Concepto_negocio_rol:: +
.::+ ,
Where::, 1
(::1 2
cnr::2 5
=>::6 8
cnr::9 <
.::< =
id_rol::= C
==::C E
ConceptoSettings::F V
.::V W
Default::W ^
.::^ _
IdRolMercaderia::_ n
)::n o
.::o p
Select::p v
(::v w
cnr::w z
=>::z |
cnr	::} Ä
.
::Ä Å
Concepto_negocio
::Å ë
)
::ë í
.
::í ì
Where
::ì ò
(
::ò ô
cn
::ô õ
=>
::ú û
cn
::ü °
.
::° ¢
Detalle_maestro4
::¢ ≤
.
::≤ ≥
valor
::≥ ∏
==
::π ª
$str
::º ø
)
::ø ¿
.
::¿ ¡
Select
::¡ «
(
::« »
cn
::»  
=>
::  Ã
new
::Õ –
ItemGenerico
::— ›
(
::› ﬁ
)
::ﬁ ﬂ
{
::‡ ·
Id
::· „
=
::„ ‰
cn
::Â Á
.
::Á Ë
id
::Ë Í
,
::Í Î
Nombre
::Ï Ú
=
::Ú Û
cn
::Ù ˆ
.
::ˆ ˜
nombre
::˜ ˝
}
::˛ ˇ
)
::ˇ Ä
;
::Ä Å
};; 	
public<< 
IEnumerable<< 
<<< &
Familia_Concepto_Comercial<< 5
><<5 6!
ObtenerFamiliasBienes<<7 L
(<<L M
)<<M N
{== 	
try>> 
{?? 
SigescomEntities@@  
_db@@! $
=@@% &
new@@' *
SigescomEntities@@+ ;
(@@; <
)@@< =
;@@= >
returnAA 
_dbAA 
.AA  
Concepto_negocio_rolAA /
.AA/ 0
WhereAA0 5
(AA5 6
cnrAA6 9
=>AA: <
cnrAA= @
.AA@ A
id_rolAAA G
==AAH J
ConceptoSettingsAAK [
.AA[ \
DefaultAA\ c
.AAc d
IdRolMercaderiaAAd s
)AAs t
.AAt u
SelectAAu {
(AA{ |
cnrAA| 
=>
AAÄ Ç
cnr
AAÉ Ü
.
AAÜ á
Concepto_negocio
AAá ó
)
AAó ò
.
AAò ô
Select
AAô ü
(
AAü †
cn
AA† ¢
=>
AA£ •
cn
AA¶ ®
.
AA® ©
Detalle_maestro4
AA© π
)
AAπ ∫
.
AA∫ ª
Distinct
AAª √
(
AA√ ƒ
)
AAƒ ≈
.
AA≈ ∆
Where
AA∆ À
(
AAÀ Ã
dm
AAÃ Œ
=>
AAœ —
dm
AA“ ‘
.
AA‘ ’
valor
AA’ ⁄
==
AA€ ›
$str
AAﬁ ·
)
AA· ‚
.BB 
SelectBB 
(BB 
dmBB 
=>BB !
newBB" %&
Familia_Concepto_ComercialBB& @
(BB@ A
)BBA B
{CC 
IdDD 
=DD 
dmDD 
.DD  
idDD  "
,DD" #
NombreEE 
=EE  
dmEE! #
.EE# $
nombreEE$ *
,EE* +
EsbienFF 
=FF  
dmFF! #
.FF# $
valorFF$ )
==FF* ,
$strFF- 0
}GG 
)GG 
;GG 
}HH 
catchII 
(II 
	ExceptionII 
eII 
)II 
{JJ 
throwKK 
newKK 
DatosExceptionKK (
(KK( )
$strKK) O
,KKO P
eKKQ R
)KKR S
;KKS T
}LL 
}MM 	
}PP 
}QQ ÌÛ	
VD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\Almacen\Movimientos_Datos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
." #
Almacen# *
{ 
public 

partial 
class 
Movimientos_Datos *
:+ ,$
IMovimientos_Repositorio- E
{ 
public 
IEnumerable 
< 
InventarioFisico +
>+ ,6
*ObtenerSaldosDeMovimientosPorConceptoYLote- W
(W X
intX [
[[ \
]\ ]
idsConceptos^ j
,j k
intl o
[o p
]p q
idsAlmacenesr ~
)~ 
{ 	
try 
{ 
SigescomEntities  
_db! $
=% &
new' *
SigescomEntities+ ;
(; <
)< =
;= >
int 
[ 
] <
0idsTiposDeTransaccionMovimientoDeBienes_Entradas F
=G H
DiccionarioI T
.T U:
-TiposDeTransaccionMovimientoDeBienes_Entradas	U Ç
;
Ç É
int 
[ 
] ;
/idsTiposDeTransaccionMovimientoDeBienes_Salidas E
=F G
DiccionarioH S
.S T9
,TiposDeTransaccionMovimientoDeBienes_Salidas	T Ä
;
Ä Å
int 
[ 
] 0
$idsTiposTransaccionMovimientoAlmacen :
=; <<
0idsTiposDeTransaccionMovimientoDeBienes_Entradas= m
.m n
Unionn s
(s t<
/idsTiposDeTransaccionMovimientoDeBienes_Salidas	t £
)
£ §
.
§ •
ToArray
• ¨
(
¨ ≠
)
≠ Æ
;
Æ Ø
var 
saldos 
= 
_db  
.  !
Transaccion! ,
. 
Where 
( 
t 
=> 
idsAlmacenes  ,
., -
Contains- 5
(5 6
t6 7
.7 8$
id_actor_negocio_interno8 P
)P Q
&&R T0
$idsTiposTransaccionMovimientoAlmacenU y
.y z
Contains	z Ç
(
Ç É
t
É Ñ
.
Ñ Ö!
id_tipo_transaccion
Ö ò
)
ò ô
) 
. 

SelectMany 
( 
t 
=>  
t! "
." #
Detalle_transaccion# 6
)6 7
.7 8
Where8 =
(= >
dt> @
=>A C
idsConceptosD P
.P Q
ContainsQ Y
(Y Z
dtZ \
.\ ]
id_concepto_negocio] p
)p q
)q r
.r s
GroupBy 
( 
dt 
=> 
new !
{   
	IdAlmacen!! 
=!! 
dt!!  "
.!!" #
Transaccion!!# .
.!!. /$
id_actor_negocio_interno!!/ G
,!!G H
IdConceptoNegocio"" %
=""& '
dt""( *
.""* +
id_concepto_negocio""+ >
,""> ?
IdLote## 
=## 
dt## 
.##  
lote##  $
}$$ 
)$$ 
.$$ 
Select$$ 
($$ 
m$$ 
=>$$ 
new$$ "
InventarioFisico$$# 3
($$3 4
)$$4 5
{%% 
	IdAlmacen&& 
=&& 
m&&  !
.&&! "
Key&&" %
.&&% &
	IdAlmacen&&& /
,&&/ 0

IdConcepto'' 
=''  
m''! "
.''" #
Key''# &
.''& '
IdConceptoNegocio''' 8
,''8 9
Lote(( 
=(( 
m(( 
.(( 
Key((  
.((  !
IdLote((! '
,((' (
Cantidad)) 
=)) 
m))  
.))  !
Where))! &
())& '
dt))' )
=>))* ,<
0idsTiposDeTransaccionMovimientoDeBienes_Entradas))- ]
.))] ^
Contains))^ f
())f g
dt))g i
.))i j
Transaccion))j u
.))u v 
id_tipo_transaccion	))v â
)
))â ä
)
))ä ã
.
))ã å
Select
))å í
(
))í ì
dt
))ì ï
=>
))ñ ò
dt
))ô õ
.
))õ ú
cantidad
))ú §
)
))§ •
.
))• ¶
DefaultIfEmpty
))¶ ¥
(
))¥ µ
$num
))µ ∂
)
))∂ ∑
.
))∑ ∏
Sum
))∏ ª
(
))ª º
)
))º Ω
-
))æ ø
m
))¿ ¡
.
))¡ ¬
Where
))¬ «
(
))« »
dt
))»  
=>
))À Õ=
/idsTiposDeTransaccionMovimientoDeBienes_Salidas
))Œ ˝
.
))˝ ˛
Contains
))˛ Ü
(
))Ü á
dt
))á â
.
))â ä
Transaccion
))ä ï
.
))ï ñ!
id_tipo_transaccion
))ñ ©
)
))© ™
)
))™ ´
.
))´ ¨
Select
))¨ ≤
(
))≤ ≥
dt
))≥ µ
=>
))∂ ∏
dt
))π ª
.
))ª º
cantidad
))º ƒ
)
))ƒ ≈
.
))≈ ∆
DefaultIfEmpty
))∆ ‘
(
))‘ ’
$num
))’ ÷
)
))÷ ◊
.
))◊ ÿ
Sum
))ÿ €
(
))€ ‹
)
))‹ ›
,
))› ﬁ
CantidadSecundaria** &
=**' (
(**) *
decimal*** 1
)**1 2
m**2 3
.**3 4
Where**4 9
(**9 :
dt**: <
=>**= ?<
0idsTiposDeTransaccionMovimientoDeBienes_Entradas**@ p
.**p q
Contains**q y
(**y z
dt**z |
.**| }
Transaccion	**} à
.
**à â!
id_tipo_transaccion
**â ú
)
**ú ù
)
**ù û
.
**û ü
Select
**ü •
(
**• ¶
dt
**¶ ®
=>
**© ´
dt
**¨ Æ
.
**Æ Ø!
cantidad_secundaria
**Ø ¬
)
**¬ √
.
**√ ƒ
DefaultIfEmpty
**ƒ “
(
**“ ”
$num
**” ‘
)
**‘ ’
.
**’ ÷
Sum
**÷ Ÿ
(
**Ÿ ⁄
)
**⁄ €
-
**‹ ›
(
**ﬁ ﬂ
decimal
**ﬂ Ê
)
**Ê Á
m
**Á Ë
.
**Ë È
Where
**È Ó
(
**Ó Ô
dt
**Ô Ò
=>
**Ú Ù=
/idsTiposDeTransaccionMovimientoDeBienes_Salidas
**ı §
.
**§ •
Contains
**• ≠
(
**≠ Æ
dt
**Æ ∞
.
**∞ ±
Transaccion
**± º
.
**º Ω!
id_tipo_transaccion
**Ω –
)
**– —
)
**— “
.
**“ ”
Select
**” Ÿ
(
**Ÿ ⁄
dt
**⁄ ‹
=>
**› ﬂ
dt
**‡ ‚
.
**‚ „!
cantidad_secundaria
**„ ˆ
)
**ˆ ˜
.
**˜ ¯
DefaultIfEmpty
**¯ Ü
(
**Ü á
$num
**á à
)
**à â
.
**â ä
Sum
**ä ç
(
**ç é
)
**é è
}++ 
)++ 
;++ 
return,, 
saldos,, 
;,, 
}-- 
catch.. 
(.. 
	Exception.. 
e.. 
).. 
{// 
throw00 
e00 
;00 
}11 
}22 	
public33 
IEnumerable33 
<33 
InventarioFisico33 +
>33+ ,1
%ObtenerSaldosDeMovimientosPorConcepto33- R
(33R S
int33S V
[33V W
]33W X
idsConceptos33Y e
,33e f
int33g j
[33j k
]33k l
idsAlmacenes33m y
)33y z
{44 	
try55 
{66 
SigescomEntities77  
_db77! $
=77% &
new77' *
SigescomEntities77+ ;
(77; <
)77< =
;77= >
int99 
[99 
]99 <
0idsTiposDeTransaccionMovimientoDeBienes_Entradas99 F
=99G H
Diccionario99I T
.99T U:
-TiposDeTransaccionMovimientoDeBienes_Entradas	99U Ç
;
99Ç É
int:: 
[:: 
]:: ;
/idsTiposDeTransaccionMovimientoDeBienes_Salidas:: E
=::F G
Diccionario::H S
.::S T9
,TiposDeTransaccionMovimientoDeBienes_Salidas	::T Ä
;
::Ä Å
int;; 
[;; 
];; 0
$idsTiposTransaccionMovimientoAlmacen;; :
=;;; <<
0idsTiposDeTransaccionMovimientoDeBienes_Entradas;;= m
.;;m n
Union;;n s
(;;s t<
/idsTiposDeTransaccionMovimientoDeBienes_Salidas	;;t £
)
;;£ §
.
;;§ •
ToArray
;;• ¨
(
;;¨ ≠
)
;;≠ Æ
;
;;Æ Ø
var<< 
saldos<< 
=<< 
_db<<  
.<<  !
Transaccion<<! ,
.== 
Where== 
(== 
t== 
=>== 
idsAlmacenes==  ,
.==, -
Contains==- 5
(==5 6
t==6 7
.==7 8$
id_actor_negocio_interno==8 P
)==P Q
&&==R T0
$idsTiposTransaccionMovimientoAlmacen==U y
.==y z
Contains	==z Ç
(
==Ç É
t
==É Ñ
.
==Ñ Ö!
id_tipo_transaccion
==Ö ò
)
==ò ô
)>> 
.?? 

SelectMany?? 
(?? 
t?? 
=>??  
t??! "
.??" #
Detalle_transaccion??# 6
)??6 7
.??7 8
Where??8 =
(??= >
dt??> @
=>??A C
idsConceptos??D P
.??P Q
Contains??Q Y
(??Y Z
dt??Z \
.??\ ]
id_concepto_negocio??] p
)??p q
)??q r
.??r s
GroupBy@@ 
(@@ 
dt@@ 
=>@@ 
new@@ !
{AA 
	IdAlmacenBB 
=BB 
dtBB  "
.BB" #
TransaccionBB# .
.BB. /$
id_actor_negocio_internoBB/ G
,BBG H
IdConceptoNegocioCC %
=CC& '
dtCC( *
.CC* +
id_concepto_negocioCC+ >
,CC> ?
}DD 
)DD 
.DD 
SelectDD 
(DD 
mDD 
=>DD 
newDD "
InventarioFisicoDD# 3
(DD3 4
)DD4 5
{EE 
	IdAlmacenFF 
=FF 
mFF  !
.FF! "
KeyFF" %
.FF% &
	IdAlmacenFF& /
,FF/ 0

IdConceptoGG 
=GG  
mGG! "
.GG" #
KeyGG# &
.GG& '
IdConceptoNegocioGG' 8
,GG8 9
CantidadHH 
=HH 
mHH  
.HH  !
WhereHH! &
(HH& '
dtHH' )
=>HH* ,<
0idsTiposDeTransaccionMovimientoDeBienes_EntradasHH- ]
.HH] ^
ContainsHH^ f
(HHf g
dtHHg i
.HHi j
TransaccionHHj u
.HHu v 
id_tipo_transaccion	HHv â
)
HHâ ä
)
HHä ã
.
HHã å
Select
HHå í
(
HHí ì
dt
HHì ï
=>
HHñ ò
dt
HHô õ
.
HHõ ú
cantidad
HHú §
)
HH§ •
.
HH• ¶
DefaultIfEmpty
HH¶ ¥
(
HH¥ µ
$num
HHµ ∂
)
HH∂ ∑
.
HH∑ ∏
Sum
HH∏ ª
(
HHª º
)
HHº Ω
-
HHæ ø
m
HH¿ ¡
.
HH¡ ¬
Where
HH¬ «
(
HH« »
dt
HH»  
=>
HHÀ Õ=
/idsTiposDeTransaccionMovimientoDeBienes_Salidas
HHŒ ˝
.
HH˝ ˛
Contains
HH˛ Ü
(
HHÜ á
dt
HHá â
.
HHâ ä
Transaccion
HHä ï
.
HHï ñ!
id_tipo_transaccion
HHñ ©
)
HH© ™
)
HH™ ´
.
HH´ ¨
Select
HH¨ ≤
(
HH≤ ≥
dt
HH≥ µ
=>
HH∂ ∏
dt
HHπ ª
.
HHª º
cantidad
HHº ƒ
)
HHƒ ≈
.
HH≈ ∆
DefaultIfEmpty
HH∆ ‘
(
HH‘ ’
$num
HH’ ÷
)
HH÷ ◊
.
HH◊ ÿ
Sum
HHÿ €
(
HH€ ‹
)
HH‹ ›
,
HH› ﬁ
CantidadSecundariaII &
=II' (
(II) *
decimalII* 1
)II1 2
mII2 3
.II3 4
WhereII4 9
(II9 :
dtII: <
=>II= ?<
0idsTiposDeTransaccionMovimientoDeBienes_EntradasII@ p
.IIp q
ContainsIIq y
(IIy z
dtIIz |
.II| }
Transaccion	II} à
.
IIà â!
id_tipo_transaccion
IIâ ú
)
IIú ù
)
IIù û
.
IIû ü
Select
IIü •
(
II• ¶
dt
II¶ ®
=>
II© ´
dt
II¨ Æ
.
IIÆ Ø!
cantidad_secundaria
IIØ ¬
)
II¬ √
.
II√ ƒ
DefaultIfEmpty
IIƒ “
(
II“ ”
$num
II” ‘
)
II‘ ’
.
II’ ÷
Sum
II÷ Ÿ
(
IIŸ ⁄
)
II⁄ €
-
II‹ ›
(
IIﬁ ﬂ
decimal
IIﬂ Ê
)
IIÊ Á
m
IIÁ Ë
.
IIË È
Where
IIÈ Ó
(
IIÓ Ô
dt
IIÔ Ò
=>
IIÚ Ù=
/idsTiposDeTransaccionMovimientoDeBienes_Salidas
IIı §
.
II§ •
Contains
II• ≠
(
II≠ Æ
dt
IIÆ ∞
.
II∞ ±
Transaccion
II± º
.
IIº Ω!
id_tipo_transaccion
IIΩ –
)
II– —
)
II— “
.
II“ ”
Select
II” Ÿ
(
IIŸ ⁄
dt
II⁄ ‹
=>
II› ﬂ
dt
II‡ ‚
.
II‚ „!
cantidad_secundaria
II„ ˆ
)
IIˆ ˜
.
II˜ ¯
DefaultIfEmpty
II¯ Ü
(
IIÜ á
$num
IIá à
)
IIà â
.
IIâ ä
Sum
IIä ç
(
IIç é
)
IIé è
}JJ 
)JJ 
;JJ 
returnKK 
saldosKK 
.KK 
ToListKK $
(KK$ %
)KK% &
;KK& '
}LL 
catchMM 
(MM 
	ExceptionMM 
eMM 
)MM 
{NN 
throwOO 
eOO 
;OO 
}PP 
}QQ 	
publicRR 
IEnumerableRR 
<RR >
2Movimientos_concepto_negocio_actor_negocio_internoRR M
>RRM N4
(ObtenerMovimientosDeConceptoNegocioYLoteRRO w
(RRw x
intRRx {
	idAlmacen	RR| Ö
,
RRÖ Ü
DateTime
RRá è

fechaDesde
RRê ö
,
RRö õ
DateTime
RRú §

fechaHasta
RR• Ø
)
RRØ ∞
{SS 	
tryTT 
{UU 
SigescomEntitiesVV  
_dbVV! $
=VV% &
newVV' *
SigescomEntitiesVV+ ;
(VV; <
)VV< =
;VV= >
intXX 
[XX 
]XX <
0idsTiposDeTransaccionMovimientoDeBienes_EntradasXX F
=XXG H
DiccionarioXXI T
.XXT U:
-TiposDeTransaccionMovimientoDeBienes_Entradas	XXU Ç
;
XXÇ É
intYY 
[YY 
]YY ;
/idsTiposDeTransaccionMovimientoDeBienes_SalidasYY E
=YYF G
DiccionarioYYH S
.YYS T9
,TiposDeTransaccionMovimientoDeBienes_Salidas	YYT Ä
;
YYÄ Å
intZZ 
[ZZ 
]ZZ 0
$idsTiposTransaccionMovimientoAlmacenZZ :
=ZZ; <<
0idsTiposDeTransaccionMovimientoDeBienes_EntradasZZ= m
.ZZm n
UnionZZn s
(ZZs t<
/idsTiposDeTransaccionMovimientoDeBienes_Salidas	ZZt £
)
ZZ£ §
.
ZZ§ •
ToArray
ZZ• ¨
(
ZZ¨ ≠
)
ZZ≠ Æ
;
ZZÆ Ø
var[[ 
movimientos[[ 
=[[  !
_db[[" %
.[[% &
Transaccion[[& 1
.\\ 
Where\\ 
(\\ 
t\\ 
=>\\ 
t\\  !
.\\! "
fecha_inicio\\" .
>=\\/ 1

fechaDesde\\2 <
&&]] 
t]] 
.]] 
fecha_inicio]] %
<=]]& (

fechaHasta]]) 3
&&^^ 
t^^ 
.^^ $
id_actor_negocio_interno^^ 1
==^^2 4
	idAlmacen^^5 >
&&__ 0
$idsTiposTransaccionMovimientoAlmacen__ ;
.__; <
Contains__< D
(__D E
t__E F
.__F G
id_tipo_transaccion__G Z
)__Z [
&&`` 
t`` 
.`` 
id_estado_actual`` )
==``* ,
MaestroSettings``- <
.``< =
Default``= D
.``D E,
 IdDetalleMaestroEstadoConfirmado``E e
)``e f
.aa 

SelectManyaa 
(aa 
taa 
=>aa  
taa! "
.aa" #
Detalle_transaccionaa# 6
)aa6 7
.aa7 8
GroupByaa8 ?
(aa? @
dtaa@ B
=>aaC E
newaaF I
{bb 
IdEntidadInternacc $
=cc% &
dtcc' )
.cc) *
Transaccioncc* 5
.cc5 6$
id_actor_negocio_internocc6 N
,ccN O
IdConceptoNegociodd %
=dd& '
dtdd( *
.dd* +
id_concepto_negociodd+ >
,dd> ?
Loteee 
=ee 
dtee 
.ee 
loteee "
}ff 
)ff 
.ff 
Selectff 
(ff 
mff 
=>ff 
newff ">
2Movimientos_concepto_negocio_actor_negocio_internoff# U
(ffU V
)ffV W
{gg 
Id_entidad_internahh &
=hh' (
mhh) *
.hh* +
Keyhh+ .
.hh. /
IdEntidadInternahh/ ?
,hh? @
Loteii 
=ii 
mii 
.ii 
Keyii  
.ii  !
Loteii! %
,ii% &
Id_concepto_negociojj '
=jj( )
mjj* +
.jj+ ,
Keyjj, /
.jj/ 0
IdConceptoNegociojj0 A
,jjA B
Entradas_principalkk &
=kk' (
mkk) *
.kk* +
Wherekk+ 0
(kk0 1
dtkk1 3
=>kk4 6<
0idsTiposDeTransaccionMovimientoDeBienes_Entradaskk7 g
.kkg h
Containskkh p
(kkp q
dtkkq s
.kks t
Transaccionkkt 
.	kk Ä!
id_tipo_transaccion
kkÄ ì
)
kkì î
)
kkî ï
.
kkï ñ
Select
kkñ ú
(
kkú ù
dt
kkù ü
=>
kk† ¢
dt
kk£ •
.
kk• ¶
cantidad
kk¶ Æ
)
kkÆ Ø
.
kkØ ∞
DefaultIfEmpty
kk∞ æ
(
kkæ ø
$num
kkø ¿
)
kk¿ ¡
.
kk¡ ¬
Sum
kk¬ ≈
(
kk≈ ∆
)
kk∆ «
,
kk« »
Salidas_principalll %
=ll& '
mll( )
.ll) *
Wherell* /
(ll/ 0
dtll0 2
=>ll3 5;
/idsTiposDeTransaccionMovimientoDeBienes_Salidasll6 e
.lle f
Containsllf n
(lln o
dtllo q
.llq r
Transaccionllr }
.ll} ~ 
id_tipo_transaccion	ll~ ë
)
llë í
)
llí ì
.
llì î
Select
llî ö
(
llö õ
dt
llõ ù
=>
llû †
dt
ll° £
.
ll£ §
cantidad
ll§ ¨
)
ll¨ ≠
.
ll≠ Æ
DefaultIfEmpty
llÆ º
(
llº Ω
$num
llΩ æ
)
llæ ø
.
llø ¿
Sum
ll¿ √
(
ll√ ƒ
)
llƒ ≈
,
ll≈ ∆
Entradas_secundariamm '
=mm( )
(mm* +
decimalmm+ 2
)mm2 3
mmm3 4
.mm4 5
Wheremm5 :
(mm: ;
dtmm; =
=>mm> @<
0idsTiposDeTransaccionMovimientoDeBienes_EntradasmmA q
.mmq r
Containsmmr z
(mmz {
dtmm{ }
.mm} ~
Transaccion	mm~ â
.
mmâ ä!
id_tipo_transaccion
mmä ù
)
mmù û
)
mmû ü
.
mmü †
Select
mm† ¶
(
mm¶ ß
dt
mmß ©
=>
mm™ ¨
dt
mm≠ Ø
.
mmØ ∞!
cantidad_secundaria
mm∞ √
)
mm√ ƒ
.
mmƒ ≈
DefaultIfEmpty
mm≈ ”
(
mm” ‘
$num
mm‘ ’
)
mm’ ÷
.
mm÷ ◊
Sum
mm◊ ⁄
(
mm⁄ €
)
mm€ ‹
,
mm‹ ›
Salidas_secundariann &
=nn' (
(nn) *
decimalnn* 1
)nn1 2
mnn2 3
.nn3 4
Wherenn4 9
(nn9 :
dtnn: <
=>nn= ?;
/idsTiposDeTransaccionMovimientoDeBienes_Salidasnn@ o
.nno p
Containsnnp x
(nnx y
dtnny {
.nn{ |
Transaccion	nn| á
.
nná à!
id_tipo_transaccion
nnà õ
)
nnõ ú
)
nnú ù
.
nnù û
Select
nnû §
(
nn§ •
dt
nn• ß
=>
nn® ™
dt
nn´ ≠
.
nn≠ Æ!
cantidad_secundaria
nnÆ ¡
)
nn¡ ¬
.
nn¬ √
DefaultIfEmpty
nn√ —
(
nn— “
$num
nn“ ”
)
nn” ‘
.
nn‘ ’
Sum
nn’ ÿ
(
nnÿ Ÿ
)
nnŸ ⁄
,
nn⁄ €
Totaloo 
=oo 
moo 
.oo 
Whereoo #
(oo# $
dtoo$ &
=>oo' )<
0idsTiposDeTransaccionMovimientoDeBienes_Entradasoo* Z
.ooZ [
Containsoo[ c
(ooc d
dtood f
.oof g
Transaccionoog r
.oor s 
id_tipo_transaccion	oos Ü
)
ooÜ á
)
ooá à
.
ooà â
Select
ooâ è
(
ooè ê
dt
ooê í
=>
ooì ï
dt
ooñ ò
.
ooò ô
total
ooô û
)
ooû ü
.
ooü †
DefaultIfEmpty
oo† Æ
(
ooÆ Ø
$num
ooØ ∞
)
oo∞ ±
.
oo± ≤
Sum
oo≤ µ
(
ooµ ∂
)
oo∂ ∑
-
oo∏ π
m
oo∫ ª
.
ooª º
Where
ooº ¡
(
oo¡ ¬
dt
oo¬ ƒ
=>
oo≈ «=
/idsTiposDeTransaccionMovimientoDeBienes_Salidas
oo» ˜
.
oo˜ ¯
Contains
oo¯ Ä
(
ooÄ Å
dt
ooÅ É
.
ooÉ Ñ
Transaccion
ooÑ è
.
ooè ê!
id_tipo_transaccion
ooê £
)
oo£ §
)
oo§ •
.
oo• ¶
Select
oo¶ ¨
(
oo¨ ≠
dt
oo≠ Ø
=>
oo∞ ≤
dt
oo≥ µ
.
ooµ ∂
total
oo∂ ª
)
ooª º
.
ooº Ω
DefaultIfEmpty
ooΩ À
(
ooÀ Ã
$num
ooÃ Õ
)
ooÕ Œ
.
ooŒ œ
Sum
ooœ “
(
oo“ ”
)
oo” ‘
}pp 
)pp 
;pp 
returnqq 
movimientosqq "
;qq" #
}rr 
catchss 
(ss 
	Exceptionss 
ess 
)ss 
{tt 
throwuu 
euu 
;uu 
}vv 
}ww 	
publicyy 
IEnumerableyy 
<yy >
2Movimientos_concepto_negocio_actor_negocio_internoyy M
>yyM N/
#ObtenerMovimientosDeConceptoNegocioyyO r
(yyr s
intyys v
	idAlmacen	yyw Ä
,
yyÄ Å
DateTime
yyÇ ä

fechaDesde
yyã ï
,
yyï ñ
DateTime
yyó ü

fechaHasta
yy† ™
)
yy™ ´
{zz 	
try{{ 
{|| 
SigescomEntities}}  
_db}}! $
=}}% &
new}}' *
SigescomEntities}}+ ;
(}}; <
)}}< =
;}}= >
int 
[ 
] <
0idsTiposDeTransaccionMovimientoDeBienes_Entradas F
=G H
DiccionarioI T
.T U:
-TiposDeTransaccionMovimientoDeBienes_Entradas	U Ç
;
Ç É
int
ÄÄ 
[
ÄÄ 
]
ÄÄ =
/idsTiposDeTransaccionMovimientoDeBienes_Salidas
ÄÄ E
=
ÄÄF G
Diccionario
ÄÄH S
.
ÄÄS T;
,TiposDeTransaccionMovimientoDeBienes_SalidasÄÄT Ä
;ÄÄÄ Å
int
ÅÅ 
[
ÅÅ 
]
ÅÅ 2
$idsTiposTransaccionMovimientoAlmacen
ÅÅ :
=
ÅÅ; <>
0idsTiposDeTransaccionMovimientoDeBienes_Entradas
ÅÅ= m
.
ÅÅm n
Union
ÅÅn s
(
ÅÅs t>
/idsTiposDeTransaccionMovimientoDeBienes_SalidasÅÅt £
)ÅÅ£ §
.ÅÅ§ •
ToArrayÅÅ• ¨
(ÅÅ¨ ≠
)ÅÅ≠ Æ
;ÅÅÆ Ø
var
ÇÇ 
movimientos
ÇÇ 
=
ÇÇ  !
_db
ÇÇ" %
.
ÇÇ% &
Transaccion
ÇÇ& 1
.
ÉÉ 
Where
ÉÉ 
(
ÉÉ 
t
ÉÉ 
=>
ÉÉ 
t
ÉÉ  !
.
ÉÉ! "
fecha_inicio
ÉÉ" .
>=
ÉÉ/ 1

fechaDesde
ÉÉ2 <
&&
ÑÑ 
t
ÑÑ 
.
ÑÑ 
fecha_inicio
ÑÑ %
<=
ÑÑ& (

fechaHasta
ÑÑ) 3
&&
ÖÖ 
t
ÖÖ 
.
ÖÖ &
id_actor_negocio_interno
ÖÖ 1
==
ÖÖ2 4
	idAlmacen
ÖÖ5 >
&&
ÜÜ 2
$idsTiposTransaccionMovimientoAlmacen
ÜÜ ;
.
ÜÜ; <
Contains
ÜÜ< D
(
ÜÜD E
t
ÜÜE F
.
ÜÜF G!
id_tipo_transaccion
ÜÜG Z
)
ÜÜZ [
&&
áá 
t
áá 
.
áá 
id_estado_actual
áá )
==
áá* ,
MaestroSettings
áá- <
.
áá< =
Default
áá= D
.
ááD E.
 IdDetalleMaestroEstadoConfirmado
ááE e
)
ááe f
.
àà 

SelectMany
àà 
(
àà  
t
àà  !
=>
àà" $
t
àà% &
.
àà& '!
Detalle_transaccion
àà' :
)
àà: ;
.
àà; <
GroupBy
àà< C
(
ààC D
dt
ààD F
=>
ààG I
new
ààJ M
{
ââ 
IdEntidadInterna
ää (
=
ää) *
dt
ää+ -
.
ää- .
Transaccion
ää. 9
.
ää9 :&
id_actor_negocio_interno
ää: R
,
ääR S
IdConceptoNegocio
ãã )
=
ãã* +
dt
ãã, .
.
ãã. /!
id_concepto_negocio
ãã/ B
,
ããB C
}
åå 
)
åå 
.
åå 
Select
åå 
(
åå 
m
åå 
=>
åå  "
new
åå# &@
2Movimientos_concepto_negocio_actor_negocio_interno
åå' Y
(
ååY Z
)
ååZ [
{
çç  
Id_entidad_interna
éé *
=
éé+ ,
m
éé- .
.
éé. /
Key
éé/ 2
.
éé2 3
IdEntidadInterna
éé3 C
,
ééC D
Lote
èè 
=
èè 
null
èè #
,
èè# $!
Id_concepto_negocio
êê +
=
êê, -
m
êê. /
.
êê/ 0
Key
êê0 3
.
êê3 4
IdConceptoNegocio
êê4 E
,
êêE F 
Entradas_principal
ëë *
=
ëë+ ,
m
ëë- .
.
ëë. /
Where
ëë/ 4
(
ëë4 5
dt
ëë5 7
=>
ëë8 :>
0idsTiposDeTransaccionMovimientoDeBienes_Entradas
ëë; k
.
ëëk l
Contains
ëël t
(
ëët u
dt
ëëu w
.
ëëw x
Transaccionëëx É
.ëëÉ Ñ#
id_tipo_transaccionëëÑ ó
)ëëó ò
)ëëò ô
.ëëô ö
Selectëëö †
(ëë† °
dtëë° £
=>ëë§ ¶
dtëëß ©
.ëë© ™
cantidadëë™ ≤
)ëë≤ ≥
.ëë≥ ¥
DefaultIfEmptyëë¥ ¬
(ëë¬ √
$numëë√ ƒ
)ëëƒ ≈
.ëë≈ ∆
Sumëë∆ …
(ëë…  
)ëë  À
,ëëÀ Ã
Salidas_principal
íí )
=
íí* +
m
íí, -
.
íí- .
Where
íí. 3
(
íí3 4
dt
íí4 6
=>
íí7 9=
/idsTiposDeTransaccionMovimientoDeBienes_Salidas
íí: i
.
ííi j
Contains
ííj r
(
íír s
dt
íís u
.
ííu v
Transaccioníív Å
.ííÅ Ç#
id_tipo_transaccionííÇ ï
)ííï ñ
)ííñ ó
.ííó ò
Selectííò û
(ííû ü
dtííü °
=>íí¢ §
dtíí• ß
.ííß ®
cantidadíí® ∞
)íí∞ ±
.íí± ≤
DefaultIfEmptyíí≤ ¿
(íí¿ ¡
$numíí¡ ¬
)íí¬ √
.íí√ ƒ
Sumííƒ «
(íí« »
)íí» …
,íí…  !
Entradas_secundaria
ìì +
=
ìì, -
(
ìì. /
decimal
ìì/ 6
)
ìì6 7
m
ìì7 8
.
ìì8 9
Where
ìì9 >
(
ìì> ?
dt
ìì? A
=>
ììB D>
0idsTiposDeTransaccionMovimientoDeBienes_Entradas
ììE u
.
ììu v
Contains
ììv ~
(
ìì~ 
dtìì Å
.ììÅ Ç
TransaccionììÇ ç
.ììç é#
id_tipo_transaccionììé °
)ìì° ¢
)ìì¢ £
.ìì£ §
Selectìì§ ™
(ìì™ ´
dtìì´ ≠
=>ììÆ ∞
dtìì± ≥
.ìì≥ ¥#
cantidad_secundariaìì¥ «
)ìì« »
.ìì» …
DefaultIfEmptyìì… ◊
(ìì◊ ÿ
$numììÿ Ÿ
)ììŸ ⁄
.ìì⁄ €
Sumìì€ ﬁ
(ììﬁ ﬂ
)ììﬂ ‡
,ìì‡ · 
Salidas_secundaria
îî *
=
îî+ ,
(
îî- .
decimal
îî. 5
)
îî5 6
m
îî6 7
.
îî7 8
Where
îî8 =
(
îî= >
dt
îî> @
=>
îîA C=
/idsTiposDeTransaccionMovimientoDeBienes_Salidas
îîD s
.
îîs t
Contains
îît |
(
îî| }
dt
îî} 
.îî Ä
TransaccionîîÄ ã
.îîã å#
id_tipo_transaccionîîå ü
)îîü †
)îî† °
.îî° ¢
Selectîî¢ ®
(îî® ©
dtîî© ´
=>îî¨ Æ
dtîîØ ±
.îî± ≤#
cantidad_secundariaîî≤ ≈
)îî≈ ∆
.îî∆ «
DefaultIfEmptyîî« ’
(îî’ ÷
$numîî÷ ◊
)îî◊ ÿ
.îîÿ Ÿ
SumîîŸ ‹
(îî‹ ›
)îî› ﬁ
,îîﬁ ﬂ
Total
ïï 
=
ïï 
m
ïï  !
.
ïï! "
Where
ïï" '
(
ïï' (
dt
ïï( *
=>
ïï+ ->
0idsTiposDeTransaccionMovimientoDeBienes_Entradas
ïï. ^
.
ïï^ _
Contains
ïï_ g
(
ïïg h
dt
ïïh j
.
ïïj k
Transaccion
ïïk v
.
ïïv w"
id_tipo_transaccionïïw ä
)ïïä ã
)ïïã å
.ïïå ç
Selectïïç ì
(ïïì î
dtïïî ñ
=>ïïó ô
dtïïö ú
.ïïú ù
totalïïù ¢
)ïï¢ £
.ïï£ §
DefaultIfEmptyïï§ ≤
(ïï≤ ≥
$numïï≥ ¥
)ïï¥ µ
.ïïµ ∂
Sumïï∂ π
(ïïπ ∫
)ïï∫ ª
-ïïº Ω
mïïæ ø
.ïïø ¿
Whereïï¿ ≈
(ïï≈ ∆
dtïï∆ »
=>ïï… À?
/idsTiposDeTransaccionMovimientoDeBienes_SalidasïïÃ ˚
.ïï˚ ¸
Containsïï¸ Ñ
(ïïÑ Ö
dtïïÖ á
.ïïá à
Transaccionïïà ì
.ïïì î#
id_tipo_transaccionïïî ß
)ïïß ®
)ïï® ©
.ïï© ™
Selectïï™ ∞
(ïï∞ ±
dtïï± ≥
=>ïï¥ ∂
dtïï∑ π
.ïïπ ∫
totalïï∫ ø
)ïïø ¿
.ïï¿ ¡
DefaultIfEmptyïï¡ œ
(ïïœ –
$numïï– —
)ïï— “
.ïï“ ”
Sumïï” ÷
(ïï÷ ◊
)ïï◊ ÿ
}
ññ 
)
ññ 
;
ññ 
return
óó 
movimientos
óó "
;
óó" #
}
òò 
catch
ôô 
(
ôô 
	Exception
ôô 
e
ôô 
)
ôô 
{
öö 
throw
õõ 
e
õõ 
;
õõ 
}
úú 
}
ùù 	
public
üü 
IEnumerable
üü 
<
üü @
2Movimientos_concepto_negocio_actor_negocio_interno
üü M
>
üüM N6
(ObtenerMovimientosDeConceptoNegocioYLote
üüO w
(
üüw x
int
üüx {$
idActorNegocioInternoüü| ë
,üüë í
DateTimeüüì õ

fechaDesdeüüú ¶
,üü¶ ß
DateTimeüü® ∞

fechaHastaüü± ª
,üüª º
intüüΩ ¿
[üü¿ ¡
]üü¡ ¬
familiasüü√ À
)üüÀ Ã
{
†† 	
try
°° 
{
¢¢ 
SigescomEntities
££  
_db
££! $
=
££% &
new
££' *
SigescomEntities
££+ ;
(
££; <
)
££< =
;
££= >
int
•• 
[
•• 
]
•• >
0idsTiposDeTransaccionMovimientoDeBienes_Entradas
•• F
=
••G H
Diccionario
••I T
.
••T U<
-TiposDeTransaccionMovimientoDeBienes_Entradas••U Ç
;••Ç É
int
¶¶ 
[
¶¶ 
]
¶¶ =
/idsTiposDeTransaccionMovimientoDeBienes_Salidas
¶¶ E
=
¶¶F G
Diccionario
¶¶H S
.
¶¶S T;
,TiposDeTransaccionMovimientoDeBienes_Salidas¶¶T Ä
;¶¶Ä Å
int
ßß 
[
ßß 
]
ßß 2
$idsTiposTransaccionMovimientoAlmacen
ßß :
=
ßß; <>
0idsTiposDeTransaccionMovimientoDeBienes_Entradas
ßß= m
.
ßßm n
Union
ßßn s
(
ßßs t>
/idsTiposDeTransaccionMovimientoDeBienes_Salidasßßt £
)ßß£ §
.ßß§ •
ToArrayßß• ¨
(ßß¨ ≠
)ßß≠ Æ
;ßßÆ Ø
var
®® 
movimientos
®® 
=
®®  !
_db
®®" %
.
®®% &
Transaccion
®®& 1
.
©© 
Where
©© 
(
©© 
t
©© 
=>
©© 
t
©©  !
.
©©! "
fecha_inicio
©©" .
>=
©©/ 1

fechaDesde
©©2 <
&&
™™ 
t
™™ 
.
™™ 
fecha_inicio
™™ %
<=
™™& (

fechaHasta
™™) 3
&&
´´ 
t
´´ 
.
´´ &
id_actor_negocio_interno
´´ 1
==
´´2 4#
idActorNegocioInterno
´´5 J
&&
¨¨ 2
$idsTiposTransaccionMovimientoAlmacen
¨¨ ;
.
¨¨; <
Contains
¨¨< D
(
¨¨D E
t
¨¨E F
.
¨¨F G!
id_tipo_transaccion
¨¨G Z
)
¨¨Z [
&&
≠≠ 
t
≠≠ 
.
≠≠ 
id_estado_actual
≠≠ )
==
≠≠* ,
MaestroSettings
≠≠- <
.
≠≠< =
Default
≠≠= D
.
≠≠D E.
 IdDetalleMaestroEstadoConfirmado
≠≠E e
)
≠≠e f
.
ÆÆ 

SelectMany
ÆÆ 
(
ÆÆ  
t
ÆÆ  !
=>
ÆÆ" $
t
ÆÆ% &
.
ÆÆ& '!
Detalle_transaccion
ÆÆ' :
.
ÆÆ: ;
Where
ÆÆ; @
(
ÆÆ@ A
dt
ÆÆA C
=>
ÆÆD F
familias
ÆÆG O
.
ÆÆO P
Contains
ÆÆP X
(
ÆÆX Y
dt
ÆÆY [
.
ÆÆ[ \
Concepto_negocio
ÆÆ\ l
.
ÆÆl m 
id_concepto_basico
ÆÆm 
)ÆÆ Ä
)ÆÆÄ Å
)ÆÆÅ Ç
.
ØØ 
GroupBy
ØØ 
(
ØØ 
dt
ØØ 
=>
ØØ  "
new
ØØ# &
{
∞∞ 
IdEntidadInterna
±± (
=
±±) *
dt
±±+ -
.
±±- .
Transaccion
±±. 9
.
±±9 :&
id_actor_negocio_interno
±±: R
,
±±R S
IdConceptoNegocio
≤≤ )
=
≤≤* +
dt
≤≤, .
.
≤≤. /!
id_concepto_negocio
≤≤/ B
,
≤≤B C
Lote
≥≥ 
=
≥≥ 
dt
≥≥ !
.
≥≥! "
lote
≥≥" &
}
¥¥ 
)
¥¥ 
.
¥¥ 
Select
¥¥ 
(
¥¥ 
m
¥¥ 
=>
¥¥  "
new
¥¥# &@
2Movimientos_concepto_negocio_actor_negocio_interno
¥¥' Y
(
¥¥Y Z
)
¥¥Z [
{
µµ  
Id_entidad_interna
∂∂ *
=
∂∂+ ,
m
∂∂- .
.
∂∂. /
Key
∂∂/ 2
.
∂∂2 3
IdEntidadInterna
∂∂3 C
,
∂∂C D
Lote
∑∑ 
=
∑∑ 
m
∑∑  
.
∑∑  !
Key
∑∑! $
.
∑∑$ %
Lote
∑∑% )
,
∑∑) *!
Id_concepto_negocio
∏∏ +
=
∏∏, -
m
∏∏. /
.
∏∏/ 0
Key
∏∏0 3
.
∏∏3 4
IdConceptoNegocio
∏∏4 E
,
∏∏E F 
Entradas_principal
ππ *
=
ππ+ ,
m
ππ- .
.
ππ. /
Where
ππ/ 4
(
ππ4 5
dt
ππ5 7
=>
ππ8 :>
0idsTiposDeTransaccionMovimientoDeBienes_Entradas
ππ; k
.
ππk l
Contains
ππl t
(
ππt u
dt
ππu w
.
ππw x
Transaccionππx É
.ππÉ Ñ#
id_tipo_transaccionππÑ ó
)ππó ò
)ππò ô
.ππô ö
Selectππö †
(ππ† °
dtππ° £
=>ππ§ ¶
dtππß ©
.ππ© ™
cantidadππ™ ≤
)ππ≤ ≥
.ππ≥ ¥
DefaultIfEmptyππ¥ ¬
(ππ¬ √
$numππ√ ƒ
)ππƒ ≈
.ππ≈ ∆
Sumππ∆ …
(ππ…  
)ππ  À
,ππÀ Ã
Salidas_principal
∫∫ )
=
∫∫* +
m
∫∫, -
.
∫∫- .
Where
∫∫. 3
(
∫∫3 4
dt
∫∫4 6
=>
∫∫7 9=
/idsTiposDeTransaccionMovimientoDeBienes_Salidas
∫∫: i
.
∫∫i j
Contains
∫∫j r
(
∫∫r s
dt
∫∫s u
.
∫∫u v
Transaccion∫∫v Å
.∫∫Å Ç#
id_tipo_transaccion∫∫Ç ï
)∫∫ï ñ
)∫∫ñ ó
.∫∫ó ò
Select∫∫ò û
(∫∫û ü
dt∫∫ü °
=>∫∫¢ §
dt∫∫• ß
.∫∫ß ®
cantidad∫∫® ∞
)∫∫∞ ±
.∫∫± ≤
DefaultIfEmpty∫∫≤ ¿
(∫∫¿ ¡
$num∫∫¡ ¬
)∫∫¬ √
.∫∫√ ƒ
Sum∫∫ƒ «
(∫∫« »
)∫∫» …
,∫∫…  !
Entradas_secundaria
ªª +
=
ªª, -
(
ªª. /
decimal
ªª/ 6
)
ªª6 7
m
ªª7 8
.
ªª8 9
Where
ªª9 >
(
ªª> ?
dt
ªª? A
=>
ªªB D>
0idsTiposDeTransaccionMovimientoDeBienes_Entradas
ªªE u
.
ªªu v
Contains
ªªv ~
(
ªª~ 
dtªª Å
.ªªÅ Ç
TransaccionªªÇ ç
.ªªç é#
id_tipo_transaccionªªé °
)ªª° ¢
)ªª¢ £
.ªª£ §
Selectªª§ ™
(ªª™ ´
dtªª´ ≠
=>ªªÆ ∞
dtªª± ≥
.ªª≥ ¥#
cantidad_secundariaªª¥ «
)ªª« »
.ªª» …
DefaultIfEmptyªª… ◊
(ªª◊ ÿ
$numªªÿ Ÿ
)ªªŸ ⁄
.ªª⁄ €
Sumªª€ ﬁ
(ªªﬁ ﬂ
)ªªﬂ ‡
,ªª‡ · 
Salidas_secundaria
ºº *
=
ºº+ ,
(
ºº- .
decimal
ºº. 5
)
ºº5 6
m
ºº6 7
.
ºº7 8
Where
ºº8 =
(
ºº= >
dt
ºº> @
=>
ººA C=
/idsTiposDeTransaccionMovimientoDeBienes_Salidas
ººD s
.
ººs t
Contains
ººt |
(
ºº| }
dt
ºº} 
.ºº Ä
TransaccionººÄ ã
.ººã å#
id_tipo_transaccionººå ü
)ººü †
)ºº† °
.ºº° ¢
Selectºº¢ ®
(ºº® ©
dtºº© ´
=>ºº¨ Æ
dtººØ ±
.ºº± ≤#
cantidad_secundariaºº≤ ≈
)ºº≈ ∆
.ºº∆ «
DefaultIfEmptyºº« ’
(ºº’ ÷
$numºº÷ ◊
)ºº◊ ÿ
.ººÿ Ÿ
SumººŸ ‹
(ºº‹ ›
)ºº› ﬁ
,ººﬁ ﬂ
Total
ΩΩ 
=
ΩΩ 
m
ΩΩ  !
.
ΩΩ! "
Where
ΩΩ" '
(
ΩΩ' (
dt
ΩΩ( *
=>
ΩΩ+ ->
0idsTiposDeTransaccionMovimientoDeBienes_Entradas
ΩΩ. ^
.
ΩΩ^ _
Contains
ΩΩ_ g
(
ΩΩg h
dt
ΩΩh j
.
ΩΩj k
Transaccion
ΩΩk v
.
ΩΩv w"
id_tipo_transaccionΩΩw ä
)ΩΩä ã
)ΩΩã å
.ΩΩå ç
SelectΩΩç ì
(ΩΩì î
dtΩΩî ñ
=>ΩΩó ô
dtΩΩö ú
.ΩΩú ù
totalΩΩù ¢
)ΩΩ¢ £
.ΩΩ£ §
DefaultIfEmptyΩΩ§ ≤
(ΩΩ≤ ≥
$numΩΩ≥ ¥
)ΩΩ¥ µ
.ΩΩµ ∂
SumΩΩ∂ π
(ΩΩπ ∫
)ΩΩ∫ ª
-ΩΩº Ω
mΩΩæ ø
.ΩΩø ¿
WhereΩΩ¿ ≈
(ΩΩ≈ ∆
dtΩΩ∆ »
=>ΩΩ… À?
/idsTiposDeTransaccionMovimientoDeBienes_SalidasΩΩÃ ˚
.ΩΩ˚ ¸
ContainsΩΩ¸ Ñ
(ΩΩÑ Ö
dtΩΩÖ á
.ΩΩá à
TransaccionΩΩà ì
.ΩΩì î#
id_tipo_transaccionΩΩî ß
)ΩΩß ®
)ΩΩ® ©
.ΩΩ© ™
SelectΩΩ™ ∞
(ΩΩ∞ ±
dtΩΩ± ≥
=>ΩΩ¥ ∂
dtΩΩ∑ π
.ΩΩπ ∫
totalΩΩ∫ ø
)ΩΩø ¿
.ΩΩ¿ ¡
DefaultIfEmptyΩΩ¡ œ
(ΩΩœ –
$numΩΩ– —
)ΩΩ— “
.ΩΩ“ ”
SumΩΩ” ÷
(ΩΩ÷ ◊
)ΩΩ◊ ÿ
}
ææ 
)
ææ 
;
ææ 
return
øø 
movimientos
øø "
;
øø" #
}
¿¿ 
catch
¡¡ 
(
¡¡ 
	Exception
¡¡ 
e
¡¡ 
)
¡¡ 
{
¬¬ 
throw
√√ 
e
√√ 
;
√√ 
}
ƒƒ 
}
≈≈ 	
public
«« 
IEnumerable
«« 
<
«« @
2Movimientos_concepto_negocio_actor_negocio_interno
«« M
>
««M N1
#ObtenerMovimientosDeConceptoNegocio
««O r
(
««r s
int
««s v
	idAlmacen««w Ä
,««Ä Å
DateTime««Ç ä

fechaDesde««ã ï
,««ï ñ
DateTime««ó ü

fechaHasta««† ™
,««™ ´
int««¨ Ø
[««Ø ∞
]««∞ ±
familias««≤ ∫
)««∫ ª
{
»» 	
try
…… 
{
   
SigescomEntities
ÀÀ  
_db
ÀÀ! $
=
ÀÀ% &
new
ÀÀ' *
SigescomEntities
ÀÀ+ ;
(
ÀÀ; <
)
ÀÀ< =
;
ÀÀ= >
int
ÕÕ 
[
ÕÕ 
]
ÕÕ >
0idsTiposDeTransaccionMovimientoDeBienes_Entradas
ÕÕ F
=
ÕÕG H
Diccionario
ÕÕI T
.
ÕÕT U<
-TiposDeTransaccionMovimientoDeBienes_EntradasÕÕU Ç
;ÕÕÇ É
int
ŒŒ 
[
ŒŒ 
]
ŒŒ =
/idsTiposDeTransaccionMovimientoDeBienes_Salidas
ŒŒ E
=
ŒŒF G
Diccionario
ŒŒH S
.
ŒŒS T;
,TiposDeTransaccionMovimientoDeBienes_SalidasŒŒT Ä
;ŒŒÄ Å
int
œœ 
[
œœ 
]
œœ 2
$idsTiposTransaccionMovimientoAlmacen
œœ :
=
œœ; <>
0idsTiposDeTransaccionMovimientoDeBienes_Entradas
œœ= m
.
œœm n
Union
œœn s
(
œœs t>
/idsTiposDeTransaccionMovimientoDeBienes_Salidasœœt £
)œœ£ §
.œœ§ •
ToArrayœœ• ¨
(œœ¨ ≠
)œœ≠ Æ
;œœÆ Ø
var
–– 
movimientos
–– 
=
––  !
_db
––" %
.
––% &
Transaccion
––& 1
.
—— 
Where
—— 
(
—— 
t
—— 
=>
—— 
t
——  !
.
——! "
fecha_inicio
——" .
>=
——/ 1

fechaDesde
——2 <
&&
““ 
t
““ 
.
““ 
fecha_inicio
““ &
<=
““' )

fechaHasta
““* 4
&&
”” 
t
”” 
.
”” &
id_actor_negocio_interno
”” 2
==
””3 5
	idAlmacen
””6 ?
&&
‘‘ 2
$idsTiposTransaccionMovimientoAlmacen
‘‘ <
.
‘‘< =
Contains
‘‘= E
(
‘‘E F
t
‘‘F G
.
‘‘G H!
id_tipo_transaccion
‘‘H [
)
‘‘[ \
&&
’’ 
t
’’ 
.
’’ 
id_estado_actual
’’ *
==
’’+ -
MaestroSettings
’’. =
.
’’= >
Default
’’> E
.
’’E F.
 IdDetalleMaestroEstadoConfirmado
’’F f
)
’’f g
.
÷÷ 

SelectMany
÷÷ 
(
÷÷ 
t
÷÷ 
=>
÷÷  
t
÷÷! "
.
÷÷" #!
Detalle_transaccion
÷÷# 6
.
÷÷6 7
Where
÷÷7 <
(
÷÷< =
dt
÷÷= ?
=>
÷÷@ B
familias
÷÷C K
.
÷÷K L
Contains
÷÷L T
(
÷÷T U
dt
÷÷U W
.
÷÷W X
Concepto_negocio
÷÷X h
.
÷÷h i 
id_concepto_basico
÷÷i {
)
÷÷{ |
)
÷÷| }
)
÷÷} ~
.
÷÷~ 
GroupBy
◊◊ 
(
◊◊ 
dt
◊◊ 
=>
◊◊ 
new
◊◊ !
{
ÿÿ 
IdEntidadInterna
ŸŸ $
=
ŸŸ% &
dt
ŸŸ' )
.
ŸŸ) *
Transaccion
ŸŸ* 5
.
ŸŸ5 6&
id_actor_negocio_interno
ŸŸ6 N
,
ŸŸN O
IdConceptoNegocio
⁄⁄ %
=
⁄⁄& '
dt
⁄⁄( *
.
⁄⁄* +!
id_concepto_negocio
⁄⁄+ >
,
⁄⁄> ?
}
€€ 
)
€€ 
.
€€ 
Select
€€ 
(
€€ 
m
€€ 
=>
€€ 
new
€€ "@
2Movimientos_concepto_negocio_actor_negocio_interno
€€# U
(
€€U V
)
€€V W
{
‹‹  
Id_entidad_interna
›› &
=
››' (
m
››) *
.
››* +
Key
››+ .
.
››. /
IdEntidadInterna
››/ ?
,
››? @
Lote
ﬁﬁ 
=
ﬁﬁ 
null
ﬁﬁ 
,
ﬁﬁ  !
Id_concepto_negocio
ﬂﬂ '
=
ﬂﬂ( )
m
ﬂﬂ* +
.
ﬂﬂ+ ,
Key
ﬂﬂ, /
.
ﬂﬂ/ 0
IdConceptoNegocio
ﬂﬂ0 A
,
ﬂﬂA B 
Entradas_principal
‡‡ &
=
‡‡' (
m
‡‡) *
.
‡‡* +
Where
‡‡+ 0
(
‡‡0 1
dt
‡‡1 3
=>
‡‡4 6>
0idsTiposDeTransaccionMovimientoDeBienes_Entradas
‡‡7 g
.
‡‡g h
Contains
‡‡h p
(
‡‡p q
dt
‡‡q s
.
‡‡s t
Transaccion
‡‡t 
.‡‡ Ä#
id_tipo_transaccion‡‡Ä ì
)‡‡ì î
)‡‡î ï
.‡‡ï ñ
Select‡‡ñ ú
(‡‡ú ù
dt‡‡ù ü
=>‡‡† ¢
dt‡‡£ •
.‡‡• ¶
cantidad‡‡¶ Æ
)‡‡Æ Ø
.‡‡Ø ∞
DefaultIfEmpty‡‡∞ æ
(‡‡æ ø
$num‡‡ø ¿
)‡‡¿ ¡
.‡‡¡ ¬
Sum‡‡¬ ≈
(‡‡≈ ∆
)‡‡∆ «
,‡‡« »
Salidas_principal
·· %
=
··& '
m
··( )
.
··) *
Where
··* /
(
··/ 0
dt
··0 2
=>
··3 5=
/idsTiposDeTransaccionMovimientoDeBienes_Salidas
··6 e
.
··e f
Contains
··f n
(
··n o
dt
··o q
.
··q r
Transaccion
··r }
.
··} ~"
id_tipo_transaccion··~ ë
)··ë í
)··í ì
.··ì î
Select··î ö
(··ö õ
dt··õ ù
=>··û †
dt··° £
.··£ §
cantidad··§ ¨
)··¨ ≠
.··≠ Æ
DefaultIfEmpty··Æ º
(··º Ω
$num··Ω æ
)··æ ø
.··ø ¿
Sum··¿ √
(··√ ƒ
)··ƒ ≈
,··≈ ∆!
Entradas_secundaria
‚‚ '
=
‚‚( )
(
‚‚* +
decimal
‚‚+ 2
)
‚‚2 3
m
‚‚3 4
.
‚‚4 5
Where
‚‚5 :
(
‚‚: ;
dt
‚‚; =
=>
‚‚> @>
0idsTiposDeTransaccionMovimientoDeBienes_Entradas
‚‚A q
.
‚‚q r
Contains
‚‚r z
(
‚‚z {
dt
‚‚{ }
.
‚‚} ~
Transaccion‚‚~ â
.‚‚â ä#
id_tipo_transaccion‚‚ä ù
)‚‚ù û
)‚‚û ü
.‚‚ü †
Select‚‚† ¶
(‚‚¶ ß
dt‚‚ß ©
=>‚‚™ ¨
dt‚‚≠ Ø
.‚‚Ø ∞#
cantidad_secundaria‚‚∞ √
)‚‚√ ƒ
.‚‚ƒ ≈
DefaultIfEmpty‚‚≈ ”
(‚‚” ‘
$num‚‚‘ ’
)‚‚’ ÷
.‚‚÷ ◊
Sum‚‚◊ ⁄
(‚‚⁄ €
)‚‚€ ‹
,‚‚‹ › 
Salidas_secundaria
„„ &
=
„„' (
(
„„) *
decimal
„„* 1
)
„„1 2
m
„„2 3
.
„„3 4
Where
„„4 9
(
„„9 :
dt
„„: <
=>
„„= ?=
/idsTiposDeTransaccionMovimientoDeBienes_Salidas
„„@ o
.
„„o p
Contains
„„p x
(
„„x y
dt
„„y {
.
„„{ |
Transaccion„„| á
.„„á à#
id_tipo_transaccion„„à õ
)„„õ ú
)„„ú ù
.„„ù û
Select„„û §
(„„§ •
dt„„• ß
=>„„® ™
dt„„´ ≠
.„„≠ Æ#
cantidad_secundaria„„Æ ¡
)„„¡ ¬
.„„¬ √
DefaultIfEmpty„„√ —
(„„— “
$num„„“ ”
)„„” ‘
.„„‘ ’
Sum„„’ ÿ
(„„ÿ Ÿ
)„„Ÿ ⁄
,„„⁄ €
Total
‰‰ 
=
‰‰ 
m
‰‰ 
.
‰‰ 
Where
‰‰ #
(
‰‰# $
dt
‰‰$ &
=>
‰‰' )>
0idsTiposDeTransaccionMovimientoDeBienes_Entradas
‰‰* Z
.
‰‰Z [
Contains
‰‰[ c
(
‰‰c d
dt
‰‰d f
.
‰‰f g
Transaccion
‰‰g r
.
‰‰r s"
id_tipo_transaccion‰‰s Ü
)‰‰Ü á
)‰‰á à
.‰‰à â
Select‰‰â è
(‰‰è ê
dt‰‰ê í
=>‰‰ì ï
dt‰‰ñ ò
.‰‰ò ô
total‰‰ô û
)‰‰û ü
.‰‰ü †
DefaultIfEmpty‰‰† Æ
(‰‰Æ Ø
$num‰‰Ø ∞
)‰‰∞ ±
.‰‰± ≤
Sum‰‰≤ µ
(‰‰µ ∂
)‰‰∂ ∑
-‰‰∏ π
m‰‰∫ ª
.‰‰ª º
Where‰‰º ¡
(‰‰¡ ¬
dt‰‰¬ ƒ
=>‰‰≈ «?
/idsTiposDeTransaccionMovimientoDeBienes_Salidas‰‰» ˜
.‰‰˜ ¯
Contains‰‰¯ Ä
(‰‰Ä Å
dt‰‰Å É
.‰‰É Ñ
Transaccion‰‰Ñ è
.‰‰è ê#
id_tipo_transaccion‰‰ê £
)‰‰£ §
)‰‰§ •
.‰‰• ¶
Select‰‰¶ ¨
(‰‰¨ ≠
dt‰‰≠ Ø
=>‰‰∞ ≤
dt‰‰≥ µ
.‰‰µ ∂
total‰‰∂ ª
)‰‰ª º
.‰‰º Ω
DefaultIfEmpty‰‰Ω À
(‰‰À Ã
$num‰‰Ã Õ
)‰‰Õ Œ
.‰‰Œ œ
Sum‰‰œ “
(‰‰“ ”
)‰‰” ‘
}
ÂÂ 
)
ÂÂ 
;
ÂÂ 
return
ÊÊ 
movimientos
ÊÊ "
;
ÊÊ" #
}
ÁÁ 
catch
ËË 
(
ËË 
	Exception
ËË 
e
ËË 
)
ËË 
{
ÈÈ 
throw
ÍÍ 
e
ÍÍ 
;
ÍÍ 
}
ÎÎ 
}
ÏÏ 	
public
ÌÌ 
IEnumerable
ÌÌ 
<
ÌÌ @
2Movimientos_concepto_negocio_actor_negocio_interno
ÌÌ M
>
ÌÌM N6
(ObtenerMovimientosDeConceptoNegocioYLote
ÌÌO w
(
ÌÌw x
int
ÌÌx {
	idAlmacenÌÌ| Ö
,ÌÌÖ Ü
intÌÌá ä

idConceptoÌÌã ï
,ÌÌï ñ
DateTimeÌÌó ü

fechaDesdeÌÌ† ™
,ÌÌ™ ´
DateTimeÌÌ¨ ¥

fechaHastaÌÌµ ø
)ÌÌø ¿
{
ÓÓ 	
try
ÔÔ 
{
 
SigescomEntities
ÒÒ  
_db
ÒÒ! $
=
ÒÒ% &
new
ÒÒ' *
SigescomEntities
ÒÒ+ ;
(
ÒÒ; <
)
ÒÒ< =
;
ÒÒ= >
int
ÛÛ 
[
ÛÛ 
]
ÛÛ >
0idsTiposDeTransaccionMovimientoDeBienes_Entradas
ÛÛ F
=
ÛÛG H
Diccionario
ÛÛI T
.
ÛÛT U<
-TiposDeTransaccionMovimientoDeBienes_EntradasÛÛU Ç
;ÛÛÇ É
int
ÙÙ 
[
ÙÙ 
]
ÙÙ =
/idsTiposDeTransaccionMovimientoDeBienes_Salidas
ÙÙ E
=
ÙÙF G
Diccionario
ÙÙH S
.
ÙÙS T;
,TiposDeTransaccionMovimientoDeBienes_SalidasÙÙT Ä
;ÙÙÄ Å
int
ıı 
[
ıı 
]
ıı 2
$idsTiposTransaccionMovimientoAlmacen
ıı :
=
ıı; <>
0idsTiposDeTransaccionMovimientoDeBienes_Entradas
ıı= m
.
ıım n
Union
ıın s
(
ııs t>
/idsTiposDeTransaccionMovimientoDeBienes_Salidasııt £
)ıı£ §
.ıı§ •
ToArrayıı• ¨
(ıı¨ ≠
)ıı≠ Æ
;ııÆ Ø
var
ˆˆ 

movimiento
ˆˆ 
=
ˆˆ  
_db
ˆˆ! $
.
ˆˆ$ %
Transaccion
ˆˆ% 0
.
˜˜ 
Where
˜˜ 
(
˜˜ 
t
˜˜ 
=>
˜˜ 
t
˜˜  !
.
˜˜! "
fecha_inicio
˜˜" .
>=
˜˜/ 1

fechaDesde
˜˜2 <
&&
¯¯ 
t
¯¯ 
.
¯¯ 
fecha_inicio
¯¯ %
<=
¯¯& (

fechaHasta
¯¯) 3
&&
˘˘ 
t
˘˘ 
.
˘˘ &
id_actor_negocio_interno
˘˘ 1
==
˘˘2 4
	idAlmacen
˘˘5 >
&&
˙˙ 2
$idsTiposTransaccionMovimientoAlmacen
˙˙ ;
.
˙˙; <
Contains
˙˙< D
(
˙˙D E
t
˙˙E F
.
˙˙F G!
id_tipo_transaccion
˙˙G Z
)
˙˙Z [
&&
˚˚ 
t
˚˚ 
.
˚˚ 
id_estado_actual
˚˚ )
==
˚˚* ,
MaestroSettings
˚˚- <
.
˚˚< =
Default
˚˚= D
.
˚˚D E.
 IdDetalleMaestroEstadoConfirmado
˚˚E e
)
˚˚e f
.
¸¸ 

SelectMany
¸¸ 
(
¸¸ 
t
¸¸ 
=>
¸¸  
t
¸¸! "
.
¸¸" #!
Detalle_transaccion
¸¸# 6
.
¸¸6 7
Where
¸¸7 <
(
¸¸< =
dt
¸¸= ?
=>
¸¸@ B
dt
¸¸C E
.
¸¸E F!
id_concepto_negocio
¸¸F Y
==
¸¸Z \

idConcepto
¸¸] g
)
¸¸g h
)
¸¸h i
.
¸¸i j
GroupBy
˝˝ 
(
˝˝ 
dt
˝˝ 
=>
˝˝ 
new
˝˝ !
{
˛˛ 
IdConceptoNegocio
ˇˇ %
=
ˇˇ& '
dt
ˇˇ( *
.
ˇˇ* +!
id_concepto_negocio
ˇˇ+ >
,
ˇˇ> ?
Lote
ÄÄ 
=
ÄÄ 
dt
ÄÄ 
.
ÄÄ 
lote
ÄÄ "
}
ÅÅ 
)
ÅÅ 
.
ÅÅ 
Select
ÅÅ 
(
ÅÅ 
m
ÅÅ 
=>
ÅÅ 
new
ÅÅ "@
2Movimientos_concepto_negocio_actor_negocio_interno
ÅÅ# U
(
ÅÅU V
)
ÅÅV W
{
ÇÇ 
Lote
ÉÉ 
=
ÉÉ 
m
ÉÉ 
.
ÉÉ 
Key
ÉÉ  
.
ÉÉ  !
Lote
ÉÉ! %
,
ÉÉ% &!
Id_concepto_negocio
ÑÑ '
=
ÑÑ( )
m
ÑÑ* +
.
ÑÑ+ ,
Key
ÑÑ, /
.
ÑÑ/ 0
IdConceptoNegocio
ÑÑ0 A
,
ÑÑA B 
Entradas_principal
ÖÖ &
=
ÖÖ' (
m
ÖÖ) *
.
ÖÖ* +
Where
ÖÖ+ 0
(
ÖÖ0 1
dt
ÖÖ1 3
=>
ÖÖ4 6>
0idsTiposDeTransaccionMovimientoDeBienes_Entradas
ÖÖ7 g
.
ÖÖg h
Contains
ÖÖh p
(
ÖÖp q
dt
ÖÖq s
.
ÖÖs t
Transaccion
ÖÖt 
.ÖÖ Ä#
id_tipo_transaccionÖÖÄ ì
)ÖÖì î
)ÖÖî ï
.ÖÖï ñ
SelectÖÖñ ú
(ÖÖú ù
dtÖÖù ü
=>ÖÖ† ¢
dtÖÖ£ •
.ÖÖ• ¶
cantidadÖÖ¶ Æ
)ÖÖÆ Ø
.ÖÖØ ∞
DefaultIfEmptyÖÖ∞ æ
(ÖÖæ ø
$numÖÖø ¿
)ÖÖ¿ ¡
.ÖÖ¡ ¬
SumÖÖ¬ ≈
(ÖÖ≈ ∆
)ÖÖ∆ «
,ÖÖ« »
Salidas_principal
ÜÜ %
=
ÜÜ& '
m
ÜÜ( )
.
ÜÜ) *
Where
ÜÜ* /
(
ÜÜ/ 0
dt
ÜÜ0 2
=>
ÜÜ3 5=
/idsTiposDeTransaccionMovimientoDeBienes_Salidas
ÜÜ6 e
.
ÜÜe f
Contains
ÜÜf n
(
ÜÜn o
dt
ÜÜo q
.
ÜÜq r
Transaccion
ÜÜr }
.
ÜÜ} ~"
id_tipo_transaccionÜÜ~ ë
)ÜÜë í
)ÜÜí ì
.ÜÜì î
SelectÜÜî ö
(ÜÜö õ
dtÜÜõ ù
=>ÜÜû †
dtÜÜ° £
.ÜÜ£ §
cantidadÜÜ§ ¨
)ÜÜ¨ ≠
.ÜÜ≠ Æ
DefaultIfEmptyÜÜÆ º
(ÜÜº Ω
$numÜÜΩ æ
)ÜÜæ ø
.ÜÜø ¿
SumÜÜ¿ √
(ÜÜ√ ƒ
)ÜÜƒ ≈
,ÜÜ≈ ∆!
Entradas_secundaria
áá '
=
áá( )
(
áá* +
decimal
áá+ 2
)
áá2 3
m
áá3 4
.
áá4 5
Where
áá5 :
(
áá: ;
dt
áá; =
=>
áá> @>
0idsTiposDeTransaccionMovimientoDeBienes_Entradas
ááA q
.
ááq r
Contains
áár z
(
ááz {
dt
áá{ }
.
áá} ~
Transaccionáá~ â
.ááâ ä#
id_tipo_transaccionááä ù
)ááù û
)ááû ü
.ááü †
Selectáá† ¶
(áá¶ ß
dtááß ©
=>áá™ ¨
dtáá≠ Ø
.ááØ ∞#
cantidad_secundariaáá∞ √
)áá√ ƒ
.ááƒ ≈
DefaultIfEmptyáá≈ ”
(áá” ‘
$numáá‘ ’
)áá’ ÷
.áá÷ ◊
Sumáá◊ ⁄
(áá⁄ €
)áá€ ‹
,áá‹ › 
Salidas_secundaria
àà &
=
àà' (
(
àà) *
decimal
àà* 1
)
àà1 2
m
àà2 3
.
àà3 4
Where
àà4 9
(
àà9 :
dt
àà: <
=>
àà= ?=
/idsTiposDeTransaccionMovimientoDeBienes_Salidas
àà@ o
.
àào p
Contains
ààp x
(
ààx y
dt
àày {
.
àà{ |
Transaccionàà| á
.ààá à#
id_tipo_transaccionààà õ
)ààõ ú
)ààú ù
.ààù û
Selectààû §
(àà§ •
dtàà• ß
=>àà® ™
dtàà´ ≠
.àà≠ Æ#
cantidad_secundariaààÆ ¡
)àà¡ ¬
.àà¬ √
DefaultIfEmptyàà√ —
(àà— “
$numàà“ ”
)àà” ‘
.àà‘ ’
Sumàà’ ÿ
(ààÿ Ÿ
)ààŸ ⁄
,àà⁄ €
Total
ââ 
=
ââ 
m
ââ 
.
ââ 
Where
ââ #
(
ââ# $
dt
ââ$ &
=>
ââ' )>
0idsTiposDeTransaccionMovimientoDeBienes_Entradas
ââ* Z
.
ââZ [
Contains
ââ[ c
(
ââc d
dt
ââd f
.
ââf g
Transaccion
ââg r
.
ââr s"
id_tipo_transaccionââs Ü
)ââÜ á
)ââá à
.ââà â
Selectâââ è
(ââè ê
dtââê í
=>ââì ï
dtââñ ò
.ââò ô
totalââô û
)ââû ü
.ââü †
DefaultIfEmptyââ† Æ
(ââÆ Ø
$numââØ ∞
)ââ∞ ±
.ââ± ≤
Sumââ≤ µ
(ââµ ∂
)ââ∂ ∑
-ââ∏ π
mââ∫ ª
.ââª º
Whereââº ¡
(ââ¡ ¬
dtââ¬ ƒ
=>ââ≈ «?
/idsTiposDeTransaccionMovimientoDeBienes_Salidasââ« ˆ
.ââˆ ˜
Containsââ˜ ˇ
(ââˇ Ä
dtââÄ Ç
.ââÇ É
TransaccionââÉ é
.ââé è#
id_tipo_transaccionââè ¢
)ââ¢ £
)ââ£ §
.ââ§ •
Selectââ• ´
(ââ´ ¨
dtââ¨ Æ
=>ââØ ±
dtââ≤ ¥
.ââ¥ µ
totalââµ ∫
)ââ∫ ª
.ââª º
DefaultIfEmptyââº  
(ââ  À
$numââÀ Ã
)ââÃ Õ
.ââÕ Œ
SumââŒ —
(ââ— “
)ââ“ ”
}
ää 
)
ää 
;
ää 
return
ãã 

movimiento
ãã !
;
ãã! "
}
åå 
catch
çç 
(
çç 
	Exception
çç 
e
çç 
)
çç 
{
éé 
throw
èè 
e
èè 
;
èè 
}
êê 
}
ëë 	
public
îî 
IEnumerable
îî 
<
îî @
2Movimientos_concepto_negocio_actor_negocio_interno
îî M
>
îîM NH
9ObtenerMovimientosConceptoNegocioConLotePorEntidadInternaîîO à
(îîà â
intîîâ å%
idActorNegocioInternoîîç ¢
,îî¢ £
DateTimeîî§ ¨

fechaDesdeîî≠ ∑
,îî∑ ∏
DateTimeîîπ ¡

fechaHastaîî¬ Ã
)îîÃ Õ
{
ïï 	
try
ññ 
{
óó 
SigescomEntities
òò  
_db
òò! $
=
òò% &
new
òò' *
SigescomEntities
òò+ ;
(
òò; <
)
òò< =
;
òò= >
var
öö 
movimientos
öö 
=
öö  !
_db
öö" %
.
öö% &
Transaccion
öö& 1
.
õõ 
Where
õõ 
(
õõ 
t
õõ 
=>
õõ 
t
õõ  !
.
õõ! "
fecha_inicio
õõ" .
>=
õõ/ 1

fechaDesde
õõ2 <
&&
úú 
t
úú 
.
úú 
fecha_inicio
úú %
<=
úú& (

fechaHasta
úú) 3
&&
ùù 
t
ùù 
.
ùù &
id_actor_negocio_interno
ùù 1
==
ùù2 4#
idActorNegocioInterno
ùù5 J
&&
ûû 
t
ûû 
.
ûû 
id_estado_actual
ûû )
==
ûû* ,
MaestroSettings
ûû- <
.
ûû< =
Default
ûû= D
.
ûûD E.
 IdDetalleMaestroEstadoConfirmado
ûûE e
)
ûûe f
.
üü 

SelectMany
üü 
(
üü 
t
üü 
=>
üü !
t
üü" #
.
üü# $!
Detalle_transaccion
üü$ 7
)
üü7 8
.
üü8 9
GroupBy
†† 
(
†† 
dt
†† 
=>
†† 
new
†† "
{
°° 
IdEntidadInterna
¢¢ %
=
¢¢& '
dt
¢¢( *
.
¢¢* +
Transaccion
¢¢+ 6
.
¢¢6 7&
id_actor_negocio_interno
¢¢7 O
,
¢¢O P
IdConceptoNegocio
££ &
=
££' (
dt
££) +
.
££+ ,!
id_concepto_negocio
££, ?
,
££? @
Lote
§§ 
=
§§ 
dt
§§ 
.
§§ 
lote
§§ #
}
•• 
)
•• 
.
•• 
Select
•• 
(
•• 
m
•• 
=>
•• 
new
••  #@
2Movimientos_concepto_negocio_actor_negocio_interno
••$ V
(
••V W
)
••W X
{
¶¶  
Id_entidad_interna
ßß '
=
ßß( )
m
ßß* +
.
ßß+ ,
Key
ßß, /
.
ßß/ 0
IdEntidadInterna
ßß0 @
,
ßß@ A!
Id_concepto_negocio
®® (
=
®®) *
m
®®+ ,
.
®®, -
Key
®®- 0
.
®®0 1
IdConceptoNegocio
®®1 B
,
®®B C
Lote
©© 
=
©© 
m
©© 
.
©© 
Key
©© !
.
©©! "
Lote
©©" &
,
©©& ' 
Entradas_principal
™™ '
=
™™( )
m
™™* +
.
™™+ ,
Where
™™, 1
(
™™1 2
dt
™™2 4
=>
™™5 7
dt
™™8 :
.
™™: ;
Transaccion
™™; F
.
™™F G
Tipo_transaccion
™™G W
.
™™W X4
&Accion_de_negocio_por_tipo_transaccion
™™X ~
.
™™~ 
Any™™ Ç
(™™Ç É
antt™™É á
=>™™à ä
antt™™ã è
.™™è ê$
id_accion_de_negocio™™ê §
==™™• ß#
TransaccionSettings™™® ª
.™™ª º
Default™™º √
.™™√ ƒ4
$IdAccionDeNegocioMovimientoEnAlmacen™™ƒ Ë
&&™™È Î
antt™™Ï 
.™™ Ò
valor™™Ò ˆ
)™™ˆ ˜
&&™™¯ ˙
dt™™˚ ˝
.™™˝ ˛
Transaccion™™˛ â
.™™â ä 
id_estado_actual™™ä ö
==™™õ ù
MaestroSettings™™û ≠
.™™≠ Æ
Default™™Æ µ
.™™µ ∂0
 IdDetalleMaestroEstadoConfirmado™™∂ ÷
)™™÷ ◊
.™™◊ ÿ
Select™™ÿ ﬁ
(™™ﬁ ﬂ
dt™™ﬂ ·
=>™™‚ ‰
dt™™Â Á
.™™Á Ë
cantidad™™Ë 
)™™ Ò
.™™Ò Ú
DefaultIfEmpty™™Ú Ä
(™™Ä Å
$num™™Å Ç
)™™Ç É
.™™É Ñ
Sum™™Ñ á
(™™á à
)™™à â
,™™â ä
Salidas_principal
´´ &
=
´´' (
m
´´) *
.
´´* +
Where
´´+ 0
(
´´0 1
dt
´´1 3
=>
´´4 6
dt
´´7 9
.
´´9 :
Transaccion
´´: E
.
´´E F
Tipo_transaccion
´´F V
.
´´V W4
&Accion_de_negocio_por_tipo_transaccion
´´W }
.
´´} ~
Any´´~ Å
(´´Å Ç
antt´´Ç Ü
=>´´á â
antt´´ä é
.´´é è$
id_accion_de_negocio´´è £
==´´§ ¶#
TransaccionSettings´´ß ∫
.´´∫ ª
Default´´ª ¬
.´´¬ √4
$IdAccionDeNegocioMovimientoEnAlmacen´´√ Á
&&´´Ë Í
!´´Î Ï
antt´´Ï 
.´´ Ò
valor´´Ò ˆ
)´´ˆ ˜
&&´´¯ ˙
dt´´˚ ˝
.´´˝ ˛
Transaccion´´˛ â
.´´â ä 
id_estado_actual´´ä ö
==´´õ ù
MaestroSettings´´û ≠
.´´≠ Æ
Default´´Æ µ
.´´µ ∂0
 IdDetalleMaestroEstadoConfirmado´´∂ ÷
)´´÷ ◊
.´´◊ ÿ
Select´´ÿ ﬁ
(´´ﬁ ﬂ
dt´´ﬂ ·
=>´´‚ ‰
dt´´Â Á
.´´Á Ë
cantidad´´Ë 
)´´ Ò
.´´Ò Ú
DefaultIfEmpty´´Ú Ä
(´´Ä Å
$num´´Å Ç
)´´Ç É
.´´É Ñ
Sum´´Ñ á
(´´á à
)´´à â
,´´â ä!
Entradas_secundaria
¨¨ (
=
¨¨) *
(
¨¨+ ,
decimal
¨¨, 3
)
¨¨3 4
m
¨¨4 5
.
¨¨5 6
Where
¨¨6 ;
(
¨¨; <
dt
¨¨< >
=>
¨¨? A
dt
¨¨B D
.
¨¨D E
Transaccion
¨¨E P
.
¨¨P Q
Tipo_transaccion
¨¨Q a
.
¨¨a b5
&Accion_de_negocio_por_tipo_transaccion¨¨b à
.¨¨à â
Any¨¨â å
(¨¨å ç
antt¨¨ç ë
=>¨¨í î
antt¨¨ï ô
.¨¨ô ö$
id_accion_de_negocio¨¨ö Æ
==¨¨Ø ±#
TransaccionSettings¨¨≤ ≈
.¨¨≈ ∆
Default¨¨∆ Õ
.¨¨Õ Œ4
$IdAccionDeNegocioMovimientoEnAlmacen¨¨Œ Ú
&&¨¨Û ı
antt¨¨ˆ ˙
.¨¨˙ ˚
valor¨¨˚ Ä
)¨¨Ä Å
&&¨¨Ç Ñ
dt¨¨Ö á
.¨¨á à
Transaccion¨¨à ì
.¨¨ì î 
id_estado_actual¨¨î §
==¨¨• ß
MaestroSettings¨¨® ∑
.¨¨∑ ∏
Default¨¨∏ ø
.¨¨ø ¿0
 IdDetalleMaestroEstadoConfirmado¨¨¿ ‡
&&¨¨· „
dt¨¨‰ Ê
.¨¨Ê Á#
cantidad_secundaria¨¨Á ˙
!=¨¨˚ ˝
null¨¨˛ Ç
)¨¨Ç É
.¨¨É Ñ
Select¨¨Ñ ä
(¨¨ä ã
dt¨¨ã ç
=>¨¨é ê
dt¨¨ë ì
.¨¨ì î#
cantidad_secundaria¨¨î ß
)¨¨ß ®
.¨¨® ©
DefaultIfEmpty¨¨© ∑
(¨¨∑ ∏
$num¨¨∏ π
)¨¨π ∫
.¨¨∫ ª
Sum¨¨ª æ
(¨¨æ ø
)¨¨ø ¿
,¨¨¿ ¡ 
Salidas_secundaria
≠≠ '
=
≠≠( )
(
≠≠* +
decimal
≠≠+ 2
)
≠≠2 3
m
≠≠3 4
.
≠≠4 5
Where
≠≠5 :
(
≠≠: ;
dt
≠≠; =
=>
≠≠> @
dt
≠≠A C
.
≠≠C D
Transaccion
≠≠D O
.
≠≠O P
Tipo_transaccion
≠≠P `
.
≠≠` a5
&Accion_de_negocio_por_tipo_transaccion≠≠a á
.≠≠á à
Any≠≠à ã
(≠≠ã å
antt≠≠å ê
=>≠≠ë ì
antt≠≠î ò
.≠≠ò ô$
id_accion_de_negocio≠≠ô ≠
==≠≠Æ ∞#
TransaccionSettings≠≠± ƒ
.≠≠ƒ ≈
Default≠≠≈ Ã
.≠≠Ã Õ4
$IdAccionDeNegocioMovimientoEnAlmacen≠≠Õ Ò
&&≠≠Ú Ù
!≠≠ı ˆ
antt≠≠ˆ ˙
.≠≠˙ ˚
valor≠≠˚ Ä
)≠≠Ä Å
&&≠≠Ç Ñ
dt≠≠Ö á
.≠≠á à
Transaccion≠≠à ì
.≠≠ì î 
id_estado_actual≠≠î §
==≠≠• ß
MaestroSettings≠≠® ∑
.≠≠∑ ∏
Default≠≠∏ ø
.≠≠ø ¿0
 IdDetalleMaestroEstadoConfirmado≠≠¿ ‡
&&≠≠· „
dt≠≠‰ Ê
.≠≠Ê Á#
cantidad_secundaria≠≠Á ˙
!=≠≠˚ ˝
null≠≠˛ Ç
)≠≠Ç É
.≠≠É Ñ
Select≠≠Ñ ä
(≠≠ä ã
dt≠≠ã ç
=>≠≠é ê
dt≠≠ë ì
.≠≠ì î#
cantidad_secundaria≠≠î ß
)≠≠ß ®
.≠≠® ©
DefaultIfEmpty≠≠© ∑
(≠≠∑ ∏
$num≠≠∏ π
)≠≠π ∫
.≠≠∫ ª
Sum≠≠ª æ
(≠≠æ ø
)≠≠ø ¿
}
ÆÆ 
)
ÆÆ 
;
ÆÆ 
return
ØØ 
movimientos
ØØ "
;
ØØ" #
}
∞∞ 
catch
±± 
(
±± 
	Exception
±± 
e
±± 
)
±± 
{
≤≤ 
throw
≥≥ 
e
≥≥ 
;
≥≥ 
}
¥¥ 
}
µµ 	
public
∑∑ 
IEnumerable
∑∑ 
<
∑∑ @
2Movimientos_concepto_negocio_actor_negocio_interno
∑∑ M
>
∑∑M NQ
BObtenerMovimientosConceptoNegocioPorEntidadInternaYConceptoNegocio∑∑O ë
(∑∑ë í
int∑∑í ï 
idEntidadInterna∑∑ñ ¶
,∑∑¶ ß
int∑∑® ´!
idConceptoNegocio∑∑¨ Ω
,∑∑Ω æ
DateTime∑∑ø «

fechaDesde∑∑» “
,∑∑“ ”
DateTime∑∑‘ ‹

fechaHasta∑∑› Á
)∑∑Á Ë
{
∏∏ 	
try
ππ 
{
∫∫ 
SigescomEntities
ªª  
_db
ªª! $
=
ªª% &
new
ªª' *
SigescomEntities
ªª+ ;
(
ªª; <
)
ªª< =
;
ªª= >
var
ΩΩ 
movimientos
ΩΩ 
=
ΩΩ  !
_db
ΩΩ" %
.
ΩΩ% &
Transaccion
ΩΩ& 1
.
ææ 
Where
ææ 
(
ææ 
t
ææ 
=>
ææ 
t
ææ  !
.
ææ! "
fecha_inicio
ææ" .
>=
ææ/ 1

fechaDesde
ææ2 <
&&
øø 
t
øø 
.
øø 
fecha_inicio
øø %
<=
øø& (

fechaHasta
øø) 3
&&
¿¿ 
idEntidadInterna
¿¿ '
==
¿¿( *
t
¿¿+ ,
.
¿¿, -&
id_actor_negocio_interno
¿¿- E
&&
¡¡ 
t
¡¡ 
.
¡¡ 
Tipo_transaccion
¡¡ )
.
¡¡) *4
&Accion_de_negocio_por_tipo_transaccion
¡¡* P
.
¡¡P Q
Any
¡¡Q T
(
¡¡T U
antt
¡¡U Y
=>
¡¡Z \
antt
¡¡] a
.
¡¡a b"
id_accion_de_negocio
¡¡b v
==
¡¡w y"
TransaccionSettings¡¡z ç
.¡¡ç é
Default¡¡é ï
.¡¡ï ñ4
$IdAccionDeNegocioMovimientoEnAlmacen¡¡ñ ∫
)¡¡∫ ª
&&
¬¬ 
t
¬¬ 
.
¬¬ 
id_estado_actual
¬¬ )
==
¬¬* ,
MaestroSettings
¬¬- <
.
¬¬< =
Default
¬¬= D
.
¬¬D E.
 IdDetalleMaestroEstadoConfirmado
¬¬E e
)
¬¬e f
.
√√ 

SelectMany
√√ 
(
√√  
t
√√  !
=>
√√" $
t
√√% &
.
√√& '!
Detalle_transaccion
√√' :
)
√√: ;
.
√√; <
Where
√√< A
(
√√A B
dt
√√B D
=>
√√E G
dt
√√H J
.
√√J K!
id_concepto_negocio
√√K ^
==
√√_ a
idConceptoNegocio
√√b s
)
√√s t
.
ƒƒ 
Select
ƒƒ 
(
ƒƒ 
m
ƒƒ 
=>
ƒƒ  
new
ƒƒ! $@
2Movimientos_concepto_negocio_actor_negocio_interno
ƒƒ% W
(
ƒƒW X
)
ƒƒX Y
{
≈≈  
Id_entidad_interna
∆∆ *
=
∆∆+ ,
m
∆∆- .
.
∆∆. /
Transaccion
∆∆/ :
.
∆∆: ;&
id_actor_negocio_interno
∆∆; S
,
∆∆S T!
Id_concepto_negocio
«« +
=
««, -
m
««. /
.
««/ 0!
id_concepto_negocio
««0 C
,
««C D
	EsIngreso
»» !
=
»»" #
m
»»$ %
.
»»% &
Transaccion
»»& 1
.
»»1 2
Tipo_transaccion
»»2 B
.
»»B C4
&Accion_de_negocio_por_tipo_transaccion
»»C i
.
»»i j
FirstOrDefault
»»j x
(
»»x y
antt
»»y }
=>»»~ Ä
antt»»Å Ö
.»»Ö Ü$
id_accion_de_negocio»»Ü ö
==»»õ ù#
TransaccionSettings»»û ±
.»»± ≤
Default»»≤ π
.»»π ∫4
$IdAccionDeNegocioMovimientoEnAlmacen»»∫ ﬁ
)»»ﬁ ﬂ
.»»ﬂ ‡
valor»»‡ Â
,»»Â Ê
Costo_Unitario
…… &
=
……' (
m
……) *
.
……* +
precio_unitario
……+ :
,
……: ;
Total
   
=
   
m
    !
.
  ! "
total
  " '
,
  ' ( 
Cantidad_Principal
ÀÀ *
=
ÀÀ+ ,
m
ÀÀ- .
.
ÀÀ. /
cantidad
ÀÀ/ 7
,
ÀÀ7 8!
Cantidad_Secundaria
ÃÃ +
=
ÃÃ, -
(
ÃÃ. /
decimal
ÃÃ/ 6
)
ÃÃ6 7
m
ÃÃ7 8
.
ÃÃ8 9!
cantidad_secundaria
ÃÃ9 L
,
ÃÃL M
Fecha_inicio
ÕÕ $
=
ÕÕ% &
m
ÕÕ' (
.
ÕÕ( )
Transaccion
ÕÕ) 4
.
ÕÕ4 5
fecha_inicio
ÕÕ5 A
}
ŒŒ 
)
ŒŒ 
;
ŒŒ 
return
œœ 
movimientos
œœ "
;
œœ" #
}
–– 
catch
—— 
(
—— 
	Exception
—— 
e
—— 
)
—— 
{
““ 
throw
”” 
new
”” 
DatosException
”” (
(
””( )
$str
””) H
,
””H I
e
””J K
)
””K L
;
””L M
}
‘‘ 
}
’’ 	
public
◊◊ 
IEnumerable
◊◊ 
<
◊◊ @
2Movimientos_concepto_negocio_actor_negocio_interno
◊◊ M
>
◊◊M NX
IObtenerMovimientosConceptoNegocioConLotePorEntidadInternaYConceptoNegocio◊◊O ò
(◊◊ò ô
int◊◊ô ú%
idActorNegocioInterno◊◊ù ≤
,◊◊≤ ≥
int◊◊¥ ∑!
idConceptoNegocio◊◊∏ …
,◊◊…  
DateTime◊◊À ”

fechaDesde◊◊‘ ﬁ
,◊◊ﬁ ﬂ
DateTime◊◊‡ Ë

fechaHasta◊◊È Û
)◊◊Û Ù
{
ÿÿ 	
try
ŸŸ 
{
⁄⁄ 
SigescomEntities
€€  
_db
€€! $
=
€€% &
new
€€' *
SigescomEntities
€€+ ;
(
€€; <
)
€€< =
;
€€= >
var
›› 
movimientos
›› 
=
››  !
_db
››" %
.
››% &
Transaccion
››& 1
.
››1 2
Where
››2 7
(
››7 8
t
››8 9
=>
››: <
t
››= >
.
››> ?
fecha_inicio
››? K
>=
››L N

fechaDesde
››O Y
&&
ﬁﬁ 
t
ﬁﬁ 
.
ﬁﬁ 
fecha_inicio
ﬁﬁ %
<=
ﬁﬁ& (

fechaHasta
ﬁﬁ) 3
&&
ﬂﬂ #
idActorNegocioInterno
ﬂﬂ ,
==
ﬂﬂ- /
t
ﬂﬂ0 1
.
ﬂﬂ1 2&
id_actor_negocio_interno
ﬂﬂ2 J
&&
‡‡ 
t
‡‡ 
.
‡‡ 
id_estado_actual
‡‡ )
==
‡‡* ,
MaestroSettings
‡‡- <
.
‡‡< =
Default
‡‡= D
.
‡‡D E.
 IdDetalleMaestroEstadoConfirmado
‡‡E e
)
‡‡e f
.
·· 

SelectMany
·· 
(
··  
t
··  !
=>
··" $
t
··% &
.
··& '!
Detalle_transaccion
··' :
)
··: ;
.
··; <
Where
··< A
(
··A B
dt
··B D
=>
··E G
dt
··H J
.
··J K!
id_concepto_negocio
··K ^
==
··_ a
idConceptoNegocio
··b s
)
··s t
.
‚‚ 
GroupBy
‚‚ 
(
‚‚ 
dt
‚‚ 
=>
‚‚  "
new
‚‚# &
{
„„ 
IdEntidadInterna
‰‰ (
=
‰‰) *
dt
‰‰+ -
.
‰‰- .
Transaccion
‰‰. 9
.
‰‰9 :&
id_actor_negocio_interno
‰‰: R
,
‰‰R S
IdConceptoNegocio
ÂÂ )
=
ÂÂ* +
dt
ÂÂ, .
.
ÂÂ. /!
id_concepto_negocio
ÂÂ/ B
,
ÂÂB C
Lote
ÊÊ 
=
ÊÊ 
dt
ÊÊ !
.
ÊÊ! "
lote
ÊÊ" &
}
ÁÁ 
)
ÁÁ 
.
ÁÁ 
Select
ÁÁ 
(
ÁÁ 
m
ÁÁ 
=>
ÁÁ  "
new
ÁÁ# &@
2Movimientos_concepto_negocio_actor_negocio_interno
ÁÁ' Y
(
ÁÁY Z
)
ÁÁZ [
{
ËË  
Id_entidad_interna
ÈÈ *
=
ÈÈ+ ,
m
ÈÈ- .
.
ÈÈ. /
Key
ÈÈ/ 2
.
ÈÈ2 3
IdEntidadInterna
ÈÈ3 C
,
ÈÈC D!
Id_concepto_negocio
ÍÍ +
=
ÍÍ, -
m
ÍÍ. /
.
ÍÍ/ 0
Key
ÍÍ0 3
.
ÍÍ3 4
IdConceptoNegocio
ÍÍ4 E
,
ÍÍE F
Lote
ÎÎ 
=
ÎÎ 
m
ÎÎ  
.
ÎÎ  !
Key
ÎÎ! $
.
ÎÎ$ %
Lote
ÎÎ% )
,
ÎÎ) * 
Entradas_principal
ÏÏ *
=
ÏÏ+ ,
m
ÏÏ- .
.
ÏÏ. /
Where
ÏÏ/ 4
(
ÏÏ4 5
dt
ÏÏ5 7
=>
ÏÏ8 :
dt
ÏÏ; =
.
ÏÏ= >
Transaccion
ÏÏ> I
.
ÏÏI J
Tipo_transaccion
ÏÏJ Z
.
ÏÏZ [5
&Accion_de_negocio_por_tipo_transaccionÏÏ[ Å
.ÏÏÅ Ç
AnyÏÏÇ Ö
(ÏÏÖ Ü
anttÏÏÜ ä
=>ÏÏã ç
anttÏÏé í
.ÏÏí ì$
id_accion_de_negocioÏÏì ß
==ÏÏ® ™#
TransaccionSettingsÏÏ´ æ
.ÏÏæ ø
DefaultÏÏø ∆
.ÏÏ∆ «4
$IdAccionDeNegocioMovimientoEnAlmacenÏÏ« Î
&&ÏÏÏ Ó
anttÏÏÔ Û
.ÏÏÛ Ù
valorÏÏÙ ˘
)ÏÏ˘ ˙
&&ÏÏ˚ ˝
dtÏÏ˛ Ä
.ÏÏÄ Å
TransaccionÏÏÅ å
.ÏÏå ç 
id_estado_actualÏÏç ù
==ÏÏû †
MaestroSettingsÏÏ° ∞
.ÏÏ∞ ±
DefaultÏÏ± ∏
.ÏÏ∏ π0
 IdDetalleMaestroEstadoConfirmadoÏÏπ Ÿ
)ÏÏŸ ⁄
.ÏÏ⁄ €
SelectÏÏ€ ·
(ÏÏ· ‚
dtÏÏ‚ ‰
=>ÏÏÂ Á
dtÏÏË Í
.ÏÏÍ Î
cantidadÏÏÎ Û
)ÏÏÛ Ù
.ÏÏÙ ı
DefaultIfEmptyÏÏı É
(ÏÏÉ Ñ
$numÏÏÑ Ö
)ÏÏÖ Ü
.ÏÏÜ á
SumÏÏá ä
(ÏÏä ã
)ÏÏã å
,ÏÏå ç
Salidas_principal
ÌÌ )
=
ÌÌ* +
m
ÌÌ, -
.
ÌÌ- .
Where
ÌÌ. 3
(
ÌÌ3 4
dt
ÌÌ4 6
=>
ÌÌ7 9
dt
ÌÌ: <
.
ÌÌ< =
Transaccion
ÌÌ= H
.
ÌÌH I
Tipo_transaccion
ÌÌI Y
.
ÌÌY Z5
&Accion_de_negocio_por_tipo_transaccionÌÌZ Ä
.ÌÌÄ Å
AnyÌÌÅ Ñ
(ÌÌÑ Ö
anttÌÌÖ â
=>ÌÌä å
anttÌÌç ë
.ÌÌë í$
id_accion_de_negocioÌÌí ¶
==ÌÌß ©#
TransaccionSettingsÌÌ™ Ω
.ÌÌΩ æ
DefaultÌÌæ ≈
.ÌÌ≈ ∆4
$IdAccionDeNegocioMovimientoEnAlmacenÌÌ∆ Í
&&ÌÌÎ Ì
!ÌÌÓ Ô
anttÌÌÔ Û
.ÌÌÛ Ù
valorÌÌÙ ˘
)ÌÌ˘ ˙
&&ÌÌ˚ ˝
dtÌÌ˛ Ä
.ÌÌÄ Å
TransaccionÌÌÅ å
.ÌÌå ç 
id_estado_actualÌÌç ù
==ÌÌû †
MaestroSettingsÌÌ° ∞
.ÌÌ∞ ±
DefaultÌÌ± ∏
.ÌÌ∏ π0
 IdDetalleMaestroEstadoConfirmadoÌÌπ Ÿ
)ÌÌŸ ⁄
.ÌÌ⁄ €
SelectÌÌ€ ·
(ÌÌ· ‚
dtÌÌ‚ ‰
=>ÌÌÂ Á
dtÌÌË Í
.ÌÌÍ Î
cantidadÌÌÎ Û
)ÌÌÛ Ù
.ÌÌÙ ı
DefaultIfEmptyÌÌı É
(ÌÌÉ Ñ
$numÌÌÑ Ö
)ÌÌÖ Ü
.ÌÌÜ á
SumÌÌá ä
(ÌÌä ã
)ÌÌã å
,ÌÌå ç!
Entradas_secundaria
ÓÓ +
=
ÓÓ, -
(
ÓÓ. /
decimal
ÓÓ/ 6
)
ÓÓ6 7
m
ÓÓ7 8
.
ÓÓ8 9
Where
ÓÓ9 >
(
ÓÓ> ?
dt
ÓÓ? A
=>
ÓÓB D
dt
ÓÓE G
.
ÓÓG H
Transaccion
ÓÓH S
.
ÓÓS T
Tipo_transaccion
ÓÓT d
.
ÓÓd e5
&Accion_de_negocio_por_tipo_transaccionÓÓe ã
.ÓÓã å
AnyÓÓå è
(ÓÓè ê
anttÓÓê î
=>ÓÓï ó
anttÓÓò ú
.ÓÓú ù$
id_accion_de_negocioÓÓù ±
==ÓÓ≤ ¥#
TransaccionSettingsÓÓµ »
.ÓÓ» …
DefaultÓÓ… –
.ÓÓ– —4
$IdAccionDeNegocioMovimientoEnAlmacenÓÓ— ı
&&ÓÓˆ ¯
anttÓÓ˘ ˝
.ÓÓ˝ ˛
valorÓÓ˛ É
)ÓÓÉ Ñ
&&ÓÓÖ á
dtÓÓà ä
.ÓÓä ã
TransaccionÓÓã ñ
.ÓÓñ ó 
id_estado_actualÓÓó ß
==ÓÓ® ™
MaestroSettingsÓÓ´ ∫
.ÓÓ∫ ª
DefaultÓÓª ¬
.ÓÓ¬ √0
 IdDetalleMaestroEstadoConfirmadoÓÓ√ „
&&ÓÓ‰ Ê
dtÓÓÁ È
.ÓÓÈ Í#
cantidad_secundariaÓÓÍ ˝
!=ÓÓ˛ Ä
nullÓÓÅ Ö
)ÓÓÖ Ü
.ÓÓÜ á
SelectÓÓá ç
(ÓÓç é
dtÓÓé ê
=>ÓÓë ì
dtÓÓî ñ
.ÓÓñ ó#
cantidad_secundariaÓÓó ™
)ÓÓ™ ´
.ÓÓ´ ¨
DefaultIfEmptyÓÓ¨ ∫
(ÓÓ∫ ª
$numÓÓª º
)ÓÓº Ω
.ÓÓΩ æ
SumÓÓæ ¡
(ÓÓ¡ ¬
)ÓÓ¬ √
,ÓÓ√ ƒ 
Salidas_secundaria
ÔÔ *
=
ÔÔ+ ,
(
ÔÔ- .
decimal
ÔÔ. 5
)
ÔÔ5 6
m
ÔÔ6 7
.
ÔÔ7 8
Where
ÔÔ8 =
(
ÔÔ= >
dt
ÔÔ> @
=>
ÔÔA C
dt
ÔÔD F
.
ÔÔF G
Transaccion
ÔÔG R
.
ÔÔR S
Tipo_transaccion
ÔÔS c
.
ÔÔc d5
&Accion_de_negocio_por_tipo_transaccionÔÔd ä
.ÔÔä ã
AnyÔÔã é
(ÔÔé è
anttÔÔè ì
=>ÔÔî ñ
anttÔÔó õ
.ÔÔõ ú$
id_accion_de_negocioÔÔú ∞
==ÔÔ± ≥#
TransaccionSettingsÔÔ¥ «
.ÔÔ« »
DefaultÔÔ» œ
.ÔÔœ –4
$IdAccionDeNegocioMovimientoEnAlmacenÔÔ– Ù
&&ÔÔı ˜
!ÔÔ¯ ˘
anttÔÔ˘ ˝
.ÔÔ˝ ˛
valorÔÔ˛ É
)ÔÔÉ Ñ
&&ÔÔÖ á
dtÔÔà ä
.ÔÔä ã
TransaccionÔÔã ñ
.ÔÔñ ó 
id_estado_actualÔÔó ß
==ÔÔ® ™
MaestroSettingsÔÔ´ ∫
.ÔÔ∫ ª
DefaultÔÔª ¬
.ÔÔ¬ √0
 IdDetalleMaestroEstadoConfirmadoÔÔ√ „
&&ÔÔ‰ Ê
dtÔÔÁ È
.ÔÔÈ Í#
cantidad_secundariaÔÔÍ ˝
!=ÔÔ˛ Ä
nullÔÔÅ Ö
)ÔÔÖ Ü
.ÔÔÜ á
SelectÔÔá ç
(ÔÔç é
dtÔÔé ê
=>ÔÔë ì
dtÔÔî ñ
.ÔÔñ ó#
cantidad_secundariaÔÔó ™
)ÔÔ™ ´
.ÔÔ´ ¨
DefaultIfEmptyÔÔ¨ ∫
(ÔÔ∫ ª
$numÔÔª º
)ÔÔº Ω
.ÔÔΩ æ
SumÔÔæ ¡
(ÔÔ¡ ¬
)ÔÔ¬ √
,ÔÔ√ ƒ
Fecha_inicio
 $
=
% &
m
' (
.
( )
Select
) /
(
/ 0
dt
0 2
=>
3 5
dt
6 8
.
8 9
Transaccion
9 D
.
D E
fecha_inicio
E Q
)
Q R
.
R S
FirstOrDefault
S a
(
a b
)
b c
}
ÒÒ 
)
ÒÒ 
;
ÒÒ 
return
ÚÚ 
movimientos
ÚÚ "
;
ÚÚ" #
}
ÛÛ 
catch
ÙÙ 
(
ÙÙ 
	Exception
ÙÙ 
e
ÙÙ 
)
ÙÙ 
{
ıı 
throw
ˆˆ 
new
ˆˆ 
DatosException
ˆˆ (
(
ˆˆ( )
$str
ˆˆ) H
,
ˆˆH I
e
ˆˆJ K
)
ˆˆK L
;
ˆˆL M
}
˜˜ 
}
¯¯ 	
public
˚˚ 
IEnumerable
˚˚ 
<
˚˚ 
MovimientoAlmacen
˚˚ ,
>
˚˚, -.
 ObtenerDetallesMovimientoAlmacen
˚˚. N
(
˚˚N O
int
˚˚O R#
idActorNegocioInterno
˚˚S h
,
˚˚h i
int
˚˚j m
idConceptoNegocio
˚˚n 
,˚˚ Ä
DateTime˚˚Å â

fechaDesde˚˚ä î
,˚˚î ï
DateTime˚˚ñ û

fechaHasta˚˚ü ©
)˚˚© ™
{
¸¸ 	
try
˝˝ 
{
˛˛ 
SigescomEntities
ˇˇ  
_db
ˇˇ! $
=
ˇˇ% &
new
ˇˇ' *
SigescomEntities
ˇˇ+ ;
(
ˇˇ; <
)
ˇˇ< =
;
ˇˇ= >
var
ÅÅ 
detalles
ÅÅ 
=
ÅÅ 
_db
ÅÅ "
.
ÅÅ" #4
&Accion_de_negocio_por_tipo_transaccion
ÅÅ# I
.
ÇÇ  !
Where
ÇÇ! &
(
ÇÇ& '
antt
ÇÇ' +
=>
ÇÇ, .
antt
ÇÇ/ 3
.
ÇÇ3 4"
id_accion_de_negocio
ÇÇ4 H
==
ÇÇI K!
TransaccionSettings
ÇÇL _
.
ÇÇ_ `
Default
ÇÇ` g
.
ÇÇg h3
$IdAccionDeNegocioMovimientoEnAlmacenÇÇh å
)ÇÇå ç
.
ÉÉ  !

SelectMany
ÉÉ! +
(
ÉÉ+ ,
antt
ÉÉ, 0
=>
ÉÉ1 3
antt
ÉÉ4 8
.
ÉÉ8 9
Tipo_transaccion
ÉÉ9 I
.
ÉÉI J
Transaccion
ÉÉJ U
)
ÉÉU V
.
ÑÑ  !
Where
ÑÑ! &
(
ÑÑ& '
t
ÑÑ' (
=>
ÑÑ) +
t
ÑÑ, -
.
ÑÑ- .
fecha_inicio
ÑÑ. :
>=
ÑÑ; =

fechaDesde
ÑÑ> H
&&
ÑÑI K
t
ÑÑL M
.
ÑÑM N
fecha_inicio
ÑÑN Z
<=
ÑÑ[ ]

fechaHasta
ÑÑ^ h
&&
ÑÑi k
t
ÑÑl m
.
ÑÑm n'
id_actor_negocio_internoÑÑn Ü
==ÑÑá â%
idActorNegocioInternoÑÑä ü
&&ÑÑ† ¢
tÑÑ£ §
.ÑÑ§ • 
id_estado_actualÑÑ• µ
==ÑÑ∂ ∏
MaestroSettingsÑÑπ »
.ÑÑ» …
DefaultÑÑ… –
.ÑÑ– —0
 IdDetalleMaestroEstadoConfirmadoÑÑ— Ò
)ÑÑÒ Ú
.
ÖÖ  !

SelectMany
ÖÖ! +
(
ÖÖ+ ,
t
ÖÖ, -
=>
ÖÖ. 0
t
ÖÖ1 2
.
ÖÖ2 3!
Detalle_transaccion
ÖÖ3 F
)
ÖÖF G
.
ÜÜ  !
Where
ÜÜ! &
(
ÜÜ& '
dt
ÜÜ' )
=>
ÜÜ* ,
dt
ÜÜ- /
.
ÜÜ/ 0!
id_concepto_negocio
ÜÜ0 C
==
ÜÜD F
idConceptoNegocio
ÜÜG X
)
ÜÜX Y
.
áá  !
Select
áá! '
(
áá' (
dt
áá( *
=>
áá+ -
new
áá. 1
MovimientoAlmacen
áá2 C
(
ááC D
)
ááD E
{
àà  !
IdTransaccion
ââ$ 1
=
ââ2 3
dt
ââ4 6
.
ââ6 7
Transaccion
ââ7 B
.
ââB C
id
ââC E
,
ââE F
IdOrden
ää$ +
=
ää, -
dt
ää. 0
.
ää0 1
Transaccion
ää1 <
.
ää< ='
id_transaccion_referencia
ää= V
,
ääV W
Fecha
ãã$ )
=
ãã* +
dt
ãã, .
.
ãã. /
Transaccion
ãã/ :
.
ãã: ;
fecha_inicio
ãã; G
,
ããG H#
IdActorNegocioExterno
åå$ 9
=
åå: ;
dt
åå< >
.
åå> ?
Transaccion
åå? J
.
ååJ K&
id_actor_negocio_externo
ååK c
,
ååc d#
IdActorNegocioInterno
çç$ 9
=
çç: ;
dt
çç< >
.
çç> ?
Transaccion
çç? J
.
ççJ K&
id_actor_negocio_interno
ççK c
,
ççc d

IdEmpleado
éé$ .
=
éé/ 0
dt
éé1 3
.
éé3 4
Transaccion
éé4 ?
.
éé? @
id_empleado
éé@ K
,
ééK L
Empleado
èè$ ,
=
èè- .
dt
èè/ 1
.
èè1 2
Transaccion
èè2 =
.
èè= >
Actor_negocio
èè> K
.
èèK L
Actor
èèL Q
.
èèQ R
primer_nombre
èèR _
,
èè_ `'
NombreActorNegocioExterno
êê$ =
=
êê> ?
dt
êê@ B
.
êêB C
Transaccion
êêC N
.
êêN O
Actor_negocio1
êêO ]
.
êê] ^
Actor
êê^ c
.
êêc d
primer_nombre
êêd q
.
êêq r
Replace
êêr y
(
êêy z
$str
êêz }
,
êê} ~
$strêê Ç
)êêÇ É
,êêÉ Ñ'
NombreActorNegocioInterno
ëë$ =
=
ëë> ?
dt
ëë@ B
.
ëëB C
Transaccion
ëëC N
.
ëëN O
Actor_negocio2
ëëO ]
.
ëë] ^
Actor
ëë^ c
.
ëëc d
primer_nombre
ëëd q
,
ëëq r
IdTipoTransaccion
íí$ 5
=
íí6 7
dt
íí8 :
.
íí: ;
Transaccion
íí; F
.
ííF G!
id_tipo_transaccion
ííG Z
,
ííZ [#
NombreTipoTransaccion
ìì$ 9
=
ìì: ;
dt
ìì< >
.
ìì> ?
Transaccion
ìì? J
.
ììJ K
Tipo_transaccion
ììK [
.
ìì[ \
nombre
ìì\ b
,
ììb c
IdTipoComprobante
îî$ 5
=
îî6 7
dt
îî8 :
.
îî: ;
Transaccion
îî; F
.
îîF G
Comprobante
îîG R
.
îîR S
Detalle_maestro
îîS b
.
îîb c
id
îîc e
,
îîe f#
NombreTipoComprobante
ïï$ 9
=
ïï: ;
dt
ïï< >
.
ïï> ?
Transaccion
ïï? J
.
ïïJ K
Comprobante
ïïK V
.
ïïV W
Detalle_maestro
ïïW f
.
ïïf g
nombre
ïïg m
,
ïïm n+
NumeroSerieDeSerieComprobante
ññ$ A
=
ññB C
dt
ññD F
.
ññF G
Transaccion
ññG R
.
ññR S
Comprobante
ññS ^
.
ññ^ _
Serie_comprobante
ññ_ p
.
ññp q
numero
ññq w
,
ññw x&
NumeroSerieDeComprobante
óó$ <
=
óó= >
dt
óó? A
.
óóA B
Transaccion
óóB M
.
óóM N
Comprobante
óóN Y
.
óóY Z
numero_serie
óóZ f
,
óóf g
NumeroComprobante
òò$ 5
=
òò6 7
dt
òò8 :
.
òò: ;
Transaccion
òò; F
.
òòF G
Comprobante
òòG R
.
òòR S
numero
òòS Y
,
òòY Z#
CodigoTipoComprobante
ôô$ 9
=
ôô: ;
dt
ôô< >
.
ôô> ?
Transaccion
ôô? J
.
ôôJ K
Comprobante
ôôK V
.
ôôV W
Detalle_maestro
ôôW f
.
ôôf g
valor
ôôg l
,
ôôl m
Cantidad
öö$ ,
=
öö- .
dt
öö/ 1
.
öö1 2
cantidad
öö2 :
,
öö: ;
ImporteUnitario
õõ$ 3
=
õõ4 5
dt
õõ6 8
.
õõ8 9
precio_unitario
õõ9 H
,
õõH I
ImporteTotal
úú$ 0
=
úú1 2
dt
úú3 5
.
úú5 6
total
úú6 ;
,
úú; <
	EsEntrada
ùù$ -
=
ùù. /
dt
ùù0 2
.
ùù2 3
Transaccion
ùù3 >
.
ùù> ?
Tipo_transaccion
ùù? O
.
ùùO P4
&Accion_de_negocio_por_tipo_transaccion
ùùP v
.
ùùv w
FirstOrDefaultùùw Ö
(ùùÖ Ü
anptùùÜ ä
=>ùùã ç
anptùùé í
.ùùí ì$
id_accion_de_negocioùùì ß
==ùù® ™#
TransaccionSettingsùù´ æ
.ùùæ ø
Defaultùùø ∆
.ùù∆ «4
$IdAccionDeNegocioMovimientoEnAlmacenùù« Î
)ùùÎ Ï
.ùùÏ Ì
valorùùÌ Ú
}
ûû  !
)
üü  !
;
üü! "
return
†† 
detalles
†† 
.
††  
OrderBy
††  '
(
††' (
dtk
††( +
=>
††, .
dtk
††/ 2
.
††2 3
Fecha
††3 8
)
††8 9
.
††9 :
ThenBy
††: @
(
††@ A
dtk
††A D
=>
††E G
dtk
††H K
.
††K L
IdTransaccion
††L Y
)
††Y Z
;
††Z [
}
°° 
catch
¢¢ 
(
¢¢ 
	Exception
¢¢ 
e
¢¢ 
)
¢¢ 
{
££ 
throw
££ 
new
££ 
DatosException
££ &
(
££& '
$str
££' G
,
££G H
e
££I J
)
££J K
;
££K L
}
££M N
}
§§ 	
public
¶¶ 
IEnumerable
¶¶ 
<
¶¶ $
ComprobanteDeOperacion
¶¶ 1
>
¶¶1 2*
ObtenerComprobantesDeOrdenes
¶¶3 O
(
¶¶O P
long
¶¶P T
[
¶¶T U
]
¶¶U V
	idOrdenes
¶¶W `
)
¶¶` a
{
ßß 	
try
®® 
{
©© 
SigescomEntities
™™  
_db
™™! $
=
™™% &
new
™™' *
SigescomEntities
™™+ ;
(
™™; <
)
™™< =
;
™™= >
var
¨¨ 
comprobantes
¨¨  
=
¨¨! "
_db
¨¨# &
.
¨¨& '
Transaccion
¨¨' 2
.
≠≠  !
Where
≠≠! &
(
≠≠& '
t
≠≠' (
=>
≠≠) +
	idOrdenes
≠≠, 5
.
≠≠5 6
Contains
≠≠6 >
(
≠≠> ?
t
≠≠? @
.
≠≠@ A
id
≠≠A C
)
≠≠C D
)
≠≠D E
.
ÆÆ  !
Select
ÆÆ! '
(
ÆÆ' (
t
ÆÆ( )
=>
ÆÆ* ,
new
ÆÆ- 0$
ComprobanteDeOperacion
ÆÆ1 G
(
ÆÆG H
)
ÆÆH I
{
ØØ  !
IdOperacion
∞∞$ /
=
∞∞0 1
t
∞∞2 3
.
∞∞3 4
id
∞∞4 6
,
∞∞6 7
Comprobante
±±$ /
=
±±0 1
t
±±2 3
.
±±3 4
Comprobante
±±4 ?
.
±±? @
numero_serie
±±@ L
+
±±M N
$str
±±O R
+
±±S T
t
±±U V
.
±±V W
Comprobante
±±W b
.
±±b c
numero
±±c i
,
±±i j
}
≤≤  !
)
≥≥  !
;
≥≥! "
return
¥¥ 
comprobantes
¥¥ #
;
¥¥# $
}
µµ 
catch
∂∂ 
(
∂∂ 
	Exception
∂∂ 
e
∂∂ 
)
∂∂ 
{
∑∑ 
throw
∑∑ 
new
∑∑ 
DatosException
∑∑ &
(
∑∑& '
$str
∑∑' Q
,
∑∑Q R
e
∑∑S T
)
∑∑T U
;
∑∑U V
}
∑∑W X
}
∏∏ 	
public
∫∫ 
IEnumerable
∫∫ 
<
∫∫ 
MovimientoAlmacen
∫∫ ,
>
∫∫, -+
ObtenerMovimientosDeAlmacenes
∫∫. K
(
∫∫K L
int
∫∫L O
	idAlmacen
∫∫P Y
,
∫∫Y Z
int
∫∫[ ^
[
∫∫^ _
]
∫∫_ `!
idsConceptosNegocio
∫∫a t
,
∫∫t u
DateTime
∫∫v ~

fechaDesde∫∫ â
,∫∫â ä
DateTime∫∫ã ì

fechaHasta∫∫î û
)∫∫û ü
{
ªª 	
try
ºº 
{
ΩΩ 
SigescomEntities
ææ  
_db
ææ! $
=
ææ% &
new
ææ' *
SigescomEntities
ææ+ ;
(
ææ; <
)
ææ< =
;
ææ= >
var
¿¿ 
detalles
¿¿ 
=
¿¿ 
_db
¿¿ "
.
¿¿" #4
&Accion_de_negocio_por_tipo_transaccion
¿¿# I
.
¡¡  !
Where
¡¡! &
(
¡¡& '
antt
¡¡' +
=>
¡¡, .
antt
¡¡/ 3
.
¡¡3 4"
id_accion_de_negocio
¡¡4 H
==
¡¡I K!
TransaccionSettings
¡¡L _
.
¡¡_ `
Default
¡¡` g
.
¡¡g h3
$IdAccionDeNegocioMovimientoEnAlmacen¡¡h å
)¡¡å ç
.
¬¬  !

SelectMany
¬¬! +
(
¬¬+ ,
antt
¬¬, 0
=>
¬¬1 3
antt
¬¬4 8
.
¬¬8 9
Tipo_transaccion
¬¬9 I
.
¬¬I J
Transaccion
¬¬J U
)
¬¬U V
.
√√  !
Where
√√! &
(
√√& '
t
√√' (
=>
√√) +
t
√√, -
.
√√- .
fecha_inicio
√√. :
>=
√√; =

fechaDesde
√√> H
&&
√√I K
t
√√L M
.
√√M N
fecha_inicio
√√N Z
<=
√√[ ]

fechaHasta
√√^ h
&&
√√i k
	idAlmacen
√√l u
==
√√v x
t
√√y z
.
√√z {'
id_actor_negocio_interno√√{ ì
&&√√î ñ
t√√ó ò
.√√ò ô 
id_estado_actual√√ô ©
==√√™ ¨
MaestroSettings√√≠ º
.√√º Ω
Default√√Ω ƒ
.√√ƒ ≈0
 IdDetalleMaestroEstadoConfirmado√√≈ Â
)√√Â Ê
.
ƒƒ  !

SelectMany
ƒƒ! +
(
ƒƒ+ ,
t
ƒƒ, -
=>
ƒƒ. 0
t
ƒƒ1 2
.
ƒƒ2 3!
Detalle_transaccion
ƒƒ3 F
)
ƒƒF G
.
≈≈  !
Where
≈≈! &
(
≈≈& '
dt
≈≈' )
=>
≈≈* ,!
idsConceptosNegocio
≈≈- @
.
≈≈@ A
Contains
≈≈A I
(
≈≈I J
dt
≈≈J L
.
≈≈L M!
id_concepto_negocio
≈≈M `
)
≈≈` a
)
≈≈a b
.
∆∆  !
Select
∆∆! '
(
∆∆' (
dt
∆∆( *
=>
∆∆+ -
new
∆∆. 1
MovimientoAlmacen
∆∆2 C
(
∆∆C D
)
∆∆D E
{
««  !"
IdDetalleTransaccion
»»$ 8
=
»»9 :
dt
»»; =
.
»»= >
id
»»> @
,
»»@ A
IdTransaccion
……$ 1
=
……2 3
dt
……4 6
.
……6 7
Transaccion
……7 B
.
……B C
id
……C E
,
……E F 
IdTransaccionPadre
  $ 6
=
  7 8
dt
  9 ;
.
  ; <
Transaccion
  < G
.
  G H"
id_transaccion_padre
  H \
??
  ] _
$num
  ` a
,
  a b
Fecha
ÀÀ$ )
=
ÀÀ* +
dt
ÀÀ, .
.
ÀÀ. /
Transaccion
ÀÀ/ :
.
ÀÀ: ;
fecha_inicio
ÀÀ; G
,
ÀÀG H
IdTipoTransaccion
ÃÃ$ 5
=
ÃÃ6 7
dt
ÃÃ8 :
.
ÃÃ: ;
Transaccion
ÃÃ; F
.
ÃÃF G!
id_tipo_transaccion
ÃÃG Z
,
ÃÃZ [
Cantidad
ÕÕ$ ,
=
ÕÕ- .
dt
ÕÕ/ 1
.
ÕÕ1 2
cantidad
ÕÕ2 :
,
ÕÕ: ;
ImporteUnitario
ŒŒ$ 3
=
ŒŒ4 5
dt
ŒŒ6 8
.
ŒŒ8 9
precio_unitario
ŒŒ9 H
,
ŒŒH I
ImporteTotal
œœ$ 0
=
œœ1 2
dt
œœ3 5
.
œœ5 6
total
œœ6 ;
,
œœ; <

IdConcepto
––$ .
=
––/ 0
dt
––1 3
.
––3 4!
id_concepto_negocio
––4 G
}
““  !
)
””  !
.
””! "
ToList
””" (
(
””( )
)
””) *
;
””* +
detalles
‘‘ 
.
‘‘ 
ForEach
‘‘  
(
‘‘  !
d
‘‘! "
=>
‘‘# %
d
‘‘& '
.
‘‘' (
	EsEntrada
‘‘( 1
=
‘‘2 3
Diccionario
‘‘4 ?
.
‘‘? @;
-TiposDeTransaccionMovimientoDeBienes_Entradas
‘‘@ m
.
‘‘m n
Contains
‘‘n v
(
‘‘v w
d
‘‘w x
.
‘‘x y 
IdTipoTransaccion‘‘y ä
)‘‘ä ã
)‘‘ã å
;‘‘å ç
return
’’ 
detalles
’’ 
.
’’  
OrderBy
’’  '
(
’’' (
dtk
’’( +
=>
’’, .
dtk
’’/ 2
.
’’2 3
Fecha
’’3 8
)
’’8 9
.
’’9 :
ThenBy
’’: @
(
’’@ A
dtk
’’A D
=>
’’E G
dtk
’’H K
.
’’K L
IdTransaccion
’’L Y
)
’’Y Z
;
’’Z [
}
÷÷ 
catch
◊◊ 
(
◊◊ 
	Exception
◊◊ 
e
◊◊ 
)
◊◊ 
{
ÿÿ 
throw
ÿÿ 
new
ÿÿ 
DatosException
ÿÿ &
(
ÿÿ& '
$str
ÿÿ' R
,
ÿÿR S
e
ÿÿT U
)
ÿÿU V
;
ÿÿV W
}
ÿÿX Y
}
ŸŸ 	
public
€€ 
IEnumerable
€€ 
<
€€ 
MovimientoAlmacen
€€ ,
>
€€, -:
,ObtenerMovimientosDeAlmacenesConOrdenYOrigen
€€. Z
(
€€Z [
int
€€[ ^
	idAlmacen
€€_ h
,
€€h i
int
€€j m
[
€€m n
]
€€n o"
idsConceptosNegocio€€p É
,€€É Ñ
DateTime€€Ö ç

fechaDesde€€é ò
,€€ò ô
DateTime€€ö ¢

fechaHasta€€£ ≠
)€€≠ Æ
{
‹‹ 	
try
›› 
{
ﬁﬁ 
SigescomEntities
ﬂﬂ  
_db
ﬂﬂ! $
=
ﬂﬂ% &
new
ﬂﬂ' *
SigescomEntities
ﬂﬂ+ ;
(
ﬂﬂ; <
)
ﬂﬂ< =
;
ﬂﬂ= >
var
·· 
movimientos
·· 
=
··  !+
ObtenerMovimientosDeAlmacenes
··" ?
(
··? @
	idAlmacen
··@ I
,
··I J!
idsConceptosNegocio
··K ^
,
··^ _

fechaDesde
··` j
,
··j k

fechaHasta
··l v
)
··v w
;
··w x
var
‚‚ ,
idsTiposTransaccionMovimientos
‚‚ 2
=
‚‚3 4
movimientos
‚‚5 @
.
‚‚@ A
Select
‚‚A G
(
‚‚G H
m
‚‚H I
=>
‚‚J L
m
‚‚M N
.
‚‚N O
IdTipoTransaccion
‚‚O `
)
‚‚` a
.
‚‚a b
Distinct
‚‚b j
(
‚‚j k
)
‚‚k l
.
‚‚l m
ToArray
‚‚m t
(
‚‚t u
)
‚‚u v
;
‚‚v w
var
„„ +
tiposOperacionSegunInventario
„„ 1
=
„„2 3
Diccionario
„„4 ?
.
„„? @R
CTiposDeTransaccionMovimientoDeBienesConCostoUnitarioSegunInventario„„@ É
;„„É Ñ
var
‰‰ &
tiposOperacionSegunOrden
‰‰ ,
=
‰‰- .
Diccionario
‰‰/ :
.
‰‰: ;T
ETiposDeTransaccionMovimientoDeBienesConCostoUnitarioObtenidoDeLaOrden‰‰; Ä
;‰‰Ä Å
var
ÂÂ 2
$tiposOperacionSegunTransaccionOrigen
ÂÂ 8
=
ÂÂ9 :
Diccionario
ÂÂ; F
.
ÂÂF Gj
[TiposDeTransaccionMovimientoDeBienesConCostoUnitarioObtenidoDeMovimientoDeTransaccionOrigenÂÂG ¢
;ÂÂ¢ £
var
ÊÊ +
idsTiposTransaccionMovimiento
ÊÊ 1
=
ÊÊ2 3
Diccionario
ÊÊ4 ?
.
ÊÊ? @;
-TiposDeTransaccionMovimientoDeBienes_Entradas
ÊÊ@ m
.
ÊÊm n
Union
ÊÊn s
(
ÊÊs t
Diccionario
ÊÊt 
.ÊÊ Ä<
,TiposDeTransaccionMovimientoDeBienes_SalidasÊÊÄ ¨
)ÊÊ¨ ≠
.ÊÊ≠ Æ
ToArrayÊÊÆ µ
(ÊÊµ ∂
)ÊÊ∂ ∑
;ÊÊ∑ ∏
var
ÁÁ #
movimientosSegunOrden
ÁÁ )
=
ÁÁ* +
movimientos
ÁÁ, 7
.
ÁÁ7 8
Where
ÁÁ8 =
(
ÁÁ= >
m
ÁÁ> ?
=>
ÁÁ@ B&
tiposOperacionSegunOrden
ÁÁC [
.
ÁÁ[ \
Contains
ÁÁ\ d
(
ÁÁd e
m
ÁÁe f
.
ÁÁf g
IdTipoTransaccion
ÁÁg x
)
ÁÁx y
)
ÁÁy z
.
ÁÁz {
ToListÁÁ{ Å
(ÁÁÅ Ç
)ÁÁÇ É
;ÁÁÉ Ñ
var
ËË :
,movimientosSegunOrdenAgrupadosPorTransaccion
ËË @
=
ËËA B#
movimientosSegunOrden
ËËC X
.
ËËX Y
GroupBy
ËËY `
(
ËË` a
mso
ËËa d
=>
ËËe g
mso
ËËh k
.
ËËk l
IdTransaccion
ËËl y
)
ËËy z
;
ËËz {
var
ÈÈ %
idsTipoTransaccionOrden
ÈÈ +
=
ÈÈ, -
Diccionario
ÈÈ. 9
.
ÈÈ9 :-
MapeoOrdenVsMovimientoDeAlmacen
ÈÈ: Y
.
ÈÈY Z
Where
ÈÈZ _
(
ÈÈ_ `
t
ÈÈ` a
=>
ÈÈb d-
idsTiposTransaccionMovimientosÈÈe É
.ÈÈÉ Ñ
ContainsÈÈÑ å
(ÈÈå ç
tÈÈç é
.ÈÈé è
ValueÈÈè î
)ÈÈî ï
)ÈÈï ñ
.ÈÈñ ó
SelectÈÈó ù
(ÈÈù û
tÈÈû ü
=>ÈÈ† ¢
tÈÈ£ §
.ÈÈ§ •
KeyÈÈ• ®
)ÈÈ® ©
.ÈÈ© ™
ToArrayÈÈ™ ±
(ÈÈ± ≤
)ÈÈ≤ ≥
;ÈÈ≥ ¥
var
ÏÏ 8
*idsTransaccionesPadreMovimientosSegunOrden
ÏÏ >
=
ÏÏ? @#
movimientosSegunOrden
ÏÏA V
.
ÏÏV W
Select
ÏÏW ]
(
ÏÏ] ^
m
ÏÏ^ _
=>
ÏÏ` b
m
ÏÏc d
.
ÏÏd e 
IdTransaccionPadre
ÏÏe w
)
ÏÏw x
.
ÏÏx y
DistinctÏÏy Å
(ÏÏÅ Ç
)ÏÏÇ É
.ÏÏÉ Ñ
ToArrayÏÏÑ ã
(ÏÏã å
)ÏÏå ç
;ÏÏç é
var
ÌÌ +
transaccionesOrdenConDetalles
ÌÌ 1
=
ÌÌ2 3
_db
ÌÌ4 7
.
ÌÌ7 8
Transaccion
ÌÌ8 C
.
ÌÌC D
Where
ÌÌD I
(
ÌÌI J
t
ÌÌJ K
=>
ÌÌL N8
*idsTransaccionesPadreMovimientosSegunOrden
ÌÌO y
.
ÌÌy z
ContainsÌÌz Ç
(ÌÌÇ É
tÌÌÉ Ñ
.ÌÌÑ Ö$
id_transaccion_padreÌÌÖ ô
)ÌÌô ö
&&ÌÌõ ù'
idsTipoTransaccionOrdenÌÌû µ
.ÌÌµ ∂
ContainsÌÌ∂ æ
(ÌÌæ ø
tÌÌø ¿
.ÌÌ¿ ¡#
id_tipo_transaccionÌÌ¡ ‘
)ÌÌ‘ ’
)ÌÌ’ ÷
.ÌÌ÷ ◊
IncludeÌÌ◊ ﬁ
(ÌÌﬁ ﬂ
tÌÌﬂ ‡
=>ÌÌ· „
tÌÌ‰ Â
.ÌÌÂ Ê#
Detalle_transaccionÌÌÊ ˘
)ÌÌ˘ ˙
.ÌÌ˙ ˚
ToListÌÌ˚ Å
(ÌÌÅ Ç
)ÌÌÇ É
;ÌÌÉ Ñ
foreach
ÔÔ 
(
ÔÔ 
var
ÔÔ 
g
ÔÔ 
in
ÔÔ !:
,movimientosSegunOrdenAgrupadosPorTransaccion
ÔÔ" N
)
ÔÔN O
{
 
long
ÒÒ 
?
ÒÒ  
idTransaccionPadre
ÒÒ ,
=
ÒÒ- .
g
ÒÒ/ 0
.
ÒÒ0 1
First
ÒÒ1 6
(
ÒÒ6 7
)
ÒÒ7 8
.
ÒÒ8 9 
IdTransaccionPadre
ÒÒ9 K
;
ÒÒK L
var
ÚÚ (
transaccionOrdenConDetalle
ÚÚ 2
=
ÚÚ3 4+
transaccionesOrdenConDetalles
ÚÚ5 R
.
ÚÚR S
FirstOrDefault
ÚÚS a
(
ÚÚa b
t
ÚÚb c
=>
ÚÚd f
t
ÚÚg h
.
ÚÚh i"
id_transaccion_padre
ÚÚi }
==ÚÚ~ Ä"
idTransaccionPadreÚÚÅ ì
)ÚÚì î
;ÚÚî ï
if
ÛÛ 
(
ÛÛ (
transaccionOrdenConDetalle
ÛÛ 2
!=
ÛÛ3 5
null
ÛÛ6 :
)
ÛÛ: ;
{
ÙÙ 
List
ıı 
<
ıı !
Detalle_transaccion
ıı 0
>
ıı0 1
detallesOrden
ıı2 ?
=
ıı@ A(
transaccionOrdenConDetalle
ııB \
.
ıı\ ]!
Detalle_transaccion
ıı] p
.
ııp q
ToList
ııq w
(
ııw x
)
ııx y
;
ııy z
g
ˆˆ 
.
ˆˆ 
ToList
ˆˆ  
(
ˆˆ  !
)
ˆˆ! "
.
ˆˆ" #
ForEach
ˆˆ# *
(
ˆˆ* +
m
ˆˆ+ ,
=>
ˆˆ- /
{
˜˜ !
Detalle_transaccion
¯¯ /
detalleOrden
¯¯0 <
=
¯¯= >
detallesOrden
¯¯? L
.
¯¯L M
FirstOrDefault
¯¯M [
(
¯¯[ \
d
¯¯\ ]
=>
¯¯^ `
d
¯¯a b
.
¯¯b c!
id_concepto_negocio
¯¯c v
==
¯¯w y
m
¯¯z {
.
¯¯{ |

IdConcepto¯¯| Ü
&&¯¯á â
d¯¯ä ã
.¯¯ã å
cantidad¯¯å î
==¯¯ï ó
m¯¯ò ô
.¯¯ô ö
Cantidad¯¯ö ¢
)¯¯¢ £
;¯¯£ §
m
˘˘ 
.
˘˘ 
ImporteTotalOrden
˘˘ /
=
˘˘0 1
detalleOrden
˘˘2 >
.
˘˘> ?
total
˘˘? D
;
˘˘D E
m
˙˙ 
.
˙˙ 
IgvOrden
˙˙ &
=
˙˙' (
detalleOrden
˙˙) 5
.
˙˙5 6
igv
˙˙6 9
;
˙˙9 :
}
˚˚ 
)
˚˚ 
;
˚˚ 
}
¸¸ 
}
˝˝ 
var
ˇˇ .
 movimientosSegunMovimientoOrigen
ˇˇ 4
=
ˇˇ5 6
movimientos
ˇˇ7 B
.
ˇˇB C
Where
ˇˇC H
(
ˇˇH I
m
ˇˇI J
=>
ˇˇK M2
$tiposOperacionSegunTransaccionOrigen
ˇˇN r
.
ˇˇr s
Contains
ˇˇs {
(
ˇˇ{ |
m
ˇˇ| }
.
ˇˇ} ~ 
IdTipoTransaccionˇˇ~ è
)ˇˇè ê
)ˇˇê ë
.ˇˇë í
ToListˇˇí ò
(ˇˇò ô
)ˇˇô ö
;ˇˇö õ
var
ÅÅ 1
#idsmovimientosSegunMovimientoOrigen
ÅÅ 7
=
ÅÅ8 9.
 movimientosSegunMovimientoOrigen
ÅÅ: Z
.
ÅÅZ [
Select
ÅÅ[ a
(
ÅÅa b
m
ÅÅb c
=>
ÅÅd f
m
ÅÅg h
.
ÅÅh i
IdTransaccion
ÅÅi v
)
ÅÅv w
;
ÅÅw x
var
ÇÇ ;
-transaccionesReferenciaMovimientosSegunOrigen
ÇÇ A
=
ÇÇB C
_db
ÇÇD G
.
ÇÇG H
Transaccion
ÇÇH S
.
ÇÇS T
Where
ÇÇT Y
(
ÇÇY Z
t
ÇÇZ [
=>
ÇÇ\ ^2
#idsmovimientosSegunMovimientoOrigenÇÇ_ Ç
.ÇÇÇ É
ContainsÇÇÉ ã
(ÇÇã å
tÇÇå ç
.ÇÇç é
idÇÇé ê
)ÇÇê ë
&&ÇÇí î
tÇÇï ñ
.ÇÇñ ó
Transaccion3ÇÇó £
!=ÇÇ§ ¶
nullÇÇß ´
)ÇÇ´ ¨
.ÇÇ¨ ≠
SelectÇÇ≠ ≥
(ÇÇ≥ ¥
ttÇÇ¥ ∂
=>ÇÇ∑ π
newÇÇ∫ Ω
{ÇÇæ ø
TransaccionÇÇ¿ À
=ÇÇÃ Õ
ttÇÇŒ –
,ÇÇ– —
IdOrigenÇÇ“ ⁄
=ÇÇ€ ‹
ttÇÇ› ﬂ
.ÇÇﬂ ‡
Transaccion3ÇÇ‡ Ï
.ÇÇÏ Ì
Transaccion3ÇÇÌ ˘
.ÇÇ˘ ˙
Transaccion11ÇÇ˙ á
.ÇÇá à
FirstOrDefaultÇÇà ñ
(ÇÇñ ó
_tÇÇó ô
=>ÇÇö ú-
idsTiposTransaccionMovimientoÇÇù ∫
.ÇÇ∫ ª
ContainsÇÇª √
(ÇÇ√ ƒ
_tÇÇƒ ∆
.ÇÇ∆ «#
id_tipo_transaccionÇÇ« ⁄
)ÇÇ⁄ €
)ÇÇ€ ‹
.ÇÇ‹ ›
idÇÇ› ﬂ
}ÇÇ‡ ·
)ÇÇ· ‚
.ÇÇ‚ „
ToListÇÇ„ È
(ÇÇÈ Í
)ÇÇÍ Î
;ÇÇÎ Ï.
 movimientosSegunMovimientoOrigen
ÑÑ 0
.
ÑÑ0 1
ForEach
ÑÑ1 8
(
ÑÑ8 9
m
ÑÑ9 :
=>
ÑÑ; =
{
ÖÖ 
var
ÜÜ #
transaccionReferencia
ÜÜ -
=
ÜÜ. /;
-transaccionesReferenciaMovimientosSegunOrigen
ÜÜ0 ]
.
ÜÜ] ^
FirstOrDefault
ÜÜ^ l
(
ÜÜl m
tt
ÜÜm o
=>
ÜÜp r
tt
ÜÜs u
.
ÜÜu v
TransaccionÜÜv Å
.ÜÜÅ Ç
idÜÜÇ Ñ
==ÜÜÖ á
mÜÜà â
.ÜÜâ ä
IdTransaccionÜÜä ó
)ÜÜó ò
;ÜÜò ô
if
áá 
(
áá #
transaccionReferencia
áá -
!=
áá. 0
null
áá1 5
)
áá5 6
{
àà 
m
ââ 
.
ââ +
IdTransaccionMovimientoOrigen
ââ 7
=
ââ8 9#
transaccionReferencia
ââ: O
.
ââO P
IdOrigen
ââP X
;
ââX Y
}
ää 
}
åå 
)
åå 
;
åå 
return
çç 
movimientos
çç "
;
çç" #
}
éé 
catch
èè 
(
èè 
	Exception
èè 
e
èè 
)
èè 
{
êê 
throw
ëë 
new
ëë 
DatosException
ëë (
(
ëë( )
$str
ëë) T
,
ëëT U
e
ëëV W
)
ëëW X
;
ëëX Y
}
íí 
}
ìì 	
public
ïï 
IEnumerable
ïï 
<
ïï 
EntradaAlmacen
ïï )
>
ïï) *
ObtenerEntradas
ïï+ :
(
ïï: ;
int
ïï; >
	idAlmacen
ïï? H
,
ïïH I
DateTime
ïïJ R

fechaDesde
ïïS ]
,
ïï] ^
DateTime
ïï_ g

fechaHasta
ïïh r
)
ïïr s
{
ññ 	
SigescomEntities
óó 
_db
óó  
=
óó! "
new
óó# &
SigescomEntities
óó' 7
(
óó7 8
)
óó8 9
;
óó9 :
var
òò 
entradas
òò 
=
òò 
_db
òò 
.
òò 4
&Accion_de_negocio_por_tipo_transaccion
òò E
.
ôô  !
Where
ôô! &
(
ôô& '
antt
ôô' +
=>
ôô, .
antt
ôô/ 3
.
ôô3 4"
id_accion_de_negocio
ôô4 H
==
ôôI K!
TransaccionSettings
ôôL _
.
ôô_ `
Default
ôô` g
.
ôôg h3
$IdAccionDeNegocioMovimientoEnAlmacenôôh å
&&ôôç è
anttôôê î
.ôôî ï
valorôôï ö
==ôôõ ù
trueôôû ¢
)ôô¢ £
.
öö  !

SelectMany
öö! +
(
öö+ ,
antt
öö, 0
=>
öö1 3
antt
öö4 8
.
öö8 9
Tipo_transaccion
öö9 I
.
ööI J
Transaccion
ööJ U
)
ööU V
.
õõ  !
Where
õõ! &
(
õõ& '
t
õõ' (
=>
õõ) +
t
õõ, -
.
õõ- .
fecha_inicio
õõ. :
>=
õõ; =

fechaDesde
õõ> H
&&
õõI K
t
õõL M
.
õõM N
fecha_inicio
õõN Z
<=
õõ[ ]

fechaHasta
õõ^ h
&&
õõi k
t
õõl m
.
õõm n'
id_actor_negocio_internoõõn Ü
==õõá â
	idAlmacenõõä ì
&&õõî ñ
tõõó ò
.õõò ô 
id_estado_actualõõô ©
==õõ™ ¨
MaestroSettingsõõ≠ º
.õõº Ω
DefaultõõΩ ƒ
.õõƒ ≈0
 IdDetalleMaestroEstadoConfirmadoõõ≈ Â
)õõÂ Ê
.
úú  !

SelectMany
úú! +
(
úú+ ,
t
úú, -
=>
úú. 0
t
úú1 2
.
úú2 3!
Detalle_transaccion
úú3 F
)
úúF G
.
ùù  !
Select
ùù! '
(
ùù' (
dt
ùù( *
=>
ùù+ -
new
ùù. 1
EntradaAlmacen
ùù2 @
(
ùù@ A
)
ùùA B
{
ûû  !
Fecha
üü$ )
=
üü* +
dt
üü, .
.
üü. /
Transaccion
üü/ :
.
üü: ;
fecha_inicio
üü; G
,
üüG H
	Operacion
††$ -
=
††. /
dt
††0 2
.
††2 3
Transaccion
††3 >
.
††> ?
Tipo_transaccion
††? O
.
††O P
nombre
††P V
,
††V W
Origen
°°$ *
=
°°+ ,
dt
°°- /
.
°°/ 0
Transaccion
°°0 ;
.
°°; <
Actor_negocio1
°°< J
.
°°J K
Actor
°°K P
.
°°P Q
primer_nombre
°°Q ^
.
°°^ _
Replace
°°_ f
(
°°f g
$str
°°g j
,
°°j k
$str
°°l o
)
°°o p
,
°°p q
Empleado
¢¢$ ,
=
¢¢- .
dt
¢¢/ 1
.
¢¢1 2
Transaccion
¢¢2 =
.
¢¢= >
Actor_negocio
¢¢> K
.
¢¢K L
Actor
¢¢L Q
.
¢¢Q R
primer_nombre
¢¢R _
.
¢¢_ `
Replace
¢¢` g
(
¢¢g h
$str
¢¢h k
,
¢¢k l
$str
¢¢m p
)
¢¢p q
,
¢¢q r
TipoComprobante
££$ 3
=
££4 5
dt
££6 8
.
££8 9
Transaccion
££9 D
.
££D E
Comprobante
££E P
.
££P Q
Detalle_maestro
££Q `
.
££` a
valor
££a f
,
££f g%
SerieYNumeroComprobante
§§$ ;
=
§§< =
dt
§§> @
.
§§@ A
Transaccion
§§A L
.
§§L M
Comprobante
§§M X
.
§§X Y
numero_serie
§§Y e
+
§§f g
$str
§§h k
+
§§l m
dt
§§n p
.
§§p q
Transaccion
§§q |
.
§§| }
Comprobante§§} à
.§§à â
numero§§â è
,§§è ê
Cantidad
••$ ,
=
••- .
dt
••/ 1
.
••1 2
cantidad
••2 :
,
••: ;
Concepto
¶¶$ ,
=
¶¶- .
dt
¶¶/ 1
.
¶¶1 2
Concepto_negocio
¶¶2 B
.
¶¶B C
nombre
¶¶C I
}
®®  !
)
©©  !
;
©©! "
return
´´ 
entradas
´´ 
;
´´ 
}
¨¨ 	
public
≠≠ 
IEnumerable
≠≠ 
<
≠≠ 
EntradaAlmacen
≠≠ )
>
≠≠) *
ObtenerEntradas
≠≠+ :
(
≠≠: ;
int
≠≠; >
	idAlmacen
≠≠? H
,
≠≠H I
DateTime
≠≠J R

fechaDesde
≠≠S ]
,
≠≠] ^
DateTime
≠≠_ g

fechaHasta
≠≠h r
,
≠≠r s
int
≠≠t w
[
≠≠w x
]
≠≠x y
familias≠≠z Ç
)≠≠Ç É
{
ÆÆ 	
SigescomEntities
ØØ 
_db
ØØ  
=
ØØ! "
new
ØØ# &
SigescomEntities
ØØ' 7
(
ØØ7 8
)
ØØ8 9
;
ØØ9 :
var
∞∞ 
entradas
∞∞ 
=
∞∞ 
_db
∞∞ 
.
∞∞ 4
&Accion_de_negocio_por_tipo_transaccion
∞∞ E
.
±±  !
Where
±±! &
(
±±& '
antt
±±' +
=>
±±, .
antt
±±/ 3
.
±±3 4"
id_accion_de_negocio
±±4 H
==
±±I K!
TransaccionSettings
±±L _
.
±±_ `
Default
±±` g
.
±±g h3
$IdAccionDeNegocioMovimientoEnAlmacen±±h å
&&±±ç è
antt±±ê î
.±±î ï
valor±±ï ö
==±±õ ù
true±±û ¢
)±±¢ £
.
≤≤  !

SelectMany
≤≤! +
(
≤≤+ ,
antt
≤≤, 0
=>
≤≤1 3
antt
≤≤4 8
.
≤≤8 9
Tipo_transaccion
≤≤9 I
.
≤≤I J
Transaccion
≤≤J U
)
≤≤U V
.
≥≥  !
Where
≥≥! &
(
≥≥& '
t
≥≥' (
=>
≥≥) +
t
≥≥, -
.
≥≥- .
fecha_inicio
≥≥. :
>=
≥≥; =

fechaDesde
≥≥> H
&&
≥≥I K
t
≥≥L M
.
≥≥M N
fecha_inicio
≥≥N Z
<=
≥≥[ ]

fechaHasta
≥≥^ h
&&
≥≥i k
t
≥≥l m
.
≥≥m n'
id_actor_negocio_interno≥≥n Ü
==≥≥á â
	idAlmacen≥≥ä ì
&&≥≥î ñ
t≥≥ó ò
.≥≥ò ô 
id_estado_actual≥≥ô ©
==≥≥™ ¨
MaestroSettings≥≥≠ º
.≥≥º Ω
Default≥≥Ω ƒ
.≥≥ƒ ≈0
 IdDetalleMaestroEstadoConfirmado≥≥≈ Â
)≥≥Â Ê
.
¥¥  !

SelectMany
¥¥! +
(
¥¥+ ,
t
¥¥, -
=>
¥¥. 0
t
¥¥1 2
.
¥¥2 3!
Detalle_transaccion
¥¥3 F
)
¥¥F G
.
µµ  !
Where
µµ! &
(
µµ& '
dt
µµ' )
=>
µµ* ,
familias
µµ- 5
.
µµ5 6
Contains
µµ6 >
(
µµ> ?
dt
µµ? A
.
µµA B
Concepto_negocio
µµB R
.
µµR S 
id_concepto_basico
µµS e
)
µµe f
)
µµf g
.
∂∂  !
Select
∂∂! '
(
∂∂' (
dt
∂∂( *
=>
∂∂+ -
new
∂∂. 1
EntradaAlmacen
∂∂2 @
(
∂∂@ A
)
∂∂A B
{
∑∑  !
Fecha
∏∏$ )
=
∏∏* +
dt
∏∏, .
.
∏∏. /
Transaccion
∏∏/ :
.
∏∏: ;
fecha_inicio
∏∏; G
,
∏∏G H
	Operacion
ππ$ -
=
ππ. /
dt
ππ0 2
.
ππ2 3
Transaccion
ππ3 >
.
ππ> ?
Tipo_transaccion
ππ? O
.
ππO P
nombre
ππP V
,
ππV W
Origen
∫∫$ *
=
∫∫+ ,
dt
∫∫- /
.
∫∫/ 0
Transaccion
∫∫0 ;
.
∫∫; <
Actor_negocio1
∫∫< J
.
∫∫J K
Actor
∫∫K P
.
∫∫P Q
primer_nombre
∫∫Q ^
.
∫∫^ _
Replace
∫∫_ f
(
∫∫f g
$str
∫∫g j
,
∫∫j k
$str
∫∫l o
)
∫∫o p
,
∫∫p q
Empleado
ªª$ ,
=
ªª- .
dt
ªª/ 1
.
ªª1 2
Transaccion
ªª2 =
.
ªª= >
Actor_negocio
ªª> K
.
ªªK L
Actor
ªªL Q
.
ªªQ R
primer_nombre
ªªR _
.
ªª_ `
Replace
ªª` g
(
ªªg h
$str
ªªh k
,
ªªk l
$str
ªªm p
)
ªªp q
,
ªªq r
TipoComprobante
ºº$ 3
=
ºº4 5
dt
ºº6 8
.
ºº8 9
Transaccion
ºº9 D
.
ººD E
Comprobante
ººE P
.
ººP Q
Detalle_maestro
ººQ `
.
ºº` a
valor
ººa f
,
ººf g%
SerieYNumeroComprobante
ΩΩ$ ;
=
ΩΩ< =
dt
ΩΩ> @
.
ΩΩ@ A
Transaccion
ΩΩA L
.
ΩΩL M
Comprobante
ΩΩM X
.
ΩΩX Y
numero_serie
ΩΩY e
+
ΩΩf g
$str
ΩΩh k
+
ΩΩl m
dt
ΩΩn p
.
ΩΩp q
Transaccion
ΩΩq |
.
ΩΩ| }
ComprobanteΩΩ} à
.ΩΩà â
numeroΩΩâ è
,ΩΩè ê
Cantidad
ææ$ ,
=
ææ- .
dt
ææ/ 1
.
ææ1 2
cantidad
ææ2 :
,
ææ: ;
Concepto
øø$ ,
=
øø- .
dt
øø/ 1
.
øø1 2
Concepto_negocio
øø2 B
.
øøB C
nombre
øøC I
}
¡¡  !
)
¬¬  !
;
¬¬! "
return
ƒƒ 
entradas
ƒƒ 
;
ƒƒ 
}
≈≈ 	
public
«« 
IEnumerable
«« 
<
«« 
SalidaAlmacen
«« (
>
««( )
ObtenerSalidas
««* 8
(
««8 9
int
««9 <
	idAlmacen
««= F
,
««F G
DateTime
««H P

fechaDesde
««Q [
,
««[ \
DateTime
««] e

fechaHasta
««f p
)
««p q
{
»» 	
SigescomEntities
…… 
_db
……  
=
……! "
new
……# &
SigescomEntities
……' 7
(
……7 8
)
……8 9
;
……9 :
var
   
salidas
   
=
   
_db
   
.
   4
&Accion_de_negocio_por_tipo_transaccion
   D
.
ÀÀ  !
Where
ÀÀ! &
(
ÀÀ& '
antt
ÀÀ' +
=>
ÀÀ, .
antt
ÀÀ/ 3
.
ÀÀ3 4"
id_accion_de_negocio
ÀÀ4 H
==
ÀÀI K!
TransaccionSettings
ÀÀL _
.
ÀÀ_ `
Default
ÀÀ` g
.
ÀÀg h3
$IdAccionDeNegocioMovimientoEnAlmacenÀÀh å
&&ÀÀç è
anttÀÀê î
.ÀÀî ï
valorÀÀï ö
==ÀÀõ ù
falseÀÀû £
)ÀÀ£ §
.
ÃÃ  !

SelectMany
ÃÃ! +
(
ÃÃ+ ,
antt
ÃÃ, 0
=>
ÃÃ1 3
antt
ÃÃ4 8
.
ÃÃ8 9
Tipo_transaccion
ÃÃ9 I
.
ÃÃI J
Transaccion
ÃÃJ U
)
ÃÃU V
.
ÕÕ  !
Where
ÕÕ! &
(
ÕÕ& '
t
ÕÕ' (
=>
ÕÕ) +
t
ÕÕ, -
.
ÕÕ- .
fecha_inicio
ÕÕ. :
>=
ÕÕ; =

fechaDesde
ÕÕ> H
&&
ÕÕI K
t
ÕÕL M
.
ÕÕM N
fecha_inicio
ÕÕN Z
<=
ÕÕ[ ]

fechaHasta
ÕÕ^ h
&&
ÕÕi k
t
ÕÕl m
.
ÕÕm n'
id_actor_negocio_internoÕÕn Ü
==ÕÕá â
	idAlmacenÕÕä ì
&&ÕÕî ñ
tÕÕó ò
.ÕÕò ô 
id_estado_actualÕÕô ©
==ÕÕ™ ¨
MaestroSettingsÕÕ≠ º
.ÕÕº Ω
DefaultÕÕΩ ƒ
.ÕÕƒ ≈0
 IdDetalleMaestroEstadoConfirmadoÕÕ≈ Â
)ÕÕÂ Ê
.
ŒŒ  !

SelectMany
ŒŒ! +
(
ŒŒ+ ,
t
ŒŒ, -
=>
ŒŒ. 0
t
ŒŒ1 2
.
ŒŒ2 3!
Detalle_transaccion
ŒŒ3 F
)
ŒŒF G
.
œœ  !
Select
œœ! '
(
œœ' (
dt
œœ( *
=>
œœ+ -
new
œœ. 1
SalidaAlmacen
œœ2 ?
(
œœ? @
)
œœ@ A
{
––  !
Fecha
——$ )
=
——* +
dt
——, .
.
——. /
Transaccion
——/ :
.
——: ;
fecha_inicio
——; G
,
——G H
	Operacion
““$ -
=
““. /
dt
““0 2
.
““2 3
Transaccion
““3 >
.
““> ?
Tipo_transaccion
““? O
.
““O P
nombre
““P V
,
““V W
Destino
””$ +
=
””, -
dt
””. 0
.
””0 1
Transaccion
””1 <
.
””< =
Actor_negocio1
””= K
.
””K L
Actor
””L Q
.
””Q R
primer_nombre
””R _
.
””_ `
Replace
””` g
(
””g h
$str
””h k
,
””k l
$str
””m p
)
””p q
,
””q r
Empleado
‘‘$ ,
=
‘‘- .
dt
‘‘/ 1
.
‘‘1 2
Transaccion
‘‘2 =
.
‘‘= >
Actor_negocio
‘‘> K
.
‘‘K L
Actor
‘‘L Q
.
‘‘Q R
primer_nombre
‘‘R _
.
‘‘_ `
Replace
‘‘` g
(
‘‘g h
$str
‘‘h k
,
‘‘k l
$str
‘‘m p
)
‘‘p q
,
‘‘q r
TipoComprobante
’’$ 3
=
’’4 5
dt
’’6 8
.
’’8 9
Transaccion
’’9 D
.
’’D E
Comprobante
’’E P
.
’’P Q
Detalle_maestro
’’Q `
.
’’` a
valor
’’a f
,
’’f g%
SerieYNumeroComprobante
÷÷$ ;
=
÷÷< =
dt
÷÷> @
.
÷÷@ A
Transaccion
÷÷A L
.
÷÷L M
Comprobante
÷÷M X
.
÷÷X Y
numero_serie
÷÷Y e
+
÷÷f g
$str
÷÷h k
+
÷÷l m
dt
÷÷n p
.
÷÷p q
Transaccion
÷÷q |
.
÷÷| }
Comprobante÷÷} à
.÷÷à â
numero÷÷â è
,÷÷è ê
Cantidad
◊◊$ ,
=
◊◊- .
dt
◊◊/ 1
.
◊◊1 2
cantidad
◊◊2 :
,
◊◊: ;
Concepto
ÿÿ$ ,
=
ÿÿ- .
dt
ÿÿ/ 1
.
ÿÿ1 2
Concepto_negocio
ÿÿ2 B
.
ÿÿB C
nombre
ÿÿC I
}
ŸŸ  !
)
⁄⁄  !
;
⁄⁄! "
return
€€ 
salidas
€€ 
;
€€ 
}
‹‹ 	
public
›› 
IEnumerable
›› 
<
›› 
SalidaAlmacen
›› (
>
››( )
ObtenerSalidas
››* 8
(
››8 9
int
››9 <
	idAlmacen
››= F
,
››F G
DateTime
››H P

fechaDesde
››Q [
,
››[ \
DateTime
››] e

fechaHasta
››f p
,
››p q
int
››r u
[
››u v
]
››v w
familias››x Ä
)››Ä Å
{
ﬁﬁ 	
SigescomEntities
ﬂﬂ 
_db
ﬂﬂ  
=
ﬂﬂ! "
new
ﬂﬂ# &
SigescomEntities
ﬂﬂ' 7
(
ﬂﬂ7 8
)
ﬂﬂ8 9
;
ﬂﬂ9 :
var
‡‡ 
salidas
‡‡ 
=
‡‡ 
_db
‡‡ 
.
‡‡ 4
&Accion_de_negocio_por_tipo_transaccion
‡‡ D
.
··  !
Where
··! &
(
··& '
antt
··' +
=>
··, .
antt
··/ 3
.
··3 4"
id_accion_de_negocio
··4 H
==
··I K!
TransaccionSettings
··L _
.
··_ `
Default
··` g
.
··g h3
$IdAccionDeNegocioMovimientoEnAlmacen··h å
&&··ç è
antt··ê î
.··î ï
valor··ï ö
==··õ ù
false··û £
)··£ §
.
‚‚  !

SelectMany
‚‚! +
(
‚‚+ ,
antt
‚‚, 0
=>
‚‚1 3
antt
‚‚4 8
.
‚‚8 9
Tipo_transaccion
‚‚9 I
.
‚‚I J
Transaccion
‚‚J U
)
‚‚U V
.
„„  !
Where
„„! &
(
„„& '
t
„„' (
=>
„„) +
t
„„, -
.
„„- .
fecha_inicio
„„. :
>=
„„; =

fechaDesde
„„> H
&&
„„I K
t
„„L M
.
„„M N
fecha_inicio
„„N Z
<=
„„[ ]

fechaHasta
„„^ h
&&
„„i k
t
„„l m
.
„„m n'
id_actor_negocio_interno„„n Ü
==„„á â
	idAlmacen„„ä ì
&&„„î ñ
t„„ó ò
.„„ò ô 
id_estado_actual„„ô ©
==„„™ ¨
MaestroSettings„„≠ º
.„„º Ω
Default„„Ω ƒ
.„„ƒ ≈0
 IdDetalleMaestroEstadoConfirmado„„≈ Â
)„„Â Ê
.
‰‰  !

SelectMany
‰‰! +
(
‰‰+ ,
t
‰‰, -
=>
‰‰. 0
t
‰‰1 2
.
‰‰2 3!
Detalle_transaccion
‰‰3 F
)
‰‰F G
.
ÂÂ  !
Where
ÂÂ! &
(
ÂÂ& '
dt
ÂÂ' )
=>
ÂÂ* ,
familias
ÂÂ- 5
.
ÂÂ5 6
Contains
ÂÂ6 >
(
ÂÂ> ?
dt
ÂÂ? A
.
ÂÂA B
Concepto_negocio
ÂÂB R
.
ÂÂR S 
id_concepto_basico
ÂÂS e
)
ÂÂe f
)
ÂÂf g
.
ÊÊ  !
Select
ÊÊ! '
(
ÊÊ' (
dt
ÊÊ( *
=>
ÊÊ+ -
new
ÊÊ. 1
SalidaAlmacen
ÊÊ2 ?
(
ÊÊ? @
)
ÊÊ@ A
{
ÁÁ  !
Fecha
ËË$ )
=
ËË* +
dt
ËË, .
.
ËË. /
Transaccion
ËË/ :
.
ËË: ;
fecha_inicio
ËË; G
,
ËËG H
	Operacion
ÈÈ$ -
=
ÈÈ. /
dt
ÈÈ0 2
.
ÈÈ2 3
Transaccion
ÈÈ3 >
.
ÈÈ> ?
Tipo_transaccion
ÈÈ? O
.
ÈÈO P
nombre
ÈÈP V
,
ÈÈV W
Destino
ÍÍ$ +
=
ÍÍ, -
dt
ÍÍ. 0
.
ÍÍ0 1
Transaccion
ÍÍ1 <
.
ÍÍ< =
Actor_negocio1
ÍÍ= K
.
ÍÍK L
Actor
ÍÍL Q
.
ÍÍQ R
primer_nombre
ÍÍR _
.
ÍÍ_ `
Replace
ÍÍ` g
(
ÍÍg h
$str
ÍÍh k
,
ÍÍk l
$str
ÍÍm p
)
ÍÍp q
,
ÍÍq r
Empleado
ÎÎ$ ,
=
ÎÎ- .
dt
ÎÎ/ 1
.
ÎÎ1 2
Transaccion
ÎÎ2 =
.
ÎÎ= >
Actor_negocio
ÎÎ> K
.
ÎÎK L
Actor
ÎÎL Q
.
ÎÎQ R
primer_nombre
ÎÎR _
.
ÎÎ_ `
Replace
ÎÎ` g
(
ÎÎg h
$str
ÎÎh k
,
ÎÎk l
$str
ÎÎm p
)
ÎÎp q
,
ÎÎq r
TipoComprobante
ÏÏ$ 3
=
ÏÏ4 5
dt
ÏÏ6 8
.
ÏÏ8 9
Transaccion
ÏÏ9 D
.
ÏÏD E
Comprobante
ÏÏE P
.
ÏÏP Q
Detalle_maestro
ÏÏQ `
.
ÏÏ` a
valor
ÏÏa f
,
ÏÏf g%
SerieYNumeroComprobante
ÌÌ$ ;
=
ÌÌ< =
dt
ÌÌ> @
.
ÌÌ@ A
Transaccion
ÌÌA L
.
ÌÌL M
Comprobante
ÌÌM X
.
ÌÌX Y
numero_serie
ÌÌY e
+
ÌÌf g
$str
ÌÌh k
+
ÌÌl m
dt
ÌÌn p
.
ÌÌp q
Transaccion
ÌÌq |
.
ÌÌ| }
ComprobanteÌÌ} à
.ÌÌà â
numeroÌÌâ è
,ÌÌè ê
Cantidad
ÓÓ$ ,
=
ÓÓ- .
dt
ÓÓ/ 1
.
ÓÓ1 2
cantidad
ÓÓ2 :
,
ÓÓ: ;
Concepto
ÔÔ$ ,
=
ÔÔ- .
dt
ÔÔ/ 1
.
ÔÔ1 2
Concepto_negocio
ÔÔ2 B
.
ÔÔB C
nombre
ÔÔC I
}
  !
)
ÒÒ  !
;
ÒÒ! "
return
ÚÚ 
salidas
ÚÚ 
;
ÚÚ 
}
ÛÛ 	
public
ÙÙ @
2Movimientos_concepto_negocio_actor_negocio_interno
ÙÙ A1
#ObtenerMovimientosDeConceptoNegocio
ÙÙB e
(
ÙÙe f
int
ÙÙf i
	idAlmacen
ÙÙj s
,
ÙÙs t
int
ÙÙu x

idConceptoÙÙy É
,ÙÙÉ Ñ
DateTimeÙÙÖ ç

fechaDesdeÙÙé ò
,ÙÙò ô
DateTimeÙÙö ¢

fechaHastaÙÙ£ ≠
)ÙÙ≠ Æ
{
ıı 	
try
ˆˆ 
{
˜˜ 
SigescomEntities
¯¯  
_db
¯¯! $
=
¯¯% &
new
¯¯' *
SigescomEntities
¯¯+ ;
(
¯¯; <
)
¯¯< =
;
¯¯= >
int
˙˙ 
[
˙˙ 
]
˙˙ >
0idsTiposDeTransaccionMovimientoDeBienes_Entradas
˙˙ F
=
˙˙G H
Diccionario
˙˙I T
.
˙˙T U<
-TiposDeTransaccionMovimientoDeBienes_Entradas˙˙U Ç
;˙˙Ç É
int
˚˚ 
[
˚˚ 
]
˚˚ =
/idsTiposDeTransaccionMovimientoDeBienes_Salidas
˚˚ E
=
˚˚F G
Diccionario
˚˚H S
.
˚˚S T;
,TiposDeTransaccionMovimientoDeBienes_Salidas˚˚T Ä
;˚˚Ä Å
int
¸¸ 
[
¸¸ 
]
¸¸ 2
$idsTiposTransaccionMovimientoAlmacen
¸¸ :
=
¸¸; <>
0idsTiposDeTransaccionMovimientoDeBienes_Entradas
¸¸= m
.
¸¸m n
Union
¸¸n s
(
¸¸s t>
/idsTiposDeTransaccionMovimientoDeBienes_Salidas¸¸t £
)¸¸£ §
.¸¸§ •
ToArray¸¸• ¨
(¸¸¨ ≠
)¸¸≠ Æ
;¸¸Æ Ø
var
˝˝ 

movimiento
˝˝ 
=
˝˝  
_db
˝˝! $
.
˝˝$ %
Transaccion
˝˝% 0
.
˛˛ 
Where
˛˛ 
(
˛˛ 
t
˛˛ 
=>
˛˛ 
t
˛˛  !
.
˛˛! "
fecha_inicio
˛˛" .
>=
˛˛/ 1

fechaDesde
˛˛2 <
&&
ˇˇ 
t
ˇˇ 
.
ˇˇ 
fecha_inicio
ˇˇ %
<=
ˇˇ& (

fechaHasta
ˇˇ) 3
&&
ÄÄ 
t
ÄÄ 
.
ÄÄ &
id_actor_negocio_interno
ÄÄ 1
==
ÄÄ2 4
	idAlmacen
ÄÄ5 >
&&
ÅÅ 2
$idsTiposTransaccionMovimientoAlmacen
ÅÅ ;
.
ÅÅ; <
Contains
ÅÅ< D
(
ÅÅD E
t
ÅÅE F
.
ÅÅF G!
id_tipo_transaccion
ÅÅG Z
)
ÅÅZ [
&&
ÇÇ 
t
ÇÇ 
.
ÇÇ 
id_estado_actual
ÇÇ )
==
ÇÇ* ,
MaestroSettings
ÇÇ- <
.
ÇÇ< =
Default
ÇÇ= D
.
ÇÇD E.
 IdDetalleMaestroEstadoConfirmado
ÇÇE e
)
ÇÇe f
.
ÉÉ 

SelectMany
ÉÉ 
(
ÉÉ 
t
ÉÉ 
=>
ÉÉ  
t
ÉÉ! "
.
ÉÉ" #!
Detalle_transaccion
ÉÉ# 6
.
ÉÉ6 7
Where
ÉÉ7 <
(
ÉÉ< =
dt
ÉÉ= ?
=>
ÉÉ@ B
dt
ÉÉC E
.
ÉÉE F!
id_concepto_negocio
ÉÉF Y
==
ÉÉZ \

idConcepto
ÉÉ] g
)
ÉÉg h
)
ÉÉh i
.
ÉÉi j
GroupBy
ÑÑ 
(
ÑÑ 
dt
ÑÑ 
=>
ÑÑ 
new
ÑÑ !
{
ÖÖ 
IdConceptoNegocio
ÜÜ %
=
ÜÜ& '
dt
ÜÜ( *
.
ÜÜ* +!
id_concepto_negocio
ÜÜ+ >
,
ÜÜ> ?
}
áá 
)
áá 
.
áá 
Select
áá 
(
áá 
m
áá 
=>
áá 
new
áá "@
2Movimientos_concepto_negocio_actor_negocio_interno
áá# U
(
ááU V
)
ááV W
{
àà 
Lote
ââ 
=
ââ 
null
ââ 
,
ââ  !
Id_concepto_negocio
ää '
=
ää( )
m
ää* +
.
ää+ ,
Key
ää, /
.
ää/ 0
IdConceptoNegocio
ää0 A
,
ääA B 
Entradas_principal
ãã &
=
ãã' (
m
ãã) *
.
ãã* +
Where
ãã+ 0
(
ãã0 1
dt
ãã1 3
=>
ãã4 6>
0idsTiposDeTransaccionMovimientoDeBienes_Entradas
ãã7 g
.
ããg h
Contains
ããh p
(
ããp q
dt
ããq s
.
ããs t
Transaccion
ããt 
.ãã Ä#
id_tipo_transaccionããÄ ì
)ããì î
)ããî ï
.ããï ñ
Selectããñ ú
(ããú ù
dtããù ü
=>ãã† ¢
dtãã£ •
.ãã• ¶
cantidadãã¶ Æ
)ããÆ Ø
.ããØ ∞
DefaultIfEmptyãã∞ æ
(ããæ ø
$numããø ¿
)ãã¿ ¡
.ãã¡ ¬
Sumãã¬ ≈
(ãã≈ ∆
)ãã∆ «
,ãã« »
Salidas_principal
åå %
=
åå& '
m
åå( )
.
åå) *
Where
åå* /
(
åå/ 0
dt
åå0 2
=>
åå3 5=
/idsTiposDeTransaccionMovimientoDeBienes_Salidas
åå6 e
.
ååe f
Contains
ååf n
(
åån o
dt
ååo q
.
ååq r
Transaccion
åår }
.
åå} ~"
id_tipo_transaccionåå~ ë
)ååë í
)ååí ì
.ååì î
Selectååî ö
(ååö õ
dtååõ ù
=>ååû †
dtåå° £
.åå£ §
cantidadåå§ ¨
)åå¨ ≠
.åå≠ Æ
DefaultIfEmptyååÆ º
(ååº Ω
$numååΩ æ
)ååæ ø
.ååø ¿
Sumåå¿ √
(åå√ ƒ
)ååƒ ≈
,åå≈ ∆!
Entradas_secundaria
çç '
=
çç( )
(
çç* +
decimal
çç+ 2
)
çç2 3
m
çç3 4
.
çç4 5
Where
çç5 :
(
çç: ;
dt
çç; =
=>
çç> @>
0idsTiposDeTransaccionMovimientoDeBienes_Entradas
ççA q
.
ççq r
Contains
ççr z
(
ççz {
dt
çç{ }
.
çç} ~
Transaccionçç~ â
.ççâ ä#
id_tipo_transaccionççä ù
)ççù û
)ççû ü
.ççü †
Selectçç† ¶
(çç¶ ß
dtççß ©
=>çç™ ¨
dtçç≠ Ø
.ççØ ∞#
cantidad_secundariaçç∞ √
)çç√ ƒ
.ççƒ ≈
DefaultIfEmptyçç≈ ”
(çç” ‘
$numçç‘ ’
)çç’ ÷
.çç÷ ◊
Sumçç◊ ⁄
(çç⁄ €
)çç€ ‹
,çç‹ › 
Salidas_secundaria
éé &
=
éé' (
(
éé) *
decimal
éé* 1
)
éé1 2
m
éé2 3
.
éé3 4
Where
éé4 9
(
éé9 :
dt
éé: <
=>
éé= ?=
/idsTiposDeTransaccionMovimientoDeBienes_Salidas
éé@ o
.
ééo p
Contains
éép x
(
ééx y
dt
ééy {
.
éé{ |
Transaccionéé| á
.ééá à#
id_tipo_transaccionééà õ
)ééõ ú
)ééú ù
.ééù û
Selectééû §
(éé§ •
dtéé• ß
=>éé® ™
dtéé´ ≠
.éé≠ Æ#
cantidad_secundariaééÆ ¡
)éé¡ ¬
.éé¬ √
DefaultIfEmptyéé√ —
(éé— “
$numéé“ ”
)éé” ‘
.éé‘ ’
Suméé’ ÿ
(ééÿ Ÿ
)ééŸ ⁄
,éé⁄ €
Total
èè 
=
èè 
m
èè 
.
èè 
Where
èè #
(
èè# $
dt
èè$ &
=>
èè' )>
0idsTiposDeTransaccionMovimientoDeBienes_Entradas
èè* Z
.
èèZ [
Contains
èè[ c
(
èèc d
dt
èèd f
.
èèf g
Transaccion
èèg r
.
èèr s"
id_tipo_transaccionèès Ü
)èèÜ á
)èèá à
.èèà â
Selectèèâ è
(èèè ê
dtèèê í
=>èèì ï
dtèèñ ò
.èèò ô
totalèèô û
)èèû ü
.èèü †
DefaultIfEmptyèè† Æ
(èèÆ Ø
$numèèØ ∞
)èè∞ ±
.èè± ≤
Sumèè≤ µ
(èèµ ∂
)èè∂ ∑
-èè∏ π
mèè∫ ª
.èèª º
Whereèèº ¡
(èè¡ ¬
dtèè¬ ƒ
=>èè≈ «?
/idsTiposDeTransaccionMovimientoDeBienes_Salidasèè» ˜
.èè˜ ¯
Containsèè¯ Ä
(èèÄ Å
dtèèÅ É
.èèÉ Ñ
TransaccionèèÑ è
.èèè ê#
id_tipo_transaccionèèê £
)èè£ §
)èè§ •
.èè• ¶
Selectèè¶ ¨
(èè¨ ≠
dtèè≠ Ø
=>èè∞ ≤
dtèè≥ µ
.èèµ ∂
totalèè∂ ª
)èèª º
.èèº Ω
DefaultIfEmptyèèΩ À
(èèÀ Ã
$numèèÃ Õ
)èèÕ Œ
.èèŒ œ
Sumèèœ “
(èè“ ”
)èè” ‘
}
êê 
)
êê 
.
êê 
SingleOrDefault
êê "
(
êê" #
)
êê# $
;
êê$ %
return
ëë 

movimiento
ëë !
;
ëë! "
}
íí 
catch
ìì 
(
ìì 
	Exception
ìì 
e
ìì 
)
ìì 
{
îî 
throw
ïï 
e
ïï 
;
ïï 
}
ññ 
}
óó 	
public
öö @
2Movimientos_concepto_negocio_actor_negocio_interno
öö AA
3ObtenerMovimientosDeConceptoNegocioYLote_UnConcepto
ööB u
(
ööu v
int
ööv y
	idAlmacenööz É
,ööÉ Ñ
intööÖ à

idConceptoööâ ì
,ööì î
DateTimeööï ù

fechaDesdeööû ®
,öö® ©
DateTimeöö™ ≤

fechaHastaöö≥ Ω
)ööΩ æ
{
õõ 	
try
úú 
{
ùù 
SigescomEntities
ûû  
_db
ûû! $
=
ûû% &
new
ûû' *
SigescomEntities
ûû+ ;
(
ûû; <
)
ûû< =
;
ûû= >
int
†† 
[
†† 
]
†† >
0idsTiposDeTransaccionMovimientoDeBienes_Entradas
†† F
=
††G H
Diccionario
††I T
.
††T U<
-TiposDeTransaccionMovimientoDeBienes_Entradas††U Ç
;††Ç É
int
°° 
[
°° 
]
°° =
/idsTiposDeTransaccionMovimientoDeBienes_Salidas
°° E
=
°°F G
Diccionario
°°H S
.
°°S T;
,TiposDeTransaccionMovimientoDeBienes_Salidas°°T Ä
;°°Ä Å
int
¢¢ 
[
¢¢ 
]
¢¢ 2
$idsTiposTransaccionMovimientoAlmacen
¢¢ :
=
¢¢; <>
0idsTiposDeTransaccionMovimientoDeBienes_Entradas
¢¢= m
.
¢¢m n
Union
¢¢n s
(
¢¢s t>
/idsTiposDeTransaccionMovimientoDeBienes_Salidas¢¢t £
)¢¢£ §
.¢¢§ •
ToArray¢¢• ¨
(¢¢¨ ≠
)¢¢≠ Æ
;¢¢Æ Ø
var
££ 

movimiento
££ 
=
££  
_db
££! $
.
££$ %
Transaccion
££% 0
.
§§ 
Where
§§ 
(
§§ 
t
§§ 
=>
§§ 
t
§§  !
.
§§! "
fecha_inicio
§§" .
>=
§§/ 1

fechaDesde
§§2 <
&&
•• 
t
•• 
.
•• 
fecha_inicio
•• &
<=
••' )

fechaHasta
••* 4
&&
¶¶ 
t
¶¶ 
.
¶¶ &
id_actor_negocio_interno
¶¶ 2
==
¶¶3 5
	idAlmacen
¶¶6 ?
&&
ßß 2
$idsTiposTransaccionMovimientoAlmacen
ßß <
.
ßß< =
Contains
ßß= E
(
ßßE F
t
ßßF G
.
ßßG H!
id_tipo_transaccion
ßßH [
)
ßß[ \
&&
®® 
t
®® 
.
®® 
id_estado_actual
®® *
==
®®+ -
MaestroSettings
®®. =
.
®®= >
Default
®®> E
.
®®E F.
 IdDetalleMaestroEstadoConfirmado
®®F f
)
®®f g
.
©© 

SelectMany
©© 
(
©© 
t
©© 
=>
©©  
t
©©! "
.
©©" #!
Detalle_transaccion
©©# 6
.
©©6 7
Where
©©7 <
(
©©< =
dt
©©= ?
=>
©©@ B
dt
©©C E
.
©©E F!
id_concepto_negocio
©©F Y
==
©©Z \

idConcepto
©©] g
)
©©g h
)
©©h i
.
©©i j
GroupBy
™™ 
(
™™ 
dt
™™ 
=>
™™ 
new
™™ !
{
´´ 
IdConceptoNegocio
¨¨ %
=
¨¨& '
dt
¨¨( *
.
¨¨* +!
id_concepto_negocio
¨¨+ >
,
¨¨> ?
Lote
≠≠ 
=
≠≠ 
dt
≠≠ 
.
≠≠ 
lote
≠≠ "
}
ÆÆ 
)
ÆÆ 
.
ÆÆ 
Select
ÆÆ 
(
ÆÆ 
m
ÆÆ 
=>
ÆÆ 
new
ÆÆ "@
2Movimientos_concepto_negocio_actor_negocio_interno
ÆÆ# U
(
ÆÆU V
)
ÆÆV W
{
ØØ 
Lote
∞∞ 
=
∞∞ 
m
∞∞ 
.
∞∞ 
Key
∞∞  
.
∞∞  !
Lote
∞∞! %
,
∞∞% &!
Id_concepto_negocio
±± '
=
±±( )
m
±±* +
.
±±+ ,
Key
±±, /
.
±±/ 0
IdConceptoNegocio
±±0 A
,
±±A B 
Entradas_principal
≤≤ &
=
≤≤' (
m
≤≤) *
.
≤≤* +
Where
≤≤+ 0
(
≤≤0 1
dt
≤≤1 3
=>
≤≤4 6>
0idsTiposDeTransaccionMovimientoDeBienes_Entradas
≤≤7 g
.
≤≤g h
Contains
≤≤h p
(
≤≤p q
dt
≤≤q s
.
≤≤s t
Transaccion
≤≤t 
.≤≤ Ä#
id_tipo_transaccion≤≤Ä ì
)≤≤ì î
)≤≤î ï
.≤≤ï ñ
Select≤≤ñ ú
(≤≤ú ù
dt≤≤ù ü
=>≤≤† ¢
dt≤≤£ •
.≤≤• ¶
cantidad≤≤¶ Æ
)≤≤Æ Ø
.≤≤Ø ∞
DefaultIfEmpty≤≤∞ æ
(≤≤æ ø
$num≤≤ø ¿
)≤≤¿ ¡
.≤≤¡ ¬
Sum≤≤¬ ≈
(≤≤≈ ∆
)≤≤∆ «
,≤≤« »
Salidas_principal
≥≥ %
=
≥≥& '
m
≥≥( )
.
≥≥) *
Where
≥≥* /
(
≥≥/ 0
dt
≥≥0 2
=>
≥≥3 5=
/idsTiposDeTransaccionMovimientoDeBienes_Salidas
≥≥6 e
.
≥≥e f
Contains
≥≥f n
(
≥≥n o
dt
≥≥o q
.
≥≥q r
Transaccion
≥≥r }
.
≥≥} ~"
id_tipo_transaccion≥≥~ ë
)≥≥ë í
)≥≥í ì
.≥≥ì î
Select≥≥î ö
(≥≥ö õ
dt≥≥õ ù
=>≥≥û †
dt≥≥° £
.≥≥£ §
cantidad≥≥§ ¨
)≥≥¨ ≠
.≥≥≠ Æ
DefaultIfEmpty≥≥Æ º
(≥≥º Ω
$num≥≥Ω æ
)≥≥æ ø
.≥≥ø ¿
Sum≥≥¿ √
(≥≥√ ƒ
)≥≥ƒ ≈
,≥≥≈ ∆!
Entradas_secundaria
¥¥ '
=
¥¥( )
(
¥¥* +
decimal
¥¥+ 2
)
¥¥2 3
m
¥¥3 4
.
¥¥4 5
Where
¥¥5 :
(
¥¥: ;
dt
¥¥; =
=>
¥¥> @>
0idsTiposDeTransaccionMovimientoDeBienes_Entradas
¥¥A q
.
¥¥q r
Contains
¥¥r z
(
¥¥z {
dt
¥¥{ }
.
¥¥} ~
Transaccion¥¥~ â
.¥¥â ä#
id_tipo_transaccion¥¥ä ù
)¥¥ù û
)¥¥û ü
.¥¥ü †
Select¥¥† ¶
(¥¥¶ ß
dt¥¥ß ©
=>¥¥™ ¨
dt¥¥≠ Ø
.¥¥Ø ∞#
cantidad_secundaria¥¥∞ √
)¥¥√ ƒ
.¥¥ƒ ≈
DefaultIfEmpty¥¥≈ ”
(¥¥” ‘
$num¥¥‘ ’
)¥¥’ ÷
.¥¥÷ ◊
Sum¥¥◊ ⁄
(¥¥⁄ €
)¥¥€ ‹
,¥¥‹ › 
Salidas_secundaria
µµ &
=
µµ' (
(
µµ) *
decimal
µµ* 1
)
µµ1 2
m
µµ2 3
.
µµ3 4
Where
µµ4 9
(
µµ9 :
dt
µµ: <
=>
µµ= ?=
/idsTiposDeTransaccionMovimientoDeBienes_Salidas
µµ@ o
.
µµo p
Contains
µµp x
(
µµx y
dt
µµy {
.
µµ{ |
Transaccionµµ| á
.µµá à#
id_tipo_transaccionµµà õ
)µµõ ú
)µµú ù
.µµù û
Selectµµû §
(µµ§ •
dtµµ• ß
=>µµ® ™
dtµµ´ ≠
.µµ≠ Æ#
cantidad_secundariaµµÆ ¡
)µµ¡ ¬
.µµ¬ √
DefaultIfEmptyµµ√ —
(µµ— “
$numµµ“ ”
)µµ” ‘
.µµ‘ ’
Sumµµ’ ÿ
(µµÿ Ÿ
)µµŸ ⁄
,µµ⁄ €
Total
∂∂ 
=
∂∂ 
m
∂∂ 
.
∂∂ 
Where
∂∂ #
(
∂∂# $
dt
∂∂$ &
=>
∂∂' )>
0idsTiposDeTransaccionMovimientoDeBienes_Entradas
∂∂* Z
.
∂∂Z [
Contains
∂∂[ c
(
∂∂c d
dt
∂∂d f
.
∂∂f g
Transaccion
∂∂g r
.
∂∂r s"
id_tipo_transaccion∂∂s Ü
)∂∂Ü á
)∂∂á à
.∂∂à â
Select∂∂â è
(∂∂è ê
dt∂∂ê í
=>∂∂ì ï
dt∂∂ñ ò
.∂∂ò ô
total∂∂ô û
)∂∂û ü
.∂∂ü †
DefaultIfEmpty∂∂† Æ
(∂∂Æ Ø
$num∂∂Ø ∞
)∂∂∞ ±
.∂∂± ≤
Sum∂∂≤ µ
(∂∂µ ∂
)∂∂∂ ∑
-∂∂∏ π
m∂∂∫ ª
.∂∂ª º
Where∂∂º ¡
(∂∂¡ ¬
dt∂∂¬ ƒ
=>∂∂≈ «?
/idsTiposDeTransaccionMovimientoDeBienes_Salidas∂∂» ˜
.∂∂˜ ¯
Contains∂∂¯ Ä
(∂∂Ä Å
dt∂∂Å É
.∂∂É Ñ
Transaccion∂∂Ñ è
.∂∂è ê#
id_tipo_transaccion∂∂ê £
)∂∂£ §
)∂∂§ •
.∂∂• ¶
Select∂∂¶ ¨
(∂∂¨ ≠
dt∂∂≠ Ø
=>∂∂∞ ≤
dt∂∂≥ µ
.∂∂µ ∂
total∂∂∂ ª
)∂∂ª º
.∂∂º Ω
DefaultIfEmpty∂∂Ω À
(∂∂À Ã
$num∂∂Ã Õ
)∂∂Õ Œ
.∂∂Œ œ
Sum∂∂œ “
(∂∂“ ”
)∂∂” ‘
}
∑∑ 
)
∑∑ 
.
∑∑ 
SingleOrDefault
∑∑ "
(
∑∑" #
)
∑∑# $
;
∑∑$ %
return
∏∏ 

movimiento
∏∏ !
;
∏∏! "
}
ππ 
catch
∫∫ 
(
∫∫ 
	Exception
∫∫ 
e
∫∫ 
)
∫∫ 
{
ªª 
throw
ºº 
e
ºº 
;
ºº 
}
ΩΩ 
}
ææ 	
public
¿¿ @
2Movimientos_concepto_negocio_actor_negocio_interno
¿¿ A<
.ObtenerMovimientosDeConceptoNegocio_UnConcepto
¿¿B p
(
¿¿p q
int
¿¿q t
	idAlmacen
¿¿u ~
,
¿¿~ 
int¿¿Ä É

idConcepto¿¿Ñ é
,¿¿é è
DateTime¿¿ê ò

fechaDesde¿¿ô £
,¿¿£ §
DateTime¿¿• ≠

fechaHasta¿¿Æ ∏
)¿¿∏ π
{
¡¡ 	
try
¬¬ 
{
√√ 
SigescomEntities
ƒƒ  
_db
ƒƒ! $
=
ƒƒ% &
new
ƒƒ' *
SigescomEntities
ƒƒ+ ;
(
ƒƒ; <
)
ƒƒ< =
;
ƒƒ= >
int
∆∆ 
[
∆∆ 
]
∆∆ >
0idsTiposDeTransaccionMovimientoDeBienes_Entradas
∆∆ F
=
∆∆G H
Diccionario
∆∆I T
.
∆∆T U<
-TiposDeTransaccionMovimientoDeBienes_Entradas∆∆U Ç
;∆∆Ç É
int
«« 
[
«« 
]
«« =
/idsTiposDeTransaccionMovimientoDeBienes_Salidas
«« E
=
««F G
Diccionario
««H S
.
««S T;
,TiposDeTransaccionMovimientoDeBienes_Salidas««T Ä
;««Ä Å
int
»» 
[
»» 
]
»» 2
$idsTiposTransaccionMovimientoAlmacen
»» :
=
»»; <>
0idsTiposDeTransaccionMovimientoDeBienes_Entradas
»»= m
.
»»m n
Union
»»n s
(
»»s t>
/idsTiposDeTransaccionMovimientoDeBienes_Salidas»»t £
)»»£ §
.»»§ •
ToArray»»• ¨
(»»¨ ≠
)»»≠ Æ
;»»Æ Ø
var
…… 

movimiento
…… 
=
……  
_db
……! $
.
……$ %
Transaccion
……% 0
.
   
Where
   
(
   
t
   
=>
   
t
    !
.
  ! "
fecha_inicio
  " .
>=
  / 1

fechaDesde
  2 <
&&
ÀÀ 
t
ÀÀ 
.
ÀÀ 
fecha_inicio
ÀÀ &
<=
ÀÀ' )

fechaHasta
ÀÀ* 4
&&
ÃÃ 
t
ÃÃ 
.
ÃÃ &
id_actor_negocio_interno
ÃÃ 2
==
ÃÃ3 5
	idAlmacen
ÃÃ6 ?
&&
ÕÕ 2
$idsTiposTransaccionMovimientoAlmacen
ÕÕ <
.
ÕÕ< =
Contains
ÕÕ= E
(
ÕÕE F
t
ÕÕF G
.
ÕÕG H!
id_tipo_transaccion
ÕÕH [
)
ÕÕ[ \
&&
ŒŒ 
t
ŒŒ 
.
ŒŒ 
id_estado_actual
ŒŒ *
==
ŒŒ+ -
MaestroSettings
ŒŒ. =
.
ŒŒ= >
Default
ŒŒ> E
.
ŒŒE F.
 IdDetalleMaestroEstadoConfirmado
ŒŒF f
)
ŒŒf g
.
œœ 

SelectMany
œœ 
(
œœ 
t
œœ 
=>
œœ  
t
œœ! "
.
œœ" #!
Detalle_transaccion
œœ# 6
.
œœ6 7
Where
œœ7 <
(
œœ< =
dt
œœ= ?
=>
œœ@ B
dt
œœC E
.
œœE F!
id_concepto_negocio
œœF Y
==
œœZ \

idConcepto
œœ] g
)
œœg h
)
œœh i
.
œœi j
GroupBy
–– 
(
–– 
dt
–– 
=>
–– 
new
–– !
{
—— 
IdConceptoNegocio
““ %
=
““& '
dt
““( *
.
““* +!
id_concepto_negocio
““+ >
,
““> ?
}
”” 
)
”” 
.
”” 
Select
”” 
(
”” 
m
”” 
=>
”” 
new
”” "@
2Movimientos_concepto_negocio_actor_negocio_interno
””# U
(
””U V
)
””V W
{
‘‘ 
Lote
’’ 
=
’’ 
null
’’ 
,
’’  !
Id_concepto_negocio
÷÷ '
=
÷÷( )
m
÷÷* +
.
÷÷+ ,
Key
÷÷, /
.
÷÷/ 0
IdConceptoNegocio
÷÷0 A
,
÷÷A B 
Entradas_principal
◊◊ &
=
◊◊' (
m
◊◊) *
.
◊◊* +
Where
◊◊+ 0
(
◊◊0 1
dt
◊◊1 3
=>
◊◊4 6>
0idsTiposDeTransaccionMovimientoDeBienes_Entradas
◊◊7 g
.
◊◊g h
Contains
◊◊h p
(
◊◊p q
dt
◊◊q s
.
◊◊s t
Transaccion
◊◊t 
.◊◊ Ä#
id_tipo_transaccion◊◊Ä ì
)◊◊ì î
)◊◊î ï
.◊◊ï ñ
Select◊◊ñ ú
(◊◊ú ù
dt◊◊ù ü
=>◊◊† ¢
dt◊◊£ •
.◊◊• ¶
cantidad◊◊¶ Æ
)◊◊Æ Ø
.◊◊Ø ∞
DefaultIfEmpty◊◊∞ æ
(◊◊æ ø
$num◊◊ø ¿
)◊◊¿ ¡
.◊◊¡ ¬
Sum◊◊¬ ≈
(◊◊≈ ∆
)◊◊∆ «
,◊◊« »
Salidas_principal
ÿÿ %
=
ÿÿ& '
m
ÿÿ( )
.
ÿÿ) *
Where
ÿÿ* /
(
ÿÿ/ 0
dt
ÿÿ0 2
=>
ÿÿ3 5=
/idsTiposDeTransaccionMovimientoDeBienes_Salidas
ÿÿ6 e
.
ÿÿe f
Contains
ÿÿf n
(
ÿÿn o
dt
ÿÿo q
.
ÿÿq r
Transaccion
ÿÿr }
.
ÿÿ} ~"
id_tipo_transaccionÿÿ~ ë
)ÿÿë í
)ÿÿí ì
.ÿÿì î
Selectÿÿî ö
(ÿÿö õ
dtÿÿõ ù
=>ÿÿû †
dtÿÿ° £
.ÿÿ£ §
cantidadÿÿ§ ¨
)ÿÿ¨ ≠
.ÿÿ≠ Æ
DefaultIfEmptyÿÿÆ º
(ÿÿº Ω
$numÿÿΩ æ
)ÿÿæ ø
.ÿÿø ¿
Sumÿÿ¿ √
(ÿÿ√ ƒ
)ÿÿƒ ≈
,ÿÿ≈ ∆!
Entradas_secundaria
ŸŸ '
=
ŸŸ( )
(
ŸŸ* +
decimal
ŸŸ+ 2
)
ŸŸ2 3
m
ŸŸ3 4
.
ŸŸ4 5
Where
ŸŸ5 :
(
ŸŸ: ;
dt
ŸŸ; =
=>
ŸŸ> @>
0idsTiposDeTransaccionMovimientoDeBienes_Entradas
ŸŸA q
.
ŸŸq r
Contains
ŸŸr z
(
ŸŸz {
dt
ŸŸ{ }
.
ŸŸ} ~
TransaccionŸŸ~ â
.ŸŸâ ä#
id_tipo_transaccionŸŸä ù
)ŸŸù û
)ŸŸû ü
.ŸŸü †
SelectŸŸ† ¶
(ŸŸ¶ ß
dtŸŸß ©
=>ŸŸ™ ¨
dtŸŸ≠ Ø
.ŸŸØ ∞#
cantidad_secundariaŸŸ∞ √
)ŸŸ√ ƒ
.ŸŸƒ ≈
DefaultIfEmptyŸŸ≈ ”
(ŸŸ” ‘
$numŸŸ‘ ’
)ŸŸ’ ÷
.ŸŸ÷ ◊
SumŸŸ◊ ⁄
(ŸŸ⁄ €
)ŸŸ€ ‹
,ŸŸ‹ › 
Salidas_secundaria
⁄⁄ &
=
⁄⁄' (
(
⁄⁄) *
decimal
⁄⁄* 1
)
⁄⁄1 2
m
⁄⁄2 3
.
⁄⁄3 4
Where
⁄⁄4 9
(
⁄⁄9 :
dt
⁄⁄: <
=>
⁄⁄= ?=
/idsTiposDeTransaccionMovimientoDeBienes_Salidas
⁄⁄@ o
.
⁄⁄o p
Contains
⁄⁄p x
(
⁄⁄x y
dt
⁄⁄y {
.
⁄⁄{ |
Transaccion⁄⁄| á
.⁄⁄á à#
id_tipo_transaccion⁄⁄à õ
)⁄⁄õ ú
)⁄⁄ú ù
.⁄⁄ù û
Select⁄⁄û §
(⁄⁄§ •
dt⁄⁄• ß
=>⁄⁄® ™
dt⁄⁄´ ≠
.⁄⁄≠ Æ#
cantidad_secundaria⁄⁄Æ ¡
)⁄⁄¡ ¬
.⁄⁄¬ √
DefaultIfEmpty⁄⁄√ —
(⁄⁄— “
$num⁄⁄“ ”
)⁄⁄” ‘
.⁄⁄‘ ’
Sum⁄⁄’ ÿ
(⁄⁄ÿ Ÿ
)⁄⁄Ÿ ⁄
,⁄⁄⁄ €
Total
€€ 
=
€€ 
m
€€ 
.
€€ 
Where
€€ #
(
€€# $
dt
€€$ &
=>
€€' )>
0idsTiposDeTransaccionMovimientoDeBienes_Entradas
€€* Z
.
€€Z [
Contains
€€[ c
(
€€c d
dt
€€d f
.
€€f g
Transaccion
€€g r
.
€€r s"
id_tipo_transaccion€€s Ü
)€€Ü á
)€€á à
.€€à â
Select€€â è
(€€è ê
dt€€ê í
=>€€ì ï
dt€€ñ ò
.€€ò ô
total€€ô û
)€€û ü
.€€ü †
DefaultIfEmpty€€† Æ
(€€Æ Ø
$num€€Ø ∞
)€€∞ ±
.€€± ≤
Sum€€≤ µ
(€€µ ∂
)€€∂ ∑
-€€∏ π
m€€∫ ª
.€€ª º
Where€€º ¡
(€€¡ ¬
dt€€¬ ƒ
=>€€≈ «?
/idsTiposDeTransaccionMovimientoDeBienes_Salidas€€» ˜
.€€˜ ¯
Contains€€¯ Ä
(€€Ä Å
dt€€Å É
.€€É Ñ
Transaccion€€Ñ è
.€€è ê#
id_tipo_transaccion€€ê £
)€€£ §
)€€§ •
.€€• ¶
Select€€¶ ¨
(€€¨ ≠
dt€€≠ Ø
=>€€∞ ≤
dt€€≥ µ
.€€µ ∂
total€€∂ ª
)€€ª º
.€€º Ω
DefaultIfEmpty€€Ω À
(€€À Ã
$num€€Ã Õ
)€€Õ Œ
.€€Œ œ
Sum€€œ “
(€€“ ”
)€€” ‘
}
‹‹ 
)
‹‹ 
.
‹‹ 
SingleOrDefault
‹‹ "
(
‹‹" #
)
‹‹# $
;
‹‹$ %
return
›› 

movimiento
›› !
;
››! "
}
ﬁﬁ 
catch
ﬂﬂ 
(
ﬂﬂ 
	Exception
ﬂﬂ 
e
ﬂﬂ 
)
ﬂﬂ 
{
‡‡ 
throw
·· 
e
·· 
;
·· 
}
‚‚ 
}
„„ 	
}
ÂÂ 
}ÊÊ ™†
^D:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\Almacen\InventarioHistorico_Datos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
." #
Almacen# *
{ 
public 

partial 
class %
InventarioHistorico_Datos 2
:3 4,
 IInventarioHistorico_Repositorio5 U
{ 
public 
Transaccion 9
-ObtenerTransaccionInclusiveDetalleTransaccion H
(H I
intI L!
idActorNegocioInternoM b
,b c
intd g
idTipoTransaccionh y
,y z
int{ ~
idUltimoEstado	 ç
)
ç é
{ 	
SigescomEntities 
_db  
=! "
new# &
SigescomEntities' 7
(7 8
)8 9
;9 :
try 
{ 
_db 
. 
Configuration !
.! "
LazyLoadingEnabled" 4
=5 6
false7 <
;< =
return 
_db 
. 
Transaccion &
.& '
Include' .
(. /
t/ 0
=>1 3
t4 5
.5 6
Detalle_transaccion6 I
)I J
.J K
IncludeK R
(R S
tS T
=>U W
tX Y
.Y Z
Detalle_transaccionZ m
.m n
Selectn t
(t u
dtu w
=>x z
dt{ }
.} ~6
)Valor_detalle_maestro_detalle_transaccion	~ ß
)
ß ®
)
® ©
. 
SingleOrDefault $
($ %
t% &
=>' )
t* +
.+ ,$
id_actor_negocio_interno, D
==E G!
idActorNegocioInternoH ]
&& 
t 
. 
id_tipo_transaccion ,
==- /
idTipoTransaccion0 A
&&   
t   
.   
id_estado_actual   )
==  * ,
idUltimoEstado  - ;
)  ; <
;  < =
}!! 
catch"" 
("" 
	Exception"" 
e"" 
)"" 
{## 
throw$$ 
new$$ 
DatosException$$ (
($$( )
$str$$) r
,$$r s
e$$t u
)$$u v
;$$v w
}%% 
finally&& 
{'' 
_db(( 
.(( 
Configuration(( !
.((! "
LazyLoadingEnabled((" 4
=((5 6
true((7 ;
;((; <
})) 
}** 	
public-- 
InventarioFisico-- ;
/ObtenerUltimoInventarioFisicoHistoricoAnteriorA--  O
(--O P
int--P S
	idAlmacen--T ]
,--] ^
int--_ b

idConcepto--c m
,--m n
DateTime--o w
fecha--x }
)--} ~
{.. 	
try// 
{00 
InventarioFisico11  

inventario11! +
=11, -
null11. 2
;112 3
SigescomEntities33  
_db33! $
=33% &
new33' *
SigescomEntities33+ ;
(33; <
)33< =
;33= >
if44 
(44 
_db44 
.44 
Transaccion44 #
.44# $
Any44$ '
(44' (
t44( )
=>44* ,
t44- .
.44. /$
id_actor_negocio_interno44/ G
==44H J
	idAlmacen44K T
&&44U W
t44X Y
.44Y Z
id_tipo_transaccion44Z m
==44n p 
TransaccionSettings	44q Ñ
.
44Ñ Ö
Default
44Ö å
.
44å ç2
$IdTipoTransaccionInventarioHistorico
44ç ±
&&
44≤ ¥
t
44µ ∂
.
44∂ ∑
fecha_inicio
44∑ √
<
44ƒ ≈
fecha
44∆ À
)
44À Ã
)
44Ã Õ
{55 

inventario66 
=66  
_db66! $
.66$ %
Transaccion66% 0
.660 1
Where661 6
(666 7
t667 8
=>669 ;
t66< =
.66= >$
id_actor_negocio_interno66> V
==66W Y
	idAlmacen66Z c
&&66d f
t66g h
.66h i
id_tipo_transaccion66i |
==66} !
TransaccionSettings
66Ä ì
.
66ì î
Default
66î õ
.
66õ ú2
$IdTipoTransaccionInventarioHistorico
66ú ¿
&&
66¡ √
t
66ƒ ≈
.
66≈ ∆
fecha_inicio
66∆ “
<
66” ‘
fecha
66’ ⁄
)
66⁄ €
.
66€ ‹
OrderByDescending
66‹ Ì
(
66Ì Ó
t
66Ó Ô
=>
66 Ú
t
66Û Ù
.
66Ù ı
id
66ı ˜
)
66˜ ¯
.
66¯ ˘
FirstOrDefault
66˘ á
(
66á à
)
66à â
.
66â ä!
Detalle_transaccion
66ä ù
.
66ù û
Where
66û £
(
66£ §
d
66§ •
=>
66¶ ®
d
66© ™
.
66™ ´!
id_concepto_negocio
66´ æ
==
66ø ¡

idConcepto
66¬ Ã
)
66Ã Õ
.
66Õ Œ
Select
66Œ ‘
(
66‘ ’
dt
66’ ◊
=>
66ÿ ⁄
new
66€ ﬁ
InventarioFisico
66ﬂ Ô
(
66Ô 
)
66 Ò
{77 
IdTransaccion88 %
=88& '
dt88( *
.88* +
id_transaccion88+ 9
,889 :
Cantidad99  
=99! "
dt99# %
.99% &
cantidad99& .
,99. /
CantidadSecundaria:: *
=::+ ,
dt::- /
.::/ 0
cantidad_secundaria::0 C
,::C D
	IdAlmacen;; !
=;;" #
	idAlmacen;;$ -
,;;- .

IdConcepto<< "
=<<# $

idConcepto<<% /
,<</ 0
Fecha== 
=== 
dt==  "
.==" #
Transaccion==# .
.==. /
fecha_inicio==/ ;
}>> 
)>> 
.>> 
SingleOrDefault>> &
(>>& '
)>>' (
;>>( )
}?? 
return@@ 

inventario@@ !
;@@! "
}AA 
catchBB 
(BB 
	ExceptionBB 
eBB 
)BB 
{CC 
throwDD 
eDD 
;DD 
}EE 
}FF 	
publicHH  
InventarioValorizadoHH #?
3ObtenerUltimoInventarioValorizadoHistoricoAnteriorAHH$ W
(HHW X
intHHX [
	idAlmacenHH\ e
,HHe f
intHHg j

idConceptoHHk u
,HHu v
DateTimeHHw 
fecha
HHÄ Ö
)
HHÖ Ü
{II 	 
InventarioValorizadoJJ  

inventarioJJ! +
=JJ, -
nullJJ. 2
;JJ2 3
SigescomEntitiesLL 
_dbLL  
=LL! "
newLL# &
SigescomEntitiesLL' 7
(LL7 8
)LL8 9
;LL9 :
ifMM 
(MM 
_dbMM 
.MM 
TransaccionMM 
.MM  
AnyMM  #
(MM# $
tMM$ %
=>MM& (
tMM) *
.MM* +$
id_actor_negocio_internoMM+ C
==MMD F
	idAlmacenMMG P
&&MMQ S
tMMT U
.MMU V
id_tipo_transaccionMMV i
==MMj l 
TransaccionSettings	MMm Ä
.
MMÄ Å
Default
MMÅ à
.
MMà â2
$IdTipoTransaccionInventarioHistorico
MMâ ≠
&&
MMÆ ∞
t
MM± ≤
.
MM≤ ≥
fecha_inicio
MM≥ ø
<
MM¿ ¡
fecha
MM¬ «
)
MM« »
)
MM» …
{NN 

inventarioOO 
=OO 
_dbOO  
.OO  !
TransaccionOO! ,
.OO, -
WhereOO- 2
(OO2 3
tOO3 4
=>OO5 7
tOO8 9
.OO9 :$
id_actor_negocio_internoOO: R
==OOS U
	idAlmacenOOV _
&&OO` b
tOOc d
.OOd e
id_tipo_transaccionOOe x
==OOy { 
TransaccionSettings	OO| è
.
OOè ê
Default
OOê ó
.
OOó ò2
$IdTipoTransaccionInventarioHistorico
OOò º
&&
OOΩ ø
t
OO¿ ¡
.
OO¡ ¬
fecha_inicio
OO¬ Œ
<
OOœ –
fecha
OO— ÷
)
OO÷ ◊
.
OO◊ ÿ
OrderByDescending
OOÿ È
(
OOÈ Í
t
OOÍ Î
=>
OOÏ Ó
t
OOÔ 
.
OO Ò
id
OOÒ Û
)
OOÛ Ù
.
OOÙ ı
FirstOrDefault
OOı É
(
OOÉ Ñ
)
OOÑ Ö
.
OOÖ Ü!
Detalle_transaccion
OOÜ ô
.
OOô ö
Where
OOö ü
(
OOü †
d
OO† °
=>
OO¢ §
d
OO• ¶
.
OO¶ ß!
id_concepto_negocio
OOß ∫
==
OOª Ω

idConcepto
OOæ »
)
OO» …
.
OO…  
Select
OO  –
(
OO– —
dt
OO— ”
=>
OO‘ ÷
new
OO◊ ⁄"
InventarioValorizado
OO€ Ô
(
OOÔ 
)
OO Ò
{PP 
IdTransaccionQQ !
=QQ" #
dtQQ$ &
.QQ& '
id_transaccionQQ' 5
,QQ5 6
CantidadRR 
=RR 
dtRR !
.RR! "
cantidadRR" *
,RR* +
CantidadSecundariaSS &
=SS' (
dtSS) +
.SS+ ,
cantidad_secundariaSS, ?
,SS? @
	IdAlmacenTT 
=TT 
	idAlmacenTT  )
,TT) *

IdConceptoUU 
=UU  

idConceptoUU! +
,UU+ ,
FechaVV 
=VV 
dtVV 
.VV 
TransaccionVV *
.VV* +
fecha_inicioVV+ 7
,VV7 8
ValorUnitarioWW !
=WW" #
dtWW$ &
.WW& '
precio_unitarioWW' 6
,WW6 7

ValorTotalXX 
=XX  
dtXX! #
.XX# $
totalXX$ )
}YY 
)YY 
.YY 
SingleOrDefaultYY "
(YY" #
)YY# $
;YY$ %
}ZZ 
return[[ 

inventario[[ 
;[[ 
}\\ 	
public`` 
IEnumerable`` 
<`` 
InventarioFisico`` +
>``+ ,;
/ObtenerUltimoInventarioFisicoHistoricoAnteriorA``- \
(``\ ]
int``] `
	idAlmacen``a j
,``j k
DateTime``l t
	anteriorA``u ~
)``~ 
{aa 	
trybb 
{cc 
IEnumerabledd 
<dd 
InventarioFisicodd ,
>dd, -

inventariodd. 8
=dd9 :
newdd; >
Listdd? C
<ddC D
InventarioFisicoddD T
>ddT U
(ddU V
)ddV W
;ddW X
SigescomEntitiesee  
_dbee! $
=ee% &
newee' *
SigescomEntitiesee+ ;
(ee; <
)ee< =
;ee= >
ifff 
(ff 
_dbff 
.ff 
Transaccionff #
.ff# $
Anyff$ '
(ff' (
tff( )
=>ff* ,
tff- .
.ff. /$
id_actor_negocio_internoff/ G
==ffH J
	idAlmacenffK T
&&ffU W
tffX Y
.ffY Z
id_tipo_transaccionffZ m
==ffn p 
TransaccionSettings	ffq Ñ
.
ffÑ Ö
Default
ffÖ å
.
ffå ç2
$IdTipoTransaccionInventarioHistorico
ffç ±
&&
ff≤ ¥
t
ffµ ∂
.
ff∂ ∑
fecha_inicio
ff∑ √
<
ffƒ ≈
	anteriorA
ff∆ œ
)
ffœ –
)
ff– —
{gg 

inventariohh 
=hh  
_dbhh! $
.hh$ %
Transaccionhh% 0
.hh0 1
Wherehh1 6
(hh6 7
thh7 8
=>hh9 ;
thh< =
.hh= >$
id_actor_negocio_internohh> V
==hhW Y
	idAlmacenhhZ c
&&hhd f
thhg h
.hhh i
id_tipo_transaccionhhi |
==hh} !
TransaccionSettings
hhÄ ì
.
hhì î
Default
hhî õ
.
hhõ ú2
$IdTipoTransaccionInventarioHistorico
hhú ¿
&&
hh¡ √
t
hhƒ ≈
.
hh≈ ∆
fecha_inicio
hh∆ “
<
hh” ‘
	anteriorA
hh’ ﬁ
)
hhﬁ ﬂ
.ii 
OrderByDescendingii ,
(ii, -
tii- .
=>ii/ 1
tii2 3
.ii3 4
idii4 6
)ii6 7
.ii7 8
FirstOrDefaultii8 F
(iiF G
)iiG H
.iiH I
Detalle_transaccioniiI \
.ii\ ]
Selectii] c
(iic d
dtiid f
=>iig i
newiij m
InventarioFisicoiin ~
(ii~ 
)	ii Ä
{jj 
IdTransaccionkk +
=kk, -
dtkk. 0
.kk0 1
id_transaccionkk1 ?
,kk? @
Cantidadll &
=ll' (
dtll) +
.ll+ ,
cantidadll, 4
,ll4 5
CantidadSecundariamm 0
=mm1 2
dtmm3 5
.mm5 6
cantidad_secundariamm6 I
,mmI J
	IdAlmacennn '
=nn( )
	idAlmacennn* 3
,nn3 4

IdConceptooo (
=oo) *
dtoo+ -
.oo- .
id_concepto_negociooo. A
,ooA B
Lotepp "
=pp# $
dtpp% '
.pp' (
lotepp( ,
,pp, -
Fechaqq #
=qq$ %
dtqq& (
.qq( )
Transaccionqq) 4
.qq4 5
fecha_inicioqq5 A
}rr 
)rr 
;rr 
}ss 
returntt 

inventariott !
;tt! "
}uu 
catchvv 
(vv 
	Exceptionvv 
evv 
)vv 
{ww 
throwxx 
exx 
;xx 
}yy 
}zz 	
public|| 
IEnumerable|| 
<|| 
InventarioHistorico|| .
>||. /1
%ObtenerInventariosHistoricosDespuesDe||0 U
(||U V
int||V Y
	idAlmacen||Z c
,||c d
DateTime||e m
	despuesDe||n w
)||w x
{}} 	
try~~ 
{ 
IEnumerable
ÄÄ 
<
ÄÄ !
InventarioHistorico
ÄÄ /
>
ÄÄ/ 0

inventario
ÄÄ1 ;
=
ÄÄ< =
new
ÄÄ> A
List
ÄÄB F
<
ÄÄF G!
InventarioHistorico
ÄÄG Z
>
ÄÄZ [
(
ÄÄ[ \
)
ÄÄ\ ]
;
ÄÄ] ^
SigescomEntities
ÅÅ  
_db
ÅÅ! $
=
ÅÅ% &
new
ÅÅ' *
SigescomEntities
ÅÅ+ ;
(
ÅÅ; <
)
ÅÅ< =
;
ÅÅ= >
if
ÇÇ 
(
ÇÇ 
_db
ÇÇ 
.
ÇÇ 
Transaccion
ÇÇ #
.
ÇÇ# $
Any
ÇÇ$ '
(
ÇÇ' (
t
ÇÇ( )
=>
ÇÇ* ,
t
ÇÇ- .
.
ÇÇ. /&
id_actor_negocio_interno
ÇÇ/ G
==
ÇÇH J
	idAlmacen
ÇÇK T
&&
ÇÇU W
t
ÇÇX Y
.
ÇÇY Z!
id_tipo_transaccion
ÇÇZ m
==
ÇÇn p"
TransaccionSettingsÇÇq Ñ
.ÇÇÑ Ö
DefaultÇÇÖ å
.ÇÇå ç4
$IdTipoTransaccionInventarioHistoricoÇÇç ±
&&ÇÇ≤ ¥
tÇÇµ ∂
.ÇÇ∂ ∑
fecha_inicioÇÇ∑ √
>ÇÇƒ ≈
	despuesDeÇÇ∆ œ
)ÇÇœ –
)ÇÇ– —
{
ÉÉ 

inventario
ÑÑ 
=
ÑÑ  
_db
ÑÑ! $
.
ÑÑ$ %
Transaccion
ÑÑ% 0
.
ÑÑ0 1
Where
ÑÑ1 6
(
ÑÑ6 7
t
ÑÑ7 8
=>
ÑÑ9 ;
t
ÑÑ< =
.
ÑÑ= >&
id_actor_negocio_interno
ÑÑ> V
==
ÑÑW Y
	idAlmacen
ÑÑZ c
&&
ÑÑd f
t
ÑÑg h
.
ÑÑh i!
id_tipo_transaccion
ÑÑi |
==
ÑÑ} #
TransaccionSettingsÑÑÄ ì
.ÑÑì î
DefaultÑÑî õ
.ÑÑõ ú4
$IdTipoTransaccionInventarioHistoricoÑÑú ¿
&&ÑÑ¡ √
tÑÑƒ ≈
.ÑÑ≈ ∆
fecha_inicioÑÑ∆ “
>ÑÑ” ‘
	despuesDeÑÑ’ ﬁ
)ÑÑﬁ ﬂ
.ÑÑﬂ ‡

SelectManyÑÑ‡ Í
(ÑÑÍ Î
tÑÑÎ Ï
=>ÑÑÌ Ô
tÑÑ Ò
.ÑÑÒ Ú#
Detalle_transaccionÑÑÚ Ö
)ÑÑÖ Ü
.ÑÑÜ á
SelectÑÑá ç
(ÑÑç é
dtÑÑé ê
=>ÑÑë ì
newÑÑî ó#
InventarioHistoricoÑÑò ´
(ÑÑ´ ¨
)ÑÑ¨ ≠
{
ÖÖ "
IdDetalleTransaccion
ÜÜ ,
=
ÜÜ- .
dt
ÜÜ/ 1
.
ÜÜ1 2
id
ÜÜ2 4
,
ÜÜ4 5
Cantidad
áá  
=
áá! "
dt
áá# %
.
áá% &
cantidad
áá& .
,
áá. /

IdConcepto
àà "
=
àà# $
dt
àà% '
.
àà' (!
id_concepto_negocio
àà( ;
,
àà; <
Descripcion
ââ #
=
ââ$ %
dt
ââ& (
.
ââ( )
detalle
ââ) 0
,
ââ0 1
ValorUnitario
ää %
=
ää& '
dt
ää( *
.
ää* +
precio_unitario
ää+ :
,
ää: ;

ValorTotal
ãã "
=
ãã# $
dt
ãã% '
.
ãã' (
total
ãã( -
,
ãã- . 
CantidadSecundaria
åå *
=
åå+ ,
dt
åå- /
.
åå/ 0!
cantidad_secundaria
åå0 C
,
ååC D
Lote
çç 
=
çç 
dt
çç !
.
çç! "
lote
çç" &
,
çç& '
}
éé 
)
éé 
;
éé 
}
èè 
return
êê 

inventario
êê !
;
êê! "
}
ëë 
catch
íí 
(
íí 
	Exception
íí 
e
íí 
)
íí 
{
ìì 
throw
îî 
e
îî 
;
îî 
}
ïï 
}
ññ 	
public
òò 
IEnumerable
òò 
<
òò "
InventarioValorizado
òò /
>
òò/ 0A
3ObtenerUltimoInventarioValorizadoHistoricoAnteriorA
òò1 d
(
òòd e
int
òòe h
	idAlmacen
òòi r
,
òòr s
DateTime
òòt |
	anteriorAòò} Ü
)òòÜ á
{
ôô 	
try
öö 
{
õõ 
IEnumerable
úú 
<
úú "
InventarioValorizado
úú 0
>
úú0 1

inventario
úú2 <
=
úú= >
new
úú? B
List
úúC G
<
úúG H"
InventarioValorizado
úúH \
>
úú\ ]
(
úú] ^
)
úú^ _
;
úú_ `
SigescomEntities
ùù  
_db
ùù! $
=
ùù% &
new
ùù' *
SigescomEntities
ùù+ ;
(
ùù; <
)
ùù< =
;
ùù= >
if
ûû 
(
ûû 
_db
ûû 
.
ûû 
Transaccion
ûû #
.
ûû# $
Any
ûû$ '
(
ûû' (
t
ûû( )
=>
ûû* ,
t
ûû- .
.
ûû. /&
id_actor_negocio_interno
ûû/ G
==
ûûH J
	idAlmacen
ûûK T
&&
ûûU W
t
ûûX Y
.
ûûY Z!
id_tipo_transaccion
ûûZ m
==
ûûn p"
TransaccionSettingsûûq Ñ
.ûûÑ Ö
DefaultûûÖ å
.ûûå ç4
$IdTipoTransaccionInventarioHistoricoûûç ±
&&ûû≤ ¥
tûûµ ∂
.ûû∂ ∑
fecha_inicioûû∑ √
<ûûƒ ≈
	anteriorAûû∆ œ
)ûûœ –
)ûû– —
{
üü 

inventario
†† 
=
††  
_db
††! $
.
††$ %
Transaccion
††% 0
.
††0 1
Where
††1 6
(
††6 7
t
††7 8
=>
††9 ;
t
††< =
.
††= >&
id_actor_negocio_interno
††> V
==
††W Y
	idAlmacen
††Z c
&&
††d f
t
††g h
.
††h i!
id_tipo_transaccion
††i |
==
††} #
TransaccionSettings††Ä ì
.††ì î
Default††î õ
.††õ ú4
$IdTipoTransaccionInventarioHistorico††ú ¿
&&††¡ √
t††ƒ ≈
.††≈ ∆
fecha_inicio††∆ “
<††” ‘
	anteriorA††’ ﬁ
)††ﬁ ﬂ
.
°° 
OrderByDescending
°° ,
(
°°, -
t
°°- .
=>
°°/ 1
t
°°2 3
.
°°3 4
id
°°4 6
)
°°6 7
.
°°7 8
FirstOrDefault
°°8 F
(
°°F G
)
°°G H
.
°°H I!
Detalle_transaccion
°°I \
.
°°\ ]
Select
°°] c
(
°°c d
dt
°°d f
=>
°°g i
new
°°j m#
InventarioValorizado°°n Ç
(°°Ç É
)°°É Ñ
{
¢¢ 
IdTransaccion
££ +
=
££, -
dt
££. 0
.
££0 1
id_transaccion
££1 ?
,
££? @
Cantidad
§§ &
=
§§' (
dt
§§) +
.
§§+ ,
cantidad
§§, 4
,
§§4 5 
CantidadSecundaria
•• 0
=
••1 2
dt
••3 5
.
••5 6!
cantidad_secundaria
••6 I
,
••I J
	IdAlmacen
¶¶ '
=
¶¶( )
	idAlmacen
¶¶* 3
,
¶¶3 4

IdConcepto
ßß (
=
ßß) *
dt
ßß+ -
.
ßß- .!
id_concepto_negocio
ßß. A
,
ßßA B
Lote
®® "
=
®®# $
dt
®®% '
.
®®' (
lote
®®( ,
,
®®, -
Fecha
©© #
=
©©$ %
dt
©©& (
.
©©( )
Transaccion
©©) 4
.
©©4 5
fecha_inicio
©©5 A
,
©©A B
ValorUnitario
™™ +
=
™™, -
dt
™™. 0
.
™™0 1
precio_unitario
™™1 @
,
™™@ A

ValorTotal
´´ (
=
´´) *
dt
´´+ -
.
´´- .
total
´´. 3
}
¨¨ 
)
¨¨ 
;
¨¨ 
}
≠≠ 
return
ÆÆ 

inventario
ÆÆ !
;
ÆÆ! "
}
ØØ 
catch
∞∞ 
(
∞∞ 
	Exception
∞∞ 
e
∞∞ 
)
∞∞ 
{
±± 
throw
≤≤ 
e
≤≤ 
;
≤≤ 
}
≥≥ 
}
¥¥ 	
public
∂∂ 
IEnumerable
∂∂ 
<
∂∂ 
InventarioFisico
∂∂ +
>
∂∂+ ,=
/ObtenerUltimoInventarioFisicoHistoricoAnteriorA
∂∂- \
(
∂∂\ ]
int
∂∂] `
	idAlmacen
∂∂a j
,
∂∂j k
DateTime
∂∂l t
	anteriorA
∂∂u ~
,
∂∂~ 
int∂∂Ä É
[∂∂É Ñ
]∂∂Ñ Ö
familias∂∂Ü é
)∂∂é è
{
∑∑ 	
try
∏∏ 
{
ππ 
IEnumerable
∫∫ 
<
∫∫ 
InventarioFisico
∫∫ ,
>
∫∫, -

inventario
∫∫. 8
=
∫∫9 :
new
∫∫; >
List
∫∫? C
<
∫∫C D
InventarioFisico
∫∫D T
>
∫∫T U
(
∫∫U V
)
∫∫V W
;
∫∫W X
SigescomEntities
ºº  
_db
ºº! $
=
ºº% &
new
ºº' *
SigescomEntities
ºº+ ;
(
ºº; <
)
ºº< =
;
ºº= >
if
ΩΩ 
(
ΩΩ 
_db
ΩΩ 
.
ΩΩ 
Transaccion
ΩΩ #
.
ΩΩ# $
Any
ΩΩ$ '
(
ΩΩ' (
t
ΩΩ( )
=>
ΩΩ* ,
t
ΩΩ- .
.
ΩΩ. /&
id_actor_negocio_interno
ΩΩ/ G
==
ΩΩH J
	idAlmacen
ΩΩK T
&&
ΩΩU W
t
ΩΩX Y
.
ΩΩY Z!
id_tipo_transaccion
ΩΩZ m
==
ΩΩn p"
TransaccionSettingsΩΩq Ñ
.ΩΩÑ Ö
DefaultΩΩÖ å
.ΩΩå ç4
$IdTipoTransaccionInventarioHistoricoΩΩç ±
&&ΩΩ≤ ¥
tΩΩµ ∂
.ΩΩ∂ ∑
fecha_inicioΩΩ∑ √
<ΩΩƒ ≈
	anteriorAΩΩ∆ œ
)ΩΩœ –
)ΩΩ– —
{
ææ 

inventario
øø 
=
øø  
_db
øø! $
.
øø$ %
Transaccion
øø% 0
.
øø0 1
Where
øø1 6
(
øø6 7
t
øø7 8
=>
øø9 ;
t
øø< =
.
øø= >&
id_actor_negocio_interno
øø> V
==
øøW Y
	idAlmacen
øøZ c
&&
øød f
t
øøg h
.
øøh i!
id_tipo_transaccion
øøi |
==
øø} #
TransaccionSettingsøøÄ ì
.øøì î
Defaultøøî õ
.øøõ ú4
$IdTipoTransaccionInventarioHistoricoøøú ¿
&&øø¡ √
tøøƒ ≈
.øø≈ ∆
fecha_inicioøø∆ “
<øø” ‘
	anteriorAøø’ ﬁ
)øøﬁ ﬂ
.
¿¿ 
OrderByDescending
¿¿ ,
(
¿¿, -
t
¿¿- .
=>
¿¿/ 1
t
¿¿2 3
.
¿¿3 4
id
¿¿4 6
)
¿¿6 7
.
¿¿7 8
FirstOrDefault
¿¿8 F
(
¿¿F G
)
¿¿G H
.
¿¿H I!
Detalle_transaccion
¿¿I \
.
¿¿\ ]
Where
¿¿] b
(
¿¿b c
dt
¿¿c e
=>
¿¿f h
familias
¿¿i q
.
¿¿q r
Contains
¿¿r z
(
¿¿z {
dt
¿¿{ }
.
¿¿} ~
Concepto_negocio¿¿~ é
.¿¿é è"
id_concepto_basico¿¿è °
)¿¿° ¢
)¿¿¢ £
.¿¿£ §
Select¿¿§ ™
(¿¿™ ´
dt¿¿´ ≠
=>¿¿Æ ∞
new¿¿± ¥ 
InventarioFisico¿¿µ ≈
(¿¿≈ ∆
)¿¿∆ «
{
¡¡ 
IdTransaccion
¬¬ +
=
¬¬, -
dt
¬¬. 0
.
¬¬0 1
id_transaccion
¬¬1 ?
,
¬¬? @
Cantidad
√√ &
=
√√' (
dt
√√) +
.
√√+ ,
cantidad
√√, 4
,
√√4 5 
CantidadSecundaria
ƒƒ 0
=
ƒƒ1 2
dt
ƒƒ3 5
.
ƒƒ5 6!
cantidad_secundaria
ƒƒ6 I
,
ƒƒI J
	IdAlmacen
≈≈ '
=
≈≈( )
	idAlmacen
≈≈* 3
,
≈≈3 4

IdConcepto
∆∆ (
=
∆∆) *
dt
∆∆+ -
.
∆∆- .!
id_concepto_negocio
∆∆. A
,
∆∆A B
Lote
«« "
=
««# $
dt
««% '
.
««' (
lote
««( ,
,
««, -
Fecha
»» #
=
»»$ %
dt
»»& (
.
»»( )
Transaccion
»») 4
.
»»4 5
fecha_inicio
»»5 A
}
…… 
)
…… 
;
…… 
}
   
return
ÀÀ 

inventario
ÀÀ !
;
ÀÀ! "
}
ÕÕ 
catch
ŒŒ 
(
ŒŒ 
	Exception
ŒŒ 
e
ŒŒ 
)
ŒŒ 
{
œœ 
throw
–– 
e
–– 
;
–– 
}
—— 
}
““ 	
public
‘‘ 
IEnumerable
‘‘ 
<
‘‘ "
InventarioValorizado
‘‘ /
>
‘‘/ 0A
3ObtenerUltimoInventarioValorizadoHistoricoAnteriorA
‘‘1 d
(
‘‘d e
int
‘‘e h
	idAlmacen
‘‘i r
,
‘‘r s
DateTime
‘‘t |
	anteriorA‘‘} Ü
,‘‘Ü á
int‘‘à ã
[‘‘ã å
]‘‘å ç
familias‘‘é ñ
)‘‘ñ ó
{
’’ 	
try
÷÷ 
{
◊◊ 
IEnumerable
ÿÿ 
<
ÿÿ "
InventarioValorizado
ÿÿ 0
>
ÿÿ0 1

inventario
ÿÿ2 <
=
ÿÿ= >
new
ÿÿ? B
List
ÿÿC G
<
ÿÿG H"
InventarioValorizado
ÿÿH \
>
ÿÿ\ ]
(
ÿÿ] ^
)
ÿÿ^ _
;
ÿÿ_ `
SigescomEntities
⁄⁄  
_db
⁄⁄! $
=
⁄⁄% &
new
⁄⁄' *
SigescomEntities
⁄⁄+ ;
(
⁄⁄; <
)
⁄⁄< =
;
⁄⁄= >
if
€€ 
(
€€ 
_db
€€ 
.
€€ 
Transaccion
€€ #
.
€€# $
Any
€€$ '
(
€€' (
t
€€( )
=>
€€* ,
t
€€- .
.
€€. /&
id_actor_negocio_interno
€€/ G
==
€€H J
	idAlmacen
€€K T
&&
€€U W
t
€€X Y
.
€€Y Z!
id_tipo_transaccion
€€Z m
==
€€n p"
TransaccionSettings€€q Ñ
.€€Ñ Ö
Default€€Ö å
.€€å ç4
$IdTipoTransaccionInventarioHistorico€€ç ±
&&€€≤ ¥
t€€µ ∂
.€€∂ ∑
fecha_inicio€€∑ √
<€€ƒ ≈
	anteriorA€€∆ œ
)€€œ –
)€€– —
{
‹‹ 
return
›› 
_db
›› 
.
›› 
Transaccion
›› *
.
››* +
Where
››+ 0
(
››0 1
t
››1 2
=>
››3 5
t
››6 7
.
››7 8&
id_actor_negocio_interno
››8 P
==
››Q S
	idAlmacen
››T ]
&&
››^ `
t
››a b
.
››b c!
id_tipo_transaccion
››c v
==
››w y"
TransaccionSettings››z ç
.››ç é
Default››é ï
.››ï ñ4
$IdTipoTransaccionInventarioHistorico››ñ ∫
&&››ª Ω
t››æ ø
.››ø ¿
fecha_inicio››¿ Ã
<››Õ Œ
	anteriorA››œ ÿ
)››ÿ Ÿ
.
ﬁﬁ 
OrderByDescending
ﬁﬁ ,
(
ﬁﬁ, -
t
ﬁﬁ- .
=>
ﬁﬁ/ 1
t
ﬁﬁ2 3
.
ﬁﬁ3 4
id
ﬁﬁ4 6
)
ﬁﬁ6 7
.
ﬁﬁ7 8
FirstOrDefault
ﬁﬁ8 F
(
ﬁﬁF G
)
ﬁﬁG H
.
ﬁﬁH I!
Detalle_transaccion
ﬁﬁI \
.
ﬁﬁ\ ]
Where
ﬁﬁ] b
(
ﬁﬁb c
dt
ﬁﬁc e
=>
ﬁﬁf h
familias
ﬁﬁi q
.
ﬁﬁq r
Contains
ﬁﬁr z
(
ﬁﬁz {
dt
ﬁﬁ{ }
.
ﬁﬁ} ~
Concepto_negocioﬁﬁ~ é
.ﬁﬁé è"
id_concepto_basicoﬁﬁè °
)ﬁﬁ° ¢
)ﬁﬁ¢ £
.ﬁﬁ£ §
Selectﬁﬁ§ ™
(ﬁﬁ™ ´
dtﬁﬁ´ ≠
=>ﬁﬁÆ ∞
newﬁﬁ± ¥$
InventarioValorizadoﬁﬁµ …
(ﬁﬁ…  
)ﬁﬁ  À
{
ﬂﬂ 
IdTransaccion
‡‡ +
=
‡‡, -
dt
‡‡. 0
.
‡‡0 1
id_transaccion
‡‡1 ?
,
‡‡? @
Cantidad
·· &
=
··' (
dt
··) +
.
··+ ,
cantidad
··, 4
,
··4 5 
CantidadSecundaria
‚‚ 0
=
‚‚1 2
dt
‚‚3 5
.
‚‚5 6!
cantidad_secundaria
‚‚6 I
,
‚‚I J
	IdAlmacen
„„ '
=
„„( )
	idAlmacen
„„* 3
,
„„3 4

IdConcepto
‰‰ (
=
‰‰) *
dt
‰‰+ -
.
‰‰- .!
id_concepto_negocio
‰‰. A
,
‰‰A B
Lote
ÂÂ "
=
ÂÂ# $
dt
ÂÂ% '
.
ÂÂ' (
lote
ÂÂ( ,
,
ÂÂ, -
Fecha
ÊÊ #
=
ÊÊ$ %
dt
ÊÊ& (
.
ÊÊ( )
Transaccion
ÊÊ) 4
.
ÊÊ4 5
fecha_inicio
ÊÊ5 A
,
ÊÊA B
ValorUnitario
ÁÁ +
=
ÁÁ, -
dt
ÁÁ. 0
.
ÁÁ0 1
precio_unitario
ÁÁ1 @
,
ÁÁ@ A

ValorTotal
ËË (
=
ËË) *
dt
ËË+ -
.
ËË- .
total
ËË. 3
}
ÈÈ 
)
ÈÈ 
;
ÈÈ 
}
ÍÍ 
return
ÎÎ 

inventario
ÎÎ !
;
ÎÎ! "
}
ÌÌ 
catch
ÓÓ 
(
ÓÓ 
	Exception
ÓÓ 
e
ÓÓ 
)
ÓÓ 
{
ÔÔ 
throw
 
e
 
;
 
}
ÒÒ 
}
ÚÚ 	
public
ÛÛ 
Transaccion
ÛÛ .
 ObtenerUltimoInventarioHistorico
ÛÛ ;
(
ÛÛ; <
int
ÛÛ< ?
	idAlmacen
ÛÛ@ I
)
ÛÛI J
{
ÙÙ 	
try
ıı 
{
ˆˆ 
SigescomEntities
˜˜  
_db
˜˜! $
=
˜˜% &
new
˜˜' *
SigescomEntities
˜˜+ ;
(
˜˜; <
)
˜˜< =
;
˜˜= >
return
¯¯ 
_db
¯¯ 
.
¯¯ 
Transaccion
¯¯ &
.
˘˘ 
Include
˘˘ 
(
˘˘ 
t
˘˘ 
=>
˘˘ !
t
˘˘" #
.
˘˘# $!
Detalle_transaccion
˘˘$ 7
)
˘˘7 8
.
˙˙ 
Where
˙˙  
(
˙˙  !
t
˙˙! "
=>
˙˙# %
t
˙˙& '
.
˙˙' (&
id_actor_negocio_interno
˙˙( @
==
˙˙A C
	idAlmacen
˙˙D M
&&
˙˙N P
t
˙˙Q R
.
˙˙R S!
id_tipo_transaccion
˙˙S f
==
˙˙g i!
TransaccionSettings
˙˙j }
.
˙˙} ~
Default˙˙~ Ö
.˙˙Ö Ü4
$IdTipoTransaccionInventarioHistorico˙˙Ü ™
)˙˙™ ´
.
˚˚ 
OrderByDescending
˚˚ ,
(
˚˚, -
t
˚˚- .
=>
˚˚/ 1
t
˚˚2 3
.
˚˚3 4
id
˚˚4 6
)
˚˚6 7
.
˚˚7 8
FirstOrDefault
˚˚8 F
(
˚˚F G
)
˚˚G H
;
˚˚H I
}
¸¸ 
catch
˝˝ 
(
˝˝ 
	Exception
˝˝ 
e
˝˝ 
)
˝˝ 
{
˛˛ 
throw
ˇˇ 
e
ˇˇ 
;
ˇˇ 
}
ÄÄ 
}
ÅÅ 	
public
ÇÇ '
InventarioConceptoNegocio
ÇÇ (5
'ObtenerUltimoInventarioHistoricoAntesDe
ÇÇ) P
(
ÇÇP Q
int
ÇÇQ T
	idAlmacen
ÇÇU ^
,
ÇÇ^ _
int
ÇÇ` c

idConcepto
ÇÇd n
,
ÇÇn o
string
ÇÇp v
lote
ÇÇw {
,
ÇÇ{ |
DateTimeÇÇ} Ö
fechaÇÇÜ ã
)ÇÇã å
{
ÉÉ 	'
InventarioConceptoNegocio
ÑÑ %

inventario
ÑÑ& 0
=
ÑÑ1 2
null
ÑÑ3 7
;
ÑÑ7 8
SigescomEntities
ÖÖ 
_db
ÖÖ  
=
ÖÖ! "
new
ÖÖ# &
SigescomEntities
ÖÖ' 7
(
ÖÖ7 8
)
ÖÖ8 9
;
ÖÖ9 :
if
ÜÜ 
(
ÜÜ 
_db
ÜÜ 
.
ÜÜ 
Transaccion
ÜÜ 
.
ÜÜ  
Any
ÜÜ  #
(
ÜÜ# $
t
ÜÜ$ %
=>
ÜÜ& (
t
ÜÜ) *
.
ÜÜ* +&
id_actor_negocio_interno
ÜÜ+ C
==
ÜÜD F
	idAlmacen
ÜÜG P
&&
ÜÜQ S
t
ÜÜT U
.
ÜÜU V!
id_tipo_transaccion
ÜÜV i
==
ÜÜj l"
TransaccionSettingsÜÜm Ä
.ÜÜÄ Å
DefaultÜÜÅ à
.ÜÜà â4
$IdTipoTransaccionInventarioHistoricoÜÜâ ≠
&&ÜÜÆ ∞
tÜÜ± ≤
.ÜÜ≤ ≥
fecha_inicioÜÜ≥ ø
<ÜÜ¿ ¡
fechaÜÜ¬ «
)ÜÜ« »
)ÜÜ» …
{
áá 

inventario
àà 
=
àà 
_db
àà  
.
àà  !
Transaccion
àà! ,
.
àà, -
Where
àà- 2
(
àà2 3
t
àà3 4
=>
àà5 7
t
àà8 9
.
àà9 :&
id_actor_negocio_interno
àà: R
==
ààS U
	idAlmacen
ààV _
&&
àà` b
t
ààc d
.
ààd e!
id_tipo_transaccion
ààe x
==
àày {"
TransaccionSettingsàà| è
.ààè ê
Defaultààê ó
.ààó ò4
$IdTipoTransaccionInventarioHistoricoààò º
&&ààΩ ø
tàà¿ ¡
.àà¡ ¬
fecha_inicioàà¬ Œ
<ààœ –
fechaàà— ÷
)àà÷ ◊
.àà◊ ÿ!
OrderByDescendingààÿ È
(ààÈ Í
tààÍ Î
=>ààÏ Ó
tààÔ 
.àà Ò
fecha_inicioààÒ ˝
)àà˝ ˛
.àà˛ ˇ
FirstOrDefaultààˇ ç
(ààç é
)ààé è
.ààè ê#
Detalle_transaccionààê £
.àà£ §
Whereàà§ ©
(àà© ™
dtàà™ ¨
=>àà≠ Ø
dtàà∞ ≤
.àà≤ ≥#
id_concepto_negocioàà≥ ∆
==àà« …

idConceptoàà  ‘
&&àà’ ◊
dtààÿ ⁄
.àà⁄ €
loteàà€ ﬂ
==àà‡ ‚
loteàà„ Á
)ààÁ Ë
.ààË È
SelectààÈ Ô
(ààÔ 
invàà Û
=>ààÙ ˆ
newàà˜ ˙)
InventarioConceptoNegocioàà˚ î
(ààî ï
)ààï ñ
{
ââ 
IdConceptoNegocio
ää %
=
ää& '

idConcepto
ää( 2
,
ää2 3
Lote
ãã 
=
ãã 
lote
ãã 
,
ãã  
Fecha
åå 
=
åå 
fecha
åå !
,
åå! "
CostoUnitario
çç !
=
çç" #
inv
çç$ '
.
çç' (
precio_unitario
çç( 7
,
çç7 8

CostoTotal
éé 
=
éé  
inv
éé! $
.
éé$ %
total
éé% *
,
éé* +
CantidadPrincipal
èè %
=
èè& '
inv
èè( +
.
èè+ ,
cantidad
èè, 4
,
èè4 5 
CantidadSecundaria
êê &
=
êê' (
inv
êê) ,
.
êê, -!
cantidad_secundaria
êê- @
}
ëë 
)
ëë 
.
ëë 
SingleOrDefault
ëë "
(
ëë" #
)
ëë# $
;
ëë$ %
}
ìì 
return
îî 

inventario
îî 
;
îî 
}
ññ 	
}
úú 
}ùù ù)
TD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\Concepto\Concepto_Datos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
." #
	Conceptos# ,
{ 
public 

partial 
class 
Concepto_Datos '
:' (!
IConcepto_Repositorio) >
{ 
public 
IEnumerable 
< 
Concepto #
># $
ObtenerConceptos% 5
(5 6
int6 9
[9 :
]: ;
idsConceptos< H
)H I
{ 	
SigescomEntities 
_db  
=! "
new# &
SigescomEntities' 7
(7 8
)8 9
;9 :
return 
_db 
. 
Concepto_negocio '
.' (
Where( -
(- .
cn. 0
=>1 3
idsConceptos4 @
.@ A
ContainsA I
(I J
cnJ L
.L M
idM O
)O P
)P Q
.Q R
SelectR X
(X Y
cnY [
=>[ ]
new^ a
Conceptob j
(j k
)k l
{m n
Idn p
=p q
cnr t
.t u
idu w
,w x
CodigoBarra	y Ñ
=
Ñ Ö
cn
Ü à
.
à â
codigo
â è
,
è ê
Nombre
ë ó
=
ó ò
cn
ô õ
.
õ ú
nombre
ú ¢
,
¢ £
Familia
§ ´
=
´ ¨
cn
≠ Ø
.
Ø ∞
Detalle_maestro4
∞ ¿
.
¿ ¡
nombre
¡ «
,
« »
UnidadMedida
… ’
=
’ ÷
cn
◊ Ÿ
.
Ÿ ⁄
Detalle_maestro
⁄ È
.
È Í
codigo
Í 
,
 Ò
StockMinimo
Ú ˝
=
˝ ˛
cn
ˇ Å
.
Å Ç
stock_minimo
Ç é
}
è ê
)
ê ë
;
ë í
} 	
public 
IEnumerable 
< 
Concepto_negocio +
>+ ,1
%ObtenerConceptosComercialesPorFamilia- R
(R S
intS V
	idFamiliaW `
)` a
{ 	
try 
{ 
var 
idRol 
= 
ConceptoSettings ,
., -
Default- 4
.4 5
IdRolMercaderia5 D
;D E
SigescomEntities  
_db! $
=% &
new' *
SigescomEntities+ ;
(; <
)< =
;= >
return 
_db 
.  
Concepto_negocio_rol /
./ 0
Include0 7
(7 8
cnr8 ;
=>< >
cnr? B
.B C
RolC F
)F G
. 
Where 
( 
cnr 
=> !
cnr" %
.% &
id_rol& ,
==- /
idRol0 5
&&6 8
cnr9 <
.< =
Concepto_negocio= M
.M N
id_concepto_basicoN `
==a c
	idFamiliad m
)m n
. 
Select 
( 
cnr 
=>  "
cnr# &
.& '
Concepto_negocio' 7
)7 8
;8 9
} 
catch   
(   
	Exception   
e   
)   
{!! 
throw"" 
e"" 
;"" 
}## 
}$$ 	
public&& 
IEnumerable&& 
<&& 
int&& 
>&& 6
*ObtenerIdsDeConceptosComercialesPorFamilia&&  J
(&&J K
int&&K N
	idFamilia&&O X
)&&X Y
{'' 	
try(( 
{)) 
var** 
idRol** 
=** 
ConceptoSettings** ,
.**, -
Default**- 4
.**4 5
IdRolMercaderia**5 D
;**D E
SigescomEntities++  
_db++! $
=++% &
new++' *
SigescomEntities+++ ;
(++; <
)++< =
;++= >
return,, 
_db,, 
.,,  
Concepto_negocio_rol,, /
.,,/ 0
Include,,0 7
(,,7 8
cnr,,8 ;
=>,,< >
cnr,,? B
.,,B C
Rol,,C F
),,F G
.-- 
Where-- 
(-- 
cnr-- 
=>-- !
cnr--" %
.--% &
id_rol--& ,
==--- /
idRol--0 5
&&--6 8
cnr--9 <
.--< =
Concepto_negocio--= M
.--M N
id_concepto_basico--N `
==--a c
	idFamilia--d m
)--m n
... 
Select.. 
(.. 
cnr.. 
=>..  "
cnr..# &
...& '
Concepto_negocio..' 7
...7 8
id..8 :
)..: ;
;..; <
}// 
catch00 
(00 
	Exception00 
e00 
)00 
{11 
throw22 
e22 
;22 
}33 
}44 	
}55 
}66 €¡
VD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\Finanzas\ArqueoCaja_Datos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
{ 
public 

partial 
class 
ArqueoCaja_Datos )
:* +#
IArqueoCaja_Repositorio, C
{ 
public 
IEnumerable 
< 
IngresoEgreso (
>( )"
ObtenerIngresosEgresos* @
(@ A
intA D
idCajaE K
,K L
DateTimeM U

fechaDesdeV `
,` a
DateTimeb j

fechaHastak u
,u v
boolw {
	esIngreso	| Ö
)
Ö Ü
{ 	
SigescomEntities 
_db  
=! "
new# &
SigescomEntities' 7
(7 8
)8 9
;9 :
var 
ingresosEgresos 
=  !
_db" %
.% &2
&Accion_de_negocio_por_tipo_transaccion& L
.  !
Where! &
(& '
antt' +
=>, .
antt/ 3
.3 4 
id_accion_de_negocio4 H
==I K
TransaccionSettingsL _
._ `
Default` g
.g h.
!IdAccionDeNegocioMovimientoEnCaja	h â
&&
ä å
antt
ç ë
.
ë í
valor
í ó
==
ò ö
	esIngreso
õ §
)
§ •
.  !

SelectMany! +
(+ ,
antt, 0
=>1 3
antt4 8
.8 9
Tipo_transaccion9 I
.I J
TransaccionJ U
)U V
.  !
Where! &
(& '
t' (
=>) +
t, -
.- .
fecha_inicio. :
>=; =

fechaDesde> H
&&I K
tL M
.M N
fecha_inicioN Z
<=[ ]

fechaHasta^ h
&&i k
tl m
.m n%
id_actor_negocio_interno	n Ü
==
á â
idCaja
ä ê
&&
ë ì
t
î ï
.
ï ñ
id_estado_actual
ñ ¶
==
ß ©
MaestroSettings
™ π
.
π ∫
Default
∫ ¡
.
¡ ¬.
 IdDetalleMaestroEstadoConfirmado
¬ ‚
)
‚ „
.  !
Select! '
(' (
t( )
=>* ,
new- 0
IngresoEgreso1 >
(> ?
)? @
{  !
Fecha$ )
=* +
t, -
.- .
fecha_inicio. :
,: ;
IdOperacion  $ /
=  0 1
t  2 3
.  3 4
id_tipo_transaccion  4 G
,  G H
	Operacion!!$ -
=!!. /
t!!0 1
.!!1 2
Tipo_transaccion!!2 B
.!!B C
nombre_corto!!C O
,!!O P
IdMedioPago""$ /
=""0 1
t""2 3
.""3 4

Traza_pago""4 >
.""> ?
FirstOrDefault""? M
(""M N
)""N O
.""O P
id_medio_pago""P ]
,""] ^
	MedioPago##$ -
=##. /
t##0 1
.##1 2

Traza_pago##2 <
.##< =
FirstOrDefault##= K
(##K L
)##L M
.##M N
Detalle_maestro1##N ^
.##^ _
nombre##_ e
,##e f
Informacion$$$ /
=$$0 1
t$$2 3
.$$3 4

Traza_pago$$4 >
.$$> ?
FirstOrDefault$$? M
($$M N
)$$N O
.$$O P
traza$$P U
,$$U V
TipoComprobante%%$ 3
=%%4 5
t%%6 7
.%%7 8
Comprobante%%8 C
.%%C D
Detalle_maestro%%D S
.%%S T
valor%%T Y
,%%Y Z#
SerieYNumeroComprobante&&$ ;
=&&< =
t&&> ?
.&&? @
Comprobante&&@ K
.&&K L
numero_serie&&L X
+&&Y Z
$str&&[ ^
+&&_ `
t&&a b
.&&b c
Comprobante&&c n
.&&n o
numero&&o u
,&&u v
Importe''$ +
='', -
t''. /
.''/ 0
importe_total''0 =
}((  !
)))  !
;))! "
return** 
ingresosEgresos** "
;**" #
}++ 	
public,, 
IEnumerable,, 
<,, 
IngresoEgreso,, (
>,,( )0
$ObtenerIngresosEgresosPorOperaciones,,* N
(,,N O
int,,O R
idCaja,,S Y
,,,Y Z
DateTime,,[ c

fechaDesde,,d n
,,,n o
DateTime,,p x

fechaHasta	,,y É
,
,,É Ñ
int
,,Ö à
[
,,à â
]
,,â ä
operaciones
,,ã ñ
)
,,ñ ó
{-- 	
SigescomEntities.. 
_db..  
=..! "
new..# &
SigescomEntities..' 7
(..7 8
)..8 9
;..9 :
var// 
ingresosEgresos// 
=//  !
_db//" %
.//% &
Transaccion//& 1
.//1 2
Where//2 7
(//7 8
t//8 9
=>//: <
t//= >
.//> ?
fecha_inicio//? K
>=//L N

fechaDesde//O Y
&&//Z \
t//] ^
.//^ _
fecha_inicio//_ k
<=//l n

fechaHasta//o y
&&//z |
t//} ~
.//~ %
id_actor_negocio_interno	// ó
==
//ò ö
idCaja
//õ °
&&
//¢ §
operaciones
//• ∞
.
//∞ ±
Contains
//± π
(
//π ∫
t
//∫ ª
.
//ª º!
id_tipo_transaccion
//º œ
)
//œ –
)
//– —
.00  !
Select00! '
(00' (
t00( )
=>00* ,
new00- 0
IngresoEgreso001 >
(00> ?
)00? @
{11  !
Fecha22$ )
=22* +
t22, -
.22- .
fecha_inicio22. :
,22: ;
IdOperacion33$ /
=330 1
t332 3
.333 4
id_tipo_transaccion334 G
,33G H
	Operacion44$ -
=44. /
t440 1
.441 2
Tipo_transaccion442 B
.44B C
nombre_corto44C O
,44O P
IdMedioPago55$ /
=550 1
t552 3
.553 4

Traza_pago554 >
.55> ?
FirstOrDefault55? M
(55M N
)55N O
.55O P
id_medio_pago55P ]
,55] ^
	MedioPago66$ -
=66. /
t660 1
.661 2

Traza_pago662 <
.66< =
FirstOrDefault66= K
(66K L
)66L M
.66M N
Detalle_maestro166N ^
.66^ _
nombre66_ e
,66e f
Informacion77$ /
=770 1
t772 3
.773 4

Traza_pago774 >
.77> ?
FirstOrDefault77? M
(77M N
)77N O
.77O P
traza77P U
,77U V
TipoComprobante88$ 3
=884 5
t886 7
.887 8
Comprobante888 C
.88C D
Detalle_maestro88D S
.88S T
valor88T Y
,88Y Z#
SerieYNumeroComprobante99$ ;
=99< =
t99> ?
.99? @
Comprobante99@ K
.99K L
numero_serie99L X
+99Y Z
$str99[ ^
+99_ `
t99a b
.99b c
Comprobante99c n
.99n o
numero99o u
,99u v
Importe::$ +
=::, -
t::. /
.::/ 0
importe_total::0 =
};;  !
)<<  !
;<<! "
return== 
ingresosEgresos== "
;==" #
}>> 	
public?? 
IEnumerable?? 
<?? 
IngresoEgreso?? (
>??( )/
#ObtenerIngresosEgresosPorMediosPago??* M
(??M N
int??N Q
idCaja??R X
,??X Y
DateTime??Z b

fechaDesde??c m
,??m n
DateTime??o w

fechaHasta	??x Ç
,
??Ç É
bool
??Ñ à
	esIngreso
??â í
,
??í ì
int
??î ó
[
??ó ò
]
??ò ô

mediosPago
??ö §
)
??§ •
{@@ 	
SigescomEntitiesAA 
_dbAA  
=AA! "
newAA# &
SigescomEntitiesAA' 7
(AA7 8
)AA8 9
;AA9 :
varBB 
ingresosEgresosBB 
=BB  !
_dbBB" %
.BB% &2
&Accion_de_negocio_por_tipo_transaccionBB& L
.CC  !
WhereCC! &
(CC& '
anttCC' +
=>CC, .
anttCC/ 3
.CC3 4 
id_accion_de_negocioCC4 H
==CCI K
TransaccionSettingsCCL _
.CC_ `
DefaultCC` g
.CCg h1
$IdAccionDeNegocioMovimientoEnAlmacen	CCh å
&&
CCç è
antt
CCê î
.
CCî ï
valor
CCï ö
==
CCõ ù
	esIngreso
CCû ß
)
CCß ®
.DD  !

SelectManyDD! +
(DD+ ,
anttDD, 0
=>DD1 3
anttDD4 8
.DD8 9
Tipo_transaccionDD9 I
.DDI J
TransaccionDDJ U
)DDU V
.EE  !
WhereEE! &
(EE& '
tEE' (
=>EE) +
tEE, -
.EE- .
fecha_inicioEE. :
>=EE; =

fechaDesdeEE> H
&&EEI K
tEEL M
.EEM N
fecha_inicioEEN Z
<=EE[ ]

fechaHastaEE^ h
&&EEi k
tEEl m
.EEm n%
id_actor_negocio_interno	EEn Ü
==
EEá â
idCaja
EEä ê
&&
EEë ì

mediosPago
EEî û
.
EEû ü
Contains
EEü ß
(
EEß ®
t
EE® ©
.
EE© ™

Traza_pago
EE™ ¥
.
EE¥ µ
First
EEµ ∫
(
EE∫ ª
)
EEª º
.
EEº Ω
id_medio_pago
EEΩ  
)
EE  À
&&
EEÃ Œ
t
EEœ –
.
EE– —
id_estado_actual
EE— ·
==
EE‚ ‰
MaestroSettings
EEÂ Ù
.
EEÙ ı
Default
EEı ¸
.
EE¸ ˝.
 IdDetalleMaestroEstadoConfirmado
EE˝ ù
)
EEù û
.FF  !
SelectFF! '
(FF' (
tFF( )
=>FF* ,
newFF- 0
IngresoEgresoFF1 >
(FF> ?
)FF? @
{GG  !
FechaHH$ )
=HH* +
tHH, -
.HH- .
fecha_inicioHH. :
,HH: ;
IdOperacionII$ /
=II0 1
tII2 3
.II3 4
id_tipo_transaccionII4 G
,IIG H
	OperacionJJ$ -
=JJ. /
tJJ0 1
.JJ1 2
Tipo_transaccionJJ2 B
.JJB C
nombre_cortoJJC O
,JJO P
IdMedioPagoKK$ /
=KK0 1
tKK2 3
.KK3 4

Traza_pagoKK4 >
.KK> ?
FirstOrDefaultKK? M
(KKM N
)KKN O
.KKO P
id_medio_pagoKKP ]
,KK] ^
	MedioPagoLL$ -
=LL. /
tLL0 1
.LL1 2

Traza_pagoLL2 <
.LL< =
FirstOrDefaultLL= K
(LLK L
)LLL M
.LLM N
Detalle_maestro1LLN ^
.LL^ _
nombreLL_ e
,LLe f
InformacionMM$ /
=MM0 1
tMM2 3
.MM3 4

Traza_pagoMM4 >
.MM> ?
FirstOrDefaultMM? M
(MMM N
)MMN O
.MMO P
trazaMMP U
,MMU V
TipoComprobanteNN$ 3
=NN4 5
tNN6 7
.NN7 8
ComprobanteNN8 C
.NNC D
Detalle_maestroNND S
.NNS T
valorNNT Y
,NNY Z#
SerieYNumeroComprobanteOO$ ;
=OO< =
tOO> ?
.OO? @
ComprobanteOO@ K
.OOK L
numero_serieOOL X
+OOY Z
$strOO[ ^
+OO_ `
tOOa b
.OOb c
ComprobanteOOc n
.OOn o
numeroOOo u
,OOu v
ImportePP$ +
=PP, -
tPP. /
.PP/ 0
importe_totalPP0 =
,PP= >
}QQ  !
)RR  !
;RR! "
returnSS 
ingresosEgresosSS "
;SS" #
}TT 	
publicUU 
IEnumerableUU 
<UU 
IngresoEgresoUU (
>UU( );
/ObtenerIngresosEgresosPorOperacionesYMediosPagoUU* Y
(UUY Z
intUUZ ]
idCajaUU^ d
,UUd e
DateTimeUUf n

fechaDesdeUUo y
,UUy z
DateTime	UU{ É

fechaHasta
UUÑ é
,
UUé è
int
UUê ì
[
UUì î
]
UUî ï
operaciones
UUñ °
,
UU° ¢
int
UU£ ¶
[
UU¶ ß
]
UUß ®

mediosPago
UU© ≥
)
UU≥ ¥
{VV 	
SigescomEntitiesWW 
_dbWW  
=WW! "
newWW# &
SigescomEntitiesWW' 7
(WW7 8
)WW8 9
;WW9 :
varXX 
ingresosEgresosXX 
=XX  !
_dbXX" %
.XX% &
TransaccionXX& 1
.XX1 2
WhereXX2 7
(XX7 8
tXX8 9
=>XX: <
tXX= >
.XX> ?
fecha_inicioXX? K
>=XXL N

fechaDesdeXXO Y
&&XXZ \
tXX] ^
.XX^ _
fecha_inicioXX_ k
<=XXl n

fechaHastaXXo y
&&XXz |
tXX} ~
.XX~ %
id_actor_negocio_interno	XX ó
==
XXò ö
idCaja
XXõ °
&&
XX¢ §
operaciones
XX• ∞
.
XX∞ ±
Contains
XX± π
(
XXπ ∫
t
XX∫ ª
.
XXª º!
id_tipo_transaccion
XXº œ
)
XXœ –
&&
XX— ”

mediosPago
XX‘ ﬁ
.
XXﬁ ﬂ
Contains
XXﬂ Á
(
XXÁ Ë
t
XXË È
.
XXÈ Í

Traza_pago
XXÍ Ù
.
XXÙ ı
First
XXı ˙
(
XX˙ ˚
)
XX˚ ¸
.
XX¸ ˝
id_medio_pago
XX˝ ä
)
XXä ã
)
XXã å
.YY  !
SelectYY! '
(YY' (
tYY( )
=>YY* ,
newYY- 0
IngresoEgresoYY1 >
(YY> ?
)YY? @
{ZZ  !
Fecha[[$ )
=[[* +
t[[, -
.[[- .
fecha_inicio[[. :
,[[: ;
IdOperacion\\$ /
=\\0 1
t\\2 3
.\\3 4
id_tipo_transaccion\\4 G
,\\G H
	Operacion]]$ -
=]]. /
t]]0 1
.]]1 2
Tipo_transaccion]]2 B
.]]B C
nombre_corto]]C O
,]]O P
IdMedioPago^^$ /
=^^0 1
t^^2 3
.^^3 4

Traza_pago^^4 >
.^^> ?
FirstOrDefault^^? M
(^^M N
)^^N O
.^^O P
id_medio_pago^^P ]
,^^] ^
	MedioPago__$ -
=__. /
t__0 1
.__1 2

Traza_pago__2 <
.__< =
FirstOrDefault__= K
(__K L
)__L M
.__M N
Detalle_maestro1__N ^
.__^ _
nombre___ e
,__e f
Informacion``$ /
=``0 1
t``2 3
.``3 4

Traza_pago``4 >
.``> ?
FirstOrDefault``? M
(``M N
)``N O
.``O P
traza``P U
,``U V
TipoComprobanteaa$ 3
=aa4 5
taa6 7
.aa7 8
Comprobanteaa8 C
.aaC D
Detalle_maestroaaD S
.aaS T
valoraaT Y
,aaY Z#
SerieYNumeroComprobantebb$ ;
=bb< =
tbb> ?
.bb? @
Comprobantebb@ K
.bbK L
numero_seriebbL X
+bbY Z
$strbb[ ^
+bb_ `
tbba b
.bbb c
Comprobantebbc n
.bbn o
numerobbo u
,bbu v
Importecc$ +
=cc, -
tcc. /
.cc/ 0
importe_totalcc0 =
,cc= >
}dd  !
)ee  !
;ee! "
returnff 
ingresosEgresosff "
;ff" #
}gg 	
publichh 
IEnumerablehh 
<hh 
IngresoEgresohh (
>hh( )2
&ObtenerIngresosEgresosEnCuentaBancariahh* P
(hhP Q
inthhQ T
idCuentahhU ]
,hh] ^
DateTimehh_ g

fechaDesdehhh r
,hhr s
DateTimehht |

fechaHasta	hh} á
,
hhá à
bool
hhâ ç
	esIngreso
hhé ó
)
hhó ò
{ii 	
SigescomEntitiesjj 
_dbjj  
=jj! "
newjj# &
SigescomEntitiesjj' 7
(jj7 8
)jj8 9
;jj9 :
varkk 
ingresosEgresoskk 
=kk  !
_dbkk" %
.kk% &2
&Accion_de_negocio_por_tipo_transaccionkk& L
.ll  !
Wherell! &
(ll& '
anttll' +
=>ll, .
anttll/ 3
.ll3 4 
id_accion_de_negocioll4 H
==llI K
TransaccionSettingsllL _
.ll_ `
Defaultll` g
.llg h.
!IdAccionDeNegocioMovimientoEnCaja	llh â
&&
llä å
antt
llç ë
.
llë í
valor
llí ó
==
llò ö
	esIngreso
llõ §
)
ll§ •
.mm  !

SelectManymm! +
(mm+ ,
anttmm, 0
=>mm1 3
anttmm4 8
.mm8 9
Tipo_transaccionmm9 I
.mmI J
TransaccionmmJ U
)mmU V
.nn  !
Wherenn! &
(nn& '
tnn' (
=>nn) +
tnn, -
.nn- .
fecha_inicionn. :
>=nn; =

fechaDesdenn> H
&&nnI K
tnnL M
.nnM N
fecha_inicionnN Z
<=nn[ ]

fechaHastann^ h
&&nni k
tnnl m
.nnm n&
id_actor_negocio_interno1	nnn á
==
nnà ä
idCuenta
nnã ì
&&
nnî ñ
t
nnó ò
.
nnò ô
id_estado_actual
nnô ©
==
nn™ ¨
MaestroSettings
nn≠ º
.
nnº Ω
Default
nnΩ ƒ
.
nnƒ ≈.
 IdDetalleMaestroEstadoConfirmado
nn≈ Â
)
nnÂ Ê
.oo  !
Selectoo! '
(oo' (
too( )
=>oo* ,
newoo- 0
IngresoEgresooo1 >
(oo> ?
)oo? @
{pp  !
Fechaqq$ )
=qq* +
tqq, -
.qq- .
fecha_inicioqq. :
,qq: ;
IdOperacionrr$ /
=rr0 1
trr2 3
.rr3 4
id_tipo_transaccionrr4 G
,rrG H
	Operacionss$ -
=ss. /
tss0 1
.ss1 2
Tipo_transaccionss2 B
.ssB C
nombre_cortossC O
,ssO P
IdMedioPagott$ /
=tt0 1
ttt2 3
.tt3 4

Traza_pagott4 >
.tt> ?
FirstOrDefaulttt? M
(ttM N
)ttN O
.ttO P
id_medio_pagottP ]
,tt] ^
	MedioPagouu$ -
=uu. /
tuu0 1
.uu1 2

Traza_pagouu2 <
.uu< =
FirstOrDefaultuu= K
(uuK L
)uuL M
.uuM N
Detalle_maestro1uuN ^
.uu^ _
nombreuu_ e
,uue f
Informacionvv$ /
=vv0 1
tvv2 3
.vv3 4

Traza_pagovv4 >
.vv> ?
FirstOrDefaultvv? M
(vvM N
)vvN O
.vvO P
trazavvP U
,vvU V
TipoComprobanteww$ 3
=ww4 5
tww6 7
.ww7 8
Comprobanteww8 C
.wwC D
Detalle_maestrowwD S
.wwS T
valorwwT Y
,wwY Z#
SerieYNumeroComprobantexx$ ;
=xx< =
txx> ?
.xx? @
Comprobantexx@ K
.xxK L
numero_seriexxL X
+xxY Z
$strxx[ ^
+xx_ `
txxa b
.xxb c
Comprobantexxc n
.xxn o
numeroxxo u
,xxu v
Importeyy$ +
=yy, -
tyy. /
.yy/ 0
importe_totalyy0 =
}zz  !
){{  !
;{{! "
return|| 
ingresosEgresos|| "
;||" #
}}} 	
public~~ 
IEnumerable~~ 
<~~ 
IngresoEgreso~~ (
>~~( )@
4ObtenerIngresosEgresosEnCuentaBancariaPorOperaciones~~* ^
(~~^ _
int~~_ b
idCuenta~~c k
,~~k l
DateTime~~m u

fechaDesde	~~v Ä
,
~~Ä Å
DateTime
~~Ç ä

fechaHasta
~~ã ï
,
~~ï ñ
int
~~ó ö
[
~~ö õ
]
~~õ ú
operaciones
~~ù ®
)
~~® ©
{ 	
SigescomEntities
ÄÄ 
_db
ÄÄ  
=
ÄÄ! "
new
ÄÄ# &
SigescomEntities
ÄÄ' 7
(
ÄÄ7 8
)
ÄÄ8 9
;
ÄÄ9 :
var
ÅÅ 
ingresosEgresos
ÅÅ 
=
ÅÅ  !
_db
ÅÅ" %
.
ÅÅ% &
Transaccion
ÅÅ& 1
.
ÅÅ1 2
Where
ÅÅ2 7
(
ÅÅ7 8
t
ÅÅ8 9
=>
ÅÅ: <
t
ÅÅ= >
.
ÅÅ> ?
fecha_inicio
ÅÅ? K
>=
ÅÅL N

fechaDesde
ÅÅO Y
&&
ÅÅZ \
t
ÅÅ] ^
.
ÅÅ^ _
fecha_inicio
ÅÅ_ k
<=
ÅÅl n

fechaHasta
ÅÅo y
&&
ÅÅz |
t
ÅÅ} ~
.
ÅÅ~ (
id_actor_negocio_interno1ÅÅ ò
==ÅÅô õ
idCuentaÅÅú §
&&ÅÅ• ß
operacionesÅÅ® ≥
.ÅÅ≥ ¥
ContainsÅÅ¥ º
(ÅÅº Ω
tÅÅΩ æ
.ÅÅæ ø#
id_tipo_transaccionÅÅø “
)ÅÅ“ ”
)ÅÅ” ‘
.
ÇÇ  !
Select
ÇÇ! '
(
ÇÇ' (
t
ÇÇ( )
=>
ÇÇ* ,
new
ÇÇ- 0
IngresoEgreso
ÇÇ1 >
(
ÇÇ> ?
)
ÇÇ? @
{
ÉÉ  !
Fecha
ÑÑ$ )
=
ÑÑ* +
t
ÑÑ, -
.
ÑÑ- .
fecha_inicio
ÑÑ. :
,
ÑÑ: ;
IdOperacion
ÖÖ$ /
=
ÖÖ0 1
t
ÖÖ2 3
.
ÖÖ3 4!
id_tipo_transaccion
ÖÖ4 G
,
ÖÖG H
	Operacion
ÜÜ$ -
=
ÜÜ. /
t
ÜÜ0 1
.
ÜÜ1 2
Tipo_transaccion
ÜÜ2 B
.
ÜÜB C
nombre_corto
ÜÜC O
,
ÜÜO P
IdMedioPago
áá$ /
=
áá0 1
t
áá2 3
.
áá3 4

Traza_pago
áá4 >
.
áá> ?
FirstOrDefault
áá? M
(
ááM N
)
ááN O
.
ááO P
id_medio_pago
ááP ]
,
áá] ^
	MedioPago
àà$ -
=
àà. /
t
àà0 1
.
àà1 2

Traza_pago
àà2 <
.
àà< =
FirstOrDefault
àà= K
(
ààK L
)
ààL M
.
ààM N
Detalle_maestro1
ààN ^
.
àà^ _
nombre
àà_ e
,
ààe f
Informacion
ââ$ /
=
ââ0 1
t
ââ2 3
.
ââ3 4

Traza_pago
ââ4 >
.
ââ> ?
FirstOrDefault
ââ? M
(
ââM N
)
ââN O
.
ââO P
traza
ââP U
,
ââU V
TipoComprobante
ää$ 3
=
ää4 5
t
ää6 7
.
ää7 8
Comprobante
ää8 C
.
ääC D
Detalle_maestro
ääD S
.
ääS T
valor
ääT Y
,
ääY Z%
SerieYNumeroComprobante
ãã$ ;
=
ãã< =
t
ãã> ?
.
ãã? @
Comprobante
ãã@ K
.
ããK L
numero_serie
ããL X
+
ããY Z
$str
ãã[ ^
+
ãã_ `
t
ããa b
.
ããb c
Comprobante
ããc n
.
ããn o
numero
ãão u
,
ããu v
Importe
åå$ +
=
åå, -
t
åå. /
.
åå/ 0
importe_total
åå0 =
}
çç  !
)
éé  !
;
éé! "
return
èè 
ingresosEgresos
èè "
;
èè" #
}
êê 	
public
ëë 
IEnumerable
ëë 
<
ëë 
IngresoEgreso
ëë (
>
ëë( )A
3ObtenerIngresosEgresosEnCuentaBancariaPorMediosPago
ëë* ]
(
ëë] ^
int
ëë^ a
idCuenta
ëëb j
,
ëëj k
DateTime
ëël t

fechaDesde
ëëu 
,ëë Ä
DateTimeëëÅ â

fechaHastaëëä î
,ëëî ï
boolëëñ ö
	esIngresoëëõ §
,ëë§ •
intëë¶ ©
[ëë© ™
]ëë™ ´

mediosPagoëë¨ ∂
)ëë∂ ∑
{
íí 	
SigescomEntities
ìì 
_db
ìì  
=
ìì! "
new
ìì# &
SigescomEntities
ìì' 7
(
ìì7 8
)
ìì8 9
;
ìì9 :
var
îî 
ingresosEgresos
îî 
=
îî  !
_db
îî" %
.
îî% &4
&Accion_de_negocio_por_tipo_transaccion
îî& L
.
ïï  !
Where
ïï! &
(
ïï& '
antt
ïï' +
=>
ïï, .
antt
ïï/ 3
.
ïï3 4"
id_accion_de_negocio
ïï4 H
==
ïïI K!
TransaccionSettings
ïïL _
.
ïï_ `
Default
ïï` g
.
ïïg h3
$IdAccionDeNegocioMovimientoEnAlmacenïïh å
&&ïïç è
anttïïê î
.ïïî ï
valorïïï ö
==ïïõ ù
	esIngresoïïû ß
)ïïß ®
.
ññ  !

SelectMany
ññ! +
(
ññ+ ,
antt
ññ, 0
=>
ññ1 3
antt
ññ4 8
.
ññ8 9
Tipo_transaccion
ññ9 I
.
ññI J
Transaccion
ññJ U
)
ññU V
.
óó  !
Where
óó! &
(
óó& '
t
óó' (
=>
óó) +
t
óó, -
.
óó- .
fecha_inicio
óó. :
>=
óó; =

fechaDesde
óó> H
&&
óóI K
t
óóL M
.
óóM N
fecha_inicio
óóN Z
<=
óó[ ]

fechaHasta
óó^ h
&&
óói k
t
óól m
.
óóm n(
id_actor_negocio_interno1óón á
==óóà ä
idCuentaóóã ì
&&óóî ñ

mediosPagoóóó °
.óó° ¢
Containsóó¢ ™
(óó™ ´
tóó´ ¨
.óó¨ ≠

Traza_pagoóó≠ ∑
.óó∑ ∏
Firstóó∏ Ω
(óóΩ æ
)óóæ ø
.óóø ¿
id_medio_pagoóó¿ Õ
)óóÕ Œ
&&óóœ —
tóó“ ”
.óó” ‘ 
id_estado_actualóó‘ ‰
==óóÂ Á
MaestroSettingsóóË ˜
.óó˜ ¯
Defaultóó¯ ˇ
.óóˇ Ä0
 IdDetalleMaestroEstadoConfirmadoóóÄ †
)óó† °
.
òò  !
Select
òò! '
(
òò' (
t
òò( )
=>
òò* ,
new
òò- 0
IngresoEgreso
òò1 >
(
òò> ?
)
òò? @
{
ôô  !
Fecha
öö$ )
=
öö* +
t
öö, -
.
öö- .
fecha_inicio
öö. :
,
öö: ;
IdOperacion
õõ$ /
=
õõ0 1
t
õõ2 3
.
õõ3 4!
id_tipo_transaccion
õõ4 G
,
õõG H
	Operacion
úú$ -
=
úú. /
t
úú0 1
.
úú1 2
Tipo_transaccion
úú2 B
.
úúB C
nombre_corto
úúC O
,
úúO P
IdMedioPago
ùù$ /
=
ùù0 1
t
ùù2 3
.
ùù3 4

Traza_pago
ùù4 >
.
ùù> ?
FirstOrDefault
ùù? M
(
ùùM N
)
ùùN O
.
ùùO P
id_medio_pago
ùùP ]
,
ùù] ^
	MedioPago
ûû$ -
=
ûû. /
t
ûû0 1
.
ûû1 2

Traza_pago
ûû2 <
.
ûû< =
FirstOrDefault
ûû= K
(
ûûK L
)
ûûL M
.
ûûM N
Detalle_maestro1
ûûN ^
.
ûû^ _
nombre
ûû_ e
,
ûûe f
Informacion
üü$ /
=
üü0 1
t
üü2 3
.
üü3 4

Traza_pago
üü4 >
.
üü> ?
FirstOrDefault
üü? M
(
üüM N
)
üüN O
.
üüO P
traza
üüP U
,
üüU V
TipoComprobante
††$ 3
=
††4 5
t
††6 7
.
††7 8
Comprobante
††8 C
.
††C D
Detalle_maestro
††D S
.
††S T
valor
††T Y
,
††Y Z%
SerieYNumeroComprobante
°°$ ;
=
°°< =
t
°°> ?
.
°°? @
Comprobante
°°@ K
.
°°K L
numero_serie
°°L X
+
°°Y Z
$str
°°[ ^
+
°°_ `
t
°°a b
.
°°b c
Comprobante
°°c n
.
°°n o
numero
°°o u
,
°°u v
Importe
¢¢$ +
=
¢¢, -
t
¢¢. /
.
¢¢/ 0
importe_total
¢¢0 =
,
¢¢= >
}
££  !
)
§§  !
;
§§! "
return
•• 
ingresosEgresos
•• "
;
••" #
}
¶¶ 	
public
ßß 
IEnumerable
ßß 
<
ßß 
IngresoEgreso
ßß (
>
ßß( )M
?ObtenerIngresosEgresosEnCuentaBancariaPorOperacionesYMediosPago
ßß* i
(
ßßi j
int
ßßj m
idCuenta
ßßn v
,
ßßv w
DateTimeßßx Ä

fechaDesdeßßÅ ã
,ßßã å
DateTimeßßç ï

fechaHastaßßñ †
,ßß† °
intßß¢ •
[ßß• ¶
]ßß¶ ß
operacionesßß® ≥
,ßß≥ ¥
intßßµ ∏
[ßß∏ π
]ßßπ ∫

mediosPagoßßª ≈
)ßß≈ ∆
{
®® 	
SigescomEntities
©© 
_db
©©  
=
©©! "
new
©©# &
SigescomEntities
©©' 7
(
©©7 8
)
©©8 9
;
©©9 :
var
™™ 
ingresosEgresos
™™ 
=
™™  !
_db
™™" %
.
™™% &
Transaccion
™™& 1
.
™™1 2
Where
™™2 7
(
™™7 8
t
™™8 9
=>
™™: <
t
™™= >
.
™™> ?
fecha_inicio
™™? K
>=
™™L N

fechaDesde
™™O Y
&&
™™Z \
t
™™] ^
.
™™^ _
fecha_inicio
™™_ k
<=
™™l n

fechaHasta
™™o y
&&
™™z |
t
™™} ~
.
™™~ (
id_actor_negocio_interno1™™ ò
==™™ô õ
idCuenta™™ú §
&&™™• ß
operaciones™™® ≥
.™™≥ ¥
Contains™™¥ º
(™™º Ω
t™™Ω æ
.™™æ ø#
id_tipo_transaccion™™ø “
)™™“ ”
&&™™‘ ÷

mediosPago™™◊ ·
.™™· ‚
Contains™™‚ Í
(™™Í Î
t™™Î Ï
.™™Ï Ì

Traza_pago™™Ì ˜
.™™˜ ¯
First™™¯ ˝
(™™˝ ˛
)™™˛ ˇ
.™™ˇ Ä
id_medio_pago™™Ä ç
)™™ç é
)™™é è
.
´´  !
Select
´´! '
(
´´' (
t
´´( )
=>
´´* ,
new
´´- 0
IngresoEgreso
´´1 >
(
´´> ?
)
´´? @
{
¨¨  !
Fecha
≠≠$ )
=
≠≠* +
t
≠≠, -
.
≠≠- .
fecha_inicio
≠≠. :
,
≠≠: ;
IdOperacion
ÆÆ$ /
=
ÆÆ0 1
t
ÆÆ2 3
.
ÆÆ3 4!
id_tipo_transaccion
ÆÆ4 G
,
ÆÆG H
	Operacion
ØØ$ -
=
ØØ. /
t
ØØ0 1
.
ØØ1 2
Tipo_transaccion
ØØ2 B
.
ØØB C
nombre_corto
ØØC O
,
ØØO P
IdMedioPago
∞∞$ /
=
∞∞0 1
t
∞∞2 3
.
∞∞3 4

Traza_pago
∞∞4 >
.
∞∞> ?
FirstOrDefault
∞∞? M
(
∞∞M N
)
∞∞N O
.
∞∞O P
id_medio_pago
∞∞P ]
,
∞∞] ^
	MedioPago
±±$ -
=
±±. /
t
±±0 1
.
±±1 2

Traza_pago
±±2 <
.
±±< =
FirstOrDefault
±±= K
(
±±K L
)
±±L M
.
±±M N
Detalle_maestro1
±±N ^
.
±±^ _
nombre
±±_ e
,
±±e f
Informacion
≤≤$ /
=
≤≤0 1
t
≤≤2 3
.
≤≤3 4

Traza_pago
≤≤4 >
.
≤≤> ?
FirstOrDefault
≤≤? M
(
≤≤M N
)
≤≤N O
.
≤≤O P
traza
≤≤P U
,
≤≤U V
TipoComprobante
≥≥$ 3
=
≥≥4 5
t
≥≥6 7
.
≥≥7 8
Comprobante
≥≥8 C
.
≥≥C D
Detalle_maestro
≥≥D S
.
≥≥S T
valor
≥≥T Y
,
≥≥Y Z%
SerieYNumeroComprobante
¥¥$ ;
=
¥¥< =
t
¥¥> ?
.
¥¥? @
Comprobante
¥¥@ K
.
¥¥K L
numero_serie
¥¥L X
+
¥¥Y Z
$str
¥¥[ ^
+
¥¥_ `
t
¥¥a b
.
¥¥b c
Comprobante
¥¥c n
.
¥¥n o
numero
¥¥o u
,
¥¥u v
Importe
µµ$ +
=
µµ, -
t
µµ. /
.
µµ/ 0
importe_total
µµ0 =
,
µµ= >
}
∂∂  !
)
∑∑  !
;
∑∑! "
return
∏∏ 
ingresosEgresos
∏∏ "
;
∏∏" #
}
ππ 	
public
ªª 
IEnumerable
ªª 
<
ªª 
DetalleFlujo
ªª '
>
ªª' ($
ObtenerIngresosEgresos
ªª) ?
(
ªª? @
int
ªª@ C
idCaja
ªªD J
,
ªªJ K
DateTime
ªªL T

fechaDesde
ªªU _
,
ªª_ `
DateTime
ªªa i

fechaHasta
ªªj t
)
ªªt u
{
ºº 	
try
ΩΩ 
{
ææ 
SigescomEntities
øø  
_db
øø! $
=
øø% &
new
øø' *
SigescomEntities
øø+ ;
(
øø; <
)
øø< =
;
øø= >
var
¿¿ 
Resumen
¿¿ 
=
¿¿ 
_db
¿¿ !
.
¿¿! "4
&Accion_de_negocio_por_tipo_transaccion
¿¿" H
.
¡¡  !
Where
¡¡! &
(
¡¡& '
antt
¡¡' +
=>
¡¡, .
antt
¡¡/ 3
.
¡¡3 4"
id_accion_de_negocio
¡¡4 H
==
¡¡I K!
TransaccionSettings
¡¡L _
.
¡¡_ `
Default
¡¡` g
.
¡¡g h0
!IdAccionDeNegocioMovimientoEnCaja¡¡h â
)¡¡â ä
.
¬¬  !

SelectMany
¬¬! +
(
¬¬+ ,
antt
¬¬, 0
=>
¬¬1 3
antt
¬¬4 8
.
¬¬8 9
Tipo_transaccion
¬¬9 I
.
¬¬I J
Transaccion
¬¬J U
)
¬¬U V
.
¬¬V W
Where
¬¬W \
(
¬¬\ ]
t
¬¬] ^
=>
¬¬_ a
t
¬¬b c
.
¬¬c d
fecha_inicio
¬¬d p
>=
¬¬q s

fechaDesde
¬¬t ~
&&¬¬ Å
t¬¬Ç É
.¬¬É Ñ
fecha_inicio¬¬Ñ ê
<=¬¬ë ì

fechaHasta¬¬î û
&&¬¬ü °
t¬¬¢ £
.¬¬£ §(
id_actor_negocio_interno¬¬§ º
==¬¬Ω ø
idCaja¬¬¿ ∆
&&¬¬« …
t¬¬  À
.¬¬À Ã 
id_estado_actual¬¬Ã ‹
==¬¬› ﬂ
MaestroSettings¬¬‡ Ô
.¬¬Ô 
Default¬¬ ˜
.¬¬˜ ¯0
 IdDetalleMaestroEstadoConfirmado¬¬¯ ò
)¬¬ò ô
.
√√ 
Select
√√ 
(
√√ 
t
√√ 
=>
√√ 
new
√√  #
DetalleFlujo
√√$ 0
(
√√0 1
)
√√1 2
{
ƒƒ 
Fecha
≈≈ 
=
≈≈ 
t
≈≈  
.
≈≈  !
fecha_inicio
≈≈! -
,
≈≈- .
IdOperacion
∆∆ "
=
∆∆# $
t
∆∆% &
.
∆∆& '!
id_tipo_transaccion
∆∆' :
,
∆∆: ;
	Operacion
««  
=
««! "
t
««# $
.
««$ %
Tipo_transaccion
««% 5
.
««5 6
nombre
««6 <
,
««< =
TipoComprobante
»» &
=
»»' (
t
»») *
.
»»* +
Comprobante
»»+ 6
.
»»6 7
Detalle_maestro
»»7 F
.
»»F G
valor
»»G L
,
»»L M%
SerieYNumeroComprobante
…… .
=
……/ 0
t
……1 2
.
……2 3
Comprobante
……3 >
.
……> ?
numero_serie
……? K
+
……L M
$str
……N Q
+
……R S
t
……T U
.
……U V
Comprobante
……V a
.
……a b
numero
……b h
,
……h i
Importe
   
=
    
t
  ! "
.
  " #
importe_total
  # 0
,
  0 1
	EsIngreso
ÀÀ  
=
ÀÀ! "
t
ÀÀ# $
.
ÀÀ$ %
Tipo_transaccion
ÀÀ% 5
.
ÀÀ5 64
&Accion_de_negocio_por_tipo_transaccion
ÀÀ6 \
.
ÀÀ\ ]
FirstOrDefault
ÀÀ] k
(
ÀÀk l
anpt
ÀÀl p
=>
ÀÀq s
anpt
ÀÀt x
.
ÀÀx y#
id_accion_de_negocioÀÀy ç
==ÀÀé ê#
TransaccionSettingsÀÀë §
.ÀÀ§ •
DefaultÀÀ• ¨
.ÀÀ¨ ≠1
!IdAccionDeNegocioMovimientoEnCajaÀÀ≠ Œ
)ÀÀŒ œ
.ÀÀœ –
valorÀÀ– ’
}
ÃÃ 
)
ÃÃ 
;
ÃÃ 
return
ÕÕ 
Resumen
ÕÕ 
;
ÕÕ 
}
ŒŒ 
catch
œœ 
(
œœ 
	Exception
œœ 
e
œœ 
)
œœ 
{
–– 
throw
—— 
new
—— 
DatosException
—— (
(
——( )
$str
——) O
,
——O P
e
——Q R
)
——R S
;
——S T
}
““ 
}
”” 	
public
’’ 
IEnumerable
’’ 
<
’’ 
DetalleFlujo
’’ '
>
’’' (4
&ObtenerIngresosEgresosEnCuentaBancaria
’’) O
(
’’O P
int
’’P S
idCuenta
’’T \
,
’’\ ]
DateTime
’’^ f

fechaDesde
’’g q
,
’’q r
DateTime
’’s {

fechaHasta’’| Ü
)’’Ü á
{
÷÷ 	
try
◊◊ 
{
ÿÿ 
SigescomEntities
ŸŸ  
_db
ŸŸ! $
=
ŸŸ% &
new
ŸŸ' *
SigescomEntities
ŸŸ+ ;
(
ŸŸ; <
)
ŸŸ< =
;
ŸŸ= >
var
⁄⁄ 
Resumen
⁄⁄ 
=
⁄⁄ 
_db
⁄⁄ !
.
⁄⁄! "4
&Accion_de_negocio_por_tipo_transaccion
⁄⁄" H
.
€€  !
Where
€€! &
(
€€& '
antt
€€' +
=>
€€, .
antt
€€/ 3
.
€€3 4"
id_accion_de_negocio
€€4 H
==
€€I K!
TransaccionSettings
€€L _
.
€€_ `
Default
€€` g
.
€€g h0
!IdAccionDeNegocioMovimientoEnCaja€€h â
)€€â ä
.
‹‹  !

SelectMany
‹‹! +
(
‹‹+ ,
antt
‹‹, 0
=>
‹‹1 3
antt
‹‹4 8
.
‹‹8 9
Tipo_transaccion
‹‹9 I
.
‹‹I J
Transaccion
‹‹J U
)
‹‹U V
.
‹‹V W
Where
‹‹W \
(
‹‹\ ]
t
‹‹] ^
=>
‹‹_ a
t
‹‹b c
.
‹‹c d
fecha_inicio
‹‹d p
>=
‹‹q s

fechaDesde
‹‹t ~
&&‹‹ Å
t‹‹Ç É
.‹‹É Ñ
fecha_inicio‹‹Ñ ê
<=‹‹ë ì

fechaHasta‹‹î û
&&‹‹ü °
t‹‹¢ £
.‹‹£ §)
id_actor_negocio_interno1‹‹§ Ω
==‹‹æ ¿
idCuenta‹‹¡ …
&&‹‹  Ã
t‹‹Õ Œ
.‹‹Œ œ 
id_estado_actual‹‹œ ﬂ
==‹‹‡ ‚
MaestroSettings‹‹„ Ú
.‹‹Ú Û
Default‹‹Û ˙
.‹‹˙ ˚0
 IdDetalleMaestroEstadoConfirmado‹‹˚ õ
)‹‹õ ú
.
›› 
Select
›› 
(
›› 
t
›› 
=>
›› 
new
››  #
DetalleFlujo
››$ 0
(
››0 1
)
››1 2
{
ﬁﬁ 
Fecha
ﬂﬂ 
=
ﬂﬂ 
t
ﬂﬂ  
.
ﬂﬂ  !
fecha_inicio
ﬂﬂ! -
,
ﬂﬂ- .
IdOperacion
‡‡ "
=
‡‡# $
t
‡‡% &
.
‡‡& '!
id_tipo_transaccion
‡‡' :
,
‡‡: ;
	Operacion
··  
=
··! "
t
··# $
.
··$ %
Tipo_transaccion
··% 5
.
··5 6
nombre
··6 <
,
··< =
TipoComprobante
‚‚ &
=
‚‚' (
t
‚‚) *
.
‚‚* +
Comprobante
‚‚+ 6
.
‚‚6 7
Detalle_maestro
‚‚7 F
.
‚‚F G
valor
‚‚G L
,
‚‚L M%
SerieYNumeroComprobante
„„ .
=
„„/ 0
t
„„1 2
.
„„2 3
Comprobante
„„3 >
.
„„> ?
numero_serie
„„? K
+
„„L M
$str
„„N Q
+
„„R S
t
„„T U
.
„„U V
Comprobante
„„V a
.
„„a b
numero
„„b h
,
„„h i
Importe
‰‰ 
=
‰‰  
t
‰‰! "
.
‰‰" #
importe_total
‰‰# 0
,
‰‰0 1
	EsIngreso
ÂÂ  
=
ÂÂ! "
t
ÂÂ# $
.
ÂÂ$ %
Tipo_transaccion
ÂÂ% 5
.
ÂÂ5 64
&Accion_de_negocio_por_tipo_transaccion
ÂÂ6 \
.
ÂÂ\ ]
FirstOrDefault
ÂÂ] k
(
ÂÂk l
anpt
ÂÂl p
=>
ÂÂq s
anpt
ÂÂt x
.
ÂÂx y#
id_accion_de_negocioÂÂy ç
==ÂÂé ê#
TransaccionSettingsÂÂë §
.ÂÂ§ •
DefaultÂÂ• ¨
.ÂÂ¨ ≠1
!IdAccionDeNegocioMovimientoEnCajaÂÂ≠ Œ
)ÂÂŒ œ
.ÂÂœ –
valorÂÂ– ’
}
ÊÊ 
)
ÊÊ 
;
ÊÊ 
return
ÁÁ 
Resumen
ÁÁ 
;
ÁÁ 
}
ËË 
catch
ÈÈ 
(
ÈÈ 
	Exception
ÈÈ 
e
ÈÈ 
)
ÈÈ 
{
ÍÍ 
throw
ÎÎ 
new
ÎÎ 
DatosException
ÎÎ (
(
ÎÎ( )
$str
ÎÎ) O
,
ÎÎO P
e
ÎÎQ R
)
ÎÎR S
;
ÎÎS T
}
ÏÏ 
}
ÌÌ 	
}
¯¯ 
}˘˘ Ω∏
mD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\LibrosElectronicos\LibrosElectronicosConcarDatos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
{ 
public 

partial 
class )
LibrosElectronicosConcarDatos 6
:7 80
$ILibrosElectronicosConcarRepositorio9 ]
{ 
public 
IEnumerable 
< 
OperacionVenta )
>) *#
ObtenerOperacionesVenta+ B
(B C
intC F
[F G
]G H 
idsTiposComprobantesI ]
,] ^
int_ b
[b c
]c d
idsTiposTransaccione x
,x y
DateTime	z Ç

fechaDesde
É ç
,
ç é
DateTime
è ó

fechaHasta
ò ¢
)
¢ £
{ 	
try 
{ 
SigescomEntities  
_db! $
=% &
new' *
SigescomEntities+ ;
(; <
)< =
;= >
return 
_db 
. 
Transaccion &
. 
Where !
(! "
t" #
=>$ &
t' (
.( )
fecha_inicio) 5
>=6 8

fechaDesde9 C
&&D F
tG H
.H I
fecha_inicioI U
<=V X

fechaHastaY c
&& 
idsTiposTransaccion 2
.2 3
Contains3 ;
(; <
t< =
.= >
id_tipo_transaccion> Q
)Q R
&&  
idsTiposComprobantes 3
.3 4
Contains4 <
(< =
t= >
.> ?
Comprobante? J
.J K
id_tipo_comprobanteK ^
)^ _
)_ `
. 
Select #
(# $
t$ %
=>& (
new) ,
OperacionVenta- ;
(; <
)< =
{   
Id!!  "
=!!# $
t!!% &
.!!& '
id!!' )
,!!) *
FechaEmision""  ,
=""- .
t""/ 0
.""0 1
fecha_inicio""1 =
,""= >
FechaDocumento##  .
=##/ 0
t##1 2
.##2 3
fecha_inicio##3 ?
,##? @
FechaVencimiento$$  0
=$$1 2
t$$3 4
.$$4 5
	fecha_fin$$5 >
,$$> ?
IdMoneda%%  (
=%%) *
t%%+ ,
.%%, -
	id_moneda%%- 6
,%%6 7
IdTipoComprobante&&  1
=&&2 3
t&&4 5
.&&5 6
Comprobante&&6 A
.&&A B
id_tipo_comprobante&&B U
,&&U V
SerieComprobante''  0
=''1 2
t''3 4
.''4 5
Comprobante''5 @
.''@ A
numero_serie''A M
,''M N
NumeroComprobante((  1
=((2 3
t((4 5
.((5 6
Comprobante((6 A
.((A B
numero((B H
,((H I"
NumeroDocumentoCliente))  6
=))7 8
t))9 :
.)): ;
Actor_negocio1)); I
.))I J
Actor))J O
.))O P&
numero_documento_identidad))P j
,))j k
NombreCliente**  -
=**. /
t**0 1
.**1 2
Actor_negocio1**2 @
.**@ A
Actor**A F
.**F G
primer_nombre**G T
,**T U

TipoCambio++  *
=+++ ,
t++- .
.++. /
tipo_cambio++/ :
,++: ;
	TotalBien,,  )
=,,* +
t,,, -
.,,- .
Detalle_transaccion,,. A
.,,A B
Where,,B G
(,,G H
dt,,H J
=>,,K M
dt,,N P
.,,P Q
Concepto_negocio,,Q a
.,,a b
Detalle_maestro4,,b r
.,,r s
valor,,s x
==,,y {
$str,,| 
)	,, Ä
.
,,Ä Å
Sum
,,Å Ñ
(
,,Ñ Ö
dt
,,Ö á
=>
,,à ä
dt
,,ã ç
.
,,ç é
total
,,é ì
)
,,ì î
,
,,î ï
IgvBien--  '
=--( )
t--* +
.--+ ,
Detalle_transaccion--, ?
.--? @
Where--@ E
(--E F
dt--F H
=>--I K
dt--L N
.--N O
Concepto_negocio--O _
.--_ `
Detalle_maestro4--` p
.--p q
valor--q v
==--w y
$str--z }
)--} ~
.--~ 
Sum	-- Ç
(
--Ç É
dt
--É Ö
=>
--Ü à
dt
--â ã
.
--ã å
igv
--å è
)
--è ê
,
--ê ë
TotalServicio..  -
=... /
t..0 1
...1 2
Detalle_transaccion..2 E
...E F
Where..F K
(..K L
dt..L N
=>..O Q
dt..R T
...T U
Concepto_negocio..U e
...e f
Detalle_maestro4..f v
...v w
valor..w |
==..} 
$str
..Ä É
)
..É Ñ
.
..Ñ Ö
Sum
..Ö à
(
..à â
dt
..â ã
=>
..å é
dt
..è ë
.
..ë í
total
..í ó
)
..ó ò
,
..ò ô
IgvServicio//  +
=//, -
t//. /
./// 0
Detalle_transaccion//0 C
.//C D
Where//D I
(//I J
dt//J L
=>//M O
dt//P R
.//R S
Concepto_negocio//S c
.//c d
Detalle_maestro4//d t
.//t u
valor//u z
==//{ }
$str	//~ Å
)
//Å Ç
.
//Ç É
Sum
//É Ü
(
//Ü á
dt
//á â
=>
//ä å
dt
//ç è
.
//è ê
igv
//ê ì
)
//ì î
,
//î ï
Icbper00  &
=00' (
t00) *
.00* +
	importe1000+ 4
,004 5
IdTipoTransaccion11  1
=112 3
(114 5
int115 8
)118 9
t119 :
.11: ;
id_tipo_transaccion11; N
,11N O(
NombreTipoTransaccionWrapper22  <
=22= >
t22? @
.22@ A
Tipo_transaccion22A Q
.22Q R
Tipo_transaccion222R c
.22c d
nombre22d j
,22j k
IdEstado33  (
=33) *
(33+ ,
int33, /
)33/ 0
t330 1
.331 2
id_estado_actual332 B
,33B C'
IdTipoComprobanteReferencia55  ;
=55< =
t55> ?
.55? @
Transaccion355@ L
==55M O
null55P T
?55U V
$num55W X
:55Y Z
t55[ \
.55\ ]
Transaccion355] i
.55i j
Comprobante55j u
.55u v 
id_tipo_comprobante	55v â
,
55â ä&
SerieComprobanteReferencia66  :
=66; <
t66= >
.66> ?
Transaccion366? K
==66L N
null66O S
?66T U
null66V Z
:66[ \
t66] ^
.66^ _
Transaccion366_ k
.66k l
Comprobante66l w
.66w x
numero_serie	66x Ñ
,
66Ñ Ö'
NumeroComprobanteReferencia77  ;
=77< =
t77> ?
.77? @
Transaccion377@ L
==77M O
null77P T
?77U V
$num77W X
:77Y Z
t77[ \
.77\ ]
Transaccion377] i
.77i j
Comprobante77j u
.77u v
numero77v |
,77| }"
FechaEmisionReferencia88  6
=887 8
t889 :
.88: ;
Transaccion388; G
==88H J
null88K O
?88P Q
new88R U
DateTime88V ^
(88^ _
)88_ `
:88a b
t88c d
.88d e
Transaccion388e q
.88q r
fecha_inicio88r ~
,88~ &
FechaVencimientoReferencia99  :
=99; <
t99= >
.99> ?
Transaccion399? K
==99L N
null99O S
?99T U
new99V Y
DateTime99Z b
(99b c
)99c d
:99e f
t99g h
.99h i
Transaccion399i u
.99u v
	fecha_fin99v 
,	99 Ä"
ImporteTotalReferencia::  6
=::7 8
t::9 :
.::: ;
Transaccion3::; G
==::H J
null::K O
?::P Q
$num::R S
:::T U
t::V W
.::W X
Transaccion3::X d
.::d e
importe_total::e r
,::r s
IgvReferencia;;  -
=;;. /
t;;0 1
.;;1 2
Transaccion3;;2 >
==;;? A
null;;B F
?;;G H
$num;;I J
:;;K L
t;;M N
.;;N O
Transaccion3;;O [
.;;[ \
importe8;;\ d
,;;d e2
&NombreTipoTransaccionReferenciaWrapper<<  F
=<<G H
t<<I J
.<<J K
Transaccion3<<K W
.<<W X
Tipo_transaccion<<X h
.<<h i
Tipo_transaccion2<<i z
.<<z {
nombre	<<{ Å
,
<<Å Ç
}== 
)>> 
;>> 
}?? 
catch@@ 
(@@ 
	Exception@@ 
e@@ 
)@@ 
{AA 
throwBB 
newBB 
DatosExceptionBB (
(BB( )
$strBB) N
,BBN O
eBBP Q
)BBQ R
;BBR S
}CC 
}DD 	
publicFF 
IEnumerableFF 
<FF 
OperacionVentaFF )
>FF) *3
'ObtenerOperacionesIngresoDineroPorVentaFF+ R
(FFR S
intFFS V
[FFV W
]FFW X 
idsTiposComprobantesFFY m
,FFm n
intFFo r
[FFr s
]FFs t 
idsTiposTransaccion	FFu à
,
FFà â
DateTime
FFä í

fechaDesde
FFì ù
,
FFù û
DateTime
FFü ß

fechaHasta
FF® ≤
)
FF≤ ≥
{GG 	
tryHH 
{II 
SigescomEntitiesJJ  
_dbJJ! $
=JJ% &
newJJ' *
SigescomEntitiesJJ+ ;
(JJ; <
)JJ< =
;JJ= >
varKK 

PagoCuotasKK 
=KK  
_dbKK! $
.KK$ %
TransaccionKK% 0
.KK0 1
WhereKK1 6
(KK6 7
tKK7 8
=>KK9 ;
tKK< =
.KK= >
fecha_inicioKK> J
>=KKK M

fechaDesdeKKN X
&&KKY [
tKK\ ]
.KK] ^
fecha_inicioKK^ j
<=KKk m

fechaHastaKKn x
&&LL 
idsTiposTransaccionLL 2
.LL2 3
ContainsLL3 ;
(LL; <
tLL< =
.LL= >
id_tipo_transaccionLL> Q
)LLQ R
&&MM  
idsTiposComprobantesMM 3
.MM3 4
ContainsMM4 <
(MM< =
tMM= >
.MM> ?
ComprobanteMM? J
.MMJ K
id_tipo_comprobanteMMK ^
)MM^ _
)MM_ `
.MM` a

SelectManyMMa k
(MMk l
tMMl m
=>MMn p
tMMq r
.MMr s

Pago_cuotaMMs }
)MM} ~
.MM~ 
Select	MM Ö
(
MMÖ Ü
pc
MMÜ à
=>
MMâ ã
new
MMå è
{
MMê ë
IdCuota
MMí ô
=
MMö õ
pc
MMú û
.
MMû ü
id_cuota
MMü ß
,
MMß ®
	MontoPago
MM© ≤
=
MM≥ ¥
pc
MMµ ∑
.
MM∑ ∏
importe
MM∏ ø
,
MMø ¿
FechaEmision
MM¡ Õ
=
MMŒ œ
pc
MM– “
.
MM“ ”
Transaccion
MM” ﬁ
.
MMﬁ ﬂ
fecha_inicio
MMﬂ Î
}
MMÏ Ì
)
MMÌ Ó
.
MMÓ Ô
ToList
MMÔ ı
(
MMı ˆ
)
MMˆ ˜
;
MM˜ ¯
varNN 
IdCuotasNN 
=NN 

PagoCuotasNN )
.NN) *
SelectNN* 0
(NN0 1
cpNN1 3
=>NN4 6
cpNN7 9
.NN9 :
IdCuotaNN: A
)NNA B
.NNB C
ToListNNC I
(NNI J
)NNJ K
;NNK L
varOO &
TransaccionOrdenMontoPagosOO .
=OO/ 0
_dbOO1 4
.OO4 5
CuotaOO5 :
.OO: ;
WhereOO; @
(OO@ A
cOOA B
=>OOC E
IdCuotasOOF N
.OON O
ContainsOOO W
(OOW X
cOOX Y
.OOY Z
idOOZ \
)OO\ ]
)OO] ^
.OO^ _
SelectOO_ e
(OOe f
cOOf g
=>OOh j
newOOk n
{OOo p
IdCuotaOOq x
=OOy z
cOO{ |
.OO| }
idOO} 
,	OO Ä 
IdTransaccionOrden
OOÅ ì
=
OOî ï
c
OOñ ó
.
OOó ò
Transaccion
OOò £
.
OO£ §
id
OO§ ¶
,
OO¶ ß
}
OO® ©
)
OO© ™
.
OO™ ´
ToList
OO´ ±
(
OO± ≤
)
OO≤ ≥
;
OO≥ ¥
varPP 
IdTransaccionesPP #
=PP$ %&
TransaccionOrdenMontoPagosPP& @
.PP@ A
SelectPPA G
(PPG H
tompPPH L
=>PPM O
tompPPP T
.PPT U
IdTransaccionOrdenPPU g
)PPg h
.PPh i
ToListPPi o
(PPo p
)PPp q
;PPq r
varQQ 
	resultadoQQ 
=QQ 
_dbQQ  #
.QQ# $
TransaccionQQ$ /
.QQ/ 0
WhereQQ0 5
(QQ5 6
tQQ6 7
=>QQ8 :
IdTransaccionesQQ; J
.QQJ K
ContainsQQK S
(QQS T
tQQT U
.QQU V
idQQV X
)QQX Y
)QQY Z
.RR 
SelectRR #
(RR# $
tRR$ %
=>RR& (
newRR) ,
OperacionVentaRR- ;
(RR; <
)RR< =
{SS 
IdTT  "
=TT# $
tTT% &
.TT& '
idTT' )
,TT) *
FechaEmisionUU  ,
=UU- .
tUU/ 0
.UU0 1
fecha_inicioUU1 =
,UU= >
FechaDocumentoVV  .
=VV/ 0
tVV1 2
.VV2 3
fecha_inicioVV3 ?
,VV? @
FechaVencimientoWW  0
=WW1 2
tWW3 4
.WW4 5
	fecha_finWW5 >
,WW> ?
IdMonedaXX  (
=XX) *
tXX+ ,
.XX, -
	id_monedaXX- 6
,XX6 7
IdTipoComprobanteYY  1
=YY2 3
tYY4 5
.YY5 6
ComprobanteYY6 A
.YYA B
id_tipo_comprobanteYYB U
,YYU V
SerieComprobanteZZ  0
=ZZ1 2
tZZ3 4
.ZZ4 5
ComprobanteZZ5 @
.ZZ@ A
numero_serieZZA M
,ZZM N
NumeroComprobante[[  1
=[[2 3
t[[4 5
.[[5 6
Comprobante[[6 A
.[[A B
numero[[B H
,[[H I"
NumeroDocumentoCliente\\  6
=\\7 8
t\\9 :
.\\: ;
Actor_negocio1\\; I
.\\I J
Actor\\J O
.\\O P&
numero_documento_identidad\\P j
,\\j k
NombreCliente]]  -
=]]. /
t]]0 1
.]]1 2
Actor_negocio1]]2 @
.]]@ A
Actor]]A F
.]]F G
primer_nombre]]G T
,]]T U

TipoCambio^^  *
=^^+ ,
t^^- .
.^^. /
tipo_cambio^^/ :
,^^: ;
MontoTotalPago__  .
=__/ 0
$num__1 2
,__2 3
IdTipoTransaccion``  1
=``2 3
(``4 5
int``5 8
)``8 9
t``9 :
.``: ;
id_tipo_transaccion``; N
,``N O(
NombreTipoTransaccionWrapperaa  <
=aa= >
taa? @
.aa@ A
Tipo_transaccionaaA Q
.aaQ R
Tipo_transaccion2aaR c
.aac d
nombreaad j
,aaj k
IdEstadobb  (
=bb) *
(bb+ ,
intbb, /
)bb/ 0
tbb0 1
.bb1 2
id_estado_actualbb2 B
,bbB C'
IdTipoComprobanteReferenciadd  ;
=dd< =
tdd> ?
.dd? @
Transaccion3dd@ L
==ddM O
nullddP T
?ddU V
$numddW X
:ddY Z
tdd[ \
.dd\ ]
Transaccion3dd] i
.ddi j
Comprobanteddj u
.ddu v 
id_tipo_comprobante	ddv â
,
ddâ ä&
SerieComprobanteReferenciaee  :
=ee; <
tee= >
.ee> ?
Transaccion3ee? K
==eeL N
nulleeO S
?eeT U
nulleeV Z
:ee[ \
tee] ^
.ee^ _
Transaccion3ee_ k
.eek l
Comprobanteeel w
.eew x
numero_serie	eex Ñ
,
eeÑ Ö'
NumeroComprobanteReferenciaff  ;
=ff< =
tff> ?
.ff? @
Transaccion3ff@ L
==ffM O
nullffP T
?ffU V
$numffW X
:ffY Z
tff[ \
.ff\ ]
Transaccion3ff] i
.ffi j
Comprobanteffj u
.ffu v
numeroffv |
,ff| }"
FechaEmisionReferenciagg  6
=gg7 8
tgg9 :
.gg: ;
Transaccion3gg; G
==ggH J
nullggK O
?ggP Q
newggR U
DateTimeggV ^
(gg^ _
)gg_ `
:gga b
tggc d
.ggd e
Transaccion3gge q
.ggq r
fecha_inicioggr ~
,gg~ &
FechaVencimientoReferenciahh  :
=hh; <
thh= >
.hh> ?
Transaccion3hh? K
==hhL N
nullhhO S
?hhT U
newhhV Y
DateTimehhZ b
(hhb c
)hhc d
:hhe f
thhg h
.hhh i
Transaccion3hhi u
.hhu v
	fecha_finhhv 
,	hh Ä"
ImporteTotalReferenciaii  6
=ii7 8
tii9 :
.ii: ;
Transaccion3ii; G
==iiH J
nulliiK O
?iiP Q
$numiiR S
:iiT U
tiiV W
.iiW X
Transaccion3iiX d
.iid e
importe_totaliie r
,iir s
IgvReferenciajj  -
=jj. /
tjj0 1
.jj1 2
Transaccion3jj2 >
==jj? A
nulljjB F
?jjG H
$numjjI J
:jjK L
tjjM N
.jjN O
Transaccion3jjO [
.jj[ \
importe8jj\ d
,jjd e2
&NombreTipoTransaccionReferenciaWrapperkk  F
=kkG H
tkkI J
.kkJ K
Transaccion3kkK W
.kkW X
Tipo_transaccionkkX h
.kkh i
Tipo_transaccion2kki z
.kkz {
nombre	kk{ Å
,
kkÅ Ç
}ll 
)ll 
.ll 
ToListll %
(ll% &
)ll& '
;ll' (
	resultadomm 
.mm 
ForEachmm !
(mm! "
rmm" #
=>mm$ &
rmm' (
.mm( )
FechaEmisionmm) 5
=mm6 7

PagoCuotasmm8 B
.mmB C
FirstOrDefaultmmC Q
(mmQ R
pcmmR T
=>mmU W
pcmmX Z
.mmZ [
IdCuotamm[ b
==mmc e'
TransaccionOrdenMontoPagos	mmf Ä
.
mmÄ Å
FirstOrDefault
mmÅ è
(
mmè ê
tomp
mmê î
=>
mmï ó
tomp
mmò ú
.
mmú ù 
IdTransaccionOrden
mmù Ø
==
mm∞ ≤
r
mm≥ ¥
.
mm¥ µ
Id
mmµ ∑
)
mm∑ ∏
.
mm∏ π
IdCuota
mmπ ¿
)
mm¿ ¡
.
mm¡ ¬
FechaEmision
mm¬ Œ
)
mmŒ œ
;
mmœ –
	resultadonn 
.nn 
ForEachnn !
(nn! "
rnn" #
=>nn$ &
rnn' (
.nn( )
MontoTotalPagonn) 7
=nn8 9

PagoCuotasnn: D
.nnD E
FirstOrDefaultnnE S
(nnS T
pcnnT V
=>nnW Y
pcnnZ \
.nn\ ]
IdCuotann] d
==nne g'
TransaccionOrdenMontoPagos	nnh Ç
.
nnÇ É
FirstOrDefault
nnÉ ë
(
nnë í
tomp
nní ñ
=>
nnó ô
tomp
nnö û
.
nnû ü 
IdTransaccionOrden
nnü ±
==
nn≤ ¥
r
nnµ ∂
.
nn∂ ∑
Id
nn∑ π
)
nnπ ∫
.
nn∫ ª
IdCuota
nnª ¬
)
nn¬ √
.
nn√ ƒ
	MontoPago
nnƒ Õ
)
nnÕ Œ
;
nnŒ œ
returnoo 
	resultadooo  
;oo  !
}pp 
catchqq 
(qq 
	Exceptionqq 
eqq 
)qq 
{rr 
throwss 
newss 
DatosExceptionss (
(ss( )
$strss) N
,ssN O
essP Q
)ssQ R
;ssR S
}tt 
}uu 	
publicww 
IEnumerableww 
<ww 
RegistroClienteww *
>ww* +#
ObtenerRegistroClientesww, C
(wwC D
intwwD G
[wwG H
]wwH I 
idsTiposComprobanteswwJ ^
,ww^ _
intww` c
[wwc d
]wwd e
idsTiposTransaccionwwf y
,wwy z
DateTime	ww{ É

fechaDesde
wwÑ é
,
wwé è
DateTime
wwê ò

fechaHasta
wwô £
)
ww£ §
{xx 	
tryyy 
{zz 
SigescomEntities{{  
_db{{! $
={{% &
new{{' *
SigescomEntities{{+ ;
({{; <
){{< =
;{{= >
return|| 
_db|| 
.|| 
Transaccion|| &
.}} 
Where}} !
(}}! "
t}}" #
=>}}$ &
t}}' (
.}}( )
fecha_inicio}}) 5
>=}}6 8

fechaDesde}}9 C
&&}}D F
t}}G H
.}}H I
fecha_inicio}}I U
<=}}V X

fechaHasta}}Y c
&&~~ 
idsTiposTransaccion~~ 2
.~~2 3
Contains~~3 ;
(~~; <
t~~< =
.~~= >
id_tipo_transaccion~~> Q
)~~Q R
&&  
idsTiposComprobantes 3
.3 4
Contains4 <
(< =
t= >
.> ?
Comprobante? J
.J K
id_tipo_comprobanteK ^
)^ _
)_ `
.` a
Selecta g
(g h
th i
=>j l
tm n
.n o
Actor_negocio1o }
)} ~
.~ 
Distinct	 á
(
á à
)
à â
.
ÄÄ 
Select
ÄÄ #
(
ÄÄ# $
an
ÄÄ$ &
=>
ÄÄ' )
new
ÄÄ* -
RegistroCliente
ÄÄ. =
(
ÄÄ= >
)
ÄÄ> ?
{
ÅÅ 
Id
ÇÇ  "
=
ÇÇ# $
an
ÇÇ% '
.
ÇÇ' (
id
ÇÇ( *
,
ÇÇ* +
NumeroDocumento
ÉÉ  /
=
ÉÉ0 1
an
ÉÉ2 4
.
ÉÉ4 5
Actor
ÉÉ5 :
.
ÉÉ: ;(
numero_documento_identidad
ÉÉ; U
,
ÉÉU V
Nombre
ÑÑ  &
=
ÑÑ' (
an
ÑÑ) +
.
ÑÑ+ ,
Actor
ÑÑ, 1
.
ÑÑ1 2
primer_nombre
ÑÑ2 ?
,
ÑÑ? @
	Direccion
ÖÖ  )
=
ÖÖ* +
an
ÖÖ, .
.
ÖÖ. /
Actor
ÖÖ/ 4
.
ÖÖ4 5
	Direccion
ÖÖ5 >
.
ÖÖ> ?
FirstOrDefault
ÖÖ? M
(
ÖÖM N
d
ÖÖN O
=>
ÖÖP R
d
ÖÖS T
.
ÖÖT U
	es_activo
ÖÖU ^
)
ÖÖ^ _
.
ÖÖ_ `
detalle
ÖÖ` g
}
ÜÜ 
)
áá 
;
áá 
}
àà 
catch
ââ 
(
ââ 
	Exception
ââ 
e
ââ 
)
ââ 
{
ää 
throw
ãã 
new
ãã 
DatosException
ãã (
(
ãã( )
$str
ãã) N
,
ããN O
e
ããP Q
)
ããQ R
;
ããR S
}
åå 
}
çç 	
}
èè 
}êê ‘
ZD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\Finanzas\FinanzaReporte_Datos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
{ 
public 

partial 
class  
FinanzaReporte_Datos -
:. /'
IFinanzaReporte_Repositorio0 K
{ 
public 
IEnumerable 
< 
IngresoEgreso (
>( )"
ObtenerIngresosEgresos* @
(@ A
intA D
idCajaE K
,K L
DateTimeM U

fechaDesdeV `
,` a
DateTimeb j

fechaHastak u
,u v
boolw {
	esIngreso	| Ö
)
Ö Ü
{ 	
SigescomEntities 
_db  
=! "
new# &
SigescomEntities' 7
(7 8
)8 9
;9 :
var 
ingresosEgresos 
=  !
_db" %
.% &2
&Accion_de_negocio_por_tipo_transaccion& L
.  !
Where! &
(& '
antt' +
=>, .
antt/ 3
.3 4 
id_accion_de_negocio4 H
==I K
TransaccionSettingsL _
._ `
Default` g
.g h.
!IdAccionDeNegocioMovimientoEnCaja	h â
&&
ä å
antt
ç ë
.
ë í
valor
í ó
==
ò ö
	esIngreso
õ §
)
§ •
.  !

SelectMany! +
(+ ,
antt, 0
=>1 3
antt4 8
.8 9
Tipo_transaccion9 I
.I J
TransaccionJ U
)U V
.  !
Where! &
(& '
t' (
=>) +
t, -
.- .
fecha_inicio. :
>=; =

fechaDesde> H
&&I K
tL M
.M N
fecha_inicioN Z
<=[ ]

fechaHasta^ h
&&i k
tl m
.m n%
id_actor_negocio_interno	n Ü
==
á â
idCaja
ä ê
&&
ë ì
t
î ï
.
ï ñ
id_estado_actual
ñ ¶
==
ß ©
MaestroSettings
™ π
.
π ∫
Default
∫ ¡
.
¡ ¬.
 IdDetalleMaestroEstadoConfirmado
¬ ‚
)
‚ „
.  !
Select! '
(' (
t( )
=>* ,
new- 0
IngresoEgreso1 >
(> ?
)? @
{  !
Fecha$ )
=* +
t, -
.- .
fecha_inicio. :
,: ;
IdOperacion  $ /
=  0 1
t  2 3
.  3 4
id_tipo_transaccion  4 G
,  G H
	Operacion!!$ -
=!!. /
t!!0 1
.!!1 2
Tipo_transaccion!!2 B
.!!B C
nombre_corto!!C O
,!!O P
IdMedioPago""$ /
=""0 1
t""2 3
.""3 4

Traza_pago""4 >
.""> ?
FirstOrDefault""? M
(""M N
)""N O
.""O P
id_medio_pago""P ]
,""] ^
	MedioPago##$ -
=##. /
t##0 1
.##1 2

Traza_pago##2 <
.##< =
FirstOrDefault##= K
(##K L
)##L M
.##M N
Detalle_maestro1##N ^
.##^ _
nombre##_ e
,##e f
Informacion$$$ /
=$$0 1
t$$2 3
.$$3 4

Traza_pago$$4 >
.$$> ?
FirstOrDefault$$? M
($$M N
)$$N O
.$$O P
traza$$P U
,$$U V
TipoComprobante%%$ 3
=%%4 5
t%%6 7
.%%7 8
Comprobante%%8 C
.%%C D
Detalle_maestro%%D S
.%%S T
valor%%T Y
,%%Y Z#
SerieYNumeroComprobante&&$ ;
=&&< =
t&&> ?
.&&? @
Comprobante&&@ K
.&&K L
numero_serie&&L X
+&&Y Z
$str&&[ ^
+&&_ `
t&&a b
.&&b c
Comprobante&&c n
.&&n o
numero&&o u
,&&u v
Importe''$ +
='', -
t''. /
.''/ 0
importe_total''0 =
}((  !
)))  !
;))! "
return** 
ingresosEgresos** "
;**" #
}++ 	
public,, 
IEnumerable,, 
<,, 
IngresoEgreso,, (
>,,( )0
$ObtenerIngresosEgresosPorOperaciones,,* N
(,,N O
int,,O R
idCaja,,S Y
,,,Y Z
DateTime,,[ c

fechaDesde,,d n
,,,n o
DateTime,,p x

fechaHasta	,,y É
,
,,É Ñ
int
,,Ö à
[
,,à â
]
,,â ä
operaciones
,,ã ñ
)
,,ñ ó
{-- 	
SigescomEntities.. 
_db..  
=..! "
new..# &
SigescomEntities..' 7
(..7 8
)..8 9
;..9 :
var// 
ingresosEgresos// 
=//  !
_db//" %
.//% &
Transaccion//& 1
.//1 2
Where//2 7
(//7 8
t//8 9
=>//: <
t//= >
.//> ?
fecha_inicio//? K
>=//L N

fechaDesde//O Y
&&//Z \
t//] ^
.//^ _
fecha_inicio//_ k
<=//l n

fechaHasta//o y
&&//z |
t//} ~
.//~ %
id_actor_negocio_interno	// ó
==
//ò ö
idCaja
//õ °
&&
//¢ §
operaciones
//• ∞
.
//∞ ±
Contains
//± π
(
//π ∫
t
//∫ ª
.
//ª º!
id_tipo_transaccion
//º œ
)
//œ –
)
//– —
.00  !
Select00! '
(00' (
t00( )
=>00* ,
new00- 0
IngresoEgreso001 >
(00> ?
)00? @
{11  !
Fecha22$ )
=22* +
t22, -
.22- .
fecha_inicio22. :
,22: ;
IdOperacion33$ /
=330 1
t332 3
.333 4
id_tipo_transaccion334 G
,33G H
	Operacion44$ -
=44. /
t440 1
.441 2
Tipo_transaccion442 B
.44B C
nombre_corto44C O
,44O P
IdMedioPago55$ /
=550 1
t552 3
.553 4

Traza_pago554 >
.55> ?
FirstOrDefault55? M
(55M N
)55N O
.55O P
id_medio_pago55P ]
,55] ^
	MedioPago66$ -
=66. /
t660 1
.661 2

Traza_pago662 <
.66< =
FirstOrDefault66= K
(66K L
)66L M
.66M N
Detalle_maestro166N ^
.66^ _
nombre66_ e
,66e f
Informacion77$ /
=770 1
t772 3
.773 4

Traza_pago774 >
.77> ?
FirstOrDefault77? M
(77M N
)77N O
.77O P
traza77P U
,77U V
TipoComprobante88$ 3
=884 5
t886 7
.887 8
Comprobante888 C
.88C D
Detalle_maestro88D S
.88S T
valor88T Y
,88Y Z#
SerieYNumeroComprobante99$ ;
=99< =
t99> ?
.99? @
Comprobante99@ K
.99K L
numero_serie99L X
+99Y Z
$str99[ ^
+99_ `
t99a b
.99b c
Comprobante99c n
.99n o
numero99o u
,99u v
Importe::$ +
=::, -
t::. /
.::/ 0
importe_total::0 =
};;  !
)<<  !
;<<! "
return== 
ingresosEgresos== "
;==" #
}>> 	
public?? 
IEnumerable?? 
<?? 
IngresoEgreso?? (
>??( )/
#ObtenerIngresosEgresosPorMediosPago??* M
(??M N
int??N Q
idCaja??R X
,??X Y
DateTime??Z b

fechaDesde??c m
,??m n
DateTime??o w

fechaHasta	??x Ç
,
??Ç É
bool
??Ñ à
	esIngreso
??â í
,
??í ì
int
??î ó
[
??ó ò
]
??ò ô

mediosPago
??ö §
)
??§ •
{@@ 	
SigescomEntitiesAA 
_dbAA  
=AA! "
newAA# &
SigescomEntitiesAA' 7
(AA7 8
)AA8 9
;AA9 :
varBB 
ingresosEgresosBB 
=BB  !
_dbBB" %
.BB% &2
&Accion_de_negocio_por_tipo_transaccionBB& L
.CC  !
WhereCC! &
(CC& '
anttCC' +
=>CC, .
anttCC/ 3
.CC3 4 
id_accion_de_negocioCC4 H
==CCI K
TransaccionSettingsCCL _
.CC_ `
DefaultCC` g
.CCg h.
!IdAccionDeNegocioMovimientoEnCaja	CCh â
&&
CCä å
antt
CCç ë
.
CCë í
valor
CCí ó
==
CCò ö
	esIngreso
CCõ §
)
CC§ •
.DD  !

SelectManyDD! +
(DD+ ,
anttDD, 0
=>DD1 3
anttDD4 8
.DD8 9
Tipo_transaccionDD9 I
.DDI J
TransaccionDDJ U
)DDU V
.EE  !
WhereEE! &
(EE& '
tEE' (
=>EE) +
tEE, -
.EE- .
fecha_inicioEE. :
>=EE; =

fechaDesdeEE> H
&&EEI K
tEEL M
.EEM N
fecha_inicioEEN Z
<=EE[ ]

fechaHastaEE^ h
&&EEi k
tEEl m
.EEm n%
id_actor_negocio_interno	EEn Ü
==
EEá â
idCaja
EEä ê
&&
EEë ì
t
EEî ï
.
EEï ñ
id_estado_actual
EEñ ¶
==
EEß ©
MaestroSettings
EE™ π
.
EEπ ∫
Default
EE∫ ¡
.
EE¡ ¬.
 IdDetalleMaestroEstadoConfirmado
EE¬ ‚
&&
EE„ Â

mediosPago
EEÊ 
.
EE Ò
Contains
EEÒ ˘
(
EE˘ ˙
t
EE˙ ˚
.
EE˚ ¸

Traza_pago
EE¸ Ü
.
EEÜ á
FirstOrDefault
EEá ï
(
EEï ñ
)
EEñ ó
.
EEó ò
id_medio_pago
EEò •
)
EE• ¶
)
EE¶ ß
.FF  !
SelectFF! '
(FF' (
tFF( )
=>FF* ,
newFF- 0
IngresoEgresoFF1 >
(FF> ?
)FF? @
{GG  !
FechaHH$ )
=HH* +
tHH, -
.HH- .
fecha_inicioHH. :
,HH: ;
IdOperacionII$ /
=II0 1
tII2 3
.II3 4
id_tipo_transaccionII4 G
,IIG H
	OperacionJJ$ -
=JJ. /
tJJ0 1
.JJ1 2
Tipo_transaccionJJ2 B
.JJB C
nombre_cortoJJC O
,JJO P
IdMedioPagoKK$ /
=KK0 1
tKK2 3
.KK3 4

Traza_pagoKK4 >
.KK> ?
FirstOrDefaultKK? M
(KKM N
)KKN O
.KKO P
id_medio_pagoKKP ]
,KK] ^
	MedioPagoLL$ -
=LL. /
tLL0 1
.LL1 2

Traza_pagoLL2 <
.LL< =
FirstOrDefaultLL= K
(LLK L
)LLL M
.LLM N
Detalle_maestro1LLN ^
.LL^ _
nombreLL_ e
,LLe f
InformacionMM$ /
=MM0 1
tMM2 3
.MM3 4

Traza_pagoMM4 >
.MM> ?
FirstOrDefaultMM? M
(MMM N
)MMN O
.MMO P
trazaMMP U
,MMU V
TipoComprobanteNN$ 3
=NN4 5
tNN6 7
.NN7 8
ComprobanteNN8 C
.NNC D
Detalle_maestroNND S
.NNS T
valorNNT Y
,NNY Z#
SerieYNumeroComprobanteOO$ ;
=OO< =
tOO> ?
.OO? @
ComprobanteOO@ K
.OOK L
numero_serieOOL X
+OOY Z
$strOO[ ^
+OO_ `
tOOa b
.OOb c
ComprobanteOOc n
.OOn o
numeroOOo u
,OOu v
ImportePP$ +
=PP, -
tPP. /
.PP/ 0
importe_totalPP0 =
,PP= >
}QQ  !
)RR  !
;RR! "
returnSS 
ingresosEgresosSS "
;SS" #
}TT 	
publicUU 
IEnumerableUU 
<UU 
IngresoEgresoUU (
>UU( );
/ObtenerIngresosEgresosPorOperacionesYMediosPagoUU* Y
(UUY Z
intUUZ ]
idCajaUU^ d
,UUd e
DateTimeUUf n

fechaDesdeUUo y
,UUy z
DateTime	UU{ É

fechaHasta
UUÑ é
,
UUé è
int
UUê ì
[
UUì î
]
UUî ï
operaciones
UUñ °
,
UU° ¢
int
UU£ ¶
[
UU¶ ß
]
UUß ®

mediosPago
UU© ≥
)
UU≥ ¥
{VV 	
SigescomEntitiesWW 
_dbWW  
=WW! "
newWW# &
SigescomEntitiesWW' 7
(WW7 8
)WW8 9
;WW9 :
varXX 
ingresosEgresosXX 
=XX  !
_dbXX" %
.XX% &
TransaccionXX& 1
.XX1 2
WhereXX2 7
(XX7 8
tXX8 9
=>XX: <
tXX= >
.XX> ?
fecha_inicioXX? K
>=XXL N

fechaDesdeXXO Y
&&XXZ \
tXX] ^
.XX^ _
fecha_inicioXX_ k
<=XXl n

fechaHastaXXo y
&&XXz |
tXX} ~
.XX~ %
id_actor_negocio_interno	XX ó
==
XXò ö
idCaja
XXõ °
&&
XX¢ §
operaciones
XX• ∞
.
XX∞ ±
Contains
XX± π
(
XXπ ∫
t
XX∫ ª
.
XXª º!
id_tipo_transaccion
XXº œ
)
XXœ –
&&
XX— ”

mediosPago
XX‘ ﬁ
.
XXﬁ ﬂ
Contains
XXﬂ Á
(
XXÁ Ë
t
XXË È
.
XXÈ Í

Traza_pago
XXÍ Ù
.
XXÙ ı
FirstOrDefault
XXı É
(
XXÉ Ñ
)
XXÑ Ö
.
XXÖ Ü
id_medio_pago
XXÜ ì
)
XXì î
)
XXî ï
.YY  !
SelectYY! '
(YY' (
tYY( )
=>YY* ,
newYY- 0
IngresoEgresoYY1 >
(YY> ?
)YY? @
{ZZ  !
Fecha[[$ )
=[[* +
t[[, -
.[[- .
fecha_inicio[[. :
,[[: ;
IdOperacion\\$ /
=\\0 1
t\\2 3
.\\3 4
id_tipo_transaccion\\4 G
,\\G H
	Operacion]]$ -
=]]. /
t]]0 1
.]]1 2
Tipo_transaccion]]2 B
.]]B C
nombre_corto]]C O
,]]O P
IdMedioPago^^$ /
=^^0 1
t^^2 3
.^^3 4

Traza_pago^^4 >
.^^> ?
FirstOrDefault^^? M
(^^M N
)^^N O
.^^O P
id_medio_pago^^P ]
,^^] ^
	MedioPago__$ -
=__. /
t__0 1
.__1 2

Traza_pago__2 <
.__< =
FirstOrDefault__= K
(__K L
)__L M
.__M N
Detalle_maestro1__N ^
.__^ _
nombre___ e
,__e f
Informacion``$ /
=``0 1
t``2 3
.``3 4

Traza_pago``4 >
.``> ?
FirstOrDefault``? M
(``M N
)``N O
.``O P
traza``P U
,``U V
TipoComprobanteaa$ 3
=aa4 5
taa6 7
.aa7 8
Comprobanteaa8 C
.aaC D
Detalle_maestroaaD S
.aaS T
valoraaT Y
,aaY Z#
SerieYNumeroComprobantebb$ ;
=bb< =
tbb> ?
.bb? @
Comprobantebb@ K
.bbK L
numero_seriebbL X
+bbY Z
$strbb[ ^
+bb_ `
tbba b
.bbb c
Comprobantebbc n
.bbn o
numerobbo u
,bbu v
Importecc$ +
=cc, -
tcc. /
.cc/ 0
importe_totalcc0 =
,cc= >
}dd  !
)ee  !
;ee! "
returnff 
ingresosEgresosff "
;ff" #
}gg 	
publichh 
IEnumerablehh 
<hh 
IngresoEgresohh (
>hh( )2
&ObtenerIngresosEgresosEnCuentaBancariahh* P
(hhP Q
inthhQ T
idCuentahhU ]
,hh] ^
DateTimehh_ g

fechaDesdehhh r
,hhr s
DateTimehht |

fechaHasta	hh} á
,
hhá à
bool
hhâ ç
	esIngreso
hhé ó
)
hhó ò
{ii 	
SigescomEntitiesjj 
_dbjj  
=jj! "
newjj# &
SigescomEntitiesjj' 7
(jj7 8
)jj8 9
;jj9 :
varkk 
ingresosEgresoskk 
=kk  !
_dbkk" %
.kk% &2
&Accion_de_negocio_por_tipo_transaccionkk& L
.ll  !
Wherell! &
(ll& '
anttll' +
=>ll, .
anttll/ 3
.ll3 4 
id_accion_de_negocioll4 H
==llI K
TransaccionSettingsllL _
.ll_ `
Defaultll` g
.llg h.
!IdAccionDeNegocioMovimientoEnCaja	llh â
&&
llä å
antt
llç ë
.
llë í
valor
llí ó
==
llò ö
	esIngreso
llõ §
)
ll§ •
.mm  !

SelectManymm! +
(mm+ ,
anttmm, 0
=>mm1 3
anttmm4 8
.mm8 9
Tipo_transaccionmm9 I
.mmI J
TransaccionmmJ U
)mmU V
.nn  !
Wherenn! &
(nn& '
tnn' (
=>nn) +
tnn, -
.nn- .
fecha_inicionn. :
>=nn; =

fechaDesdenn> H
&&nnI K
tnnL M
.nnM N
fecha_inicionnN Z
<=nn[ ]

fechaHastann^ h
&&nni k
tnnl m
.nnm n&
id_actor_negocio_interno1	nnn á
==
nnà ä
idCuenta
nnã ì
&&
nnî ñ
t
nnó ò
.
nnò ô
id_estado_actual
nnô ©
==
nn™ ¨
MaestroSettings
nn≠ º
.
nnº Ω
Default
nnΩ ƒ
.
nnƒ ≈.
 IdDetalleMaestroEstadoConfirmado
nn≈ Â
)
nnÂ Ê
.oo  !
Selectoo! '
(oo' (
too( )
=>oo* ,
newoo- 0
IngresoEgresooo1 >
(oo> ?
)oo? @
{pp  !
Fechaqq$ )
=qq* +
tqq, -
.qq- .
fecha_inicioqq. :
,qq: ;
IdOperacionrr$ /
=rr0 1
trr2 3
.rr3 4
id_tipo_transaccionrr4 G
,rrG H
	Operacionss$ -
=ss. /
tss0 1
.ss1 2
Tipo_transaccionss2 B
.ssB C
nombre_cortossC O
,ssO P
IdMedioPagott$ /
=tt0 1
ttt2 3
.tt3 4

Traza_pagott4 >
.tt> ?
FirstOrDefaulttt? M
(ttM N
)ttN O
.ttO P
id_medio_pagottP ]
,tt] ^
	MedioPagouu$ -
=uu. /
tuu0 1
.uu1 2

Traza_pagouu2 <
.uu< =
FirstOrDefaultuu= K
(uuK L
)uuL M
.uuM N
Detalle_maestro1uuN ^
.uu^ _
nombreuu_ e
,uue f
Informacionvv$ /
=vv0 1
tvv2 3
.vv3 4

Traza_pagovv4 >
.vv> ?
FirstOrDefaultvv? M
(vvM N
)vvN O
.vvO P
trazavvP U
,vvU V
TipoComprobanteww$ 3
=ww4 5
tww6 7
.ww7 8
Comprobanteww8 C
.wwC D
Detalle_maestrowwD S
.wwS T
valorwwT Y
,wwY Z#
SerieYNumeroComprobantexx$ ;
=xx< =
txx> ?
.xx? @
Comprobantexx@ K
.xxK L
numero_seriexxL X
+xxY Z
$strxx[ ^
+xx_ `
txxa b
.xxb c
Comprobantexxc n
.xxn o
numeroxxo u
,xxu v
Importeyy$ +
=yy, -
tyy. /
.yy/ 0
importe_totalyy0 =
}zz  !
){{  !
;{{! "
return|| 
ingresosEgresos|| "
;||" #
}}} 	
public~~ 
IEnumerable~~ 
<~~ 
IngresoEgreso~~ (
>~~( )@
4ObtenerIngresosEgresosEnCuentaBancariaPorOperaciones~~* ^
(~~^ _
int~~_ b
idCuenta~~c k
,~~k l
DateTime~~m u

fechaDesde	~~v Ä
,
~~Ä Å
DateTime
~~Ç ä

fechaHasta
~~ã ï
,
~~ï ñ
int
~~ó ö
[
~~ö õ
]
~~õ ú
operaciones
~~ù ®
)
~~® ©
{ 	
SigescomEntities
ÄÄ 
_db
ÄÄ  
=
ÄÄ! "
new
ÄÄ# &
SigescomEntities
ÄÄ' 7
(
ÄÄ7 8
)
ÄÄ8 9
;
ÄÄ9 :
var
ÅÅ 
ingresosEgresos
ÅÅ 
=
ÅÅ  !
_db
ÅÅ" %
.
ÅÅ% &
Transaccion
ÅÅ& 1
.
ÅÅ1 2
Where
ÅÅ2 7
(
ÅÅ7 8
t
ÅÅ8 9
=>
ÅÅ: <
t
ÅÅ= >
.
ÅÅ> ?
fecha_inicio
ÅÅ? K
>=
ÅÅL N

fechaDesde
ÅÅO Y
&&
ÅÅZ \
t
ÅÅ] ^
.
ÅÅ^ _
fecha_inicio
ÅÅ_ k
<=
ÅÅl n

fechaHasta
ÅÅo y
&&
ÅÅz |
t
ÅÅ} ~
.
ÅÅ~ (
id_actor_negocio_interno1ÅÅ ò
==ÅÅô õ
idCuentaÅÅú §
&&ÅÅ• ß
operacionesÅÅ® ≥
.ÅÅ≥ ¥
ContainsÅÅ¥ º
(ÅÅº Ω
tÅÅΩ æ
.ÅÅæ ø#
id_tipo_transaccionÅÅø “
)ÅÅ“ ”
)ÅÅ” ‘
.
ÇÇ  !
Select
ÇÇ! '
(
ÇÇ' (
t
ÇÇ( )
=>
ÇÇ* ,
new
ÇÇ- 0
IngresoEgreso
ÇÇ1 >
(
ÇÇ> ?
)
ÇÇ? @
{
ÉÉ  !
Fecha
ÑÑ$ )
=
ÑÑ* +
t
ÑÑ, -
.
ÑÑ- .
fecha_inicio
ÑÑ. :
,
ÑÑ: ;
IdOperacion
ÖÖ$ /
=
ÖÖ0 1
t
ÖÖ2 3
.
ÖÖ3 4!
id_tipo_transaccion
ÖÖ4 G
,
ÖÖG H
	Operacion
ÜÜ$ -
=
ÜÜ. /
t
ÜÜ0 1
.
ÜÜ1 2
Tipo_transaccion
ÜÜ2 B
.
ÜÜB C
nombre_corto
ÜÜC O
,
ÜÜO P
IdMedioPago
áá$ /
=
áá0 1
t
áá2 3
.
áá3 4

Traza_pago
áá4 >
.
áá> ?
FirstOrDefault
áá? M
(
ááM N
)
ááN O
.
ááO P
id_medio_pago
ááP ]
,
áá] ^
	MedioPago
àà$ -
=
àà. /
t
àà0 1
.
àà1 2

Traza_pago
àà2 <
.
àà< =
FirstOrDefault
àà= K
(
ààK L
)
ààL M
.
ààM N
Detalle_maestro1
ààN ^
.
àà^ _
nombre
àà_ e
,
ààe f
Informacion
ââ$ /
=
ââ0 1
t
ââ2 3
.
ââ3 4

Traza_pago
ââ4 >
.
ââ> ?
FirstOrDefault
ââ? M
(
ââM N
)
ââN O
.
ââO P
traza
ââP U
,
ââU V
TipoComprobante
ää$ 3
=
ää4 5
t
ää6 7
.
ää7 8
Comprobante
ää8 C
.
ääC D
Detalle_maestro
ääD S
.
ääS T
valor
ääT Y
,
ääY Z%
SerieYNumeroComprobante
ãã$ ;
=
ãã< =
t
ãã> ?
.
ãã? @
Comprobante
ãã@ K
.
ããK L
numero_serie
ããL X
+
ããY Z
$str
ãã[ ^
+
ãã_ `
t
ããa b
.
ããb c
Comprobante
ããc n
.
ããn o
numero
ãão u
,
ããu v
Importe
åå$ +
=
åå, -
t
åå. /
.
åå/ 0
importe_total
åå0 =
}
çç  !
)
éé  !
;
éé! "
return
èè 
ingresosEgresos
èè "
;
èè" #
}
êê 	
public
ëë 
IEnumerable
ëë 
<
ëë 
IngresoEgreso
ëë (
>
ëë( )A
3ObtenerIngresosEgresosEnCuentaBancariaPorMediosPago
ëë* ]
(
ëë] ^
int
ëë^ a
idCuenta
ëëb j
,
ëëj k
DateTime
ëël t

fechaDesde
ëëu 
,ëë Ä
DateTimeëëÅ â

fechaHastaëëä î
,ëëî ï
boolëëñ ö
	esIngresoëëõ §
,ëë§ •
intëë¶ ©
[ëë© ™
]ëë™ ´

mediosPagoëë¨ ∂
)ëë∂ ∑
{
íí 	
SigescomEntities
ìì 
_db
ìì  
=
ìì! "
new
ìì# &
SigescomEntities
ìì' 7
(
ìì7 8
)
ìì8 9
;
ìì9 :
var
îî 
ingresosEgresos
îî 
=
îî  !
_db
îî" %
.
îî% &4
&Accion_de_negocio_por_tipo_transaccion
îî& L
.
ïï  !
Where
ïï! &
(
ïï& '
antt
ïï' +
=>
ïï, .
antt
ïï/ 3
.
ïï3 4"
id_accion_de_negocio
ïï4 H
==
ïïI K!
TransaccionSettings
ïïL _
.
ïï_ `
Default
ïï` g
.
ïïg h0
!IdAccionDeNegocioMovimientoEnCajaïïh â
&&ïïä å
anttïïç ë
.ïïë í
valorïïí ó
==ïïò ö
	esIngresoïïõ §
)ïï§ •
.
ññ  !

SelectMany
ññ! +
(
ññ+ ,
antt
ññ, 0
=>
ññ1 3
antt
ññ4 8
.
ññ8 9
Tipo_transaccion
ññ9 I
.
ññI J
Transaccion
ññJ U
)
ññU V
.
óó  !
Where
óó! &
(
óó& '
t
óó' (
=>
óó) +
t
óó, -
.
óó- .
fecha_inicio
óó. :
>=
óó; =

fechaDesde
óó> H
&&
óóI K
t
óóL M
.
óóM N
fecha_inicio
óóN Z
<=
óó[ ]

fechaHasta
óó^ h
&&
óói k
t
óól m
.
óóm n(
id_actor_negocio_interno1óón á
==óóà ä
idCuentaóóã ì
&&óóî ñ
tóóó ò
.óóò ô 
id_estado_actualóóô ©
==óó™ ¨
MaestroSettingsóó≠ º
.óóº Ω
DefaultóóΩ ƒ
.óóƒ ≈0
 IdDetalleMaestroEstadoConfirmadoóó≈ Â
&&óóÊ Ë

mediosPagoóóÈ Û
.óóÛ Ù
ContainsóóÙ ¸
(óó¸ ˝
tóó˝ ˛
.óó˛ ˇ

Traza_pagoóóˇ â
.óóâ ä
FirstOrDefaultóóä ò
(óóò ô
)óóô ö
.óóö õ
id_medio_pagoóóõ ®
)óó® ©
)óó© ™
.
òò  !
Select
òò! '
(
òò' (
t
òò( )
=>
òò* ,
new
òò- 0
IngresoEgreso
òò1 >
(
òò> ?
)
òò? @
{
ôô  !
Fecha
öö$ )
=
öö* +
t
öö, -
.
öö- .
fecha_inicio
öö. :
,
öö: ;
IdOperacion
õõ$ /
=
õõ0 1
t
õõ2 3
.
õõ3 4!
id_tipo_transaccion
õõ4 G
,
õõG H
	Operacion
úú$ -
=
úú. /
t
úú0 1
.
úú1 2
Tipo_transaccion
úú2 B
.
úúB C
nombre_corto
úúC O
,
úúO P
IdMedioPago
ùù$ /
=
ùù0 1
t
ùù2 3
.
ùù3 4

Traza_pago
ùù4 >
.
ùù> ?
FirstOrDefault
ùù? M
(
ùùM N
)
ùùN O
.
ùùO P
id_medio_pago
ùùP ]
,
ùù] ^
	MedioPago
ûû$ -
=
ûû. /
t
ûû0 1
.
ûû1 2

Traza_pago
ûû2 <
.
ûû< =
FirstOrDefault
ûû= K
(
ûûK L
)
ûûL M
.
ûûM N
Detalle_maestro1
ûûN ^
.
ûû^ _
nombre
ûû_ e
,
ûûe f
Informacion
üü$ /
=
üü0 1
t
üü2 3
.
üü3 4

Traza_pago
üü4 >
.
üü> ?
FirstOrDefault
üü? M
(
üüM N
)
üüN O
.
üüO P
traza
üüP U
,
üüU V
TipoComprobante
††$ 3
=
††4 5
t
††6 7
.
††7 8
Comprobante
††8 C
.
††C D
Detalle_maestro
††D S
.
††S T
valor
††T Y
,
††Y Z%
SerieYNumeroComprobante
°°$ ;
=
°°< =
t
°°> ?
.
°°? @
Comprobante
°°@ K
.
°°K L
numero_serie
°°L X
+
°°Y Z
$str
°°[ ^
+
°°_ `
t
°°a b
.
°°b c
Comprobante
°°c n
.
°°n o
numero
°°o u
,
°°u v
Importe
¢¢$ +
=
¢¢, -
t
¢¢. /
.
¢¢/ 0
importe_total
¢¢0 =
,
¢¢= >
}
££  !
)
§§  !
;
§§! "
return
•• 
ingresosEgresos
•• "
;
••" #
}
¶¶ 	
public
ßß 
IEnumerable
ßß 
<
ßß 
IngresoEgreso
ßß (
>
ßß( )M
?ObtenerIngresosEgresosEnCuentaBancariaPorOperacionesYMediosPago
ßß* i
(
ßßi j
int
ßßj m
idCuenta
ßßn v
,
ßßv w
DateTimeßßx Ä

fechaDesdeßßÅ ã
,ßßã å
DateTimeßßç ï

fechaHastaßßñ †
,ßß† °
intßß¢ •
[ßß• ¶
]ßß¶ ß
operacionesßß® ≥
,ßß≥ ¥
intßßµ ∏
[ßß∏ π
]ßßπ ∫

mediosPagoßßª ≈
)ßß≈ ∆
{
®® 	
SigescomEntities
©© 
_db
©©  
=
©©! "
new
©©# &
SigescomEntities
©©' 7
(
©©7 8
)
©©8 9
;
©©9 :
var
™™ 
ingresosEgresos
™™ 
=
™™  !
_db
™™" %
.
™™% &
Transaccion
™™& 1
.
™™1 2
Where
™™2 7
(
™™7 8
t
™™8 9
=>
™™: <
t
™™= >
.
™™> ?
fecha_inicio
™™? K
>=
™™L N

fechaDesde
™™O Y
&&
™™Z \
t
™™] ^
.
™™^ _
fecha_inicio
™™_ k
<=
™™l n

fechaHasta
™™o y
&&
™™z |
t
™™} ~
.
™™~ (
id_actor_negocio_interno1™™ ò
==™™ô õ
idCuenta™™ú §
&&™™• ß
operaciones™™® ≥
.™™≥ ¥
Contains™™¥ º
(™™º Ω
t™™Ω æ
.™™æ ø#
id_tipo_transaccion™™ø “
)™™“ ”
&&™™‘ ÷

mediosPago™™◊ ·
.™™· ‚
Contains™™‚ Í
(™™Í Î
t™™Î Ï
.™™Ï Ì

Traza_pago™™Ì ˜
.™™˜ ¯
FirstOrDefault™™¯ Ü
(™™Ü á
)™™á à
.™™à â
id_medio_pago™™â ñ
)™™ñ ó
)™™ó ò
.
´´  !
Select
´´! '
(
´´' (
t
´´( )
=>
´´* ,
new
´´- 0
IngresoEgreso
´´1 >
(
´´> ?
)
´´? @
{
¨¨  !
Fecha
≠≠$ )
=
≠≠* +
t
≠≠, -
.
≠≠- .
fecha_inicio
≠≠. :
,
≠≠: ;
IdOperacion
ÆÆ$ /
=
ÆÆ0 1
t
ÆÆ2 3
.
ÆÆ3 4!
id_tipo_transaccion
ÆÆ4 G
,
ÆÆG H
	Operacion
ØØ$ -
=
ØØ. /
t
ØØ0 1
.
ØØ1 2
Tipo_transaccion
ØØ2 B
.
ØØB C
nombre_corto
ØØC O
,
ØØO P
IdMedioPago
∞∞$ /
=
∞∞0 1
t
∞∞2 3
.
∞∞3 4

Traza_pago
∞∞4 >
.
∞∞> ?
FirstOrDefault
∞∞? M
(
∞∞M N
)
∞∞N O
.
∞∞O P
id_medio_pago
∞∞P ]
,
∞∞] ^
	MedioPago
±±$ -
=
±±. /
t
±±0 1
.
±±1 2

Traza_pago
±±2 <
.
±±< =
FirstOrDefault
±±= K
(
±±K L
)
±±L M
.
±±M N
Detalle_maestro1
±±N ^
.
±±^ _
nombre
±±_ e
,
±±e f
Informacion
≤≤$ /
=
≤≤0 1
t
≤≤2 3
.
≤≤3 4

Traza_pago
≤≤4 >
.
≤≤> ?
FirstOrDefault
≤≤? M
(
≤≤M N
)
≤≤N O
.
≤≤O P
traza
≤≤P U
,
≤≤U V
TipoComprobante
≥≥$ 3
=
≥≥4 5
t
≥≥6 7
.
≥≥7 8
Comprobante
≥≥8 C
.
≥≥C D
Detalle_maestro
≥≥D S
.
≥≥S T
valor
≥≥T Y
,
≥≥Y Z%
SerieYNumeroComprobante
¥¥$ ;
=
¥¥< =
t
¥¥> ?
.
¥¥? @
Comprobante
¥¥@ K
.
¥¥K L
numero_serie
¥¥L X
+
¥¥Y Z
$str
¥¥[ ^
+
¥¥_ `
t
¥¥a b
.
¥¥b c
Comprobante
¥¥c n
.
¥¥n o
numero
¥¥o u
,
¥¥u v
Importe
µµ$ +
=
µµ, -
t
µµ. /
.
µµ/ 0
importe_total
µµ0 =
,
µµ= >
}
∂∂  !
)
∑∑  !
;
∑∑! "
return
∏∏ 
ingresosEgresos
∏∏ "
;
∏∏" #
}
ππ 	
public
ªª 
IEnumerable
ªª 
<
ªª 
DetalleFlujo
ªª '
>
ªª' ($
ObtenerIngresosEgresos
ªª) ?
(
ªª? @
int
ªª@ C
idCaja
ªªD J
,
ªªJ K
DateTime
ªªL T

fechaDesde
ªªU _
,
ªª_ `
DateTime
ªªa i

fechaHasta
ªªj t
)
ªªt u
{
ºº 	
try
ΩΩ 
{
ææ 
SigescomEntities
øø  
_db
øø! $
=
øø% &
new
øø' *
SigescomEntities
øø+ ;
(
øø; <
)
øø< =
;
øø= >
var
¿¿ 
Resumen
¿¿ 
=
¿¿ 
_db
¿¿ !
.
¿¿! "4
&Accion_de_negocio_por_tipo_transaccion
¿¿" H
.
¡¡  !
Where
¡¡! &
(
¡¡& '
antt
¡¡' +
=>
¡¡, .
antt
¡¡/ 3
.
¡¡3 4"
id_accion_de_negocio
¡¡4 H
==
¡¡I K!
TransaccionSettings
¡¡L _
.
¡¡_ `
Default
¡¡` g
.
¡¡g h0
!IdAccionDeNegocioMovimientoEnCaja¡¡h â
)¡¡â ä
.
¬¬  !

SelectMany
¬¬! +
(
¬¬+ ,
antt
¬¬, 0
=>
¬¬1 3
antt
¬¬4 8
.
¬¬8 9
Tipo_transaccion
¬¬9 I
.
¬¬I J
Transaccion
¬¬J U
)
¬¬U V
.
¬¬V W
Where
¬¬W \
(
¬¬\ ]
t
¬¬] ^
=>
¬¬_ a
t
¬¬b c
.
¬¬c d
fecha_inicio
¬¬d p
>=
¬¬q s

fechaDesde
¬¬t ~
&&¬¬ Å
t¬¬Ç É
.¬¬É Ñ
fecha_inicio¬¬Ñ ê
<=¬¬ë ì

fechaHasta¬¬î û
&&¬¬ü °
t¬¬¢ £
.¬¬£ §(
id_actor_negocio_interno¬¬§ º
==¬¬Ω ø
idCaja¬¬¿ ∆
&&¬¬« …
t¬¬  À
.¬¬À Ã 
id_estado_actual¬¬Ã ‹
==¬¬› ﬂ
MaestroSettings¬¬‡ Ô
.¬¬Ô 
Default¬¬ ˜
.¬¬˜ ¯0
 IdDetalleMaestroEstadoConfirmado¬¬¯ ò
)¬¬ò ô
.
√√ 
Select
√√ 
(
√√ 
t
√√ 
=>
√√ 
new
√√  #
DetalleFlujo
√√$ 0
(
√√0 1
)
√√1 2
{
ƒƒ 
Fecha
≈≈ 
=
≈≈ 
t
≈≈  
.
≈≈  !
fecha_inicio
≈≈! -
,
≈≈- .
IdOperacion
∆∆ "
=
∆∆# $
t
∆∆% &
.
∆∆& '!
id_tipo_transaccion
∆∆' :
,
∆∆: ;
	Operacion
««  
=
««! "
t
««# $
.
««$ %
Tipo_transaccion
««% 5
.
««5 6
nombre
««6 <
,
««< =
TipoComprobante
»» &
=
»»' (
t
»») *
.
»»* +
Comprobante
»»+ 6
.
»»6 7
Detalle_maestro
»»7 F
.
»»F G
valor
»»G L
,
»»L M%
SerieYNumeroComprobante
…… .
=
……/ 0
t
……1 2
.
……2 3
Comprobante
……3 >
.
……> ?
numero_serie
……? K
+
……L M
$str
……N Q
+
……R S
t
……T U
.
……U V
Comprobante
……V a
.
……a b
numero
……b h
,
……h i
Importe
   
=
    
t
  ! "
.
  " #
importe_total
  # 0
,
  0 1
	EsIngreso
ÀÀ  
=
ÀÀ! "
t
ÀÀ# $
.
ÀÀ$ %
Tipo_transaccion
ÀÀ% 5
.
ÀÀ5 64
&Accion_de_negocio_por_tipo_transaccion
ÀÀ6 \
.
ÀÀ\ ]
FirstOrDefault
ÀÀ] k
(
ÀÀk l
anpt
ÀÀl p
=>
ÀÀq s
anpt
ÀÀt x
.
ÀÀx y#
id_accion_de_negocioÀÀy ç
==ÀÀé ê#
TransaccionSettingsÀÀë §
.ÀÀ§ •
DefaultÀÀ• ¨
.ÀÀ¨ ≠1
!IdAccionDeNegocioMovimientoEnCajaÀÀ≠ Œ
)ÀÀŒ œ
.ÀÀœ –
valorÀÀ– ’
}
ÃÃ 
)
ÃÃ 
;
ÃÃ 
return
ÕÕ 
Resumen
ÕÕ 
;
ÕÕ 
}
ŒŒ 
catch
œœ 
(
œœ 
	Exception
œœ 
e
œœ 
)
œœ 
{
–– 
throw
—— 
new
—— 
DatosException
—— (
(
——( )
$str
——) O
,
——O P
e
——Q R
)
——R S
;
——S T
}
““ 
}
”” 	
public
’’ 
IEnumerable
’’ 
<
’’ 
DetalleFlujo
’’ '
>
’’' (1
#ObtenerIngresosEgresosPorMediosPago
’’) L
(
’’L M
int
’’M P
idCaja
’’Q W
,
’’W X
DateTime
’’Y a

fechaDesde
’’b l
,
’’l m
DateTime
’’n v

fechaHasta’’w Å
,’’Å Ç
int’’É Ü
[’’Ü á
]’’á à

mediosPago’’â ì
)’’ì î
{
÷÷ 	
try
◊◊ 
{
ÿÿ 
SigescomEntities
ŸŸ  
_db
ŸŸ! $
=
ŸŸ% &
new
ŸŸ' *
SigescomEntities
ŸŸ+ ;
(
ŸŸ; <
)
ŸŸ< =
;
ŸŸ= >
var
⁄⁄ 
Resumen
⁄⁄ 
=
⁄⁄ 
_db
⁄⁄ !
.
⁄⁄! "4
&Accion_de_negocio_por_tipo_transaccion
⁄⁄" H
.
€€  !
Where
€€! &
(
€€& '
antt
€€' +
=>
€€, .
antt
€€/ 3
.
€€3 4"
id_accion_de_negocio
€€4 H
==
€€I K!
TransaccionSettings
€€L _
.
€€_ `
Default
€€` g
.
€€g h0
!IdAccionDeNegocioMovimientoEnCaja€€h â
)€€â ä
.
‹‹  !

SelectMany
‹‹! +
(
‹‹+ ,
antt
‹‹, 0
=>
‹‹1 3
antt
‹‹4 8
.
‹‹8 9
Tipo_transaccion
‹‹9 I
.
‹‹I J
Transaccion
‹‹J U
)
‹‹U V
.
‹‹V W
Where
‹‹W \
(
‹‹\ ]
t
‹‹] ^
=>
‹‹_ a
t
‹‹b c
.
‹‹c d
fecha_inicio
‹‹d p
>=
‹‹q s

fechaDesde
‹‹t ~
&&‹‹ Å
t‹‹Ç É
.‹‹É Ñ
fecha_inicio‹‹Ñ ê
<=‹‹ë ì

fechaHasta‹‹î û
&&‹‹ü °
t‹‹¢ £
.‹‹£ §(
id_actor_negocio_interno‹‹§ º
==‹‹Ω ø
idCaja‹‹¿ ∆
&&‹‹« …
t‹‹  À
.‹‹À Ã 
id_estado_actual‹‹Ã ‹
==‹‹› ﬂ
MaestroSettings‹‹‡ Ô
.‹‹Ô 
Default‹‹ ˜
.‹‹˜ ¯0
 IdDetalleMaestroEstadoConfirmado‹‹¯ ò
&&‹‹ô õ

mediosPago‹‹ú ¶
.‹‹¶ ß
Contains‹‹ß Ø
(‹‹Ø ∞
t‹‹∞ ±
.‹‹± ≤

Traza_pago‹‹≤ º
.‹‹º Ω
FirstOrDefault‹‹Ω À
(‹‹À Ã
)‹‹Ã Õ
.‹‹Õ Œ
id_medio_pago‹‹Œ €
)‹‹€ ‹
)‹‹‹ ›
.
›› 
Select
›› 
(
›› 
t
›› 
=>
›› 
new
››  #
DetalleFlujo
››$ 0
(
››0 1
)
››1 2
{
ﬁﬁ 
Fecha
ﬂﬂ 
=
ﬂﬂ 
t
ﬂﬂ  
.
ﬂﬂ  !
fecha_inicio
ﬂﬂ! -
,
ﬂﬂ- .
IdOperacion
‡‡ "
=
‡‡# $
t
‡‡% &
.
‡‡& '!
id_tipo_transaccion
‡‡' :
,
‡‡: ;
	Operacion
··  
=
··! "
t
··# $
.
··$ %
Tipo_transaccion
··% 5
.
··5 6
nombre
··6 <
,
··< =
TipoComprobante
‚‚ &
=
‚‚' (
t
‚‚) *
.
‚‚* +
Comprobante
‚‚+ 6
.
‚‚6 7
Detalle_maestro
‚‚7 F
.
‚‚F G
valor
‚‚G L
,
‚‚L M%
SerieYNumeroComprobante
„„ .
=
„„/ 0
t
„„1 2
.
„„2 3
Comprobante
„„3 >
.
„„> ?
numero_serie
„„? K
+
„„L M
$str
„„N Q
+
„„R S
t
„„T U
.
„„U V
Comprobante
„„V a
.
„„a b
numero
„„b h
,
„„h i
Importe
‰‰ 
=
‰‰  
t
‰‰! "
.
‰‰" #
importe_total
‰‰# 0
,
‰‰0 1
	EsIngreso
ÂÂ  
=
ÂÂ! "
t
ÂÂ# $
.
ÂÂ$ %
Tipo_transaccion
ÂÂ% 5
.
ÂÂ5 64
&Accion_de_negocio_por_tipo_transaccion
ÂÂ6 \
.
ÂÂ\ ]
FirstOrDefault
ÂÂ] k
(
ÂÂk l
anpt
ÂÂl p
=>
ÂÂq s
anpt
ÂÂt x
.
ÂÂx y#
id_accion_de_negocioÂÂy ç
==ÂÂé ê#
TransaccionSettingsÂÂë §
.ÂÂ§ •
DefaultÂÂ• ¨
.ÂÂ¨ ≠1
!IdAccionDeNegocioMovimientoEnCajaÂÂ≠ Œ
)ÂÂŒ œ
.ÂÂœ –
valorÂÂ– ’
}
ÊÊ 
)
ÊÊ 
;
ÊÊ 
return
ÁÁ 
Resumen
ÁÁ 
;
ÁÁ 
}
ËË 
catch
ÈÈ 
(
ÈÈ 
	Exception
ÈÈ 
e
ÈÈ 
)
ÈÈ 
{
ÍÍ 
throw
ÎÎ 
new
ÎÎ 
DatosException
ÎÎ (
(
ÎÎ( )
$str
ÎÎ) O
,
ÎÎO P
e
ÎÎQ R
)
ÎÎR S
;
ÎÎS T
}
ÏÏ 
}
ÌÌ 	
public
ÔÔ 
IEnumerable
ÔÔ 
<
ÔÔ 
DetalleFlujo
ÔÔ '
>
ÔÔ' (4
&ObtenerIngresosEgresosEnCuentaBancaria
ÔÔ) O
(
ÔÔO P
int
ÔÔP S
idCuenta
ÔÔT \
,
ÔÔ\ ]
DateTime
ÔÔ^ f

fechaDesde
ÔÔg q
,
ÔÔq r
DateTime
ÔÔs {

fechaHastaÔÔ| Ü
)ÔÔÜ á
{
 	
try
ÒÒ 
{
ÚÚ 
SigescomEntities
ÛÛ  
_db
ÛÛ! $
=
ÛÛ% &
new
ÛÛ' *
SigescomEntities
ÛÛ+ ;
(
ÛÛ; <
)
ÛÛ< =
;
ÛÛ= >
var
ÙÙ 
Resumen
ÙÙ 
=
ÙÙ 
_db
ÙÙ !
.
ÙÙ! "4
&Accion_de_negocio_por_tipo_transaccion
ÙÙ" H
.
ıı  !
Where
ıı! &
(
ıı& '
antt
ıı' +
=>
ıı, .
antt
ıı/ 3
.
ıı3 4"
id_accion_de_negocio
ıı4 H
==
ııI K!
TransaccionSettings
ııL _
.
ıı_ `
Default
ıı` g
.
ııg h0
!IdAccionDeNegocioMovimientoEnCajaııh â
)ııâ ä
.
ˆˆ  !

SelectMany
ˆˆ! +
(
ˆˆ+ ,
antt
ˆˆ, 0
=>
ˆˆ1 3
antt
ˆˆ4 8
.
ˆˆ8 9
Tipo_transaccion
ˆˆ9 I
.
ˆˆI J
Transaccion
ˆˆJ U
)
ˆˆU V
.
ˆˆV W
Where
ˆˆW \
(
ˆˆ\ ]
t
ˆˆ] ^
=>
ˆˆ_ a
t
ˆˆb c
.
ˆˆc d
fecha_inicio
ˆˆd p
>=
ˆˆq s

fechaDesde
ˆˆt ~
&&ˆˆ Å
tˆˆÇ É
.ˆˆÉ Ñ
fecha_inicioˆˆÑ ê
<=ˆˆë ì

fechaHastaˆˆî û
&&ˆˆü °
tˆˆ¢ £
.ˆˆ£ §)
id_actor_negocio_interno1ˆˆ§ Ω
==ˆˆæ ¿
idCuentaˆˆ¡ …
&&ˆˆ  Ã
tˆˆÕ Œ
.ˆˆŒ œ 
id_estado_actualˆˆœ ﬂ
==ˆˆ‡ ‚
MaestroSettingsˆˆ„ Ú
.ˆˆÚ Û
DefaultˆˆÛ ˙
.ˆˆ˙ ˚0
 IdDetalleMaestroEstadoConfirmadoˆˆ˚ õ
)ˆˆõ ú
.
˜˜ 
Select
˜˜ 
(
˜˜ 
t
˜˜ 
=>
˜˜ 
new
˜˜  #
DetalleFlujo
˜˜$ 0
(
˜˜0 1
)
˜˜1 2
{
¯¯ 
Fecha
˘˘ 
=
˘˘ 
t
˘˘  
.
˘˘  !
fecha_inicio
˘˘! -
,
˘˘- .
IdOperacion
˙˙ "
=
˙˙# $
t
˙˙% &
.
˙˙& '!
id_tipo_transaccion
˙˙' :
,
˙˙: ;
	Operacion
˚˚  
=
˚˚! "
t
˚˚# $
.
˚˚$ %
Tipo_transaccion
˚˚% 5
.
˚˚5 6
nombre
˚˚6 <
,
˚˚< =
TipoComprobante
¸¸ &
=
¸¸' (
t
¸¸) *
.
¸¸* +
Comprobante
¸¸+ 6
.
¸¸6 7
Detalle_maestro
¸¸7 F
.
¸¸F G
valor
¸¸G L
,
¸¸L M%
SerieYNumeroComprobante
˝˝ .
=
˝˝/ 0
t
˝˝1 2
.
˝˝2 3
Comprobante
˝˝3 >
.
˝˝> ?
numero_serie
˝˝? K
+
˝˝L M
$str
˝˝N Q
+
˝˝R S
t
˝˝T U
.
˝˝U V
Comprobante
˝˝V a
.
˝˝a b
numero
˝˝b h
,
˝˝h i
Importe
˛˛ 
=
˛˛  
t
˛˛! "
.
˛˛" #
importe_total
˛˛# 0
,
˛˛0 1
	EsIngreso
ˇˇ  
=
ˇˇ! "
t
ˇˇ# $
.
ˇˇ$ %
Tipo_transaccion
ˇˇ% 5
.
ˇˇ5 64
&Accion_de_negocio_por_tipo_transaccion
ˇˇ6 \
.
ˇˇ\ ]
FirstOrDefault
ˇˇ] k
(
ˇˇk l
anpt
ˇˇl p
=>
ˇˇq s
anpt
ˇˇt x
.
ˇˇx y#
id_accion_de_negocioˇˇy ç
==ˇˇé ê#
TransaccionSettingsˇˇë §
.ˇˇ§ •
Defaultˇˇ• ¨
.ˇˇ¨ ≠1
!IdAccionDeNegocioMovimientoEnCajaˇˇ≠ Œ
)ˇˇŒ œ
.ˇˇœ –
valorˇˇ– ’
}
ÄÄ 
)
ÄÄ 
;
ÄÄ 
return
ÅÅ 
Resumen
ÅÅ 
;
ÅÅ 
}
ÇÇ 
catch
ÉÉ 
(
ÉÉ 
	Exception
ÉÉ 
e
ÉÉ 
)
ÉÉ 
{
ÑÑ 
throw
ÖÖ 
new
ÖÖ 
DatosException
ÖÖ (
(
ÖÖ( )
$str
ÖÖ) O
,
ÖÖO P
e
ÖÖQ R
)
ÖÖR S
;
ÖÖS T
}
ÜÜ 
}
áá 	
public
ââ 
IEnumerable
ââ 
<
ââ 
DetalleFlujo
ââ '
>
ââ' (A
3ObtenerIngresosEgresosEnCuentaBancariaPorMediosPago
ââ) \
(
ââ\ ]
int
ââ] `
idCuenta
ââa i
,
ââi j
DateTime
ââk s

fechaDesde
âât ~
,
ââ~ 
DateTimeââÄ à

fechaHastaâââ ì
,ââì î
intââï ò
[ââò ô
]ââô ö

mediosPagoââõ •
)ââ• ¶
{
ää 	
try
ãã 
{
åå 
SigescomEntities
çç  
_db
çç! $
=
çç% &
new
çç' *
SigescomEntities
çç+ ;
(
çç; <
)
çç< =
;
çç= >
var
éé 
Resumen
éé 
=
éé 
_db
éé !
.
éé! "4
&Accion_de_negocio_por_tipo_transaccion
éé" H
.
èè  !
Where
èè! &
(
èè& '
antt
èè' +
=>
èè, .
antt
èè/ 3
.
èè3 4"
id_accion_de_negocio
èè4 H
==
èèI K!
TransaccionSettings
èèL _
.
èè_ `
Default
èè` g
.
èèg h0
!IdAccionDeNegocioMovimientoEnCajaèèh â
)èèâ ä
.
êê  !

SelectMany
êê! +
(
êê+ ,
antt
êê, 0
=>
êê1 3
antt
êê4 8
.
êê8 9
Tipo_transaccion
êê9 I
.
êêI J
Transaccion
êêJ U
)
êêU V
.
êêV W
Where
êêW \
(
êê\ ]
t
êê] ^
=>
êê_ a
t
êêb c
.
êêc d
fecha_inicio
êêd p
>=
êêq s

fechaDesde
êêt ~
&&êê Å
têêÇ É
.êêÉ Ñ
fecha_inicioêêÑ ê
<=êêë ì

fechaHastaêêî û
&&êêü °
têê¢ £
.êê£ §)
id_actor_negocio_interno1êê§ Ω
==êêæ ¿
idCuentaêê¡ …
&&êê  Ã
têêÕ Œ
.êêŒ œ 
id_estado_actualêêœ ﬂ
==êê‡ ‚
MaestroSettingsêê„ Ú
.êêÚ Û
DefaultêêÛ ˙
.êê˙ ˚0
 IdDetalleMaestroEstadoConfirmadoêê˚ õ
&&êêú û

mediosPagoêêü ©
.êê© ™
Containsêê™ ≤
(êê≤ ≥
têê≥ ¥
.êê¥ µ

Traza_pagoêêµ ø
.êêø ¿
FirstOrDefaultêê¿ Œ
(êêŒ œ
)êêœ –
.êê– —
id_medio_pagoêê— ﬁ
)êêﬁ ﬂ
)êêﬂ ‡
.
ëë 
Select
ëë 
(
ëë 
t
ëë 
=>
ëë 
new
ëë  #
DetalleFlujo
ëë$ 0
(
ëë0 1
)
ëë1 2
{
íí 
Fecha
ìì 
=
ìì 
t
ìì  
.
ìì  !
fecha_inicio
ìì! -
,
ìì- .
IdOperacion
îî "
=
îî# $
t
îî% &
.
îî& '!
id_tipo_transaccion
îî' :
,
îî: ;
	Operacion
ïï  
=
ïï! "
t
ïï# $
.
ïï$ %
Tipo_transaccion
ïï% 5
.
ïï5 6
nombre
ïï6 <
,
ïï< =
TipoComprobante
ññ &
=
ññ' (
t
ññ) *
.
ññ* +
Comprobante
ññ+ 6
.
ññ6 7
Detalle_maestro
ññ7 F
.
ññF G
valor
ññG L
,
ññL M%
SerieYNumeroComprobante
óó .
=
óó/ 0
t
óó1 2
.
óó2 3
Comprobante
óó3 >
.
óó> ?
numero_serie
óó? K
+
óóL M
$str
óóN Q
+
óóR S
t
óóT U
.
óóU V
Comprobante
óóV a
.
óóa b
numero
óób h
,
óóh i
Importe
òò 
=
òò  
t
òò! "
.
òò" #
importe_total
òò# 0
,
òò0 1
	EsIngreso
ôô  
=
ôô! "
t
ôô# $
.
ôô$ %
Tipo_transaccion
ôô% 5
.
ôô5 64
&Accion_de_negocio_por_tipo_transaccion
ôô6 \
.
ôô\ ]
FirstOrDefault
ôô] k
(
ôôk l
anpt
ôôl p
=>
ôôq s
anpt
ôôt x
.
ôôx y#
id_accion_de_negocioôôy ç
==ôôé ê#
TransaccionSettingsôôë §
.ôô§ •
Defaultôô• ¨
.ôô¨ ≠1
!IdAccionDeNegocioMovimientoEnCajaôô≠ Œ
)ôôŒ œ
.ôôœ –
valorôô– ’
}
öö 
)
öö 
;
öö 
return
õõ 
Resumen
õõ 
;
õõ 
}
úú 
catch
ùù 
(
ùù 
	Exception
ùù 
e
ùù 
)
ùù 
{
ûû 
throw
üü 
new
üü 
DatosException
üü (
(
üü( )
$str
üü) O
,
üüO P
e
üüQ R
)
üüR S
;
üüS T
}
†† 
}
°° 	
public
££ 
IEnumerable
££ 
<
££ 
OperacionGrupo
££ )
>
££) **
ObtenerCuentasPorCobarGrupos
££+ G
(
££G H
int
££H K
[
££K L
]
££L M
	idsGrupos
££N W
)
££W X
{
§§ 	
try
•• 
{
¶¶ 
SigescomEntities
ßß  
_db
ßß! $
=
ßß% &
new
ßß' *
SigescomEntities
ßß+ ;
(
ßß; <
)
ßß< =
;
ßß= >
var
®® 
	resultado
®® 
=
®® 
_db
®®  #
.
®®# $
Cuota
®®$ )
.
®®) *
Where
®®* /
(
®®/ 0
c
®®0 1
=>
®®2 4
c
®®5 6
.
®®6 7

por_cobrar
®®7 A
&&
©©2 4
c
©©5 6
.
©©6 7
saldo
©©7 <
>
©©= >
$num
©©? @
&&
™™2 4
Diccionario
™™5 @
.
™™@ A<
.TiposDeTransaccionOrdenesDeOperacionesDeVentas
™™A o
.
™™o p
Contains
™™p x
(
™™x y
c
™™y z
.
™™z {
Transaccion™™{ Ü
.™™Ü á#
id_tipo_transaccion™™á ö
)™™ö õ
&&
´´2 4
	idsGrupos
´´5 >
.
´´> ?
Contains
´´? G
(
´´G H
(
´´H I
int
´´I L
)
´´L M
c
´´M N
.
´´N O
Transaccion
´´O Z
.
´´Z ['
id_actor_negocio_externo1
´´[ t
)
´´t u
)
´´u v
.
¨¨ 
Select
¨¨ 
(
¨¨ 
c
¨¨ 
=>
¨¨ 
new
¨¨  #
OperacionGrupo
¨¨$ 2
(
¨¨2 3
)
¨¨3 4
{
≠≠ 
IdGrupo
ÆÆ 
=
ÆÆ  
(
ÆÆ! "
int
ÆÆ" %
)
ÆÆ% &
c
ÆÆ& '
.
ÆÆ' (
Transaccion
ÆÆ( 3
.
ÆÆ3 4'
id_actor_negocio_externo1
ÆÆ4 M
,
ÆÆM N
IdTipoTransaccion
ØØ (
=
ØØ) *
c
ØØ+ ,
.
ØØ, -
Transaccion
ØØ- 8
.
ØØ8 9!
id_tipo_transaccion
ØØ9 L
,
ØØL M
NombreGrupo
∞∞ "
=
∞∞# $
c
∞∞% &
.
∞∞& '
Transaccion
∞∞' 2
.
∞∞2 3
Actor_negocio3
∞∞3 A
.
∞∞A B
Actor
∞∞B G
.
∞∞G H
primer_nombre
∞∞H U
,
∞∞U V"
DocumentoResponsable
±± +
=
±±, -
c
±±. /
.
±±/ 0
Transaccion
±±0 ;
.
±±; <
Actor_negocio3
±±< J
.
±±J K$
Vinculo_Actor_Negocio1
±±K a
.
±±a b
FirstOrDefault
±±b p
(
±±p q
van
±±q t
=>
±±u w
van
±±x {
.
±±{ |)
id_actor_negocio_vinculado±±| ñ
==±±ó ô
(±±ö õ
int±±õ û
)±±û ü
c±±ü †
.±±† °
Transaccion±±° ¨
.±±¨ ≠)
id_actor_negocio_externo1±±≠ ∆
&&±±« …
van±±  Õ
.±±Õ Œ
tipo_vinculo±±Œ ⁄
==±±€ ›
(±±ﬁ ﬂ
int±±ﬂ ‚
)±±‚ „
TipoVinculo±±„ Ó
.±±Ó Ô 
ResponsableGrupo±±Ô ˇ
)±±ˇ Ä
.±±Ä Å
Actor_negocio±±Å é
.±±é è
Actor±±è î
.±±î ï*
numero_documento_identidad±±ï Ø
,±±Ø ∞
NombreResponsable
≤≤ (
=
≤≤) *
c
≤≤+ ,
.
≤≤, -
Transaccion
≤≤- 8
.
≤≤8 9
Actor_negocio3
≤≤9 G
.
≤≤G H$
Vinculo_Actor_Negocio1
≤≤H ^
.
≤≤^ _
FirstOrDefault
≤≤_ m
(
≤≤m n
van
≤≤n q
=>
≤≤r t
van
≤≤u x
.
≤≤x y)
id_actor_negocio_vinculado≤≤y ì
==≤≤î ñ
(≤≤ó ò
int≤≤ò õ
)≤≤õ ú
c≤≤ú ù
.≤≤ù û
Transaccion≤≤û ©
.≤≤© ™)
id_actor_negocio_externo1≤≤™ √
&&≤≤ƒ ∆
van≤≤«  
.≤≤  À
tipo_vinculo≤≤À ◊
==≤≤ÿ ⁄
(≤≤€ ‹
int≤≤‹ ﬂ
)≤≤ﬂ ‡
TipoVinculo≤≤‡ Î
.≤≤Î Ï 
ResponsableGrupo≤≤Ï ¸
)≤≤¸ ˝
.≤≤˝ ˛
Actor_negocio≤≤˛ ã
.≤≤ã å
Actor≤≤å ë
.≤≤ë í
primer_nombre≤≤í ü
.≤≤ü †
Replace≤≤† ß
(≤≤ß ®
$str≤≤® ´
,≤≤´ ¨
$str≤≤≠ ∞
)≤≤∞ ±
,≤≤± ≤
	IdCliente
≥≥  
=
≥≥! "
c
≥≥# $
.
≥≥$ %
Transaccion
≥≥% 0
.
≥≥0 1&
id_actor_negocio_externo
≥≥1 I
,
≥≥I J
NombreCliente
¥¥ $
=
¥¥% &
c
¥¥' (
.
¥¥( )
Transaccion
¥¥) 4
.
¥¥4 5
Actor_negocio1
¥¥5 C
.
¥¥C D
Actor
¥¥D I
.
¥¥I J
primer_nombre
¥¥J W
.
¥¥W X
Replace
¥¥X _
(
¥¥_ `
$str
¥¥` c
,
¥¥c d
$str
¥¥e h
)
¥¥h i
,
¥¥i j
IdComprobante
µµ $
=
µµ% &
c
µµ' (
.
µµ( )
Transaccion
µµ) 4
.
µµ4 5
id_comprobante
µµ5 C
,
µµC D
InfoComprobante
∂∂ &
=
∂∂' (
$str
∂∂) -
+
∂∂. /
c
∂∂0 1
.
∂∂1 2
Transaccion
∂∂2 =
.
∂∂= >
Comprobante
∂∂> I
.
∂∂I J
Detalle_maestro
∂∂J Y
.
∂∂Y Z
valor
∂∂Z _
+
∂∂` a
$str
∂∂b f
+
∂∂g h
c
∂∂i j
.
∂∂j k
Transaccion
∂∂k v
.
∂∂v w
Comprobante∂∂w Ç
.∂∂Ç É
numero_serie∂∂É è
+∂∂ê ë
$str∂∂í ï
+∂∂ñ ó
c∂∂ò ô
.∂∂ô ö
Transaccion∂∂ö •
.∂∂• ¶
Comprobante∂∂¶ ±
.∂∂± ≤
numero∂∂≤ ∏
+∂∂π ∫
$str∂∂ª æ
,∂∂æ ø
Importe
∑∑ 
=
∑∑  
c
∑∑! "
.
∑∑" #
total
∑∑# (
,
∑∑( )
Revocado
∏∏ 
=
∏∏  !
c
∏∏" #
.
∏∏# $
revocado
∏∏$ ,
,
∏∏, -
ACuenta
ππ 
=
ππ  
c
ππ! "
.
ππ" #
pago_a_cuenta
ππ# 0
,
ππ0 1
Saldo
∫∫ 
=
∫∫ 
c
∫∫  
.
∫∫  !
saldo
∫∫! &
,
∫∫& '
}
ªª 
)
ªª 
;
ªª 
return
ºº 
	resultado
ºº  
;
ºº  !
}
ΩΩ 
catch
ææ 
(
ææ 
	Exception
ææ 
e
ææ 
)
ææ 
{
øø 
throw
¿¿ 
new
¿¿ 
DatosException
¿¿ (
(
¿¿( )
$str
¿¿) c
,
¿¿c d
e
¿¿e f
)
¿¿f g
;
¿¿g h
}
¡¡ 
}
¬¬ 	
public
ƒƒ 
IEnumerable
ƒƒ 
<
ƒƒ %
OperacionGrupoDetallado
ƒƒ 2
>
ƒƒ2 32
$ObtenerCuentasPorCobarGrupoDetallado
ƒƒ4 X
(
ƒƒX Y
int
ƒƒY \
idGrupo
ƒƒ] d
)
ƒƒd e
{
≈≈ 	
try
∆∆ 
{
«« 
SigescomEntities
»»  
_db
»»! $
=
»»% &
new
»»' *
SigescomEntities
»»+ ;
(
»»; <
)
»»< =
;
»»= >
var
…… 
	resultado
…… 
=
…… 
_db
……  #
.
……# $
Cuota
……$ )
.
……) *
Where
……* /
(
……/ 0
c
……0 1
=>
……2 4
c
……5 6
.
……6 7

por_cobrar
……7 A
&&
  2 4
c
  5 6
.
  6 7
saldo
  7 <
>
  = >
$num
  ? @
&&
ÀÀ2 4
Diccionario
ÀÀ5 @
.
ÀÀ@ A<
.TiposDeTransaccionOrdenesDeOperacionesDeVentas
ÀÀA o
.
ÀÀo p
Contains
ÀÀp x
(
ÀÀx y
c
ÀÀy z
.
ÀÀz {
TransaccionÀÀ{ Ü
.ÀÀÜ á#
id_tipo_transaccionÀÀá ö
)ÀÀö õ
&&
ÃÃ2 4
(
ÃÃ5 6
int
ÃÃ6 9
)
ÃÃ9 :
c
ÃÃ: ;
.
ÃÃ; <
Transaccion
ÃÃ< G
.
ÃÃG H'
id_actor_negocio_externo1
ÃÃH a
==
ÃÃb d
idGrupo
ÃÃe l
)
ÃÃl m
.
ÕÕ 
Select
ÕÕ 
(
ÕÕ 
c
ÕÕ 
=>
ÕÕ 
new
ÕÕ  #%
OperacionGrupoDetallado
ÕÕ$ ;
(
ÕÕ; <
)
ÕÕ< =
{
ŒŒ 
Id
œœ 
=
œœ 
c
œœ 
.
œœ 
Transaccion
œœ )
.
œœ) *
id
œœ* ,
,
œœ, -
IdTipoTransaccion
–– (
=
––) *
c
––+ ,
.
––, -
Transaccion
––- 8
.
––8 9!
id_tipo_transaccion
––9 L
,
––L M
NombreResponsable
—— (
=
——) *
c
——+ ,
.
——, -
Transaccion
——- 8
.
——8 9
Actor_negocio3
——9 G
.
——G H$
Vinculo_Actor_Negocio1
——H ^
.
——^ _
FirstOrDefault
——_ m
(
——m n
van
——n q
=>
——r t
van
——u x
.
——x y)
id_actor_negocio_vinculado——y ì
==——î ñ
(——ó ò
int——ò õ
)——õ ú
c——ú ù
.——ù û
Transaccion——û ©
.——© ™)
id_actor_negocio_externo1——™ √
&&——ƒ ∆
van——«  
.——  À
tipo_vinculo——À ◊
==——ÿ ⁄
(——€ ‹
int——‹ ﬂ
)——ﬂ ‡
TipoVinculo——‡ Î
.——Î Ï 
ResponsableGrupo——Ï ¸
)——¸ ˝
.——˝ ˛
Actor_negocio——˛ ã
.——ã å
Actor——å ë
.——ë í
primer_nombre——í ü
.——ü †
Replace——† ß
(——ß ®
$str——® ´
,——´ ¨
$str——≠ ∞
)——∞ ±
,——± ≤
DocumentoCliente
““ '
=
““( )
c
““* +
.
““+ ,
Transaccion
““, 7
.
““7 8
Actor_negocio1
““8 F
.
““F G
Actor
““G L
.
““L M(
numero_documento_identidad
““M g
,
““g h
NombreCliente
”” $
=
””% &
c
””' (
.
””( )
Transaccion
””) 4
.
””4 5
Actor_negocio1
””5 C
.
””C D
Actor
””D I
.
””I J
primer_nombre
””J W
.
””W X
Replace
””X _
(
””_ `
$str
””` c
,
””c d
$str
””e h
)
””h i
,
””i j
Emision
‘‘ 
=
‘‘  
c
‘‘! "
.
‘‘" #
Transaccion
‘‘# .
.
‘‘. /
fecha_inicio
‘‘/ ;
,
‘‘; <
TipoComprobante
’’ &
=
’’' (
c
’’) *
.
’’* +
Transaccion
’’+ 6
.
’’6 7
Comprobante
’’7 B
.
’’B C
Detalle_maestro
’’C R
.
’’R S
valor
’’S X
,
’’X Y
IdComprobante
÷÷ $
=
÷÷% &
c
÷÷' (
.
÷÷( )
Transaccion
÷÷) 4
.
÷÷4 5
id_comprobante
÷÷5 C
,
÷÷C D%
SerieYNumeroComprobante
◊◊ .
=
◊◊/ 0
c
◊◊1 2
.
◊◊2 3
Transaccion
◊◊3 >
.
◊◊> ?
Comprobante
◊◊? J
.
◊◊J K
numero_serie
◊◊K W
+
◊◊X Y
$str
◊◊Z ]
+
◊◊^ _
c
◊◊` a
.
◊◊a b
Transaccion
◊◊b m
.
◊◊m n
Comprobante
◊◊n y
.
◊◊y z
numero◊◊z Ä
,◊◊Ä Å
Importe
ÿÿ 
=
ÿÿ  
c
ÿÿ! "
.
ÿÿ" #
total
ÿÿ# (
,
ÿÿ( )
Revocado
ŸŸ 
=
ŸŸ  !
c
ŸŸ" #
.
ŸŸ# $
revocado
ŸŸ$ ,
,
ŸŸ, -
ACuenta
⁄⁄ 
=
⁄⁄  
c
⁄⁄! "
.
⁄⁄" #
pago_a_cuenta
⁄⁄# 0
,
⁄⁄0 1
Saldo
€€ 
=
€€ 
c
€€  
.
€€  !
saldo
€€! &
,
€€& '
}
‹‹ 
)
‹‹ 
;
‹‹ 
return
›› 
	resultado
››  
;
››  !
}
ﬁﬁ 
catch
ﬂﬂ 
(
ﬂﬂ 
	Exception
ﬂﬂ 
e
ﬂﬂ 
)
ﬂﬂ 
{
‡‡ 
throw
·· 
new
·· 
DatosException
·· (
(
··( )
$str
··) l
,
··l m
e
··n o
)
··o p
;
··p q
}
‚‚ 
}
„„ 	
}
ËË 
}ÈÈ ‹÷	
GD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\HotelDatos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
." #
Sigescom# +
{ 
public 

class 

HotelDatos 
: 
RepositorioBase -
,- .
IHotelRepositorio/ @
{ 
public 
IEnumerable 
< 
ItemGenerico '
>' (
ObtenerAmbientes) 9
(9 :
): ;
{ 	
try 
{ 
return 
_db 
. 
Actor_negocio (
.( )
Where) .
(. /
an/ 1
=>2 4
an5 7
.7 8
id_rol8 >
==? A
HotelSettingsB O
.O P
DefaultP W
.W X
IdRolAmbienteHotelX j
)j k
.k l
Selectl r
(r s
ans u
=>v x
newy |
ItemGenerico	} â
(
â ä
)
ä ã
{   
Id!! 
=!! 
an!! 
.!! 
id!! 
,!! 
Nombre"" 
="" 
an"" 
.""  
Actor""  %
.""% &
primer_nombre""& 3
,""3 4
}## 
)## 
;## 
}$$ 
catch%% 
(%% 
	Exception%% 
e%% 
)%% 
{&& 
throw(( 
new(( 
DatosException(( (
(((( )
$str(() T
,((T U
e((V W
)((W X
;((X Y
})) 
}** 	
public++ 
IEnumerable++ 
<++ 
AmbienteHotel++ (
>++( )3
'ObtenerAmbientesHotelPorEstablecimiento++* Q
(++Q R
int++R U
idEstablecimiento++V g
)++g h
{,, 	
try-- 
{.. 
return// 
_db// 
.// 
Actor_negocio// (
.//( )
Where//) .
(//. /
an/// 1
=>//2 4
an//5 7
.//7 8
id_rol//8 >
==//? A
HotelSettings//B O
.//O P
Default//P W
.//W X
IdRolAmbienteHotel//X j
&&//k m
an//n p
.//p q#
id_actor_negocio_padre	//q á
==
//à ä
idEstablecimiento
//ã ú
)
//ú ù
.
//ù û
Select
//û §
(
//§ •
an
//• ß
=>
//® ™
new
//´ Æ
AmbienteHotel
//Ø º
(
//º Ω
)
//Ω æ
{00 
Id11 
=11 
an11 
.11 
id11 
,11 
IdActor22 
=22 
an22  
.22  !
Actor22! &
.22& '
id22' )
,22) *
Codigo33 
=33 
an33 
.33  
Actor33  %
.33% &&
numero_documento_identidad33& @
,33@ A
Nombre44 
=44 
an44 
.44  
Actor44  %
.44% &
primer_nombre44& 3
,443 4
	EsVigente55 
=55 
an55  "
.55" #

es_vigente55# -
}77 
)77 
;77 
}88 
catch99 
(99 
	Exception99 
e99 
)99 
{:: 
throw<< 
new<< 
DatosException<< (
(<<( )
$str<<) T
,<<T U
e<<V W
)<<W X
;<<X Y
}== 
}>> 	
public?? 
IEnumerable?? 
<?? 
ItemGenerico?? '
>??' (B
6ObtenerAmbientesVigentesPorEstablecimientoSimplificado??) _
(??_ `
int??` c
idEstablecimiento??d u
)??u v
{@@ 	
tryAA 
{BB 
returnCC 
_dbCC 
.CC 
Actor_negocioCC (
.CC( )
WhereCC) .
(CC. /
anCC/ 1
=>CC2 4
anCC5 7
.CC7 8
id_rolCC8 >
==CC? A
HotelSettingsCCB O
.CCO P
DefaultCCP W
.CCW X
IdRolAmbienteHotelCCX j
&&CCk m
anCCn p
.CCp q#
id_actor_negocio_padre	CCq á
==
CCà ä
idEstablecimiento
CCã ú
&&
CCù ü
an
CC† ¢
.
CC¢ £

es_vigente
CC£ ≠
)
CC≠ Æ
.
CCÆ Ø
Select
CCØ µ
(
CCµ ∂
an
CC∂ ∏
=>
CCπ ª
new
CCº ø
ItemGenerico
CC¿ Ã
(
CCÃ Õ
)
CCÕ Œ
{DD 
IdEE 
=EE 
anEE 
.EE 
idEE 
,EE 
NombreFF 
=FF 
anFF 
.FF  
ActorFF  %
.FF% &
primer_nombreFF& 3
,FF3 4
}GG 
)GG 
;GG 
}HH 
catchII 
(II 
	ExceptionII 
eII 
)II 
{JJ 
throwLL 
newLL 
DatosExceptionLL (
(LL( )
$strLL) T
,LLT U
eLLV W
)LLW X
;LLX Y
}MM 
}NN 	
publicPP 
boolPP 1
%ExisteNombreAmbienteEnEstablecimientoPP 9
(PP9 :
stringPP: @
nombreAmbientePPA O
,PPO P
intPPQ T
idEstablecimientoPPU f
)PPf g
{QQ 	
tryRR 
{SS 
returnTT 
_dbTT 
.TT 
Actor_negocioTT (
.TT( )
WhereTT) .
(TT. /
anTT/ 1
=>TT2 4
anTT5 7
.TT7 8"
id_actor_negocio_padreTT8 N
==TTO Q
idEstablecimientoTTR c
&&TTd f
anTTg i
.TTi j
ActorTTj o
.TTo p
primer_nombreTTp }
==	TT~ Ä
nombreAmbiente
TTÅ è
&&
TTê í
an
TTì ï
.
TTï ñ
id_rol
TTñ ú
==
TTù ü
HotelSettings
TT† ≠
.
TT≠ Æ
Default
TTÆ µ
.
TTµ ∂ 
IdRolAmbienteHotel
TT∂ »
)
TT» …
.
TT…  
Any
TT  Õ
(
TTÕ Œ
)
TTŒ œ
;
TTœ –
}UU 
catchVV 
(VV 
	ExceptionVV 
eVV 
)VV 
{WW 
throwXX 
newXX 
DatosExceptionXX (
(XX( )
$strXX) f
,XXf g
eXXh i
)XXi j
;XXj k
}YY 
}ZZ 	
public[[ 
bool[[ @
4ExisteNombreAmbienteEnEstablecimientoExceptoAmbiente[[ H
([[H I
string[[I O
nombreAmbiente[[P ^
,[[^ _
int[[` c
idEstablecimiento[[d u
,[[u v
int[[w z
idAmbienteExcluir	[[{ å
)
[[å ç
{\\ 	
try]] 
{^^ 
return__ 
_db__ 
.__ 
Actor_negocio__ (
.__( )
Where__) .
(__. /
an__/ 1
=>__2 4
an__5 7
.__7 8"
id_actor_negocio_padre__8 N
==__O Q
idEstablecimiento__R c
&&__d f
an__g i
.__i j
Actor__j o
.__o p
primer_nombre__p }
==	__~ Ä
nombreAmbiente
__Å è
&&
__ê í
an
__ì ï
.
__ï ñ
id_rol
__ñ ú
==
__ù ü
HotelSettings
__† ≠
.
__≠ Æ
Default
__Æ µ
.
__µ ∂ 
IdRolAmbienteHotel
__∂ »
&&
__… À
an
__Ã Œ
.
__Œ œ
id
__œ —
!=
__“ ‘
idAmbienteExcluir
__’ Ê
)
__Ê Á
.
__Á Ë
Any
__Ë Î
(
__Î Ï
)
__Ï Ì
;
__Ì Ó
}`` 
catchaa 
(aa 
	Exceptionaa 
eaa 
)aa 
{bb 
throwcc 
newcc 
DatosExceptioncc (
(cc( )
$strcc) f
,ccf g
ecch i
)cci j
;ccj k
}dd 
}ee 	
publicii 
IEnumerableii 
<ii 
ItemGenericoii '
>ii' (6
*ObtenerTiposHabitacionVigentesSimplificadoii) S
(iiS T
)iiT U
{jj 	
trykk 
{ll 
returnmm 
_dbmm 
.mm 
Concepto_negociomm +
.mm+ ,
Wheremm, 1
(mm1 2
cnmm2 4
=>mm5 7
cnmm8 :
.mm: ;
id_concepto_basicomm; M
==mmN P
HotelSettingsmmQ ^
.mm^ _
Defaultmm_ f
.mmf g.
!IdDetalleMaestroFamiliaHabitacion	mmg à
&&
mmâ ã
cn
mmå é
.
mmé è

es_vigente
mmè ô
)
mmô ö
.
mmö õ
Select
mmõ °
(
mm° ¢
cn
mm¢ §
=>
mm• ß
new
mm® ´
ItemGenerico
mm¨ ∏
(
mm∏ π
)
mmπ ∫
{nn 
Idoo 
=oo 
cnoo 
.oo 
idoo 
,oo 
Nombrepp 
=pp 
cnpp 
.pp  
sufijopp  &
,pp& '
}qq 
)qq 
;qq 
}rr 
catchss 
(ss 
	Exceptionss 
ess 
)ss 
{tt 
throwvv 
newvv 
DatosExceptionvv (
(vv( )
$strvv) U
,vvU V
evvW X
)vvX Y
;vvY Z
}ww 
}xx 	
publicyy 
boolyy &
ExisteNombreTipoHabitacionyy .
(yy. /
stringyy/ 5 
nombreTipoHabitacionyy6 J
)yyJ K
{zz 	
try{{ 
{|| 
return}} 
_db}} 
.}}  
Concepto_negocio_rol}} /
.}}/ 0
Where}}0 5
(}}5 6
cnr}}6 9
=>}}: <
cnr}}= @
.}}@ A
Concepto_negocio}}A Q
.}}Q R
nombre}}R X
==}}Y [ 
nombreTipoHabitacion}}\ p
&&}}q s
cnr}}t w
.}}w x
id_rol}}x ~
==	}} Å
HotelSettings
}}Ç è
.
}}è ê
Default
}}ê ó
.
}}ó ò 
IdRolConceptoHotel
}}ò ™
)
}}™ ´
.
}}´ ¨
Any
}}¨ Ø
(
}}Ø ∞
)
}}∞ ±
;
}}± ≤
}~~ 
catch 
( 
	Exception 
e 
) 
{
ÄÄ 
throw
ÅÅ 
new
ÅÅ 
DatosException
ÅÅ (
(
ÅÅ( )
$str
ÅÅ) p
,
ÅÅp q
e
ÅÅr s
)
ÅÅs t
;
ÅÅt u
}
ÇÇ 
}
ÉÉ 	
public
ÑÑ 
bool
ÑÑ =
/ExisteNombreTipoHabitacionExceptoTipoHabitacion
ÑÑ C
(
ÑÑC D
string
ÑÑD J"
nombreTipoHabitacion
ÑÑK _
,
ÑÑ_ `
int
ÑÑa d%
idTipoHabitacionExcluir
ÑÑe |
)
ÑÑ| }
{
ÖÖ 	
try
ÜÜ 
{
áá 
return
àà 
_db
àà 
.
àà "
Concepto_negocio_rol
àà /
.
àà/ 0
Where
àà0 5
(
àà5 6
cnr
àà6 9
=>
àà: <
cnr
àà= @
.
àà@ A
Concepto_negocio
ààA Q
.
ààQ R
nombre
ààR X
==
ààY ["
nombreTipoHabitacion
àà\ p
&&
ààq s
cnr
ààt w
.
ààw x
id_rol
ààx ~
==àà Å
HotelSettingsààÇ è
.ààè ê
Defaultààê ó
.ààó ò"
IdRolConceptoHotelààò ™
&&àà´ ≠
cnrààÆ ±
.àà± ≤ 
Concepto_negocioàà≤ ¬
.àà¬ √
idàà√ ≈
!=àà∆ »'
idTipoHabitacionExcluiràà… ‡
)àà‡ ·
.àà· ‚
Anyàà‚ Â
(ààÂ Ê
)ààÊ Á
;ààÁ Ë
}
ââ 
catch
ää 
(
ää 
	Exception
ää 
e
ää 
)
ää 
{
ãã 
throw
åå 
new
åå 
DatosException
åå (
(
åå( )
$str
åå) p
,
ååp q
e
åår s
)
åås t
;
ååt u
}
çç 
}
éé 	
public
ìì 
IEnumerable
ìì 
<
ìì 
ItemGenerico
ìì '
>
ìì' (
ObtenerTiposCama
ìì) 9
(
ìì9 :
)
ìì: ;
{
îî 	
try
ïï 
{
ññ 
return
óó 
_db
óó 
.
óó 
Detalle_maestro
óó *
.
óó* +
Where
óó+ 0
(
óó0 1
dm
óó1 3
=>
óó4 6
dm
óó7 9
.
óó9 :

id_maestro
óó: D
==
óóE G
HotelSettings
óóH U
.
óóU V
Default
óóV ]
.
óó] ^
IdMaestroTipoCama
óó^ o
)
óóo p
.
óóp q
Select
óóq w
(
óów x
dm
óóx z
=>
óó{ }
newóó~ Å
ItemGenericoóóÇ é
(óóé è
)óóè ê
{
òò 
Id
ôô 
=
ôô 
dm
ôô 
.
ôô 
id
ôô 
,
ôô 
Nombre
öö 
=
öö 
dm
öö 
.
öö  
nombre
öö  &
,
öö& '
}
õõ 
)
õõ 
;
õõ 
}
ùù 
catch
ûû 
(
ûû 
	Exception
ûû 
e
ûû 
)
ûû 
{
üü 
throw
°° 
new
°° 
DatosException
°° (
(
°°( )
$str
°°) P
,
°°P Q
e
°°R S
)
°°S T
;
°°T U
}
¢¢ 
}
££ 	
public
ßß 
IEnumerable
ßß 
<
ßß 
Complemento
ßß &
>
ßß& '!
ObtenerComplementos
ßß( ;
(
ßß; <
)
ßß< =
{
®® 	
return
ÆÆ 
null
ÆÆ 
;
ÆÆ 
}
ØØ 	
public
≥≥ 
bool
≥≥ 5
'ExisteCodigoHabitacionEnEstablecimiento
≥≥ ;
(
≥≥; <
string
≥≥< B
codigoHabitacion
≥≥C S
,
≥≥S T
int
≥≥U X
idEstablecimiento
≥≥Y j
)
≥≥j k
{
¥¥ 	
try
µµ 
{
∂∂ 
return
∑∑ 
_db
∑∑ 
.
∑∑ 
Actor_negocio
∑∑ (
.
∑∑( )
Where
∑∑) .
(
∑∑. /
an
∑∑/ 1
=>
∑∑2 4
an
∑∑5 7
.
∑∑7 8
Actor_negocio2
∑∑8 F
.
∑∑F G$
id_actor_negocio_padre
∑∑G ]
==
∑∑^ `
idEstablecimiento
∑∑a r
&&
∑∑s u
an
∑∑v x
.
∑∑x y
Actor
∑∑y ~
.
∑∑~ )
numero_documento_identidad∑∑ ô
==∑∑ö ú 
codigoHabitacion∑∑ù ≠
&&∑∑Æ ∞
an∑∑± ≥
.∑∑≥ ¥
id_rol∑∑¥ ∫
==∑∑ª Ω
HotelSettings∑∑æ À
.∑∑À Ã
Default∑∑Ã ”
.∑∑” ‘
IdRolHabitacion∑∑‘ „
)∑∑„ ‰
.∑∑‰ Â
Any∑∑Â Ë
(∑∑Ë È
)∑∑È Í
;∑∑Í Î
}
∏∏ 
catch
ππ 
(
ππ 
	Exception
ππ 
e
ππ 
)
ππ 
{
∫∫ 
throw
ªª 
new
ªª 
DatosException
ªª (
(
ªª( )
$str
ªª) h
,
ªªh i
e
ªªj k
)
ªªk l
;
ªªl m
}
ºº 
}
ΩΩ 	
public
ææ 
bool
ææ F
8ExisteCodigoHabitacionEnEstablecimientoExceptoHabitacion
ææ L
(
ææL M
string
ææM S
codigoHabitacion
ææT d
,
ææd e
int
ææf i
idEstablecimiento
ææj {
,
ææ{ |
intææ} Ä#
idHabitacionExcluirææÅ î
)ææî ï
{
øø 	
try
¿¿ 
{
¡¡ 
return
¬¬ 
_db
¬¬ 
.
¬¬ 
Actor_negocio
¬¬ (
.
¬¬( )
Where
¬¬) .
(
¬¬. /
an
¬¬/ 1
=>
¬¬2 4
an
¬¬5 7
.
¬¬7 8
Actor_negocio2
¬¬8 F
.
¬¬F G$
id_actor_negocio_padre
¬¬G ]
==
¬¬^ `
idEstablecimiento
¬¬a r
&&
¬¬s u
an
¬¬v x
.
¬¬x y
Actor
¬¬y ~
.
¬¬~ )
numero_documento_identidad¬¬ ô
==¬¬ö ú 
codigoHabitacion¬¬ù ≠
&&¬¬Æ ∞
an¬¬± ≥
.¬¬≥ ¥
id¬¬¥ ∂
!=¬¬∑ π#
idHabitacionExcluir¬¬∫ Õ
&&¬¬Œ –
an¬¬— ”
.¬¬” ‘
id_rol¬¬‘ ⁄
==¬¬€ ›
HotelSettings¬¬ﬁ Î
.¬¬Î Ï
Default¬¬Ï Û
.¬¬Û Ù
IdRolHabitacion¬¬Ù É
)¬¬É Ñ
.¬¬Ñ Ö
Any¬¬Ö à
(¬¬à â
)¬¬â ä
;¬¬ä ã
}
√√ 
catch
ƒƒ 
(
ƒƒ 
	Exception
ƒƒ 
e
ƒƒ 
)
ƒƒ 
{
≈≈ 
throw
∆∆ 
new
∆∆ 
DatosException
∆∆ (
(
∆∆( )
$str
∆∆) h
,
∆∆h i
e
∆∆j k
)
∆∆k l
;
∆∆l m
}
«« 
}
»» 	
public
…… 
bool
…… 6
(ExisteHabitacionesVigentesTipoHabitacion
…… <
(
……< =
int
……= @
idTipoHabitacion
……A Q
)
……Q R
{
   	
try
ÀÀ 
{
ÃÃ 
return
ÕÕ 
_db
ÕÕ 
.
ÕÕ 
Actor_negocio
ÕÕ (
.
ÕÕ( )
Where
ÕÕ) .
(
ÕÕ. /
an
ÕÕ/ 1
=>
ÕÕ2 4
an
ÕÕ5 7
.
ÕÕ7 8
id_rol
ÕÕ8 >
==
ÕÕ? A
HotelSettings
ÕÕB O
.
ÕÕO P
Default
ÕÕP W
.
ÕÕW X
IdRolHabitacion
ÕÕX g
&&
ÕÕh j
an
ÕÕk m
.
ÕÕm n
Concepto_negocio
ÕÕn ~
.
ÕÕ~ 
idÕÕ Å
==ÕÕÇ Ñ 
idTipoHabitacionÕÕÖ ï
&&ÕÕñ ò
anÕÕô õ
.ÕÕõ ú

es_vigenteÕÕú ¶
)ÕÕ¶ ß
.ÕÕß ®
AnyÕÕ® ´
(ÕÕ´ ¨
)ÕÕ¨ ≠
;ÕÕ≠ Æ
}
ŒŒ 
catch
œœ 
(
œœ 
	Exception
œœ 
e
œœ 
)
œœ 
{
–– 
throw
““ 
new
““ 
DatosException
““ (
(
““( )
$str
““) U
,
““U V
e
““W X
)
““X Y
;
““Y Z
}
”” 
}
‘‘ 	
public
’’ 
bool
’’ 0
"ExisteHabitacionesVigentesAmbiente
’’ 6
(
’’6 7
int
’’7 :

idAmbiente
’’; E
)
’’E F
{
÷÷ 	
try
◊◊ 
{
ÿÿ 
return
ŸŸ 
_db
ŸŸ 
.
ŸŸ 
Actor_negocio
ŸŸ (
.
ŸŸ( )
Where
ŸŸ) .
(
ŸŸ. /
an
ŸŸ/ 1
=>
ŸŸ2 4
an
ŸŸ5 7
.
ŸŸ7 8
id_rol
ŸŸ8 >
==
ŸŸ? A
HotelSettings
ŸŸB O
.
ŸŸO P
Default
ŸŸP W
.
ŸŸW X
IdRolHabitacion
ŸŸX g
&&
ŸŸh j
an
ŸŸk m
.
ŸŸm n
Actor_negocio2
ŸŸn |
.
ŸŸ| }
id
ŸŸ} 
==ŸŸÄ Ç

idAmbienteŸŸÉ ç
&&ŸŸé ê
anŸŸë ì
.ŸŸì î

es_vigenteŸŸî û
)ŸŸû ü
.ŸŸü †
AnyŸŸ† £
(ŸŸ£ §
)ŸŸ§ •
;ŸŸ• ¶
}
⁄⁄ 
catch
€€ 
(
€€ 
	Exception
€€ 
e
€€ 
)
€€ 
{
‹‹ 
throw
ﬁﬁ 
new
ﬁﬁ 
DatosException
ﬁﬁ (
(
ﬁﬁ( )
$str
ﬁﬁ) U
,
ﬁﬁU V
e
ﬁﬁW X
)
ﬁﬁX Y
;
ﬁﬁY Z
}
ﬂﬂ 
}
‡‡ 	
public
·· 
bool
·· (
ExisteAtencionesHabitacion
·· .
(
··. /
int
··/ 2
idHabitacion
··3 ?
)
··? @
{
‚‚ 	
try
„„ 
{
‰‰ 
return
ÂÂ 
_db
ÂÂ 
.
ÂÂ 
Transaccion
ÂÂ &
.
ÂÂ& '
Where
ÂÂ' ,
(
ÂÂ, -
t
ÂÂ- .
=>
ÂÂ/ 1
t
ÂÂ2 3
.
ÂÂ3 4!
id_tipo_transaccion
ÂÂ4 G
==
ÂÂH J
HotelSettings
ÂÂK X
.
ÂÂX Y
Default
ÂÂY `
.
ÂÂ` a4
%IdTipoTransaccionAtencionDeHabitacionÂÂa Ü
&&ÂÂá â
tÂÂä ã
.ÂÂã å(
id_actor_negocio_internoÂÂå §
==ÂÂ• ß
idHabitacionÂÂ® ¥
&&ÂÂµ ∑
(ÂÂ∏ π
tÂÂπ ∫
.ÂÂ∫ ª 
id_estado_actualÂÂª À
!=ÂÂÃ Œ
MaestroSettingsÂÂœ ﬁ
.ÂÂﬁ ﬂ
DefaultÂÂﬂ Ê
.ÂÂÊ Á-
IdDetalleMaestroEstadoAnuladoÂÂÁ Ñ
||ÂÂÖ á
tÂÂà â
.ÂÂâ ä 
id_estado_actualÂÂä ö
!=ÂÂõ ù
MaestroSettingsÂÂû ≠
.ÂÂ≠ Æ
DefaultÂÂÆ µ
.ÂÂµ ∂0
 IdDetalleMaestroEstadoCheckedOutÂÂ∂ ÷
||ÂÂ◊ Ÿ
tÂÂ⁄ €
.ÂÂ€ ‹ 
id_estado_actualÂÂ‹ Ï
!=ÂÂÌ Ô
MaestroSettingsÂÂ ˇ
.ÂÂˇ Ä
DefaultÂÂÄ á
.ÂÂá à4
$IdDetalleMaestroEstadoSalidaCambiadoÂÂà ¨
)ÂÂ¨ ≠
)ÂÂ≠ Æ
.ÂÂÆ Ø
AnyÂÂØ ≤
(ÂÂ≤ ≥
)ÂÂ≥ ¥
;ÂÂ¥ µ
}
ÊÊ 
catch
ÁÁ 
(
ÁÁ 
	Exception
ÁÁ 
e
ÁÁ 
)
ÁÁ 
{
ËË 
throw
ÈÈ 
new
ÈÈ 
DatosException
ÈÈ (
(
ÈÈ( )
$str
ÈÈ) `
,
ÈÈ` a
e
ÈÈb c
)
ÈÈc d
;
ÈÈd e
}
ÍÍ 
}
ÎÎ 	
public
ÏÏ 

Habitacion
ÏÏ 
ObtenerHabitacion
ÏÏ +
(
ÏÏ+ ,
int
ÏÏ, /
id
ÏÏ0 2
)
ÏÏ2 3
{
ÌÌ 	
try
ÓÓ 
{
ÔÔ 
return
 
_db
 
.
 
Actor_negocio
 (
.
( )
Where
) .
(
. /
an
/ 1
=>
2 4
an
5 7
.
7 8
id
8 :
==
; =
id
> @
&&
A C
an
D F
.
F G
id_rol
G M
==
N P
HotelSettings
Q ^
.
^ _
Default
_ f
.
f g
IdRolHabitacion
g v
)
v w
.
w x
Select
x ~
(
~ 
an Å
=>Ç Ñ
newÖ à

Habitacionâ ì
{
ÒÒ 
Id
ÚÚ 
=
ÚÚ 
an
ÚÚ 
.
ÚÚ 
id
ÚÚ 
,
ÚÚ 
IdActor
ÛÛ 
=
ÛÛ 
an
ÛÛ  
.
ÛÛ  !
id_actor
ÛÛ! )
,
ÛÛ) *
CodigoHabitacion
ÙÙ $
=
ÙÙ% &
an
ÙÙ' )
.
ÙÙ) *
Actor
ÙÙ* /
.
ÙÙ/ 0(
numero_documento_identidad
ÙÙ0 J
,
ÙÙJ K
Ambiente
ıı 
=
ıı 
new
ıı "
AmbienteHotel
ıı# 0
{
ˆˆ 
Id
˜˜ 
=
˜˜ 
an
˜˜ 
.
˜˜  
Actor_negocio2
˜˜  .
.
˜˜. /
id
˜˜/ 1
,
˜˜1 2
Nombre
¯¯ 
=
¯¯  
an
¯¯! #
.
¯¯# $
Actor_negocio2
¯¯$ 2
.
¯¯2 3
Actor
¯¯3 8
.
¯¯8 9
primer_nombre
¯¯9 F
,
¯¯F G
Establecimiento
˘˘ '
=
˘˘( )
new
˘˘* -
ItemGenerico
˘˘. :
{
˙˙ 
Id
˚˚ 
=
˚˚  
an
˚˚! #
.
˚˚# $
Actor_negocio2
˚˚$ 2
.
˚˚2 3
Actor_negocio2
˚˚3 A
.
˚˚A B
id
˚˚B D
,
˚˚D E
Nombre
¸¸ "
=
¸¸# $
an
¸¸% '
.
¸¸' (
Actor_negocio2
¸¸( 6
.
¸¸6 7
Actor_negocio2
¸¸7 E
.
¸¸E F
Actor
¸¸F K
.
¸¸K L
primer_nombre
¸¸L Y
}
˝˝ 
}
˛˛ 
,
˛˛ 
TipoHabitacion
ˇˇ "
=
ˇˇ# $
new
ˇˇ% ()
Concepto_Negocio_Comercial_
ˇˇ) D
{
ÄÄ 
Id
ÅÅ 
=
ÅÅ 
an
ÅÅ 
.
ÅÅ  
Concepto_negocio
ÅÅ  0
.
ÅÅ0 1
id
ÅÅ1 3
,
ÅÅ3 4
Nombre
ÇÇ 
=
ÇÇ  
an
ÇÇ! #
.
ÇÇ# $
Concepto_negocio
ÇÇ$ 4
.
ÇÇ4 5
sufijo
ÇÇ5 ;
}
ÉÉ 
,
ÉÉ 
InformacionCamas
ÑÑ $
=
ÑÑ% &
an
ÑÑ' )
.
ÑÑ) *
Actor
ÑÑ* /
.
ÑÑ/ 0
segundo_nombre
ÑÑ0 >
,
ÑÑ> ?
Anexo
ÜÜ 
=
ÜÜ 
an
ÜÜ 
.
ÜÜ 
Actor
ÜÜ $
.
ÜÜ$ %
telefono
ÜÜ% -
,
ÜÜ- .
	EsVigente
áá 
=
áá 
an
áá  "
.
áá" #

es_vigente
áá# -
}
ââ 
)
ââ 
.
ââ 
SingleOrDefault
ââ "
(
ââ" #
)
ââ# $
;
ââ$ %
}
ãã 
catch
åå 
(
åå 
	Exception
åå 
e
åå 
)
åå 
{
çç 
throw
èè 
new
èè 
DatosException
èè (
(
èè( )
$str
èè) P
,
èèP Q
e
èèR S
)
èèS T
;
èèT U
}
êê 
}
ëë 	
public
ìì 
IEnumerable
ìì 
<
ìì 
HabitacionBandeja
ìì ,
>
ìì, -(
ObtenerHabitacionesBandeja
ìì. H
(
ììH I
int
ììI L
idestablecimiento
ììM ^
)
ìì^ _
{
îî 	
try
ïï 
{
ññ 
return
óó 
_db
óó 
.
óó 
Actor_negocio
óó (
.
óó( )
Where
óó) .
(
óó. /
an
óó/ 1
=>
óó2 4
an
óó5 7
.
óó7 8
id_rol
óó8 >
==
óó? A
HotelSettings
óóB O
.
óóO P
Default
óóP W
.
óóW X
IdRolHabitacion
óóX g
&&
óóh j
an
óók m
.
óóm n
Actor_negocio2
óón |
.
óó| }
Actor_negocio2óó} ã
.óóã å
idóóå é
==óóè ë!
idestablecimientoóóí £
)óó£ §
.óó§ •
Selectóó• ´
(óó´ ¨
anóó¨ Æ
=>óóØ ±
newóó≤ µ!
HabitacionBandejaóó∂ «
(óó« »
)óó» …
{
òò 
Id
ôô 
=
ôô 
an
ôô 
.
ôô 
id
ôô 
,
ôô 
CodigoHabitacion
öö $
=
öö% &
an
öö' )
.
öö) *
Actor
öö* /
.
öö/ 0(
numero_documento_identidad
öö0 J
,
ööJ K
Ambiente
õõ 
=
õõ 
an
õõ !
.
õõ! "
Actor_negocio2
õõ" 0
.
õõ0 1
Actor
õõ1 6
.
õõ6 7
primer_nombre
õõ7 D
,
õõD E
TipoHabitacion
úú "
=
úú# $
an
úú% '
.
úú' (
Concepto_negocio
úú( 8
.
úú8 9
sufijo
úú9 ?
,
úú? @
Camas
ùù 
=
ùù 
an
ùù 
.
ùù 
Actor
ùù $
.
ùù$ %
segundo_nombre
ùù% 3
,
ùù3 4
Aforo
ûû 
=
ûû 
an
ûû 
.
ûû 
Actor
ûû $
.
ûû$ %(
informacion_multiproposito
ûû% ?
,
ûû? @
AnexoTelefono
üü !
=
üü" #
an
üü$ &
.
üü& '
Actor
üü' ,
.
üü, -
telefono
üü- 5
,
üü5 6
	EsVigente
†† 
=
†† 
an
††  "
.
††" #

es_vigente
††# -
}
°° 
)
°° 
;
°° 
}
££ 
catch
§§ 
(
§§ 
	Exception
§§ 
e
§§ 
)
§§ 
{
•• 
throw
ßß 
new
ßß 
DatosException
ßß (
(
ßß( )
$str
ßß) R
,
ßßR S
e
ßßT U
)
ßßU V
;
ßßV W
}
®® 
}
™™ 	
public
¨¨ 
IEnumerable
¨¨ 
<
¨¨ 

Habitacion
¨¨ %
>
¨¨% &*
ObtenerHabitacionDisponibles
¨¨' C
(
¨¨C D
int
¨¨D G
idTipoHabitacion
¨¨H X
,
¨¨X Y
DateTime
¨¨Z b

fechaDesde
¨¨c m
,
¨¨m n
DateTime
¨¨o w

fechaHasta¨¨x Ç
,¨¨Ç É
int¨¨Ñ á

idAmbiente¨¨à í
,¨¨í ì
int¨¨î ó-
idActorNegocioQueTienePrecios¨¨ò µ
)¨¨µ ∂
{
≠≠ 	
try
ÆÆ 
{
ØØ 
return
∞∞ 
_db
∞∞ 
.
∞∞ 
Actor_negocio
∞∞ (
.
∞∞( )
Where
∞∞) .
(
∞∞. /
an
∞∞/ 1
=>
∞∞2 4
an
∞∞5 7
.
∞∞7 8!
id_concepto_negocio
∞∞8 K
==
∞∞L N
idTipoHabitacion
∞∞O _
&&
∞∞` b
an
∞∞c e
.
∞∞e f$
id_actor_negocio_padre
∞∞f |
==
∞∞} 

idAmbiente∞∞Ä ä
&&∞∞ã ç
an∞∞é ê
.∞∞ê ë

es_vigente∞∞ë õ
)∞∞õ ú
.∞∞ú ù
Except∞∞ù £
(∞∞£ §
_db∞∞§ ß
.∞∞ß ®
Transaccion∞∞® ≥
.∞∞≥ ¥
Where∞∞¥ π
(∞∞π ∫
t∞∞∫ ª
=>∞∞º æ
t∞∞ø ¿
.∞∞¿ ¡#
id_tipo_transaccion∞∞¡ ‘
==∞∞’ ◊
HotelSettings∞∞ÿ Â
.∞∞Â Ê
Default∞∞Ê Ì
.∞∞Ì Ó5
%IdTipoTransaccionAtencionDeHabitacion∞∞Ó ì
&&∞∞î ñ
t∞∞ó ò
.∞∞ò ô 
id_estado_actual∞∞ô ©
!=∞∞™ ¨
MaestroSettings∞∞≠ º
.∞∞º Ω
Default∞∞Ω ƒ
.∞∞ƒ ≈-
IdDetalleMaestroEstadoAnulado∞∞≈ ‚
&&∞∞„ Â
t∞∞Ê Á
.∞∞Á Ë 
id_estado_actual∞∞Ë ¯
!=∞∞˘ ˚
MaestroSettings∞∞¸ ã
.∞∞ã å
Default∞∞å ì
.∞∞ì î0
 IdDetalleMaestroEstadoCheckedOut∞∞î ¥
&&∞∞µ ∑
t∞∞∏ π
.∞∞π ∫ 
id_estado_actual∞∞∫  
!=∞∞À Õ
MaestroSettings∞∞Œ ›
.∞∞› ﬁ
Default∞∞ﬁ Â
.∞∞Â Ê4
$IdDetalleMaestroEstadoSalidaCambiado∞∞Ê ä
&&∞∞ã ç
(∞∞é è
(∞∞è ê
t∞∞ê ë
.∞∞ë í
	fecha_fin∞∞í õ
>∞∞ú ù

fechaDesde∞∞û ®
&&∞∞© ´
t∞∞¨ ≠
.∞∞≠ Æ
fecha_inicio∞∞Æ ∫
<∞∞ª º

fechaHasta∞∞Ω «
)∞∞« »
&&∞∞… À
(∞∞Ã Õ
(∞∞Õ Œ
t∞∞Œ œ
.∞∞œ –
fecha_inicio∞∞– ‹
>=∞∞› ﬂ

fechaDesde∞∞‡ Í
&&∞∞Î Ì
t∞∞Ó Ô
.∞∞Ô 
	fecha_fin∞∞ ˘
<=∞∞˙ ¸

fechaHasta∞∞˝ á
)∞∞á à
||∞∞â ã
(∞∞å ç
t∞∞ç é
.∞∞é è
fecha_inicio∞∞è õ
>=∞∞ú û

fechaDesde∞∞ü ©
&&∞∞™ ¨
t∞∞≠ Æ
.∞∞Æ Ø
	fecha_fin∞∞Ø ∏
>=∞∞π ª

fechaHasta∞∞º ∆
)∞∞∆ «
||∞∞»  
(∞∞À Ã
t∞∞Ã Õ
.∞∞Õ Œ
fecha_inicio∞∞Œ ⁄
<=∞∞€ ›

fechaDesde∞∞ﬁ Ë
&&∞∞È Î
t∞∞Ï Ì
.∞∞Ì Ó
	fecha_fin∞∞Ó ˜
<=∞∞¯ ˙

fechaHasta∞∞˚ Ö
)∞∞Ö Ü
||∞∞á â
(∞∞ä ã
t∞∞ã å
.∞∞å ç
fecha_inicio∞∞ç ô
<=∞∞ö ú

fechaDesde∞∞ù ß
&&∞∞® ™
t∞∞´ ¨
.∞∞¨ ≠
	fecha_fin∞∞≠ ∂
>=∞∞∑ π

fechaHasta∞∞∫ ƒ
)∞∞ƒ ≈
)∞∞≈ ∆
)∞∞∆ «
)∞∞« »
.∞∞» …
Select∞∞… œ
(∞∞œ –
t∞∞– —
=>∞∞“ ‘
t∞∞’ ÷
.∞∞÷ ◊
Actor_negocio2∞∞◊ Â
)∞∞Â Ê
.∞∞Ê Á
Where∞∞Á Ï
(∞∞Ï Ì
an∞∞Ì Ô
=>∞∞ Ú
an∞∞Û ı
.∞∞ı ˆ#
id_concepto_negocio∞∞ˆ â
==∞∞ä å 
idTipoHabitacion∞∞ç ù
&&∞∞û †
an∞∞° £
.∞∞£ §&
id_actor_negocio_padre∞∞§ ∫
==∞∞ª Ω

idAmbiente∞∞æ »
)∞∞» …
.∞∞…  
Distinct∞∞  “
(∞∞“ ”
)∞∞” ‘
)∞∞‘ ’
.∞∞’ ÷
Select∞∞÷ ‹
(∞∞‹ ›
an∞∞› ﬂ
=>∞∞‡ ‚
new∞∞„ Ê

Habitacion∞∞Á Ò
(∞∞Ò Ú
)∞∞Ú Û
{
±± 
Id
≤≤ 
=
≤≤ 
an
≤≤ 
.
≤≤ 
id
≤≤ 
,
≤≤ 
IdActor
≥≥ 
=
≥≥ 
an
≥≥  
.
≥≥  !
id_actor
≥≥! )
,
≥≥) *
CodigoHabitacion
¥¥ $
=
¥¥% &
an
¥¥' )
.
¥¥) *
Actor
¥¥* /
.
¥¥/ 0(
numero_documento_identidad
¥¥0 J
,
¥¥J K
Ambiente
µµ 
=
µµ 
new
µµ "
AmbienteHotel
µµ# 0
{
∂∂ 
Id
∑∑ 
=
∑∑ 
an
∑∑ 
.
∑∑  
Actor_negocio2
∑∑  .
.
∑∑. /
id
∑∑/ 1
,
∑∑1 2
Nombre
∏∏ 
=
∏∏  
an
∏∏! #
.
∏∏# $
Actor_negocio2
∏∏$ 2
.
∏∏2 3
Actor
∏∏3 8
.
∏∏8 9
primer_nombre
∏∏9 F
,
∏∏F G
}
ππ 
,
ππ 
TipoHabitacion
∫∫ "
=
∫∫# $
new
∫∫% ()
Concepto_Negocio_Comercial_
∫∫) D
{
ªª 
Id
ºº 
=
ºº 
an
ºº 
.
ºº  
Concepto_negocio
ºº  0
.
ºº0 1
id
ºº1 3
,
ºº3 4
Nombre
ΩΩ 
=
ΩΩ  
an
ΩΩ! #
.
ΩΩ# $
Concepto_negocio
ΩΩ$ 4
.
ΩΩ4 5
sufijo
ΩΩ5 ;
,
ΩΩ; <
Precios
ææ 
=
ææ  !
an
ææ" $
.
ææ$ %
Concepto_negocio
ææ% 5
.
ææ5 6
Precio1
ææ6 =
.
ææ= >
Where
ææ> C
(
ææC D
p
ææD E
=>
ææF H
p
ææI J
.
ææJ K
id_actor_negocio
ææK [
==
ææ\ ^+
idActorNegocioQueTienePrecios
ææ_ |
&&
ææ} 
pææÄ Å
.ææÅ Ç

es_vigenteææÇ å
)ææå ç
.
øø8 9
Select
øø9 ?
(
øø? @
p
øø@ A
=>
øøB D
new
øøE H/
!Precio_Concepto_Negocio_Comercial
øøI j
(
øøj k
)
øøk l
{
¿¿8 9
Id
¡¡< >
=
¡¡? @
p
¡¡A B
.
¡¡B C
id
¡¡C E
,
¡¡E F
IdTarifa
¬¬< D
=
¬¬E F
p
¬¬G H
.
¬¬H I
id_tarifa_d
¬¬I T
,
¬¬T U
Tarifa
√√< B
=
√√C D
p
√√E F
.
√√F G
Detalle_maestro3
√√G W
.
√√W X
nombre
√√X ^
,
√√^ _
Valor
ƒƒ< A
=
ƒƒB C
p
ƒƒD E
.
ƒƒE F
valor
ƒƒF K
,
ƒƒK L
Codigo
≈≈< B
=
≈≈C D
p
≈≈E F
.
≈≈F G
Detalle_maestro3
≈≈G W
.
≈≈W X
codigo
≈≈X ^
}
∆∆8 9
)
∆∆9 :
,
∆∆: ;
}
«« 
,
«« 
InformacionCamas
»» $
=
»»% &
an
»»' )
.
»») *
Actor
»»* /
.
»»/ 0
segundo_nombre
»»0 >
,
»»> ?
InformacionAforo
…… $
=
……% &
$str
……' 1
+
……2 3
an
……4 6
.
……6 7
Concepto_negocio
……7 G
.
……G H3
%Valor_caracteristica_concepto_negocio
……H m
.
……m n
FirstOrDefault
……n |
(
……| }
v
……} ~
=>…… Å
v……Ç É
.……É Ñ$
Valor_caracteristica……Ñ ò
.……ò ô!
id_caracteristica……ô ™
==……´ ≠
HotelSettings……Æ ª
.……ª º
Default……º √
.……√ ƒ,
IdCaracteristicaAforoAdultos……ƒ ‡
)……‡ ·
.……· ‚$
Valor_caracteristica……‚ ˆ
.……ˆ ˜
valor……˜ ¸
+……˝ ˛
$str……ˇ ã
+……å ç
an……é ê
.……ê ë 
Concepto_negocio……ë °
.……° ¢5
%Valor_caracteristica_concepto_negocio……¢ «
.……« »
FirstOrDefault……» ÷
(……÷ ◊
v……◊ ÿ
=>……Ÿ €
v……‹ ›
.……› ﬁ$
Valor_caracteristica……ﬁ Ú
.……Ú Û!
id_caracteristica……Û Ñ
==……Ö á
HotelSettings……à ï
.……ï ñ
Default……ñ ù
.……ù û*
IdCaracteristicaAforoNinos……û ∏
)……∏ π
.……π ∫$
Valor_caracteristica……∫ Œ
.……Œ œ
valor……œ ‘
,……‘ ’
Anexo
   
=
   
an
   
.
   
Actor
   $
.
  $ %
telefono
  % -
,
  - .
	EsVigente
ÀÀ 
=
ÀÀ 
an
ÀÀ  "
.
ÀÀ" #

es_vigente
ÀÀ# -
}
ÃÃ 
)
ÃÃ 
;
ÃÃ 
}
ÕÕ 
catch
ŒŒ 
(
ŒŒ 
	Exception
ŒŒ 
e
ŒŒ 
)
ŒŒ 
{
œœ 
throw
–– 
new
–– 
DatosException
–– (
(
––( )
$str
––) `
,
––` a
e
––b c
)
––c d
;
––d e
}
—— 
}
““ 	
public
”” 
bool
”” -
ObtenerDisponibilidadHabitacion
”” 3
(
””3 4
long
””4 8
idAtencionAEvitar
””9 J
,
””J K
int
””L O
idHabitacion
””P \
,
””\ ]
DateTime
””^ f

fechaDesde
””g q
,
””q r
DateTime
””s {

fechaHasta””| Ü
)””Ü á
{
‘‘ 	
try
’’ 
{
÷÷ 
return
◊◊ 
_db
◊◊ 
.
◊◊ 
Actor_negocio
◊◊ (
.
◊◊( )
Where
◊◊) .
(
◊◊. /
an
◊◊/ 1
=>
◊◊2 4
an
◊◊5 7
.
◊◊7 8
id
◊◊8 :
==
◊◊; =
idHabitacion
◊◊> J
&&
◊◊K M
an
◊◊N P
.
◊◊P Q

es_vigente
◊◊Q [
)
◊◊[ \
.
◊◊\ ]
Except
◊◊] c
(
◊◊c d
_db
◊◊d g
.
◊◊g h
Transaccion
◊◊h s
.
◊◊s t
Where
◊◊t y
(
◊◊y z
t
◊◊z {
=>
◊◊| ~
t◊◊ Ä
.◊◊Ä Å#
id_tipo_transaccion◊◊Å î
==◊◊ï ó
HotelSettings◊◊ò •
.◊◊• ¶
Default◊◊¶ ≠
.◊◊≠ Æ5
%IdTipoTransaccionAtencionDeHabitacion◊◊Æ ”
&&◊◊‘ ÷
t◊◊◊ ÿ
.◊◊ÿ Ÿ 
id_estado_actual◊◊Ÿ È
!=◊◊Í Ï
MaestroSettings◊◊Ì ¸
.◊◊¸ ˝
Default◊◊˝ Ñ
.◊◊Ñ Ö-
IdDetalleMaestroEstadoAnulado◊◊Ö ¢
&&◊◊£ •
t◊◊¶ ß
.◊◊ß ® 
id_estado_actual◊◊® ∏
!=◊◊π ª
MaestroSettings◊◊º À
.◊◊À Ã
Default◊◊Ã ”
.◊◊” ‘0
 IdDetalleMaestroEstadoCheckedOut◊◊‘ Ù
&&◊◊ı ˜
t◊◊¯ ˘
.◊◊˘ ˙
id◊◊˙ ¸
!=◊◊˝ ˇ!
idAtencionAEvitar◊◊Ä ë
&&◊◊í î
(◊◊ï ñ
(◊◊ñ ó
t◊◊ó ò
.◊◊ò ô
	fecha_fin◊◊ô ¢
>◊◊£ §

fechaDesde◊◊• Ø
&&◊◊∞ ≤
t◊◊≥ ¥
.◊◊¥ µ
fecha_inicio◊◊µ ¡
<◊◊¬ √

fechaHasta◊◊ƒ Œ
)◊◊Œ œ
&&◊◊– “
(◊◊” ‘
(◊◊‘ ’
t◊◊’ ÷
.◊◊÷ ◊
fecha_inicio◊◊◊ „
>=◊◊‰ Ê

fechaDesde◊◊Á Ò
&&◊◊Ú Ù
t◊◊ı ˆ
.◊◊ˆ ˜
	fecha_fin◊◊˜ Ä
<=◊◊Å É

fechaHasta◊◊Ñ é
)◊◊é è
||◊◊ê í
(◊◊ì î
t◊◊î ï
.◊◊ï ñ
fecha_inicio◊◊ñ ¢
>=◊◊£ •

fechaDesde◊◊¶ ∞
&&◊◊± ≥
t◊◊¥ µ
.◊◊µ ∂
	fecha_fin◊◊∂ ø
>=◊◊¿ ¬

fechaHasta◊◊√ Õ
)◊◊Õ Œ
||◊◊œ —
(◊◊“ ”
t◊◊” ‘
.◊◊‘ ’
fecha_inicio◊◊’ ·
<=◊◊‚ ‰

fechaDesde◊◊Â Ô
&&◊◊ Ú
t◊◊Û Ù
.◊◊Ù ı
	fecha_fin◊◊ı ˛
<=◊◊ˇ Å

fechaHasta◊◊Ç å
)◊◊å ç
||◊◊é ê
(◊◊ë í
t◊◊í ì
.◊◊ì î
fecha_inicio◊◊î †
<=◊◊° £

fechaDesde◊◊§ Æ
&&◊◊Ø ±
t◊◊≤ ≥
.◊◊≥ ¥
	fecha_fin◊◊¥ Ω
>=◊◊æ ¿

fechaHasta◊◊¡ À
)◊◊À Ã
)◊◊Ã Õ
)◊◊Õ Œ
)◊◊Œ œ
.◊◊œ –
Select◊◊– ÷
(◊◊÷ ◊
t◊◊◊ ÿ
=>◊◊Ÿ €
t◊◊‹ ›
.◊◊› ﬁ
Actor_negocio2◊◊ﬁ Ï
)◊◊Ï Ì
.◊◊Ì Ó
Where◊◊Ó Û
(◊◊Û Ù
an◊◊Ù ˆ
=>◊◊˜ ˘
an◊◊˙ ¸
.◊◊¸ ˝
id◊◊˝ ˇ
==◊◊Ä Ç
idHabitacion◊◊É è
)◊◊è ê
.◊◊ê ë
Distinct◊◊ë ô
(◊◊ô ö
)◊◊ö õ
)◊◊õ ú
.◊◊ú ù
Any◊◊ù †
(◊◊† °
)◊◊° ¢
;◊◊¢ £
}
ÿÿ 
catch
ŸŸ 
(
ŸŸ 
	Exception
ŸŸ 
e
ŸŸ 
)
ŸŸ 
{
⁄⁄ 
throw
€€ 
new
€€ 
DatosException
€€ (
(
€€( )
$str
€€) `
,
€€` a
e
€€b c
)
€€c d
;
€€d e
}
‹‹ 
}
›› 	
public
ﬁﬁ 
IEnumerable
ﬁﬁ 
<
ﬁﬁ 

Habitacion
ﬁﬁ %
>
ﬁﬁ% &E
7ObtenerHabitacionDisponiblesPorEstablecimientoConPrecio
ﬁﬁ' ^
(
ﬁﬁ^ _
int
ﬁﬁ_ b
idTipoHabitacion
ﬁﬁc s
,
ﬁﬁs t
DateTime
ﬁﬁu }

fechaDesdeﬁﬁ~ à
,ﬁﬁà â
DateTimeﬁﬁä í

fechaHastaﬁﬁì ù
,ﬁﬁù û
intﬁﬁü ¢!
idEstablecimientoﬁﬁ£ ¥
,ﬁﬁ¥ µ
intﬁﬁ∂ π-
idActorNegocioQueTienePreciosﬁﬁ∫ ◊
)ﬁﬁ◊ ÿ
{
ﬂﬂ 	
try
‡‡ 
{
·· 
return
‚‚ 
_db
‚‚ 
.
‚‚ 
Actor_negocio
‚‚ (
.
‚‚( )
Where
‚‚) .
(
‚‚. /
an
‚‚/ 1
=>
‚‚2 4
an
‚‚5 7
.
‚‚7 8!
id_concepto_negocio
‚‚8 K
==
‚‚L N
idTipoHabitacion
‚‚O _
&&
‚‚` b
an
‚‚c e
.
‚‚e f
Actor_negocio2
‚‚f t
.
‚‚t u%
id_actor_negocio_padre‚‚u ã
==‚‚å é!
idEstablecimiento‚‚è †
&&‚‚° £
an‚‚§ ¶
.‚‚¶ ß

es_vigente‚‚ß ±
)‚‚± ≤
.‚‚≤ ≥
Except‚‚≥ π
(‚‚π ∫
_db‚‚∫ Ω
.‚‚Ω æ
Transaccion‚‚æ …
.‚‚…  
Where‚‚  œ
(‚‚œ –
t‚‚– —
=>‚‚“ ‘
t‚‚’ ÷
.‚‚÷ ◊#
id_tipo_transaccion‚‚◊ Í
==‚‚Î Ì
HotelSettings‚‚Ó ˚
.‚‚˚ ¸
Default‚‚¸ É
.‚‚É Ñ5
%IdTipoTransaccionAtencionDeHabitacion‚‚Ñ ©
&&‚‚™ ¨
t‚‚≠ Æ
.‚‚Æ Ø 
id_estado_actual‚‚Ø ø
!=‚‚¿ ¬
MaestroSettings‚‚√ “
.‚‚“ ”
Default‚‚” ⁄
.‚‚⁄ €-
IdDetalleMaestroEstadoAnulado‚‚€ ¯
&&‚‚˘ ˚
t‚‚¸ ˝
.‚‚˝ ˛ 
id_estado_actual‚‚˛ é
!=‚‚è ë
MaestroSettings‚‚í °
.‚‚° ¢
Default‚‚¢ ©
.‚‚© ™0
 IdDetalleMaestroEstadoCheckedOut‚‚™  
&&‚‚À Õ
(‚‚Œ œ
(‚‚œ –
t‚‚– —
.‚‚— “
	fecha_fin‚‚“ €
>‚‚‹ ›

fechaDesde‚‚ﬁ Ë
&&‚‚È Î
t‚‚Ï Ì
.‚‚Ì Ó
fecha_inicio‚‚Ó ˙
<‚‚˚ ¸

fechaHasta‚‚˝ á
)‚‚á à
&&‚‚â ã
(‚‚å ç
(‚‚ç é
t‚‚é è
.‚‚è ê
fecha_inicio‚‚ê ú
>=‚‚ù ü

fechaDesde‚‚† ™
&&‚‚´ ≠
t‚‚Æ Ø
.‚‚Ø ∞
	fecha_fin‚‚∞ π
<=‚‚∫ º

fechaHasta‚‚Ω «
)‚‚« »
||‚‚… À
(‚‚Ã Õ
t‚‚Õ Œ
.‚‚Œ œ
fecha_inicio‚‚œ €
>=‚‚‹ ﬁ

fechaDesde‚‚ﬂ È
&&‚‚Í Ï
t‚‚Ì Ó
.‚‚Ó Ô
	fecha_fin‚‚Ô ¯
>=‚‚˘ ˚

fechaHasta‚‚¸ Ü
)‚‚Ü á
||‚‚à ä
(‚‚ã å
t‚‚å ç
.‚‚ç é
fecha_inicio‚‚é ö
<=‚‚õ ù

fechaDesde‚‚û ®
&&‚‚© ´
t‚‚¨ ≠
.‚‚≠ Æ
	fecha_fin‚‚Æ ∑
<=‚‚∏ ∫

fechaHasta‚‚ª ≈
)‚‚≈ ∆
||‚‚« …
(‚‚  À
t‚‚À Ã
.‚‚Ã Õ
fecha_inicio‚‚Õ Ÿ
<=‚‚⁄ ‹

fechaDesde‚‚› Á
&&‚‚Ë Í
t‚‚Î Ï
.‚‚Ï Ì
	fecha_fin‚‚Ì ˆ
>=‚‚˜ ˘

fechaHasta‚‚˙ Ñ
)‚‚Ñ Ö
)‚‚Ö Ü
)‚‚Ü á
)‚‚á à
.‚‚à â
Select‚‚â è
(‚‚è ê
t‚‚ê ë
=>‚‚í î
t‚‚ï ñ
.‚‚ñ ó
Actor_negocio2‚‚ó •
)‚‚• ¶
.‚‚¶ ß
Where‚‚ß ¨
(‚‚¨ ≠
an‚‚≠ Ø
=>‚‚∞ ≤
an‚‚≥ µ
.‚‚µ ∂#
id_concepto_negocio‚‚∂ …
==‚‚  Ã 
idTipoHabitacion‚‚Õ ›
&&‚‚ﬁ ‡
an‚‚· „
.‚‚„ ‰
Actor_negocio2‚‚‰ Ú
.‚‚Ú Û&
id_actor_negocio_padre‚‚Û â
==‚‚ä å!
idEstablecimiento‚‚ç û
)‚‚û ü
.‚‚ü †
Distinct‚‚† ®
(‚‚® ©
)‚‚© ™
)‚‚™ ´
.‚‚´ ¨
Select‚‚¨ ≤
(‚‚≤ ≥
an‚‚≥ µ
=>‚‚∂ ∏
new‚‚π º

Habitacion‚‚Ω «
(‚‚« »
)‚‚» …
{
„„ 
Id
‰‰ 
=
‰‰ 
an
‰‰ 
.
‰‰ 
id
‰‰ 
,
‰‰ 
IdActor
ÂÂ 
=
ÂÂ 
an
ÂÂ  
.
ÂÂ  !
id_actor
ÂÂ! )
,
ÂÂ) *
CodigoHabitacion
ÊÊ $
=
ÊÊ% &
an
ÊÊ' )
.
ÊÊ) *
Actor
ÊÊ* /
.
ÊÊ/ 0(
numero_documento_identidad
ÊÊ0 J
,
ÊÊJ K
Ambiente
ÁÁ 
=
ÁÁ 
new
ÁÁ "
AmbienteHotel
ÁÁ# 0
{
ËË 
Id
ÈÈ 
=
ÈÈ 
an
ÈÈ 
.
ÈÈ  
Actor_negocio2
ÈÈ  .
.
ÈÈ. /
id
ÈÈ/ 1
,
ÈÈ1 2
Nombre
ÍÍ 
=
ÍÍ  
an
ÍÍ! #
.
ÍÍ# $
Actor_negocio2
ÍÍ$ 2
.
ÍÍ2 3
Actor
ÍÍ3 8
.
ÍÍ8 9
primer_nombre
ÍÍ9 F
,
ÍÍF G
}
ÎÎ 
,
ÎÎ 
TipoHabitacion
ÏÏ "
=
ÏÏ# $
new
ÏÏ% ()
Concepto_Negocio_Comercial_
ÏÏ) D
{
ÌÌ 
Id
ÓÓ 
=
ÓÓ 
an
ÓÓ 
.
ÓÓ  
Concepto_negocio
ÓÓ  0
.
ÓÓ0 1
id
ÓÓ1 3
,
ÓÓ3 4
Nombre
ÔÔ 
=
ÔÔ  
an
ÔÔ! #
.
ÔÔ# $
Concepto_negocio
ÔÔ$ 4
.
ÔÔ4 5
sufijo
ÔÔ5 ;
,
ÔÔ; <
Precios
 
=
  !
an
" $
.
$ %
Concepto_negocio
% 5
.
5 6
Precio1
6 =
.
= >
Where
> C
(
C D
p
D E
=>
F H
p
I J
.
J K
id_actor_negocio
K [
==
\ ^+
idActorNegocioQueTienePrecios
_ |
&&
} 
pÄ Å
.Å Ç

es_vigenteÇ å
)å ç
.
ÒÒ8 9
Select
ÒÒ9 ?
(
ÒÒ? @
p
ÒÒ@ A
=>
ÒÒB D
new
ÒÒE H/
!Precio_Concepto_Negocio_Comercial
ÒÒI j
(
ÒÒj k
)
ÒÒk l
{
ÚÚ8 9
Id
ÛÛ< >
=
ÛÛ? @
p
ÛÛA B
.
ÛÛB C
id
ÛÛC E
,
ÛÛE F
IdTarifa
ÙÙ< D
=
ÙÙE F
p
ÙÙG H
.
ÙÙH I
id_tarifa_d
ÙÙI T
,
ÙÙT U
Tarifa
ıı< B
=
ııC D
p
ııE F
.
ııF G
Detalle_maestro3
ııG W
.
ııW X
nombre
ııX ^
,
ıı^ _
Valor
ˆˆ< A
=
ˆˆB C
p
ˆˆD E
.
ˆˆE F
valor
ˆˆF K
,
ˆˆK L
Codigo
˜˜< B
=
˜˜C D
p
˜˜E F
.
˜˜F G
Detalle_maestro3
˜˜G W
.
˜˜W X
codigo
˜˜X ^
}
¯¯8 9
)
¯¯9 :
,
¯¯: ;
}
˘˘ 
,
˘˘ 
InformacionCamas
˙˙ $
=
˙˙% &
an
˙˙' )
.
˙˙) *
Actor
˙˙* /
.
˙˙/ 0
segundo_nombre
˙˙0 >
,
˙˙> ?
InformacionAforo
˚˚ $
=
˚˚% &
$str
˚˚' 1
+
˚˚2 3
an
˚˚4 6
.
˚˚6 7
Concepto_negocio
˚˚7 G
.
˚˚G H3
%Valor_caracteristica_concepto_negocio
˚˚H m
.
˚˚m n
FirstOrDefault
˚˚n |
(
˚˚| }
v
˚˚} ~
=>˚˚ Å
v˚˚Ç É
.˚˚É Ñ$
Valor_caracteristica˚˚Ñ ò
.˚˚ò ô!
id_caracteristica˚˚ô ™
==˚˚´ ≠
HotelSettings˚˚Æ ª
.˚˚ª º
Default˚˚º √
.˚˚√ ƒ,
IdCaracteristicaAforoAdultos˚˚ƒ ‡
)˚˚‡ ·
.˚˚· ‚$
Valor_caracteristica˚˚‚ ˆ
.˚˚ˆ ˜
valor˚˚˜ ¸
+˚˚˝ ˛
$str˚˚ˇ ã
+˚˚å ç
an˚˚é ê
.˚˚ê ë 
Concepto_negocio˚˚ë °
.˚˚° ¢5
%Valor_caracteristica_concepto_negocio˚˚¢ «
.˚˚« »
FirstOrDefault˚˚» ÷
(˚˚÷ ◊
v˚˚◊ ÿ
=>˚˚Ÿ €
v˚˚‹ ›
.˚˚› ﬁ$
Valor_caracteristica˚˚ﬁ Ú
.˚˚Ú Û!
id_caracteristica˚˚Û Ñ
==˚˚Ö á
HotelSettings˚˚à ï
.˚˚ï ñ
Default˚˚ñ ù
.˚˚ù û*
IdCaracteristicaAforoNinos˚˚û ∏
)˚˚∏ π
.˚˚π ∫$
Valor_caracteristica˚˚∫ Œ
.˚˚Œ œ
valor˚˚œ ‘
,˚˚‘ ’
Anexo
¸¸ 
=
¸¸ 
an
¸¸ 
.
¸¸ 
Actor
¸¸ $
.
¸¸$ %
telefono
¸¸% -
,
¸¸- .
	EsVigente
˝˝ 
=
˝˝ 
an
˝˝  "
.
˝˝" #

es_vigente
˝˝# -
}
˛˛ 
)
˛˛ 
;
˛˛ 
}
ˇˇ 
catch
ÄÄ 
(
ÄÄ 
	Exception
ÄÄ 
e
ÄÄ 
)
ÄÄ 
{
ÅÅ 
throw
ÇÇ 
new
ÇÇ 
DatosException
ÇÇ (
(
ÇÇ( )
$str
ÇÇ) `
,
ÇÇ` a
e
ÇÇb c
)
ÇÇc d
;
ÇÇd e
}
ÉÉ 
}
ÑÑ 	
public
ÜÜ 
IEnumerable
ÜÜ 
<
ÜÜ 

Habitacion
ÜÜ %
>
ÜÜ% &<
.ObtenerHabitacionDisponiblesPorEstablecimiento
ÜÜ' U
(
ÜÜU V
int
ÜÜV Y
idTipoHabitacion
ÜÜZ j
,
ÜÜj k
DateTime
ÜÜl t

fechaDesde
ÜÜu 
,ÜÜ Ä
DateTimeÜÜÅ â

fechaHastaÜÜä î
,ÜÜî ï
intÜÜñ ô!
idEstablecimientoÜÜö ´
)ÜÜ´ ¨
{
áá 	
try
àà 
{
ââ 
return
ää 
_db
ää 
.
ää 
Actor_negocio
ää (
.
ää( )
Where
ää) .
(
ää. /
an
ää/ 1
=>
ää2 4
an
ää5 7
.
ää7 8!
id_concepto_negocio
ää8 K
==
ääL N
idTipoHabitacion
ääO _
&&
ää` b
an
ääc e
.
ääe f
Actor_negocio2
ääf t
.
äät u%
id_actor_negocio_padreääu ã
==ääå é!
idEstablecimientoääè †
&&ää° £
anää§ ¶
.ää¶ ß

es_vigenteääß ±
)ää± ≤
.ää≤ ≥
Exceptää≥ π
(ääπ ∫
_dbää∫ Ω
.ääΩ æ
Transaccionääæ …
.ää…  
Whereää  œ
(ääœ –
tää– —
=>ää“ ‘
tää’ ÷
.ää÷ ◊#
id_tipo_transaccionää◊ Í
==ääÎ Ì
HotelSettingsääÓ ˚
.ää˚ ¸
Defaultää¸ É
.ääÉ Ñ5
%IdTipoTransaccionAtencionDeHabitacionääÑ ©
&&ää™ ¨
tää≠ Æ
.ääÆ Ø 
id_estado_actualääØ ø
!=ää¿ ¬
MaestroSettingsää√ “
.ää“ ”
Defaultää” ⁄
.ää⁄ €7
'IdDetalleMaestroCodigoEstadoItemAnuladoää€ Ç
&&ääÉ Ö
(ääÜ á
(ääá à
tääà â
.ääâ ä
	fecha_finäää ì
>ääî ï

fechaDesdeääñ †
&&ää° £
tää§ •
.ää• ¶
fecha_inicioää¶ ≤
<ää≥ ¥

fechaHastaääµ ø
)ääø ¿
&&ää¡ √
(ääƒ ≈
(ää≈ ∆
tää∆ «
.ää« »
fecha_inicioää» ‘
>=ää’ ◊

fechaDesdeääÿ ‚
&&ää„ Â
tääÊ Á
.ääÁ Ë
	fecha_finääË Ò
<=ääÚ Ù

fechaHastaääı ˇ
)ääˇ Ä
||ääÅ É
(ääÑ Ö
tääÖ Ü
.ääÜ á
fecha_inicioääá ì
>=ääî ñ

fechaDesdeääó °
&&ää¢ §
tää• ¶
.ää¶ ß
	fecha_finääß ∞
>=ää± ≥

fechaHastaää¥ æ
)ääæ ø
||ää¿ ¬
(ää√ ƒ
tääƒ ≈
.ää≈ ∆
fecha_inicioää∆ “
<=ää” ’

fechaDesdeää÷ ‡
&&ää· „
tää‰ Â
.ääÂ Ê
	fecha_finääÊ Ô
<=ää Ú

fechaHastaääÛ ˝
)ää˝ ˛
||ääˇ Å
(ääÇ É
tääÉ Ñ
.ääÑ Ö
fecha_inicioääÖ ë
<=ääí î

fechaDesdeääï ü
&&ää† ¢
tää£ §
.ää§ •
	fecha_finää• Æ
>=ääØ ±

fechaHastaää≤ º
)ääº Ω
)ääΩ æ
)ääæ ø
)ääø ¿
.ää¿ ¡
Selectää¡ «
(ää« »
tää» …
=>ää  Ã
tääÕ Œ
.ääŒ œ
Actor_negocio2ääœ ›
)ää› ﬁ
.ääﬁ ﬂ
Whereääﬂ ‰
(ää‰ Â
anääÂ Á
=>ääË Í
anääÎ Ì
.ääÌ Ó#
id_concepto_negocioääÓ Å
==ääÇ Ñ 
idTipoHabitacionääÖ ï
&&ääñ ò
anääô õ
.ääõ ú
Actor_negocio2ääú ™
.ää™ ´&
id_actor_negocio_padreää´ ¡
==ää¬ ƒ!
idEstablecimientoää≈ ÷
)ää÷ ◊
.ää◊ ÿ
Distinctääÿ ‡
(ää‡ ·
)ää· ‚
)ää‚ „
.ää„ ‰
Selectää‰ Í
(ääÍ Î
anääÎ Ì
=>ääÓ 
newääÒ Ù

Habitacionääı ˇ
(ääˇ Ä
)ääÄ Å
{
ãã 
Id
åå 
=
åå 
an
åå 
.
åå 
id
åå 
,
åå 
IdActor
çç 
=
çç 
an
çç  
.
çç  !
id_actor
çç! )
,
çç) *
CodigoHabitacion
éé $
=
éé% &
an
éé' )
.
éé) *
Actor
éé* /
.
éé/ 0(
numero_documento_identidad
éé0 J
,
ééJ K
Ambiente
èè 
=
èè 
new
èè "
AmbienteHotel
èè# 0
{
êê 
Id
ëë 
=
ëë 
an
ëë 
.
ëë  
Actor_negocio2
ëë  .
.
ëë. /
id
ëë/ 1
,
ëë1 2
Nombre
íí 
=
íí  
an
íí! #
.
íí# $
Actor_negocio2
íí$ 2
.
íí2 3
Actor
íí3 8
.
íí8 9
primer_nombre
íí9 F
,
ííF G
}
ìì 
,
ìì 
TipoHabitacion
îî "
=
îî# $
new
îî% ()
Concepto_Negocio_Comercial_
îî) D
{
ïï 
Id
ññ 
=
ññ 
an
ññ 
.
ññ  
Concepto_negocio
ññ  0
.
ññ0 1
id
ññ1 3
,
ññ3 4
Nombre
óó 
=
óó  
an
óó! #
.
óó# $
Concepto_negocio
óó$ 4
.
óó4 5
sufijo
óó5 ;
}
òò 
,
òò 
InformacionCamas
ôô $
=
ôô% &
an
ôô' )
.
ôô) *
Actor
ôô* /
.
ôô/ 0
segundo_nombre
ôô0 >
,
ôô> ?
InformacionAforo
öö $
=
öö% &
$str
öö' 1
+
öö2 3
an
öö4 6
.
öö6 7
Concepto_negocio
öö7 G
.
ööG H3
%Valor_caracteristica_concepto_negocio
ööH m
.
ööm n
FirstOrDefault
öön |
(
öö| }
v
öö} ~
=>öö Å
vööÇ É
.ööÉ Ñ$
Valor_caracteristicaööÑ ò
.ööò ô!
id_caracteristicaööô ™
==öö´ ≠
HotelSettingsööÆ ª
.ööª º
Defaultööº √
.öö√ ƒ,
IdCaracteristicaAforoAdultosööƒ ‡
)öö‡ ·
.öö· ‚$
Valor_caracteristicaöö‚ ˆ
.ööˆ ˜
valoröö˜ ¸
+öö˝ ˛
$strööˇ ã
+ööå ç
anööé ê
.ööê ë 
Concepto_negocioööë °
.öö° ¢5
%Valor_caracteristica_concepto_negocioöö¢ «
.öö« »
FirstOrDefaultöö» ÷
(öö÷ ◊
vöö◊ ÿ
=>ööŸ €
vöö‹ ›
.öö› ﬁ$
Valor_caracteristicaööﬁ Ú
.ööÚ Û!
id_caracteristicaööÛ Ñ
==ööÖ á
HotelSettingsööà ï
.ööï ñ
Defaultööñ ù
.ööù û*
IdCaracteristicaAforoNinosööû ∏
)öö∏ π
.ööπ ∫$
Valor_caracteristicaöö∫ Œ
.ööŒ œ
valorööœ ‘
,öö‘ ’
Anexo
õõ 
=
õõ 
an
õõ 
.
õõ 
Actor
õõ $
.
õõ$ %
telefono
õõ% -
,
õõ- .
	EsVigente
úú 
=
úú 
an
úú  "
.
úú" #

es_vigente
úú# -
}
ùù 
)
ùù 
;
ùù 
}
ûû 
catch
üü 
(
üü 
	Exception
üü 
e
üü 
)
üü 
{
†† 
throw
°° 
new
°° 
DatosException
°° (
(
°°( )
$str
°°) `
,
°°` a
e
°°b c
)
°°c d
;
°°d e
}
¢¢ 
}
££ 	
public
´´ 

Habitacion
´´ )
ObtenerHabitacionDisponible
´´ 5
(
´´5 6
int
´´6 9
idHabitacion
´´: F
,
´´F G
int
´´H K+
idActorNegocioQueTienePrecios
´´L i
)
´´i j
{
¨¨ 	
try
≠≠ 
{
ÆÆ 
return
ØØ 
_db
ØØ 
.
ØØ 
Actor_negocio
ØØ (
.
ØØ( )
Where
ØØ) .
(
ØØ. /
an
ØØ/ 1
=>
ØØ2 4
an
ØØ5 7
.
ØØ7 8
id
ØØ8 :
==
ØØ; =
idHabitacion
ØØ> J
&&
ØØK M
an
ØØN P
.
ØØP Q

es_vigente
ØØQ [
)
ØØ[ \
.
ØØ\ ]
Select
ØØ] c
(
ØØc d
an
ØØd f
=>
ØØg i
new
ØØj m

Habitacion
ØØn x
(
ØØx y
)
ØØy z
{
∞∞ 
Id
±± 
=
±± 
an
±± 
.
±± 
id
±± 
,
±± 
IdActor
≤≤ 
=
≤≤ 
an
≤≤  
.
≤≤  !
id_actor
≤≤! )
,
≤≤) *
CodigoHabitacion
≥≥ $
=
≥≥% &
an
≥≥' )
.
≥≥) *
Actor
≥≥* /
.
≥≥/ 0(
numero_documento_identidad
≥≥0 J
,
≥≥J K
Ambiente
¥¥ 
=
¥¥ 
new
¥¥ "
AmbienteHotel
¥¥# 0
{
µµ 
Id
∂∂ 
=
∂∂ 
an
∂∂ 
.
∂∂  
Actor_negocio2
∂∂  .
.
∂∂. /
id
∂∂/ 1
,
∂∂1 2
Nombre
∑∑ 
=
∑∑  
an
∑∑! #
.
∑∑# $
Actor_negocio2
∑∑$ 2
.
∑∑2 3
Actor
∑∑3 8
.
∑∑8 9
primer_nombre
∑∑9 F
,
∑∑F G
}
∏∏ 
,
∏∏ 
TipoHabitacion
ππ "
=
ππ# $
new
ππ% ()
Concepto_Negocio_Comercial_
ππ) D
{
∫∫ 
Id
ªª 
=
ªª 
an
ªª 
.
ªª  
Concepto_negocio
ªª  0
.
ªª0 1
id
ªª1 3
,
ªª3 4
Nombre
ºº 
=
ºº  
an
ºº! #
.
ºº# $
Concepto_negocio
ºº$ 4
.
ºº4 5
sufijo
ºº5 ;
,
ºº; <
Precios
ΩΩ 
=
ΩΩ  !
an
ΩΩ" $
.
ΩΩ$ %
Concepto_negocio
ΩΩ% 5
.
ΩΩ5 6
Precio1
ΩΩ6 =
.
ΩΩ= >
Where
ΩΩ> C
(
ΩΩC D
p
ΩΩD E
=>
ΩΩF H
p
ΩΩI J
.
ΩΩJ K
id_actor_negocio
ΩΩK [
==
ΩΩ\ ^+
idActorNegocioQueTienePrecios
ΩΩ_ |
&&
ΩΩ} 
pΩΩÄ Å
.ΩΩÅ Ç

es_vigenteΩΩÇ å
)ΩΩå ç
.
ææ8 9
Select
ææ9 ?
(
ææ? @
p
ææ@ A
=>
ææB D
new
ææE H/
!Precio_Concepto_Negocio_Comercial
ææI j
(
ææj k
)
ææk l
{
øø8 9
Id
¿¿< >
=
¿¿? @
p
¿¿A B
.
¿¿B C
id
¿¿C E
,
¿¿E F
IdTarifa
¡¡< D
=
¡¡E F
p
¡¡G H
.
¡¡H I
id_tarifa_d
¡¡I T
,
¡¡T U
Tarifa
¬¬< B
=
¬¬C D
p
¬¬E F
.
¬¬F G
Detalle_maestro3
¬¬G W
.
¬¬W X
nombre
¬¬X ^
,
¬¬^ _
Valor
√√< A
=
√√B C
p
√√D E
.
√√E F
valor
√√F K
,
√√K L
Codigo
ƒƒ< B
=
ƒƒC D
p
ƒƒE F
.
ƒƒF G
Detalle_maestro3
ƒƒG W
.
ƒƒW X
codigo
ƒƒX ^
}
≈≈8 9
)
≈≈9 :
,
≈≈: ;
}
∆∆ 
,
∆∆ 
InformacionCamas
«« $
=
««% &
an
««' )
.
««) *
Actor
««* /
.
««/ 0
segundo_nombre
««0 >
,
««> ?
InformacionAforo
»» $
=
»»% &
$str
»»' 1
+
»»2 3
an
»»4 6
.
»»6 7
Concepto_negocio
»»7 G
.
»»G H3
%Valor_caracteristica_concepto_negocio
»»H m
.
»»m n
FirstOrDefault
»»n |
(
»»| }
v
»»} ~
=>»» Å
v»»Ç É
.»»É Ñ$
Valor_caracteristica»»Ñ ò
.»»ò ô!
id_caracteristica»»ô ™
==»»´ ≠
HotelSettings»»Æ ª
.»»ª º
Default»»º √
.»»√ ƒ,
IdCaracteristicaAforoAdultos»»ƒ ‡
)»»‡ ·
.»»· ‚$
Valor_caracteristica»»‚ ˆ
.»»ˆ ˜
valor»»˜ ¸
+»»˝ ˛
$str»»ˇ ã
+»»å ç
an»»é ê
.»»ê ë 
Concepto_negocio»»ë °
.»»° ¢5
%Valor_caracteristica_concepto_negocio»»¢ «
.»»« »
FirstOrDefault»»» ÷
(»»÷ ◊
v»»◊ ÿ
=>»»Ÿ €
v»»‹ ›
.»»› ﬁ$
Valor_caracteristica»»ﬁ Ú
.»»Ú Û!
id_caracteristica»»Û Ñ
==»»Ö á
HotelSettings»»à ï
.»»ï ñ
Default»»ñ ù
.»»ù û*
IdCaracteristicaAforoNinos»»û ∏
)»»∏ π
.»»π ∫$
Valor_caracteristica»»∫ Œ
.»»Œ œ
valor»»œ ‘
,»»‘ ’
Anexo
…… 
=
…… 
an
…… 
.
…… 
Actor
…… $
.
……$ %
telefono
……% -
,
……- .
	EsVigente
   
=
   
an
    "
.
  " #

es_vigente
  # -
}
ÀÀ 
)
ÀÀ 
.
ÀÀ 
FirstOrDefault
ÀÀ !
(
ÀÀ! "
)
ÀÀ" #
;
ÀÀ# $
}
ÃÃ 
catch
ÕÕ 
(
ÕÕ 
	Exception
ÕÕ 
e
ÕÕ 
)
ÕÕ 
{
ŒŒ 
throw
œœ 
new
œœ 
DatosException
œœ (
(
œœ( )
$str
œœ) `
,
œœ` a
e
œœb c
)
œœc d
;
œœd e
}
–– 
}
—— 	
public
ÊÊ 
IEnumerable
ÊÊ 
<
ÊÊ &
HabitacionEnPlanificador
ÊÊ 3
>
ÊÊ3 4-
ObtenerHabitacionesPlanificador
ÊÊ5 T
(
ÊÊT U
int
ÊÊU X
[
ÊÊX Y
]
ÊÊY Z
idsAmbientes
ÊÊ[ g
,
ÊÊg h
int
ÊÊi l
[
ÊÊl m
]
ÊÊm n#
idsTiposHabitacionesÊÊo É
,ÊÊÉ Ñ
intÊÊÖ à-
idActorNegocioQueTienePreciosÊÊâ ¶
,ÊÊ¶ ß
DateTimeÊÊ® ∞
fechaActualÊÊ± º
)ÊÊº Ω
{
ÁÁ 	
try
ËË 
{
ÈÈ 
return
ÍÍ 
_db
ÍÍ 
.
ÍÍ 
Actor_negocio
ÍÍ (
.
ÍÍ( )
Where
ÍÍ) .
(
ÍÍ. /
an
ÍÍ/ 1
=>
ÍÍ2 4"
idsTiposHabitaciones
ÍÍ5 I
.
ÍÍI J
Contains
ÍÍJ R
(
ÍÍR S
(
ÍÍS T
int
ÍÍT W
)
ÍÍW X
an
ÍÍX Z
.
ÍÍZ [!
id_concepto_negocio
ÍÍ[ n
)
ÍÍn o
&&
ÍÍp r
idsAmbientes
ÍÍs 
.ÍÍ Ä
ContainsÍÍÄ à
(ÍÍà â
(ÍÍâ ä
intÍÍä ç
)ÍÍç é
anÍÍé ê
.ÍÍê ë&
id_actor_negocio_padreÍÍë ß
)ÍÍß ®
&&ÍÍ© ´
anÍÍ¨ Æ
.ÍÍÆ Ø

es_vigenteÍÍØ π
)ÍÍπ ∫
.ÍÍ∫ ª
SelectÍÍª ¡
(ÍÍ¡ ¬
anÍÍ¬ ƒ
=>ÍÍ≈ «
newÍÍ» À(
HabitacionEnPlanificadorÍÍÃ ‰
(ÍÍ‰ Â
)ÍÍÂ Ê
{
ÎÎ 
Id
ÏÏ 
=
ÏÏ 
an
ÏÏ 
.
ÏÏ 
id
ÏÏ 
,
ÏÏ 
CodigoHabitacion
ÌÌ $
=
ÌÌ% &
an
ÌÌ' )
.
ÌÌ) *
Actor
ÌÌ* /
.
ÌÌ/ 0(
numero_documento_identidad
ÌÌ0 J
,
ÌÌJ K
Ambiente
ÓÓ 
=
ÓÓ 
an
ÓÓ !
.
ÓÓ! "
Actor_negocio2
ÓÓ" 0
.
ÓÓ0 1
Actor
ÓÓ1 6
.
ÓÓ6 7
primer_nombre
ÓÓ7 D
,
ÓÓD E
TipoHabitacion
ÔÔ "
=
ÔÔ# $
an
ÔÔ% '
.
ÔÔ' (
Concepto_negocio
ÔÔ( 8
.
ÔÔ8 9
sufijo
ÔÔ9 ?
,
ÔÔ? @
Precios
 
=
 
an
  
.
  !
Concepto_negocio
! 1
.
1 2
Precio1
2 9
.
9 :
Where
: ?
(
? @
p
@ A
=>
B D
p
E F
.
F G
id_actor_negocio
G W
==
X Z+
idActorNegocioQueTienePrecios
[ x
&&
y {
p
| }
.
} ~

es_vigente~ à
)à â
.â ä
ToListä ê
(ê ë
)ë í
,í ì

EnLimpieza
ÒÒ 
=
ÒÒ  
an
ÒÒ! #
.
ÒÒ# $

indicador1
ÒÒ$ .
,
ÒÒ. /

Disponible
ÚÚ 
=
ÚÚ  
!
ÚÚ! "
an
ÚÚ" $
.
ÚÚ$ %
Transaccion2
ÚÚ% 1
.
ÚÚ1 2
Where
ÚÚ2 7
(
ÚÚ7 8
t
ÚÚ8 9
=>
ÚÚ: <
t
ÚÚ= >
.
ÚÚ> ?!
id_tipo_transaccion
ÚÚ? R
==
ÚÚS U
HotelSettings
ÚÚV c
.
ÚÚc d
Default
ÚÚd k
.
ÚÚk l4
%IdTipoTransaccionAtencionDeHabitacionÚÚl ë
&&ÚÚí î
(ÚÚï ñ
tÚÚñ ó
.ÚÚó ò 
id_estado_actualÚÚò ®
==ÚÚ© ´
MaestroSettingsÚÚ¨ ª
.ÚÚª º
DefaultÚÚº √
.ÚÚ√ ƒ/
IdDetalleMaestroEstadoCheckedInÚÚƒ „
||ÚÚ‰ Ê
tÚÚÁ Ë
.ÚÚË È 
id_estado_actualÚÚÈ ˘
==ÚÚ˙ ¸
MaestroSettingsÚÚ˝ å
.ÚÚå ç
DefaultÚÚç î
.ÚÚî ï5
%IdDetalleMaestroEstadoEntradaCambiadoÚÚï ∫
||ÚÚª Ω
tÚÚæ ø
.ÚÚø ¿ 
id_estado_actualÚÚ¿ –
==ÚÚ— ”
MaestroSettingsÚÚ‘ „
.ÚÚ„ ‰
DefaultÚÚ‰ Î
.ÚÚÎ Ï0
 IdDetalleMaestroEstadoConfirmadoÚÚÏ å
)ÚÚå ç
&&ÚÚé ê
tÚÚë í
.ÚÚí ì
	fecha_finÚÚì ú
>ÚÚù û
fechaActualÚÚü ™
&&ÚÚ´ ≠
tÚÚÆ Ø
.ÚÚØ ∞
fecha_inicioÚÚ∞ º
<=ÚÚΩ ø
fechaActualÚÚ¿ À
)ÚÚÀ Ã
.ÚÚÃ Õ
AnyÚÚÕ –
(ÚÚ– —
)ÚÚ— “
,ÚÚ“ ”
Ocupada
ÛÛ 
=
ÛÛ 
an
ÛÛ  
.
ÛÛ  !
Transaccion2
ÛÛ! -
.
ÛÛ- .
Where
ÛÛ. 3
(
ÛÛ3 4
t
ÛÛ4 5
=>
ÛÛ6 8
t
ÛÛ9 :
.
ÛÛ: ;!
id_tipo_transaccion
ÛÛ; N
==
ÛÛO Q
HotelSettings
ÛÛR _
.
ÛÛ_ `
Default
ÛÛ` g
.
ÛÛg h4
%IdTipoTransaccionAtencionDeHabitacionÛÛh ç
&&ÛÛé ê
(ÛÛë í
tÛÛí ì
.ÛÛì î 
id_estado_actualÛÛî §
==ÛÛ• ß
MaestroSettingsÛÛ® ∑
.ÛÛ∑ ∏
DefaultÛÛ∏ ø
.ÛÛø ¿/
IdDetalleMaestroEstadoCheckedInÛÛ¿ ﬂ
||ÛÛ‡ ‚
tÛÛ„ ‰
.ÛÛ‰ Â 
id_estado_actualÛÛÂ ı
==ÛÛˆ ¯
MaestroSettingsÛÛ˘ à
.ÛÛà â
DefaultÛÛâ ê
.ÛÛê ë5
%IdDetalleMaestroEstadoEntradaCambiadoÛÛë ∂
)ÛÛ∂ ∑
&&ÛÛ∏ ∫
tÛÛª º
.ÛÛº Ω
	fecha_finÛÛΩ ∆
>ÛÛ« »
fechaActualÛÛ… ‘
&&ÛÛ’ ◊
tÛÛÿ Ÿ
.ÛÛŸ ⁄
fecha_inicioÛÛ⁄ Ê
<=ÛÛÁ È
fechaActualÛÛÍ ı
)ÛÛı ˆ
.ÛÛˆ ˜
AnyÛÛ˜ ˙
(ÛÛ˙ ˚
)ÛÛ˚ ¸
,ÛÛ¸ ˝
PorIngresar
ÙÙ 
=
ÙÙ  !
an
ÙÙ" $
.
ÙÙ$ %
Transaccion2
ÙÙ% 1
.
ÙÙ1 2
Where
ÙÙ2 7
(
ÙÙ7 8
t
ÙÙ8 9
=>
ÙÙ: <
t
ÙÙ= >
.
ÙÙ> ?!
id_tipo_transaccion
ÙÙ? R
==
ÙÙS U
HotelSettings
ÙÙV c
.
ÙÙc d
Default
ÙÙd k
.
ÙÙk l4
%IdTipoTransaccionAtencionDeHabitacionÙÙl ë
&&ÙÙí î
tÙÙï ñ
.ÙÙñ ó
fecha_inicioÙÙó £
<=ÙÙ§ ¶
fechaActualÙÙß ≤
&&ÙÙ≥ µ
(ÙÙ∂ ∑
tÙÙ∑ ∏
.ÙÙ∏ π
	fecha_finÙÙπ ¬
>=ÙÙ√ ≈
fechaActualÙÙ∆ —
||ÙÙ“ ‘
(ÙÙ’ ÷
tÙÙ÷ ◊
.ÙÙ◊ ÿ
	fecha_finÙÙÿ ·
==ÙÙ‚ ‰
fechaActualÙÙÂ 
.ÙÙ Ò
DateÙÙÒ ı
&&ÙÙˆ ¯
fechaActualÙÙ˘ Ñ
.ÙÙÑ Ö
HourÙÙÖ â
<ÙÙä ã
$numÙÙå é
)ÙÙé è
)ÙÙè ê
&&ÙÙë ì
tÙÙî ï
.ÙÙï ñ 
id_estado_actualÙÙñ ¶
==ÙÙß ©
MaestroSettingsÙÙ™ π
.ÙÙπ ∫
DefaultÙÙ∫ ¡
.ÙÙ¡ ¬0
 IdDetalleMaestroEstadoConfirmadoÙÙ¬ ‚
&&ÙÙ„ Â
!ÙÙÊ Á
tÙÙÁ Ë
.ÙÙË È"
Estado_transaccionÙÙÈ ˚
.ÙÙ˚ ¸
SelectÙÙ¸ Ç
(ÙÙÇ É
etÙÙÉ Ö
=>ÙÙÜ à
etÙÙâ ã
.ÙÙã å
	id_estadoÙÙå ï
)ÙÙï ñ
.ÙÙñ ó
ContainsÙÙó ü
(ÙÙü †
MaestroSettingsÙÙ† Ø
.ÙÙØ ∞
DefaultÙÙ∞ ∑
.ÙÙ∑ ∏/
IdDetalleMaestroEstadoCheckedInÙÙ∏ ◊
)ÙÙ◊ ÿ
)ÙÙÿ Ÿ
.ÙÙŸ ⁄
AnyÙÙ⁄ ›
(ÙÙ› ﬁ
)ÙÙﬁ ﬂ
,ÙÙﬂ ‡
PorSalir
ıı 
=
ıı 
an
ıı !
.
ıı! "
Transaccion2
ıı" .
.
ıı. /
Where
ıı/ 4
(
ıı4 5
t
ıı5 6
=>
ıı7 9
t
ıı: ;
.
ıı; <!
id_tipo_transaccion
ıı< O
==
ııP R
HotelSettings
ııS `
.
ıı` a
Default
ııa h
.
ııh i4
%IdTipoTransaccionAtencionDeHabitacionııi é
&&ııè ë
tııí ì
.ııì î
	fecha_finııî ù
<=ııû †
fechaActualıı° ¨
&&ıı≠ Ø
(ıı∞ ±
tıı± ≤
.ıı≤ ≥ 
id_estado_actualıı≥ √
==ııƒ ∆
MaestroSettingsıı« ÷
.ıı÷ ◊
Defaultıı◊ ﬁ
.ııﬁ ﬂ/
IdDetalleMaestroEstadoCheckedInııﬂ ˛
||ııˇ Å
tııÇ É
.ııÉ Ñ 
id_estado_actualııÑ î
==ııï ó
MaestroSettingsııò ß
.ııß ®
Defaultıı® Ø
.ııØ ∞5
%IdDetalleMaestroEstadoEntradaCambiadoıı∞ ’
)ıı’ ÷
&&ıı◊ Ÿ
!ıı⁄ €
tıı€ ‹
.ıı‹ ›"
Estado_transaccionıı› Ô
.ııÔ 
Selectıı ˆ
(ııˆ ˜
etıı˜ ˘
=>ıı˙ ¸
etıı˝ ˇ
.ııˇ Ä
	id_estadoııÄ â
)ııâ ä
.ııä ã
Containsııã ì
(ııì î
MaestroSettingsııî £
.ıı£ §
Defaultıı§ ´
.ıı´ ¨0
 IdDetalleMaestroEstadoCheckedOutıı¨ Ã
)ııÃ Õ
)ııÕ Œ
.ııŒ œ
Anyııœ “
(ıı“ ”
)ıı” ‘
}
ˆˆ 
)
ˆˆ 
;
ˆˆ 
}
˜˜ 
catch
¯¯ 
(
¯¯ 
	Exception
¯¯ 
e
¯¯ 
)
¯¯ 
{
˘˘ 
throw
˙˙ 
new
˙˙ 
DatosException
˙˙ (
(
˙˙( )
$str
˙˙) W
,
˙˙W X
e
˙˙Y Z
)
˙˙Z [
;
˙˙[ \
}
˚˚ 
}
¸¸ 	
public
˝˝ ,
EstadoHabitacionEnPlanificador
˝˝ -1
#ObtenerEstadoHabitacionPlanificador
˝˝. Q
(
˝˝Q R
DateTime
˝˝R Z
fechaConsulta
˝˝[ h
,
˝˝h i
int
˝˝j m
idHabitacion
˝˝n z
,
˝˝z {
DateTime˝˝| Ñ
fechaActual˝˝Ö ê
)˝˝ê ë
{
˛˛ 	
try
ˇˇ 
{
ÄÄ ,
EstadoHabitacionEnPlanificador
ÅÅ .
estadoHabitacion
ÅÅ/ ?
=
ÅÅ@ A
new
ÅÅB E,
EstadoHabitacionEnPlanificador
ÅÅF d
(
ÅÅd e
)
ÅÅe f
;
ÅÅf g
bool
ÇÇ 
existeAtencion
ÇÇ #
=
ÇÇ$ %
_db
ÇÇ& )
.
ÇÇ) *
Transaccion
ÇÇ* 5
.
ÇÇ5 6
Where
ÇÇ6 ;
(
ÇÇ; <
t
ÇÇ< =
=>
ÇÇ> @
t
ÇÇA B
.
ÇÇB C
fecha_inicio
ÇÇC O
<=
ÇÇP R
fechaConsulta
ÇÇS `
&&
ÇÇa c
fechaConsulta
ÇÇd q
<
ÇÇr s
t
ÇÇt u
.
ÇÇu v
	fecha_fin
ÇÇv 
&&ÇÇÄ Ç
tÇÇÉ Ñ
.ÇÇÑ Ö#
id_tipo_transaccionÇÇÖ ò
==ÇÇô õ
HotelSettingsÇÇú ©
.ÇÇ© ™
DefaultÇÇ™ ±
.ÇÇ± ≤5
%IdTipoTransaccionAtencionDeHabitacionÇÇ≤ ◊
&&ÇÇÿ ⁄
tÇÇ€ ‹
.ÇÇ‹ ›(
id_actor_negocio_internoÇÇ› ı
==ÇÇˆ ¯
idHabitacionÇÇ˘ Ö
)ÇÇÖ Ü
.ÇÇÜ á
AnyÇÇá ä
(ÇÇä ã
)ÇÇã å
;ÇÇå ç
if
ÉÉ 
(
ÉÉ 
existeAtencion
ÉÉ "
)
ÉÉ" #
{
ÑÑ 
var
ÖÖ  
atencionHabitacion
ÖÖ *
=
ÖÖ+ ,
_db
ÖÖ- 0
.
ÖÖ0 1
Transaccion
ÖÖ1 <
.
ÖÖ< =
Include
ÖÖ= D
(
ÖÖD E
t
ÖÖE F
=>
ÖÖG I
t
ÖÖJ K
.
ÖÖK L 
Estado_transaccion
ÖÖL ^
)
ÖÖ^ _
.
ÖÖ_ `
Include
ÖÖ` g
(
ÖÖg h
t
ÖÖh i
=>
ÖÖj l
t
ÖÖm n
.
ÖÖn o
Actor_negocio2
ÖÖo }
)
ÖÖ} ~
.
ÖÖ~ 
WhereÖÖ Ñ
(ÖÖÑ Ö
tÖÖÖ Ü
=>ÖÖá â
tÖÖä ã
.ÖÖã å
fecha_inicioÖÖå ò
<=ÖÖô õ
fechaConsultaÖÖú ©
&&ÖÖ™ ¨
fechaConsultaÖÖ≠ ∫
<ÖÖª º
tÖÖΩ æ
.ÖÖæ ø
	fecha_finÖÖø »
&&ÖÖ… À
tÖÖÃ Õ
.ÖÖÕ Œ#
id_tipo_transaccionÖÖŒ ·
==ÖÖ‚ ‰
HotelSettingsÖÖÂ Ú
.ÖÖÚ Û
DefaultÖÖÛ ˙
.ÖÖ˙ ˚5
%IdTipoTransaccionAtencionDeHabitacionÖÖ˚ †
&&ÖÖ° £
tÖÖ§ •
.ÖÖ• ¶(
id_actor_negocio_internoÖÖ¶ æ
==ÖÖø ¡
idHabitacionÖÖ¬ Œ
)ÖÖŒ œ
.ÖÖœ –!
OrderByDescendingÖÖ– ·
(ÖÖ· ‚
tÖÖ‚ „
=>ÖÖ‰ Ê
tÖÖÁ Ë
.ÖÖË È
idÖÖÈ Î
)ÖÖÎ Ï
.ÖÖÏ Ì
FirstOrDefaultÖÖÌ ˚
(ÖÖ˚ ¸
)ÖÖ¸ ˝
;ÖÖ˝ ˛
estadoHabitacion
ÜÜ $
.
ÜÜ$ %
IdEstado
ÜÜ% -
=
ÜÜ. / 
atencionHabitacion
ÜÜ0 B
.
ÜÜB C 
Estado_transaccion
ÜÜC U
.
ÜÜU V
OrderByDescending
ÜÜV g
(
ÜÜg h
e
ÜÜh i
=>
ÜÜj l
e
ÜÜm n
.
ÜÜn o
fecha
ÜÜo t
)
ÜÜt u
.
ÜÜu v
FirstOrDefaultÜÜv Ñ
(ÜÜÑ Ö
)ÜÜÖ Ü
.ÜÜÜ á
	id_estadoÜÜá ê
;ÜÜê ë
estadoHabitacion
áá $
.
áá$ %

IdAtencion
áá% /
=
áá0 1 
atencionHabitacion
áá2 D
.
ááD E
id
ááE G
;
ááG H
estadoHabitacion
àà $
.
àà$ %
IdAtencionMacro
àà% 4
=
àà5 6
(
àà7 8
long
àà8 <
)
àà< = 
atencionHabitacion
àà= O
.
ààO P"
id_transaccion_padre
ààP d
;
ààd e
estadoHabitacion
ââ $
.
ââ$ %
Fecha
ââ% *
=
ââ+ ,
fechaConsulta
ââ- :
.
ââ: ;
Date
ââ; ?
;
ââ? @
estadoHabitacion
ää $
.
ää$ %
EsFechaAtencion
ää% 4
=
ää5 6
(
ää7 8
fechaConsulta
ää8 E
.
ääE F
AddDays
ääF M
(
ääM N
$num
ääN O
)
ääO P
.
ääP Q
Date
ääQ U
.
ääU V
AddHours
ääV ^
(
ää^ _
$num
ää_ a
)
ääa b
-
ääc d
fechaActual
ääe p
)
ääp q
.
ääq r
TotalMinutes
äär ~
-ää Ä
HotelSettingsääÅ é
.ääé è
Defaultääè ñ
.ääñ ó/
ToleranciaEnMinutosParaCheckingääó ∂
>ää∑ ∏
$numääπ ∫
;ää∫ ª
}
ãã 
else
åå 
{
çç 
estadoHabitacion
éé $
.
éé$ %
IdEstado
éé% -
=
éé. /
MaestroSettings
éé0 ?
.
éé? @
Default
éé@ G
.
ééG H.
 IdDetalleMaestroEstadoDisponible
ééH h
;
ééh i
estadoHabitacion
èè $
.
èè$ %
Fecha
èè% *
=
èè+ ,
fechaConsulta
èè- :
.
èè: ;
Date
èè; ?
;
èè? @
var
êê 
cd
êê 
=
êê 
(
êê 
fechaConsulta
êê +
.
êê+ ,
AddDays
êê, 3
(
êê3 4
$num
êê4 5
)
êê5 6
.
êê6 7
Date
êê7 ;
.
êê; <
AddHours
êê< D
(
êêD E
$num
êêE G
)
êêG H
-
êêI J
fechaActual
êêK V
)
êêV W
.
êêW X
TotalMinutes
êêX d
;
êêd e
estadoHabitacion
ëë $
.
ëë$ %
EsFechaAtencion
ëë% 4
=
ëë5 6
(
ëë7 8
fechaConsulta
ëë8 E
.
ëëE F
AddDays
ëëF M
(
ëëM N
$num
ëëN O
)
ëëO P
.
ëëP Q
Date
ëëQ U
.
ëëU V
AddHours
ëëV ^
(
ëë^ _
$num
ëë_ a
)
ëëa b
-
ëëc d
fechaActual
ëëe p
)
ëëp q
.
ëëq r
TotalMinutes
ëër ~
-ëë Ä
HotelSettingsëëÅ é
.ëëé è
Defaultëëè ñ
.ëëñ ó/
ToleranciaEnMinutosParaCheckingëëó ∂
>ëë∑ ∏
$numëëπ ∫
;ëë∫ ª
}
íí 
return
ìì 
estadoHabitacion
ìì '
;
ìì' (
}
îî 
catch
ïï 
(
ïï 
	Exception
ïï 
e
ïï 
)
ïï 
{
ññ 
throw
óó 
new
óó 
DatosException
óó (
(
óó( )
$str
óó) c
,
óóc d
e
óóe f
)
óóf g
;
óóg h
}
òò 
}
ôô 	
public
õõ 
IEnumerable
õõ 
<
õõ 
ReservaBandeja
õõ )
>
õõ) *#
ObtenerReservaBandeja
õõ+ @
(
õõ@ A
int
õõA D
idEstablecimiento
õõE V
,
õõV W
DateTime
õõX `

fechaDesde
õõa k
,
õõk l
DateTime
õõm u

fechaHastaõõv Ä
)õõÄ Å
{
úú 	
try
ùù 
{
ûû 
return
üü 
_db
üü 
.
üü 
Transaccion
üü &
.
üü& '
Where
üü' ,
(
üü, -
t
üü- .
=>
üü/ 1
t
üü2 3
.
üü3 4
fecha_inicio
üü4 @
>=
üüA C

fechaDesde
üüD N
&&
üüO Q
t
üüR S
.
üüS T
fecha_inicio
üüT `
<=
üüa c

fechaHasta
üüd n
&&
üüo q
t
üür s
.
üüs t"
id_tipo_transaccionüüt á
==üüà ä
HotelSettingsüüã ò
.üüò ô
Defaultüüô †
.üü† °5
%IdTipoTransaccionAtencionDeHabitacionüü° ∆
&&üü« …
tüü  À
.üüÀ Ã
Actor_negocio2üüÃ ⁄
.üü⁄ €
Actor_negocio2üü€ È
.üüÈ Í&
id_actor_negocio_padreüüÍ Ä
==üüÅ É!
idEstablecimientoüüÑ ï
)üüï ñ
.
†† 
Select
†† 
(
†† 
t
†† 
=>
††  
new
††! $
ReservaBandeja
††% 3
(
††3 4
)
††4 5
{
°° 

IdAtencion
¢¢ "
=
¢¢# $
t
¢¢% &
.
¢¢& '
id
¢¢' )
,
¢¢) *
IdAtencionMacro
££ '
=
££( )
(
££* +
long
££+ /
)
££/ 0
t
££0 1
.
££1 2"
id_transaccion_padre
££2 F
,
££F G
Codigo
§§ 
=
§§  
t
§§! "
.
§§" #
codigo
§§# )
,
§§) *
Responsable
•• #
=
••$ %
t
••& '
.
••' (
Transaccion2
••( 4
.
••4 5
Actor_negocio3
••5 C
.
••C D
Actor
••D I
.
••I J
primer_nombre
••J W
,
••W X
Ambiente
¶¶  
=
¶¶! "
t
¶¶# $
.
¶¶$ %
Actor_negocio2
¶¶% 3
.
¶¶3 4
Actor_negocio2
¶¶4 B
.
¶¶B C
Actor
¶¶C H
.
¶¶H I
primer_nombre
¶¶I V
,
¶¶V W
TipoHabitacion
ßß &
=
ßß' (
t
ßß) *
.
ßß* +
Actor_negocio2
ßß+ 9
.
ßß9 :
Concepto_negocio
ßß: J
.
ßßJ K
sufijo
ßßK Q
,
ßßQ R
CodigoHabitacion
®® (
=
®®) *
t
®®+ ,
.
®®, -
Actor_negocio2
®®- ;
.
®®; <
Actor
®®< A
.
®®A B(
numero_documento_identidad
®®B \
,
®®\ ]
Ingreso
©© 
=
©©  !
t
©©" #
.
©©# $
fecha_inicio
©©$ 0
,
©©0 1
Salida
™™ 
=
™™  
t
™™! "
.
™™" #
	fecha_fin
™™# ,
,
™™, -
Noches
´´ 
=
´´  
(
´´! "
int
´´" %
)
´´% &
t
´´& '
.
´´' (
	cantidad1
´´( 1
,
´´1 2
Importe
¨¨ 
=
¨¨  !
t
¨¨" #
.
¨¨# $
importe_total
¨¨$ 1
,
¨¨1 2
Estado
≠≠ 
=
≠≠  
t
≠≠! "
.
≠≠" # 
Estado_transaccion
≠≠# 5
.
≠≠5 6
OrderByDescending
≠≠6 G
(
≠≠G H
est
≠≠H K
=>
≠≠L N
est
≠≠O R
.
≠≠R S
id
≠≠S U
)
≠≠U V
.
≠≠V W
FirstOrDefault
≠≠W e
(
≠≠e f
)
≠≠f g
.
≠≠g h
Detalle_maestro
≠≠h w
.
≠≠w x
nombre
≠≠x ~
,
≠≠~ 
	Facturado
ÆÆ !
=
ÆÆ" #
t
ÆÆ$ %
.
ÆÆ% &
enum1
ÆÆ& +
!=
ÆÆ, .
(
ÆÆ/ 0
int
ÆÆ0 3
)
ÆÆ3 4"
ModoFacturacionHotel
ÆÆ4 H
.
ÆÆH I
NoEspecificado
ÆÆI W
}
ØØ 
)
ØØ 
;
ØØ 
}
∞∞ 
catch
±± 
(
±± 
	Exception
±± 
e
±± 
)
±± 
{
≤≤ 
throw
≥≥ 
new
≥≥ 
DatosException
≥≥ (
(
≥≥( )
$str
≥≥) N
,
≥≥N O
e
≥≥P Q
)
≥≥Q R
;
≥≥R S
}
¥¥ 
}
µµ 	
public
∑∑ 
ItemGenerico
∑∑ -
ObtenerUltimoMotivoViajeHuesped
∑∑ ;
(
∑∑; <
int
∑∑< ?
	idHuesded
∑∑@ I
)
∑∑I J
{
∏∏ 	
try
ππ 
{
∫∫ 
return
ªª 
_db
ªª 
.
ªª +
Actor_negocio_por_transaccion
ªª 8
.
ªª8 9
Where
ªª9 >
(
ªª> ?
t
ªª? @
=>
ªªA C
t
ªªD E
.
ªªE F
id_rol
ªªF L
==
ªªM O
HotelSettings
ªªP ]
.
ªª] ^
Default
ªª^ e
.
ªªe f
IdRolHuesped
ªªf r
&&
ªªs u
t
ªªv w
.
ªªw x
id_actor_negocioªªx à
==ªªâ ã
	idHuesdedªªå ï
)ªªï ñ
.ªªñ ó!
OrderByDescendingªªó ®
(ªª® ©
tªª© ™
=>ªª´ ≠
tªªÆ Ø
.ªªØ ∞
idªª∞ ≤
)ªª≤ ≥
.
ºº 
Select
ºº 
(
ºº 
t
ºº 
=>
ºº  
new
ºº! $
ItemGenerico
ºº% 1
(
ºº1 2
)
ºº2 3
{
ΩΩ 
Id
ææ 
=
ææ 
t
ææ 
.
ææ 
Detalle_maestro
ææ .
.
ææ. /
id
ææ/ 1
,
ææ1 2
Nombre
øø 
=
øø  
t
øø! "
.
øø" #
Detalle_maestro
øø# 2
.
øø2 3
nombre
øø3 9
}
¿¿ 
)
¿¿ 
.
¿¿ 
FirstOrDefault
¿¿ %
(
¿¿% &
)
¿¿& '
;
¿¿' (
}
¡¡ 
catch
¬¬ 
(
¬¬ 
	Exception
¬¬ 
e
¬¬ 
)
¬¬ 
{
√√ 
throw
ƒƒ 
new
ƒƒ 
DatosException
ƒƒ (
(
ƒƒ( )
$str
ƒƒ) _
,
ƒƒ_ `
e
ƒƒa b
)
ƒƒb c
;
ƒƒc d
}
≈≈ 
}
∆∆ 	
public
«« 
OperationResult
«« -
CrearActorNegocioPorTransaccion
«« >
(
««> ?+
Actor_negocio_por_transaccion
««? \(
actorNegocioPorTransaccion
««] w
)
««w x
{
»» 	
try
…… 
{
   
_db
ÀÀ 
.
ÀÀ +
Actor_negocio_por_transaccion
ÀÀ 1
.
ÀÀ1 2
Add
ÀÀ2 5
(
ÀÀ5 6(
actorNegocioPorTransaccion
ÀÀ6 P
)
ÀÀP Q
;
ÀÀQ R
var
ÃÃ 
result
ÃÃ 
=
ÃÃ 
Save
ÃÃ !
(
ÃÃ! "
)
ÃÃ" #
;
ÃÃ# $
result
ÕÕ 
.
ÕÕ 
data
ÕÕ 
=
ÕÕ (
actorNegocioPorTransaccion
ÕÕ 8
.
ÕÕ8 9
id
ÕÕ9 ;
;
ÕÕ; <
return
ŒŒ 
result
ŒŒ 
;
ŒŒ 
}
œœ 
catch
–– 
(
–– 
	Exception
–– 
e
–– 
)
–– 
{
—— 
throw
““ 
e
““ 
;
““ 
}
”” 
}
‘‘ 	
public
’’ 
OperationResult
’’ #
CambiarTitularHuesped
’’ 4
(
’’4 5
int
’’5 8
idHuespedCambiado
’’9 J
,
’’J K
int
’’L O#
idHuespedNuevoTitular
’’P e
)
’’e f
{
÷÷ 	
try
◊◊ 
{
ÿÿ 
var
ŸŸ 
dbHuespedCambiado
ŸŸ %
=
ŸŸ& '
_db
ŸŸ( +
.
ŸŸ+ ,+
Actor_negocio_por_transaccion
ŸŸ, I
.
ŸŸI J
Single
ŸŸJ P
(
ŸŸP Q
at
ŸŸQ S
=>
ŸŸT V
at
ŸŸW Y
.
ŸŸY Z
id
ŸŸZ \
==
ŸŸ] _
idHuespedCambiado
ŸŸ` q
)
ŸŸq r
;
ŸŸr s
var
⁄⁄ 
dbHuespedTitular
⁄⁄ $
=
⁄⁄% &
_db
⁄⁄' *
.
⁄⁄* ++
Actor_negocio_por_transaccion
⁄⁄+ H
.
⁄⁄H I
Single
⁄⁄I O
(
⁄⁄O P
at
⁄⁄P R
=>
⁄⁄S U
at
⁄⁄V X
.
⁄⁄X Y
id
⁄⁄Y [
==
⁄⁄\ ^#
idHuespedNuevoTitular
⁄⁄_ t
)
⁄⁄t u
;
⁄⁄u v
var
€€ "
extensionJsonTitular
€€ (
=
€€) *
dbHuespedCambiado
€€+ <
.
€€< =
extension_json
€€= K
;
€€K L
dbHuespedCambiado
‹‹ !
.
‹‹! "
extension_json
‹‹" 0
=
‹‹1 2
dbHuespedTitular
‹‹3 C
.
‹‹C D
extension_json
‹‹D R
;
‹‹R S
dbHuespedTitular
››  
.
››  !
extension_json
››! /
=
››0 1"
extensionJsonTitular
››2 F
;
››F G
var
ﬁﬁ 
result
ﬁﬁ 
=
ﬁﬁ 
Save
ﬁﬁ !
(
ﬁﬁ! "
)
ﬁﬁ" #
;
ﬁﬁ# $
return
ﬂﬂ 
result
ﬂﬂ 
;
ﬂﬂ 
}
‡‡ 
catch
·· 
(
·· 
	Exception
·· 
e
·· 
)
·· 
{
‚‚ 
throw
„„ 
e
„„ 
;
„„ 
}
‰‰ 
}
ÂÂ 	
public
ÊÊ 
OperationResult
ÊÊ ;
-ActualizarActorNegocioExterno1DeTransacciones
ÊÊ L
(
ÊÊL M
List
ÊÊM Q
<
ÊÊQ R
long
ÊÊR V
>
ÊÊV W
idsTransaccion
ÊÊX f
,
ÊÊf g
int
ÊÊh k%
idActorNegocioExterno1ÊÊl Ç
)ÊÊÇ É
{
ÁÁ 	
try
ËË 
{
ÈÈ 
foreach
ÍÍ 
(
ÍÍ 
var
ÍÍ 
idTransaccion
ÍÍ *
in
ÍÍ+ -
idsTransaccion
ÍÍ. <
)
ÍÍ< =
{
ÎÎ 
Transaccion
ÏÏ 
dbTransaccion
ÏÏ  -
=
ÏÏ. /
_db
ÏÏ0 3
.
ÏÏ3 4
Transaccion
ÏÏ4 ?
.
ÏÏ? @
Single
ÏÏ@ F
(
ÏÏF G
m
ÏÏG H
=>
ÏÏI K
m
ÏÏL M
.
ÏÏM N
id
ÏÏN P
==
ÏÏQ S
idTransaccion
ÏÏT a
)
ÏÏa b
;
ÏÏb c
dbTransaccion
ÌÌ !
.
ÌÌ! "'
id_actor_negocio_externo1
ÌÌ" ;
=
ÌÌ< =$
idActorNegocioExterno1
ÌÌ> T
;
ÌÌT U
}
ÓÓ 
var
ÔÔ 
result
ÔÔ 
=
ÔÔ 
Save
ÔÔ !
(
ÔÔ! "
)
ÔÔ" #
;
ÔÔ# $
return
 
result
 
;
 
}
ÒÒ 
catch
ÚÚ 
(
ÚÚ 
	Exception
ÚÚ 
e
ÚÚ 
)
ÚÚ 
{
ÛÛ 
throw
ÙÙ 
e
ÙÙ 
;
ÙÙ 
}
ıı 
}
ˆˆ 	
public
˜˜ 
OperationResult
˜˜ 0
"EliminarActorNegocioPorTransaccion
˜˜ A
(
˜˜A B
int
˜˜B E*
idActorNegocioPorTransaccion
˜˜F b
)
˜˜b c
{
¯¯ 	
try
˘˘ 
{
˙˙ +
Actor_negocio_por_transaccion
˚˚ -*
dbActorNegocioPorTransaccion
˚˚. J
=
˚˚K L
_db
˚˚M P
.
˚˚P Q+
Actor_negocio_por_transaccion
˚˚Q n
.
˚˚n o
Single
˚˚o u
(
˚˚u v
m
˚˚v w
=>
˚˚x z
m
˚˚{ |
.
˚˚| }
id
˚˚} 
==˚˚Ä Ç,
idActorNegocioPorTransaccion˚˚É ü
)˚˚ü †
;˚˚† °
_db
¸¸ 
.
¸¸ +
Actor_negocio_por_transaccion
¸¸ 1
.
¸¸1 2
Remove
¸¸2 8
(
¸¸8 9*
dbActorNegocioPorTransaccion
¸¸9 U
)
¸¸U V
;
¸¸V W
var
˝˝ 
result
˝˝ 
=
˝˝ 
Save
˝˝ !
(
˝˝! "
)
˝˝" #
;
˝˝# $
return
˛˛ 
result
˛˛ 
;
˛˛ 
}
ˇˇ 
catch
ÄÄ 
(
ÄÄ 
	Exception
ÄÄ 
e
ÄÄ 
)
ÄÄ 
{
ÅÅ 
return
ÇÇ 
new
ÇÇ 
OperationResult
ÇÇ *
(
ÇÇ* +
e
ÇÇ+ ,
)
ÇÇ, -
;
ÇÇ- .
}
ÉÉ 
}
ÑÑ 	
public
ÜÜ  
AtencionMacroHotel
ÜÜ !"
ObtenerAtencionMacro
ÜÜ" 6
(
ÜÜ6 7
long
ÜÜ7 ;
idAtencionMacro
ÜÜ< K
)
ÜÜK L
{
áá 	
try
àà 
{
ââ  
AtencionMacroHotel
ää "
atencionMacro
ää# 0
=
ää1 2
_db
ää3 6
.
ää6 7
Transaccion
ää7 B
.
ääB C
Where
ääC H
(
ääH I
t
ääI J
=>
ääK M
t
ääN O
.
ääO P!
id_tipo_transaccion
ääP c
==
ääd f
HotelSettings
ääg t
.
äät u
Default
ääu |
.
ää| }/
 IdTipoTransaccionAtencionDeHotelää} ù
&&ääû †
tää° ¢
.ää¢ £
idää£ •
==ää¶ ®
idAtencionMacroää© ∏
)ää∏ π
.
ãã 
Select
ãã 
(
ãã 
t
ãã 
=>
ãã  
new
ãã! $ 
AtencionMacroHotel
ãã% 7
(
ãã7 8
)
ãã8 9
{
åå 
Id
çç 
=
çç 
t
çç 
.
çç 
id
çç !
,
çç! "
Codigo
éé 
=
éé  
t
éé! "
.
éé" #
codigo
éé# )
,
éé) *
Responsable
èè #
=
èè$ %
new
èè& )
ActorComercial_
èè* 9
{
êê 
Id
ëë 
=
ëë  
t
ëë! "
.
ëë" #
Actor_negocio3
ëë# 1
.
ëë1 2
id
ëë2 4
,
ëë4 5$
TipoDocumentoIdentidad
íí 2
=
íí3 4
new
íí5 8
ItemGenerico
íí9 E
(
ííE F
)
ííF G
{
ííH I
Id
ííJ L
=
ííM N
t
ííO P
.
ííP Q
Actor_negocio3
ííQ _
.
íí_ `
Actor
íí` e
.
ííe f$
id_documento_identidad
ííf |
,
íí| }
Nombreíí~ Ñ
=ííÖ Ü
tííá à
.ííà â
Actor_negocio3ííâ ó
.ííó ò
Actorííò ù
.ííù û
Detalle_maestroííû ≠
.íí≠ Æ
nombreííÆ ¥
}ííµ ∂
,íí∂ ∑ 
NombreORazonSocial
ìì .
=
ìì/ 0
t
ìì1 2
.
ìì2 3
Actor_negocio3
ìì3 A
.
ììA B
Actor
ììB G
.
ììG H
primer_nombre
ììH U
.
ììU V
Replace
ììV ]
(
ìì] ^
$str
ìì^ a
,
ììa b
$str
ììc f
)
ììf g
}
îî 
,
îî 
Total
ïï 
=
ïï 
t
ïï  !
.
ïï! "
importe_total
ïï" /
,
ïï/ 0
FacturadoGlobal
ññ '
=
ññ( )
t
ññ* +
.
ññ+ ,
enum1
ññ, 1
==
ññ2 4
(
ññ5 6
int
ññ6 9
)
ññ9 :"
ModoFacturacionHotel
ññ: N
.
ññN O
NoEspecificado
ññO ]
||
ññ^ `
t
ñña b
.
ññb c
enum1
ññc h
==
ññi k
(
ññl m
int
ññm p
)
ññp q#
ModoFacturacionHotelññq Ö
.ññÖ Ü
GlobalññÜ å
,ññå ç
TieneFacturacion
óó (
=
óó) *
t
óó+ ,
.
óó, -
enum1
óó- 2
!=
óó3 5
(
óó6 7
int
óó7 :
)
óó: ;"
ModoFacturacionHotel
óó; O
.
óóO P
NoEspecificado
óóP ^
,
óó^ _
FechaRegistro
òò %
=
òò& '
t
òò( )
.
òò) *$
fecha_registro_sistema
òò* @
,
òò@ A&
HayImagenVoucherExtranet
ôô 0
=
ôô1 2
t
ôô3 4
.
ôô4 5

indicador1
ôô5 ?
,
ôô? @
Eventos
öö 
=
öö  !
t
öö" #
.
öö# $ 
Evento_transaccion
öö$ 6
.
öö6 7
Select
öö7 =
(
öö= >
et
öö> @
=>
ööA C
new
ööD G

ItemEstado
ööH R
{
õõ 
Id
úú 
=
úú  
et
úú! #
.
úú# $
Detalle_maestro
úú$ 3
.
úú3 4
id
úú4 6
,
úú6 7
Nombre
ùù "
=
ùù# $
et
ùù% '
.
ùù' (
Detalle_maestro
ùù( 7
.
ùù7 8
nombre
ùù8 >
,
ùù> ?
Fecha
ûû !
=
ûû" #
et
ûû$ &
.
ûû& '
fecha
ûû' ,
,
ûû, -
Observacion
üü '
=
üü( )
et
üü* ,
.
üü, -

comentario
üü- 7
}
†† 
)
†† 
.
†† 
ToList
†† !
(
††! "
)
††" #
,
††# $

Atenciones
°° "
=
°°# $
t
°°% &
.
°°& '
Transaccion1
°°' 3
.
°°3 4
Select
°°4 :
(
°°: ;
tt
°°; =
=>
°°> @
new
°°A D
AtencionHotel
°°E R
{
¢¢ 
Id
££ 
=
££  
tt
££! #
.
££# $
id
££$ &
,
££& '

Habitacion
§§ &
=
§§' (
new
§§) ,

Habitacion
§§- 7
{
•• 
Id
¶¶  "
=
¶¶# $
tt
¶¶% '
.
¶¶' (
Actor_negocio2
¶¶( 6
.
¶¶6 7
id
¶¶7 9
,
¶¶9 :
CodigoHabitacion
ßß  0
=
ßß1 2
tt
ßß3 5
.
ßß5 6
Actor_negocio2
ßß6 D
.
ßßD E
Actor
ßßE J
.
ßßJ K(
numero_documento_identidad
ßßK e
,
ßße f
TipoHabitacion
®®  .
=
®®/ 0
new
®®1 4)
Concepto_Negocio_Comercial_
®®5 P
{
©©  !
Id
™™$ &
=
™™' (
tt
™™) +
.
™™+ ,
Actor_negocio2
™™, :
.
™™: ;
Concepto_negocio
™™; K
.
™™K L
id
™™L N
,
™™N O
Nombre
´´$ *
=
´´+ ,
tt
´´- /
.
´´/ 0
Actor_negocio2
´´0 >
.
´´> ?
Concepto_negocio
´´? O
.
´´O P
sufijo
´´P V
}
¨¨  !
}
≠≠ 
,
≠≠ 
FechaIngreso
ÆÆ (
=
ÆÆ) *
tt
ÆÆ+ -
.
ÆÆ- .
fecha_inicio
ÆÆ. :
,
ÆÆ: ;
FechaSalida
ØØ '
=
ØØ( )
tt
ØØ* ,
.
ØØ, -
	fecha_fin
ØØ- 6
,
ØØ6 7
Noches
∞∞ "
=
∞∞# $
(
∞∞% &
int
∞∞& )
)
∞∞) *
tt
∞∞* ,
.
∞∞, -
	cantidad1
∞∞- 6
,
∞∞6 7
PrecioUnitario
±± *
=
±±+ ,
tt
±±- /
.
±±/ 0
importe1
±±0 8
,
±±8 9
Importe
≤≤ #
=
≤≤$ %
tt
≤≤& (
.
≤≤( )
importe_total
≤≤) 6
,
≤≤6 7
	Facturado
≥≥ %
=
≥≥& '
tt
≥≥( *
.
≥≥* +

indicador1
≥≥+ 5
,
≥≥5 6
TieneFacturacion
¥¥ ,
=
¥¥- .
t
¥¥/ 0
.
¥¥0 1
enum1
¥¥1 6
!=
¥¥7 9
(
¥¥: ;
int
¥¥; >
)
¥¥> ?"
ModoFacturacionHotel
¥¥? S
.
¥¥S T
NoEspecificado
¥¥T b
,
¥¥b c
FacturadoGlobal
µµ +
=
µµ, -
t
µµ. /
.
µµ/ 0
enum1
µµ0 5
==
µµ6 8
(
µµ9 :
int
µµ: =
)
µµ= >"
ModoFacturacionHotel
µµ> R
.
µµR S
NoEspecificado
µµS a
||
µµb d
t
µµe f
.
µµf g
enum1
µµg l
==
µµm o
(
µµp q
int
µµq t
)
µµt u#
ModoFacturacionHotelµµu â
.µµâ ä
Globalµµä ê
,µµê ë
AnotacionesJson
∂∂ +
=
∂∂, -
tt
∂∂. 0
.
∂∂0 1

comentario
∂∂1 ;
,
∂∂; <
	Huespedes
∑∑ %
=
∑∑& '
tt
∑∑( *
.
∑∑* ++
Actor_negocio_por_transaccion
∑∑+ H
.
∑∑H I
Select
∑∑I O
(
∑∑O P
at
∑∑P R
=>
∑∑S U
new
∑∑V Y
Huesped
∑∑Z a
{
∏∏ 
	IdHuesped
ππ  )
=
ππ* +
at
ππ, .
.
ππ. /
id
ππ/ 1
,
ππ1 2
Id
∫∫  "
=
∫∫# $
at
∫∫% '
.
∫∫' (
Actor_negocio
∫∫( 5
.
∫∫5 6
id
∫∫6 8
,
∫∫8 9&
NumeroDocumentoIdentidad
ªª  8
=
ªª9 :
at
ªª; =
.
ªª= >
Actor_negocio
ªª> K
.
ªªK L
Actor
ªªL Q
.
ªªQ R(
numero_documento_identidad
ªªR l
,
ªªl m$
TipoDocumentoIdentidad
ºº  6
=
ºº7 8
new
ºº9 <
ItemGenerico
ºº= I
{
ººJ K
Id
ººL N
=
ººO P
at
ººQ S
.
ººS T
Actor_negocio
ººT a
.
ººa b
Actor
ººb g
.
ººg h$
id_documento_identidad
ººh ~
,
ºº~ 
NombreººÄ Ü
=ººá à
atººâ ã
.ººã å
Actor_negocioººå ô
.ººô ö
Actorººö ü
.ººü †
Detalle_maestroºº† Ø
.ººØ ∞
nombreºº∞ ∂
}ºº∑ ∏
,ºº∏ π 
NombreORazonSocial
ΩΩ  2
=
ΩΩ3 4
at
ΩΩ5 7
.
ΩΩ7 8
Actor_negocio
ΩΩ8 E
.
ΩΩE F
Actor
ΩΩF K
.
ΩΩK L
primer_nombre
ΩΩL Y
.
ΩΩY Z
Replace
ΩΩZ a
(
ΩΩa b
$str
ΩΩb e
,
ΩΩe f
$str
ΩΩg j
)
ΩΩj k
,
ΩΩk l

ClaseActor
ææ  *
=
ææ+ ,
new
ææ- 0
ItemGenerico
ææ1 =
{
ææ> ?
Id
ææ@ B
=
ææC D
at
ææE G
.
ææG H
Actor_negocio
ææH U
.
ææU V
Actor
ææV [
.
ææ[ \
id_clase_actor
ææ\ j
,
ææj k
Nombre
ææl r
=
ææs t
at
ææu w
.
ææw x
Actor_negocioææx Ö
.ææÖ Ü
ActorææÜ ã
.ææã å
Clase_actorææå ó
.ææó ò
nombreææò û
}ææü †
,ææ† °
FechaNacimiento
øø  /
=
øø0 1
at
øø2 4
.
øø4 5
Actor_negocio
øø5 B
.
øøB C
Actor
øøC H
.
øøH I
fecha_nacimiento
øøI Y
,
øøY Z
Nacionalidad
¿¿  ,
=
¿¿- .
new
¿¿/ 2
ItemGenerico
¿¿3 ?
{
¿¿@ A
Id
¿¿B D
=
¿¿E F
at
¿¿G I
.
¿¿I J
Actor_negocio
¿¿J W
.
¿¿W X
Actor
¿¿X ]
.
¿¿] ^
Detalle_maestro1
¿¿^ n
.
¿¿n o
id
¿¿o q
,
¿¿q r
Nombre
¿¿s y
=
¿¿z {
at
¿¿| ~
.
¿¿~ 
Actor_negocio¿¿ å
.¿¿å ç
Actor¿¿ç í
.¿¿í ì 
Detalle_maestro1¿¿ì £
.¿¿£ §
nombre¿¿§ ™
}¿¿´ ¨
,¿¿¨ ≠
MotivoDeViaje
¡¡  -
=
¡¡. /
new
¡¡0 3
ItemGenerico
¡¡4 @
{
¡¡A B
Id
¡¡C E
=
¡¡F G
at
¡¡H J
.
¡¡J K
Detalle_maestro
¡¡K Z
.
¡¡Z [
id
¡¡[ ]
,
¡¡] ^
Nombre
¡¡_ e
=
¡¡f g
at
¡¡h j
.
¡¡j k
Detalle_maestro
¡¡k z
.
¡¡z {
nombre¡¡{ Å
}¡¡Ç É
,¡¡É Ñ
JsonHuesdep
¬¬  +
=
¬¬, -
at
¬¬. 0
.
¬¬0 1
extension_json
¬¬1 ?
,
¬¬? @
DomicilioFiscal
√√  /
=
√√0 1
new
√√2 5

Direccion_
√√6 @
{
ƒƒ  !
Id
≈≈$ &
=
≈≈' (
at
≈≈) +
.
≈≈+ ,
Actor_negocio
≈≈, 9
.
≈≈9 :
Actor
≈≈: ?
.
≈≈? @
	Direccion
≈≈@ I
.
≈≈I J
FirstOrDefault
≈≈J X
(
≈≈X Y
)
≈≈Y Z
.
≈≈Z [
id
≈≈[ ]
,
≈≈] ^
Pais
∆∆$ (
=
∆∆) *
new
∆∆+ .
ItemGenerico
∆∆/ ;
{
∆∆< =
Id
∆∆> @
=
∆∆A B
at
∆∆C E
.
∆∆E F
Actor_negocio
∆∆F S
.
∆∆S T
Actor
∆∆T Y
.
∆∆Y Z
	Direccion
∆∆Z c
.
∆∆c d
FirstOrDefault
∆∆d r
(
∆∆r s
)
∆∆s t
.
∆∆t u
Detalle_maestro1∆∆u Ö
.∆∆Ö Ü
id∆∆Ü à
,∆∆à â
Nombre∆∆ä ê
=∆∆ë í
at∆∆ì ï
.∆∆ï ñ
Actor_negocio∆∆ñ £
.∆∆£ §
Actor∆∆§ ©
.∆∆© ™
	Direccion∆∆™ ≥
.∆∆≥ ¥
FirstOrDefault∆∆¥ ¬
(∆∆¬ √
)∆∆√ ƒ
.∆∆ƒ ≈ 
Detalle_maestro1∆∆≈ ’
.∆∆’ ÷
nombre∆∆÷ ‹
}∆∆› ﬁ
,∆∆ﬁ ﬂ
Ubigeo
««$ *
=
««+ ,
new
««- 0
ItemGenerico
««1 =
{
««> ?
Id
««@ B
=
««C D
at
««E G
.
««G H
Actor_negocio
««H U
.
««U V
Actor
««V [
.
««[ \
	Direccion
««\ e
.
««e f
FirstOrDefault
««f t
(
««t u
)
««u v
.
««v w
Ubigeo
««w }
.
««} ~
id««~ Ä
,««Ä Å
Nombre««Ç à
=««â ä
at««ã ç
.««ç é
Actor_negocio««é õ
.««õ ú
Actor««ú °
.««° ¢
	Direccion««¢ ´
.««´ ¨
FirstOrDefault««¨ ∫
(««∫ ª
)««ª º
.««º Ω
Ubigeo««Ω √
.««√ ƒ!
descripcion_larga««ƒ ’
}««÷ ◊
,««◊ ÿ
Detalle
»»$ +
=
»», -
at
»». 0
.
»»0 1
Actor_negocio
»»1 >
.
»»> ?
Actor
»»? D
.
»»D E
	Direccion
»»E N
.
»»N O
FirstOrDefault
»»O ]
(
»»] ^
)
»»^ _
.
»»_ `
detalle
»»` g
}
……  !
}
   
)
   
.
   
ToList
   %
(
  % &
)
  & '
,
  ' (
Estados
ÀÀ #
=
ÀÀ$ %
tt
ÀÀ& (
.
ÀÀ( ) 
Estado_transaccion
ÀÀ) ;
.
ÀÀ; <
Select
ÀÀ< B
(
ÀÀB C
et
ÀÀC E
=>
ÀÀF H
new
ÀÀI L

ItemEstado
ÀÀM W
{
ÃÃ 
Id
ÕÕ  "
=
ÕÕ# $
et
ÕÕ% '
.
ÕÕ' (
Detalle_maestro
ÕÕ( 7
.
ÕÕ7 8
id
ÕÕ8 :
,
ÕÕ: ;
Nombre
ŒŒ  &
=
ŒŒ' (
et
ŒŒ) +
.
ŒŒ+ ,
Detalle_maestro
ŒŒ, ;
.
ŒŒ; <
nombre
ŒŒ< B
,
ŒŒB C
Fecha
œœ  %
=
œœ& '
et
œœ( *
.
œœ* +
fecha
œœ+ 0
,
œœ0 1
Observacion
––  +
=
––, -
et
––. 0
.
––0 1

comentario
––1 ;
}
—— 
)
—— 
.
—— 
ToList
—— %
(
——% &
)
——& '
.
——' (
Union
——( -
(
——- .
tt
——. 0
.
——0 1 
Evento_transaccion
——1 C
.
——C D
Select
——D J
(
——J K
et
——K M
=>
——N P
new
——Q T

ItemEstado
——U _
{
““ 
Id
””  "
=
””# $
et
””% '
.
””' (
Detalle_maestro
””( 7
.
””7 8
id
””8 :
,
””: ;
Nombre
‘‘  &
=
‘‘' (
et
‘‘) +
.
‘‘+ ,
Detalle_maestro
‘‘, ;
.
‘‘; <
nombre
‘‘< B
,
‘‘B C
Fecha
’’  %
=
’’& '
et
’’( *
.
’’* +
fecha
’’+ 0
,
’’0 1
Observacion
÷÷  +
=
÷÷, -
et
÷÷. 0
.
÷÷0 1

comentario
÷÷1 ;
}
◊◊ 
)
◊◊ 
.
◊◊ 
ToList
◊◊ %
(
◊◊% &
)
◊◊& '
)
◊◊' (
.
◊◊( )
ToList
◊◊) /
(
◊◊/ 0
)
◊◊0 1
,
◊◊1 2
}
ÿÿ 
)
ÿÿ 
.
ÿÿ 
OrderBy
ÿÿ "
(
ÿÿ" #
to
ÿÿ# %
=>
ÿÿ& (
to
ÿÿ) +
.
ÿÿ+ ,
FechaIngreso
ÿÿ, 8
)
ÿÿ8 9
.
ÿÿ9 :
ToList
ÿÿ: @
(
ÿÿ@ A
)
ÿÿA B
}
ŸŸ 
)
ŸŸ 
.
ŸŸ 
SingleOrDefault
ŸŸ &
(
ŸŸ& '
)
ŸŸ' (
;
ŸŸ( )
return
⁄⁄ 
atencionMacro
⁄⁄ $
;
⁄⁄$ %
}
€€ 
catch
‹‹ 
(
‹‹ 
	Exception
‹‹ 
e
‹‹ 
)
‹‹ 
{
›› 
throw
ﬁﬁ 
new
ﬁﬁ 
DatosException
ﬁﬁ (
(
ﬁﬁ( )
$str
ﬁﬁ) T
,
ﬁﬁT U
e
ﬁﬁV W
)
ﬁﬁW X
;
ﬁﬁX Y
}
ﬂﬂ 
}
‡‡ 	
public
‚‚ 
Atencion
‚‚ /
!ObtenerAtencionDesdeAtencionMacro
‚‚ 9
(
‚‚9 :
long
‚‚: >
idAtencionMacro
‚‚? N
)
‚‚N O
{
„„ 	
try
‰‰ 
{
ÂÂ 
return
ÊÊ 
_db
ÊÊ 
.
ÊÊ 
Transaccion
ÊÊ &
.
ÊÊ& '
Where
ÊÊ' ,
(
ÊÊ, -
t
ÊÊ- .
=>
ÊÊ/ 1
t
ÊÊ2 3
.
ÊÊ3 4!
id_tipo_transaccion
ÊÊ4 G
==
ÊÊH J
HotelSettings
ÊÊK X
.
ÊÊX Y
Default
ÊÊY `
.
ÊÊ` a/
 IdTipoTransaccionAtencionDeHotelÊÊa Å
&&ÊÊÇ Ñ
tÊÊÖ Ü
.ÊÊÜ á
idÊÊá â
==ÊÊä å
idAtencionMacroÊÊç ú
)ÊÊú ù
.
ÁÁ 
Select
ÁÁ 
(
ÁÁ 
t
ÁÁ 
=>
ÁÁ  
new
ÁÁ! $
Atencion
ÁÁ% -
(
ÁÁ- .
)
ÁÁ. /
{
ËË 
Id
ÈÈ 
=
ÈÈ 
t
ÈÈ 
.
ÈÈ 
id
ÈÈ !
,
ÈÈ! "
Codigo
ÍÍ 
=
ÍÍ  
t
ÍÍ! "
.
ÍÍ" #
codigo
ÍÍ# )
,
ÍÍ) *
TieneFacturacion
ÎÎ (
=
ÎÎ) *
t
ÎÎ+ ,
.
ÎÎ, -
enum1
ÎÎ- 2
!=
ÎÎ3 5
(
ÎÎ6 7
int
ÎÎ7 :
)
ÎÎ: ;"
ModoFacturacionHotel
ÎÎ; O
.
ÎÎO P
NoEspecificado
ÎÎP ^
,
ÎÎ^ _(
ComprobantesOrdenPrincipal
ÏÏ 2
=
ÏÏ3 4
t
ÏÏ5 6
.
ÏÏ6 7
Transaccion11
ÏÏ7 D
.
ÏÏD E
Where
ÏÏE J
(
ÏÏJ K
tr
ÏÏK M
=>
ÏÏN P
tr
ÏÏQ S
.
ÏÏS T!
id_tipo_transaccion
ÏÏT g
==
ÏÏh j!
TransaccionSettings
ÏÏk ~
.
ÏÏ~ 
DefaultÏÏ Ü
.ÏÏÜ á-
IdTipoTransaccionOrdenDeVentaÏÏá §
)ÏÏ§ •
.ÏÏ• ¶
SelectÏÏ¶ ¨
(ÏÏ¨ ≠
trÏÏ≠ Ø
=>ÏÏ∞ ≤
newÏÏ≥ ∂$
ComprobanteFacturadoÏÏ∑ À
{
ÌÌ 
IdOrden
ÓÓ #
=
ÓÓ$ %
tr
ÓÓ& (
.
ÓÓ( )
id
ÓÓ) +
,
ÓÓ+ ,
}
ÔÔ 
)
ÔÔ 
,
ÔÔ -
ComprobantesReferenciaPrincipal
 7
=
8 9
t
: ;
.
; <
Transaccion11
< I
.
I J

SelectMany
J T
(
T U
ttr
U X
=>
Y [
ttr
\ _
.
_ `
Transaccion11
` m
)
m n
.
n o
Where
o t
(
t u
ttr
u x
=>
y {
(
| }
ttr} Ä
.Ä Å#
id_tipo_transaccionÅ î
==ï ó#
TransaccionSettingsò ´
.´ ¨
Default¨ ≥
.≥ ¥8
(IdTipoTransaccionOrdenDeAnulacionDeVenta¥ ‹
&&› ﬂ
ttr‡ „
.„ ‰
Comprobante‰ Ô
.Ô #
id_tipo_comprobante É
!=Ñ Ü
MaestroSettingsá ñ
.ñ ó
Defaultó û
.û ü=
-IdDetalleMaestroComprobanteNotaCreditoInternaü Ã
)Ã Õ
||Œ –
Diccionario— ‹
.‹ ›n
^TiposDeTransaccionOrdenesDeOperacionesDeVentasSoloNotasDeCreditoYDebitoExceptoAnulacionDeVenta› ª
.ª º
Containsº ƒ
(ƒ ≈
ttr≈ »
.» …#
id_tipo_transaccion… ‹
)‹ ›
)› ﬁ
.ﬁ ﬂ
Selectﬂ Â
(Â Ê
trÊ Ë
=>È Î
newÏ Ô$
ComprobanteFacturado Ñ
{
ÒÒ 
IdOrden
ÚÚ #
=
ÚÚ$ %
tr
ÚÚ& (
.
ÚÚ( )
id
ÚÚ) +
,
ÚÚ+ ,
}
ÛÛ 
)
ÛÛ 
,
ÛÛ 
OrdenPrincipal
ÙÙ &
=
ÙÙ' (
new
ÙÙ) ,
OrdenAtencion
ÙÙ- :
{
ıı 
Id
ˆˆ 
=
ˆˆ  
t
ˆˆ! "
.
ˆˆ" #
id
ˆˆ# %
,
ˆˆ% &
Codigo
˜˜ "
=
˜˜# $
t
˜˜% &
.
˜˜& '
codigo
˜˜' -
,
˜˜- .
FechaRegistro
¯¯ )
=
¯¯* +
t
¯¯, -
.
¯¯- .
fecha_inicio
¯¯. :
,
¯¯: ;
Importe
˘˘ #
=
˘˘$ %
t
˘˘& '
.
˘˘' (
importe_total
˘˘( 5
,
˘˘5 6
TieneFacturacion
˙˙ ,
=
˙˙- .
t
˙˙/ 0
.
˙˙0 1
enum1
˙˙1 6
!=
˙˙7 9
(
˙˙: ;
int
˙˙; >
)
˙˙> ?"
ModoFacturacionHotel
˙˙? S
.
˙˙S T
NoEspecificado
˙˙T b
,
˙˙b c
Detalles
˚˚ $
=
˚˚% &
t
˚˚' (
.
˚˚( )
Transaccion1
˚˚) 5
.
˚˚5 6
Select
˚˚6 <
(
˚˚< =
th
˚˚= ?
=>
˚˚@ B
new
˚˚C F"
DetalleOrdenAtencion
˚˚G [
{
¸¸ 
Id
˝˝  "
=
˝˝# $
th
˝˝% '
.
˝˝' (
id
˝˝( *
,
˝˝* +

IdConcepto
˛˛  *
=
˛˛+ ,
(
˛˛- .
int
˛˛. 1
)
˛˛1 2
th
˛˛2 4
.
˛˛4 5
Actor_negocio2
˛˛5 C
.
˛˛C D!
id_concepto_negocio
˛˛D W
,
˛˛W X
	IdFamilia
ˇˇ  )
=
ˇˇ* +
th
ˇˇ, .
.
ˇˇ. /
Actor_negocio2
ˇˇ/ =
.
ˇˇ= >
Concepto_negocio
ˇˇ> N
.
ˇˇN O 
id_concepto_basico
ˇˇO a
,
ˇˇa b
NombreConcepto
ÄÄ  .
=
ÄÄ/ 0
th
ÄÄ1 3
.
ÄÄ3 4
Actor_negocio2
ÄÄ4 B
.
ÄÄB C
Concepto_negocio
ÄÄC S
.
ÄÄS T
nombre
ÄÄT Z
+
ÄÄ[ \
$str
ÄÄ] b
+
ÄÄc d
th
ÄÄe g
.
ÄÄg h
Actor_negocio2
ÄÄh v
.
ÄÄv w
Actor
ÄÄw |
.
ÄÄ| })
numero_documento_identidadÄÄ} ó
,ÄÄó ò
Cantidad
ÅÅ  (
=
ÅÅ) *
th
ÅÅ+ -
.
ÅÅ- .
	cantidad1
ÅÅ. 7
,
ÅÅ7 8
PrecioUnitario
ÇÇ  .
=
ÇÇ/ 0
th
ÇÇ1 3
.
ÇÇ3 4
importe1
ÇÇ4 <
,
ÇÇ< =
Importe
ÉÉ  '
=
ÉÉ( )
th
ÉÉ* ,
.
ÉÉ, -
importe_total
ÉÉ- :
,
ÉÉ: ;
IdEstadoActual
ÑÑ  .
=
ÑÑ/ 0
(
ÑÑ1 2
int
ÑÑ2 5
)
ÑÑ5 6
th
ÑÑ6 8
.
ÑÑ8 9
id_estado_actual
ÑÑ9 I
}
ÖÖ 
)
ÖÖ 
}
ÜÜ 
,
ÜÜ 
Ordenes
áá 
=
áá  !
t
áá" #
.
áá# $
Transaccion1
áá$ 0
.
áá0 1

SelectMany
áá1 ;
(
áá; <
tr
áá< >
=>
áá? A
tr
ááB D
.
ááD E
Transaccion11
ááE R
)
ááR S
.
ááS T
Where
ááT Y
(
ááY Z
_tr
ááZ ]
=>
áá^ `
_tr
ááa d
.
áád e!
id_tipo_transaccion
ááe x
==
ááy {"
TransaccionSettingsáá| è
.ááè ê
Defaultááê ó
.ááó ò7
'IdTipoTransaccionOrdenConsumoHabitacionááò ø
)ááø ¿
.áá¿ ¡
Whereáá¡ ∆
(áá∆ «
trráá«  
=>ááÀ Õ
trrááŒ —
.áá— “ 
id_estado_actualáá“ ‚
==áá„ Â
MaestroSettingsááÊ ı
.ááı ˆ
Defaultááˆ ˝
.áá˝ ˛0
 IdDetalleMaestroEstadoConfirmadoáá˛ û
)ááû ü
.ááü †
Selectáá† ¶
(áá¶ ß
trááß ©
=>áá™ ¨
newáá≠ ∞
OrdenAtencionáá± æ
{
àà 
Id
ââ 
=
ââ  
tr
ââ! #
.
ââ# $
id
ââ$ &
,
ââ& '
Codigo
ää "
=
ää# $
tr
ää% '
.
ää' (
Actor_negocio1
ää( 6
.
ää6 7
Actor
ää7 <
.
ää< =
primer_nombre
ää= J
,
ääJ K
FechaRegistro
ãã )
=
ãã* +
tr
ãã, .
.
ãã. /
fecha_inicio
ãã/ ;
,
ãã; <
Importe
åå #
=
åå$ %
tr
åå& (
.
åå( )
importe_total
åå) 6
,
åå6 7
TieneFacturacion
çç ,
=
çç- .
tr
çç/ 1
.
çç1 2 
Evento_transaccion
çç2 D
.
ççD E
Select
ççE K
(
ççK L
ev
ççL N
=>
ççO Q
ev
ççR T
.
ççT U
	id_evento
ççU ^
)
çç^ _
.
çç_ `
Contains
çç` h
(
ççh i
MaestroSettings
ççi x
.
ççx y
Defaultççy Ä
.ççÄ Å/
IdDetalleMaestroEstadoFacturadoççÅ †
)çç† °
,çç° ¢
Detalles
éé $
=
éé% &
tr
éé' )
.
éé) *!
Detalle_transaccion
éé* =
.
éé= >
Distinct
éé> F
(
ééF G
)
ééG H
.
ééH I
Select
ééI O
(
ééO P
dtr
ééP S
=>
ééT V
new
ééW Z"
DetalleOrdenAtencion
éé[ o
{
èè 
Id
êê  "
=
êê# $
dtr
êê% (
.
êê( )
id
êê) +
,
êê+ ,

IdConcepto
ëë  *
=
ëë+ ,
dtr
ëë- 0
.
ëë0 1!
id_concepto_negocio
ëë1 D
,
ëëD E
	IdFamilia
íí  )
=
íí* +
dtr
íí, /
.
íí/ 0
Concepto_negocio
íí0 @
.
íí@ A 
id_concepto_basico
ííA S
,
ííS T
NombreConcepto
ìì  .
=
ìì/ 0
dtr
ìì1 4
.
ìì4 5
Concepto_negocio
ìì5 E
.
ììE F
nombre
ììF L
,
ììL M
Cantidad
îî  (
=
îî) *
dtr
îî+ .
.
îî. /
cantidad
îî/ 7
,
îî7 8
PrecioUnitario
ïï  .
=
ïï/ 0
dtr
ïï1 4
.
ïï4 5
precio_unitario
ïï5 D
,
ïïD E
Importe
ññ  '
=
ññ( )
dtr
ññ* -
.
ññ- .
total
ññ. 3
,
ññ3 4
IdEstadoActual
óó  .
=
óó/ 0
$num
óó1 2
}
òò 
)
òò 
}
ôô 
)
ôô 
.
ôô 
ToList
ôô !
(
ôô! "
)
ôô" #
}
öö 
)
öö 
.
öö 
SingleOrDefault
öö &
(
öö& '
)
öö' (
;
öö( )
}
úú 
catch
ùù 
(
ùù 
	Exception
ùù 
e
ùù 
)
ùù 
{
ûû 
throw
üü 
new
üü 
DatosException
üü (
(
üü( )
$str
üü) c
,
üüc d
e
üüe f
)
üüf g
;
üüg h
}
†† 
}
°° 	
public
££ 
Atencion
££ *
ObtenerAtencionDesdeAtencion
££ 4
(
££4 5
long
££5 9

idAtencion
££: D
)
££D E
{
§§ 	
try
•• 
{
¶¶ 
return
ßß 
_db
ßß 
.
ßß 
Transaccion
ßß &
.
ßß& '
Where
ßß' ,
(
ßß, -
t
ßß- .
=>
ßß/ 1
t
ßß2 3
.
ßß3 4!
id_tipo_transaccion
ßß4 G
==
ßßH J
HotelSettings
ßßK X
.
ßßX Y
Default
ßßY `
.
ßß` a4
%IdTipoTransaccionAtencionDeHabitacionßßa Ü
&&ßßá â
tßßä ã
.ßßã å
idßßå é
==ßßè ë

idAtencionßßí ú
)ßßú ù
.
®® 
Select
®® 
(
®® 
t
®® 
=>
®®  
new
®®! $
Atencion
®®% -
(
®®- .
)
®®. /
{
©© 
Id
™™ 
=
™™ 
t
™™ 
.
™™ 
id
™™ !
,
™™! "
Codigo
´´ 
=
´´  
t
´´! "
.
´´" #
codigo
´´# )
,
´´) *
TieneFacturacion
¨¨ (
=
¨¨) *
t
¨¨+ ,
.
¨¨, -
enum1
¨¨- 2
!=
¨¨3 5
(
¨¨6 7
int
¨¨7 :
)
¨¨: ;"
ModoFacturacionHotel
¨¨; O
.
¨¨O P
NoEspecificado
¨¨P ^
,
¨¨^ _(
ComprobantesOrdenPrincipal
≠≠ 2
=
≠≠3 4
t
≠≠5 6
.
≠≠6 7
Transaccion11
≠≠7 D
.
≠≠D E
Where
≠≠E J
(
≠≠J K
tr
≠≠K M
=>
≠≠N P
tr
≠≠Q S
.
≠≠S T!
id_tipo_transaccion
≠≠T g
==
≠≠h j!
TransaccionSettings
≠≠k ~
.
≠≠~ 
Default≠≠ Ü
.≠≠Ü á-
IdTipoTransaccionOrdenDeVenta≠≠á §
)≠≠§ •
.≠≠• ¶
Select≠≠¶ ¨
(≠≠¨ ≠
tr≠≠≠ Ø
=>≠≠∞ ≤
new≠≠≥ ∂$
ComprobanteFacturado≠≠∑ À
{
ÆÆ 
IdOrden
ØØ #
=
ØØ$ %
tr
ØØ& (
.
ØØ( )
id
ØØ) +
,
ØØ+ ,
}
∞∞ 
)
∞∞ 
,
∞∞ )
ComprobantesOrdenSecundario
±± 3
=
±±4 5
t
±±6 7
.
±±7 8
Transaccion3
±±8 D
.
±±D E
Transaccion11
±±E R
.
±±R S
Where
±±S X
(
±±X Y
tr
±±Y [
=>
±±\ ^
tr
±±_ a
.
±±a b!
id_tipo_transaccion
±±b u
==
±±v x"
TransaccionSettings±±y å
.±±å ç
Default±±ç î
.±±î ï-
IdTipoTransaccionOrdenDeVenta±±ï ≤
)±±≤ ≥
.±±≥ ¥
Select±±¥ ∫
(±±∫ ª
tr±±ª Ω
=>±±æ ¿
new±±¡ ƒ$
ComprobanteFacturado±±≈ Ÿ
{
≤≤ 
IdOrden
≥≥ #
=
≥≥$ %
tr
≥≥& (
.
≥≥( )
id
≥≥) +
,
≥≥+ ,
}
¥¥ 
)
¥¥ 
,
¥¥ -
ComprobantesReferenciaPrincipal
µµ 7
=
µµ8 9
t
µµ: ;
.
µµ; <
Transaccion11
µµ< I
.
µµI J

SelectMany
µµJ T
(
µµT U
ttr
µµU X
=>
µµY [
ttr
µµ\ _
.
µµ_ `
Transaccion11
µµ` m
)
µµm n
.
µµn o
Where
µµo t
(
µµt u
ttr
µµu x
=>
µµy {
(
µµ| }
ttrµµ} Ä
.µµÄ Å#
id_tipo_transaccionµµÅ î
==µµï ó#
TransaccionSettingsµµò ´
.µµ´ ¨
Defaultµµ¨ ≥
.µµ≥ ¥8
(IdTipoTransaccionOrdenDeAnulacionDeVentaµµ¥ ‹
&&µµ› ﬂ
ttrµµ‡ „
.µµ„ ‰
Comprobanteµµ‰ Ô
.µµÔ #
id_tipo_comprobanteµµ É
!=µµÑ Ü
MaestroSettingsµµá ñ
.µµñ ó
Defaultµµó û
.µµû ü=
-IdDetalleMaestroComprobanteNotaCreditoInternaµµü Ã
)µµÃ Õ
||µµŒ –
Diccionarioµµ— ‹
.µµ‹ ›n
^TiposDeTransaccionOrdenesDeOperacionesDeVentasSoloNotasDeCreditoYDebitoExceptoAnulacionDeVentaµµ› ª
.µµª º
Containsµµº ƒ
(µµƒ ≈
ttrµµ≈ »
.µµ» …#
id_tipo_transaccionµµ… ‹
)µµ‹ ›
)µµ› ﬁ
.µµﬁ ﬂ
Selectµµﬂ Â
(µµÂ Ê
trµµÊ Ë
=>µµÈ Î
newµµÏ Ô$
ComprobanteFacturadoµµ Ñ
{
∂∂ 
IdOrden
∑∑ #
=
∑∑$ %
tr
∑∑& (
.
∑∑( )
id
∑∑) +
,
∑∑+ ,
}
∏∏ 
)
∏∏ 
,
∏∏ .
 ComprobantesReferenciaSecundario
ππ 8
=
ππ9 :
t
ππ; <
.
ππ< =
Transaccion3
ππ= I
.
ππI J
Transaccion11
ππJ W
.
ππW X

SelectMany
ππX b
(
ππb c
ttr
ππc f
=>
ππg i
ttr
ππj m
.
ππm n
Transaccion11
ππn {
)
ππ{ |
.
ππ| }
Whereππ} Ç
(ππÇ É
ttrππÉ Ü
=>ππá â
(ππä ã
ttrππã é
.ππé è#
id_tipo_transaccionππè ¢
==ππ£ •#
TransaccionSettingsππ¶ π
.πππ ∫
Defaultππ∫ ¡
.ππ¡ ¬8
(IdTipoTransaccionOrdenDeAnulacionDeVentaππ¬ Í
&&ππÎ Ì
ttrππÓ Ò
.ππÒ Ú
ComprobanteππÚ ˝
.ππ˝ ˛#
id_tipo_comprobanteππ˛ ë
!=ππí î
MaestroSettingsππï §
.ππ§ •
Defaultππ• ¨
.ππ¨ ≠=
-IdDetalleMaestroComprobanteNotaCreditoInternaππ≠ ⁄
)ππ⁄ €
||ππ‹ ﬁ
Diccionarioππﬂ Í
.ππÍ În
^TiposDeTransaccionOrdenesDeOperacionesDeVentasSoloNotasDeCreditoYDebitoExceptoAnulacionDeVentaππÎ …
.ππ…  
Containsππ  “
(ππ“ ”
ttrππ” ÷
.ππ÷ ◊#
id_tipo_transaccionππ◊ Í
)ππÍ Î
)ππÎ Ï
.ππÏ Ì
SelectππÌ Û
(ππÛ Ù
trππÙ ˆ
=>ππ˜ ˘
newππ˙ ˝$
ComprobanteFacturadoππ˛ í
{
∫∫ 
IdOrden
ªª #
=
ªª$ %
tr
ªª& (
.
ªª( )
id
ªª) +
,
ªª+ ,
}
ºº 
)
ºº 
,
ºº 
OrdenPrincipal
ΩΩ &
=
ΩΩ' (
new
ΩΩ) ,
OrdenAtencion
ΩΩ- :
{
ææ 
Id
øø 
=
øø  
t
øø! "
.
øø" #
id
øø# %
,
øø% &
Codigo
¿¿ "
=
¿¿# $
t
¿¿% &
.
¿¿& '
codigo
¿¿' -
,
¿¿- .
FechaRegistro
¡¡ )
=
¡¡* +
t
¡¡, -
.
¡¡- .
fecha_inicio
¡¡. :
,
¡¡: ;
Importe
¬¬ #
=
¬¬$ %
t
¬¬& '
.
¬¬' (
importe_total
¬¬( 5
,
¬¬5 6
TieneFacturacion
√√ ,
=
√√- .
t
√√/ 0
.
√√0 1
enum1
√√1 6
!=
√√7 9
(
√√: ;
int
√√; >
)
√√> ?"
ModoFacturacionHotel
√√? S
.
√√S T
NoEspecificado
√√T b
,
√√b c
Detalles
ƒƒ $
=
ƒƒ% &
new
ƒƒ' *
List
ƒƒ+ /
<
ƒƒ/ 0"
DetalleOrdenAtencion
ƒƒ0 D
>
ƒƒD E
{
ƒƒF G
new
ƒƒH K"
DetalleOrdenAtencion
ƒƒL `
{
≈≈ 
Id
∆∆  "
=
∆∆# $
t
∆∆% &
.
∆∆& '
id
∆∆' )
,
∆∆) *

IdConcepto
««  *
=
««+ ,
(
««- .
int
««. 1
)
««1 2
t
««2 3
.
««3 4
Actor_negocio2
««4 B
.
««B C!
id_concepto_negocio
««C V
,
««V W
	IdFamilia
»»  )
=
»»* +
t
»», -
.
»»- .
Actor_negocio2
»». <
.
»»< =
Concepto_negocio
»»= M
.
»»M N 
id_concepto_basico
»»N `
,
»»` a
NombreConcepto
……  .
=
……/ 0
t
……1 2
.
……2 3
Actor_negocio2
……3 A
.
……A B
Concepto_negocio
……B R
.
……R S
nombre
……S Y
+
……Z [
$str
……\ a
+
……b c
t
……d e
.
……e f
Actor_negocio2
……f t
.
……t u
Actor
……u z
.
……z {)
numero_documento_identidad……{ ï
,……ï ñ
Cantidad
    (
=
  ) *
t
  + ,
.
  , -
	cantidad1
  - 6
,
  6 7
PrecioUnitario
ÀÀ  .
=
ÀÀ/ 0
t
ÀÀ1 2
.
ÀÀ2 3
importe1
ÀÀ3 ;
,
ÀÀ; <
Importe
ÃÃ  '
=
ÃÃ( )
t
ÃÃ* +
.
ÃÃ+ ,
importe_total
ÃÃ, 9
,
ÃÃ9 :
IdEstadoActual
ÕÕ  .
=
ÕÕ/ 0
(
ÕÕ1 2
int
ÕÕ2 5
)
ÕÕ5 6
t
ÕÕ6 7
.
ÕÕ7 8
id_estado_actual
ÕÕ8 H
}
ŒŒ 
}
ŒŒ 
}
œœ 
,
œœ 
Ordenes
–– 
=
––  !
t
––" #
.
––# $
Transaccion11
––$ 1
.
––1 2
Where
––2 7
(
––7 8
trr
––8 ;
=>
––< >
trr
––? B
.
––B C!
id_tipo_transaccion
––C V
==
––W Y!
TransaccionSettings
––Z m
.
––m n
Default
––n u
.
––u v6
'IdTipoTransaccionOrdenConsumoHabitacion––v ù
&&––û †
trr––° §
.––§ • 
id_estado_actual––• µ
==––∂ ∏
MaestroSettings––π »
.––» …
Default––… –
.––– —0
 IdDetalleMaestroEstadoConfirmado––— Ò
)––Ò Ú
.––Ú Û
Select––Û ˘
(––˘ ˙
tr––˙ ¸
=>––˝ ˇ
new––Ä É
OrdenAtencion––Ñ ë
{
—— 
Id
““ 
=
““  
tr
““! #
.
““# $
id
““$ &
,
““& '
Codigo
”” "
=
””# $
tr
””% '
.
””' (
Actor_negocio1
””( 6
.
””6 7
Actor
””7 <
.
””< =
primer_nombre
””= J
,
””J K
FechaRegistro
‘‘ )
=
‘‘* +
tr
‘‘, .
.
‘‘. /
fecha_inicio
‘‘/ ;
,
‘‘; <
Importe
’’ #
=
’’$ %
tr
’’& (
.
’’( )
importe_total
’’) 6
,
’’6 7
TieneFacturacion
÷÷ ,
=
÷÷- .
tr
÷÷/ 1
.
÷÷1 2 
Evento_transaccion
÷÷2 D
.
÷÷D E
Select
÷÷E K
(
÷÷K L
ev
÷÷L N
=>
÷÷O Q
ev
÷÷R T
.
÷÷T U
	id_evento
÷÷U ^
)
÷÷^ _
.
÷÷_ `
Contains
÷÷` h
(
÷÷h i
MaestroSettings
÷÷i x
.
÷÷x y
Default÷÷y Ä
.÷÷Ä Å/
IdDetalleMaestroEstadoFacturado÷÷Å †
)÷÷† °
,÷÷° ¢
Detalles
◊◊ $
=
◊◊% &
tr
◊◊' )
.
◊◊) *!
Detalle_transaccion
◊◊* =
.
◊◊= >
Distinct
◊◊> F
(
◊◊F G
)
◊◊G H
.
◊◊H I
Select
◊◊I O
(
◊◊O P
dtr
◊◊P S
=>
◊◊T V
new
◊◊W Z"
DetalleOrdenAtencion
◊◊[ o
{
ÿÿ 
Id
ŸŸ  "
=
ŸŸ# $
dtr
ŸŸ% (
.
ŸŸ( )
id
ŸŸ) +
,
ŸŸ+ ,

IdConcepto
⁄⁄  *
=
⁄⁄+ ,
dtr
⁄⁄- 0
.
⁄⁄0 1!
id_concepto_negocio
⁄⁄1 D
,
⁄⁄D E
	IdFamilia
€€  )
=
€€* +
dtr
€€, /
.
€€/ 0
Concepto_negocio
€€0 @
.
€€@ A 
id_concepto_basico
€€A S
,
€€S T
NombreConcepto
‹‹  .
=
‹‹/ 0
dtr
‹‹1 4
.
‹‹4 5
Concepto_negocio
‹‹5 E
.
‹‹E F
nombre
‹‹F L
,
‹‹L M
Cantidad
››  (
=
››) *
dtr
››+ .
.
››. /
cantidad
››/ 7
,
››7 8
PrecioUnitario
ﬁﬁ  .
=
ﬁﬁ/ 0
dtr
ﬁﬁ1 4
.
ﬁﬁ4 5
precio_unitario
ﬁﬁ5 D
,
ﬁﬁD E
Importe
ﬂﬂ  '
=
ﬂﬂ( )
dtr
ﬂﬂ* -
.
ﬂﬂ- .
total
ﬂﬂ. 3
,
ﬂﬂ3 4
IdEstadoActual
‡‡  .
=
‡‡/ 0
$num
‡‡1 2
}
·· 
)
·· 
}
‚‚ 
)
‚‚ 
.
‚‚ 
ToList
‚‚ !
(
‚‚! "
)
‚‚" #
}
„„ 
)
„„ 
.
„„ 
SingleOrDefault
„„ &
(
„„& '
)
„„' (
;
„„( )
}
‰‰ 
catch
ÂÂ 
(
ÂÂ 
	Exception
ÂÂ 
e
ÂÂ 
)
ÂÂ 
{
ÊÊ 
throw
ÁÁ 
new
ÁÁ 
DatosException
ÁÁ (
(
ÁÁ( )
$str
ÁÁ) ]
,
ÁÁ] ^
e
ÁÁ_ `
)
ÁÁ` a
;
ÁÁa b
}
ËË 
}
ÈÈ 	
public
ÍÍ 
OperationResult
ÍÍ -
ActualizarComentarioTransaccion
ÍÍ >
(
ÍÍ> ?
long
ÍÍ? C
idTransaccion
ÍÍD Q
,
ÍÍQ R
string
ÍÍS Y

comentario
ÍÍZ d
)
ÍÍd e
{
ÎÎ 	
try
ÏÏ 
{
ÌÌ 
Transaccion
ÓÓ 
dbTransaccion
ÓÓ )
=
ÓÓ* +
_db
ÓÓ, /
.
ÓÓ/ 0
Transaccion
ÓÓ0 ;
.
ÓÓ; <
Single
ÓÓ< B
(
ÓÓB C
m
ÓÓC D
=>
ÓÓE G
m
ÓÓH I
.
ÓÓI J
id
ÓÓJ L
==
ÓÓM O
idTransaccion
ÓÓP ]
)
ÓÓ] ^
;
ÓÓ^ _
dbTransaccion
ÔÔ 
.
ÔÔ 

comentario
ÔÔ (
=
ÔÔ) *

comentario
ÔÔ+ 5
;
ÔÔ5 6
var
 
result
 
=
 
Save
 !
(
! "
)
" #
;
# $
return
ÒÒ 
result
ÒÒ 
;
ÒÒ 
}
ÚÚ 
catch
ÛÛ 
(
ÛÛ 
	Exception
ÛÛ 
e
ÛÛ 
)
ÛÛ 
{
ÙÙ 
throw
ıı 
new
ıı 
DatosException
ıı (
(
ıı( )
$str
ıı) [
,
ıı[ \
e
ıı] ^
)
ıı^ _
;
ıı_ `
}
ˆˆ 
}
˜˜ 	
public
¯¯ 
Transaccion
¯¯ -
ObtenerTransaccionAtencionMacro
¯¯ :
(
¯¯: ;
long
¯¯; ?
idAtencionMacro
¯¯@ O
)
¯¯O P
{
˘˘ 	
try
˙˙ 
{
˚˚ 
return
¸¸ 
_db
¸¸ 
.
¸¸ 
Transaccion
¸¸ &
.
¸¸& '
Single
¸¸' -
(
¸¸- .
t
¸¸. /
=>
¸¸0 2
t
¸¸3 4
.
¸¸4 5!
id_tipo_transaccion
¸¸5 H
==
¸¸I K
HotelSettings
¸¸L Y
.
¸¸Y Z
Default
¸¸Z a
.
¸¸a b/
 IdTipoTransaccionAtencionDeHotel¸¸b Ç
&&¸¸É Ö
t¸¸Ü á
.¸¸á à
id¸¸à ä
==¸¸ã ç
idAtencionMacro¸¸é ù
)¸¸ù û
;¸¸û ü
}
˝˝ 
catch
˛˛ 
(
˛˛ 
	Exception
˛˛ 
e
˛˛ 
)
˛˛ 
{
ˇˇ 
throw
ÄÄ 
new
ÄÄ 
DatosException
ÄÄ (
(
ÄÄ( )
$str
ÄÄ) S
,
ÄÄS T
e
ÄÄU V
)
ÄÄV W
;
ÄÄW X
}
ÅÅ 
}
ÇÇ 	
public
ÉÉ 
Transaccion
ÉÉ (
ObtenerTransaccionAtencion
ÉÉ 5
(
ÉÉ5 6
long
ÉÉ6 :

idAtencion
ÉÉ; E
)
ÉÉE F
{
ÑÑ 	
try
ÖÖ 
{
ÜÜ 
return
áá 
_db
áá 
.
áá 
Transaccion
áá &
.
áá& '
Include
áá' .
(
áá. /
t
áá/ 0
=>
áá1 3
t
áá4 5
.
áá5 6 
Estado_transaccion
áá6 H
)
ááH I
.
ááI J
Include
ááJ Q
(
ááQ R
t
ááR S
=>
ááT V
t
ááW X
.
ááX Y
Detalle_maestro
ááY h
)
ááh i
.
áái j
Single
ááj p
(
ááp q
t
ááq r
=>
áás u
t
ááv w
.
ááw x"
id_tipo_transaccionááx ã
==ááå é
HotelSettingsááè ú
.ááú ù
Defaultááù §
.áá§ •5
%IdTipoTransaccionAtencionDeHabitacionáá•  
&&ááÀ Õ
tááŒ œ
.ááœ –
idáá– “
==áá” ’

idAtencionáá÷ ‡
)áá‡ ·
;áá· ‚
}
àà 
catch
ââ 
(
ââ 
	Exception
ââ 
e
ââ 
)
ââ 
{
ää 
throw
ãã 
new
ãã 
DatosException
ãã (
(
ãã( )
$str
ãã) S
,
ããS T
e
ããU V
)
ããV W
;
ããW X
}
åå 
}
çç 	
public
éé 
IEnumerable
éé 
<
éé 
Transaccion
éé &
>
éé& '6
(ObtenerTransaccionesHijasDeAtencionMacro
éé( P
(
ééP Q
long
ééQ U
idAtencionMacro
ééV e
)
éée f
{
èè 	
try
êê 
{
ëë 
return
íí 
_db
íí 
.
íí 
Transaccion
íí &
.
íí& '
Include
íí' .
(
íí. /
t
íí/ 0
=>
íí1 3
t
íí4 5
.
íí5 6
Transaccion1
íí6 B
)
ííB C
.
ííC D
Include
ííD K
(
ííK L
t
ííL M
=>
ííN P
t
ííQ R
.
ííR S 
Estado_transaccion
ííS e
)
ííe f
.
ííf g
Include
ííg n
(
íín o
t
íío p
=>
ííq s
t
íít u
.
ííu v
Detalle_maestroíív Ö
)ííÖ Ü
.ííÜ á
Whereííá å
(ííå ç
tííç é
=>ííè ë
tííí ì
.ííì î#
id_tipo_transaccionííî ß
==íí® ™
HotelSettingsíí´ ∏
.íí∏ π
Defaultííπ ¿
.íí¿ ¡0
 IdTipoTransaccionAtencionDeHotelíí¡ ·
&&íí‚ ‰
tííÂ Ê
.ííÊ Á
idííÁ È
==ííÍ Ï
idAtencionMacroííÌ ¸
)íí¸ ˝
.íí˝ ˛

SelectManyíí˛ à
(ííà â
tííâ ä
=>ííã ç
tííé è
.ííè ê
Transaccion1ííê ú
)ííú ù
;ííù û
}
ìì 
catch
îî 
(
îî 
	Exception
îî 
e
îî 
)
îî 
{
ïï 
throw
ññ 
new
ññ 
DatosException
ññ (
(
ññ( )
$str
ññ) d
,
ññd e
e
ññf g
)
ññg h
;
ññh i
}
óó 
}
òò 	
public
ôô 
Transaccion
ôô /
!ObtenerTransaccionPadreDeAtencion
ôô <
(
ôô< =
long
ôô= A

idAtencion
ôôB L
)
ôôL M
{
öö 	
try
õõ 
{
úú 
return
ùù 
_db
ùù 
.
ùù 
Transaccion
ùù &
.
ùù& '
Single
ùù' -
(
ùù- .
t
ùù. /
=>
ùù0 2
t
ùù3 4
.
ùù4 5!
id_tipo_transaccion
ùù5 H
==
ùùI K
HotelSettings
ùùL Y
.
ùùY Z
Default
ùùZ a
.
ùùa b4
%IdTipoTransaccionAtencionDeHabitacionùùb á
&&ùùà ä
tùùã å
.ùùå ç
idùùç è
==ùùê í

idAtencionùùì ù
)ùùù û
.ùùû ü
Transaccion2ùùü ´
;ùù´ ¨
}
ûû 
catch
üü 
(
üü 
	Exception
üü 
e
üü 
)
üü 
{
†† 
throw
°° 
new
°° 
DatosException
°° (
(
°°( )
$str
°°) U
,
°°U V
e
°°W X
)
°°X Y
;
°°Y Z
}
¢¢ 
}
££ 	
public
ßß 
IEnumerable
ßß 
<
ßß 
RoomType
ßß #
>
ßß# $
ObtenerRoomType
ßß% 4
(
ßß4 5
)
ßß5 6
{
®® 	
try
©© 
{
™™ 
return
´´ 
_db
´´ 
.
´´ 
Detalle_maestro
´´ *
.
´´* +
Where
´´+ 0
(
´´0 1
dm
´´1 3
=>
´´4 6
dm
´´7 9
.
´´9 :

id_maestro
´´: D
==
´´E G
$num
´´H L
)
´´L M
.
´´M N
Select
´´N T
(
´´T U
dm
´´U W
=>
´´X Z
new
´´[ ^
RoomType
´´_ g
(
´´g h
)
´´h i
{
¨¨ 
Id
≠≠ 
=
≠≠ 
dm
≠≠ 
.
≠≠ 
id
≠≠ 
,
≠≠ 
Name
ÆÆ 
=
ÆÆ 
dm
ÆÆ 
.
ÆÆ 
nombre
ÆÆ $
,
ÆÆ$ %
}
ØØ 
)
ØØ 
;
ØØ 
}
∞∞ 
catch
±± 
(
±± 
	Exception
±± 
e
±± 
)
±± 
{
≤≤ 
throw
¥¥ 
new
¥¥ 
DatosException
¥¥ (
(
¥¥( )
$str
¥¥) U
,
¥¥U V
e
¥¥W X
)
¥¥X Y
;
¥¥Y Z
}
µµ 
}
∂∂ 	
public
∫∫ 
IEnumerable
∫∫ 
<
∫∫ 
Consumo
∫∫ "
>
∫∫" #
ObtenerConsumos
∫∫$ 3
(
∫∫3 4
int
∫∫4 7
idEstablecimiento
∫∫8 I
,
∫∫I J
DateTime
∫∫K S

fechaDesde
∫∫T ^
,
∫∫^ _
DateTime
∫∫` h

fechaHasta
∫∫i s
)
∫∫s t
{
ªª 	
try
ºº 
{
ΩΩ 
return
ææ 
_db
ææ 
.
ææ 
Transaccion
ææ &
.
ææ& '
Where
ææ' ,
(
ææ, -
t
ææ- .
=>
ææ/ 1
t
ææ2 3
.
ææ3 4!
id_tipo_transaccion
ææ4 G
==
ææH J!
TransaccionSettings
ææK ^
.
ææ^ _
Default
ææ_ f
.
ææf g6
'IdTipoTransaccionOrdenConsumoHabitacionææg é
&&ææè ë
tææí ì
.ææì î
Actor_negocio4ææî ¢
.ææ¢ £
Actor_negocio2ææ£ ±
.ææ± ≤&
id_actor_negocio_padreææ≤ »
==ææ… À!
idEstablecimientoææÃ ›
&&ææﬁ ‡
tææ· ‚
.ææ‚ „
fecha_inicioææ„ Ô
>=ææ Ú

fechaDesdeææÛ ˝
&&ææ˛ Ä
tææÅ Ç
.ææÇ É
fecha_inicioææÉ è
<=ææê í

fechaHastaææì ù
)ææù û
.
øø 
Select
øø 
(
øø 
t
øø 
=>
øø  
new
øø! $
Consumo
øø% ,
(
øø, -
)
øø- .
{
¿¿ 
Id
¡¡ 
=
¡¡ 
t
¡¡ 
.
¡¡ 
id
¡¡ !
,
¡¡! "
CodigoHabitacion
¬¬ (
=
¬¬) *
t
¬¬+ ,
.
¬¬, -
Actor_negocio4
¬¬- ;
.
¬¬; <
Actor
¬¬< A
.
¬¬A B(
numero_documento_identidad
¬¬B \
,
¬¬\ ]
	Facturado
√√ !
=
√√" #
t
√√$ %
.
√√% & 
Evento_transaccion
√√& 8
.
√√8 9
Select
√√9 ?
(
√√? @
ev
√√@ B
=>
√√C E
ev
√√F H
.
√√H I
	id_evento
√√I R
)
√√R S
.
√√S T
Contains
√√T \
(
√√\ ]
MaestroSettings
√√] l
.
√√l m
Default
√√m t
.
√√t u.
IdDetalleMaestroEstadoFacturado√√u î
)√√î ï
,√√ï ñ
Fecha
ƒƒ 
=
ƒƒ 
t
ƒƒ  !
.
ƒƒ! "
fecha_inicio
ƒƒ" .
,
ƒƒ. /
IdEstado
≈≈  
=
≈≈! "
(
≈≈# $
int
≈≈$ '
)
≈≈' (
t
≈≈( )
.
≈≈) *
id_estado_actual
≈≈* :
,
≈≈: ;
Huesped
∆∆ 
=
∆∆  !
t
∆∆" #
.
∆∆# $
Actor_negocio1
∆∆$ 2
.
∆∆2 3
Actor
∆∆3 8
.
∆∆8 9
primer_nombre
∆∆9 F
.
∆∆F G
Replace
∆∆G N
(
∆∆N O
$str
∆∆O R
,
∆∆R S
$str
∆∆T W
)
∆∆W X
,
∆∆X Y
Importe
«« 
=
««  !
t
««" #
.
««# $
importe_total
««$ 1
,
««1 2
TipoHabitacion
»» &
=
»»' (
t
»») *
.
»»* +
Actor_negocio4
»»+ 9
.
»»9 :
Concepto_negocio
»»: J
.
»»J K
sufijo
»»K Q
,
»»Q R
DetallesConsumo
…… '
=
……( )
t
……* +
.
……+ ,!
Detalle_transaccion
……, ?
.
……? @
Select
……@ F
(
……F G
dt
……G I
=>
……J L
new
……M P
DetalleConsumo
……Q _
{
   
Id
ÀÀ 
=
ÀÀ  
dt
ÀÀ! #
.
ÀÀ# $
id
ÀÀ$ &
,
ÀÀ& '
Nombre
ÃÃ "
=
ÃÃ# $
dt
ÃÃ% '
.
ÃÃ' (
Concepto_negocio
ÃÃ( 8
.
ÃÃ8 9
nombre
ÃÃ9 ?
,
ÃÃ? @
Cantidad
ÕÕ $
=
ÕÕ% &
dt
ÕÕ' )
.
ÕÕ) *
cantidad
ÕÕ* 2
,
ÕÕ2 3
PrecioUnitario
ŒŒ *
=
ŒŒ+ ,
dt
ŒŒ- /
.
ŒŒ/ 0
precio_unitario
ŒŒ0 ?
,
ŒŒ? @
Importe
œœ #
=
œœ$ %
dt
œœ& (
.
œœ( )
total
œœ) .
,
œœ. /
}
–– 
)
–– 
.
–– 
ToList
–– !
(
––! "
)
––" #
}
—— 
)
—— 
;
—— 
}
““ 
catch
”” 
(
”” 
	Exception
”” 
e
”” 
)
”” 
{
‘‘ 
throw
’’ 
new
’’ 
DatosException
’’ (
(
’’( )
$str
’’) R
,
’’R S
e
’’T U
)
’’U V
;
’’V W
}
÷÷ 
}
◊◊ 	
public
ŸŸ 
ConsumoHabitacion
ŸŸ  &
ObtenerConsumoHabitacion
ŸŸ! 9
(
ŸŸ9 :
int
ŸŸ: =

idAtencion
ŸŸ> H
)
ŸŸH I
{
⁄⁄ 	
try
€€ 
{
‹‹ 
return
›› 
_db
›› 
.
›› 
Transaccion
›› &
.
››& '
Where
››' ,
(
››, -
t
››- .
=>
››/ 1
t
››2 3
.
››3 4
id
››4 6
==
››7 9

idAtencion
››: D
)
››D E
.
ﬁﬁ 
Select
ﬁﬁ 
(
ﬁﬁ 
t
ﬁﬁ 
=>
ﬁﬁ  
new
ﬁﬁ! $
ConsumoHabitacion
ﬁﬁ% 6
(
ﬁﬁ6 7
)
ﬁﬁ7 8
{
ﬂﬂ 

IdAtencion
‡‡ "
=
‡‡# $
t
‡‡% &
.
‡‡& '
id
‡‡' )
,
‡‡) *
IdHabitacion
·· $
=
··% &
t
··' (
.
··( )&
id_actor_negocio_interno
··) A
,
··A B

FechaDesde
‚‚ "
=
‚‚# $
t
‚‚% &
.
‚‚& '
fecha_inicio
‚‚' 3
,
‚‚3 4

FechaHasta
„„ "
=
„„# $
t
„„% &
.
„„& '
	fecha_fin
„„' 0
,
„„0 1
	Huespedes
‰‰ !
=
‰‰" #
t
‰‰$ %
.
‰‰% &+
Actor_negocio_por_transaccion
‰‰& C
.
‰‰C D
Select
‰‰D J
(
‰‰J K
at
‰‰K M
=>
‰‰N P
new
‰‰Q T
ItemGenerico
‰‰U a
{
ÂÂ 
Id
ÊÊ 
=
ÊÊ  
at
ÊÊ! #
.
ÊÊ# $
id_actor_negocio
ÊÊ$ 4
,
ÊÊ4 5
Nombre
ÁÁ "
=
ÁÁ# $
at
ÁÁ% '
.
ÁÁ' (
Actor_negocio
ÁÁ( 5
.
ÁÁ5 6
Actor
ÁÁ6 ;
.
ÁÁ; <
primer_nombre
ÁÁ< I
.
ÁÁI J
Replace
ÁÁJ Q
(
ÁÁQ R
$str
ÁÁR U
,
ÁÁU V
$str
ÁÁW Z
)
ÁÁZ [
,
ÁÁ[ \
Valor
ËË !
=
ËË" #
at
ËË$ &
.
ËË& '
extension_json
ËË' 5
}
ÈÈ 
)
ÈÈ 
.
ÈÈ 
ToList
ÈÈ !
(
ÈÈ! "
)
ÈÈ" #
,
ÈÈ# $
Consumos
ÍÍ  
=
ÍÍ! "
t
ÍÍ# $
.
ÍÍ$ %
Transaccion11
ÍÍ% 2
.
ÍÍ2 3
Where
ÍÍ3 8
(
ÍÍ8 9
tt
ÍÍ9 ;
=>
ÍÍ< >
tt
ÍÍ? A
.
ÍÍA B!
id_tipo_transaccion
ÍÍB U
==
ÍÍV X!
TransaccionSettings
ÍÍY l
.
ÍÍl m
Default
ÍÍm t
.
ÍÍt u6
'IdTipoTransaccionOrdenConsumoHabitacionÍÍu ú
&&ÍÍù ü
ttÍÍ† ¢
.ÍÍ¢ £ 
id_estado_actualÍÍ£ ≥
==ÍÍ¥ ∂
MaestroSettingsÍÍ∑ ∆
.ÍÍ∆ «
DefaultÍÍ« Œ
.ÍÍŒ œ0
 IdDetalleMaestroEstadoConfirmadoÍÍœ Ô
)ÍÍÔ 
.ÍÍ Ò
SelectÍÍÒ ˜
(ÍÍ˜ ¯
ttÍÍ¯ ˙
=>ÍÍ˚ ˝
newÍÍ˛ Å
ConsumoSimpleÍÍÇ è
{
ÎÎ 
Id
ÏÏ 
=
ÏÏ  
tt
ÏÏ! #
.
ÏÏ# $
id
ÏÏ$ &
,
ÏÏ& '
Fecha
ÌÌ !
=
ÌÌ" #
tt
ÌÌ$ &
.
ÌÌ& '
fecha_inicio
ÌÌ' 3
,
ÌÌ3 4
Huesped
ÓÓ #
=
ÓÓ$ %
tt
ÓÓ& (
.
ÓÓ( )
Actor_negocio1
ÓÓ) 7
.
ÓÓ7 8
Actor
ÓÓ8 =
.
ÓÓ= >
primer_nombre
ÓÓ> K
.
ÓÓK L
Replace
ÓÓL S
(
ÓÓS T
$str
ÓÓT W
,
ÓÓW X
$str
ÓÓY \
)
ÓÓ\ ]
,
ÓÓ] ^
Importe
ÔÔ #
=
ÔÔ$ %
tt
ÔÔ& (
.
ÔÔ( )
importe_total
ÔÔ) 6
,
ÔÔ6 7
DetallesConsumo
 +
=
, -
tt
. 0
.
0 1!
Detalle_transaccion
1 D
.
D E
Select
E K
(
K L
dt
L N
=>
O Q
new
R U
DetalleConsumo
V d
{
ÒÒ 
Id
ÚÚ  "
=
ÚÚ# $
dt
ÚÚ% '
.
ÚÚ' (
id
ÚÚ( *
,
ÚÚ* +
Nombre
ÛÛ  &
=
ÛÛ' (
dt
ÛÛ) +
.
ÛÛ+ ,
Concepto_negocio
ÛÛ, <
.
ÛÛ< =
nombre
ÛÛ= C
,
ÛÛC D
Cantidad
ÙÙ  (
=
ÙÙ) *
dt
ÙÙ+ -
.
ÙÙ- .
cantidad
ÙÙ. 6
,
ÙÙ6 7
PrecioUnitario
ıı  .
=
ıı/ 0
dt
ıı1 3
.
ıı3 4
precio_unitario
ıı4 C
,
ııC D
Importe
ˆˆ  '
=
ˆˆ( )
dt
ˆˆ* ,
.
ˆˆ, -
total
ˆˆ- 2
,
ˆˆ2 3
}
˜˜ 
)
˜˜ 
.
˜˜ 
ToList
˜˜ %
(
˜˜% &
)
˜˜& '
}
¯¯ 
)
¯¯ 
.
¯¯ 
ToList
¯¯ !
(
¯¯! "
)
¯¯" #
}
˘˘ 
)
˘˘ 
.
˘˘ 
FirstOrDefault
˘˘ %
(
˘˘% &
)
˘˘& '
;
˘˘' (
}
˙˙ 
catch
˚˚ 
(
˚˚ 
	Exception
˚˚ 
e
˚˚ 
)
˚˚ 
{
¸¸ 
throw
˝˝ 
new
˝˝ 
DatosException
˝˝ (
(
˝˝( )
$str
˝˝) ^
,
˝˝^ _
e
˝˝` a
)
˝˝a b
;
˝˝b c
}
˛˛ 
}
ˇˇ 	
public
ÅÅ 
IEnumerable
ÅÅ 
<
ÅÅ 
ItemGenerico
ÅÅ '
>
ÅÅ' (:
,ObtenerAtencionesEnCheckedInComoHabitaciones
ÅÅ) U
(
ÅÅU V
int
ÅÅV Y
idEstablecimiento
ÅÅZ k
)
ÅÅk l
{
ÇÇ 	
try
ÉÉ 
{
ÑÑ 
var
ÖÖ  
idEstadosEnCheckin
ÖÖ &
=
ÖÖ' (
new
ÖÖ) ,
int
ÖÖ- 0
[
ÖÖ0 1
]
ÖÖ1 2
{
ÖÖ3 4
MaestroSettings
ÖÖ5 D
.
ÖÖD E
Default
ÖÖE L
.
ÖÖL M-
IdDetalleMaestroEstadoCheckedIn
ÖÖM l
,
ÖÖl m
MaestroSettings
ÖÖn }
.
ÖÖ} ~
DefaultÖÖ~ Ö
.ÖÖÖ Ü5
%IdDetalleMaestroEstadoEntradaCambiadoÖÖÜ ´
}ÖÖ¨ ≠
;ÖÖ≠ Æ
return
ÜÜ 
_db
ÜÜ 
.
ÜÜ 
Transaccion
ÜÜ &
.
ÜÜ& '
Where
ÜÜ' ,
(
ÜÜ, -
t
ÜÜ- .
=>
ÜÜ/ 1
t
ÜÜ2 3
.
ÜÜ3 4!
id_tipo_transaccion
ÜÜ4 G
==
ÜÜH J
HotelSettings
ÜÜK X
.
ÜÜX Y
Default
ÜÜY `
.
ÜÜ` a4
%IdTipoTransaccionAtencionDeHabitacionÜÜa Ü
&&ÜÜá â"
idEstadosEnCheckinÜÜä ú
.ÜÜú ù
ContainsÜÜù •
(ÜÜ• ¶
(ÜÜ¶ ß
intÜÜß ™
)ÜÜ™ ´
tÜÜ´ ¨
.ÜÜ¨ ≠ 
id_estado_actualÜÜ≠ Ω
)ÜÜΩ æ
&&ÜÜø ¡
tÜÜ¬ √
.ÜÜ√ ƒ
Actor_negocio2ÜÜƒ “
.ÜÜ“ ”
Actor_negocio2ÜÜ” ·
.ÜÜ· ‚&
id_actor_negocio_padreÜÜ‚ ¯
==ÜÜ˘ ˚!
idEstablecimientoÜÜ¸ ç
)ÜÜç é
.
áá 
Select
áá 
(
áá 
t
áá 
=>
áá  
new
áá! $
ItemGenerico
áá% 1
(
áá1 2
)
áá2 3
{
àà 
Id
ââ 
=
ââ 
(
ââ 
int
ââ !
)
ââ! "
t
ââ" #
.
ââ# $
id
ââ$ &
,
ââ& '
Nombre
ää 
=
ää  
t
ää! "
.
ää" #
Actor_negocio2
ää# 1
.
ää1 2
Concepto_negocio
ää2 B
.
ääB C
sufijo
ääC I
+
ääJ K
$str
ääL Q
+
ääR S
t
ääT U
.
ääU V
Actor_negocio2
ääV d
.
ääd e
Actor
ääe j
.
ääj k)
numero_documento_identidadääk Ö
}
ãã 
)
ãã 
;
ãã 
}
åå 
catch
çç 
(
çç 
	Exception
çç 
e
çç 
)
çç 
{
éé 
throw
èè 
new
èè 
DatosException
èè (
(
èè( )
$str
èè) a
,
èèa b
e
èèc d
)
èèd e
;
èèe f
}
êê 
}
ëë 	
}
îî 
}ïï ≤û
XD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\Restaurant\RestauranteDatos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
." #

Restaurant# -
{ 
public 

partial 
class 
RestauranteDatos )
:* +
RepositorioBase, ;
,; <#
IRestauranteRepositorio= T
{ 
public 
IEnumerable 
< 
Familia "
>" #&
ObtenerFamiliasSuperficial$ >
(> ?
)? @
{ 	
var $
idRolConceptoRestaurante (
=) *
RestauranteSettings+ >
.> ?
Default? F
.F G$
IdRolConceptoRestauranteG _
;_ `
IEnumerable 
< 
Familia 
>  
Familias! )
=* +
_db, /
./ 0 
Concepto_negocio_rol0 D
.D E
WhereE J
(J K
cnrK N
=>O Q
cnrR U
.U V
id_rolV \
==] _$
idRolConceptoRestaurante` x
)x y
.y z
Select	z Ä
(
Ä Å
cnr
Å Ñ
=>
Ö á
cnr
à ã
.
ã å
Concepto_negocio
å ú
.
ú ù
Detalle_maestro4
ù ≠
)
≠ Æ
.
Æ Ø
Select
Ø µ
(
µ ∂
dm
∂ ∏
=>
π ª
new
º ø
Familia
¿ «
(
« »
)
» …
{ 
Id 
= 
dm 
. 
id 
, 
Nombre 
= 
dm 
. 
nombre "
} 
) 
. 
ToList 
( 
) 
; 
return 
Familias 
; 
} 	
public!! 
OperationResult!! 
CalcularAtencion!! /
(!!/ 0
long!!0 4

idAtencion!!5 ?
)!!? @
{"" 	
try## 
{$$ 
var%% 
atencion%% 
=%% 
_db%% "
.%%" #
Transaccion%%# .
.%%. /
FirstOrDefault%%/ =
(%%= >
t%%> ?
=>%%@ B
t%%C D
.%%D E
id%%E G
==%%H J

idAtencion%%K U
)%%U V
;%%V W
atencion&& 
.&& 
importe_total&& &
=&&' (
atencion&&) 1
.&&1 2
Transaccion1&&2 >
.&&> ?
Sum&&? B
(&&B C
t&&C D
=>&&E G
t&&H I
.&&I J
importe_total&&J W
)&&W X
;&&X Y
var'' 
result'' 
='' 
Save'' !
(''! "
)''" #
;''# $
result(( 
.(( 
data(( 
=(( 
atencion(( &
.((& '
id((' )
;(() *
result)) 
.)) 
information)) "
=))# $
atencion))% -
;))- .
return** 
result** 
;** 
}++ 
catch,, 
(,, 
	Exception,, 
e,, 
),, 
{-- 
throw.. 
new.. 
DatosException.. (
(..( )
$str..) E
,..E F
e..G H
)..H I
;..I J
}00 
}11 	
public22 
OperationResult22 K
?ActualizarEstadoDeDetalleDeOrden_CalcularOrden_CalcularAtencion22 ^
(22^ _
int22_ b
idDetalleDeOrden22c s
,22s t#
EstadoDeDetalleDeOrden	22u ã
estado
22å í
)
22í ì
{33 	
try44 
{55 
OperationResult66 
result66  &
=66' (
new66) ,
OperationResult66- <
(66< =
)66= >
;66> ?
var77 
idsEstadosASumar77 $
=77% &
new77' *
int77+ .
[77. /
]77/ 0
{771 2
(773 4
int774 7
)777 8"
EstadoDeDetalleDeOrden778 N
.77N O
Atendido77O W
,77W X
(77Y Z
int77Z ]
)77] ^"
EstadoDeDetalleDeOrden77^ t
.77t u
	Observado77u ~
,77~ 
(
77Ä Å
int
77Å Ñ
)
77Ñ Ö$
EstadoDeDetalleDeOrden
77Ö õ
.
77õ ú
Preparacion
77ú ß
,
77ß ®
(
77© ™
int
77™ ≠
)
77≠ Æ$
EstadoDeDetalleDeOrden
77Æ ƒ
.
77ƒ ≈

Registrado
77≈ œ
,
77œ –
(
77— “
int
77“ ’
)
77’ ÷$
EstadoDeDetalleDeOrden
77÷ Ï
.
77Ï Ì
Servido
77Ì Ù
}
77ı ˆ
;
77ˆ ˜
var88 
idEstado88 
=88 
(88  
int88  #
)88# $
estado88$ *
;88* +
Detalle_transaccion:: #
	dbdetalle::$ -
=::. /
_db::0 3
.::3 4
Detalle_transaccion::4 G
.::G H
Where::H M
(::M N
dt::N P
=>::Q S
dt::T V
.::V W
id::W Y
==::Z \
idDetalleDeOrden::] m
)::m n
.::n o
FirstOrDefault::o }
(::} ~
)::~ 
;	:: Ä
	dbdetalle<< 
.<< #
indicadorMultiproposito<< 1
=<<2 3
idEstado<<4 <
;<<< =
var== 
sumaDetalles==  
===! "
	dbdetalle==# ,
.==, -
Transaccion==- 8
.==8 9
Detalle_transaccion==9 L
.==L M
Where==M R
(==R S
dt==S U
=>==V X
idsEstadosASumar==Y i
.==i j
Contains==j r
(==r s
(==s t
int==t w
)==w x
dt==x z
.==z {$
indicadorMultiproposito	=={ í
)
==í ì
)
==ì î
.
==î ï
Sum
==ï ò
(
==ò ô
dt
==ô õ
=>
==ú û
dt
==ü °
.
==° ¢
total
==¢ ß
)
==ß ®
;
==® ©
	dbdetalle>> 
.>> 
Transaccion>> %
.>>% &
importe_total>>& 3
=>>4 5
sumaDetalles>>6 B
;>>B C
var?? 
sumaAtencion??  
=??! "
	dbdetalle??# ,
.??, -
Transaccion??- 8
.??8 9
Transaccion2??9 E
.??E F
Transaccion1??F R
.??R S
Sum??S V
(??V W
t??W X
=>??Y [
t??\ ]
.??] ^
importe_total??^ k
)??k l
;??l m
	dbdetalle@@ 
.@@ 
Transaccion@@ %
.@@% &
Transaccion2@@& 2
.@@2 3
importe_total@@3 @
=@@A B
sumaAtencion@@C O
;@@O P
resultBB 
=BB 
SaveBB 
(BB 
)BB 
;BB  
resultCC 
.CC 
dataCC 
=CC 
idDetalleDeOrdenCC .
;CC. /
returnDD 
resultDD 
;DD 
}EE 
catchFF 
(FF 
	ExceptionFF 
eFF 
)FF 
{GG 
throwHH 
eHH 
;HH 
}II 
}KK 	
publicMM 
OperationResultMM 0
$ActualizarEstadosDeDetallesDeOrdenesMM C
(MMC D
longMMD H
[MMH I
]MMI J 
IdsDetallesDeOrdenesMMK _
,MM_ `"
EstadoDeDetalleDeOrdenMMa w
nuevoEstado	MMx É
)
MMÉ Ñ
{NN 	
tryOO 
{PP 
OperationResultQQ 
resultQQ  &
=QQ' (
newQQ) ,
OperationResultQQ- <
(QQ< =
)QQ= >
;QQ> ?
varRR 
estadoRR 
=RR 
(RR 
intRR !
)RR! "
nuevoEstadoRR" -
;RR- .
varSS 
detallesSS 
=SS 
_dbSS "
.SS" #
Detalle_transaccionSS# 6
.SS6 7
WhereSS7 <
(SS< =
dtSS= ?
=>SS@ B 
IdsDetallesDeOrdenesSSC W
.SSW X
ContainsSSX `
(SS` a
dtSSa c
.SSc d
idSSd f
)SSf g
)SSg h
.SSh i
ToListSSi o
(SSo p
)SSp q
;SSq r
detallesTT 
.TT 
ForEachTT  
(TT  !
dTT! "
=>TT# %
{TT& '
dTT( )
.TT) *#
indicadorMultipropositoTT* A
=TTB C
estadoTTD J
;TTJ K
}TTL M
)TTM N
;TTN O
resultUU 
=UU 
SaveUU 
(UU 
)UU 
;UU  
returnVV 
resultVV 
;VV 
}WW 
catchXX 
(XX 
	ExceptionXX 
eXX 
)XX 
{YY 
throwZZ 
eZZ 
;ZZ 
}[[ 
}\\ 	
public^^ 
OperationResult^^ M
AActualizarEstadosDeDetallesDeOrden_CalcularOrden_CalcularAtencion^^ `
(^^` a
long^^a e
idOrden^^f m
,^^m n#
EstadoDeDetalleDeOrden	^^o Ö
nuevoEstado
^^Ü ë
)
^^ë í
{__ 	
try`` 
{aa 
OperationResultbb 
resultbb  &
=bb' (
newbb) ,
OperationResultbb- <
(bb< =
)bb= >
;bb> ?
varcc 
idsEstadosASumarcc $
=cc% &
newcc' *
intcc+ .
[cc. /
]cc/ 0
{cc1 2
(cc3 4
intcc4 7
)cc7 8"
EstadoDeDetalleDeOrdencc8 N
.ccN O
AtendidoccO W
,ccW X
(ccY Z
intccZ ]
)cc] ^"
EstadoDeDetalleDeOrdencc^ t
.cct u
	Observadoccu ~
,cc~ 
(
ccÄ Å
int
ccÅ Ñ
)
ccÑ Ö$
EstadoDeDetalleDeOrden
ccÖ õ
.
ccõ ú
Preparacion
ccú ß
,
ccß ®
(
cc© ™
int
cc™ ≠
)
cc≠ Æ$
EstadoDeDetalleDeOrden
ccÆ ƒ
.
ccƒ ≈

Registrado
cc≈ œ
,
ccœ –
(
cc— “
int
cc“ ’
)
cc’ ÷$
EstadoDeDetalleDeOrden
cc÷ Ï
.
ccÏ Ì
Servido
ccÌ Ù
}
ccı ˆ
;
ccˆ ˜
vardd 
idEstadodd 
=dd 
(dd  
intdd  #
)dd# $
nuevoEstadodd$ /
;dd/ 0
varee 
detallesee 
=ee 
_dbee "
.ee" #
Detalle_transaccionee# 6
.ee6 7
Whereee7 <
(ee< =
dtee= ?
=>ee@ B
dteeC E
.eeE F
id_transaccioneeF T
==eeU W
idOrdeneeX _
)ee_ `
.ee` a
ToListeea g
(eeg h
)eeh i
;eei j
varff 
ordenff 
=ff 
_dbff 
.ff  
Transaccionff  +
.ff+ ,
FirstOrDefaultff, :
(ff: ;
tff; <
=>ff= ?
tff@ A
.ffA B
idffB D
==ffE G
idOrdenffH O
)ffO P
;ffP Q
detallesgg 
.gg 
ForEachgg  
(gg  !
dgg! "
=>gg# %
{gg& '
dgg( )
.gg) *#
indicadorMultipropositogg* A
=ggB C
idEstadoggD L
;ggL M
}ggN O
)ggO P
;ggP Q
varii 
sumaDetallesii  
=ii! "
detallesii# +
.ii+ ,
Whereii, 1
(ii1 2
dtii2 4
=>ii5 7
idsEstadosASumarii8 H
.iiH I
ContainsiiI Q
(iiQ R
(iiR S
intiiS V
)iiV W
dtiiW Y
.iiY Z#
indicadorMultipropositoiiZ q
)iiq r
)iir s
.iis t
Sumiit w
(iiw x
dtiix z
=>ii{ }
dt	ii~ Ä
.
iiÄ Å
total
iiÅ Ü
)
iiÜ á
;
iiá à
ordenjj 
.jj 
importe_totaljj #
=jj$ %
sumaDetallesjj& 2
;jj2 3
varkk 
sumaAtencionkk  
=kk! "
ordenkk# (
.kk( )
Transaccion2kk) 5
.kk5 6
Transaccion1kk6 B
.kkB C
SumkkC F
(kkF G
tkkG H
=>kkI K
tkkL M
.kkM N
importe_totalkkN [
)kk[ \
;kk\ ]
ordenll 
.ll 
Transaccion2ll "
.ll" #
importe_totalll# 0
=ll1 2
sumaAtencionll3 ?
;ll? @
resultnn 
=nn 
Savenn 
(nn 
)nn 
;nn  
returnoo 
resultoo 
;oo 
}pp 
catchqq 
(qq 
	Exceptionqq 
eqq 
)qq 
{rr 
throwss 
ess 
;ss 
}tt 
}uu 	
publicww 
OperationResultww %
ActualizarEstadoDeOrdenesww 8
(ww8 9
longww9 =
[ww= >
]ww> ?
Idsww@ C
,wwC D
intwwE H
EstadowwI O
)wwO P
{xx 	
tryyy 
{zz 
OperationResult{{ 
result{{  &
={{' (
new{{) ,
OperationResult{{- <
({{< =
){{= >
;{{> ?
var}} 
ordenes}} 
=}} 
_db}} !
.}}! "
Transaccion}}" -
.}}- .
Where}}. 3
(}}3 4
t}}4 5
=>}}6 8
Ids}}9 <
.}}< =
Contains}}= E
(}}E F
t}}F G
.}}G H
id}}H J
)}}J K
)}}K L
.}}L M
ToList}}M S
(}}S T
)}}T U
;}}U V
ordenes 
. 
ForEach 
(  
d  !
=>" $
{
ÄÄ 
d
ÅÅ 
.
ÅÅ 
id_estado_actual
ÅÅ &
=
ÅÅ' (
Estado
ÅÅ) /
;
ÅÅ/ 0
}
ÇÇ 
)
ÇÇ 
;
ÇÇ 
result
ÑÑ 
=
ÑÑ 
Save
ÑÑ 
(
ÑÑ 
)
ÑÑ 
;
ÑÑ  
return
ÜÜ 
result
ÜÜ 
;
ÜÜ 
}
àà 
catch
ââ 
(
ââ 
	Exception
ââ 
e
ââ 
)
ââ 
{
ää 
throw
ãã 
e
ãã 
;
ãã 
}
åå 
}
çç 	
public
êê 
IEnumerable
êê 
<
êê 
Orden_Atencion
êê )
>
êê) *%
ObtenerOrdenesPorEstado
êê+ B
(
êêB C
int
êêC F
	NumEstado
êêG P
)
êêP Q
{
ëë 	
try
íí 
{
ìì 
IEnumerable
ïï 
<
ïï 
Orden_Atencion
ïï *
>
ïï* +
ordenes
ïï, 3
=
ïï4 5
_db
ïï6 9
.
ïï9 :
Transaccion
ïï: E
.
ïïE F
Where
ïïF K
(
ïïK L
t
ïïL M
=>
ïïN P
t
ïïQ R
.
ïïR S!
id_tipo_transaccion
ïïS f
==
ïïg i!
RestauranteSettings
ïïj }
.
ïï} ~
Defaultïï~ Ö
.ïïÖ Ü3
#IdTipoTransaccionOrdenDeRestauranteïïÜ ©
&&ïï™ ¨
tïï≠ Æ
.ïïÆ Ø 
id_estado_actualïïØ ø
==ïï¿ ¬
	NumEstadoïï√ Ã
)ïïÃ Õ
.ïïÕ Œ
SelectïïŒ ‘
(ïï‘ ’
tïï’ ÷
=>ïï◊ Ÿ
newïï⁄ ›
Orden_Atencionïïﬁ Ï
(ïïÏ Ì
)ïïÌ Ó
{
ññ 
Id
óó 
=
óó 
t
óó 
.
óó 
id
óó 
,
óó 
Codigo
òò 
=
òò 
t
òò 
.
òò 
codigo
òò %
,
òò% &
Estado
ôô 
=
ôô 
(
ôô 
int
ôô !
)
ôô! "
t
ôô" #
.
ôô# $
id_estado_actual
ôô$ 4
,
ôô4 5

IdAtencion
öö 
=
öö  
(
öö! "
long
öö" &
)
öö& '
t
öö' (
.
öö( )"
id_transaccion_padre
öö) =
,
öö= >
ImporteOrden
õõ  
=
õõ! "
t
õõ# $
.
õõ$ %
importe_total
õõ% 2
,
õõ2 3
IdMesa
úú 
=
úú 
(
úú 
int
úú !
)
úú! "
t
úú" #
.
úú# $
Transaccion2
úú$ 0
.
úú0 1'
id_actor_negocio_interno1
úú1 J
,
úúJ K

NombreMesa
ùù 
=
ùù  
t
ùù! "
.
ùù" #
Transaccion2
ùù# /
.
ùù/ 0
Actor_negocio4
ùù0 >
.
ùù> ?
Actor
ùù? D
.
ùùD E
primer_nombre
ùùE R
,
ùùR S
DetallesDeOrden
ûû #
=
ûû$ %
t
ûû& '
.
ûû' (!
Detalle_transaccion
ûû( ;
.
ûû; <
Select
ûû< B
(
ûûB C
dt
ûûC E
=>
ûûF H
new
ûûI L
DetalleOrden
ûûM Y
(
ûûY Z
)
ûûZ [
{
üü 
Id
†† 
=
†† 
dt
†† 
.
††  
id
††  "
,
††" #
Precio
°° 
=
°°  
dt
°°! #
.
°°# $
precio_unitario
°°$ 3
,
°°3 4
Cantidad
¢¢  
=
¢¢! "
dt
¢¢# %
.
¢¢% &
cantidad
¢¢& .
,
¢¢. /
Importe
££ 
=
££  !
dt
££" $
.
££$ %
total
££% *
,
££* +
Estado
§§ 
=
§§  
(
§§! "
int
§§" %
)
§§% &
dt
§§& (
.
§§( )%
indicadorMultiproposito
§§) @
,
§§@ A(
DetalleItemRestauranteJson
•• 2
=
••3 4
dt
••5 7
.
••7 8
detalle
••8 ?
,
••? @

NombreItem
¶¶ "
=
¶¶# $
dt
¶¶% '
.
¶¶' (
Concepto_negocio
¶¶( 8
.
¶¶8 9
nombre
¶¶9 ?
,
¶¶? @
IdItem
ßß 
=
ßß  
dt
ßß! #
.
ßß# $!
id_concepto_negocio
ßß$ 7
,
ßß7 8
IdTransaccion
®® %
=
®®& '
dt
®®( *
.
®®* +
id_transaccion
®®+ 9
}
©© 
)
©© 
}
™™ 
)
™™ 
.
™™ 
ToList
™™ 
(
™™ 
)
™™ 
;
™™ 
return
¥¥ 
ordenes
¥¥ 
;
¥¥ 
}
∂∂ 
catch
∑∑ 
(
∑∑ 
	Exception
∑∑ 
e
∑∑ 
)
∑∑ 
{
∏∏ 
throw
ππ 
e
ππ 
;
ππ 
}
∫∫ 
}
ªª 	
public
ΩΩ 
IEnumerable
ΩΩ 
<
ΩΩ 
Orden_Atencion
ΩΩ )
>
ΩΩ) *1
#ObtenerOrdenesPorEstadoDeUnAmbiente
ΩΩ+ N
(
ΩΩN O
int
ΩΩO R
	NumEstado
ΩΩS \
,
ΩΩ\ ]
int
ΩΩ^ a

IdAmbiente
ΩΩb l
)
ΩΩl m
{
ææ 	
try
øø 
{
¿¿ 
IEnumerable
¬¬ 
<
¬¬ 
Orden_Atencion
¬¬ *
>
¬¬* +
ordenes
¬¬, 3
=
¬¬4 5
_db
¬¬6 9
.
¬¬9 :
Transaccion
¬¬: E
.
√√ 
Include
√√ 
(
√√ 
t
√√ 
=>
√√ !
t
√√" #
.
√√# $
Transaccion2
√√$ 0
)
√√0 1
.
ƒƒ 
Include
ƒƒ 
(
ƒƒ 
t
ƒƒ 
=>
ƒƒ !
t
ƒƒ" #
.
ƒƒ# $
Transaccion2
ƒƒ$ 0
.
ƒƒ0 1
Actor_negocio4
ƒƒ1 ?
)
ƒƒ? @
.
≈≈ 
Include
≈≈ 
(
≈≈ 
t
≈≈ 
=>
≈≈ !
t
≈≈" #
.
≈≈# $
Transaccion2
≈≈$ 0
.
≈≈0 1
Actor_negocio4
≈≈1 ?
.
≈≈? @
Actor
≈≈@ E
)
≈≈E F
.
∆∆ 
Include
∆∆ 
(
∆∆ 
t
∆∆ 
=>
∆∆ !
t
∆∆" #
.
∆∆# $!
Detalle_transaccion
∆∆$ 7
)
∆∆7 8
.
«« 
Where
«« 
(
«« 
t
«« 
=>
«« 
t
««  !
.
««! "
Transaccion2
««" .
.
««. /
Actor_negocio4
««/ =
.
««= >$
id_actor_negocio_padre
««> T
==
««U W

IdAmbiente
««X b
&&
««c e
t
««f g
.
««g h!
id_tipo_transaccion
««h {
==
««| ~"
RestauranteSettings«« í
.««í ì
Default««ì ö
.««ö õ3
#IdTipoTransaccionOrdenDeRestaurante««õ æ
&&««ø ¡
t««¬ √
.««√ ƒ 
id_estado_actual««ƒ ‘
==««’ ◊
	NumEstado««ÿ ·
)««· ‚
.
»» 
Select
»» 
(
»» 
t
»» 
=>
»»  
new
»»! $
Orden_Atencion
»»% 3
(
»»3 4
)
»»4 5
{
…… 
Id
   
=
   
t
   
.
   
id
   !
,
  ! "
Codigo
ÀÀ 
=
ÀÀ  
t
ÀÀ! "
.
ÀÀ" #
codigo
ÀÀ# )
,
ÀÀ) *
Estado
ÃÃ 
=
ÃÃ  
(
ÃÃ! "
int
ÃÃ" %
)
ÃÃ% &
t
ÃÃ& '
.
ÃÃ' (
id_estado_actual
ÃÃ( 8
,
ÃÃ8 9

IdAtencion
ÕÕ "
=
ÕÕ# $
(
ÕÕ% &
long
ÕÕ& *
)
ÕÕ* +
t
ÕÕ+ ,
.
ÕÕ, -"
id_transaccion_padre
ÕÕ- A
,
ÕÕA B
ImporteOrden
ŒŒ $
=
ŒŒ% &
t
ŒŒ' (
.
ŒŒ( )
importe_total
ŒŒ) 6
,
ŒŒ6 7
IdMesa
œœ 
=
œœ  
(
œœ! "
int
œœ" %
)
œœ% &
t
œœ& '
.
œœ' (
Transaccion2
œœ( 4
.
œœ4 5'
id_actor_negocio_interno1
œœ5 N
,
œœN O

NombreMesa
–– "
=
––# $
t
––% &
.
––& '
Transaccion2
––' 3
.
––3 4
Actor_negocio4
––4 B
.
––B C
Actor
––C H
.
––H I
primer_nombre
––I V
,
––V W
DetallesDeOrden
—— '
=
——( )
t
——* +
.
——+ ,!
Detalle_transaccion
——, ?
.
——? @
Select
——@ F
(
——F G
dt
——G I
=>
——J L
new
——M P
DetalleOrden
——Q ]
(
——] ^
)
——^ _
{
““ 
Id
”” 
=
””  
dt
””! #
.
””# $
id
””$ &
,
””& '
Precio
‘‘ "
=
‘‘# $
dt
‘‘% '
.
‘‘' (
precio_unitario
‘‘( 7
,
‘‘7 8
Cantidad
’’ $
=
’’% &
dt
’’' )
.
’’) *
cantidad
’’* 2
,
’’2 3
Importe
÷÷ #
=
÷÷$ %
dt
÷÷& (
.
÷÷( )
total
÷÷) .
,
÷÷. /
Estado
◊◊ "
=
◊◊# $
(
◊◊% &
int
◊◊& )
)
◊◊) *
dt
◊◊* ,
.
◊◊, -%
indicadorMultiproposito
◊◊- D
,
◊◊D E(
DetalleItemRestauranteJson
ÿÿ 6
=
ÿÿ7 8
dt
ÿÿ9 ;
.
ÿÿ; <
detalle
ÿÿ< C
,
ÿÿC D

NombreItem
ŸŸ &
=
ŸŸ' (
dt
ŸŸ) +
.
ŸŸ+ ,
Concepto_negocio
ŸŸ, <
.
ŸŸ< =
nombre
ŸŸ= C
,
ŸŸC D
IdItem
⁄⁄ "
=
⁄⁄# $
dt
⁄⁄% '
.
⁄⁄' (!
id_concepto_negocio
⁄⁄( ;
,
⁄⁄; <
IdTransaccion
€€ )
=
€€* +
dt
€€, .
.
€€. /
id_transaccion
€€/ =
}
‹‹ 
)
‹‹ 
}
›› 
)
›› 
.
›› 
ToList
›› 
(
›› 
)
›› 
;
››  
return
ﬂﬂ 
ordenes
ﬂﬂ 
;
ﬂﬂ 
}
·· 
catch
‚‚ 
(
‚‚ 
	Exception
‚‚ 
e
‚‚ 
)
‚‚ 
{
„„ 
throw
‰‰ 
e
‰‰ 
;
‰‰ 
}
ÂÂ 
}
ÊÊ 	
public
ËË 
IEnumerable
ËË 
<
ËË !
AtencionRestaurante
ËË .
>
ËË. /(
ObtenerAtencionesPorEstado
ËË0 J
(
ËËJ K
int
ËËK N
IdEstado
ËËO W
)
ËËW X
{
ÈÈ 	
try
ÍÍ 
{
ÎÎ 
var
ÌÌ %
tipoTransaccionAtencion
ÌÌ +
=
ÌÌ, -!
RestauranteSettings
ÌÌ. A
.
ÌÌA B
Default
ÌÌB I
.
ÌÌI J4
&IdTipoTransaccionAtencionDeRestaurante
ÌÌJ p
;
ÌÌp q
var
ÓÓ "
tipoTransaccionOrden
ÓÓ (
=
ÓÓ) *!
RestauranteSettings
ÓÓ+ >
.
ÓÓ> ?
Default
ÓÓ? F
.
ÓÓF G1
#IdTipoTransaccionOrdenDeRestaurante
ÓÓG j
;
ÓÓj k
IEnumerable
ÔÔ 
<
ÔÔ 
Transaccion
ÔÔ '
>
ÔÔ' (
transacciones
ÔÔ) 6
=
ÔÔ7 8
_db
ÔÔ9 <
.
ÔÔ< =
Transaccion
ÔÔ= H
.
 
Include
 
(
 
t
 
=>
 !
t
" #
.
# $
Transaccion1
$ 0
)
0 1
.
ÒÒ 
Include
ÒÒ 
(
ÒÒ 
t
ÒÒ 
=>
ÒÒ !
t
ÒÒ" #
.
ÒÒ# $
Actor_negocio1
ÒÒ$ 2
.
ÒÒ2 3
Actor
ÒÒ3 8
)
ÒÒ8 9
.
ÚÚ 
Include
ÚÚ 
(
ÚÚ 
t
ÚÚ 
=>
ÚÚ !
t
ÚÚ" #
.
ÚÚ# $
Transaccion1
ÚÚ$ 0
.
ÚÚ0 1
Select
ÚÚ1 7
(
ÚÚ7 8
to
ÚÚ8 :
=>
ÚÚ; =
to
ÚÚ> @
.
ÚÚ@ A!
Detalle_transaccion
ÚÚA T
)
ÚÚT U
)
ÚÚU V
.
ÛÛ 
Include
ÛÛ 
(
ÛÛ 
t
ÛÛ 
=>
ÛÛ !
t
ÛÛ" #
.
ÛÛ# $
Transaccion1
ÛÛ$ 0
.
ÛÛ0 1
Select
ÛÛ1 7
(
ÛÛ7 8
to
ÛÛ8 :
=>
ÛÛ; =
to
ÛÛ> @
.
ÛÛ@ A!
Detalle_transaccion
ÛÛA T
.
ÛÛT U
Select
ÛÛU [
(
ÛÛ[ \
dt
ÛÛ\ ^
=>
ÛÛ_ a
dt
ÛÛb d
.
ÛÛd e
Concepto_negocio
ÛÛe u
)
ÛÛu v
)
ÛÛv w
)
ÛÛw x
.
ÙÙ 
Where
ÙÙ 
(
ÙÙ 
t
ÙÙ 
=>
ÙÙ 
t
ÙÙ  !
.
ÙÙ! "!
id_tipo_transaccion
ÙÙ" 5
==
ÙÙ6 8%
tipoTransaccionAtencion
ÙÙ9 P
&&
ÙÙQ S
t
ÙÙT U
.
ÙÙU V
id_estado_actual
ÙÙV f
==
ÙÙg i
IdEstado
ÙÙj r
)
ÙÙr s
;
ÙÙs t
List
ˆˆ 
<
ˆˆ !
AtencionRestaurante
ˆˆ (
>
ˆˆ( )

atenciones
ˆˆ* 4
=
ˆˆ5 6
new
ˆˆ7 :
List
ˆˆ; ?
<
ˆˆ? @!
AtencionRestaurante
ˆˆ@ S
>
ˆˆS T
(
ˆˆT U
)
ˆˆU V
;
ˆˆV W
foreach
˜˜ 
(
˜˜ 
var
˜˜ 
transaccion
˜˜ (
in
˜˜) +
transacciones
˜˜, 9
)
˜˜9 :
{
¯¯ 

atenciones
˘˘ 
.
˘˘ 
Add
˘˘ "
(
˘˘" #!
AtencionRestaurante
˘˘# 6
.
˘˘6 7
Convert
˘˘7 >
(
˘˘> ?
transaccion
˘˘? J
)
˘˘J K
)
˘˘K L
;
˘˘L M
}
˙˙ 
return
¸¸ 

atenciones
¸¸ !
;
¸¸! "
}
˝˝ 
catch
˛˛ 
(
˛˛ 
	Exception
˛˛ 
e
˛˛ 
)
˛˛ 
{
ˇˇ 
throw
ÄÄ 
e
ÄÄ 
;
ÄÄ 
}
ÅÅ 
}
ÇÇ 	
public
ÉÉ 
IEnumerable
ÉÉ 
<
ÉÉ 
AtencionSinMesa
ÉÉ *
>
ÉÉ* +0
"ObtenerAtencionesSinMesaPorEstados
ÉÉ, N
(
ÉÉN O
int
ÉÉO R
[
ÉÉR S
]
ÉÉS T

idsEstados
ÉÉU _
,
ÉÉ_ `
int
ÉÉa d
idCentroAtencion
ÉÉe u
)
ÉÉu v
{
ÑÑ 	
try
ÖÖ 
{
ÜÜ 
return
àà 
_db
àà 
.
àà 
Transaccion
àà &
.
àà& '
Where
àà' ,
(
àà, -
t
àà- .
=>
àà/ 1
t
àà2 3
.
àà3 4!
id_tipo_transaccion
àà4 G
==
ààH J!
RestauranteSettings
ààK ^
.
àà^ _
Default
àà_ f
.
ààf g5
&IdTipoTransaccionAtencionDeRestauranteààg ç
&&ààé ê
tààë í
.ààí ì
Actor_negocio4ààì °
.àà° ¢&
id_actor_negocio_padreàà¢ ∏
==ààπ ª 
idCentroAtencionààº Ã
&&ààÕ œ

idsEstadosàà– ⁄
.àà⁄ €
Containsàà€ „
(àà„ ‰
(àà‰ Â
intààÂ Ë
)ààË È
tààÈ Í
.ààÍ Î 
id_estado_actualààÎ ˚
)àà˚ ¸
&&àà˝ ˇ
tààÄ Å
.ààÅ Ç

indicador1ààÇ å
&&ààç è
tààê ë
.ààë í
enum1ààí ó
==ààò ö
$numààõ ú
&&ààù ü
tàà† °
.àà° ¢
importe_totalàà¢ Ø
>àà∞ ±
$numàà≤ ≥
)àà≥ ¥
.àà¥ µ
Selectààµ ª
(ààª º
tààº Ω
=>ààæ ¿
newàà¡ ƒ
AtencionSinMesaàà≈ ‘
(àà‘ ’
)àà’ ÷
{
ââ 
Id
ää 
=
ää 
t
ää 
.
ää 
id
ää 
,
ää 
IdMesa
ãã 
=
ãã 
(
ãã 
int
ãã !
)
ãã! "
t
ãã" #
.
ãã# $'
id_actor_negocio_interno1
ãã$ =
,
ãã= >
Fecha
åå 
=
åå 
t
åå 
.
åå 
fecha_inicio
åå *
,
åå* +
Total
çç 
=
çç 
t
çç 
.
çç 
importe_total
çç +
,
çç+ ,
Cliente
éé 
=
éé 
t
éé 
.
éé  
Actor_negocio4
éé  .
.
éé. /
Actor
éé/ 4
.
éé4 5
primer_nombre
éé5 B
,
ééB C

EsDelivery
èè 
=
èè  
t
èè! "
.
èè" #

indicador2
èè# -
}
êê 
)
êê 
;
êê 
}
ëë 
catch
íí 
(
íí 
	Exception
íí 
e
íí 
)
íí 
{
ìì 
throw
îî 
e
îî 
;
îî 
}
ïï 
}
ññ 	
public
òò 
Orden_Atencion
òò c
UObtenerOrdenDeAtencionIncluidoDetallesDeOrdenItemsDeRestauranteYDetallesDeComplemento
òò s
(
òòs t
long
òòt x
idOrdenòòy Ä
)òòÄ Å
{
ôô 	
Orden_Atencion
öö 
Orden
öö  
=
öö! "
_db
öö# &
.
öö& '
Transaccion
öö' 2
.
öö2 3
Where
öö3 8
(
öö8 9
t
öö9 :
=>
öö; =
t
öö> ?
.
öö? @
id
öö@ B
==
ööC E
idOrden
ööF M
)
ööM N
.
ööN O
Select
ööO U
(
ööU V
t
ööV W
=>
ööX Z
new
öö[ ^
Orden_Atencion
öö_ m
(
ööm n
)
öön o
{
õõ 
Codigo
úú 
=
úú 
t
úú 
.
úú 
codigo
úú !
,
úú! "
ImporteOrden
ùù 
=
ùù 
t
ùù  
.
ùù  !
importe_total
ùù! .
,
ùù. /
Id
ûû 
=
ûû 
t
ûû 
.
ûû 
id
ûû 
,
ûû 

IdAtencion
üü 
=
üü 
(
üü 
long
üü "
)
üü" #
t
üü# $
.
üü$ %"
id_transaccion_padre
üü% 9
,
üü9 :
Estado
†† 
=
†† 
(
†† 
int
†† 
)
†† 
t
†† 
.
††  
id_estado_actual
††  0
,
††0 1
IdMesa
°° 
=
°° 
(
°° 
int
°° 
)
°° 
t
°° 
.
°°  
Transaccion2
°°  ,
.
°°, -'
id_actor_negocio_interno1
°°- F
,
°°F G

NombreMesa
¢¢ 
=
¢¢ 
t
¢¢ 
.
¢¢ 
Transaccion2
¢¢ +
.
¢¢+ ,
Actor_negocio4
¢¢, :
.
¢¢: ;
Actor
¢¢; @
.
¢¢@ A
primer_nombre
¢¢A N
,
¢¢N O
Mozo
££ 
=
££ 
new
££ 
ItemGenerico
££ '
(
££' (
)
££( )
{
§§ 
Id
•• 
=
•• 
t
•• 
.
•• &
id_actor_negocio_interno
•• 3
,
••3 4
Nombre
¶¶ 
=
¶¶ 
t
¶¶ 
.
¶¶ 
Actor_negocio2
¶¶ -
.
¶¶- .
Actor
¶¶. 3
.
¶¶3 4
tercer_nombre
¶¶4 A
}
ßß 
,
ßß 
FechaHoraRegistro
®® !
=
®®" #
t
®®$ %
.
®®% &
fecha_inicio
®®& 2
,
®®2 3
DetallesDeOrden
©© 
=
©©  !
t
©©" #
.
©©# $!
Detalle_transaccion
©©$ 7
.
©©7 8
Select
©©8 >
(
©©> ?
dt
©©? A
=>
©©B D
new
©©E H
DetalleOrden
©©I U
(
©©U V
)
©©V W
{
™™ 
Id
´´ 
=
´´ 
dt
´´ 
.
´´ 
id
´´ 
,
´´ 
Precio
¨¨ 
=
¨¨ 
dt
¨¨ 
.
¨¨  
precio_unitario
¨¨  /
,
¨¨/ 0
Cantidad
≠≠ 
=
≠≠ 
dt
≠≠ !
.
≠≠! "
cantidad
≠≠" *
,
≠≠* +
Importe
ÆÆ 
=
ÆÆ 
dt
ÆÆ  
.
ÆÆ  !
total
ÆÆ! &
,
ÆÆ& '
Estado
ØØ 
=
ØØ 
(
ØØ 
int
ØØ !
)
ØØ! "
dt
ØØ" $
.
ØØ$ %%
indicadorMultiproposito
ØØ% <
,
ØØ< =(
DetalleItemRestauranteJson
∞∞ .
=
∞∞/ 0
dt
∞∞1 3
.
∞∞3 4
detalle
∞∞4 ;
,
∞∞; <

NombreItem
±± 
=
±±  
dt
±±! #
.
±±# $
Concepto_negocio
±±$ 4
.
±±4 5
nombre
±±5 ;
,
±±; <
IdItem
≤≤ 
=
≤≤ 
dt
≤≤ 
.
≤≤  !
id_concepto_negocio
≤≤  3
,
≤≤3 4
IdTransaccion
≥≥ !
=
≥≥" #
dt
≥≥$ &
.
≥≥& '
id_transaccion
≥≥' 5
}
¥¥ 
)
¥¥ 
}
µµ 
)
µµ 
.
µµ 
SingleOrDefault
µµ 
(
µµ 
)
µµ  
;
µµ  !
Orden
∂∂ 
.
∂∂ 
DetallesDeOrden
∂∂ !
.
∂∂! "
ToList
∂∂" (
(
∂∂( )
)
∂∂) *
.
∂∂* +
ForEach
∂∂+ 2
(
∂∂2 3
dor
∂∂3 6
=>
∂∂7 9
{
∑∑ 
dor
∏∏ 
.
∏∏ $
DetalleItemRestaurante
∏∏ *
=
∏∏+ ,
JsonConvert
∏∏- 8
.
∏∏8 9
DeserializeObject
∏∏9 J
<
∏∏J K&
Detalle_Item_Restaurante
∏∏K c
>
∏∏c d
(
∏∏d e
dor
∏∏e h
.
∏∏h i)
DetalleItemRestauranteJson∏∏i É
)∏∏É Ñ
;∏∏Ñ Ö
dor
ππ 
.
ππ !
ValoresComplementos
ππ '
=
ππ( )
new
ππ* -
List
ππ. 2
<
ππ2 3
string
ππ3 9
>
ππ9 :
(
ππ: ;
)
ππ; <
;
ππ< =
foreach
∫∫ 
(
∫∫ 
var
∫∫  
detalleComplemento
∫∫ /
in
∫∫0 2
dor
∫∫3 6
.
∫∫6 7$
DetalleItemRestaurante
∫∫7 M
.
∫∫M N!
DetallesComplemento
∫∫N a
)
∫∫a b
{
ªª 
if
ºº 
(
ºº  
detalleComplemento
ºº *
.
ºº* +
ItemsComplemento
ºº+ ;
.
ºº; <
Select
ºº< B
(
ººB C
dc
ººC E
=>
ººF H
dc
ººI K
.
ººK L
Nombre
ººL R
)
ººR S
.
ººS T
ToList
ººT Z
(
ººZ [
)
ºº[ \
.
ºº\ ]
Count
ºº] b
>
ººc d
$num
ººe f
)
ººf g
dor
ΩΩ 
.
ΩΩ !
ValoresComplementos
ΩΩ /
.
ΩΩ/ 0
Add
ΩΩ0 3
(
ΩΩ3 4
String
ΩΩ4 :
.
ΩΩ: ;
Join
ΩΩ; ?
(
ΩΩ? @
$str
ΩΩ@ D
,
ΩΩD E 
detalleComplemento
ΩΩF X
.
ΩΩX Y
ItemsComplemento
ΩΩY i
.
ΩΩi j
Select
ΩΩj p
(
ΩΩp q
dc
ΩΩq s
=>
ΩΩt v
dc
ΩΩw y
.
ΩΩy z
NombreΩΩz Ä
)ΩΩÄ Å
.ΩΩÅ Ç
ToListΩΩÇ à
(ΩΩà â
)ΩΩâ ä
)ΩΩä ã
)ΩΩã å
;ΩΩå ç
}
ææ 
}
øø 
)
øø 
;
øø 
return
¿¿ 
Orden
¿¿ 
;
¿¿ 
}
¡¡ 	
public
¬¬ 
IEnumerable
¬¬ 
<
¬¬ 
Orden_Atencion
¬¬ )
>
¬¬) *f
WObtenerOrdenesDeAtencionIncluidoDetallesDeOrdenItemsDeRestauranteYDetallesDeComplemento¬¬+ Ç
(¬¬Ç É
long¬¬É á

idAtencion¬¬à í
)¬¬í ì
{
√√ 	
IEnumerable
ƒƒ 
<
ƒƒ 
Orden_Atencion
ƒƒ &
>
ƒƒ& '
Ordenes
ƒƒ( /
=
ƒƒ0 1
_db
ƒƒ2 5
.
ƒƒ5 6
Transaccion
ƒƒ6 A
.
ƒƒA B
Where
ƒƒB G
(
ƒƒG H
t
ƒƒH I
=>
ƒƒJ L
t
ƒƒM N
.
ƒƒN O"
id_transaccion_padre
ƒƒO c
==
ƒƒd f

idAtencion
ƒƒg q
&&
ƒƒr t
t
ƒƒu v
.
ƒƒv w"
id_tipo_transaccionƒƒw ä
==ƒƒã ç#
RestauranteSettingsƒƒé °
.ƒƒ° ¢
Defaultƒƒ¢ ©
.ƒƒ© ™3
#IdTipoTransaccionOrdenDeRestauranteƒƒ™ Õ
)ƒƒÕ Œ
.ƒƒŒ œ
Selectƒƒœ ’
(ƒƒ’ ÷
tƒƒ÷ ◊
=>ƒƒÿ ⁄
newƒƒ€ ﬁ
Orden_Atencionƒƒﬂ Ì
(ƒƒÌ Ó
)ƒƒÓ Ô
{
≈≈ 
Codigo
∆∆ 
=
∆∆ 
t
∆∆ 
.
∆∆ 
codigo
∆∆ !
,
∆∆! "
ImporteOrden
«« 
=
«« 
t
««  
.
««  !
importe_total
««! .
,
««. /
Id
»» 
=
»» 
t
»» 
.
»» 
id
»» 
,
»» 

IdAtencion
…… 
=
…… 
(
…… 
long
…… "
)
……" #
t
……# $
.
……$ %"
id_transaccion_padre
……% 9
,
……9 :
Estado
   
=
   
(
   
int
   
)
   
t
   
.
    
id_estado_actual
    0
,
  0 1
IdMesa
ÀÀ 
=
ÀÀ 
(
ÀÀ 
int
ÀÀ 
)
ÀÀ 
t
ÀÀ 
.
ÀÀ  
Transaccion2
ÀÀ  ,
.
ÀÀ, -'
id_actor_negocio_interno1
ÀÀ- F
,
ÀÀF G

NombreMesa
ÃÃ 
=
ÃÃ 
t
ÃÃ 
.
ÃÃ 
Transaccion2
ÃÃ +
.
ÃÃ+ ,
Actor_negocio4
ÃÃ, :
.
ÃÃ: ;
Actor
ÃÃ; @
.
ÃÃ@ A
primer_nombre
ÃÃA N
,
ÃÃN O
DetallesDeOrden
ÕÕ 
=
ÕÕ  !
t
ÕÕ" #
.
ÕÕ# $!
Detalle_transaccion
ÕÕ$ 7
.
ÕÕ7 8
Select
ÕÕ8 >
(
ÕÕ> ?
dt
ÕÕ? A
=>
ÕÕB D
new
ÕÕE H
DetalleOrden
ÕÕI U
(
ÕÕU V
)
ÕÕV W
{
ŒŒ 
Id
œœ 
=
œœ 
dt
œœ 
.
œœ 
id
œœ 
,
œœ 
Precio
–– 
=
–– 
dt
–– 
.
––  
precio_unitario
––  /
,
––/ 0
Cantidad
—— 
=
—— 
dt
—— !
.
——! "
cantidad
——" *
,
——* +
Importe
““ 
=
““ 
dt
““  
.
““  !
total
““! &
,
““& '
Estado
”” 
=
”” 
(
”” 
int
”” !
)
””! "
dt
””" $
.
””$ %%
indicadorMultiproposito
””% <
,
””< =(
DetalleItemRestauranteJson
‘‘ .
=
‘‘/ 0
dt
‘‘1 3
.
‘‘3 4
detalle
‘‘4 ;
,
‘‘; <

NombreItem
’’ 
=
’’  
dt
’’! #
.
’’# $
Concepto_negocio
’’$ 4
.
’’4 5
nombre
’’5 ;
,
’’; <
IdItem
÷÷ 
=
÷÷ 
dt
÷÷ 
.
÷÷  !
id_concepto_negocio
÷÷  3
,
÷÷3 4
IdTransaccion
◊◊ !
=
◊◊" #
dt
◊◊$ &
.
◊◊& '
id_transaccion
◊◊' 5
}
ÿÿ 
)
ÿÿ 
}
ŸŸ 
)
ŸŸ 
.
ŸŸ 
ToList
ŸŸ 
(
ŸŸ 
)
ŸŸ 
;
ŸŸ 
return
⁄⁄ 
Ordenes
⁄⁄ 
;
⁄⁄ 
}
€€ 	
public
›› 
Orden_Atencion
›› 2
$ObtenerOrdenDeAtencionDeDetalleOrden
›› B
(
››B C
long
››C G
idDetalleOrden
››H V
)
››V W
{
ﬁﬁ 	
Orden_Atencion
ﬂﬂ 
Orden
ﬂﬂ  
=
ﬂﬂ! "
_db
ﬂﬂ# &
.
ﬂﬂ& '!
Detalle_transaccion
ﬂﬂ' :
.
ﬂﬂ: ;
Where
ﬂﬂ; @
(
ﬂﬂ@ A
dt
ﬂﬂA C
=>
ﬂﬂD F
dt
ﬂﬂG I
.
ﬂﬂI J
id
ﬂﬂJ L
==
ﬂﬂM O
idDetalleOrden
ﬂﬂP ^
)
ﬂﬂ^ _
.
ﬂﬂ_ `
Select
ﬂﬂ` f
(
ﬂﬂf g
dt
ﬂﬂg i
=>
ﬂﬂj l
dt
ﬂﬂm o
.
ﬂﬂo p
Transaccion
ﬂﬂp {
)
ﬂﬂ{ |
.
ﬂﬂ| }
Selectﬂﬂ} É
(ﬂﬂÉ Ñ
tﬂﬂÑ Ö
=>ﬂﬂÜ à
newﬂﬂâ å
Orden_Atencionﬂﬂç õ
(ﬂﬂõ ú
)ﬂﬂú ù
{
‡‡ 
Codigo
·· 
=
·· 
t
·· 
.
·· 
codigo
·· !
,
··! "
ImporteOrden
‚‚ 
=
‚‚ 
t
‚‚  
.
‚‚  !
importe_total
‚‚! .
,
‚‚. /
Id
„„ 
=
„„ 
t
„„ 
.
„„ 
id
„„ 
,
„„ 

IdAtencion
‰‰ 
=
‰‰ 
(
‰‰ 
long
‰‰ "
)
‰‰" #
t
‰‰# $
.
‰‰$ %"
id_transaccion_padre
‰‰% 9
,
‰‰9 :
Estado
ÂÂ 
=
ÂÂ 
(
ÂÂ 
int
ÂÂ 
)
ÂÂ 
t
ÂÂ 
.
ÂÂ  
id_estado_actual
ÂÂ  0
,
ÂÂ0 1
IdMesa
ÊÊ 
=
ÊÊ 
(
ÊÊ 
int
ÊÊ 
)
ÊÊ 
t
ÊÊ 
.
ÊÊ  
Transaccion2
ÊÊ  ,
.
ÊÊ, -'
id_actor_negocio_interno1
ÊÊ- F
,
ÊÊF G

NombreMesa
ÁÁ 
=
ÁÁ 
t
ÁÁ 
.
ÁÁ 
Transaccion2
ÁÁ +
.
ÁÁ+ ,
Actor_negocio4
ÁÁ, :
.
ÁÁ: ;
Actor
ÁÁ; @
.
ÁÁ@ A
primer_nombre
ÁÁA N
,
ÁÁN O
DetallesDeOrden
ËË 
=
ËË  !
t
ËË" #
.
ËË# $!
Detalle_transaccion
ËË$ 7
.
ËË7 8
Select
ËË8 >
(
ËË> ?
dt
ËË? A
=>
ËËB D
new
ËËE H
DetalleOrden
ËËI U
(
ËËU V
)
ËËV W
{
ÈÈ 
Id
ÍÍ 
=
ÍÍ 
dt
ÍÍ 
.
ÍÍ 
id
ÍÍ 
,
ÍÍ 
Precio
ÎÎ 
=
ÎÎ 
dt
ÎÎ 
.
ÎÎ  
precio_unitario
ÎÎ  /
,
ÎÎ/ 0
Cantidad
ÏÏ 
=
ÏÏ 
dt
ÏÏ !
.
ÏÏ! "
cantidad
ÏÏ" *
,
ÏÏ* +
Importe
ÌÌ 
=
ÌÌ 
dt
ÌÌ  
.
ÌÌ  !
total
ÌÌ! &
,
ÌÌ& '
Estado
ÓÓ 
=
ÓÓ 
(
ÓÓ 
int
ÓÓ !
)
ÓÓ! "
dt
ÓÓ" $
.
ÓÓ$ %%
indicadorMultiproposito
ÓÓ% <
,
ÓÓ< =(
DetalleItemRestauranteJson
ÔÔ .
=
ÔÔ/ 0
dt
ÔÔ1 3
.
ÔÔ3 4
detalle
ÔÔ4 ;
,
ÔÔ; <

NombreItem
 
=
  
dt
! #
.
# $
Concepto_negocio
$ 4
.
4 5
nombre
5 ;
,
; <
IdItem
ÒÒ 
=
ÒÒ 
dt
ÒÒ 
.
ÒÒ  !
id_concepto_negocio
ÒÒ  3
,
ÒÒ3 4
IdTransaccion
ÚÚ !
=
ÚÚ" #
dt
ÚÚ$ &
.
ÚÚ& '
id_transaccion
ÚÚ' 5
}
ÛÛ 
)
ÛÛ 
}
ÙÙ 
)
ÙÙ 
.
ÙÙ 
SingleOrDefault
ÙÙ 
(
ÙÙ 
)
ÙÙ  
;
ÙÙ  !
return
ıı 
Orden
ıı 
;
ıı 
}
ˆˆ 	
public
˘˘ 
Orden_Atencion
˘˘ $
ObtenerOrdenDeAtencion
˘˘ 4
(
˘˘4 5
long
˘˘5 9
idOrden
˘˘: A
)
˘˘A B
{
˙˙ 	
Orden_Atencion
˚˚ 
Orden
˚˚  
=
˚˚! "
_db
˚˚# &
.
˚˚& '
Transaccion
˚˚' 2
.
˚˚2 3
Where
˚˚3 8
(
˚˚8 9
t
˚˚9 :
=>
˚˚; =
t
˚˚> ?
.
˚˚? @
id
˚˚@ B
==
˚˚C E
idOrden
˚˚F M
)
˚˚M N
.
˚˚N O
Select
˚˚O U
(
˚˚U V
t
˚˚V W
=>
˚˚X Z
new
˚˚[ ^
Orden_Atencion
˚˚_ m
(
˚˚m n
)
˚˚n o
{
¸¸ 
Codigo
˝˝ 
=
˝˝ 
t
˝˝ 
.
˝˝ 
codigo
˝˝ !
,
˝˝! "
ImporteOrden
˛˛ 
=
˛˛ 
t
˛˛  
.
˛˛  !
importe_total
˛˛! .
,
˛˛. /
Id
ˇˇ 
=
ˇˇ 
t
ˇˇ 
.
ˇˇ 
id
ˇˇ 
,
ˇˇ 

IdAtencion
ÄÄ 
=
ÄÄ 
(
ÄÄ 
long
ÄÄ "
)
ÄÄ" #
t
ÄÄ# $
.
ÄÄ$ %"
id_transaccion_padre
ÄÄ% 9
,
ÄÄ9 :
Estado
ÅÅ 
=
ÅÅ 
(
ÅÅ 
int
ÅÅ 
)
ÅÅ 
t
ÅÅ 
.
ÅÅ  
id_estado_actual
ÅÅ  0
,
ÅÅ0 1
IdMesa
ÇÇ 
=
ÇÇ 
(
ÇÇ 
int
ÇÇ 
)
ÇÇ 
t
ÇÇ 
.
ÇÇ  
Transaccion2
ÇÇ  ,
.
ÇÇ, -'
id_actor_negocio_interno1
ÇÇ- F
,
ÇÇF G

NombreMesa
ÉÉ 
=
ÉÉ 
t
ÉÉ 
.
ÉÉ 
Transaccion2
ÉÉ +
.
ÉÉ+ ,
Actor_negocio4
ÉÉ, :
.
ÉÉ: ;
Actor
ÉÉ; @
.
ÉÉ@ A
primer_nombre
ÉÉA N
,
ÉÉN O
DetallesDeOrden
ÑÑ 
=
ÑÑ  !
t
ÑÑ" #
.
ÑÑ# $!
Detalle_transaccion
ÑÑ$ 7
.
ÑÑ7 8
Select
ÑÑ8 >
(
ÑÑ> ?
dt
ÑÑ? A
=>
ÑÑB D
new
ÑÑE H
DetalleOrden
ÑÑI U
(
ÑÑU V
)
ÑÑV W
{
ÖÖ 
Id
ÜÜ 
=
ÜÜ 
dt
ÜÜ 
.
ÜÜ 
id
ÜÜ 
,
ÜÜ 
Precio
áá 
=
áá 
dt
áá 
.
áá  
precio_unitario
áá  /
,
áá/ 0
Cantidad
àà 
=
àà 
dt
àà !
.
àà! "
cantidad
àà" *
,
àà* +
Importe
ââ 
=
ââ 
dt
ââ  
.
ââ  !
total
ââ! &
,
ââ& '
Estado
ää 
=
ää 
(
ää 
int
ää !
)
ää! "
dt
ää" $
.
ää$ %%
indicadorMultiproposito
ää% <
,
ää< =(
DetalleItemRestauranteJson
ãã .
=
ãã/ 0
dt
ãã1 3
.
ãã3 4
detalle
ãã4 ;
,
ãã; <

NombreItem
åå 
=
åå  
dt
åå! #
.
åå# $
Concepto_negocio
åå$ 4
.
åå4 5
nombre
åå5 ;
,
åå; <
IdItem
çç 
=
çç 
dt
çç 
.
çç  !
id_concepto_negocio
çç  3
,
çç3 4
IdTransaccion
éé !
=
éé" #
dt
éé$ &
.
éé& '
id_transaccion
éé' 5
}
èè 
)
èè 
}
êê 
)
êê 
.
êê 
SingleOrDefault
êê 
(
êê 
)
êê  
;
êê  !
return
ëë 
Orden
ëë 
;
ëë 
}
íí 	
public
îî 
IEnumerable
îî 
<
îî 
DetalleOrden
îî '
>
îî' (`
RObtenerDetallesDeOrdenDeUnaOrdenIncluyendoItemsDeRestauranteYDetallesDeComplemento
îî) {
(
îî{ |
longîî| Ä
idOrdenîîÅ à
)îîà â
{
ïï 	
IEnumerable
ññ 
<
ññ 
DetalleOrden
ññ $
>
ññ$ %
detalles
ññ& .
=
ññ/ 0
_db
ññ1 4
.
ññ4 5!
Detalle_transaccion
ññ5 H
.
ññH I
Include
ññI P
(
ññP Q
dt
ññQ S
=>
ññT V
dt
ññW Y
.
ññY Z
Concepto_negocio
ññZ j
)
ññj k
.
ññk l
Include
ññl s
(
ññs t
dt
ññt v
=>
ññw y
dt
ññz |
.
ññ| }
Concepto_negocioññ} ç
.ññç é 
Detalle_maestro1ññé û
.ññû ü"
Categoria_conceptoññü ±
)ññ± ≤
.ññ≤ ≥
Whereññ≥ ∏
(ññ∏ π
dtññπ ª
=>ññº æ
dtññø ¡
.ññ¡ ¬
id_transaccionññ¬ –
==ññ— ”
idOrdenññ‘ €
)ññ€ ‹
.ññ‹ ›
Selectññ› „
(ññ„ ‰
dtññ‰ Ê
=>ññÁ È
newññÍ Ì
DetalleOrdenññÓ ˙
(ññ˙ ˚
)ññ˚ ¸
{
óó 
Id
ôô 
=
ôô 
dt
ôô 
.
ôô 
id
ôô 
,
ôô 
Precio
öö 
=
öö 
dt
öö 
.
öö 
precio_unitario
öö +
,
öö+ ,
Cantidad
õõ 
=
õõ 
dt
õõ 
.
õõ 
cantidad
õõ &
,
õõ& '
Importe
úú 
=
úú 
dt
úú 
.
úú 
total
úú "
,
úú" #
Estado
ùù 
=
ùù 
(
ùù 
int
ùù 
)
ùù 
dt
ùù  
.
ùù  !%
indicadorMultiproposito
ùù! 8
,
ùù8 9(
DetalleItemRestauranteJson
ûû *
=
ûû+ ,
dt
ûû- /
.
ûû/ 0
detalle
ûû0 7
,
ûû7 8

NombreItem
üü 
=
üü 
dt
üü 
.
üü  
Concepto_negocio
üü  0
.
üü0 1
nombre
üü1 7
,
üü7 8
IdItem
†† 
=
†† 
dt
†† 
.
†† !
id_concepto_negocio
†† /
,
††/ 0
IdTransaccion
°° 
=
°° 
idOrden
°°  '
,
°°' (
}
££ 
)
££ 
;
££ 
return
§§ 
detalles
§§ 
;
§§ 
}
•• 	
public
¶¶ 
Transaccion
¶¶ 7
)ObtenerTransaccionDeAtencionDeMesaOcupada
¶¶ D
(
¶¶D E
int
¶¶E H
idMesa
¶¶I O
)
¶¶O P
{
ßß 	
try
©© 
{
™™ 
Transaccion
´´ 
transaccion
´´ '
=
´´( )
_db
´´* -
.
´´- .
Transaccion
´´. 9
.
¨¨ 
Include
¨¨ 
(
¨¨ 
t
¨¨ 
=>
¨¨ !
t
¨¨" #
.
¨¨# $
Transaccion11
¨¨$ 1
)
¨¨1 2
.
≠≠ 
Include
≠≠ 
(
≠≠ 
t
≠≠ 
=>
≠≠ !
t
≠≠" #
.
≠≠# $
Transaccion11
≠≠$ 1
.
≠≠1 2
Select
≠≠2 8
(
≠≠8 9
to
≠≠9 ;
=>
≠≠< >
to
≠≠? A
.
≠≠A B!
Detalle_transaccion
≠≠B U
)
≠≠U V
)
≠≠V W
.
ÆÆ 
FirstOrDefault
ÆÆ #
(
ÆÆ# $
t
ÆÆ$ %
=>
ÆÆ& (
t
ÆÆ) *
.
ÆÆ* +'
id_actor_negocio_interno1
ÆÆ+ D
==
ÆÆE G
idMesa
ÆÆH N
&&
ÆÆO Q
(
ÆÆR S
!
ÆÆS T
t
ÆÆT U
.
ÆÆU V 
Evento_transaccion
ÆÆV h
.
ÆÆh i
Select
ÆÆi o
(
ÆÆo p
tt
ÆÆp r
=>
ÆÆs u
tt
ÆÆv x
.
ÆÆx y
	id_eventoÆÆy Ç
)ÆÆÇ É
.ÆÆÉ Ñ
ContainsÆÆÑ å
(ÆÆå ç
MaestroSettingsÆÆç ú
.ÆÆú ù
DefaultÆÆù §
.ÆÆ§ •/
IdDetalleMaestroEstadoFacturadoÆÆ• ƒ
)ÆÆƒ ≈
&&ÆÆ∆ »
!ÆÆ…  
(ÆÆ  À
tÆÆÀ Ã
.ÆÆÃ Õ 
id_estado_actualÆÆÕ ›
==ÆÆﬁ ‡
MaestroSettingsÆÆ· 
.ÆÆ Ò
DefaultÆÆÒ ¯
.ÆÆ¯ ˘-
IdDetalleMaestroEstadoCerradoÆÆ˘ ñ
&&ÆÆó ô
tÆÆö õ
.ÆÆõ ú
importe_totalÆÆú ©
==ÆÆ™ ¨
$numÆÆ≠ Æ
)ÆÆÆ Ø
)ÆÆØ ∞
)ÆÆ∞ ±
;ÆÆ± ≤
return
ØØ 
transaccion
ØØ "
;
ØØ" #
}
∞∞ 
catch
±± 
(
±± 
	Exception
±± 
e
±± 
)
±± 
{
≤≤ 
throw
≥≥ 
e
≥≥ 
;
≥≥ 
}
¥¥ 
}
∂∂ 	
public
∏∏ 
IEnumerable
∏∏ 
<
∏∏ 
Complemento
∏∏ &
>
∏∏& '+
ObtenerComplementosPorFamilia
∏∏( E
(
∏∏E F
int
∏∏F I
	idFamilia
∏∏J S
)
∏∏S T
{
ππ 	
List
∫∫ 
<
∫∫ 
Complemento
∫∫ 
>
∫∫ 
complementos
∫∫ *
=
∫∫+ ,
_db
ªª 
.
ªª %
Caracteristica_concepto
ªª +
.
ªª+ ,
Where
ªª, 1
(
ªª1 2
cc
ªª2 4
=>
ªª5 7
cc
ªª8 :
.
ªª: ;
id_concepto
ªª; F
==
ªªG I
	idFamilia
ªªJ S
&&
ªªT V
cc
ªªW Y
.
ªªY Z
	indicador
ªªZ c
==
ªªd f
(
ªªg h
int
ªªh k
)
ªªk l,
IndicadorModuloCaracteristicaªªl â
.ªªâ ä
Restauranteªªä ï
)ªªï ñ
.ªªñ ó
Selectªªó ù
(ªªù û
ccªªû †
=>ªª° £
newªª§ ß
Complementoªª® ≥
(ªª≥ ¥
)ªª¥ µ
{
ºº 
Id
ΩΩ 
=
ΩΩ 
cc
ΩΩ 
.
ΩΩ 
id_caracteristica
ΩΩ -
,
ΩΩ- .
Nombre
ææ 
=
ææ 
cc
ææ 
.
ææ  
Detalle_maestro1
ææ  0
.
ææ0 1
nombre
ææ1 7
,
ææ7 8
Maximo
øø 
=
øø 
(
øø 
int
øø !
)
øø! "
cc
øø" $
.
øø$ %
maximo
øø% +
,
øø+ ,

EsMultiple
¿¿ 
=
¿¿  
cc
¿¿! #
.
¿¿# $
es_multiple
¿¿$ /
,
¿¿/ 0#
EstaActivoRestaurante
¡¡ )
=
¡¡* +
cc
¡¡, .
.
¡¡. /
	indicador
¡¡/ 8
==
¡¡9 ;
(
¡¡< =
int
¡¡= @
)
¡¡@ A+
IndicadorModuloCaracteristica
¡¡A ^
.
¡¡^ _
Restaurante
¡¡_ j
,
¡¡j k"
Detalles_Complemento
¬¬ (
=
¬¬) *
cc
¬¬+ -
.
¬¬- .
Detalle_maestro1
¬¬. >
.
¬¬> ?"
Valor_caracteristica
¬¬? S
.
¬¬S T
Select
¬¬T Z
(
¬¬Z [
vc
¬¬[ ]
=>
¬¬^ `
new
¬¬a d
Item_Complemento
¬¬e u
(
¬¬u v
)
¬¬v w
{
√√ 
Id
ƒƒ 
=
ƒƒ 
vc
ƒƒ 
.
ƒƒ  
id
ƒƒ  "
,
ƒƒ" #
Nombre
≈≈ 
=
≈≈  
vc
≈≈! #
.
≈≈# $
valor
≈≈$ )
}
∆∆ 
)
∆∆ 
}
»» 
)
»» 
.
»» 
ToList
»» 
(
»» 
)
»» 
;
»» 
complementos
…… 
.
…… 
Where
…… 
(
…… 
c
……  
=>
……! #
c
……$ %
.
……% &

EsMultiple
……& 0
)
……0 1
.
……1 2
ToList
……2 8
(
……8 9
)
……9 :
.
……: ;
ForEach
……; B
(
……B C
cc
……C E
=>
……F H
cc
……I K
.
……K L
Maximo
……L R
=
……S T
cc
……U W
.
……W X"
Detalles_Complemento
……X l
.
……l m
Count
……m r
(
……r s
)
……s t
)
……t u
;
……u v
return
   
complementos
   
;
    
}
ÃÃ 	
public
ŒŒ 
IEnumerable
ŒŒ 
<
ŒŒ 
Complemento
ŒŒ &
>
ŒŒ& '!
ObtenerComplementos
ŒŒ( ;
(
ŒŒ; <
)
ŒŒ< =
{
œœ 	
IEnumerable
–– 
<
–– %
Caracteristica_concepto
–– /
>
––/ 0(
caracteristicasDeConceptos
––1 K
=
––L M
_db
––N Q
.
––Q R%
Caracteristica_concepto
––R i
.
––i j
Include
––j q
(
––q r
cc
––r t
=>
––u w
cc
––x z
.
––z {
Detalle_maestro1––{ ã
)––ã å
.––å ç
Include––ç î
(––î ï
cc––ï ó
=>––ò ö
cc––õ ù
.––ù û 
Detalle_maestro1––û Æ
.––Æ Ø$
Valor_caracteristica––Ø √
)––√ ƒ
.––ƒ ≈
ToList––≈ À
(––À Ã
)––Ã Õ
;––Õ Œ
List
—— 
<
—— 
Complemento
—— 
>
—— 
complementos
—— *
=
——+ ,
new
——- 0
List
——1 5
<
——5 6
Complemento
——6 A
>
——A B
(
——B C
)
——C D
;
——D E
foreach
““ 
(
““ 
var
““ 
cc
““ 
in
““ (
caracteristicasDeConceptos
““ 9
)
““9 :
{
”” 
complementos
‘‘ 
.
‘‘ 
Add
‘‘  
(
‘‘  !
new
‘‘! $
Complemento
‘‘% 0
(
‘‘0 1
)
‘‘1 2
{
’’ 
Id
÷÷ 
=
÷÷ 
cc
÷÷ 
.
÷÷ 
id
÷÷ 
,
÷÷ 
Nombre
◊◊ 
=
◊◊ 
cc
◊◊ 
.
◊◊  
Detalle_maestro1
◊◊  0
.
◊◊0 1
nombre
◊◊1 7
,
◊◊7 8
Familia
ÿÿ 
=
ÿÿ 
cc
ÿÿ  
.
ÿÿ  !
Detalle_maestro
ÿÿ! 0
.
ÿÿ0 1
nombre
ÿÿ1 7
,
ÿÿ7 8
Maximo
ŸŸ 
=
ŸŸ 
(
ŸŸ 
int
ŸŸ !
)
ŸŸ! "
cc
ŸŸ" $
.
ŸŸ$ %
maximo
ŸŸ% +
,
ŸŸ+ ,

EsMultiple
⁄⁄ 
=
⁄⁄  
cc
⁄⁄! #
.
⁄⁄# $
es_multiple
⁄⁄$ /
,
⁄⁄/ 0#
EstaActivoRestaurante
€€ )
=
€€* +
cc
€€, .
.
€€. /
	indicador
€€/ 8
==
€€9 ;
(
€€< =
int
€€= @
)
€€@ A+
IndicadorModuloCaracteristica
€€A ^
.
€€^ _
Restaurante
€€_ j
,
€€j k"
Detalles_Complemento
‹‹ (
=
‹‹) *
cc
‹‹+ -
.
‹‹- .
Detalle_maestro1
‹‹. >
.
‹‹> ?"
Valor_caracteristica
‹‹? S
.
‹‹S T
Select
‹‹T Z
(
‹‹Z [
vc
‹‹[ ]
=>
‹‹^ `
new
‹‹a d
Item_Complemento
‹‹e u
(
‹‹u v
)
‹‹v w
{
›› 
Id
ﬁﬁ 
=
ﬁﬁ 
vc
ﬁﬁ 
.
ﬁﬁ  
id
ﬁﬁ  "
,
ﬁﬁ" #
Nombre
ﬂﬂ 
=
ﬂﬂ  
vc
ﬂﬂ! #
.
ﬂﬂ# $
valor
ﬂﬂ$ )
}
‡‡ 
)
‡‡ 
.
‡‡ 
ToList
‡‡ 
(
‡‡ 
)
‡‡ 
}
·· 
)
·· 
;
·· 
}
‚‚ 
;
‚‚ 
complementos
„„ 
.
„„ 
Where
„„ 
(
„„ 
c
„„  
=>
„„! #
c
„„$ %
.
„„% &

EsMultiple
„„& 0
)
„„0 1
.
„„1 2
ToList
„„2 8
(
„„8 9
)
„„9 :
.
„„: ;
ForEach
„„; B
(
„„B C
cc
„„C E
=>
„„F H
cc
„„I K
.
„„K L
Maximo
„„L R
=
„„S T
cc
„„U W
.
„„W X"
Detalles_Complemento
„„X l
.
„„l m
Count
„„m r
(
„„r s
)
„„s t
)
„„t u
;
„„u v
return
‰‰ 
complementos
‰‰ 
;
‰‰  
}
ÂÂ 	
public
ÁÁ 
OperationResult
ÁÁ #
ActualizarComplemento
ÁÁ 4
(
ÁÁ4 5
Complemento
ÁÁ5 @
complemento
ÁÁA L
)
ÁÁL M
{
ËË 	
try
ÈÈ 
{
ÍÍ %
Caracteristica_concepto
ÎÎ '&
dbCaracteristicaConcepto
ÎÎ( @
=
ÎÎA B
_db
ÎÎC F
.
ÎÎF G%
Caracteristica_concepto
ÎÎG ^
.
ÎÎ^ _
Single
ÎÎ_ e
(
ÎÎe f
c
ÎÎf g
=>
ÎÎh j
c
ÎÎk l
.
ÎÎl m
id
ÎÎm o
==
ÎÎp r
complemento
ÎÎs ~
.
ÎÎ~ 
IdÎÎ Å
)ÎÎÅ Ç
;ÎÎÇ É&
dbCaracteristicaConcepto
ÏÏ (
.
ÏÏ( )
	indicador
ÏÏ) 2
=
ÏÏ3 4
complemento
ÏÏ5 @
.
ÏÏ@ A#
EstaActivoRestaurante
ÏÏA V
?
ÏÏW X
(
ÏÏY Z
int
ÏÏZ ]
)
ÏÏ] ^+
IndicadorModuloCaracteristica
ÏÏ^ {
.
ÏÏ{ |
RestauranteÏÏ| á
:ÏÏà â
(ÏÏä ã
intÏÏã é
)ÏÏé è-
IndicadorModuloCaracteristicaÏÏè ¨
.ÏÏ¨ ≠
NingunoÏÏ≠ ¥
;ÏÏ¥ µ&
dbCaracteristicaConcepto
ÌÌ (
.
ÌÌ( )
es_multiple
ÌÌ) 4
=
ÌÌ5 6
complemento
ÌÌ7 B
.
ÌÌB C

EsMultiple
ÌÌC M
;
ÌÌM N
var
ÓÓ 
result
ÓÓ 
=
ÓÓ 
Save
ÓÓ !
(
ÓÓ! "
)
ÓÓ" #
;
ÓÓ# $
return
ÔÔ 
result
ÔÔ 
;
ÔÔ 
}
 
catch
ÒÒ 
(
ÒÒ 
	Exception
ÒÒ 
e
ÒÒ 
)
ÒÒ 
{
ÚÚ 
throw
ÛÛ 
e
ÛÛ 
;
ÛÛ 
}
ÙÙ 
}
ıı 	
public
˜˜ 
IEnumerable
˜˜ 
<
˜˜ 
DetalleOrden
˜˜ '
>
˜˜' ($
ObtenerDetallesDeOrden
˜˜) ?
(
˜˜? @
int
˜˜@ C
idOrden
˜˜D K
)
˜˜K L
{
¯¯ 	
return
˘˘ 
_db
˘˘ 
.
˘˘ !
Detalle_transaccion
˘˘ *
.
˘˘* +
Where
˘˘+ 0
(
˘˘0 1
dt
˘˘1 3
=>
˘˘4 6
dt
˘˘7 9
.
˘˘9 :
id_transaccion
˘˘: H
==
˘˘I K
idOrden
˘˘L S
)
˘˘S T
.
˘˘T U
Select
˘˘U [
(
˘˘[ \
dt
˘˘\ ^
=>
˘˘_ a
new
˘˘b e
DetalleOrden
˘˘f r
(
˘˘r s
)
˘˘s t
{
˙˙ 
Id
˚˚ 
=
˚˚ 
dt
˚˚ 
.
˚˚ 
id
˚˚ 
,
˚˚ 
Cantidad
¸¸ 
=
¸¸ 
dt
¸¸ 
.
¸¸ 
cantidad
¸¸ &
,
¸¸& '
Importe
˝˝ 
=
˝˝ 
dt
˝˝ 
.
˝˝ 
total
˝˝ "
,
˝˝" #
Precio
˛˛ 
=
˛˛ 
dt
˛˛ 
.
˛˛ 
precio_unitario
˛˛ +
,
˛˛+ ,
Estado
ˇˇ 
=
ˇˇ 
(
ˇˇ 
int
ˇˇ 
)
ˇˇ 
dt
ˇˇ  
.
ˇˇ  !%
indicadorMultiproposito
ˇˇ! 8
,
ˇˇ8 9

NombreItem
ÄÄ 
=
ÄÄ 
dt
ÄÄ 
.
ÄÄ  
Concepto_negocio
ÄÄ  0
.
ÄÄ0 1
nombre
ÄÄ1 7
,
ÄÄ7 8(
DetalleItemRestauranteJson
ÅÅ *
=
ÅÅ+ ,
dt
ÅÅ- /
.
ÅÅ/ 0
detalle
ÅÅ0 7
,
ÅÅ7 8
IdTransaccion
ÇÇ 
=
ÇÇ 
idOrden
ÇÇ  '
,
ÇÇ' (
IdItem
ÉÉ 
=
ÉÉ 
dt
ÉÉ 
.
ÉÉ !
id_concepto_negocio
ÉÉ /
}
ÑÑ 
)
ÑÑ 
;
ÑÑ 
}
ÖÖ 	
public
ÜÜ 
async
ÜÜ 
Task
ÜÜ 
<
ÜÜ 
IEnumerable
ÜÜ %
<
ÜÜ% &
ItemRestaurante
ÜÜ& 5
>
ÜÜ5 6
>
ÜÜ6 7'
ObtenerItemsDeRestaurante
ÜÜ8 Q
(
ÜÜQ R
)
ÜÜR S
{
áá 	
try
àà 
{
ââ 
var
ää 
_asyncDb
ää 
=
ää 
new
ää "
SigescomEntities
ää# 3
(
ää3 4
)
ää4 5
;
ää5 6
var
ãã 
items
ãã 
=
ãã 
(
ãã 
await
ãã "
_asyncDb
ãã# +
.
ãã+ ,"
Concepto_negocio_rol
ãã, @
.
ãã@ A
Where
ããA F
(
ããF G
cnr
ããG J
=>
ããK M
cnr
ããN Q
.
ããQ R
id_rol
ããR X
==
ããY [!
RestauranteSettings
ãã\ o
.
ãão p
Default
ããp w
.
ããw x'
IdRolConceptoRestauranteããx ê
)ããê ë
.ããë í
Selectããí ò
(ããò ô
cnrããô ú
=>ããù ü
cnrãã† £
.ãã£ § 
Concepto_negocioãã§ ¥
)ãã¥ µ
.ããµ ∂
Whereãã∂ ª
(ããª º
cnããº æ
=>ããø ¡
cnãã¬ ƒ
.ããƒ ≈

es_vigenteãã≈ œ
)ããœ –
.ãã– —
Includeãã— ÿ
(ããÿ Ÿ
cnããŸ €
=>ãã‹ ﬁ
cnããﬂ ·
.ãã· ‚ 
Detalle_maestro4ãã‚ Ú
)ããÚ Û
.ããÛ Ù
ToListAsyncããÙ ˇ
(ããˇ Ä
)ããÄ Å
)ããÅ Ç
.
åå 
Select
åå 
(
åå 
cn
åå 
=>
åå !
new
åå" %
ItemRestaurante
åå& 5
(
åå5 6
)
åå6 7
{
çç 
Id
éé 
=
éé 
cn
éé 
.
éé  
id
éé  "
,
éé" #
CodigoBarra
èè #
=
èè$ %
cn
èè& (
.
èè( )
codigo_barra
èè) 5
,
èè5 6
Nombre
êê 
=
êê  
cn
êê! #
.
êê# $
nombre
êê$ *
,
êê* +
	IdFamilia
ëë !
=
ëë" #
cn
ëë$ &
.
ëë& ' 
id_concepto_basico
ëë' 9
,
ëë9 :
NombreFamilia
íí %
=
íí& '
cn
íí( *
.
íí* +
Detalle_maestro4
íí+ ;
.
íí; <
nombre
íí< B
}
ìì 
)
ìì 
;
ìì 
return
îî 
items
îî 
;
îî 
}
ïï 
catch
ññ 
(
ññ 
	Exception
ññ 
e
ññ 
)
ññ 
{
óó 
throw
òò 
e
òò 
;
òò 
}
ôô 
}
öö 	
public
úú 
async
úú 
Task
úú 
<
úú 
IEnumerable
úú %
<
úú% &
ItemJerarquico
úú& 4
>
úú4 5
>
úú5 6(
ObtenerDetallesJerarquicos
úú7 Q
(
úúQ R
int
úúR U
	idMaestro
úúV _
)
úú_ `
{
ùù 	
try
ûû 
{
üü 
var
†† 
_dbAsync
†† 
=
†† 
new
†† "
SigescomEntities
††# 3
(
††3 4
)
††4 5
;
††5 6
return
°° 
(
°° 
await
°° 
_dbAsync
°° &
.
°°& '%
Detalle_detalle_maestro
°°' >
.
°°> ?
Where
°°? D
(
°°D E
m
°°E F
=>
°°G I
m
°°J K
.
°°K L
Detalle_maestro
°°L [
.
°°[ \

id_maestro
°°\ f
==
°°g i
	idMaestro
°°j s
)
°°s t
.
°°t u
ToListAsync°°u Ä
(°°Ä Å
)°°Å Ç
)°°Ç É
.°°É Ñ
Select°°Ñ ä
(°°ä ã
ddm°°ã é
=>°°è ë
new°°í ï
ItemJerarquico°°ñ §
{°°• ¶
IdPadre°°ß Æ
=°°Ø ∞
ddm°°± ¥
.°°¥ µ,
id_detalle_maestro_principal°°µ —
,°°— “
Id°°” ’
=°°÷ ◊
ddm°°ÿ €
.°°€ ‹-
id_detalle_maestro_secundario°°‹ ˘
}°°˙ ˚
)°°˚ ¸
;°°¸ ˝
}
¢¢ 
catch
££ 
(
££ 
	Exception
££ 
e
££ 
)
££ 
{
§§ 
throw
•• 
e
•• 
;
•• 
}
¶¶ 
}
ßß 	
public
©© 
IEnumerable
©© 
<
©© 
ItemRestaurante
©© *
>
©©* +4
&ObtenerItemsDeRestaurantePorCategorias
©©, R
(
©©R S
List
©©S W
<
©©W X
int
©©X [
>
©©[ \
idsCategoria
©©] i
)
©©i j
{
™™ 	
int
´´ 
[
´´ 
]
´´ 
IdsFamilias
´´ 
=
´´ 
_db
´´  #
.
´´# $ 
Categoria_concepto
´´$ 6
.
´´6 7
Where
´´7 <
(
´´< =
cc
´´= ?
=>
´´@ B
idsCategoria
´´C O
.
´´O P
Contains
´´P X
(
´´X Y
cc
´´Y [
.
´´[ \
id_categoria
´´\ h
)
´´h i
)
´´i j
.
´´j k
Select
´´k q
(
´´q r
cc
´´r t
=>
´´u w
cc
´´x z
.
´´z {
id_concepto´´{ Ü
)´´Ü á
.´´á à
ToArray´´à è
(´´è ê
)´´ê ë
;´´ë í
IEnumerable
¨¨ 
<
¨¨ 
ItemRestaurante
¨¨ '
>
¨¨' (
items
¨¨) .
=
¨¨/ 0
_db
¨¨1 4
.
¨¨4 5"
Concepto_negocio_rol
¨¨5 I
.
¨¨I J
Where
¨¨J O
(
¨¨O P
cnr
¨¨P S
=>
¨¨T V
cnr
¨¨W Z
.
¨¨Z [
id_rol
¨¨[ a
==
¨¨b d!
RestauranteSettings
¨¨e x
.
¨¨x y
Default¨¨y Ä
.¨¨Ä Å(
IdRolConceptoRestaurante¨¨Å ô
)¨¨ô ö
.¨¨ö õ
Select¨¨õ °
(¨¨° ¢
cnr¨¨¢ •
=>¨¨¶ ®
cnr¨¨© ¨
.¨¨¨ ≠ 
Concepto_negocio¨¨≠ Ω
)¨¨Ω æ
.¨¨æ ø
Where¨¨ø ƒ
(¨¨ƒ ≈
cn¨¨≈ «
=>¨¨»  
IdsFamilias¨¨À ÷
.¨¨÷ ◊
Contains¨¨◊ ﬂ
(¨¨ﬂ ‡
cn¨¨‡ ‚
.¨¨‚ „"
id_concepto_basico¨¨„ ı
)¨¨ı ˆ
)¨¨ˆ ˜
.¨¨˜ ¯
Select¨¨¯ ˛
(¨¨˛ ˇ
cn¨¨ˇ Å
=>¨¨Ç Ñ
new¨¨Ö à
ItemRestaurante¨¨â ò
(¨¨ò ô
)¨¨ô ö
{
≠≠ 
Id
ÆÆ 
=
ÆÆ 
cn
ÆÆ 
.
ÆÆ 
id
ÆÆ 
,
ÆÆ 
CodigoBarra
ØØ 
=
ØØ 
cn
ØØ  
.
ØØ  !
codigo_barra
ØØ! -
,
ØØ- .
Nombre
∞∞ 
=
∞∞ 
cn
∞∞ 
.
∞∞ 
nombre
∞∞ "
,
∞∞" #
	IdFamilia
±± 
=
±± 
cn
±± 
.
±±  
id_concepto_basico
±± 1
,
±±1 2
NombreFamilia
≤≤ 
=
≤≤ 
cn
≤≤  "
.
≤≤" #
Detalle_maestro4
≤≤# 3
.
≤≤3 4
nombre
≤≤4 :
}
≥≥ 
)
≥≥ 
;
≥≥ 
return
¥¥ 
items
¥¥ 
;
¥¥ 
}
µµ 	
public
∂∂ 
long
∂∂ 
[
∂∂ 
]
∂∂ 8
*ObtenerIdsDeItemsDeRestaurantePorCategoria
∂∂ @
(
∂∂@ A
int
∂∂A D
idCategoria
∂∂E P
)
∂∂P Q
{
∑∑ 	
int
∏∏ 
[
∏∏ 
]
∏∏ 
IdsFamilias
∏∏ 
=
∏∏ 
_db
∏∏  #
.
∏∏# $ 
Categoria_concepto
∏∏$ 6
.
∏∏6 7
Where
∏∏7 <
(
∏∏< =
cc
∏∏= ?
=>
∏∏@ B
cc
∏∏C E
.
∏∏E F
id_categoria
∏∏F R
==
∏∏S U
idCategoria
∏∏V a
)
∏∏a b
.
∏∏b c
Select
∏∏c i
(
∏∏i j
cc
∏∏j l
=>
∏∏m o
cc
∏∏p r
.
∏∏r s
id_concepto
∏∏s ~
)
∏∏~ 
.∏∏ Ä
ToArray∏∏Ä á
(∏∏á à
)∏∏à â
;∏∏â ä
long
ππ 
[
ππ 
]
ππ 
Ids
ππ 
;
ππ 
Ids
ªª 
=
ªª 
_db
ªª 
.
ªª 
Concepto_negocio
ªª &
.
ªª& '
Where
ªª' ,
(
ªª, -
cn
ªª- /
=>
ªª0 2
IdsFamilias
ªª3 >
.
ªª> ?
Contains
ªª? G
(
ªªG H
cn
ªªH J
.
ªªJ K 
id_concepto_basico
ªªK ]
)
ªª] ^
)
ªª^ _
.
ªª_ `
Select
ªª` f
(
ªªf g
cn
ªªg i
=>
ªªj l
(
ªªm n
long
ªªn r
)
ªªr s
cn
ªªs u
.
ªªu v
id
ªªv x
)
ªªx y
.
ªªy z
ToArrayªªz Å
(ªªÅ Ç
)ªªÇ É
;ªªÉ Ñ
return
ΩΩ 
Ids
ΩΩ 
;
ΩΩ 
}
ææ 	
public
≈≈ 
ItemRestaurante
≈≈ /
!ObtenerItemDeRestauranteConPrecio
≈≈ @
(
≈≈@ A
int
≈≈A D!
IdItemDeRestaurante
≈≈E X
)
≈≈X Y
{
∆∆ 	
try
«« 
{
»» 
Concepto_negocio
    
conceptoNegocio
  ! 0
=
  1 2
_db
  3 6
.
  6 7
Concepto_negocio
  7 G
.
ÀÀ 
Include
ÀÀ 
(
ÀÀ 
cn
ÀÀ 
=>
ÀÀ  "
cn
ÀÀ# %
.
ÀÀ% &
Precio1
ÀÀ& -
)
ÀÀ- .
.
ÃÃ 
Include
ÃÃ 
(
ÃÃ 
cn
ÃÃ 
=>
ÃÃ  "
cn
ÃÃ# %
.
ÃÃ% &
Detalle_maestro4
ÃÃ& 6
)
ÃÃ6 7
.
ÕÕ 
Include
ÕÕ 
(
ÕÕ 
cn
ÕÕ 
=>
ÕÕ  "
cn
ÕÕ# %
.
ÕÕ% &
Detalle_maestro4
ÕÕ& 6
.
ÕÕ6 7%
Caracteristica_concepto
ÕÕ7 N
)
ÕÕN O
.
ŒŒ 
FirstOrDefault
ŒŒ #
(
ŒŒ# $
cn
ŒŒ$ &
=>
ŒŒ' )
cn
ŒŒ* ,
.
ŒŒ, -
id
ŒŒ- /
==
ŒŒ0 2!
IdItemDeRestaurante
ŒŒ3 F
)
ŒŒF G
;
ŒŒG H
if
œœ 
(
œœ 
conceptoNegocio
œœ #
.
œœ# $
Precio1
œœ$ +
.
œœ+ ,
Count
œœ, 1
<
œœ2 3
$num
œœ4 5
)
œœ5 6
{
–– 
throw
—— 
new
—— &
PreciosNotFoundException
—— 6
(
——6 7
conceptoNegocio
——7 F
.
——F G
nombre
——G M
)
——M N
;
——N O
}
““ 
return
”” 
new
”” 
ItemRestaurante
”” *
(
””* +
conceptoNegocio
””+ :
)
””: ;
{
‘‘ 
Precio
’’ 
=
’’ 
conceptoNegocio
’’ ,
.
’’, -
Precio1
’’- 4
.
’’4 5
Where
’’5 :
(
’’: ;
p
’’; <
=>
’’= ?
p
’’@ A
.
’’A B

es_vigente
’’B L
&&
’’M O
p
’’P Q
.
’’Q R
id_tarifa_d
’’R ]
==
’’^ `!
RestauranteSettings
’’a t
.
’’t u
Default
’’u |
.
’’| }0
!IdTarifaSeleccionadaEnRestaurante’’} û
)’’û ü
.’’ü †
First’’† •
(’’• ¶
)’’¶ ß
.’’ß ®
valor’’® ≠
}
÷÷ 
;
÷÷ 
}
◊◊ 
catch
ÿÿ 
(
ÿÿ 
	Exception
ÿÿ 
e
ÿÿ 
)
ÿÿ 
{
ŸŸ 
throw
⁄⁄ 
new
⁄⁄ 
DatosException
⁄⁄ (
(
⁄⁄( )
$str
⁄⁄) X
,
⁄⁄X Y
e
⁄⁄Z [
)
⁄⁄[ \
;
⁄⁄\ ]
}
€€ 
}
‹‹ 	
public
ﬁﬁ 
IEnumerable
ﬁﬁ 
<
ﬁﬁ 
Concepto_negocio
ﬁﬁ +
>
ﬁﬁ+ ,E
7ObtenerConceptoDeNegocioIncluyendoDetallesDeTransaccion
ﬁﬁ- d
(
ﬁﬁd e
)
ﬁﬁe f
{
ﬂﬂ 	
try
‡‡ 
{
·· 
var
‚‚ &
idRolConceptoRestaurante
‚‚ ,
=
‚‚- .!
RestauranteSettings
‚‚/ B
.
‚‚B C
Default
‚‚C J
.
‚‚J K&
IdRolConceptoRestaurante
‚‚K c
;
‚‚c d
IEnumerable
„„ 
<
„„ 
Concepto_negocio
„„ ,
>
„„, -
	conceptos
„„. 7
=
„„8 9
_db
„„: =
.
„„= >"
Concepto_negocio_rol
„„> R
.
„„R S
Where
„„S X
(
„„X Y
cnr
„„Y \
=>
„„] _
cnr
„„` c
.
„„c d
id_rol
„„d j
==
„„k m'
idRolConceptoRestaurante„„n Ü
)„„Ü á
.„„á à
Select„„à é
(„„é è
cnr„„è í
=>„„ì ï
cnr„„ñ ô
.„„ô ö 
Concepto_negocio„„ö ™
)„„™ ´
.„„´ ¨
Where„„¨ ±
(„„± ≤
cn„„≤ ¥
=>„„µ ∑
cn„„∏ ∫
.„„∫ ª

es_vigente„„ª ≈
)„„≈ ∆
;„„∆ «
return
‰‰ 
	conceptos
‰‰  
;
‰‰  !
}
ÂÂ 
catch
ÊÊ 
(
ÊÊ 
	Exception
ÊÊ 
e
ÊÊ 
)
ÊÊ 
{
ÁÁ 
throw
ËË 
e
ËË 
;
ËË 
}
ÈÈ 
}
ÎÎ 	
public
ÌÌ 
IEnumerable
ÌÌ 
<
ÌÌ #
ResumenOrden_Consulta
ÌÌ 0
>
ÌÌ0 11
#ObtenerReporteOrdenesIncluyendoMozo
ÌÌ2 U
(
ÌÌU V
DateTime
ÌÌV ^
Desde
ÌÌ_ d
,
ÌÌd e
DateTime
ÌÌf n
Hasta
ÌÌo t
)
ÌÌt u
{
ÓÓ 	
try
ÔÔ 
{
 
int
ÒÒ 
tipoTransaccion
ÒÒ #
=
ÒÒ$ %!
RestauranteSettings
ÒÒ& 9
.
ÒÒ9 :
Default
ÒÒ: A
.
ÒÒA B1
#IdTipoTransaccionOrdenDeRestaurante
ÒÒB e
;
ÒÒe f
IEnumerable
ÚÚ 
<
ÚÚ #
ResumenOrden_Consulta
ÚÚ 1
>
ÚÚ1 2
InfoReporte
ÚÚ3 >
=
ÚÚ? @
_db
ÚÚA D
.
ÚÚD E
Transaccion
ÚÚE P
.
ÚÚP Q
Where
ÚÚQ V
(
ÚÚV W
t
ÚÚW X
=>
ÚÚY [
t
ÚÚ\ ]
.
ÚÚ] ^!
id_tipo_transaccion
ÚÚ^ q
==
ÚÚr t
tipoTransaccionÚÚu Ñ
&&ÚÚÖ á
tÚÚà â
.ÚÚâ ä
fecha_inicioÚÚä ñ
>=ÚÚó ô
DesdeÚÚö ü
&&ÚÚ† ¢
tÚÚ£ §
.ÚÚ§ •
fecha_inicioÚÚ• ±
<=ÚÚ≤ ¥
HastaÚÚµ ∫
)ÚÚ∫ ª
.ÚÚª º
SelectÚÚº ¬
(ÚÚ¬ √
tÚÚ√ ƒ
=>ÚÚ≈ «
newÚÚ» À%
ResumenOrden_ConsultaÚÚÃ ·
(ÚÚ· ‚
)ÚÚ‚ „
{
ÛÛ 
Id
ÙÙ 
=
ÙÙ 
t
ÙÙ 
.
ÙÙ 
id
ÙÙ 
,
ÙÙ 
Codigo
ıı 
=
ıı 
t
ıı 
.
ıı 
codigo
ıı %
,
ıı% &
Importe
ˆˆ 
=
ˆˆ 
t
ˆˆ 
.
ˆˆ  
importe_total
ˆˆ  -
,
ˆˆ- .
Mozo
˜˜ 
=
˜˜ 
t
˜˜ 
.
˜˜ 
Actor_negocio2
˜˜ +
.
˜˜+ ,
Actor
˜˜, 1
.
˜˜1 2
primer_nombre
˜˜2 ?
,
˜˜? @
Fecha
¯¯ 
=
¯¯ 
t
¯¯ 
.
¯¯ 
fecha_inicio
¯¯ *
}
˘˘ 
)
˘˘ 
;
˘˘ 
var
˙˙ 
resultadoFinal
˙˙ "
=
˙˙# $
InfoReporte
˙˙% 0
.
˙˙0 1
ToList
˙˙1 7
(
˙˙7 8
)
˙˙8 9
;
˙˙9 :
resultadoFinal
˚˚ 
.
˚˚ 
ForEach
˚˚ &
(
˚˚& '
m
˚˚' (
=>
˚˚) +
{
¸¸ 
var
˝˝ 
nombreArray
˝˝ #
=
˝˝$ %
m
˝˝& '
.
˝˝' (
Mozo
˝˝( ,
.
˝˝, -
Split
˝˝- 2
(
˝˝2 3
$char
˝˝3 6
)
˝˝6 7
;
˝˝7 8
m
˛˛ 
.
˛˛ 
Mozo
˛˛ 
=
˛˛ 
nombreArray
˛˛ (
[
˛˛( )
$num
˛˛) *
]
˛˛* +
+
˛˛, -
$str
˛˛. 1
+
˛˛2 3
nombreArray
˛˛4 ?
[
˛˛? @
$num
˛˛@ A
]
˛˛A B
+
˛˛C D
$str
˛˛E H
+
˛˛I J
nombreArray
˛˛K V
[
˛˛V W
$num
˛˛W X
]
˛˛X Y
;
˛˛Y Z
}
ˇˇ 
)
ˇˇ 
;
ˇˇ 
return
ÄÄ 
resultadoFinal
ÄÄ %
;
ÄÄ% &
}
ÅÅ 
catch
ÇÇ 
(
ÇÇ 
	Exception
ÇÇ 
e
ÇÇ 
)
ÇÇ 
{
ÉÉ 
throw
ÑÑ 
e
ÑÑ 
;
ÑÑ 
}
ÖÖ 
}
ÜÜ 	
public
àà 
IEnumerable
àà 
<
àà ,
ResumenOrdenesPorMozo_Consulta
àà 9
>
àà9 :;
-ObtenerReporteMozoIncluyendoCantidadDeOrdenes
àà; h
(
ààh i
DateTime
àài q
Desde
ààr w
,
ààw x
DateTimeàày Å
HastaààÇ á
)ààá à
{
ââ 	
try
ää 
{
ãã 
int
åå 
tipoTransaccion
åå #
=
åå$ %!
RestauranteSettings
åå& 9
.
åå9 :
Default
åå: A
.
ååA B1
#IdTipoTransaccionOrdenDeRestaurante
ååB e
;
ååe f
IEnumerable
çç 
<
çç ,
ResumenOrdenesPorMozo_Consulta
çç :
>
çç: ;
InfoReporte
çç< G
=
ççH I
_db
ççJ M
.
ççM N
Transaccion
ççN Y
.
ççY Z
Where
ççZ _
(
çç_ `
t
çç` a
=>
ççb d
t
ççe f
.
ççf g
fecha_inicio
ççg s
>=
ççt v
Desde
ççw |
&&
çç} 
tççÄ Å
.ççÅ Ç
fecha_inicioççÇ é
<=ççè ë
Hastaççí ó
&&ççò ö
tççõ ú
.ççú ù#
id_tipo_transaccionççù ∞
==çç± ≥
tipoTransaccionçç¥ √
)çç√ ƒ
.ççƒ ≈
GroupByçç≈ Ã
(ççÃ Õ
tççÕ Œ
=>ççœ —
newçç“ ’
{çç÷ ◊
tççÿ Ÿ
.ççŸ ⁄
id_empleadoçç⁄ Â
,ççÂ Ê
tççÁ Ë
.ççË È
Actor_negocio2ççÈ ˜
.çç˜ ¯
Actorçç¯ ˝
.çç˝ ˛
primer_nombreçç˛ ã
}ççå ç
)ççç é
.ççé è
Selectççè ï
(ççï ñ
taççñ ò
=>ççô õ
newççú ü.
ResumenOrdenesPorMozo_Consultaçç† æ
(ççæ ø
)ççø ¿
{
éé 
Id
èè 
=
èè 
ta
èè 
.
èè 
Key
èè 
.
èè  
id_empleado
èè  +
,
èè+ ,
Mozo
êê 
=
êê 
ta
êê 
.
êê 
Key
êê !
.
êê! "
primer_nombre
êê" /
,
êê/ 0
Cantidad
ëë 
=
ëë 
ta
ëë !
.
ëë! "
Count
ëë" '
(
ëë' (
)
ëë( )
,
ëë) *
Importe
íí 
=
íí 
ta
íí  
.
íí  !
Sum
íí! $
(
íí$ %
t
íí% &
=>
íí' )
t
íí* +
.
íí+ ,
importe_total
íí, 9
)
íí9 :
}
ìì 
)
ìì 
;
ìì 
;
ìì 
var
ïï 
info
ïï 
=
ïï 
InfoReporte
ïï &
.
ïï& '
ToList
ïï' -
(
ïï- .
)
ïï. /
;
ïï/ 0
info
óó 
.
óó 
ForEach
óó 
(
óó 
m
óó 
=>
óó !
{
òò 
var
ôô 
nombreArray
ôô #
=
ôô$ %
m
ôô& '
.
ôô' (
Mozo
ôô( ,
.
ôô, -
Split
ôô- 2
(
ôô2 3
$char
ôô3 6
)
ôô6 7
;
ôô7 8
m
öö 
.
öö 
Mozo
öö 
=
öö 
nombreArray
öö (
[
öö( )
$num
öö) *
]
öö* +
+
öö, -
$str
öö. 1
+
öö2 3
nombreArray
öö4 ?
[
öö? @
$num
öö@ A
]
ööA B
+
ööC D
$str
ööE H
+
ööI J
nombreArray
ööK V
[
ööV W
$num
ööW X
]
ööX Y
;
ööY Z
}
õõ 
)
õõ 
;
õõ 
return
úú 
info
úú 
;
úú 
}
ùù 
catch
ûû 
(
ûû 
	Exception
ûû 
e
ûû 
)
ûû 
{
üü 
throw
†† 
e
†† 
;
†† 
}
°° 
}
¢¢ 	
public
££ 
IEnumerable
££ 
<
££ &
ItemRestaurante_Consulta
££ 3
>
££3 4:
,ObtenerOrdenesInclusiveItemsYDetallesDeOrden
££5 a
(
££a b
DateTime
££b j

fechaDesde
££k u
,
££u v
DateTime
££w 

fechaHasta££Ä ä
)££ä ã
{
§§ 	
try
•• 
{
¶¶ 
int
ßß 
tipo
ßß 
=
ßß !
RestauranteSettings
ßß .
.
ßß. /
Default
ßß/ 6
.
ßß6 71
#IdTipoTransaccionOrdenDeRestaurante
ßß7 Z
;
ßßZ [
var
®® 
estadoDeDetalle
®® #
=
®®$ %
(
®®& '
int
®®' *
)
®®* +$
EstadoDeDetalleDeOrden
®®+ A
.
®®A B
Atendido
®®B J
;
®®J K
var
©© 
Resumen
©© 
=
©© 
_db
©© !
.
©©! "
Transaccion
©©" -
.
™™ 
Where
™™ 
(
™™ 
t
™™ 
=>
™™ 
t
™™ 
.
™™ 
fecha_inicio
™™ +
>=
™™, .

fechaDesde
™™/ 9
&&
™™: <
t
™™= >
.
™™> ?
fecha_inicio
™™? K
<=
™™L N

fechaHasta
™™O Y
&&
™™Z \
t
™™] ^
.
™™^ _!
id_tipo_transaccion
™™_ r
==
™™s u
tipo
™™v z
)
™™z {
.
´´ 

SelectMany
´´ 
(
´´ 
t
´´ 
=>
´´ !
t
´´" #
.
´´# $!
Detalle_transaccion
´´$ 7
)
´´7 8
.
´´8 9
Where
´´9 >
(
´´> ?
dt
´´? A
=>
´´B D
dt
´´E G
.
´´G H%
indicadorMultiproposito
´´H _
==
´´` b
estadoDeDetalle
´´c r
)
´´r s
.
¨¨ 
GroupBy
¨¨ 
(
¨¨ 
dt
¨¨ 
=>
¨¨ 
new
¨¨  #
{
≠≠ 
codigoConcepto
ÆÆ #
=
ÆÆ$ %
dt
ÆÆ& (
.
ÆÆ( )
Concepto_negocio
ÆÆ) 9
.
ÆÆ9 :
codigo
ÆÆ: @
,
ÆÆ@ A
nombreConcepto
ØØ #
=
ØØ$ %
dt
ØØ& (
.
ØØ( )
Concepto_negocio
ØØ) 9
.
ØØ9 :
nombre
ØØ: @
,
ØØ@ A

idConcepto
∞∞ 
=
∞∞  !
dt
∞∞" $
.
∞∞$ %!
id_concepto_negocio
∞∞% 8
,
∞∞8 9
precioReferencial
±± &
=
±±' (
dt
±±) +
.
±±+ ,
precio_unitario
±±, ;
}
≤≤ 
)
≤≤ 
.
≤≤ 
Select
≤≤ 
(
≤≤ 
dt
≤≤ 
=>
≤≤  
new
≤≤! $&
ItemRestaurante_Consulta
≤≤% =
(
≤≤= >
)
≤≤> ?
{
≥≥ 
Codigo
µµ 
=
µµ 
dt
µµ  
.
µµ  !
Key
µµ! $
.
µµ$ %
codigoConcepto
µµ% 3
,
µµ3 4

NombreItem
∂∂ 
=
∂∂  !
dt
∂∂" $
.
∂∂$ %
Key
∂∂% (
.
∂∂( )
nombreConcepto
∂∂) 7
,
∂∂7 8
Monto
∑∑ 
=
∑∑ 
dt
∑∑ 
.
∑∑  
Sum
∑∑  #
(
∑∑# $
a
∑∑$ %
=>
∑∑& (
a
∑∑) *
.
∑∑* +
total
∑∑+ 0
)
∑∑0 1
,
∑∑1 2
Cantidad
∏∏ 
=
∏∏ 
dt
∏∏  "
.
∏∏" #
Sum
∏∏# &
(
∏∏& '
a
∏∏' (
=>
∏∏) +
a
∏∏, -
.
∏∏- .
cantidad
∏∏. 6
)
∏∏6 7
,
∏∏7 8
Precio
ππ 
=
ππ 
dt
ππ  
.
ππ  !
Key
ππ! $
.
ππ$ %
precioReferencial
ππ% 6
}
∫∫ 
)
∫∫ 
;
∫∫ 
return
ªª 
Resumen
ªª 
;
ªª 
}
ºº 
catch
ΩΩ 
(
ΩΩ 
	Exception
ΩΩ 
e
ΩΩ 
)
ΩΩ 
{
ææ 
throw
øø 
e
øø 
;
øø 
}
¿¿ 
}
¡¡ 	
public
¬¬ 
IEnumerable
¬¬ 
<
¬¬ #
DetalleOrden_Consulta
¬¬ 0
>
¬¬0 1C
5ObtenerOrdenesDetalladasIncluyendoMozoyDetalleDeOrden
¬¬2 g
(
¬¬g h
DateTime
¬¬h p

fechaDesde
¬¬q {
,
¬¬{ |
DateTime¬¬} Ö

fechaHasta¬¬Ü ê
,¬¬ê ë&
EstadoDeDetalleDeOrden¬¬í ®
estadoDeDetalle¬¬© ∏
)¬¬∏ π
{
√√ 	
try
ƒƒ 
{
≈≈ 
int
∆∆ 
tipo
∆∆ 
=
∆∆ !
RestauranteSettings
∆∆ .
.
∆∆. /
Default
∆∆/ 6
.
∆∆6 71
#IdTipoTransaccionOrdenDeRestaurante
∆∆7 Z
;
∆∆Z [
var
«« 
estadoDetalle
«« !
=
««" #
(
««$ %
int
««% (
)
««( )
estadoDeDetalle
««) 8
;
««8 9
var
»» 
	Resultado
»» 
=
»» 
_db
»»  #
.
»»# $
Transaccion
»»$ /
.
…… 
Where
…… 
(
…… 
t
…… 
=>
…… 
t
…… 
.
…… 
fecha_inicio
…… +
>=
……, .

fechaDesde
……/ 9
&&
……: <
t
……= >
.
……> ?
fecha_inicio
……? K
<=
……L N

fechaHasta
……O Y
&&
……Z \
t
……] ^
.
……^ _!
id_tipo_transaccion
……_ r
==
……s u
tipo
……v z
)
……z {
.
   

SelectMany
   
(
   
t
   
=>
   !
t
  " #
.
  # $!
Detalle_transaccion
  $ 7
)
  7 8
.
  8 9
Where
  9 >
(
  > ?
dt
  ? A
=>
  B D
dt
  E G
.
  G H%
indicadorMultiproposito
  H _
==
  ` b
estadoDetalle
  c p
)
  p q
.
ÀÀ 
Select
ÀÀ 
(
ÀÀ 
dt
ÀÀ 
=>
ÀÀ 
new
ÀÀ "#
DetalleOrden_Consulta
ÀÀ# 8
(
ÀÀ8 9
)
ÀÀ9 :
{
ÃÃ 
Mozo
ÕÕ 
=
ÕÕ 
dt
ÕÕ 
.
ÕÕ 
Transaccion
ÕÕ *
.
ÕÕ* +
Actor_negocio2
ÕÕ+ 9
.
ÕÕ9 :
Actor
ÕÕ: ?
.
ÕÕ? @
primer_nombre
ÕÕ@ M
,
ÕÕM N
Cantidad
ŒŒ 
=
ŒŒ 
dt
ŒŒ  "
.
ŒŒ" #
cantidad
ŒŒ# +
,
ŒŒ+ ,
Codigo
œœ 
=
œœ 
dt
œœ  
.
œœ  !
Transaccion
œœ! ,
.
œœ, -
codigo
œœ- 3
,
œœ3 4
Monto
–– 
=
–– 
dt
–– 
.
––  
total
––  %
,
––% &

NombreItem
—— 
=
——  !
dt
——" $
.
——$ %
Concepto_negocio
——% 5
.
——5 6
nombre
——6 <
,
——< =
Precio
““ 
=
““ 
dt
““  
.
““  !
precio_unitario
““! 0
,
““0 1
	FechaHora
”” 
=
””  
dt
””! #
.
””# $
Transaccion
””$ /
.
””/ 0
fecha_inicio
””0 <
,
””< =
Mesa
‘‘ 
=
‘‘ 
dt
‘‘ 
.
‘‘ 
Transaccion
‘‘ *
.
‘‘* +
Transaccion2
‘‘+ 7
.
‘‘7 8
Actor_negocio4
‘‘8 F
.
‘‘F G
Actor
‘‘G L
.
‘‘L M
primer_nombre
‘‘M Z
}
’’ 
)
’’ 
.
’’ 
ToList
’’ 
(
’’ 
)
’’ 
;
’’ 
var
÷÷ 
grupo
÷÷ 
=
÷÷ 
	Resultado
÷÷ %
.
÷÷% &
GroupBy
÷÷& -
(
÷÷- .
dor
÷÷. 1
=>
÷÷2 4
new
÷÷5 8
{
÷÷9 :
dor
÷÷; >
.
÷÷> ?
Codigo
÷÷? E
,
÷÷E F
dor
÷÷G J
.
÷÷J K

NombreItem
÷÷K U
,
÷÷U V
dor
÷÷W Z
.
÷÷Z [
Mozo
÷÷[ _
,
÷÷_ `
dor
÷÷a d
.
÷÷d e
Mesa
÷÷e i
,
÷÷i j
dor
÷÷k n
.
÷÷n o
	FechaHora
÷÷o x
,
÷÷x y
dor
÷÷z }
.
÷÷} ~
Precio÷÷~ Ñ
}÷÷Ö Ü
)÷÷Ü á
;÷÷á à
	Resultado
◊◊ 
=
◊◊ 
grupo
◊◊ !
.
◊◊! "
Select
◊◊" (
(
◊◊( )
dor
◊◊) ,
=>
◊◊- /
new
◊◊0 3#
DetalleOrden_Consulta
◊◊4 I
(
◊◊I J
)
◊◊J K
{
ÿÿ 
Codigo
ŸŸ 
=
ŸŸ 
dor
ŸŸ  
.
ŸŸ  !
Key
ŸŸ! $
.
ŸŸ$ %
Codigo
ŸŸ% +
,
ŸŸ+ ,
Mozo
⁄⁄ 
=
⁄⁄ 
dor
⁄⁄ 
.
⁄⁄ 
Key
⁄⁄ "
.
⁄⁄" #
Mozo
⁄⁄# '
,
⁄⁄' (
Mesa
€€ 
=
€€ 
dor
€€ 
.
€€ 
Key
€€ "
.
€€" #
Mesa
€€# '
,
€€' (

NombreItem
‹‹ 
=
‹‹  
dor
‹‹! $
.
‹‹$ %
Key
‹‹% (
.
‹‹( )

NombreItem
‹‹) 3
,
‹‹3 4
	FechaHora
›› 
=
›› 
dor
››  #
.
››# $
Key
››$ '
.
››' (
	FechaHora
››( 1
,
››1 2
Cantidad
ﬁﬁ 
=
ﬁﬁ 
dor
ﬁﬁ "
.
ﬁﬁ" #
Sum
ﬁﬁ# &
(
ﬁﬁ& '
g
ﬁﬁ' (
=>
ﬁﬁ) +
g
ﬁﬁ, -
.
ﬁﬁ- .
Cantidad
ﬁﬁ. 6
)
ﬁﬁ6 7
,
ﬁﬁ7 8
Precio
ﬂﬂ 
=
ﬂﬂ 
dor
ﬂﬂ  
.
ﬂﬂ  !
Key
ﬂﬂ! $
.
ﬂﬂ$ %
Precio
ﬂﬂ% +
,
ﬂﬂ+ ,
Monto
‡‡ 
=
‡‡ 
dor
‡‡ 
.
‡‡  
Sum
‡‡  #
(
‡‡# $
g
‡‡$ %
=>
‡‡& (
g
‡‡) *
.
‡‡* +
Monto
‡‡+ 0
)
‡‡0 1
,
‡‡1 2
}
·· 
)
·· 
.
·· 
ToList
·· 
(
·· 
)
·· 
;
·· 
var
„„ 
resultadoFinal
„„ "
=
„„# $
	Resultado
„„% .
.
„„. /
ToList
„„/ 5
(
„„5 6
)
„„6 7
;
„„7 8
resultadoFinal
‰‰ 
.
‰‰ 
ForEach
‰‰ &
(
‰‰& '
m
‰‰' (
=>
‰‰) +
{
ÂÂ 
var
ÊÊ 
nombreArray
ÊÊ #
=
ÊÊ$ %
m
ÊÊ& '
.
ÊÊ' (
Mozo
ÊÊ( ,
.
ÊÊ, -
Split
ÊÊ- 2
(
ÊÊ2 3
$char
ÊÊ3 6
)
ÊÊ6 7
;
ÊÊ7 8
m
ÁÁ 
.
ÁÁ 
Mozo
ÁÁ 
=
ÁÁ 
nombreArray
ÁÁ (
[
ÁÁ( )
$num
ÁÁ) *
]
ÁÁ* +
+
ÁÁ, -
$str
ÁÁ. 1
+
ÁÁ2 3
nombreArray
ÁÁ4 ?
[
ÁÁ? @
$num
ÁÁ@ A
]
ÁÁA B
+
ÁÁC D
$str
ÁÁE H
+
ÁÁI J
nombreArray
ÁÁK V
[
ÁÁV W
$num
ÁÁW X
]
ÁÁX Y
;
ÁÁY Z
}
ËË 
)
ËË 
;
ËË 
return
ÈÈ 
resultadoFinal
ÈÈ %
;
ÈÈ% &
}
ÍÍ 
catch
ÎÎ 
(
ÎÎ 
	Exception
ÎÎ 
e
ÎÎ 
)
ÎÎ 
{
ÏÏ 
throw
ÌÌ 
e
ÌÌ 
;
ÌÌ 
}
ÓÓ 
}
ÔÔ 	
public
ÒÒ 
IEnumerable
ÒÒ 
<
ÒÒ $
OrdenAtencion_Consulta
ÒÒ 1
>
ÒÒ1 2$
ObtenerOrdenesAtencion
ÒÒ3 I
(
ÒÒI J
DateTime
ÒÒJ R
desde
ÒÒS X
,
ÒÒX Y
DateTime
ÒÒZ b
hasta
ÒÒc h
,
ÒÒh i
int
ÒÒj m
idEstablecimiento
ÒÒn 
)ÒÒ Ä
{
ÚÚ 	
try
ÛÛ 
{
ÙÙ 
IEnumerable
ıı 
<
ıı $
OrdenAtencion_Consulta
ıı 2
>
ıı2 3
ordenes
ıı4 ;
=
ıı< =
_db
ıı> A
.
ııA B
Transaccion
ııB M
.
ııM N
Where
ııN S
(
ııS T
t
ııT U
=>
ııV X
t
ııY Z
.
ııZ [
fecha_inicio
ıı[ g
>=
ııh j
desde
ıık p
&&
ııq s
t
ııt u
.
ııu v
fecha_inicioııv Ç
<=ııÉ Ö
hastaııÜ ã
&&ııå é
tııè ê
.ııê ë#
id_tipo_transaccionııë §
==ıı• ß#
RestauranteSettingsıı® ª
.ııª º
Defaultııº √
.ıı√ ƒ3
#IdTipoTransaccionOrdenDeRestauranteııƒ Á
&&ııË Í
tııÎ Ï
.ııÏ Ì
Transaccion2ııÌ ˘
.ıı˘ ˙
Actor_negocio4ıı˙ à
.ııà â
Actor_negocio2ııâ ó
.ııó ò&
id_actor_negocio_padreııò Æ
==ııØ ±!
idEstablecimientoıı≤ √
)ıı√ ƒ
.ııƒ ≈
Selectıı≈ À
(ııÀ Ã
tııÃ Õ
=>ııŒ –
newıı— ‘&
OrdenAtencion_Consultaıı’ Î
(ııÎ Ï
)ııÏ Ì
{
ˆˆ 

IdAtencion
˜˜ 
=
˜˜  
t
˜˜! "
.
˜˜" #
Transaccion2
˜˜# /
.
˜˜/ 0
id
˜˜0 2
,
˜˜2 3
FechaHoraAtencion
¯¯ %
=
¯¯& '
t
¯¯( )
.
¯¯) *
Transaccion2
¯¯* 6
.
¯¯6 7
fecha_inicio
¯¯7 C
,
¯¯C D
Mesa
˘˘ 
=
˘˘ 
t
˘˘ 
.
˘˘ 
Transaccion2
˘˘ )
.
˘˘) *
Actor_negocio4
˘˘* 8
.
˘˘8 9
Actor
˘˘9 >
.
˘˘> ?
primer_nombre
˘˘? L
,
˘˘L M
Mozo
˙˙ 
=
˙˙ 
t
˙˙ 
.
˙˙ 
Actor_negocio2
˙˙ +
.
˙˙+ ,
Actor
˙˙, 1
.
˙˙1 2
primer_nombre
˙˙2 ?
,
˙˙? @
CodigoOrden
˚˚ 
=
˚˚  !
t
˚˚" #
.
˚˚# $
codigo
˚˚$ *
,
˚˚* +
Importe
¸¸ 
=
¸¸ 
t
¸¸ 
.
¸¸  
importe_total
¸¸  -
,
¸¸- .
EsAtencionEnSalon
˝˝ %
=
˝˝& '
!
˝˝( )
t
˝˝) *
.
˝˝* +
Transaccion2
˝˝+ 7
.
˝˝7 8

indicador1
˝˝8 B
,
˝˝B C
	Facturado
˛˛ 
=
˛˛ 
t
˛˛  !
.
˛˛! "
Transaccion2
˛˛" .
.
˛˛. / 
Evento_transaccion
˛˛/ A
.
˛˛A B
Select
˛˛B H
(
˛˛H I
ev
˛˛I K
=>
˛˛L N
ev
˛˛O Q
.
˛˛Q R
	id_evento
˛˛R [
)
˛˛[ \
.
˛˛\ ]
Contains
˛˛] e
(
˛˛e f
MaestroSettings
˛˛f u
.
˛˛u v
Default
˛˛v }
.
˛˛} ~.
IdDetalleMaestroEstadoFacturado˛˛~ ù
)˛˛ù û
}
ˇˇ 
)
ˇˇ 
;
ˇˇ 
var
ÄÄ 
resultadoFinal
ÄÄ "
=
ÄÄ# $
ordenes
ÄÄ% ,
.
ÄÄ, -
ToList
ÄÄ- 3
(
ÄÄ3 4
)
ÄÄ4 5
;
ÄÄ5 6
resultadoFinal
ÅÅ 
.
ÅÅ 
ForEach
ÅÅ &
(
ÅÅ& '
m
ÅÅ' (
=>
ÅÅ) +
{
ÇÇ 
var
ÉÉ 
nombreArray
ÉÉ #
=
ÉÉ$ %
m
ÉÉ& '
.
ÉÉ' (
Mozo
ÉÉ( ,
.
ÉÉ, -
Split
ÉÉ- 2
(
ÉÉ2 3
$char
ÉÉ3 6
)
ÉÉ6 7
;
ÉÉ7 8
m
ÑÑ 
.
ÑÑ 
Mozo
ÑÑ 
=
ÑÑ 
nombreArray
ÑÑ (
[
ÑÑ( )
$num
ÑÑ) *
]
ÑÑ* +
+
ÑÑ, -
$str
ÑÑ. 1
+
ÑÑ2 3
nombreArray
ÑÑ4 ?
[
ÑÑ? @
$num
ÑÑ@ A
]
ÑÑA B
+
ÑÑC D
$str
ÑÑE H
+
ÑÑI J
nombreArray
ÑÑK V
[
ÑÑV W
$num
ÑÑW X
]
ÑÑX Y
;
ÑÑY Z
}
ÖÖ 
)
ÖÖ 
;
ÖÖ 
return
ÜÜ 
resultadoFinal
ÜÜ %
;
ÜÜ% &
}
áá 
catch
àà 
(
àà 
	Exception
àà 
e
àà 
)
àà 
{
ââ 
throw
ää 
new
ää 
DatosException
ää (
(
ää( )
$str
ää) O
,
ääO P
e
ääQ R
)
ääR S
;
ääS T
}
ãã 
}
åå 	
public
çç 
IEnumerable
çç 
<
çç +
OrdenPorModoAtencion_Consulta
çç 8
>
çç8 9+
ObtenerOrdenesPorModoAtencion
çç: W
(
ççW X
DateTime
ççX `
desde
çça f
,
ççf g
DateTime
ççh p
hasta
ççq v
,
ççv w
int
ççx { 
idEstablecimientoçç| ç
)ççç é
{
éé 	
try
èè 
{
êê 
IEnumerable
ëë 
<
ëë +
OrdenPorModoAtencion_Consulta
ëë 9
>
ëë9 :
ordenes
ëë; B
=
ëëC D
_db
ëëE H
.
ëëH I
Transaccion
ëëI T
.
ëëT U
Where
ëëU Z
(
ëëZ [
t
ëë[ \
=>
ëë] _
t
ëë` a
.
ëëa b
fecha_inicio
ëëb n
>=
ëëo q
desde
ëër w
&&
ëëx z
t
ëë{ |
.
ëë| }
fecha_inicioëë} â
<=ëëä å
hastaëëç í
&&ëëì ï
tëëñ ó
.ëëó ò#
id_tipo_transaccionëëò ´
==ëë¨ Æ#
RestauranteSettingsëëØ ¬
.ëë¬ √
Defaultëë√  
.ëë  À3
#IdTipoTransaccionOrdenDeRestauranteëëÀ Ó
&&ëëÔ Ò
tëëÚ Û
.ëëÛ Ù
Transaccion2ëëÙ Ä
.ëëÄ Å
Actor_negocio4ëëÅ è
.ëëè ê
Actor_negocio2ëëê û
.ëëû ü&
id_actor_negocio_padreëëü µ
==ëë∂ ∏!
idEstablecimientoëëπ  
)ëë  À
.ëëÀ Ã
SelectëëÃ “
(ëë“ ”
tëë” ‘
=>ëë’ ◊
newëëÿ €-
OrdenPorModoAtencion_Consultaëë‹ ˘
(ëë˘ ˙
)ëë˙ ˚
{
íí 

IdAtencion
ìì 
=
ìì  
t
ìì! "
.
ìì" #
Transaccion2
ìì# /
.
ìì/ 0
id
ìì0 2
,
ìì2 3
FechaHoraAtencion
îî %
=
îî& '
t
îî( )
.
îî) *
Transaccion2
îî* 6
.
îî6 7
fecha_inicio
îî7 C
,
îîC D
Mesa
ïï 
=
ïï 
t
ïï 
.
ïï 
Transaccion2
ïï )
.
ïï) *
Actor_negocio4
ïï* 8
.
ïï8 9
Actor
ïï9 >
.
ïï> ?
primer_nombre
ïï? L
,
ïïL M
Mozo
ññ 
=
ññ 
t
ññ 
.
ññ 
Actor_negocio2
ññ +
.
ññ+ ,
Actor
ññ, 1
.
ññ1 2
primer_nombre
ññ2 ?
,
ññ? @
CodigoOrden
óó 
=
óó  !
t
óó" #
.
óó# $
codigo
óó$ *
,
óó* +
Importe
òò 
=
òò 
t
òò 
.
òò  
importe_total
òò  -
,
òò- .
EsAtencionEnSalon
ôô %
=
ôô& '
!
ôô( )
t
ôô) *
.
ôô* +
Transaccion2
ôô+ 7
.
ôô7 8

indicador1
ôô8 B
,
ôôB C#
EsAtencionPorDelivery
öö )
=
öö* +
t
öö, -
.
öö- .
Transaccion2
öö. :
.
öö: ;

indicador2
öö; E
,
ööE F
Ambiente
õõ 
=
õõ 
t
õõ  
.
õõ  !
Transaccion2
õõ! -
.
õõ- .
Actor_negocio4
õõ. <
.
õõ< =
Actor_negocio2
õõ= K
.
õõK L
Actor
õõL Q
.
õõQ R
primer_nombre
õõR _
,
õõ_ `
	Facturado
úú 
=
úú 
t
úú  !
.
úú! "
Transaccion2
úú" .
.
úú. / 
Evento_transaccion
úú/ A
.
úúA B
Select
úúB H
(
úúH I
ev
úúI K
=>
úúL N
ev
úúO Q
.
úúQ R
	id_evento
úúR [
)
úú[ \
.
úú\ ]
Contains
úú] e
(
úúe f
MaestroSettings
úúf u
.
úúu v
Default
úúv }
.
úú} ~.
IdDetalleMaestroEstadoFacturadoúú~ ù
)úúù û
}
ùù 
)
ùù 
;
ùù 
var
ûû 
resultadoFinal
ûû "
=
ûû# $
ordenes
ûû% ,
.
ûû, -
ToList
ûû- 3
(
ûû3 4
)
ûû4 5
;
ûû5 6
resultadoFinal
üü 
.
üü 
ForEach
üü &
(
üü& '
m
üü' (
=>
üü) +
{
†† 
var
°° 
nombreArray
°° #
=
°°$ %
m
°°& '
.
°°' (
Mozo
°°( ,
.
°°, -
Split
°°- 2
(
°°2 3
$char
°°3 6
)
°°6 7
;
°°7 8
m
¢¢ 
.
¢¢ 
Mozo
¢¢ 
=
¢¢ 
nombreArray
¢¢ (
[
¢¢( )
$num
¢¢) *
]
¢¢* +
+
¢¢, -
$str
¢¢. 1
+
¢¢2 3
nombreArray
¢¢4 ?
[
¢¢? @
$num
¢¢@ A
]
¢¢A B
+
¢¢C D
$str
¢¢E H
+
¢¢I J
nombreArray
¢¢K V
[
¢¢V W
$num
¢¢W X
]
¢¢X Y
;
¢¢Y Z
}
££ 
)
££ 
;
££ 
return
§§ 
resultadoFinal
§§ %
;
§§% &
}
•• 
catch
¶¶ 
(
¶¶ 
	Exception
¶¶ 
e
¶¶ 
)
¶¶ 
{
ßß 
throw
®® 
new
®® 
DatosException
®® (
(
®®( )
$str
®®) O
,
®®O P
e
®®Q R
)
®®R S
;
®®S T
}
©© 
}
™™ 	
public
´´ 
IEnumerable
´´ 
<
´´ 
ResumenAtencion
´´ *
>
´´* +1
#ObtenerResumenDeAtencionesPorEstado
´´, O
(
´´O P
DateTime
´´P X

fechaDesde
´´Y c
,
´´c d
DateTime
´´e m

facheHasta
´´n x
,
´´x y
int
´´z }
idEstado´´~ Ü
,´´Ü á
int´´à ã
[´´ã å
]´´å ç$
IdsCentrosDeAtencion´´é ¢
)´´¢ £
{
¨¨ 	
try
≠≠ 
{
ÆÆ 
IEnumerable
ØØ 
<
ØØ 
ResumenAtencion
ØØ +
>
ØØ+ ,

atenciones
ØØ- 7
=
ØØ8 9
_db
ØØ: =
.
ØØ= > 
Estado_transaccion
ØØ> P
.
ØØP Q
Where
ØØQ V
(
ØØV W
et
ØØW Y
=>
ØØZ \
et
ØØ] _
.
ØØ_ `
	id_estado
ØØ` i
==
ØØj l
idEstado
ØØm u
&&
ØØv x
et
ØØy {
.
ØØ{ |
fechaØØ| Å
>=ØØÇ Ñ

fechaDesdeØØÖ è
&&ØØê í
etØØì ï
.ØØï ñ
fechaØØñ õ
<=ØØú û

facheHastaØØü ©
)ØØ© ™
.ØØ™ ´
SelectØØ´ ±
(ØØ± ≤
etØØ≤ ¥
=>ØØµ ∑
etØØ∏ ∫
.ØØ∫ ª
TransaccionØØª ∆
)ØØ∆ «
.ØØ« »
WhereØØ» Õ
(ØØÕ Œ
tØØŒ œ
=>ØØ– “
tØØ” ‘
.ØØ‘ ’#
id_tipo_transaccionØØ’ Ë
==ØØÈ Î#
RestauranteSettingsØØÏ ˇ
.ØØˇ Ä
DefaultØØÄ á
.ØØá à6
&IdTipoTransaccionAtencionDeRestauranteØØà Æ
&&ØØØ ±$
IdsCentrosDeAtencionØØ≤ ∆
.ØØ∆ «
ContainsØØ« œ
(ØØœ –
tØØ– —
.ØØ— “(
id_actor_negocio_internoØØ“ Í
)ØØÍ Î
)ØØÎ Ï
.ØØÏ Ì
SelectØØÌ Û
(ØØÛ Ù
tØØÙ ı
=>ØØˆ ¯
newØØ˘ ¸
ResumenAtencionØØ˝ å
(ØØå ç
)ØØç é
{
∞∞ 
Id
±± 
=
±± 
t
±± 
.
±± 
id
±± 
,
±± 
FechaAtencion
≤≤ !
=
≤≤" #
t
≤≤$ %
.
≤≤% &
fecha_inicio
≤≤& 2
,
≤≤2 3
NombreAmbiente
≥≥ "
=
≥≥# $
t
≥≥% &
.
≥≥& '
Actor_negocio4
≥≥' 5
.
≥≥5 6
Actor_negocio2
≥≥6 D
.
≥≥D E
Actor
≥≥E J
.
≥≥J K
primer_nombre
≥≥K X
,
≥≥X Y

NombreMozo
¥¥ 
=
¥¥  
t
¥¥! "
.
¥¥" # 
Estado_transaccion
¥¥# 5
.
¥¥5 6
FirstOrDefault
¥¥6 D
(
¥¥D E
et
¥¥E G
=>
¥¥H J
et
¥¥K M
.
¥¥M N
	id_estado
¥¥N W
==
¥¥X Z
MaestroSettings
¥¥[ j
.
¥¥j k
Default
¥¥k r
.
¥¥r s,
IdDetalleMaestroEstadoCerrado¥¥s ê
)¥¥ê ë
.¥¥ë í
Actor_negocio¥¥í ü
.¥¥ü †
Actor¥¥† •
.¥¥• ¶
tercer_nombre¥¥¶ ≥
,¥¥≥ ¥
IdMesa
µµ 
=
µµ 
t
µµ 
.
µµ 
Actor_negocio4
µµ -
.
µµ- .
id
µµ. 0
,
µµ0 1

NombreMesa
∂∂ 
=
∂∂  
t
∂∂! "
.
∂∂" #
Actor_negocio4
∂∂# 1
.
∂∂1 2
Actor
∂∂2 7
.
∂∂7 8
primer_nombre
∂∂8 E
,
∂∂E F
ImporteTotal
∑∑  
=
∑∑! "
t
∑∑# $
.
∑∑$ %
importe_total
∑∑% 2
,
∑∑2 3
	Facturado
∏∏ 
=
∏∏ 
t
∏∏  !
.
∏∏! " 
Evento_transaccion
∏∏" 4
.
∏∏4 5
Select
∏∏5 ;
(
∏∏; <
ev
∏∏< >
=>
∏∏? A
ev
∏∏B D
.
∏∏D E
	id_evento
∏∏E N
)
∏∏N O
.
∏∏O P
Contains
∏∏P X
(
∏∏X Y
MaestroSettings
∏∏Y h
.
∏∏h i
Default
∏∏i p
.
∏∏p q.
IdDetalleMaestroEstadoFacturado∏∏q ê
)∏∏ê ë
,∏∏ë í

Confirmado
ππ 
=
ππ  
t
ππ! "
.
ππ" # 
Evento_transaccion
ππ# 5
.
ππ5 6
Select
ππ6 <
(
ππ< =
ev
ππ= ?
=>
ππ@ B
ev
ππC E
.
ππE F
	id_evento
ππF O
)
ππO P
.
ππP Q
Contains
ππQ Y
(
ππY Z
MaestroSettings
ππZ i
.
ππi j
Default
ππj q
.
ππq r/
 IdDetalleMaestroEstadoConfirmadoππr í
)ππí ì
}
∫∫ 
)
∫∫ 
;
∫∫ 
var
ªª 
	resultado
ªª 
=
ªª 

atenciones
ªª  *
.
ªª* +
ToList
ªª+ 1
(
ªª1 2
)
ªª2 3
;
ªª3 4
return
ΩΩ 
	resultado
ΩΩ  
;
ΩΩ  !
}
ææ 
catch
øø 
(
øø 
	Exception
øø 
e
øø 
)
øø 
{
¿¿ 
throw
¡¡ 
e
¡¡ 
;
¡¡ 
}
¬¬ 
}
√√ 	
public
≈≈ !
AtencionRestaurante
≈≈ "'
ObtenerAtencionEspecifica
≈≈# <
(
≈≈< =
long
≈≈= A
id
≈≈B D
)
≈≈D E
{
∆∆ 	
try
«« 
{
»» 
Transaccion
…… 
transaccion
…… '
=
……( )
_db
……* -
.
……- .
Transaccion
……. 9
.
   
Include
   
(
   
t
   
=>
   !
t
  " #
.
  # $
Transaccion1
  $ 0
)
  0 1
.
ÀÀ 
Include
ÀÀ 
(
ÀÀ 
t
ÀÀ 
=>
ÀÀ !
t
ÀÀ" #
.
ÀÀ# $
Actor_negocio1
ÀÀ$ 2
.
ÀÀ2 3
Actor
ÀÀ3 8
)
ÀÀ8 9
.
ÃÃ 
Include
ÃÃ 
(
ÃÃ 
t
ÃÃ 
=>
ÃÃ !
t
ÃÃ" #
.
ÃÃ# $
Transaccion1
ÃÃ$ 0
.
ÃÃ0 1
Select
ÃÃ1 7
(
ÃÃ7 8
to
ÃÃ8 :
=>
ÃÃ; =
to
ÃÃ> @
.
ÃÃ@ A!
Detalle_transaccion
ÃÃA T
)
ÃÃT U
)
ÃÃU V
.
ÕÕ 
Include
ÕÕ 
(
ÕÕ 
t
ÕÕ 
=>
ÕÕ !
t
ÕÕ" #
.
ÕÕ# $
Transaccion1
ÕÕ$ 0
.
ÕÕ0 1
Select
ÕÕ1 7
(
ÕÕ7 8
to
ÕÕ8 :
=>
ÕÕ; =
to
ÕÕ> @
.
ÕÕ@ A!
Detalle_transaccion
ÕÕA T
.
ÕÕT U
Select
ÕÕU [
(
ÕÕ[ \
dt
ÕÕ\ ^
=>
ÕÕ_ a
dt
ÕÕb d
.
ÕÕd e
Concepto_negocio
ÕÕe u
)
ÕÕu v
)
ÕÕv w
)
ÕÕw x
.
ŒŒ 
FirstOrDefault
ŒŒ #
(
ŒŒ# $
t
ŒŒ$ %
=>
ŒŒ& (
t
ŒŒ) *
.
ŒŒ* +
id
ŒŒ+ -
==
ŒŒ. 0
id
ŒŒ1 3
)
ŒŒ3 4
;
ŒŒ4 5!
AtencionRestaurante
–– #
atencion
––$ ,
=
––- .!
AtencionRestaurante
––/ B
.
––B C
Convert
––C J
(
––J K
transaccion
––K V
)
––V W
;
––W X
return
““ 
atencion
““ 
;
““  
}
‘‘ 
catch
’’ 
(
’’ 
	Exception
’’ 
e
’’ 
)
’’ 
{
÷÷ 
throw
◊◊ 
e
◊◊ 
;
◊◊ 
}
ÿÿ 
}
ŸŸ 	
public
€€ 
IEnumerable
€€ 
<
€€ 
long
€€ 
>
€€  :
,ObtenerIdsTransaccionDeTransaccionReferencia
€€! M
(
€€M N
long
€€N R
idTransaccion
€€S `
)
€€` a
{
‹‹ 	
try
›› 
{
ﬁﬁ 
var
ﬂﬂ 
result
ﬂﬂ 
=
ﬂﬂ 
_db
ﬂﬂ  
.
ﬂﬂ  !
Transaccion
ﬂﬂ! ,
.
ﬂﬂ, -
Where
ﬂﬂ- 2
(
ﬂﬂ2 3
t
ﬂﬂ3 4
=>
ﬂﬂ5 7
t
ﬂﬂ8 9
.
ﬂﬂ9 :'
id_transaccion_referencia
ﬂﬂ: S
==
ﬂﬂT V
idTransaccion
ﬂﬂW d
)
ﬂﬂd e
.
ﬂﬂe f
Select
ﬂﬂf l
(
ﬂﬂl m
t
ﬂﬂm n
=>
ﬂﬂo q
t
ﬂﬂr s
.
ﬂﬂs t
id
ﬂﬂt v
)
ﬂﬂv w
;
ﬂﬂw x
return
‡‡ 
result
‡‡ 
;
‡‡ 
}
·· 
catch
‚‚ 
(
‚‚ 
	Exception
‚‚ 
e
‚‚ 
)
‚‚ 
{
„„ 
throw
‰‰ 
e
‰‰ 
;
‰‰ 
}
ÂÂ 
}
ÊÊ 	
public
ËË 
OperationResult
ËË 3
%ActualizarDetalleDeDetalleTransaccion
ËË D
(
ËËD E
long
ËËE I
	idDetalle
ËËJ S
,
ËËS T
string
ËËU [
detalleString
ËË\ i
)
ËËi j
{
ÈÈ 	
try
ÍÍ 
{
ÎÎ 
var
ÏÏ !
detalle_transaccion
ÏÏ '
=
ÏÏ( )
_db
ÏÏ* -
.
ÏÏ- .!
Detalle_transaccion
ÏÏ. A
.
ÏÏA B
FirstOrDefault
ÏÏB P
(
ÏÏP Q
t
ÏÏQ R
=>
ÏÏS U
t
ÏÏV W
.
ÏÏW X
id
ÏÏX Z
==
ÏÏ[ ]
	idDetalle
ÏÏ^ g
)
ÏÏg h
;
ÏÏh i!
detalle_transaccion
ÌÌ #
.
ÌÌ# $
detalle
ÌÌ$ +
=
ÌÌ, -
detalleString
ÌÌ. ;
;
ÌÌ; <
var
ÓÓ 
result
ÓÓ 
=
ÓÓ 
Save
ÓÓ !
(
ÓÓ! "
)
ÓÓ" #
;
ÓÓ# $
return
ÔÔ 
result
ÔÔ 
;
ÔÔ 
}
 
catch
ÒÒ 
(
ÒÒ 
	Exception
ÒÒ 
e
ÒÒ 
)
ÒÒ 
{
ÚÚ 
throw
ÛÛ 
new
ÛÛ 
DatosException
ÛÛ (
(
ÛÛ( )
$str
ÛÛ) E
,
ÛÛE F
e
ÛÛG H
)
ÛÛH I
;
ÛÛI J
}
ıı 
}
ˆˆ 	
}
¯¯ 
}˘˘ Í
OD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\ConfiguracionDatos.cs
	namespace

 	
Tsp


 
.

 
Sigescom

 
.

 
AccesoDatos

 "
{ 
public 

class 
ConfiguracionDatos #
:$ %
RepositorioBase& 5
,5 6%
IConfiguracionRepositorio7 P
{ 
public 
OperationResult 
crearConfiguracion 1
(1 2
Configuracion2 ?
configuracion@ M
)M N
{ 	
try 
{ 
_db 
. 
Configuracion !
.! "
Add" %
(% &
configuracion& 3
)3 4
;4 5
var 
result 
= 
Save !
(! "
)" #
;# $
result 
. 
data 
= 
configuracion +
.+ ,
id, .
;. /
return 
result 
; 
} 
catch 
( 
	Exception 
e 
) 
{ 
throw 
e 
; 
} 
} 	
public 
OperationResult '
crearParametroConfiguracion :
(: ;&
Parametro_de_configuracion; U
	parametroV _
)_ `
{ 	
try 
{   
_db!! 
.!! &
Parametro_de_configuracion!! .
.!!. /
Add!!/ 2
(!!2 3
	parametro!!3 <
)!!< =
;!!= >
var"" 
result"" 
="" 
Save"" !
(""! "
)""" #
;""# $
result## 
.## 
data## 
=## 
	parametro## '
.##' (
id##( *
;##* +
return$$ 
result$$ 
;$$ 
}%% 
catch&& 
(&& 
	Exception&& 
e&& 
)&& 
{'' 
throw(( 
e(( 
;(( 
})) 
}** 	
public++ 
OperationResult++ #
actualizarConfiguracion++ 6
(++6 7
Configuracion++7 D
configuracion++E R
)++R S
{,, 	
try-- 
{.. 
Configuracion// 
dbConfiguracion// -
=//. /
_db//0 3
.//3 4
Configuracion//4 A
.//A B
Single//B H
(//H I
m//I J
=>//K M
m//N O
.//O P
id//P R
==//S U
configuracion//V c
.//c d
id//d f
)//f g
;//g h
_db00 
.00 
Entry00 
(00 
dbConfiguracion00 )
)00) *
.00* +
CurrentValues00+ 8
.008 9
	SetValues009 B
(00B C
configuracion00C P
)00P Q
;00Q R
var11 
result11 
=11 
Save11 !
(11! "
)11" #
;11# $
result22 
.22 
data22 
=22 
configuracion22 +
.22+ ,
id22, .
;22. /
return33 
result33 
;33 
}44 
catch55 
(55 
	Exception55 
e55 
)55 
{66 
return77 
new77 
OperationResult77 *
(77* +
e77+ ,
)77, -
;77- .
}88 
}99 	
public:: 
OperationResult:: ,
 actualizarParametroConfiguracion:: ?
(::? @&
Parametro_de_configuracion::@ Z
	parametro::[ d
)::d e
{;; 	
try<< 
{== &
Parametro_de_configuracion>> *
	dbDetalle>>+ 4
=>>5 6
_db>>7 :
.>>: ;&
Parametro_de_configuracion>>; U
.>>U V
Single>>V \
(>>\ ]
m>>] ^
=>>>_ a
m>>b c
.>>c d
id>>d f
==>>g i
	parametro>>j s
.>>s t
id>>t v
)>>v w
;>>w x
_db?? 
.?? 
Entry?? 
(?? 
	dbDetalle?? #
)??# $
.??$ %
CurrentValues??% 2
.??2 3
	SetValues??3 <
(??< =
	parametro??= F
)??F G
;??G H
var@@ 
result@@ 
=@@ 
Save@@ !
(@@! "
)@@" #
;@@# $
resultAA 
.AA 
dataAA 
=AA 
	parametroAA '
.AA' (
idAA( *
;AA* +
returnBB 
resultBB 
;BB 
}CC 
catchDD 
(DD 
	ExceptionDD 
eDD 
)DD 
{EE 
returnFF 
newFF 
OperationResultFF *
(FF* +
eFF+ ,
)FF, -
;FF- .
}GG 
}HH 	
publicII 
IEnumerableII 
<II 
ConfiguracionII (
>II( )"
obtenerConfiguracionesII* @
(II@ A
)IIA B
{JJ 	
tryKK 
{LL 
returnMM 
_dbMM 
.MM 
ConfiguracionMM (
;MM( )
}NN 
catchOO 
(OO 
	ExceptionOO 
eOO 
)OO 
{PP 
throwQQ 
eQQ 
;QQ 
}RR 
}SS 	
publicTT 
IEnumerableTT 
<TT &
Parametro_de_configuracionTT 5
>TT5 6*
obtenerParametrosConfiguracionTT7 U
(TTU V
intTTV Y
idConfiguracionTTZ i
)TTi j
{UU 	
tryVV 
{WW 
returnXX 
_dbXX 
.XX &
Parametro_de_configuracionXX 5
.XX5 6
WhereXX6 ;
(XX; <
dmXX< >
=>XX? A
dmXXB D
.XXD E
id_configuracionXXE U
==XXV X
idConfiguracionXXY h
)XXh i
;XXi j
}YY 
catchZZ 
(ZZ 
	ExceptionZZ 
eZZ 
)ZZ 
{[[ 
throw\\ 
e\\ 
;\\ 
}]] 
}__ 	
public`` &
Parametro_de_configuracion`` )+
ObtenerParametroDeConfiguracion``* I
(``I J
string``J P
nombre``Q W
)``W X
{aa 	
trybb 
{cc 
returndd 
_dbdd 
.dd &
Parametro_de_configuraciondd 5
.dd5 6
SingleOrDefaultdd6 E
(ddE F
pcddF H
=>ddI K
pcddL N
.ddN O
nombreddO U
==ddV X
nombreddY _
)dd_ `
;dd` a
}ee 
catchff 
(ff 
	Exceptionff 
eff 
)ff 
{gg 
throwhh 
ehh 
;hh 
}ii 
}kk 	
publicoo 
Detalle_maestrooo G
;ObtenerDetalleMaestroIncluidoTipoTransaccionTipoComprobanteoo Z
(ooZ [
intoo[ ^
	idMaestrooo_ h
,ooh i
intooj m 
idTipoDeComprobante	oon Å
)
ooÅ Ç
{pp 	
tryqq 
{rr 
returnss 
_dbss 
.ss 
Detalle_maestross *
.ss* +
Includess+ 2
(ss2 3
dmss3 5
=>ss6 8
dmss9 ;
.ss; <-
!Tipo_transaccion_tipo_comprobantess< ]
)ss] ^
.tt* +
Includett+ 2
(tt2 3
dmtt3 5
=>tt6 8
dmtt9 ;
.tt; <-
!Tipo_transaccion_tipo_comprobantett< ]
.tt] ^
Selecttt^ d
(ttd e
tttctte i
=>ttj l
tttcttm q
.ttq r
Tipo_transaccion	ttr Ç
)
ttÇ É
)
ttÉ Ñ
.uu* +
Whereuu+ 0
(uu0 1
dmuu1 3
=>uu4 6
dmuu7 9
.uu9 :

id_maestrouu: D
==uuE G
	idMaestrouuH Q
)uuQ R
.uuR S
SingleOrDefaultuuS b
(uub c
dmuuc e
=>uuf h
dmuui k
.uuk l
iduul n
==uuo q 
idTipoDeComprobante	uur Ö
)
uuÖ Ü
;
uuÜ á
}vv 
catchww 
(ww 
	Exceptionww 
eww 
)ww 
{xx 
throwyy 
eyy 
;yy 
}zz 
}|| 	
public}} 
IEnumerable}} 
<}} 
Detalle_maestro}} *
>}}* +H
<ObtenerDetallesMaestroIncluidoTipoTransaccionTipoComprobante}}, h
(}}h i
int}}i l
	idMaestro}}m v
)}}v w
{~~ 	
try 
{
ÄÄ 
return
ÅÅ 
_db
ÅÅ 
.
ÅÅ 
Detalle_maestro
ÅÅ *
.
ÅÅ* +
Include
ÅÅ+ 2
(
ÅÅ2 3
dm
ÅÅ3 5
=>
ÅÅ6 8
dm
ÅÅ9 ;
.
ÅÅ; </
!Tipo_transaccion_tipo_comprobante
ÅÅ< ]
)
ÅÅ] ^
.
ÇÇ+ ,
Include
ÇÇ, 3
(
ÇÇ3 4
dm
ÇÇ4 6
=>
ÇÇ7 9
dm
ÇÇ: <
.
ÇÇ< =/
!Tipo_transaccion_tipo_comprobante
ÇÇ= ^
.
ÇÇ^ _
Select
ÇÇ_ e
(
ÇÇe f
tttc
ÇÇf j
=>
ÇÇk m
tttc
ÇÇn r
.
ÇÇr s
Tipo_transaccionÇÇs É
)ÇÇÉ Ñ
)ÇÇÑ Ö
.
ÉÉ+ ,
Where
ÉÉ, 1
(
ÉÉ1 2
dm
ÉÉ2 4
=>
ÉÉ5 7
dm
ÉÉ8 :
.
ÉÉ: ;

id_maestro
ÉÉ; E
==
ÉÉF H
	idMaestro
ÉÉI R
)
ÉÉR S
.
ÉÉS T
OrderBy
ÉÉT [
(
ÉÉ[ \
dm
ÉÉ\ ^
=>
ÉÉ_ a
dm
ÉÉb d
.
ÉÉd e
nombre
ÉÉe k
)
ÉÉk l
;
ÉÉl m
}
ÑÑ 
catch
ÖÖ 
(
ÖÖ 
	Exception
ÖÖ 
e
ÖÖ 
)
ÖÖ 
{
ÜÜ 
throw
áá 
e
áá 
;
áá 
}
àà 
}
ââ 	
public
ää 
OperationResult
ää G
9ActualizarDetalleMaestroConTipoTransaccionTipoComprobante
ää X
(
ääX Y
Detalle_maestro
ääY h
detalle
ääi p
)
ääp q
{
ãã 	
try
åå 
{
çç 
Detalle_maestro
éé 
	dbDetalle
éé  )
=
éé* +
_db
éé, /
.
éé/ 0
Detalle_maestro
éé0 ?
.
éé? @
Single
éé@ F
(
ééF G
m
ééG H
=>
ééI K
m
ééL M
.
ééM N
id
ééN P
==
ééQ S
detalle
ééT [
.
éé[ \
id
éé\ ^
)
éé^ _
;
éé_ `
detalle
èè 
.
èè 
fecha_registro
èè &
=
èè' (
	dbDetalle
èè) 2
.
èè2 3
fecha_registro
èè3 A
;
èèA B
_db
êê 
.
êê 
Entry
êê 
(
êê 
	dbDetalle
êê #
)
êê# $
.
êê$ %
CurrentValues
êê% 2
.
êê2 3
	SetValues
êê3 <
(
êê< =
detalle
êê= D
)
êêD E
;
êêE F
List
íí 
<
íí /
!Tipo_transaccion_tipo_comprobante
íí 6
>
íí6 73
%updTipo_transaccion_tipo_comprobantes
íí8 ]
=
íí^ _
detalle
íí` g
.
ííg h0
!Tipo_transaccion_tipo_comprobanteííh â
.ííâ ä
ToListííä ê
(ííê ë
)ííë í
;ííí ì
List
ìì 
<
ìì /
!Tipo_transaccion_tipo_comprobante
ìì 6
>
ìì6 72
$dbTipo_transaccion_tipo_comprobantes
ìì8 \
=
ìì] ^
	dbDetalle
ìì_ h
.
ììh i0
!Tipo_transaccion_tipo_comprobanteììi ä
.ììä ã
ToListììã ë
(ììë í
)ììí ì
;ììì î
foreach
ïï 
(
ïï 
var
ïï 
dbtttc
ïï #
in
ïï$ &2
$dbTipo_transaccion_tipo_comprobantes
ïï' K
)
ïïK L
{
ññ 
if
óó 
(
óó 3
%updTipo_transaccion_tipo_comprobantes
óó =
.
óó= >
Any
óó> A
(
óóA B
d
óóB C
=>
óóD F
d
óóG H
.
óóH I
id
óóI K
==
óóL N
dbtttc
óóO U
.
óóU V
id
óóV X
)
óóX Y
)
óóY Z
{
òò 
var
ôô 
tttc
ôô  
=
ôô! "3
%updTipo_transaccion_tipo_comprobantes
ôô# H
.
ôôH I
Single
ôôI O
(
ôôO P
d
ôôP Q
=>
ôôR T
d
ôôU V
.
ôôV W
id
ôôW Y
==
ôôZ \
dbtttc
ôô] c
.
ôôc d
id
ôôd f
)
ôôf g
;
ôôg h
_db
öö 
.
öö 
Entry
öö !
(
öö! "
dbtttc
öö" (
)
öö( )
.
öö) *
CurrentValues
öö* 7
.
öö7 8
	SetValues
öö8 A
(
ööA B
tttc
ööB F
)
ööF G
;
ööG H
}
õõ 
else
úú 
{
ùù 
_db
ûû 
.
ûû /
!Tipo_transaccion_tipo_comprobante
ûû =
.
ûû= >
Remove
ûû> D
(
ûûD E
dbtttc
ûûE K
)
ûûK L
;
ûûL M
}
üü 
}
†† 
foreach
°° 
(
°° 
var
°° 
updtttc
°° $
in
°°% '3
%updTipo_transaccion_tipo_comprobantes
°°( M
)
°°M N
{
¢¢ 
if
££ 
(
££ 
!
££ 2
$dbTipo_transaccion_tipo_comprobantes
££ =
.
££= >
Any
££> A
(
££A B
d
££B C
=>
££D F
d
££G H
.
££H I
id
££I K
==
££L N
updtttc
££O V
.
££V W
id
££W Y
)
££Y Z
)
££Z [
{
§§ 
_db
•• 
.
•• /
!Tipo_transaccion_tipo_comprobante
•• =
.
••= >
Add
••> A
(
••A B
updtttc
••B I
)
••I J
;
••J K
}
¶¶ 
}
ßß 
var
©© 
result
©© 
=
©© 
Save
©© !
(
©©! "
)
©©" #
;
©©# $
result
™™ 
.
™™ 
data
™™ 
=
™™ 
detalle
™™ %
.
™™% &
id
™™& (
;
™™( )
return
´´ 
result
´´ 
;
´´ 
}
¨¨ 
catch
≠≠ 
(
≠≠ 
	Exception
≠≠ 
e
≠≠ 
)
≠≠ 
{
ÆÆ 
return
ØØ 
new
ØØ 
OperationResult
ØØ *
(
ØØ* +
e
ØØ+ ,
)
ØØ, -
;
ØØ- .
}
∞∞ 
}
±± 	
public
µµ 
OperationResult
µµ 
CrearRol
µµ '
(
µµ' (
Rol
µµ( +
rol
µµ, /
)
µµ/ 0
{
∂∂ 	
try
∑∑ 
{
∏∏ 
_db
ππ 
.
ππ 
Rol
ππ 
.
ππ 
Add
ππ 
(
ππ 
rol
ππ 
)
ππ  
;
ππ  !
var
∫∫ 
result
∫∫ 
=
∫∫ 
Save
∫∫ !
(
∫∫! "
)
∫∫" #
;
∫∫# $
result
ªª 
.
ªª 
data
ªª 
=
ªª 
rol
ªª !
.
ªª! "
id
ªª" $
;
ªª$ %
return
ΩΩ 
result
ΩΩ 
;
ΩΩ 
}
ææ 
catch
øø 
(
øø 
	Exception
øø 
e
øø 
)
øø 
{
¿¿ 
throw
¡¡ 
e
¡¡ 
;
¡¡ 
}
¬¬ 
}
√√ 	
public
≈≈ 
IEnumerable
≈≈ 
<
≈≈ 
Rol
≈≈ 
>
≈≈ 
ObtenerRoles
≈≈  ,
(
≈≈, -
)
≈≈- .
{
«« 	
try
…… 
{
   
return
ÃÃ 
_db
ÃÃ 
.
ÃÃ 
Rol
ÃÃ 
;
ÃÃ 
}
ŒŒ 
catch
œœ 
(
œœ 
	Exception
œœ 
e
œœ 
)
œœ 
{
–– 
throw
—— 
e
—— 
;
—— 
}
““ 
}
”” 	
}
◊◊ 
}ÿÿ Â
^D:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\Partial\Permisos_TransaccionDatos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
{		 
public

 

partial

 
class

 
TransaccionDatos

 )
{ 
} 
} ®
ID:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\CocheraDatos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
{ 
public 

partial 
class 
CocheraDatos %
:& '
RepositorioBase( 7
,7 8
ICocheraRepositorio9 L
{ 
public 
Vehiculo 
ObtenerVehiculo '
(' (
string( .
placaVehiculo/ <
)< =
{ 	
return 
_db 
. 
Actor_negocio $
.$ %
Where% *
(* +
an+ -
=>. 0
an1 3
.3 4
Actor4 9
.9 :&
numero_documento_identidad: T
==U W
placaVehiculoX e
&&f h
ani k
.k l
id_roll r
==s u
CocheraSettings	v Ö
.
Ö Ü
Default
Ü ç
.
ç é
IdRolVehiculo
é õ
&&
ú û
an
ü °
.
° ¢

es_vigente
¢ ¨
)
¨ ≠
.
≠ Æ
Select
Æ ¥
(
¥ µ
an
µ ∑
=>
∏ ∫
new
ª æ
Vehiculo
ø «
{ 
Id 
= 
an 
. 
id 
, 
IdActor 
= 
an 
. 
id_actor %
,% &
Placa 
= 
an 
. 
Actor  
.  !&
numero_documento_identidad! ;
,; <
TipoDeVehiculo 
=  
new! $
ItemGenerico% 1
{2 3
Id4 6
=7 8
an9 ;
.; <
Actor< A
.A B
id_clase_actorB P
,P Q
NombreR X
=Y Z
an[ ]
.] ^
Actor^ c
.c d
primer_nombred q
}r s
,s t
Marca 
= 
new 
ItemGenerico (
{) *
Id+ -
=. /
(0 1
int1 4
)4 5
an5 7
.7 8
Actor8 =
.= >%
id_detalle_multiproposito> W
,W X
NombreY _
=` a
anb d
.d e
Actore j
.j k
segundo_nombrek y
}z {
,{ |
Color 
= 
an 
. 
Actor  
.  !
tercer_nombre! .
,. /
ExoneradoDePagos  
=! "
an# %
.% &

indicador1& 0
} 
)   
.   
SingleOrDefault   !
(  ! "
)  " #
;  # $
}"" 	
public$$ 
bool$$ 
ExisteVehiculo$$ "
($$" #
string$$# )
placaVehiculo$$* 7
)$$7 8
{%% 	
return&& 
_db&& 
.&& 
Actor_negocio&& $
.&&$ %
Any&&% (
(&&( )
an&&) +
=>&&, .
an&&/ 1
.&&1 2
id_rol&&2 8
==&&9 ;
CocheraSettings&&< K
.&&K L
Default&&L S
.&&S T
IdRolVehiculo&&T a
&&&&b d
an&&e g
.&&g h
Actor&&h m
.&&m n#
id_documento_identidad	&&n Ñ
==
&&Ö á
CocheraSettings
&&à ó
.
&&ó ò
Default
&&ò ü
.
&&ü †+
IdTipoDocumentoIdentidadPlaca
&&† Ω
&&
&&æ ¿
an
&&¡ √
.
&&√ ƒ
Actor
&&ƒ …
.
&&…  (
numero_documento_identidad
&&  ‰
==
&&Â Á
placaVehiculo
&&Ë ı
)
&&ı ˆ
;
&&ˆ ˜
}'' 	
public)) 
MovimientoCochera))  0
$ObtenerTransaccion_MovimientoCochera))! E
())E F
string))F L
placaVehiculo))M Z
,))Z [
int))\ _#
idCentroAtencionCochera))` w
,))w x
int))y |)
idDetalleMaestroEstadoActual	))} ô
)
))ô ö
{** 	
try++ 
{,, 
var-- 
result-- 
=-- 
_db--  
.--  !
Actor_negocio--! .
.--. /
SingleOrDefault--/ >
(--> ?
an--? A
=>--B D
an--E G
.--G H
Actor--H M
.--M N"
id_documento_identidad--N d
==--e g
CocheraSettings--h w
.--w x
Default--x 
.	-- Ä+
IdTipoDocumentoIdentidadPlaca
--Ä ù
&&
--û †
an
--° £
.
--£ §
Actor
--§ ©
.
--© ™(
numero_documento_identidad
--™ ƒ
==
--≈ «
placaVehiculo
--» ’
)
--’ ÷
.
--÷ ◊
Transaccion3
--◊ „
.
--„ ‰
Where
--‰ È
(
--È Í
t
--Í Î
=>
--Ï Ó
t
--Ô 
.
-- Ò&
id_actor_negocio_interno
--Ò â
==
--ä å%
idCentroAtencionCochera
--ç §
&&
--• ß
t
--® ©
.
--© ™!
id_tipo_transaccion
--™ Ω
==
--æ ¿
CocheraSettings
--¡ –
.
--– —
Default
--— ÿ
.
--ÿ Ÿ2
$IdTipoTransaccionMovimientoDeCochera
--Ÿ ˝
&&
--˛ Ä
t
--Å Ç
.
--Ç É
id_estado_actual
--É ì
==
--î ñ
(
--ó ò
int
--ò õ
)
--õ ú*
idDetalleMaestroEstadoActual
--ú ∏
)
--∏ π
.
--π ∫
Select
--∫ ¿
(
--¿ ¡
t
--¡ ¬
=>
--√ ≈
new
--∆ …
MovimientoCochera
--  €
(
--€ ‹
)
--‹ ›
{.. 
Id// 
=// 
t// 
.// 
id// 
,// 
IdOrdenDeVenta00 "
=00# $
t00% &
.00& '%
id_transaccion_referencia00' @
??00A C
$num00D E
,00E F
	IdCochera11 
=11 
t11  !
.11! "$
id_actor_negocio_interno11" :
,11: ;
Estado22 
=22 
new22  
ItemGenerico22! -
{22. /
Id220 2
=223 4
(225 6
int226 9
)229 :
t22: ;
.22; <
id_estado_actual22< L
,22L M
Nombre22N T
=22U V
t22W X
.22X Y
Detalle_maestro22Y h
.22h i
nombre22i o
}22p q
,22q r
Comprobante33 
=33  !
new33" %'
ComprobanteDeNegocioBasico_33& A
{44 
Id55 
=55 
t55 
.55 
id_comprobante55 -
,55- .
Serie66 
=66 
t66  !
.66! "
Comprobante66" -
.66- .
numero_serie66. :
,66: ;
Numero77 
=77  
t77! "
.77" #
Comprobante77# .
.77. /
numero77/ 5
.775 6
ToString776 >
(77> ?
)77? @
}88 
,88 
Cliente99 
=99 
new99 !
ActorComercial_99" 1
{:: 
Id;; 
=;; 
t;; 
.;; $
id_actor_negocio_externo;; 7
,;;7 8$
NumeroDocumentoIdentidad<< 0
=<<1 2
t<<3 4
.<<4 5
Actor_negocio1<<5 C
.<<C D
Actor<<D I
.<<I J&
numero_documento_identidad<<J d
,<<d e
NombreORazonSocial== *
===+ ,
t==- .
.==. /
Actor_negocio1==/ =
.=== >
Actor==> C
.==C D
primer_nombre==D Q
.==Q R
Replace==R Y
(==Y Z
$str==Z ]
,==] ^
$str==_ b
)==b c
,==c d"
TipoDocumentoIdentidad>> .
=>>/ 0
new>>1 4
ItemGenerico>>5 A
(>>A B
t>>B C
.>>C D
Actor_negocio1>>D R
.>>R S
Actor>>S X
.>>X Y"
id_documento_identidad>>Y o
)>>o p
,>>p q
}?? 
,?? 
Ingreso@@ 
=@@ 
t@@ 
.@@  
fecha_inicio@@  ,
,@@, -
SalidaAA 
=AA 
tAA 
.AA 
	fecha_finAA (
,AA( )
SistemaDePagoBB !
=BB" #
newBB$ '
ItemGenericoBB( 4
{BB5 6
IdBB7 9
=BB: ;
tBB< =
.BB= >
enum1BB> C
,BBC D
NombreBBE K
=BBL M
(BBN O
(BBO P
SistemaPagoCocheraBBP b
)BBb c
tBBc d
.BBd e
enum1BBe j
)BBj k
.BBk l
ToStringBBl t
(BBt u
)BBu v
}BBw x
,BBx y
VehiculoCC 
=CC 
newCC "
VehiculoCC# +
{DD 
PlacaEE 
=EE 
tEE  !
.EE! "
Actor_negocio3EE" 0
.EE0 1
ActorEE1 6
.EE6 7&
numero_documento_identidadEE7 Q
,EEQ R
TipoDeVehiculoFF &
=FF' (
newFF) ,
ItemGenericoFF- 9
{FF: ;
IdFF< >
=FF? @
tFFA B
.FFB C
Actor_negocio3FFC Q
.FFQ R
ActorFFR W
.FFW X
id_clase_actorFFX f
,FFf g
NombreFFh n
=FFo p
tFFq r
.FFr s
Actor_negocio3	FFs Å
.
FFÅ Ç
Actor
FFÇ á
.
FFá à
primer_nombre
FFà ï
}
FFñ ó
,
FFó ò
MarcaGG 
=GG 
newGG  #
ItemGenericoGG$ 0
{GG1 2
IdGG3 5
=GG6 7
(GG8 9
intGG9 <
)GG< =
tGG= >
.GG> ?
Actor_negocio3GG? M
.GGM N
ActorGGN S
.GGS T%
id_detalle_multipropositoGGT m
,GGm n
NombreGGo u
=GGv w
tGGx y
.GGy z
Actor_negocio3	GGz à
.
GGà â
Actor
GGâ é
.
GGé è
segundo_nombre
GGè ù
}
GGû ü
,
GGü †
ColorHH 
=HH 
tHH  !
.HH! "
Actor_negocio3HH" 0
.HH0 1
ActorHH1 6
.HH6 7
tercer_nombreHH7 D
,HHD E
ExoneradoDePagosII (
=II) *
tII+ ,
.II, -
Actor_negocio3II- ;
.II; <

indicador1II< F
}JJ 
}KK 
)KK 
.KK 
FirstOrDefaultKK !
(KK! "
)KK" #
;KK# $
returnLL 
resultLL 
;LL 
}MM 
catchNN 
(NN 
	ExceptionNN 
eNN 
)NN 
{OO 
throwPP 
newPP 
DatosExceptionPP (
(PP( )
$strPP) [
,PP[ \
ePP] ^
)PP^ _
;PP_ `
}QQ 
}RR 	
publicSS 
IEnumerableSS 
<SS #
MovimientoCocheraBasicoSS 2
>SS2 33
'ObtenerTransacciones_MovimientosCocheraSS4 [
(SS[ \
intSS\ _

id_cocheraSS` j
,SSj k
DateTimeSSl t
desdeSSu z
,SSz {
DateTime	SS| Ñ
hasta
SSÖ ä
)
SSä ã
{TT 	
varUU 
resultUU 
=UU 
_dbUU 
.UU 
TransaccionUU (
.UU( )
WhereUU) .
(UU. /
tUU/ 0
=>UU1 3
tUU4 5
.UU5 6$
id_actor_negocio_internoUU6 N
==UUO Q

id_cocheraUUR \
&&UU] _
tUU` a
.UUa b
id_tipo_transaccionUUb u
==UUv x
CocheraSettings	UUy à
.
UUà â
Default
UUâ ê
.
UUê ë2
$IdTipoTransaccionMovimientoDeCochera
UUë µ
&&
UU∂ ∏
t
UUπ ∫
.
UU∫ ª
fecha_inicio
UUª «
>=
UU»  
desde
UUÀ –
&&
UU— ”
t
UU‘ ’
.
UU’ ÷
	fecha_fin
UU÷ ﬂ
<=
UU‡ ‚
hasta
UU„ Ë
)
UUË È
.
UUÈ Í
Select
UUÍ 
(
UU Ò
t
UUÒ Ú
=>
UUÛ ı
new
UUˆ ˘%
MovimientoCocheraBasico
UU˙ ë
(
UUë í
)
UUí ì
{VV 
IdWW 
=WW 
tWW 
.WW 
idWW 
,WW 
IdOrdenDeVentaXX 
=XX  
tXX! "
.XX" #%
id_transaccion_referenciaXX# <
??XX= ?
$numXX@ A
,XXA B
	IdCocheraYY 
=YY 
tYY 
.YY $
id_actor_negocio_internoYY 6
,YY6 7
EstadoZZ 
=ZZ 
newZZ 
ItemGenericoZZ )
{ZZ* +
IdZZ, .
=ZZ/ 0
(ZZ1 2
intZZ2 5
)ZZ5 6
tZZ6 7
.ZZ7 8
id_estado_actualZZ8 H
,ZZH I
NombreZZJ P
=ZZQ R
tZZS T
.ZZT U
Detalle_maestroZZU d
.ZZd e
nombreZZe k
}ZZl m
,ZZm n
Comprobante[[ 
=[[ 
new[[ !'
ComprobanteDeNegocioBasico_[[" =
{\\ 
Id]] 
=]] 
t]] 
.]] 
id_comprobante]] )
,]]) *
Serie^^ 
=^^ 
t^^ 
.^^ 
Comprobante^^ )
.^^) *
numero_serie^^* 6
,^^6 7
Numero__ 
=__ 
t__ 
.__ 
Comprobante__ *
.__* +
numero__+ 1
.__1 2
ToString__2 :
(__: ;
)__; <
}`` 
,`` 
Ingresoaa 
=aa 
taa 
.aa 
fecha_inicioaa (
,aa( )
Salidabb 
=bb 
tbb 
.bb 
	fecha_finbb $
,bb$ %
SistemaDePagocc 
=cc 
newcc  #
ItemGenericocc$ 0
{cc1 2
Idcc3 5
=cc6 7
tcc8 9
.cc9 :
enum1cc: ?
,cc? @
NombreccA G
=ccH I
(ccJ K
(ccK L
SistemaPagoCocheraccL ^
)cc^ _
tcc_ `
.cc` a
enum1cca f
)ccf g
.ccg h
ToStringcch p
(ccp q
)ccq r
}ccs t
,cct u
Vehiculodd 
=dd 
newdd 
Vehiculodd '
{ee 
Placaff 
=ff 
tff 
.ff 
Actor_negocio3ff ,
.ff, -
Actorff- 2
.ff2 3&
numero_documento_identidadff3 M
,ffM N
TipoDeVehiculogg "
=gg# $
newgg% (
ItemGenericogg) 5
{gg6 7
Idgg8 :
=gg; <
tgg= >
.gg> ?
Actor_negocio3gg? M
.ggM N
ActorggN S
.ggS T
id_clase_actorggT b
,ggb c
Nombreggd j
=ggk l
tggm n
.ggn o
Actor_negocio3ggo }
.gg} ~
Actor	gg~ É
.
ggÉ Ñ
primer_nombre
ggÑ ë
}
ggí ì
,
ggì î
Marcahh 
=hh 
newhh 
ItemGenericohh  ,
{hh- .
Idhh/ 1
=hh2 3
(hh4 5
inthh5 8
)hh8 9
thh9 :
.hh: ;
Actor_negocio3hh; I
.hhI J
ActorhhJ O
.hhO P%
id_detalle_multipropositohhP i
,hhi j
Nombrehhk q
=hhr s
thht u
.hhu v
Actor_negocio3	hhv Ñ
.
hhÑ Ö
Actor
hhÖ ä
.
hhä ã
segundo_nombre
hhã ô
}
hhö õ
,
hhõ ú
Colorii 
=ii 
tii 
.ii 
Actor_negocio3ii ,
.ii, -
Actorii- 2
.ii2 3
tercer_nombreii3 @
,ii@ A
ExoneradoDePagosjj $
=jj% &
tjj' (
.jj( )
Actor_negocio3jj) 7
.jj7 8

indicador1jj8 B
}kk 
}ll 
)ll 
;ll 
;ll 
returnmm 
resultmm 
;mm 
}nn 	
publicvv 
IEnumerablevv 
<vv 
EntradaSalidavv (
>vv( )
ObtenerMovimientosvv* <
(vv< =
intvv= @

id_cocheravvA K
,vvK L
DateTimevvM U
desdevvV [
,vv[ \
DateTimevv] e
hastavvf k
)vvk l
{ww 	
IEnumerablexx 
<xx 
EntradaSalidaxx %
>xx% &
resultxx' -
;xx- .
resultzz 
=zz 
fromzz 
etzz 
inzz 
_dbzz  #
.zz# $
Estado_transaccionzz$ 6
join{{ 
t{{ 
in{{ 
_db{{ "
.{{" #
Transaccion{{# .
on{{/ 1
et{{2 4
.{{4 5
id_transaccion{{5 C
equals{{D J
t{{K L
.{{L M
id{{M O
where|| 
et|| 
.|| 
fecha|| #
>=||$ &
desde||' ,
&&||- /
et||0 2
.||2 3
fecha||3 8
<=||9 ;
hasta||< A
&&||B D
t||E F
.||F G$
id_actor_negocio_interno||G _
==||` b

id_cochera||c m
&&||n p
t||q r
.||r s 
id_tipo_transaccion	||s Ü
==
||á â
CocheraSettings
||ä ô
.
||ô ö
Default
||ö °
.
||° ¢2
$IdTipoTransaccionMovimientoDeCochera
||¢ ∆
select}} 
new}} 
EntradaSalida}}  -
(}}- .
)}}. /
{~~ 
	IdGeneral "
=# $
t% &
.& '
id' )
,) *
IdEspecifico
ÄÄ %
=
ÄÄ& '
et
ÄÄ( *
.
ÄÄ* +
id
ÄÄ+ -
,
ÄÄ- .
	FechaHora
ÅÅ "
=
ÅÅ# $
et
ÅÅ% '
.
ÅÅ' (
fecha
ÅÅ( -
,
ÅÅ- .
IdTipoMovimiento
ÇÇ )
=
ÇÇ* +
et
ÇÇ, .
.
ÇÇ. /
	id_estado
ÇÇ/ 8
,
ÇÇ8 9
Ticket
ÉÉ 
=
ÉÉ  !
t
ÉÉ" #
.
ÉÉ# $
Comprobante
ÉÉ$ /
.
ÉÉ/ 0
numero_serie
ÉÉ0 <
+
ÉÉ= >
$str
ÉÉ? B
+
ÉÉC D
t
ÉÉE F
.
ÉÉF G
Comprobante
ÉÉG R
.
ÉÉR S
numero
ÉÉS Y
.
ÉÉY Z
ToString
ÉÉZ b
(
ÉÉb c
)
ÉÉc d
,
ÉÉd e
PlacaVehiculo
ÑÑ &
=
ÑÑ' (
t
ÑÑ) *
.
ÑÑ* +
Actor_negocio3
ÑÑ+ 9
.
ÑÑ9 :
Actor
ÑÑ: ?
.
ÑÑ? @(
numero_documento_identidad
ÑÑ@ Z
,
ÑÑZ [!
DescripcionVehiculo
ÖÖ ,
=
ÖÖ- .
t
ÖÖ/ 0
.
ÖÖ0 1
Actor_negocio3
ÖÖ1 ?
.
ÖÖ? @
Actor
ÖÖ@ E
.
ÖÖE F
primer_nombre
ÖÖF S
+
ÖÖT U
$str
ÖÖV Y
+
ÖÖZ [
t
ÖÖ\ ]
.
ÖÖ] ^
Actor_negocio3
ÖÖ^ l
.
ÖÖl m
Actor
ÖÖm r
.
ÖÖr s
segundo_nombreÖÖs Å
+ÖÖÇ É
$strÖÖÑ á
+ÖÖà â
tÖÖä ã
.ÖÖã å
Actor_negocio3ÖÖå ö
.ÖÖö õ
ActorÖÖõ †
.ÖÖ† °
tercer_nombreÖÖ° Æ
}
ÜÜ 
;
ÜÜ 
return
àà 
result
àà 
;
àà 
}
ââ 	
public
íí 
IEnumerable
íí 
<
íí "
EntradaSalidaUsuario
íí /
>
íí/ 0 
ObtenerMovimientos
íí1 C
(
ííC D
int
ííD G

id_cochera
ííH R
,
ííR S
int
ííT W
idEstado
ííX `
)
íí` a
{
ìì 	
IEnumerable
îî 
<
îî "
EntradaSalidaUsuario
îî ,
>
îî, -
result
îî. 4
;
îî4 5
result
ññ 
=
ññ 
from
ññ 
t
ññ 
in
ññ 
_db
ññ "
.
ññ" #
Transaccion
ññ# .
where
óó 
t
óó 
.
óó &
id_actor_negocio_interno
óó 5
==
óó6 8

id_cochera
óó9 C
&&
óóD F
t
óóG H
.
óóH I
id_estado_actual
óóI Y
==
óóZ \
idEstado
óó] e
select
òò 
new
òò "
EntradaSalidaUsuario
òò  4
(
òò4 5
)
òò5 6
{
ôô 
	FechaHora
öö "
=
öö# $
t
öö% &
.
öö& '
fecha_inicio
öö' 3
,
öö3 4
IdTipoMovimiento
õõ )
=
õõ* +
idEstado
õõ, 4
,
õõ4 5
Ticket
úú 
=
úú  !
t
úú" #
.
úú# $
Comprobante
úú$ /
.
úú/ 0
numero_serie
úú0 <
+
úú= >
t
úú? @
.
úú@ A
Comprobante
úúA L
.
úúL M
numero
úúM S
.
úúS T
ToString
úúT \
(
úú\ ]
)
úú] ^
,
úú^ _
PlacaVehiculo
ùù &
=
ùù' (
t
ùù) *
.
ùù* +
Actor_negocio3
ùù+ 9
.
ùù9 :
Actor
ùù: ?
.
ùù? @(
numero_documento_identidad
ùù@ Z
,
ùùZ [!
DescripcionVehiculo
ûû ,
=
ûû- .
t
ûû/ 0
.
ûû0 1
Actor_negocio3
ûû1 ?
.
ûû? @
Actor
ûû@ E
.
ûûE F
primer_nombre
ûûF S
+
ûûT U
$str
ûûV Y
+
ûûZ [
t
ûû\ ]
.
ûû] ^
Actor_negocio3
ûû^ l
.
ûûl m
Actor
ûûm r
.
ûûr s
segundo_nombreûûs Å
+ûûÇ É
$strûûÑ á
+ûûà â
tûûä ã
.ûûã å
Actor_negocio3ûûå ö
.ûûö õ
Actorûûõ †
.ûû† °
tercer_nombreûû° Æ
,ûûÆ Ø
DocumentoUsuario
üü )
=
üü* +
t
üü, -
.
üü- .
Actor_negocio1
üü. <
.
üü< =
Actor
üü= B
.
üüB C(
numero_documento_identidad
üüC ]
,
üü] ^
NombreUsuario
†† &
=
††' (
t
††) *
.
††* +
Actor_negocio1
††+ 9
.
††9 :
Actor
††: ?
.
††? @
segundo_nombre
††@ N
,
††N O
}
°° 
;
°° 
return
££ 
result
££ 
;
££ 
}
§§ 	
public
•• "
ConfiguracionCochera
•• #"
ObtenerConfiguracion
••$ 8
(
••8 9
int
••9 <
	idCochera
••= F
)
••F G
{
¶¶ 	"
ConfiguracionCochera
ßß  
configuracion
ßß! .
=
ßß/ 0
null
ßß1 5
;
ßß5 6
var
®® #
actor_negocio_Cochera
®® %
=
®®& '
_db
®®( +
.
®®+ ,
Actor_negocio
®®, 9
.
®®9 :
SingleOrDefault
®®: I
(
®®I J
an
®®J L
=>
®®M O
an
®®P R
.
®®R S
id
®®S U
==
®®V X
	idCochera
®®Y b
)
®®b c
;
®®c d
configuracion
©© 
=
©© 
JsonConvert
©© '
.
©©' (
DeserializeObject
©©( 9
<
©©9 :"
ConfiguracionCochera
©©: N
>
©©N O
(
©©O P#
actor_negocio_Cochera
©©P e
.
©©e f
extension_json
©©f t
)
©©t u
;
©©u v
configuracion
™™ 
.
™™ 
IdTipoDeTurno
™™ '
=
™™( )#
actor_negocio_Cochera
™™* ?
.
™™? @/
!id_detalle_maestro_multiproposito
™™@ a
??
™™b d
$num
™™e f
;
™™f g
return
´´ 
configuracion
´´  
;
´´  !
}
¨¨ 	
public
≠≠ 
List
≠≠ 
<
≠≠ #
ExoneracionDeVehiculo
≠≠ )
>
≠≠) **
ObtenerExoneracionesVigentes
≠≠+ G
(
≠≠G H
int
≠≠H K
	idCochera
≠≠L U
)
≠≠U V
{
ÆÆ 	
return
ØØ 
_db
∞∞ 
.
∞∞ #
Vinculo_Actor_Negocio
∞∞ )
.
∞∞) *
Where
∞∞* /
(
∞∞/ 0
van
∞∞0 3
=>
∞∞4 6
van
∞∞7 :
.
∞∞: ;(
id_actor_negocio_principal
∞∞; U
==
∞∞V X
	idCochera
∞∞Y b
&&
∞∞c e
van
∞∞f i
.
∞∞i j

es_vigente
∞∞j t
&&
∞∞u w
van
∞∞x {
.
∞∞{ |
tipo_vinculo∞∞| à
==∞∞â ã
(∞∞å ç
int∞∞ç ê
)∞∞ê ë
TipoVinculo∞∞ë ú
.∞∞ú ù*
VehiculoExoneradoEnCochera∞∞ù ∑
)∞∞∑ ∏
.
±± 
Select
±± 
(
±± 
van
±± 
=>
±± 
new
±± "#
ExoneracionDeVehiculo
±±# 8
{
≤≤ 
Vehiculo
≥≥ 
=
≥≥ 
new
≥≥ "
Vehiculo
≥≥# +
{
¥¥ 
Placa
µµ 
=
µµ 
van
µµ  #
.
µµ# $
Actor_negocio1
µµ$ 2
.
µµ2 3
Actor
µµ3 8
.
µµ8 9(
numero_documento_identidad
µµ9 S
,
µµS T
TipoDeVehiculo
∂∂ &
=
∂∂' (
new
∂∂) ,
ItemGenerico
∂∂- 9
{
∂∂: ;
Id
∂∂< >
=
∂∂? @
van
∂∂A D
.
∂∂D E
Actor_negocio1
∂∂E S
.
∂∂S T
Actor
∂∂T Y
.
∂∂Y Z
id_clase_actor
∂∂Z h
,
∂∂h i
Nombre
∂∂j p
=
∂∂q r
van
∂∂s v
.
∂∂v w
Actor_negocio1∂∂w Ö
.∂∂Ö Ü
Actor∂∂Ü ã
.∂∂ã å
primer_nombre∂∂å ô
}∂∂ö õ
,∂∂õ ú
Marca
∑∑ 
=
∑∑ 
new
∑∑  #
ItemGenerico
∑∑$ 0
{
∑∑1 2
Id
∑∑3 5
=
∑∑6 7
(
∑∑8 9
int
∑∑9 <
)
∑∑< =
van
∑∑= @
.
∑∑@ A
Actor_negocio1
∑∑A O
.
∑∑O P
Actor
∑∑P U
.
∑∑U V'
id_detalle_multiproposito
∑∑V o
,
∑∑o p
Nombre
∑∑q w
=
∑∑x y
van
∑∑z }
.
∑∑} ~
Actor_negocio1∑∑~ å
.∑∑å ç
Actor∑∑ç í
.∑∑í ì
segundo_nombre∑∑ì °
}∑∑¢ £
,∑∑£ §
Color
∏∏ 
=
∏∏ 
van
∏∏  #
.
∏∏# $
Actor_negocio1
∏∏$ 2
.
∏∏2 3
Actor
∏∏3 8
.
∏∏8 9
tercer_nombre
∏∏9 F
,
∏∏F G
ExoneradoDePagos
ππ (
=
ππ) *
van
ππ+ .
.
ππ. /
Actor_negocio1
ππ/ =
.
ππ= >

indicador1
ππ> H
}
∫∫ 
,
∫∫ 
Desde
ªª 
=
ªª 
van
ªª 
.
ªª  
desde
ªª  %
,
ªª% &
Hasta
ºº 
=
ºº 
van
ºº 
.
ºº  
hasta
ºº  %
}
ΩΩ 
)
ΩΩ 
.
ΩΩ 
ToList
ΩΩ 
(
ΩΩ 
)
ΩΩ 
;
ΩΩ 
}
ææ 	
public
¿¿ 
List
¿¿ 
<
¿¿ #
ExoneracionDeVehiculo
¿¿ )
>
¿¿) *"
ObtenerExoneraciones
¿¿+ ?
(
¿¿? @
int
¿¿@ C
	idCochera
¿¿D M
)
¿¿M N
{
¡¡ 	
return
¬¬ 
_db
√√ 
.
√√ #
Vinculo_Actor_Negocio
√√ (
.
√√( )
Where
√√) .
(
√√. /
van
√√/ 2
=>
√√3 5
van
√√6 9
.
√√9 :(
id_actor_negocio_principal
√√: T
==
√√U W
	idCochera
√√X a
&&
√√b d
van
√√e h
.
√√h i
tipo_vinculo
√√i u
==
√√v x
(
√√y z
int
√√z }
)
√√} ~
TipoVinculo√√~ â
.√√â ä*
VehiculoExoneradoEnCochera√√ä §
)√√§ •
.
ƒƒ 
Select
ƒƒ 
(
ƒƒ 
van
ƒƒ 
=>
ƒƒ 
new
ƒƒ "#
ExoneracionDeVehiculo
ƒƒ# 8
{
≈≈ 
Id
∆∆ 
=
∆∆ 
van
∆∆ 
.
∆∆ 
id
∆∆ 
,
∆∆  
	IdCochera
«« 
=
«« 
van
««  #
.
««# $(
id_actor_negocio_principal
««$ >
,
««> ?
Vehiculo
»» 
=
»» 
new
»» "
Vehiculo
»»# +
{
…… 
Placa
   
=
   
van
    #
.
  # $
Actor_negocio1
  $ 2
.
  2 3
Actor
  3 8
.
  8 9(
numero_documento_identidad
  9 S
,
  S T
TipoDeVehiculo
ÀÀ &
=
ÀÀ' (
new
ÀÀ) ,
ItemGenerico
ÀÀ- 9
{
ÀÀ: ;
Id
ÀÀ< >
=
ÀÀ? @
van
ÀÀA D
.
ÀÀD E
Actor_negocio1
ÀÀE S
.
ÀÀS T
Actor
ÀÀT Y
.
ÀÀY Z
id_clase_actor
ÀÀZ h
,
ÀÀh i
Nombre
ÀÀj p
=
ÀÀq r
van
ÀÀs v
.
ÀÀv w
Actor_negocio1ÀÀw Ö
.ÀÀÖ Ü
ActorÀÀÜ ã
.ÀÀã å
primer_nombreÀÀå ô
}ÀÀö õ
,ÀÀõ ú
Marca
ÃÃ 
=
ÃÃ 
new
ÃÃ  #
ItemGenerico
ÃÃ$ 0
{
ÃÃ1 2
Id
ÃÃ3 5
=
ÃÃ6 7
(
ÃÃ8 9
int
ÃÃ9 <
)
ÃÃ< =
van
ÃÃ= @
.
ÃÃ@ A
Actor_negocio1
ÃÃA O
.
ÃÃO P
Actor
ÃÃP U
.
ÃÃU V'
id_detalle_multiproposito
ÃÃV o
,
ÃÃo p
Nombre
ÃÃq w
=
ÃÃx y
van
ÃÃz }
.
ÃÃ} ~
Actor_negocio1ÃÃ~ å
.ÃÃå ç
ActorÃÃç í
.ÃÃí ì
segundo_nombreÃÃì °
}ÃÃ¢ £
,ÃÃ£ §
Color
ÕÕ 
=
ÕÕ 
van
ÕÕ  #
.
ÕÕ# $
Actor_negocio1
ÕÕ$ 2
.
ÕÕ2 3
Actor
ÕÕ3 8
.
ÕÕ8 9
tercer_nombre
ÕÕ9 F
,
ÕÕF G
ExoneradoDePagos
ŒŒ (
=
ŒŒ) *
van
ŒŒ+ .
.
ŒŒ. /
Actor_negocio1
ŒŒ/ =
.
ŒŒ= >

indicador1
ŒŒ> H
}
œœ 
,
œœ 
Desde
–– 
=
–– 
van
–– 
.
––  
desde
––  %
,
––% &
Hasta
—— 
=
—— 
van
—— 
.
——  
hasta
——  %
,
——% &
Vigente
““ 
=
““ 
van
““ !
.
““! "

es_vigente
““" ,
}
”” 
)
”” 
.
”” 
ToList
”” 
(
”” 
)
”” 
;
”” 
}
‘‘ 	
}
÷÷ 
}◊◊ Åë
HD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\PrecioDatos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
{ 
public 

class 
PrecioDatos 
: 
RepositorioBase .
,. /
IPrecioRepositorio0 B
{ 
public 
OperationResult 
CrearPrecio *
(* +
Precio+ 1
precio2 8
)8 9
{ 	
try 
{ 
_db 
. 
Precio 
. 
Add 
( 
precio %
)% &
;& '
return 
Save 
( 
) 
; 
} 
catch 
( 
	Exception 
e 
) 
{ 
throw 
e 
; 
} 
} 	
public 
OperationResult 
ResolverPrecios .
(. /
List/ 3
<3 4
Precio4 :
>: ;
nuevosPrecios< I
,I J
ListK O
<O P
PrecioP V
>V W
preciosCaducosX f
)f g
{ 	
try   
{!! 
Precio"" 
dbPrecio"" 
=""  !
null""" &
;""& '
foreach## 
(## 
var## 
nuevoPrecio## (
in##) +
nuevosPrecios##, 9
)##9 :
{$$ 
dbPrecio&& 
=&& 
_db&& "
.&&" #
Precio&&# )
.&&) *
SingleOrDefault&&* 9
(&&9 :
p&&: ;
=>&&< >
p&&? @
.&&@ A
id_actor_negocio&&A Q
==&&R T
nuevoPrecio&&U `
.&&` a
id_actor_negocio&&a q
&&&&r t
p&&u v
.&&v w 
id_concepto_negocio	&&w ä
==
&&ã ç
nuevoPrecio
&&é ô
.
&&ô ö!
id_concepto_negocio
&&ö ≠
&&
&&Æ ∞
p
&&± ≤
.
&&≤ ≥
id_tarifa_d
&&≥ æ
==
&&ø ¡
nuevoPrecio
&&¬ Õ
.
&&Õ Œ
id_tarifa_d
&&Œ Ÿ
&&
&&⁄ ‹
p
&&› ﬁ
.
&&ﬁ ﬂ
id_tipo
&&ﬂ Ê
==
&&Á È
nuevoPrecio
&&Í ı
.
&&ı ˆ
id_tipo
&&ˆ ˝
&&
&&˛ Ä
p
&&Å Ç
.
&&Ç É

es_vigente
&&É ç
==
&&é ê
true
&&ë ï
)
&&ï ñ
;
&&ñ ó#
ResolverConflictoPrecio(( +
(((+ ,
nuevoPrecio((, 7
,((7 8
dbPrecio((9 A
)((A B
;((B C
_db)) 
.)) 
Precio)) 
.)) 
Add)) "
())" #
nuevoPrecio))# .
))). /
;))/ 0
}** 
foreach++ 
(++ 
var++ 
precioCaduco++ )
in++* ,
preciosCaducos++- ;
)++; <
{,, 
dbPrecio-- 
=-- 
_db-- "
.--" #
Precio--# )
.--) *
SingleOrDefault--* 9
(--9 :
p--: ;
=>--< >
p--? @
.--@ A
id--A C
==--D F
precioCaduco--G S
.--S T
id--T V
)--V W
;--W X
_db// 
.// 
Entry// 
(// 
dbPrecio// &
)//& '
.//' (
CurrentValues//( 5
.//5 6
	SetValues//6 ?
(//? @
precioCaduco//@ L
)//L M
;//M N
}00 
return11 
Save11 
(11 
)11 
;11 
}22 
catch33 
(33 
	Exception33 
e33 
)33 
{44 
throw55 
e55 
;55 
}66 
}77 	
public88 
OperationResult88 
establecerPrecios88 0
(880 1
List881 5
<885 6
Precio886 <
>88< =
precios88> E
)88E F
{99 	
try:: 
{;; 
Precio<< 
dbPrecio<< 
=<<  !
null<<" &
;<<& '
foreach>> 
(>> 
var>> 
nuevoPrecio>> (
in>>) +
precios>>, 3
)>>3 4
{?? 
dbPrecioAA 
=AA 
_dbAA "
.AA" #
PrecioAA# )
.AA) *
SingleOrDefaultAA* 9
(AA9 :
pAA: ;
=>AA< >
pAA? @
.AA@ A
id_actor_negocioAAA Q
==AAR T
nuevoPrecioAAU `
.AA` a
id_actor_negocioAAa q
&&AAr t
pAAu v
.AAv w 
id_concepto_negocio	AAw ä
==
AAã ç
nuevoPrecio
AAé ô
.
AAô ö!
id_concepto_negocio
AAö ≠
&&
AAÆ ∞
p
AA± ≤
.
AA≤ ≥
id_tarifa_d
AA≥ æ
==
AAø ¡
nuevoPrecio
AA¬ Õ
.
AAÕ Œ
id_tarifa_d
AAŒ Ÿ
&&
AA⁄ ‹
p
AA› ﬁ
.
AAﬁ ﬂ
id_tipo
AAﬂ Ê
==
AAÁ È
nuevoPrecio
AAÍ ı
.
AAı ˆ
id_tipo
AAˆ ˝
&&
AA˛ Ä
p
AAÅ Ç
.
AAÇ É

es_vigente
AAÉ ç
==
AAé ê
true
AAë ï
)
AAï ñ
;
AAñ ó#
ResolverConflictoPrecioCC +
(CC+ ,
nuevoPrecioCC, 7
,CC7 8
dbPrecioCC9 A
)CCA B
;CCB C
_dbDD 
.DD 
PrecioDD 
.DD 
AddDD "
(DD" #
nuevoPrecioDD# .
)DD. /
;DD/ 0
}EE 
returnFF 
SaveFF 
(FF 
)FF 
;FF 
}GG 
catchHH 
(HH 
	ExceptionHH 
eHH 
)HH 
{II 
throwJJ 
eJJ 
;JJ 
}KK 
}LL 	
privateMM 
voidMM #
ResolverConflictoPrecioMM ,
(MM, -
PrecioMM- 3
nuevoPrecioMM4 ?
,MM? @
PrecioMMA G
precioExistenteMMH W
)MMW X
{NN 	
ifOO 
(OO 
precioExistenteOO 
!=OO  "
nullOO# '
)OO' (
{PP 
precioExistenteQQ 
.QQ  

es_vigenteQQ  *
=QQ+ ,
falseQQ- 2
;QQ2 3
precioExistenteRR 
.RR  
	fecha_finRR  )
=RR* +
nuevoPrecioRR, 7
.RR7 8
fecha_inicioRR8 D
;RRD E
precioExistenteSS 
.SS  
fecha_modificacionSS  2
=SS3 4
nuevoPrecioSS5 @
.SS@ A
fecha_modificacionSSA S
;SSS T
}TT 
}UU 	
publicWW 
OperationResultWW 
EstablecerPrecioWW /
(WW/ 0
PrecioWW0 6
precioWW7 =
)WW= >
{XX 	
tryYY 
{ZZ 
OperationResult[[ 
result[[  &
;[[& '
if\\ 
(\\ 
precio\\ 
.\\ 
id\\ 
==\\ 
$num\\  !
)\\! "
{]] 
result^^ 
=^^ 
CrearPrecio^^ (
(^^( )
precio^^) /
)^^/ 0
;^^0 1
}__ 
else`` 
{aa 
Preciocc 
dbPreciocc #
=cc$ %
_dbcc& )
.cc) *
Preciocc* 0
.cc0 1
SingleOrDefaultcc1 @
(cc@ A
pccA B
=>ccC E
pccF G
.ccG H
id_concepto_negocioccH [
==cc\ ^
preciocc_ e
.cce f
id_concepto_negocioccf y
&&ccz |
pcc} ~
.cc~ 
id_actor_negocio	cc è
==
ccê í
precio
ccì ô
.
ccô ö
id_actor_negocio
ccö ™
&&
cc´ ≠
p
ccÆ Ø
.
ccØ ∞
id_tarifa_d
cc∞ ª
==
ccº æ
precio
ccø ≈
.
cc≈ ∆
id_tarifa_d
cc∆ —
&&
cc“ ‘
p
cc’ ÷
.
cc÷ ◊
id_tipo
cc◊ ﬁ
==
ccﬂ ·
precio
cc‚ Ë
.
ccË È
id_tipo
ccÈ 
&&
ccÒ Û
p
ccÙ ı
.
ccı ˆ

es_vigente
ccˆ Ä
)
ccÄ Å
;
ccÅ Ç
ifee 
(ee 
precioee 
.ee 
valoree $
==ee% '
dbPrecioee( 0
.ee0 1
valoree1 6
)ee6 7
{ff 
resultgg 
=gg  
ActualizarPreciogg! 1
(gg1 2
preciogg2 8
)gg8 9
;gg9 :
}hh 
elseii 
{jj #
ResolverConflictoPrecioll /
(ll/ 0
precioll0 6
,ll6 7
dbPrecioll8 @
)ll@ A
;llA B
resultmm 
=mm  
CrearPreciomm! ,
(mm, -
preciomm- 3
)mm3 4
;mm4 5
}nn 
}oo 
returnpp 
resultpp 
;pp 
}qq 
catchrr 
(rr 
	Exceptionrr 
err 
)rr 
{ss 
throwtt 
ett 
;tt 
}uu 
}vv 	
publicww 
OperationResultww 
ActualizarPrecioww /
(ww/ 0
Precioww0 6
precioww7 =
)ww= >
{xx 	
tryyy 
{zz 
Precio|| 
dbPrecio|| 
=||  !
_db||" %
.||% &
Precio||& ,
.||, -
SingleOrDefault||- <
(||< =
p||= >
=>||? A
p||B C
.||C D
id||D F
==||G I
precio||J P
.||P Q
id||Q S
)||S T
;||T U
_db~~ 
.~~ 
Entry~~ 
(~~ 
dbPrecio~~ "
)~~" #
.~~# $
CurrentValues~~$ 1
.~~1 2
	SetValues~~2 ;
(~~; <
precio~~< B
)~~B C
;~~C D
return 
Save 
( 
) 
; 
}
ÄÄ 
catch
ÅÅ 
(
ÅÅ 
	Exception
ÅÅ 
e
ÅÅ 
)
ÅÅ 
{
ÇÇ 
throw
ÉÉ 
e
ÉÉ 
;
ÉÉ 
}
ÑÑ 
}
ÖÖ 	
public
ÜÜ 
IEnumerable
ÜÜ 
<
ÜÜ 
Precio
ÜÜ !
>
ÜÜ! "$
obtenerPreciosVigentes
ÜÜ# 9
(
ÜÜ9 :
)
ÜÜ: ;
{
áá 	
try
àà 
{
ââ 
return
ää 
_db
ää 
.
ää 
Precio
ää !
.
ää! "
Include
ää" )
(
ää) *
p
ää* +
=>
ää, .
p
ää/ 0
.
ää0 1
Concepto_negocio
ää1 A
)
ääA B
.
ääB C
Include
ääC J
(
ääJ K
p
ääK L
=>
ääM O
p
ääP Q
.
ääQ R
Detalle_maestro3
ääR b
)
ääb c
.
ääc d
Where
ääd i
(
ääi j
p
ääj k
=>
ääl n
p
ääo p
.
ääp q

es_vigente
ääq {
==
ää| ~
trueää É
)ääÉ Ñ
.ääÑ Ö!
OrderByDescendingääÖ ñ
(ääñ ó
pääó ò
=>ääô õ
pääú ù
.ääù û
idääû †
)ää† °
;ää° ¢
}
ãã 
catch
åå 
(
åå 
	Exception
åå 
e
åå 
)
åå 
{
çç 
throw
éé 
e
éé 
;
éé 
}
èè 
}
êê 	
public
íí 
IEnumerable
íí 
<
íí 
Precio_Concepto
íí *
>
íí* +
ObtenerPrecios
íí, :
(
íí: ;
int
íí; >
idTipo
íí? E
)
ííE F
{
ìì 	
try
îî 
{
ïï 
return
ññ 
_db
ññ 
.
ññ 
Precio
ññ !
.
ññ! "
Where
ññ" '
(
ññ' (
p
ññ( )
=>
ññ* ,
p
ññ- .
.
ññ. /
id_tipo
ññ/ 6
==
ññ7 9
idTipo
ññ: @
)
ññ@ A
.
ññA B
OrderByDescending
ññB S
(
ññS T
p
ññT U
=>
ññV X
p
ññY Z
.
ññZ [
id
ññ[ ]
)
ññ] ^
.
óó 
Select
óó 
(
óó 
p
óó 
=>
óó  
new
óó! $
Precio_Concepto
óó% 4
(
óó4 5
)
óó5 6
{
òò 
Id
ôô 
=
ôô 
p
ôô 
.
ôô 
id
ôô !
,
ôô! "

IdConcepto
öö "
=
öö# $
p
öö% &
.
öö& '!
id_concepto_negocio
öö' :
,
öö: ;
Concepto
õõ  
=
õõ! "
p
õõ# $
.
õõ$ %
Concepto_negocio1
õõ% 6
.
õõ6 7
nombre
õõ7 =
,
õõ= >
IdTarifa
úú  
=
úú! "
p
úú# $
.
úú$ %
id_tarifa_d
úú% 0
,
úú0 1
Tarifa
ùù 
=
ùù  
p
ùù! "
.
ùù" #
Detalle_maestro3
ùù# 3
.
ùù3 4
nombre
ùù4 :
,
ùù: ;
Precio
ûû 
=
ûû  
p
ûû! "
.
ûû" #
valor
ûû# (
,
ûû( )

FechaDesde
üü "
=
üü# $
p
üü% &
.
üü& '
fecha_inicio
üü' 3
,
üü3 4

FechaHasta
†† "
=
††# $
p
††% &
.
††& '
	fecha_fin
††' 0
,
††0 1
	EsVigente
°° !
=
°°" #
p
°°$ %
.
°°% &

es_vigente
°°& 0
}
¢¢ 
)
££ 
;
££ 
}
§§ 
catch
•• 
(
•• 
	Exception
•• 
e
•• 
)
•• 
{
¶¶ 
throw
ßß 
e
ßß 
;
ßß 
}
®® 
}
©© 	
public
´´ 
Precio
´´ 
obtenerPrecio
´´ #
(
´´# $
int
´´$ '
idPrecio
´´( 0
)
´´0 1
{
¨¨ 	
try
≠≠ 
{
ÆÆ 
return
ØØ 
_db
ØØ 
.
ØØ 
Precio
ØØ !
.
ØØ! "
Include
ØØ" )
(
ØØ) *
p
ØØ* +
=>
ØØ, .
p
ØØ/ 0
.
ØØ0 1
Concepto_negocio
ØØ1 A
)
ØØA B
.
ØØB C
Include
ØØC J
(
ØØJ K
p
ØØK L
=>
ØØM O
p
ØØP Q
.
ØØQ R
Detalle_maestro3
ØØR b
)
ØØb c
.
ØØc d
Single
ØØd j
(
ØØj k
p
ØØk l
=>
ØØm o
p
ØØp q
.
ØØq r
id
ØØr t
==
ØØu w
idPrecioØØx Ä
)ØØÄ Å
;ØØÅ Ç
}
∞∞ 
catch
±± 
(
±± 
	Exception
±± 
e
±± 
)
±± 
{
≤≤ 
throw
≥≥ 
e
≥≥ 
;
≥≥ 
}
¥¥ 
}
µµ 	
public
∑∑ 
IEnumerable
∑∑ 
<
∑∑ 
Precio
∑∑ !
>
∑∑! "7
)ObtenerPreciosVigentesDeUnConceptoNegocio
∑∑# L
(
∑∑L M
int
∑∑M P
idTipo
∑∑Q W
,
∑∑W X
int
∑∑Y \
idConceptoNegocio
∑∑] n
)
∑∑n o
{
∏∏ 	
try
ππ 
{
∫∫ 
return
ªª 
_db
ªª 
.
ªª 
Precio
ªª !
.
ªª! "
Where
ªª" '
(
ªª' (
p
ªª( )
=>
ªª* ,
(
ªª- .
p
ªª. /
.
ªª/ 0

es_vigente
ªª0 :
==
ªª; =
true
ªª> B
)
ªªB C
&&
ªªD F
(
ªªG H
p
ªªH I
.
ªªI J!
id_concepto_negocio
ªªJ ]
==
ªª^ `
idConceptoNegocio
ªªa r
)
ªªr s
)
ªªs t
.
ªªt u 
OrderByDescendingªªu Ü
(ªªÜ á
pªªá à
=>ªªâ ã
pªªå ç
.ªªç é
idªªé ê
)ªªê ë
;ªªë í
}
ΩΩ 
catch
ææ 
(
ææ 
	Exception
ææ 
e
ææ 
)
ææ 
{
øø 
throw
¿¿ 
e
¿¿ 
;
¿¿ 
}
¡¡ 
}
¬¬ 	
public
ƒƒ 
Precio
ƒƒ "
ObtenerPrecioVigente
ƒƒ *
(
ƒƒ* +
int
ƒƒ+ .
idConceptoNegocio
ƒƒ/ @
,
ƒƒ@ A
int
ƒƒB E
idTarifa
ƒƒF N
)
ƒƒN O
{
≈≈ 	
try
∆∆ 
{
«« 
return
»» 
_db
»» 
.
»» 
Precio
»» !
.
»»! "
SingleOrDefault
»»" 1
(
»»1 2
p
»»2 3
=>
»»4 6
p
»»7 8
.
»»8 9!
id_concepto_negocio
»»9 L
==
»»L N
idConceptoNegocio
»»O `
&&
»»a c
p
»»d e
.
»»e f

es_vigente
»»f p
&&
»»q s
p
»»t u
.
»»u v
id_tarifa_d»»v Å
==»»Ç Ñ
idTarifa»»Ö ç
)»»ç é
;»»é è
}
   
catch
ÀÀ 
(
ÀÀ 
	Exception
ÀÀ 
e
ÀÀ 
)
ÀÀ 
{
ÃÃ 
throw
ÕÕ 
e
ÕÕ 
;
ÕÕ 
}
ŒŒ 
}
œœ 	
public
—— 
IEnumerable
—— 
<
—— 
Precio
—— !
>
——! "$
ObtenerPreciosVigentes
——# 9
(
——9 :
int
——: =
[
——= >
]
——> ?!
idsConceptosNegocio
——@ S
,
——S T
int
——U X
idTarifa
——Y a
)
——a b
{
““ 	
try
”” 
{
‘‘ 
return
’’ 
_db
’’ 
.
’’ 
Precio
’’ !
.
’’! "
Where
’’" '
(
’’' (
p
’’( )
=>
’’* ,!
idsConceptosNegocio
’’- @
.
’’@ A
Contains
’’A I
(
’’I J
p
’’J K
.
’’K L!
id_concepto_negocio
’’L _
)
’’_ `
&&
’’a c
p
’’d e
.
’’e f

es_vigente
’’f p
&&
’’q s
p
’’t u
.
’’u v
id_tarifa_d’’v Å
==’’Å É
idTarifa’’Ñ å
)’’å ç
;’’ç é
}
◊◊ 
catch
ÿÿ 
(
ÿÿ 
	Exception
ÿÿ 
e
ÿÿ 
)
ÿÿ 
{
ŸŸ 
throw
⁄⁄ 
e
⁄⁄ 
;
⁄⁄ 
}
€€ 
}
‹‹ 	
}
›› 
}ﬁﬁ Ì°
ID:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\MaestroDatos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
{ 
public 

class 
MaestroDatos 
: 
RepositorioBase  /
,/ 0
IMaestroRepositorio1 D
{ 
public 
OperationResult 
crearMaestro +
(+ ,
Maestro, 3
maestro4 ;
); <
{ 	
try 
{ 
_db 
. 
Maestro 
. 
Add 
(  
maestro  '
)' (
;( )
var 
result 
= 
Save !
(! "
)" #
;# $
result 
. 
data 
= 
maestro %
.% &
id& (
;( )
return 
result 
; 
} 
catch 
( 
	Exception 
e 
) 
{ 
throw 
e 
; 
} 
} 	
public   
OperationResult   
crearDetalleMaestro   2
(  2 3
Detalle_maestro  3 B
detalle  C J
)  J K
{!! 	
try"" 
{## 
_db$$ 
.$$ 
Detalle_maestro$$ #
.$$# $
Add$$$ '
($$' (
detalle$$( /
)$$/ 0
;$$0 1
var%% 
result%% 
=%% 
Save%% !
(%%! "
)%%" #
;%%# $
result&& 
.&& 
data&& 
=&& 
detalle&& %
.&&% &
id&&& (
;&&( )
return'' 
result'' 
;'' 
}(( 
catch)) 
()) 
	Exception)) 
e)) 
))) 
{** 
throw++ 
new++ 
DatosException++ (
(++( )
$str++) L
,++L M
e++N O
)++O P
;++P Q
},, 
}-- 	
public.. 
OperationResult.. &
CrearDetalleDetalleMaestro.. 9
(..9 :#
Detalle_detalle_maestro..: Q
detalle..R Y
)..Y Z
{// 	
try00 
{11 
_db22 
.22 #
Detalle_detalle_maestro22 +
.22+ ,
Add22, /
(22/ 0
detalle220 7
)227 8
;228 9
var33 
result33 
=33 
Save33 !
(33! "
)33" #
;33# $
result44 
.44 
data44 
=44 
detalle44 %
.44% &
Detalle_maestro144& 6
.446 7
id447 9
;449 :
return55 
result55 
;55 
}66 
catch77 
(77 
	Exception77 
e77 
)77 
{88 
throw99 
new99 
DatosException99 (
(99( )
$str99) W
,99W X
e99Y Z
)99Z [
;99[ \
}:: 
};; 	
public== 
OperationResult== 
actualizarMaestro== 0
(==0 1
Maestro==1 8
maestro==9 @
)==@ A
{>> 	
try?? 
{@@ 
MaestroAA 
	dbMaestroAA !
=AA" #
_dbAA$ '
.AA' (
MaestroAA( /
.AA/ 0
SingleAA0 6
(AA6 7
mAA7 8
=>AA9 ;
mAA< =
.AA= >
idAA> @
==AAA C
maestroAAD K
.AAK L
idAAL N
)AAN O
;AAO P
_dbBB 
.BB 
EntryBB 
(BB 
	dbMaestroBB #
)BB# $
.BB$ %
CurrentValuesBB% 2
.BB2 3
	SetValuesBB3 <
(BB< =
maestroBB= D
)BBD E
;BBE F
varCC 
resultCC 
=CC 
SaveCC !
(CC! "
)CC" #
;CC# $
resultDD 
.DD 
dataDD 
=DD 
maestroDD %
.DD% &
idDD& (
;DD( )
returnEE 
resultEE 
;EE 
}FF 
catchGG 
(GG 
	ExceptionGG 
eGG 
)GG 
{HH 
returnII 
newII 
OperationResultII *
(II* +
eII+ ,
)II, -
;II- .
}JJ 
}KK 	
publicMM 
OperationResultMM $
actualizarDetalleMaestroMM 7
(MM7 8
Detalle_maestroMM8 G
detalleMMH O
)MMO P
{NN 	
tryOO 
{PP 
Detalle_maestroQQ 
	dbDetalleQQ  )
=QQ* +
_dbQQ, /
.QQ/ 0
Detalle_maestroQQ0 ?
.QQ? @
SingleQQ@ F
(QQF G
mQQG H
=>QQI K
mQQL M
.QQM N
idQQN P
==QQQ S
detalleQQT [
.QQ[ \
idQQ\ ^
)QQ^ _
;QQ_ `
detalleRR 
.RR 
fecha_registroRR &
=RR' (
	dbDetalleRR) 2
.RR2 3
fecha_registroRR3 A
;RRA B
_dbSS 
.SS 
EntrySS 
(SS 
	dbDetalleSS #
)SS# $
.SS$ %
CurrentValuesSS% 2
.SS2 3
	SetValuesSS3 <
(SS< =
detalleSS= D
)SSD E
;SSE F
varTT 
resultTT 
=TT 
SaveTT !
(TT! "
)TT" #
;TT# $
resultUU 
.UU 
dataUU 
=UU 
detalleUU %
.UU% &
idUU& (
;UU( )
returnVV 
resultVV 
;VV 
}WW 
catchXX 
(XX 
	ExceptionXX 
eXX 
)XX 
{YY 
returnZZ 
newZZ 
OperationResultZZ *
(ZZ* +
eZZ+ ,
)ZZ, -
;ZZ- .
}[[ 
}\\ 	
public^^ 
OperationResult^^ +
ActualizarDetalleDetalleMaestro^^ >
(^^> ?#
Detalle_detalle_maestro^^? V
detalle^^W ^
)^^^ _
{__ 	
try`` 
{aa 
Detalle_maestrobb 
	dbDetallebb  )
=bb* +
_dbbb, /
.bb/ 0
Detalle_maestrobb0 ?
.bb? @
Singlebb@ F
(bbF G
mbbG H
=>bbI K
mbbL M
.bbM N
idbbN P
==bbQ S
detallebbT [
.bb[ \
Detalle_maestro1bb\ l
.bbl m
idbbm o
)bbo p
;bbp q
detallecc 
.cc 
Detalle_maestro1cc (
.cc( )
fecha_registrocc) 7
=cc8 9
	dbDetallecc: C
.ccC D
fecha_registroccD R
;ccR S
_dbdd 
.dd 
Entrydd 
(dd 
	dbDetalledd #
)dd# $
.dd$ %
CurrentValuesdd% 2
.dd2 3
	SetValuesdd3 <
(dd< =
detalledd= D
.ddD E
Detalle_maestro1ddE U
)ddU V
;ddV W#
Detalle_detalle_maestroee '
dbDetalleDetalleee( 8
=ee9 :
	dbDetalleee; D
.eeD E$
Detalle_detalle_maestro1eeE ]
.ee] ^
Singleee^ d
(eed e
deee f
=>eeg i
deej k
.eek l*
id_detalle_maestro_secundario	eel â
==
eeä å
detalle
eeç î
.
eeî ï
Detalle_maestro1
eeï •
.
ee• ¶
id
ee¶ ®
)
ee® ©
;
ee© ™
dbDetalleDetalleff  
.ff  !(
id_detalle_maestro_principalff! =
=ff> ?
detalleff@ G
.ffG H(
id_detalle_maestro_principalffH d
;ffd e
vargg 
resultgg 
=gg 
Savegg !
(gg! "
)gg" #
;gg# $
resulthh 
.hh 
datahh 
=hh 
	dbDetallehh '
.hh' (
idhh( *
;hh* +
returnii 
resultii 
;ii 
}jj 
catchkk 
(kk 
	Exceptionkk 
ekk 
)kk 
{ll 
returnmm 
newmm 
OperationResultmm *
(mm* +
emm+ ,
)mm, -
;mm- .
}nn 
}oo 	
publicqq 
OperationResultqq #
DarDeBajaDetalleMaestroqq 6
(qq6 7
intqq7 :
idDetalleMaestroqq; K
,qqK L
intqqM P
	idMaestroqqQ Z
)qqZ [
{rr 	
tryss 
{tt 
varvv 
dbDetalleMaestrovv $
=vv% &
_dbvv' *
.vv* +
Maestrovv+ 2
.vv2 3
Wherevv3 8
(vv8 9
mvv9 :
=>vv; =
mvv> ?
.vv? @
idvv@ B
==vvC E
	idMaestrovvF O
)vvO P
.vvP Q

SelectManyvvQ [
(vv[ \
mvv\ ]
=>vv^ `
mvva b
.vvb c
Detalle_maestrovvc r
)vvr s
.vvs t
FirstOrDefault	vvt Ç
(
vvÇ É
dm
vvÉ Ö
=>
vvÜ à
dm
vvâ ã
.
vvã å
id
vvå é
==
vvè ë
idDetalleMaestro
vví ¢
)
vv¢ £
;
vv£ §
dbDetalleMaestroww  
.ww  !

es_vigenteww! +
=ww, -
falseww. 3
;ww3 4
returnyy 
Saveyy 
(yy 
)yy 
;yy 
}zz 
catch{{ 
({{ 
	Exception{{ 
e{{ 
){{ 
{|| 
throw}} 
new}} 
DatosException}} (
(}}( )
$str}}) N
,}}N O
e}}P Q
)}}Q R
;}}R S
}~~ 
}
ÄÄ 	
public
ÅÅ 
OperationResult
ÅÅ %
DarDeAltaDetalleMaestro
ÅÅ 6
(
ÅÅ6 7
int
ÅÅ7 :
idDetalleMaestro
ÅÅ; K
,
ÅÅK L
int
ÅÅM P
	idMaestro
ÅÅQ Z
)
ÅÅZ [
{
ÇÇ 	
try
ÉÉ 
{
ÑÑ 
var
ÜÜ 
dbDetalleMaestro
ÜÜ $
=
ÜÜ% &
_db
ÜÜ' *
.
ÜÜ* +
Maestro
ÜÜ+ 2
.
ÜÜ2 3
Where
ÜÜ3 8
(
ÜÜ8 9
m
ÜÜ9 :
=>
ÜÜ; =
m
ÜÜ> ?
.
ÜÜ? @
id
ÜÜ@ B
==
ÜÜC E
	idMaestro
ÜÜF O
)
ÜÜO P
.
ÜÜP Q

SelectMany
ÜÜQ [
(
ÜÜ[ \
m
ÜÜ\ ]
=>
ÜÜ^ `
m
ÜÜa b
.
ÜÜb c
Detalle_maestro
ÜÜc r
)
ÜÜr s
.
ÜÜs t
FirstOrDefaultÜÜt Ç
(ÜÜÇ É
dmÜÜÉ Ö
=>ÜÜÜ à
dmÜÜâ ã
.ÜÜã å
idÜÜå é
==ÜÜè ë 
idDetalleMaestroÜÜí ¢
)ÜÜ¢ £
;ÜÜ£ §
dbDetalleMaestro
áá  
.
áá  !

es_vigente
áá! +
=
áá, -
true
áá. 2
;
áá2 3
return
ââ 
Save
ââ 
(
ââ 
)
ââ 
;
ââ 
}
ää 
catch
ãã 
(
ãã 
	Exception
ãã 
e
ãã 
)
ãã 
{
åå 
throw
çç 
new
çç 
DatosException
çç (
(
çç( )
$str
çç) N
,
ççN O
e
ççP Q
)
ççQ R
;
ççR S
}
éé 
}
êê 	
public
ìì 
async
ìì 
Task
ìì 
<
ìì 
IEnumerable
ìì %
<
ìì% &
ItemJerarquico
ìì& 4
>
ìì4 5
>
ìì5 6(
ObtenerDetallesJerarquicos
ìì7 Q
(
ììQ R
int
ììR U
	idMaestro
ììV _
)
ìì_ `
{
îî 	
try
ïï 
{
ññ 
var
óó 
_dbAsync
óó 
=
óó 
new
óó "
SigescomEntities
óó# 3
(
óó3 4
)
óó4 5
;
óó5 6
return
òò 
(
òò 
await
òò 
_dbAsync
òò &
.
òò& '%
Detalle_detalle_maestro
òò' >
.
òò> ?
Include
òò? F
(
òòF G
dm
òòG I
=>
òòJ L
dm
òòM O
.
òòO P
Detalle_maestro1
òòP `
)
òò` a
.
òòa b
ToListAsync
òòb m
(
òòm n
)
òòn o
)
òòo p
.
òòp q
Select
òòq w
(
òòw x
ddm
òòx {
=>
òò| ~
newòò Ç
ItemJerarquicoòòÉ ë
{òòí ì
Idòòî ñ
=òòó ò
ddmòòô ú
.òòú ù-
id_detalle_maestro_secundarioòòù ∫
,òò∫ ª
IdPadreòòº √
=òòƒ ≈
ddmòò∆ …
.òò…  ,
id_detalle_maestro_principalòò  Ê
,òòÊ Á
NombreòòË Ó
=òòÔ 
ddmòòÒ Ù
.òòÙ ı 
Detalle_maestro1òòı Ö
.òòÖ Ü
nombreòòÜ å
}òòç é
)òòé è
;òòè ê
}
ôô 
catch
öö 
(
öö 
	Exception
öö 
e
öö 
)
öö 
{
õõ 
throw
úú 
e
úú 
;
úú 
}
ùù 
}
ûû 	
public
†† 
IEnumerable
†† 
<
†† 
ItemJerarquico
†† )
>
††) *=
/ObtenerDetallesJerarquicosPorRolConceptoNegocio
††+ Z
(
††Z [
int
††[ ^
idRol
††_ d
)
††d e
{
°° 	
try
¢¢ 
{
££ 
var
§§ 
_db
§§ 
=
§§ 
new
§§ 
SigescomEntities
§§ .
(
§§. /
)
§§/ 0
;
§§0 1
var
•• 
idsCategorias
•• !
=
••" #
_db
••$ '
.
••' ("
Concepto_negocio_rol
••( <
.
••< =
Where
••= B
(
••B C
cnr
••C F
=>
••G I
cnr
••J M
.
••M N
id_rol
••N T
==
••U W
idRol
••X ]
)
••] ^
.
••^ _
Select
••_ e
(
••e f
cnr
••f i
=>
••j l
cnr
••m p
.
••p q
Concepto_negocio••q Å
)••Å Ç
.••Ç É
Where••É à
(••à â
cnr••â å
=>••ç è
cnr••ê ì
.••ì î

es_vigente••î û
)••û ü
.••ü †

SelectMany••† ™
(••™ ´
cn••´ ≠
=>••Æ ∞
cn••± ≥
.••≥ ¥ 
Detalle_maestro4••¥ ƒ
.••ƒ ≈"
Categoria_concepto••≈ ◊
)••◊ ÿ
.••ÿ Ÿ
Select••Ÿ ﬂ
(••ﬂ ‡
cc••‡ ‚
=>••„ Â
cc••Ê Ë
.••Ë È
id_categoria••È ı
)••ı ˆ
.••ˆ ˜
ToList••˜ ˝
(••˝ ˛
)••˛ ˇ
;••ˇ Ä
return
¶¶ 
_db
¶¶ 
.
¶¶ %
Detalle_detalle_maestro
¶¶ 2
.
¶¶2 3
Include
¶¶3 :
(
¶¶: ;
dm
¶¶; =
=>
¶¶> @
dm
¶¶A C
.
¶¶C D
Detalle_maestro1
¶¶D T
)
¶¶T U
.
¶¶U V
Where
¶¶V [
(
¶¶[ \
dm
¶¶\ ^
=>
¶¶_ a
idsCategorias
¶¶b o
.
¶¶o p
Contains
¶¶p x
(
¶¶x y
dm
¶¶y {
.
¶¶{ |,
id_detalle_maestro_secundario¶¶| ô
)¶¶ô ö
)¶¶ö õ
.¶¶õ ú
Select¶¶ú ¢
(¶¶¢ £
ddm¶¶£ ¶
=>¶¶ß ©
new¶¶™ ≠
ItemJerarquico¶¶Æ º
{¶¶Ω æ
Id¶¶ø ¡
=¶¶¬ √
ddm¶¶ƒ «
.¶¶« »-
id_detalle_maestro_secundario¶¶» Â
,¶¶Â Ê
IdPadre¶¶Á Ó
=¶¶Ô 
ddm¶¶Ò Ù
.¶¶Ù ı,
id_detalle_maestro_principal¶¶ı ë
,¶¶ë í
Nombre¶¶ì ô
=¶¶ö õ
ddm¶¶ú ü
.¶¶ü † 
Detalle_maestro1¶¶† ∞
.¶¶∞ ±
nombre¶¶± ∑
}¶¶∏ π
)¶¶π ∫
;¶¶∫ ª
;¶¶º Ω
}
ßß 
catch
®® 
(
®® 
	Exception
®® 
e
®® 
)
®® 
{
©© 
throw
™™ 
e
™™ 
;
™™ 
}
´´ 
}
¨¨ 	
public
ÆÆ 
async
ÆÆ 
Task
ÆÆ 
<
ÆÆ 
IEnumerable
ÆÆ %
<
ÆÆ% &
Detalle_maestro
ÆÆ& 5
>
ÆÆ5 6
>
ÆÆ6 7"
ObtenerDetallesAsync
ÆÆ8 L
(
ÆÆL M
int
ÆÆM P
	idMaestro
ÆÆQ Z
)
ÆÆZ [
{
ØØ 	
try
∞∞ 
{
±± 
var
≤≤ 
_dbAsync
≤≤ 
=
≤≤ 
new
≤≤ "
SigescomEntities
≤≤# 3
(
≤≤3 4
)
≤≤4 5
;
≤≤5 6
return
¥¥ 
await
¥¥ 
_dbAsync
¥¥ %
.
¥¥% &
Detalle_maestro
¥¥& 5
.
¥¥5 6
Where
¥¥6 ;
(
¥¥; <
dm
¥¥< >
=>
¥¥? A
dm
¥¥B D
.
¥¥D E

id_maestro
¥¥E O
==
¥¥P R
	idMaestro
¥¥S \
)
¥¥\ ]
.
¥¥] ^
ToListAsync
¥¥^ i
(
¥¥i j
)
¥¥j k
;
¥¥k l
}
µµ 
catch
∂∂ 
(
∂∂ 
	Exception
∂∂ 
e
∂∂ 
)
∂∂ 
{
∑∑ 
throw
∏∏ 
e
∏∏ 
;
∏∏ 
}
ππ 
}
ªª 	
public
ΩΩ 
async
ΩΩ 
Task
ΩΩ 
<
ΩΩ 
IEnumerable
ΩΩ %
<
ΩΩ% &
Detalle_maestro
ΩΩ& 5
>
ΩΩ5 6
>
ΩΩ6 7*
ObtenerDetallesVigentesAsync
ΩΩ8 T
(
ΩΩT U
int
ΩΩU X
	idMaestro
ΩΩY b
)
ΩΩb c
{
ææ 	
try
øø 
{
¿¿ 
var
¡¡ 
_dbAsync
¡¡ 
=
¡¡ 
new
¡¡ "
SigescomEntities
¡¡# 3
(
¡¡3 4
)
¡¡4 5
;
¡¡5 6
return
√√ 
await
√√ 
_dbAsync
√√ %
.
√√% &
Detalle_maestro
√√& 5
.
√√5 6
Where
√√6 ;
(
√√; <
dm
√√< >
=>
√√? A
dm
√√B D
.
√√D E

id_maestro
√√E O
==
√√P R
	idMaestro
√√S \
&&
√√] _
dm
√√` b
.
√√b c

es_vigente
√√c m
)
√√m n
.
√√n o
ToListAsync
√√o z
(
√√z {
)
√√{ |
;
√√| }
}
ƒƒ 
catch
≈≈ 
(
≈≈ 
	Exception
≈≈ 
e
≈≈ 
)
≈≈ 
{
∆∆ 
throw
«« 
e
«« 
;
«« 
}
»» 
}
   	
public
ÃÃ 
IEnumerable
ÃÃ 
<
ÃÃ 
ItemGenerico
ÃÃ '
>
ÃÃ' (/
!ObtenerDetallesComoItemsGenericos
ÃÃ) J
(
ÃÃJ K
int
ÃÃK N
	idMaestro
ÃÃO X
)
ÃÃX Y
{
ÕÕ 	
try
ŒŒ 
{
œœ 
return
–– 
_db
–– 
.
–– 
Detalle_maestro
–– *
.
––* +
Where
––+ 0
(
––0 1
dm
––1 3
=>
––4 6
dm
––7 9
.
––9 :

id_maestro
––: D
==
––E G
	idMaestro
––H Q
)
––Q R
.
—— 
Select
—— 
(
—— 
dm
—— 
=>
—— !
new
““ 
ItemGenerico
““ $
{
”” 
Id
‘‘ 
=
‘‘ 
dm
‘‘ 
.
‘‘  
id
‘‘  "
,
‘‘" #
Nombre
’’ 
=
’’  
dm
’’! #
.
’’# $
nombre
’’$ *
}
÷÷ 
)
÷÷ 
;
÷÷ 
}
◊◊ 
catch
ÿÿ 
(
ÿÿ 
	Exception
ÿÿ 
e
ÿÿ 
)
ÿÿ 
{
ŸŸ 
throw
⁄⁄ 
e
⁄⁄ 
;
⁄⁄ 
}
€€ 
}
‹‹ 	
public
›› 
IEnumerable
›› 
<
›› 
Detalle_maestro
›› *
>
››* +
ObtenerDetalles
››, ;
(
››; <
int
››< ?
	idMaestro
››@ I
)
››I J
{
ﬁﬁ 	
try
ﬂﬂ 
{
‡‡ 
var
·· 
_dbS
·· 
=
·· 
new
·· 
SigescomEntities
·· /
(
··/ 0
)
··0 1
;
··1 2
return
„„ 
_dbS
„„ 
.
„„ 
Detalle_maestro
„„ +
.
„„+ ,
Where
„„, 1
(
„„1 2
dm
„„2 4
=>
„„5 7
dm
„„8 :
.
„„: ;

id_maestro
„„; E
==
„„F H
	idMaestro
„„I R
)
„„R S
;
„„S T
}
‰‰ 
catch
ÂÂ 
(
ÂÂ 
	Exception
ÂÂ 
e
ÂÂ 
)
ÂÂ 
{
ÊÊ 
throw
ÁÁ 
e
ÁÁ 
;
ÁÁ 
}
ËË 
}
ÍÍ 	
public
ÎÎ 
IEnumerable
ÎÎ 
<
ÎÎ 
Detalle_maestro
ÎÎ *
>
ÎÎ* +
ObtenerDetalles
ÎÎ, ;
(
ÎÎ; <
int
ÎÎ< ?
	idMaestro
ÎÎ@ I
,
ÎÎI J
bool
ÎÎK O
	esVigente
ÎÎP Y
)
ÎÎY Z
{
ÏÏ 	
try
ÌÌ 
{
ÓÓ 
return
ÔÔ 
_db
ÔÔ 
.
ÔÔ 
Detalle_maestro
ÔÔ *
.
ÔÔ* +
Where
ÔÔ+ 0
(
ÔÔ0 1
dm
ÔÔ1 3
=>
ÔÔ4 6
dm
ÔÔ7 9
.
ÔÔ9 :

id_maestro
ÔÔ: D
==
ÔÔE G
	idMaestro
ÔÔH Q
&&
ÔÔR T
dm
ÔÔU W
.
ÔÔW X

es_vigente
ÔÔX b
==
ÔÔc e
	esVigente
ÔÔf o
)
ÔÔo p
;
ÔÔp q
}
 
catch
ÒÒ 
(
ÒÒ 
	Exception
ÒÒ 
e
ÒÒ 
)
ÒÒ 
{
ÚÚ 
throw
ÛÛ 
e
ÛÛ 
;
ÛÛ 
}
ÙÙ 
}
ıı 	
public
ˆˆ 
IEnumerable
ˆˆ 
<
ˆˆ (
Familia_Concepto_Comercial
ˆˆ 5
>
ˆˆ5 6.
 ObtenerFamiliasConceptoComercial
ˆˆ7 W
(
ˆˆW X
int
ˆˆX [
	idMaestro
ˆˆ\ e
,
ˆˆe f
bool
ˆˆg k
	esVigente
ˆˆl u
)
ˆˆu v
{
˜˜ 	
try
¯¯ 
{
˘˘ 
return
˙˙ 
_db
˙˙ 
.
˙˙ 
Detalle_maestro
˙˙ *
.
˙˙* +
Where
˙˙+ 0
(
˙˙0 1
dm
˙˙1 3
=>
˙˙4 6
dm
˙˙7 9
.
˙˙9 :

id_maestro
˙˙: D
==
˙˙E G
	idMaestro
˙˙H Q
&&
˚˚ 
dm
˚˚ 
.
˚˚ 

es_vigente
˚˚  
==
˚˚! #
	esVigente
˚˚$ -
)
˚˚- .
.
˚˚. /
OrderBy
˚˚/ 6
(
˚˚6 7
dm
˚˚7 9
=>
˚˚: <
dm
˚˚= ?
.
˚˚? @
nombre
˚˚@ F
)
˚˚F G
.
¸¸ 
Select
¸¸ 
(
¸¸ 
dm
¸¸ 
=>
¸¸ !
new
¸¸" %(
Familia_Concepto_Comercial
¸¸& @
(
¸¸@ A
)
¸¸A B
{
˝˝ 
Id
˛˛ 
=
˛˛ 
dm
˛˛ 
.
˛˛  
id
˛˛  "
,
˛˛" #
Nombre
ˇˇ 
=
ˇˇ  
dm
ˇˇ! #
.
ˇˇ# $
nombre
ˇˇ$ *
,
ˇˇ* +
Esbien
ÄÄ 
=
ÄÄ  
dm
ÄÄ! #
.
ÄÄ# $
valor
ÄÄ$ )
==
ÄÄ* ,
$str
ÄÄ- 0
}
ÅÅ 
)
ÅÅ 
;
ÅÅ 
;
ÅÅ 
}
ÇÇ 
catch
ÉÉ 
(
ÉÉ 
	Exception
ÉÉ 
e
ÉÉ 
)
ÉÉ 
{
ÑÑ 
throw
ÖÖ 
new
ÖÖ 
DatosException
ÖÖ (
(
ÖÖ( )
$str
ÖÖ) O
,
ÖÖO P
e
ÖÖQ R
)
ÖÖR S
;
ÖÖS T
}
ÜÜ 
}
áá 	
public
àà 
IEnumerable
àà 
<
àà (
Familia_Concepto_Comercial
àà 5
>
àà5 6.
 ObtenerFamiliasConceptoComercial
àà7 W
(
ààW X
int
ààX [
	idMaestro
àà\ e
,
ààe f
string
ààg m
valor
ààn s
,
ààs t
bool
ààu y
	esVigenteààz É
)ààÉ Ñ
{
ââ 	
try
ää 
{
ãã 
return
åå 
_db
åå 
.
åå 
Detalle_maestro
åå *
.
åå* +
Where
åå+ 0
(
åå0 1
dm
åå1 3
=>
åå4 6
dm
åå7 9
.
åå9 :

id_maestro
åå: D
==
ååE G
	idMaestro
ååH Q
&&
çç 
dm
çç 
.
çç 
valor
çç 
==
çç 
valor
çç $
&&
éé 
dm
éé 
.
éé 

es_vigente
éé  
==
éé! #
	esVigente
éé$ -
)
éé- .
.
èè 
Select
èè 
(
èè 
dm
èè 
=>
èè !
new
èè" %(
Familia_Concepto_Comercial
èè& @
(
èè@ A
)
èèA B
{
êê 
Id
ëë 
=
ëë 
dm
ëë 
.
ëë  
id
ëë  "
,
ëë" #
Nombre
íí 
=
íí  
dm
íí! #
.
íí# $
nombre
íí$ *
,
íí* +
Esbien
ìì 
=
ìì  
dm
ìì! #
.
ìì# $
valor
ìì$ )
==
ìì* ,
$str
ìì- 0
}
îî 
)
îî 
;
îî 
;
îî 
}
ïï 
catch
ññ 
(
ññ 
	Exception
ññ 
e
ññ 
)
ññ 
{
óó 
throw
òò 
new
òò 
DatosException
òò (
(
òò( )
$str
òò) O
,
òòO P
e
òòQ R
)
òòR S
;
òòS T
}
ôô 
}
öö 	
public
õõ 
IEnumerable
õõ 
<
õõ (
Familia_Concepto_Comercial
õõ 5
>
õõ5 64
&ObtenerFamiliasConceptoComercialPorRol
õõ7 ]
(
õõ] ^
int
õõ^ a
idRol
õõb g
,
õõg h
bool
õõi m
	esVigente
õõn w
)
õõw x
{
úú 	
try
ùù 
{
ûû 
return
üü 
_db
üü 
.
üü "
Concepto_negocio_rol
üü /
.
üü/ 0
Where
üü0 5
(
üü5 6
cnr
üü6 9
=>
üü: <
cnr
üü= @
.
üü@ A
id_rol
üüA G
==
üüH J
idRol
üüK P
)
üüP Q
.
üüQ R
Select
üüR X
(
üüX Y
cnr
üüY \
=>
üü] _
cnr
üü` c
.
üüc d
Concepto_negocio
üüd t
)
üüt u
.
üüu v
Where
üüv {
(
üü{ |
cnr
üü| 
=>üüÄ Ç
cnrüüÉ Ü
.üüÜ á

es_vigenteüüá ë
==üüí î
	esVigenteüüï û
)üüû ü
.üüü †
Selectüü† ¶
(üü¶ ß
cnüüß ©
=>üü™ ¨
cnüü≠ Ø
.üüØ ∞ 
Detalle_maestro4üü∞ ¿
)üü¿ ¡
.üü¡ ¬
Distinctüü¬  
(üü  À
)üüÀ Ã
.
†† 
Select
†† 
(
†† 
dm
†† 
=>
†† !
new
††" %(
Familia_Concepto_Comercial
††& @
(
††@ A
)
††A B
{
°° 
Id
¢¢ 
=
¢¢ 
dm
¢¢ 
.
¢¢  
id
¢¢  "
,
¢¢" #
Nombre
££ 
=
££  
dm
££! #
.
££# $
nombre
££$ *
,
££* +
Esbien
§§ 
=
§§  
dm
§§! #
.
§§# $
valor
§§$ )
==
§§* ,
$str
§§- 0
}
•• 
)
•• 
;
•• 
}
¶¶ 
catch
ßß 
(
ßß 
	Exception
ßß 
e
ßß 
)
ßß 
{
®® 
throw
©© 
new
©© 
DatosException
©© (
(
©©( )
$str
©©) O
,
©©O P
e
©©Q R
)
©©R S
;
©©S T
}
™™ 
}
´´ 	
public
¨¨ 
IEnumerable
¨¨ 
<
¨¨ (
Familia_Concepto_Comercial
¨¨ 5
>
¨¨5 64
&ObtenerFamiliasConceptoComercialPorRol
¨¨7 ]
(
¨¨] ^
int
¨¨^ a
idRol
¨¨b g
,
¨¨g h
string
¨¨i o
valor
¨¨p u
,
¨¨u v
bool
¨¨w {
	esVigente¨¨| Ö
)¨¨Ö Ü
{
≠≠ 	
try
ÆÆ 
{
ØØ 
return
∞∞ 
_db
∞∞ 
.
∞∞ "
Concepto_negocio_rol
∞∞ /
.
∞∞/ 0
Where
∞∞0 5
(
∞∞5 6
cnr
∞∞6 9
=>
∞∞: <
cnr
∞∞= @
.
∞∞@ A
id_rol
∞∞A G
==
∞∞H J
idRol
∞∞K P
)
∞∞P Q
.
∞∞Q R
Select
∞∞R X
(
∞∞X Y
cnr
∞∞Y \
=>
∞∞] _
cnr
∞∞` c
.
∞∞c d
Concepto_negocio
∞∞d t
)
∞∞t u
.
∞∞u v
Where
∞∞v {
(
∞∞{ |
cnr
∞∞| 
=>∞∞Ä Ç
cnr∞∞É Ü
.∞∞Ü á

es_vigente∞∞á ë
==∞∞í î
	esVigente∞∞ï û
)∞∞û ü
.∞∞ü †
Select∞∞† ¶
(∞∞¶ ß
cn∞∞ß ©
=>∞∞™ ¨
cn∞∞≠ Ø
.∞∞Ø ∞ 
Detalle_maestro4∞∞∞ ¿
)∞∞¿ ¡
.∞∞¡ ¬
Where∞∞¬ «
(∞∞« »
dm∞∞»  
=>∞∞À Õ
dm∞∞Œ –
.∞∞– —
valor∞∞— ÷
==∞∞◊ Ÿ
valor∞∞⁄ ﬂ
)∞∞ﬂ ‡
.∞∞‡ ·
Distinct∞∞· È
(∞∞È Í
)∞∞Í Î
.
±± 
Select
±± 
(
±± 
dm
±± 
=>
±± !
new
±±" %(
Familia_Concepto_Comercial
±±& @
(
±±@ A
)
±±A B
{
≤≤ 
Id
≥≥ 
=
≥≥ 
dm
≥≥ 
.
≥≥  
id
≥≥  "
,
≥≥" #
Nombre
¥¥ 
=
¥¥  
dm
¥¥! #
.
¥¥# $
nombre
¥¥$ *
,
¥¥* +
Esbien
µµ 
=
µµ  
dm
µµ! #
.
µµ# $
valor
µµ$ )
==
µµ* ,
$str
µµ- 0
}
∂∂ 
)
∂∂ 
;
∂∂ 
;
∂∂ 
}
∑∑ 
catch
∏∏ 
(
∏∏ 
	Exception
∏∏ 
e
∏∏ 
)
∏∏ 
{
ππ 
throw
∫∫ 
new
∫∫ 
DatosException
∫∫ (
(
∫∫( )
$str
∫∫) O
,
∫∫O P
e
∫∫Q R
)
∫∫R S
;
∫∫S T
}
ªª 
}
ºº 	
public
ΩΩ 
IEnumerable
ΩΩ 
<
ΩΩ 
Detalle_maestro
ΩΩ *
>
ΩΩ* +-
ObtenerDetallesVigentesPorValor
ΩΩ, K
(
ΩΩK L
int
ΩΩL O
	idMaestro
ΩΩP Y
,
ΩΩY Z
bool
ΩΩ[ _
	esVigente
ΩΩ` i
,
ΩΩi j
string
ΩΩk q
valor
ΩΩr w
)
ΩΩw x
{
ææ 	
try
øø 
{
¿¿ 
return
¡¡ 
_db
¡¡ 
.
¡¡ 
Detalle_maestro
¡¡ *
.
¡¡* +
Where
¡¡+ 0
(
¡¡0 1
dm
¡¡1 3
=>
¡¡4 6
dm
¡¡7 9
.
¡¡9 :

id_maestro
¡¡: D
==
¡¡E G
	idMaestro
¡¡H Q
&&
¡¡R T
dm
¡¡U W
.
¡¡W X

es_vigente
¡¡X b
==
¡¡c e
	esVigente
¡¡f o
&&
¡¡p r
dm
¡¡s u
.
¡¡u v
valor
¡¡v {
==
¡¡| ~
valor¡¡ Ñ
)¡¡Ñ Ö
;¡¡Ö Ü
}
¬¬ 
catch
√√ 
(
√√ 
	Exception
√√ 
e
√√ 
)
√√ 
{
ƒƒ 
throw
≈≈ 
e
≈≈ 
;
≈≈ 
}
∆∆ 
}
«« 	
public
…… 
IEnumerable
…… 
<
…… 
Detalle_maestro
…… *
>
……* +
ObtenerDetalles
……, ;
(
……; <
int
……< ?
[
……? @
]
……@ A

idsMaestro
……B L
,
……L M
bool
……N R
	esVigente
……S \
)
……\ ]
{
   	
try
ÀÀ 
{
ÃÃ 
return
ÕÕ 
_db
ÕÕ 
.
ÕÕ 
Detalle_maestro
ÕÕ *
.
ÕÕ* +
Where
ÕÕ+ 0
(
ÕÕ0 1
dm
ÕÕ1 3
=>
ÕÕ4 6

idsMaestro
ÕÕ7 A
.
ÕÕA B
Contains
ÕÕB J
(
ÕÕJ K
dm
ÕÕK M
.
ÕÕM N

id_maestro
ÕÕN X
)
ÕÕX Y
&&
ÕÕZ \
dm
ÕÕ] _
.
ÕÕ_ `

es_vigente
ÕÕ` j
==
ÕÕk m
	esVigente
ÕÕn w
)
ÕÕw x
;
ÕÕx y
}
ŒŒ 
catch
œœ 
(
œœ 
	Exception
œœ 
e
œœ 
)
œœ 
{
–– 
throw
—— 
new
—— 
DatosException
—— (
(
——( )
$str
——) L
,
——L M
e
——N O
)
——O P
;
——P Q
}
““ 
}
”” 	
public
’’ 
async
’’ 
Task
’’ 
<
’’ 
IEnumerable
’’ %
<
’’% &
Detalle_maestro
’’& 5
>
’’5 6
>
’’6 7(
ObtenerDetallesEspecificos
’’8 R
(
’’R S
int
’’S V
[
’’V W
]
’’W X
idsDetalles
’’Y d
)
’’d e
{
÷÷ 	
try
◊◊ 
{
ÿÿ 
var
ŸŸ 
_asyncDb
ŸŸ 
=
ŸŸ 
new
ŸŸ "
SigescomEntities
ŸŸ# 3
(
ŸŸ3 4
)
ŸŸ4 5
;
ŸŸ5 6
return
⁄⁄ 
await
⁄⁄ 
_asyncDb
⁄⁄ %
.
⁄⁄% &
Detalle_maestro
⁄⁄& 5
.
⁄⁄5 6
Where
⁄⁄6 ;
(
⁄⁄; <
dm
⁄⁄< >
=>
⁄⁄? A
idsDetalles
⁄⁄B M
.
⁄⁄M N
Contains
⁄⁄N V
(
⁄⁄V W
dm
⁄⁄W Y
.
⁄⁄Y Z
id
⁄⁄Z \
)
⁄⁄\ ]
)
⁄⁄] ^
.
⁄⁄^ _
ToListAsync
⁄⁄_ j
(
⁄⁄j k
)
⁄⁄k l
;
⁄⁄l m
}
€€ 
catch
‹‹ 
(
‹‹ 
	Exception
‹‹ 
e
‹‹ 
)
‹‹ 
{
›› 
throw
ﬁﬁ 
e
ﬁﬁ 
;
ﬁﬁ 
}
ﬂﬂ 
}
‡‡ 	
public
„„ 
IEnumerable
„„ 
<
„„ 
Menu_aplicacion
„„ *
>
„„* +
obtenerMenus
„„, 8
(
„„8 9
)
„„9 :
{
‰‰ 	
try
ÂÂ 
{
ÊÊ 
return
ÁÁ 
_db
ÁÁ 
.
ÁÁ 
Menu_aplicacion
ÁÁ *
;
ÁÁ* +
}
ËË 
catch
ÈÈ 
(
ÈÈ 
	Exception
ÈÈ 
e
ÈÈ 
)
ÈÈ 
{
ÍÍ 
throw
ÎÎ 
e
ÎÎ 
;
ÎÎ 
}
ÏÏ 
}
ÓÓ 	
public
ÔÔ 
IEnumerable
ÔÔ 
<
ÔÔ 
Maestro
ÔÔ "
>
ÔÔ" #
obtenerMaestros
ÔÔ$ 3
(
ÔÔ3 4
)
ÔÔ4 5
{
 	
try
ÒÒ 
{
ÚÚ 
return
ÛÛ 
_db
ÛÛ 
.
ÛÛ 
Maestro
ÛÛ "
;
ÛÛ" #
}
ÙÙ 
catch
ıı 
(
ıı 
	Exception
ıı 
e
ıı 
)
ıı 
{
ˆˆ 
throw
˜˜ 
e
˜˜ 
;
˜˜ 
}
¯¯ 
}
˘˘ 	
public
˚˚ 
IEnumerable
˚˚ 
<
˚˚ !
Documento_identidad
˚˚ .
>
˚˚. /1
#obtenerTiposDeDocumentosDeIdentidad
˚˚0 S
(
˚˚S T
)
˚˚T U
{
¸¸ 	
try
˝˝ 
{
˛˛ 
return
ˇˇ 
_db
ˇˇ 
.
ˇˇ !
Documento_identidad
ˇˇ .
;
ˇˇ. /
}
ÄÄ 
catch
ÅÅ 
(
ÅÅ 
	Exception
ÅÅ 
e
ÅÅ 
)
ÅÅ 
{
ÇÇ 
throw
ÉÉ 
e
ÉÉ 
;
ÉÉ 
}
ÑÑ 
}
ÖÖ 	
public
ÜÜ 
IEnumerable
ÜÜ 
<
ÜÜ 
Ubigeo
ÜÜ !
>
ÜÜ! "
obtenerUbigeos
ÜÜ# 1
(
ÜÜ1 2
int
ÜÜ2 5
idPais
ÜÜ6 <
)
ÜÜ< =
{
áá 	
try
àà 
{
ââ 
return
ää 
_db
ää 
.
ää 
Ubigeo
ää !
.
ää! "
Where
ää" '
(
ää' (
u
ää( )
=>
ää* ,
u
ää- .
.
ää. /
id_distrito
ää/ :
!=
ää; =
$num
ää> ?
&&
ää@ B
u
ääC D
.
ääD E
id_pais
ääE L
==
ääM O
idPais
ääP V
)
ääV W
.
ääW X
ToList
ääX ^
(
ää^ _
)
ää_ `
;
ää` a
}
ãã 
catch
åå 
(
åå 
	Exception
åå 
e
åå 
)
åå 
{
çç 
throw
éé 
e
éé 
;
éé 
}
èè 
}
êê 	
public
íí 
IEnumerable
íí 
<
íí 
Ubigeo
íí !
>
íí! "
obtenerUbigeos
íí# 1
(
íí1 2
int
íí2 5
[
íí5 6
]
íí6 7
	idUbigeos
íí8 A
)
ííA B
{
ìì 	
try
îî 
{
ïï 
return
ññ 
_db
ññ 
.
ññ 
Ubigeo
ññ !
.
ññ! "
Where
ññ" '
(
ññ' (
u
ññ( )
=>
ññ* ,
	idUbigeos
ññ- 6
.
ññ6 7
Contains
ññ7 ?
(
ññ? @
u
ññ@ A
.
ññA B
id
ññB D
)
ññD E
)
ññE F
;
ññF G
}
óó 
catch
òò 
(
òò 
	Exception
òò 
e
òò 
)
òò 
{
ôô 
throw
öö 
e
öö 
;
öö 
}
õõ 
}
úú 	
public
ûû 
IEnumerable
ûû 
<
ûû 
Ubigeo
ûû !
>
ûû! "
ObtenerRegiones
ûû# 2
(
ûû2 3
)
ûû3 4
{
üü 	
try
†† 
{
°° 
return
¢¢ 
_db
¢¢ 
.
¢¢ 
Ubigeo
¢¢ !
.
¢¢! "
Where
¢¢" '
(
¢¢' (
u
¢¢( )
=>
¢¢* ,
u
¢¢- .
.
¢¢. /
id_distrito
¢¢/ :
==
¢¢; =
$num
¢¢> ?
&&
¢¢@ B
u
¢¢C D
.
¢¢D E
id_provincia
¢¢E Q
==
¢¢R T
$num
¢¢U V
)
¢¢V W
.
¢¢W X
ToList
¢¢X ^
(
¢¢^ _
)
¢¢_ `
;
¢¢` a
}
££ 
catch
§§ 
(
§§ 
	Exception
§§ 
e
§§ 
)
§§ 
{
•• 
throw
¶¶ 
e
¶¶ 
;
¶¶ 
}
ßß 
}
®® 	
public
™™ 
IEnumerable
™™ 
<
™™ 
Detalle_maestro
™™ *
>
™™* +%
obtenerDetallesConcepto
™™, C
(
™™C D
int
™™D G
IdDetalleMaestro
™™H X
)
™™X Y
{
´´ 	
try
¨¨ 
{
≠≠ 
return
ÆÆ 
_db
ÆÆ 
.
ÆÆ  
Categoria_concepto
ÆÆ -
.
ÆÆ- .
Where
ÆÆ. 3
(
ÆÆ3 4
cc
ÆÆ4 6
=>
ÆÆ7 9
cc
ÆÆ: <
.
ÆÆ< =
Detalle_maestro1
ÆÆ= M
.
ÆÆM N
id
ÆÆN P
==
ÆÆQ S
IdDetalleMaestro
ÆÆT d
)
ÆÆd e
.
ÆÆe f
Select
ÆÆf l
(
ÆÆl m
cc
ÆÆm o
=>
ÆÆp r
cc
ÆÆs u
.
ÆÆu v
Detalle_maestroÆÆv Ö
)ÆÆÖ Ü
;ÆÆÜ á
}
ØØ 
catch
∞∞ 
(
∞∞ 
	Exception
∞∞ 
e
∞∞ 
)
∞∞ 
{
±± 
throw
≤≤ 
e
≤≤ 
;
≤≤ 
}
≥≥ 
}
¥¥ 	
public
µµ 
IEnumerable
µµ 
<
µµ 
Detalle_maestro
µµ *
>
µµ* +"
obtenerDetallesMarca
µµ, @
(
µµ@ A
int
µµA D
IdDetalleMaestro
µµE U
)
µµU V
{
∂∂ 	
try
∑∑ 
{
∏∏ 
return
ππ 
_db
ππ 
.
ππ 
Marca_concepto
ππ )
.
ππ) *
Where
ππ* /
(
ππ/ 0
mc
ππ0 2
=>
ππ3 5
mc
ππ6 8
.
ππ8 9
Detalle_maestro
ππ9 H
.
ππH I
id
ππI K
==
ππL N
IdDetalleMaestro
ππO _
)
ππ_ `
.
ππ` a
Select
ππa g
(
ππg h
cc
ππh j
=>
ππk m
cc
ππn p
.
ππp q
Detalle_maestro1ππq Å
)ππÅ Ç
;ππÇ É
}
∫∫ 
catch
ªª 
(
ªª 
	Exception
ªª 
e
ªª 
)
ªª 
{
ºº 
throw
ΩΩ 
e
ΩΩ 
;
ΩΩ 
}
ææ 
}
øø 	
public
¡¡ 
IEnumerable
¡¡ 
<
¡¡ +
Valor_caracteristica_concepto
¡¡ 8
>
¡¡8 90
"obtenerValorCaracteristicaConcepto
¡¡: \
(
¡¡\ ]
int
¡¡] `

idConcepto
¡¡a k
)
¡¡k l
{
¬¬ 	
try
√√ 
{
ƒƒ 
return
≈≈ 
_db
≈≈ 
.
≈≈ +
Valor_caracteristica_concepto
≈≈ 8
.
≈≈8 9
Where
≈≈9 >
(
≈≈> ?
vcc
≈≈? B
=>
≈≈C E
vcc
≈≈F I
.
≈≈I J
id_concepto
≈≈J U
==
≈≈V X

idConcepto
≈≈Y c
)
≈≈c d
;
≈≈d e
}
∆∆ 
catch
«« 
(
«« 
	Exception
«« 
e
«« 
)
«« 
{
»» 
throw
…… 
e
…… 
;
…… 
}
   
}
ÀÀ 	
public
œœ 
Detalle_maestro
œœ 
ObtenerDetalle
œœ -
(
œœ- .
int
œœ. 1
	idDetalle
œœ2 ;
)
œœ; <
{
–– 	
try
—— 
{
““ 
return
”” 
_db
”” 
.
”” 
Detalle_maestro
”” *
.
””* +
FirstOrDefault
””+ 9
(
””9 :
dm
””: <
=>
””= ?
dm
””@ B
.
””B C
id
””C E
==
””F H
	idDetalle
””I R
)
””R S
;
””S T
}
‘‘ 
catch
’’ 
(
’’ 
	Exception
’’ 
e
’’ 
)
’’ 
{
÷÷ 
throw
◊◊ 
e
◊◊ 
;
◊◊ 
}
ÿÿ 
}
ŸŸ 	
public
€€ 
Detalle_maestro
€€ 6
(ObtenerDetalleMaestroPorIdMaestroYNombre
€€ G
(
€€G H
int
€€H K
	idMaestro
€€L U
,
€€U V
string
€€W ]
nombre
€€^ d
)
€€d e
{
‹‹ 	
try
›› 
{
ﬁﬁ 
return
ﬂﬂ 
_db
ﬂﬂ 
.
ﬂﬂ 
Detalle_maestro
ﬂﬂ *
.
ﬂﬂ* +
SingleOrDefault
ﬂﬂ+ :
(
ﬂﬂ: ;
dm
ﬂﬂ; =
=>
ﬂﬂ> @
dm
ﬂﬂA C
.
ﬂﬂC D

id_maestro
ﬂﬂD N
==
ﬂﬂO Q
	idMaestro
ﬂﬂR [
&&
ﬂﬂ\ ^
dm
ﬂﬂ_ a
.
ﬂﬂa b
nombre
ﬂﬂb h
==
ﬂﬂi k
nombre
ﬂﬂl r
)
ﬂﬂr s
;
ﬂﬂs t
}
‡‡ 
catch
·· 
(
·· 
	Exception
·· 
e
·· 
)
·· 
{
‚‚ 
throw
„„ 
new
„„ 
DatosException
„„ (
(
„„( )
$str
„„) b
,
„„b c
e
„„d e
)
„„e f
;
„„f g
}
‰‰ 
}
ÂÂ 	
public
ËË 
Detalle_maestro
ËË 
ObtenerDetalle
ËË -
(
ËË- .
int
ËË. 1
	idDetalle
ËË2 ;
,
ËË; <
bool
ËË= A
	esVigente
ËËB K
)
ËËK L
{
ÈÈ 	
try
ÍÍ 
{
ÎÎ 
return
ÏÏ 
_db
ÏÏ 
.
ÏÏ 
Detalle_maestro
ÏÏ *
.
ÏÏ* +
Single
ÏÏ+ 1
(
ÏÏ1 2
dm
ÏÏ2 4
=>
ÏÏ5 7
dm
ÏÏ8 :
.
ÏÏ: ;
id
ÏÏ; =
==
ÏÏ> @
	idDetalle
ÏÏA J
&&
ÏÏK M
dm
ÏÏN P
.
ÏÏP Q

es_vigente
ÏÏQ [
==
ÏÏ\ ^
	esVigente
ÏÏ_ h
)
ÏÏh i
;
ÏÏi j
}
ÌÌ 
catch
ÓÓ 
(
ÓÓ 
	Exception
ÓÓ 
e
ÓÓ 
)
ÓÓ 
{
ÔÔ 
throw
 
e
 
;
 
}
ÒÒ 
}
ÚÚ 	
public
ÙÙ 
Detalle_maestro
ÙÙ g
YObtenerDetalleMaestroInclusiveCaracteristicaConceptoConDetalleMaestroYValorCaracteristica
ÙÙ x
(
ÙÙx y
int
ÙÙy |
	idDetalleÙÙ} Ü
,ÙÙÜ á
boolÙÙà å
	esVigenteÙÙç ñ
)ÙÙñ ó
{
ıı 	
try
ˆˆ 
{
˜˜ 
return
¯¯ 
_db
¯¯ 
.
¯¯ 
Detalle_maestro
¯¯ *
.
˘˘  
Include
˘˘  '
(
˘˘' (
dm
˘˘( *
=>
˘˘+ -
dm
˘˘. 0
.
˘˘0 1%
Caracteristica_concepto
˘˘1 H
)
˘˘H I
.
˙˙  
Include
˙˙  '
(
˙˙' (
dm
˙˙( *
=>
˙˙+ -
dm
˙˙. 0
.
˙˙0 1%
Caracteristica_concepto
˙˙1 H
.
˙˙H I
Select
˙˙I O
(
˙˙O P
cc
˙˙P R
=>
˙˙S U
cc
˙˙V X
.
˙˙X Y
Detalle_maestro1
˙˙Y i
)
˙˙i j
)
˙˙j k
.
˚˚  
Include
˚˚  '
(
˚˚' (
dm
˚˚( *
=>
˚˚+ -
dm
˚˚. 0
.
˚˚0 1%
Caracteristica_concepto
˚˚1 H
.
˚˚H I
Select
˚˚I O
(
˚˚O P
cc
˚˚P R
=>
˚˚S U
cc
˚˚V X
.
˚˚X Y
Detalle_maestro1
˚˚Y i
.
˚˚i j"
Valor_caracteristica
˚˚j ~
)
˚˚~ 
)˚˚ Ä
.
¸¸  
Single
¸¸  &
(
¸¸& '
dm
¸¸' )
=>
¸¸* ,
dm
¸¸- /
.
¸¸/ 0
id
¸¸0 2
==
¸¸3 5
	idDetalle
¸¸6 ?
&&
¸¸@ B
dm
¸¸C E
.
¸¸E F

es_vigente
¸¸F P
==
¸¸Q S
	esVigente
¸¸T ]
)
¸¸] ^
;
¸¸^ _
}
˝˝ 
catch
˛˛ 
(
˛˛ 
	Exception
˛˛ 
e
˛˛ 
)
˛˛ 
{
ˇˇ 
throw
ÄÄ 
e
ÄÄ 
;
ÄÄ 
}
ÅÅ 
}
ÇÇ 	
public
ÜÜ 
Detalle_maestro
ÜÜ 8
*ObtenerDetalleInclusiveValorCaracteristica
ÜÜ I
(
ÜÜI J
int
ÜÜJ M
	idDetalle
ÜÜN W
)
ÜÜW X
{
áá 	
try
àà 
{
ââ 
return
ää 
_db
ää 
.
ää 
Detalle_maestro
ää *
.
ää* +
Include
ää+ 2
(
ää2 3
d
ää3 4
=>
ää5 7
d
ää8 9
.
ää9 :"
Valor_caracteristica
ää: N
.
ääN O
Select
ääO U
(
ääU V
vc
ääV X
=>
ääY [
vc
ää\ ^
.
ää^ _
Detalle_maestro
ää_ n
)
ään o
)
ääo p
.
ääp q
Single
ääq w
(
ääw x
dm
ääx z
=>
ää{ }
dmää~ Ä
.ääÄ Å
idääÅ É
==ääÑ Ü
	idDetalleääá ê
)ääê ë
;ääë í
}
ãã 
catch
åå 
(
åå 
	Exception
åå 
e
åå 
)
åå 
{
çç 
throw
éé 
e
éé 
;
éé 
}
èè 
}
êê 	
public
íí 
IEnumerable
íí 
<
íí 
Detalle_maestro
íí *
>
íí* +9
+ObtenerDetallesInclusiveValorCaracteristica
íí, W
(
ííW X
int
ííX [
[
íí[ \
]
íí\ ]

idsMaestro
íí^ h
)
ííh i
{
ìì 	
try
îî 
{
ïï 
return
ññ 
_db
ññ 
.
ññ 
Detalle_maestro
ññ *
.
ññ* +
Include
ññ+ 2
(
ññ2 3
d
ññ3 4
=>
ññ5 7
d
ññ8 9
.
ññ9 :"
Valor_caracteristica
ññ: N
.
ññN O
Select
ññO U
(
ññU V
vc
ññV X
=>
ññY [
vc
ññ\ ^
.
ññ^ _
Detalle_maestro
ññ_ n
)
ññn o
)
ñño p
.
ññp q
Where
ññq v
(
ññv w
dm
ññw y
=>
ññz |

idsMaestroññ} á
.ññá à
Containsññà ê
(ññê ë
dmññë ì
.ññì î

id_maestroññî û
)ññû ü
)ññü †
.ññ† °
OrderByññ° ®
(ññ® ©
dmññ© ´
=>ññ¨ Æ
dmññØ ±
.ññ± ≤
nombreññ≤ ∏
)ññ∏ π
;ññπ ∫
}
óó 
catch
òò 
(
òò 
	Exception
òò 
e
òò 
)
òò 
{
ôô 
throw
öö 
e
öö 
;
öö 
}
õõ 
}
ùù 	
public
üü 
IEnumerable
üü 
<
üü 
Detalle_maestro
üü *
>
üü* +A
3ObtenerDetallesVigentesInclusiveValorCaracteristica
üü, _
(
üü_ `
int
üü` c
[
üüc d
]
üüd e

idsMaestro
üüf p
)
üüp q
{
†† 	
try
°° 
{
¢¢ 
return
££ 
_db
££ 
.
££ 
Detalle_maestro
££ *
.
££* +
Include
££+ 2
(
££2 3
d
££3 4
=>
££5 7
d
££8 9
.
££9 :"
Valor_caracteristica
££: N
.
££N O
Select
££O U
(
££U V
vc
££V X
=>
££Y [
vc
££\ ^
.
££^ _
Detalle_maestro
££_ n
)
££n o
)
££o p
.
££p q
Where
££q v
(
££v w
dm
££w y
=>
££z |

idsMaestro££} á
.££á à
Contains££à ê
(££ê ë
dm££ë ì
.££ì î

id_maestro££î û
)££û ü
&&££† ¢
dm£££ •
.££• ¶

es_vigente££¶ ∞
)££∞ ±
.££± ≤
OrderBy££≤ π
(££π ∫
dm££∫ º
=>££Ω ø
dm££¿ ¬
.££¬ √
nombre££√ …
)££…  
;££  À
}
§§ 
catch
•• 
(
•• 
	Exception
•• 
e
•• 
)
•• 
{
¶¶ 
throw
ßß 
e
ßß 
;
ßß 
}
®® 
}
™™ 	
public
´´ 
Detalle_maestro
´´ 
obtenerDetalle
´´ -
(
´´- .
long
´´. 2
	idMaestro
´´3 <
,
´´< =
string
´´> D
codigoDetalle
´´E R
)
´´R S
{
¨¨ 	
try
≠≠ 
{
ÆÆ 
return
ØØ 
_db
ØØ 
.
ØØ 
Detalle_maestro
ØØ *
.
ØØ* +
Single
ØØ+ 1
(
ØØ1 2
dm
ØØ2 4
=>
ØØ5 7
dm
ØØ8 :
.
ØØ: ;

id_maestro
ØØ; E
==
ØØF H
	idMaestro
ØØI R
&&
ØØS U
dm
ØØV X
.
ØØX Y
codigo
ØØY _
==
ØØ` b
codigoDetalle
ØØc p
)
ØØp q
;
ØØq r
}
∞∞ 
catch
±± 
(
±± 
	Exception
±± 
e
±± 
)
±± 
{
≤≤ 
throw
≥≥ 
e
≥≥ 
;
≥≥ 
}
¥¥ 
}
µµ 	
public
∑∑ 
Detalle_maestro
∑∑ #
ObtenerDetalleMaestro
∑∑ 4
(
∑∑4 5
int
∑∑5 8
	idMaestro
∑∑9 B
,
∑∑B C
int
∑∑D G
idDetalleMaestro
∑∑H X
,
∑∑X Y
bool
∑∑Z ^
	esVigente
∑∑_ h
)
∑∑h i
{
∏∏ 	
try
ππ 
{
∫∫ 
return
ªª 
_db
ªª 
.
ªª 
Detalle_maestro
ªª *
.
ªª* +
SingleOrDefault
ªª+ :
(
ªª: ;
dm
ªª; =
=>
ªª> @
dm
ªªA C
.
ªªC D

id_maestro
ªªD N
==
ªªO Q
	idMaestro
ªªR [
&&
ªª\ ^
dm
ªª_ a
.
ªªa b
id
ªªb d
==
ªªe g
idDetalleMaestro
ªªh x
&&
ªªy {
dm
ªª| ~
.
ªª~ 

es_vigenteªª â
==ªªä å
	esVigenteªªç ñ
)ªªñ ó
;ªªó ò
}
ºº 
catch
ΩΩ 
(
ΩΩ 
	Exception
ΩΩ 
e
ΩΩ 
)
ΩΩ 
{
ææ 
throw
øø 
new
øø 
DatosException
øø (
(
øø( )
$str
øø) K
,
øøK L
e
øøM N
)
øøN O
;
øøO P
}
¿¿ 
}
¬¬ 	
public
ƒƒ 
IEnumerable
ƒƒ 
<
ƒƒ 
Detalle_maestro
ƒƒ *
>
ƒƒ* +%
obtenerDetallesMaestros
ƒƒ, C
(
ƒƒC D
int
ƒƒD G
	IdMaestro
ƒƒH Q
)
ƒƒQ R
{
≈≈ 	
return
∆∆ 
_db
∆∆ 
.
∆∆ 
Detalle_maestro
∆∆ &
.
∆∆& '
Where
∆∆' ,
(
∆∆, -
dm
∆∆- /
=>
∆∆0 2
dm
∆∆3 5
.
∆∆5 6

id_maestro
∆∆6 @
==
∆∆A C
	IdMaestro
∆∆D M
)
∆∆M N
;
∆∆N O
}
«« 	
public
ÀÀ 
Maestro
ÀÀ 
obtenerMaestro
ÀÀ %
(
ÀÀ% &
int
ÀÀ& )
	idMaestro
ÀÀ* 3
)
ÀÀ3 4
{
ÃÃ 	
throw
ÕÕ 
new
ÕÕ %
NotImplementedException
ÕÕ -
(
ÕÕ- .
)
ÕÕ. /
;
ÕÕ/ 0
}
ŒŒ 	
public
—— 
Tipo_cambio
—— !
obtenerTipoDeCambio
—— .
(
——. /
DateTime
——/ 7
date
——8 <
)
——< =
{
““ 	
throw
”” 
new
”” %
NotImplementedException
”” -
(
””- .
)
””. /
;
””/ 0
}
‘‘ 	
public
÷÷ 
IEnumerable
÷÷ 
<
÷÷ 
Detalle_maestro
÷÷ *
>
÷÷* +
obtenerDetalles
÷÷, ;
(
÷÷; <
int
÷÷< ?
[
÷÷? @
]
÷÷@ A

idsMaestro
÷÷B L
)
÷÷L M
{
◊◊ 	
throw
ÿÿ 
new
ÿÿ %
NotImplementedException
ÿÿ -
(
ÿÿ- .
)
ÿÿ. /
;
ÿÿ/ 0
}
ŸŸ 	
public
€€ 
IEnumerable
€€ 
<
€€ 
Detalle_maestro
€€ *
>
€€* +
obtenerDetalles
€€, ;
(
€€; <
int
€€< ?
	idMaestro
€€@ I
,
€€I J
string
€€K Q
filtroDeBusqueda
€€R b
)
€€b c
{
‹‹ 	
throw
›› 
new
›› %
NotImplementedException
›› -
(
››- .
)
››. /
;
››/ 0
}
ﬁﬁ 	
public
‡‡ 
IEnumerable
‡‡ 
<
‡‡ %
Detalle_detalle_maestro
‡‡ 2
>
‡‡2 3$
obtenerDetalleDetalles
‡‡4 J
(
‡‡J K
int
‡‡K N
idDetalleMaestro
‡‡O _
,
‡‡_ `
string
‡‡a g
filtroDeBusqueda
‡‡h x
)
‡‡x y
{
·· 	
throw
‚‚ 
new
‚‚ %
NotImplementedException
‚‚ -
(
‚‚- .
)
‚‚. /
;
‚‚/ 0
}
„„ 	
public
ÊÊ 
List
ÊÊ 
<
ÊÊ !
Documento_identidad
ÊÊ '
>
ÊÊ' ((
obtenerDocumentosIdentidad
ÊÊ) C
(
ÊÊC D
)
ÊÊD E
{
ÁÁ 	
throw
ËË 
new
ËË %
NotImplementedException
ËË -
(
ËË- .
)
ËË. /
;
ËË/ 0
}
ÈÈ 	
public
ÎÎ 
List
ÎÎ 
<
ÎÎ 
Ubigeo
ÎÎ 
>
ÎÎ #
obtenerUbigeoDistrito
ÎÎ 1
(
ÎÎ1 2
)
ÎÎ2 3
{
ÏÏ 	
throw
ÌÌ 
new
ÌÌ %
NotImplementedException
ÌÌ -
(
ÌÌ- .
)
ÌÌ. /
;
ÌÌ/ 0
}
ÓÓ 	
public
 
int
 (
obtenerNumeroMaximoDetalle
 -
(
- .
int
. 1-
idMaestroConfiguracionDeSistema
2 Q
)
Q R
{
ÒÒ 	
throw
ÚÚ 
new
ÚÚ %
NotImplementedException
ÚÚ -
(
ÚÚ- .
)
ÚÚ. /
;
ÚÚ/ 0
}
ÛÛ 	
public
ıı 
List
ıı 
<
ıı 
Detalle_maestro
ıı #
>
ıı# $$
obtenerDetallesEstados
ıı% ;
(
ıı; <
int
ıı< ?
[
ıı? @
]
ıı@ A

idsEstados
ııB L
)
ııL M
{
ˆˆ 	
throw
˜˜ 
new
˜˜ %
NotImplementedException
˜˜ -
(
˜˜- .
)
˜˜. /
;
˜˜/ 0
}
¯¯ 	
public
¸¸ 
List
¸¸ 
<
¸¸ 
Detalle_maestro
¸¸ #
>
¸¸# $%
obtenerDetallesVariedad
¸¸% <
(
¸¸< =
int
¸¸= @
	idDetalle
¸¸A J
)
¸¸J K
{
˝˝ 	
throw
˛˛ 
new
˛˛ %
NotImplementedException
˛˛ -
(
˛˛- .
)
˛˛. /
;
˛˛/ 0
}
ˇˇ 	
public
ÇÇ 
IEnumerable
ÇÇ 
<
ÇÇ 
Detalle_maestro
ÇÇ *
>
ÇÇ* +@
2ObtenerDetallesMaestrosIncluyendoCategoriaConcepto
ÇÇ, ^
(
ÇÇ^ _
int
ÇÇ_ b
	IdMaestro
ÇÇc l
)
ÇÇl m
{
ÉÉ 	
try
ÖÖ 
{
ÜÜ 
return
áá 
_db
áá 
.
áá 
Detalle_maestro
áá *
.
áá* +
Where
áá+ 0
(
áá0 1
dm
áá1 3
=>
áá4 6
dm
áá7 9
.
áá9 :

id_maestro
áá: D
==
ááE G
	IdMaestro
ááH Q
)
ááQ R
.
ááR S
Include
ááS Z
(
ááZ [
dm
áá[ ]
=>
áá^ `
dm
ááa c
.
áác d 
Categoria_concepto
áád v
)
ááv w
;
ááw x
}
àà 
catch
ââ 
(
ââ 
	Exception
ââ 
e
ââ 
)
ââ 
{
ää 
throw
ãã 
new
ãã 
DatosException
ãã (
(
ãã( )
$str
ãã) W
,
ããW X
e
ããY Z
)
ããZ [
;
ãã[ \
}
åå 
}
çç 	
public
èè 
IEnumerable
èè 
<
èè 
Detalle_maestro
èè *
>
èè* +@
2ObtenerDetallesMaestrosIncluyendoCategoriaConcepto
èè, ^
(
èè^ _
int
èè_ b
	IdMaestro
èèc l
,
èèl m
bool
èèn r
	esVigente
èès |
)
èè| }
{
êê 	
try
íí 
{
ìì 
return
îî 
_db
îî 
.
îî 
Detalle_maestro
îî *
.
îî* +
Where
îî+ 0
(
îî0 1
dm
îî1 3
=>
îî4 6
dm
îî7 9
.
îî9 :

id_maestro
îî: D
==
îîE G
	IdMaestro
îîH Q
&&
îîR T
dm
îîU W
.
îîW X

es_vigente
îîX b
==
îîc e
	esVigente
îîf o
)
îîo p
.
îîp q
Include
îîq x
(
îîx y
dm
îîy {
=>
îî| ~
dmîî Å
.îîÅ Ç"
Categoria_conceptoîîÇ î
)îîî ï
;îîï ñ
}
ïï 
catch
ññ 
(
ññ 
	Exception
ññ 
e
ññ 
)
ññ 
{
óó 
throw
òò 
new
òò 
DatosException
òò (
(
òò( )
$str
òò) W
,
òòW X
e
òòY Z
)
òòZ [
;
òò[ \
}
ôô 
}
öö 	
public
õõ 
IEnumerable
õõ 
<
õõ 
Detalle_maestro
õõ *
>
õõ* +G
9ObtenerTodoLosDetallesMaestrosIncluyendoCategoriaConcepto
õõ, e
(
õõe f
int
õõf i
	IdMaestro
õõj s
)
õõs t
{
úú 	
try
ûû 
{
üü 
return
†† 
_db
†† 
.
†† 
Detalle_maestro
†† *
.
††* +
Where
††+ 0
(
††0 1
dm
††1 3
=>
††4 6
dm
††7 9
.
††9 :

id_maestro
††: D
==
††E G
	IdMaestro
††H Q
)
††Q R
.
††R S
Include
††S Z
(
††Z [
dm
††[ ]
=>
††^ `
dm
††a c
.
††c d 
Categoria_concepto
††d v
)
††v w
;
††w x
}
°° 
catch
¢¢ 
(
¢¢ 
	Exception
¢¢ 
e
¢¢ 
)
¢¢ 
{
££ 
throw
§§ 
new
§§ 
DatosException
§§ (
(
§§( )
$str
§§) W
,
§§W X
e
§§Y Z
)
§§Z [
;
§§[ \
}
•• 
}
¶¶ 	
public
≠≠ 
Turno
≠≠ 
ObtenerTurno
≠≠ !
(
≠≠! "
DateTime
≠≠" *!
fechaHoraReferencia
≠≠+ >
,
≠≠> ?
int
≠≠@ C
idTipoTurno
≠≠D O
)
≠≠O P
{
ÆÆ 	
var
ØØ !
soloFechaReferencia
ØØ #
=
ØØ$ %!
fechaHoraReferencia
ØØ& 9
.
ØØ9 :
Date
ØØ: >
;
ØØ> ?
var
∞∞ 
turnos
∞∞ 
=
∞∞ 
_db
∞∞ 
.
∞∞ 
Turno
∞∞ "
.
∞∞" #
Where
∞∞# (
(
∞∞( )
t
∞∞) *
=>
∞∞+ -
t
∞∞. /
.
∞∞/ 0
id_tipo
∞∞0 7
==
∞∞8 :
idTipoTurno
∞∞; F
)
∞∞F G
.
∞∞G H
ToList
∞∞H N
(
∞∞N O
)
∞∞O P
;
∞∞P Q
var
±± 
turno
±± 
=
±± 
turnos
±± 
.
±± 
FirstOrDefault
±± -
(
±±- .
t
±±. /
=>
±±0 2!
fechaHoraReferencia
±±3 F
>=
±±G I!
soloFechaReferencia
±±J ]
.
±±] ^
Add
±±^ a
(
±±a b
t
±±b c
.
±±c d
hora_inicio
±±d o
)
±±o p
&&
±±q s"
fechaHoraReferencia±±t á
<=±±à ä#
soloFechaReferencia±±ã û
.±±û ü
Add±±ü ¢
(±±¢ £
t±±£ §
.±±§ •
hora_inicio±±• ∞
)±±∞ ±
.±±± ≤
AddHours±±≤ ∫
(±±∫ ª
(±±ª º
double±±º ¬
)±±¬ √
t±±√ ƒ
.±±ƒ ≈
duracion_horas±±≈ ”
)±±” ‘
)±±‘ ’
;±±’ ÷
return
≤≤ 
turno
≤≤ 
;
≤≤ 
}
≥≥ 	
public
µµ 
List
µµ 
<
µµ 
Turno
µµ 
>
µµ 
ObtenerTurnos
µµ (
(
µµ( )
int
µµ) ,
idTipoDeTurno
µµ- :
)
µµ: ;
{
∂∂ 	
return
∑∑ 
_db
∑∑ 
.
∑∑ 
Turno
∑∑ 
.
∑∑ 
Where
∑∑ "
(
∑∑" #
t
∑∑# $
=>
∑∑% '
t
∑∑( )
.
∑∑) *
id_tipo
∑∑* 1
==
∑∑2 4
idTipoDeTurno
∑∑5 B
)
∑∑B C
.
∑∑C D
ToList
∑∑D J
(
∑∑J K
)
∑∑K L
;
∑∑L M
}
∏∏ 	
public
ΩΩ 
bool
ΩΩ *
ExisteNombreDeDetalleMaestro
ΩΩ 0
(
ΩΩ0 1
int
ΩΩ1 4
	idMaestro
ΩΩ5 >
,
ΩΩ> ?
string
ΩΩ@ F
nombre
ΩΩG M
,
ΩΩM N
bool
ΩΩO S
	esVigente
ΩΩT ]
)
ΩΩ] ^
{
ææ 	
try
øø 
{
¿¿ 
return
¡¡ 
_db
¡¡ 
.
¡¡ 
Detalle_maestro
¡¡ *
.
¡¡* +
Where
¡¡+ 0
(
¡¡0 1
dm
¡¡1 3
=>
¡¡4 6
dm
¡¡7 9
.
¡¡9 :

id_maestro
¡¡: D
==
¡¡E G
	idMaestro
¡¡H Q
&&
¡¡R T
dm
¡¡U W
.
¡¡W X
nombre
¡¡X ^
==
¡¡_ a
nombre
¡¡b h
&&
¡¡i k
dm
¡¡l n
.
¡¡n o

es_vigente
¡¡o y
==
¡¡z |
	esVigente¡¡} Ü
)¡¡Ü á
.¡¡á à
Any¡¡à ã
(¡¡ã å
)¡¡å ç
;¡¡ç é
}
¬¬ 
catch
√√ 
(
√√ 
	Exception
√√ 
e
√√ 
)
√√ 
{
ƒƒ 
throw
≈≈ 
new
≈≈ 
DatosException
≈≈ (
(
≈≈( )
$str
≈≈) e
,
≈≈e f
e
≈≈g h
)
≈≈h i
;
≈≈i j
}
∆∆ 
}
«« 	
public
»» 
int
»» %
ObtenerIdDetalleMaestro
»» *
(
»»* +
int
»»+ .
	idMaestro
»»/ 8
,
»»8 9
string
»»: @
codigo
»»A G
,
»»G H
bool
»»I M
	esVigente
»»N W
)
»»W X
{
…… 	
try
   
{
ÀÀ 
return
ÃÃ 
_db
ÃÃ 
.
ÃÃ 
Detalle_maestro
ÃÃ *
.
ÃÃ* +
SingleOrDefault
ÃÃ+ :
(
ÃÃ: ;
dm
ÃÃ; =
=>
ÃÃ> @
dm
ÃÃA C
.
ÃÃC D

id_maestro
ÃÃD N
==
ÃÃO Q
	idMaestro
ÃÃR [
&&
ÃÃ\ ^
dm
ÃÃ_ a
.
ÃÃa b
codigo
ÃÃb h
==
ÃÃi k
codigo
ÃÃl r
&&
ÃÃs u
dm
ÃÃv x
.
ÃÃx y

es_vigenteÃÃy É
==ÃÃÑ Ü
	esVigenteÃÃá ê
)ÃÃê ë
.ÃÃë í
idÃÃí î
;ÃÃî ï
}
ÕÕ 
catch
ŒŒ 
(
ŒŒ 
	Exception
ŒŒ 
e
ŒŒ 
)
ŒŒ 
{
œœ 
throw
–– 
new
–– 
DatosException
–– (
(
––( )
$str
––) R
,
––R S
e
––T U
)
––U V
;
––V W
}
—— 
}
““ 	
public
’’ 
Tipo_cambio
’’ 
ObtenerTipoCambio
’’ ,
(
’’, -
int
’’- 0
idMoneda
’’1 9
,
’’9 :
DateTime
’’; C
fechaActual
’’D O
)
’’O P
{
÷÷ 	
try
◊◊ 
{
ÿÿ 
return
ŸŸ 
_db
ŸŸ 
.
ŸŸ 
Tipo_cambio
ŸŸ &
.
ŸŸ& '
SingleOrDefault
ŸŸ' 6
(
ŸŸ6 7
tc
ŸŸ7 9
=>
ŸŸ: <
tc
ŸŸ= ?
.
ŸŸ? @
idMoneda
ŸŸ@ H
==
ŸŸI K
idMoneda
ŸŸL T
&&
ŸŸU W
tc
ŸŸX Z
.
ŸŸZ [
fecha
ŸŸ[ `
==
ŸŸa c
fechaActual
ŸŸd o
)
ŸŸo p
;
ŸŸp q
}
⁄⁄ 
catch
€€ 
(
€€ 
	Exception
€€ 
e
€€ 
)
€€ 
{
‹‹ 
throw
›› 
new
›› 
DatosException
›› (
(
››( )
$str
››) M
,
››M N
e
››O P
)
››P Q
;
››Q R
}
ﬁﬁ 
}
ﬂﬂ 	
public
‡‡ 
OperationResult
‡‡ 
GuardarTipoCambio
‡‡ 0
(
‡‡0 1
Tipo_cambio
‡‡1 <

tipoCambio
‡‡= G
)
‡‡G H
{
·· 	
try
‚‚ 
{
„„ 
_db
‰‰ 
.
‰‰ 
Tipo_cambio
‰‰ 
.
‰‰  
Add
‰‰  #
(
‰‰# $

tipoCambio
‰‰$ .
)
‰‰. /
;
‰‰/ 0
var
ÂÂ 
result
ÂÂ 
=
ÂÂ 
Save
ÂÂ !
(
ÂÂ! "
)
ÂÂ" #
;
ÂÂ# $
result
ÊÊ 
.
ÊÊ 
data
ÊÊ 
=
ÊÊ 

tipoCambio
ÊÊ (
.
ÊÊ( )
id
ÊÊ) +
;
ÊÊ+ ,
return
ÁÁ 
result
ÁÁ 
;
ÁÁ 
}
ËË 
catch
ÈÈ 
(
ÈÈ 
	Exception
ÈÈ 
e
ÈÈ 
)
ÈÈ 
{
ÍÍ 
throw
ÎÎ 
new
ÎÎ 
DatosException
ÎÎ (
(
ÎÎ( )
$str
ÎÎ) M
,
ÎÎM N
e
ÎÎO P
)
ÎÎP Q
;
ÎÎQ R
}
ÏÏ 
}
ÌÌ 	
public
ÓÓ 
IEnumerable
ÓÓ 
<
ÓÓ 
Detalle_maestro
ÓÓ *
>
ÓÓ* +'
ObtenerDetallesPorFamilia
ÓÓ, E
(
ÓÓE F
int
ÓÓF I
	idFamilia
ÓÓJ S
)
ÓÓS T
{
ÔÔ 	
try
 
{
ÒÒ 
return
ÚÚ 
_db
ÚÚ 
.
ÚÚ %
Caracteristica_concepto
ÚÚ 2
.
ÚÚ2 3
Where
ÚÚ3 8
(
ÚÚ8 9
dm
ÚÚ9 ;
=>
ÚÚ< >
dm
ÚÚ? A
.
ÚÚA B
id_concepto
ÚÚB M
==
ÚÚN P
	idFamilia
ÚÚQ Z
)
ÚÚZ [
.
ÚÚ[ \
Select
ÚÚ\ b
(
ÚÚb c
dm
ÚÚc e
=>
ÚÚf h
dm
ÚÚi k
.
ÚÚk l
Detalle_maestro1
ÚÚl |
)
ÚÚ| }
.
ÚÚ} ~
WhereÚÚ~ É
(ÚÚÉ Ñ
dmÚÚÑ Ü
=>ÚÚá â
dmÚÚä å
.ÚÚå ç

es_vigenteÚÚç ó
)ÚÚó ò
;ÚÚò ô
}
ÛÛ 
catch
ÙÙ 
(
ÙÙ 
	Exception
ÙÙ 
e
ÙÙ 
)
ÙÙ 
{
ıı 
throw
ˆˆ 
new
ˆˆ 
DatosException
ˆˆ (
(
ˆˆ( )
$str
ˆˆ) L
,
ˆˆL M
e
ˆˆN O
)
ˆˆO P
;
ˆˆP Q
}
˜˜ 
}
¯¯ 	
}
˘˘ 
}˙˙ „Ù
JD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\ConceptoDatos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
{ 
public 

class 
ConceptoDatos 
:  
RepositorioBase! 0
,0 1 
IConceptoRepositorio2 F
{ 
public 
OperationResult "
CrearConceptoDeNegocio 5
(5 6
Concepto_negocio6 F
ConceptoDeNegocioG X
)X Y
{ 	
try 
{ 
_db 
. 
Concepto_negocio $
.$ %
Add% (
(( )
ConceptoDeNegocio) :
): ;
;; <
var 
	resultado 
= 
Save  $
($ %
)% &
;& '
	resultado 
. 
data 
=  
ConceptoDeNegocio! 2
.2 3
id3 5
;5 6
return 
	resultado  
;  !
} 
catch   
(   
	Exception   
e   
)   
{!! 
throw"" 
e"" 
;"" 
}## 
}%% 	
public'' 
OperationResult'' %
CrearConceptoDeNegocioRol'' 8
(''8 9 
Concepto_negocio_rol''9 M 
ConceptoDeNegocioRol''N b
)''b c
{(( 	
try)) 
{** 
_db++ 
.++  
Concepto_negocio_rol++ (
.++( )
Add++) ,
(++, - 
ConceptoDeNegocioRol++- A
)++A B
;++B C
var,, 
	resultado,, 
=,, 
Save,,  $
(,,$ %
),,% &
;,,& '
	resultado-- 
.-- 
data-- 
=--   
ConceptoDeNegocioRol--! 5
.--5 6
id--6 8
;--8 9
return.. 
	resultado..  
;..  !
}// 
catch00 
(00 
	Exception00 
e00 
)00 
{11 
throw22 
e22 
;22 
}33 
}55 	
public77 
OperationResult77 %
ActualizarConceptoNegocio77 8
(778 9
Concepto_negocio779 I
conceptoNegocio_upd77J ]
)77] ^
{88 	
try99 
{:: 
Concepto_negocio;;  
conceptoNegocio_bd;;! 3
=;;4 5
_db;;6 9
.;;9 :
Concepto_negocio;;: J
.;;J K
Include;;K R
(;;R S
cn;;S U
=>;;V X
cn;;Y [
.;;[ \&
Parametro_concepto_negocio;;\ v
);;v w
.;;w x
Single;;x ~
(;;~ 
cn	;; Å
=>
;;Ç Ñ
cn
;;Ö á
.
;;á à
id
;;à ä
==
;;ã ç!
conceptoNegocio_upd
;;é °
.
;;° ¢
id
;;¢ §
)
;;§ •
;
;;• ¶
_db== 
.== 
Entry== 
(== 
conceptoNegocio_bd== ,
)==, -
.==- .
CurrentValues==. ;
.==; <
	SetValues==< E
(==E F
conceptoNegocio_upd==F Y
)==Y Z
;==Z [
List@@ 
<@@ 1
%Valor_caracteristica_concepto_negocio@@ :
>@@: ;
valores_upd@@< G
=@@H I
conceptoNegocio_upd@@J ]
.@@] ^2
%Valor_caracteristica_concepto_negocio	@@^ É
.
@@É Ñ
ToList
@@Ñ ä
(
@@ä ã
)
@@ã å
;
@@å ç
ListAA 
<AA 1
%Valor_caracteristica_concepto_negocioAA :
>AA: ;

valores_bdAA< F
=AAG H
conceptoNegocio_bdAAI [
.AA[ \2
%Valor_caracteristica_concepto_negocio	AA\ Å
.
AAÅ Ç
ToList
AAÇ à
(
AAà â
)
AAâ ä
;
AAä ã
foreachCC 
(CC 
varCC 
valor_bdCC %
inCC& (

valores_bdCC) 3
)CC3 4
{DD 
ifFF 
(FF 
!FF 
valores_updFF $
.FF$ %
AnyFF% (
(FF( )
vFF) *
=>FF+ -
vFF. /
.FF/ 0#
id_valor_caracteristicaFF0 G
==FFH J
valor_bdFFK S
.FFS T#
id_valor_caracteristicaFFT k
)FFk l
)FFl m
{GG 
_dbHH 
.HH 1
%Valor_caracteristica_concepto_negocioHH A
.HHA B
RemoveHHB H
(HHH I
valor_bdHHI Q
)HHQ R
;HHR S
}II 
}JJ 
foreachLL 
(LL 
varLL 
	valor_updLL &
inLL' )
valores_updLL* 5
)LL5 6
{MM 
ifNN 
(NN 
!NN 

valores_bdNN #
.NN# $
AnyNN$ '
(NN' (
vNN( )
=>NN* ,
vNN- .
.NN. /#
id_valor_caracteristicaNN/ F
==NNG I
	valor_updNNJ S
.NNS T#
id_valor_caracteristicaNNT k
)NNk l
)NNl m
{OO 
_dbPP 
.PP 1
%Valor_caracteristica_concepto_negocioPP A
.PPA B
AddPPB E
(PPE F
	valor_updPPF O
)PPO P
;PPP Q
}QQ 
}RR 
FotoTT 
foto_updTT 
=TT 
conceptoNegocio_updTT  3
.TT3 4
FotoTT4 8
!=TT9 ;
nullTT< @
?TTA B
conceptoNegocio_updTTC V
.TTV W
FotoTTW [
:TT\ ]
nullTT^ b
;TTb c
FotoUU 
foto_bdUU 
=UU 
conceptoNegocio_bdUU 1
.UU1 2
FotoUU2 6
!=UU7 9
nullUU: >
?UU? @
conceptoNegocio_bdUUA S
.UUS T
FotoUUT X
:UUY Z
nullUU[ _
;UU_ `
ifWW 
(WW 
foto_updWW 
!=WW 
nullWW  $
)WW$ %
{XX 
ifYY 
(YY 
foto_bdYY 
!=YY  "
nullYY# '
&&YY( *
foto_bdYY+ 2
.YY2 3
imagenYY3 9
!=YY: <
foto_updYY= E
.YYE F
imagenYYF L
)YYL M
{ZZ 
foto_upd[[  
.[[  !
id[[! #
=[[$ %
foto_bd[[& -
.[[- .
id[[. 0
;[[0 1
_db\\ 
.\\ 
Entry\\ !
(\\! "
foto_bd\\" )
)\\) *
.\\* +
CurrentValues\\+ 8
.\\8 9
	SetValues\\9 B
(\\B C
foto_upd\\C K
)\\K L
;\\L M
}]] 
else^^ 
{__ 
_db`` 
.`` 
Foto``  
.``  !
Add``! $
(``$ %
foto_upd``% -
)``- .
;``. /
conceptoNegocio_bdaa *
.aa* +
Fotoaa+ /
=aa0 1
foto_updaa2 :
;aa: ;
}cc 
}dd 
Listii 
<ii &
Parametro_concepto_negocioii /
>ii/ 0
dbParametrosii1 =
=ii> ?
conceptoNegocio_bdii@ R
.iiR S&
Parametro_concepto_negocioiiS m
.iim n
ToListiin t
(iit u
)iiu v
;iiv w
Listjj 
<jj &
Parametro_concepto_negociojj /
>jj/ 0
updParametrosjj1 >
=jj? @
conceptoNegocio_updjjA T
.jjT U&
Parametro_concepto_negociojjU o
.jjo p
ToListjjp v
(jjv w
)jjw x
;jjx y
foreachkk 
(kk 
varkk 
dbParametrokk (
inkk) +
dbParametroskk, 8
)kk8 9
{ll 
ifnn 
(nn 
updParametrosnn %
.nn% &
Anynn& )
(nn) *
pnn* +
=>nn, .
pnn/ 0
.nn0 1
id_parametronn1 =
==nn> @
dbParametronnA L
.nnL M
id_parametronnM Y
)nnY Z
)nnZ [
{oo 
dbParametropp #
.pp# $
id_valor_parametropp$ 6
=pp7 8
updParametrospp9 F
.ppF G
SingleppG M
(ppM N
panppN Q
=>ppR T
panppU X
.ppX Y
id_parametroppY e
==ppf h
dbParametroppi t
.ppt u
id_parametro	ppu Å
)
ppÅ Ç
.
ppÇ É 
id_valor_parametro
ppÉ ï
;
ppï ñ
dbParametroqq #
.qq# $
valorqq$ )
=qq* +
updParametrosqq, 9
.qq9 :
Singleqq: @
(qq@ A
panqqA D
=>qqE G
panqqH K
.qqK L
id_parametroqqL X
==qqY [
dbParametroqq\ g
.qqg h
id_parametroqqh t
)qqt u
.qqu v
valorqqv {
;qq{ |
}rr 
elsess 
{tt 
_dbuu 
.uu &
Parametro_concepto_negociouu 6
.uu6 7
Removeuu7 =
(uu= >
dbParametrouu> I
)uuI J
;uuJ K
}vv 
}ww 
foreachyy 
(yy 
varyy 
updParametroyy )
inyy* ,
updParametrosyy- :
)yy: ;
{zz 
if{{ 
({{ 
!{{ 
dbParametros{{ %
.{{% &
Any{{& )
({{) *
p{{* +
=>{{, .
p{{/ 0
.{{0 1
id_parametro{{1 =
=={{> @
updParametro{{A M
.{{M N
id_parametro{{N Z
){{Z [
){{[ \
{|| 
_db}} 
.}} &
Parametro_concepto_negocio}} 6
.}}6 7
Add}}7 :
(}}: ;
updParametro}}; G
)}}G H
;}}H I
}~~ 
} 
List
ÇÇ 
<
ÇÇ "
Concepto_negocio_rol
ÇÇ )
>
ÇÇ) *
	roles_upd
ÇÇ+ 4
=
ÇÇ5 6!
conceptoNegocio_upd
ÇÇ7 J
.
ÇÇJ K"
Concepto_negocio_rol
ÇÇK _
.
ÇÇ_ `
ToList
ÇÇ` f
(
ÇÇf g
)
ÇÇg h
;
ÇÇh i
List
ÉÉ 
<
ÉÉ "
Concepto_negocio_rol
ÉÉ )
>
ÉÉ) *
roles_bd
ÉÉ+ 3
=
ÉÉ4 5 
conceptoNegocio_bd
ÉÉ6 H
.
ÉÉH I"
Concepto_negocio_rol
ÉÉI ]
.
ÉÉ] ^
ToList
ÉÉ^ d
(
ÉÉd e
)
ÉÉe f
;
ÉÉf g
foreach
ÖÖ 
(
ÖÖ 
var
ÖÖ 
rol_bd
ÖÖ #
in
ÖÖ$ &
roles_bd
ÖÖ' /
)
ÖÖ/ 0
{
ÜÜ 
if
àà 
(
àà 
!
àà 
	roles_upd
àà "
.
àà" #
Any
àà# &
(
àà& '
v
àà' (
=>
àà) +
v
àà, -
.
àà- .
id_rol
àà. 4
==
àà5 7
rol_bd
àà8 >
.
àà> ?
id_rol
àà? E
)
ààE F
)
ààF G
{
ââ 
_db
ää 
.
ää "
Concepto_negocio_rol
ää 0
.
ää0 1
Remove
ää1 7
(
ää7 8
rol_bd
ää8 >
)
ää> ?
;
ää? @
}
ãã 
}
åå 
foreach
éé 
(
éé 
var
éé 
rol_upd
éé $
in
éé% '
	roles_upd
éé( 1
)
éé1 2
{
èè 
if
êê 
(
êê 
!
êê 
roles_bd
êê !
.
êê! "
Any
êê" %
(
êê% &
v
êê& '
=>
êê( *
v
êê+ ,
.
êê, -
id_rol
êê- 3
==
êê4 6
rol_upd
êê7 >
.
êê> ?
id_rol
êê? E
)
êêE F
)
êêF G
{
ëë 
_db
íí 
.
íí "
Concepto_negocio_rol
íí 0
.
íí0 1
Add
íí1 4
(
íí4 5
rol_upd
íí5 <
)
íí< =
;
íí= >
}
ìì 
}
îî 
return
ïï 
Save
ïï 
(
ïï 
)
ïï 
;
ïï 
}
ññ 
catch
óó 
(
óó 
	Exception
óó 
e
óó 
)
óó 
{
òò 
throw
ôô 
e
ôô 
;
ôô 
}
öö 
}
õõ 	
public
úú 
OperationResult
úú .
 ActualizarNombreConceptosNegocio
úú ?
(
úú? @
List
úú@ D
<
úúD E
Concepto_negocio
úúE U
>
úúU V
conceptosNegocio
úúW g
)
úúg h
{
ùù 	
try
ûû 
{
üü 
foreach
†† 
(
†† 
var
†† 
conceptoNegocio
†† ,
in
††- /
conceptosNegocio
††0 @
)
††@ A
{
°° 
Concepto_negocio
¢¢ $ 
conceptoNegocio_bd
¢¢% 7
=
¢¢8 9
_db
¢¢: =
.
¢¢= >
Concepto_negocio
¢¢> N
.
¢¢N O
Single
¢¢O U
(
¢¢U V
cn
¢¢V X
=>
¢¢Y [
cn
¢¢\ ^
.
¢¢^ _
id
¢¢_ a
==
¢¢b d
conceptoNegocio
¢¢e t
.
¢¢t u
id
¢¢u w
)
¢¢w x
;
¢¢x y 
conceptoNegocio_bd
££ &
.
££& '
nombre
££' -
=
££. /
conceptoNegocio
££0 ?
.
££? @
nombre
££@ F
;
££F G
_db
§§ 
.
§§ 
Entry
§§ 
(
§§  
conceptoNegocio_bd
§§ 0
)
§§0 1
.
§§1 2
Property
§§2 :
(
§§: ;
x
§§; <
=>
§§= ?
x
§§@ A
.
§§A B
nombre
§§B H
)
§§H I
.
§§I J

IsModified
§§J T
=
§§U V
true
§§W [
;
§§[ \
}
•• 
var
¶¶ 
result
¶¶ 
=
¶¶ 
Save
¶¶ !
(
¶¶! "
)
¶¶" #
;
¶¶# $
return
ßß 
result
ßß 
;
ßß 
}
®® 
catch
©© 
(
©© 
	Exception
©© 
e
©© 
)
©© 
{
™™ 
throw
´´ 
new
´´ 
DatosException
´´ (
(
´´( )
$str
´´) d
,
´´d e
e
´´f g
)
´´g h
;
´´h i
}
¨¨ 
}
≠≠ 	
public
ÆÆ 
OperationResult
ÆÆ  
ActualizarConcepto
ÆÆ 1
(
ÆÆ1 2
Detalle_maestro
ÆÆ2 A
concepto_upd
ÆÆB N
)
ÆÆN O
{
ØØ 	
try
∞∞ 
{
±± 
Detalle_maestro
≤≤ 
concepto_bd
≤≤  +
=
≤≤, -
_db
≤≤. 1
.
≤≤1 2
Detalle_maestro
≤≤2 A
.
≤≤A B
Single
≤≤B H
(
≤≤H I
dm
≤≤I K
=>
≤≤L N
dm
≤≤O Q
.
≤≤Q R
id
≤≤R T
==
≤≤U W
concepto_upd
≤≤X d
.
≤≤d e
id
≤≤e g
)
≤≤g h
;
≤≤h i
concepto_upd
≥≥ 
.
≥≥ 
fecha_registro
≥≥ +
=
≥≥, -
concepto_bd
≥≥. 9
.
≥≥9 :
fecha_registro
≥≥: H
;
≥≥H I
_db
¥¥ 
.
¥¥ 
Entry
¥¥ 
(
¥¥ 
concepto_bd
¥¥ %
)
¥¥% &
.
¥¥& '
CurrentValues
¥¥' 4
.
¥¥4 5
	SetValues
¥¥5 >
(
¥¥> ?
concepto_upd
¥¥? K
)
¥¥K L
;
¥¥L M
List
∂∂ 
<
∂∂  
Categoria_concepto
∂∂ '
>
∂∂' (
categorias_upd
∂∂) 7
=
∂∂8 9
concepto_upd
∂∂: F
.
∂∂F G 
Categoria_concepto
∂∂G Y
.
∂∂Y Z
ToList
∂∂Z `
(
∂∂` a
)
∂∂a b
;
∂∂b c
List
∑∑ 
<
∑∑  
Categoria_concepto
∑∑ '
>
∑∑' (
categorias_bd
∑∑) 6
=
∑∑7 8
concepto_bd
∑∑9 D
.
∑∑D E 
Categoria_concepto
∑∑E W
.
∑∑W X
ToList
∑∑X ^
(
∑∑^ _
)
∑∑_ `
;
∑∑` a
foreach
ππ 
(
ππ 
var
ππ 
categoria_bd
ππ )
in
ππ* ,
categorias_bd
ππ- :
)
ππ: ;
{
∫∫ 
if
ºº 
(
ºº 
!
ºº 
categorias_upd
ºº '
.
ºº' (
Any
ºº( +
(
ºº+ ,
d
ºº, -
=>
ºº. 0
d
ºº1 2
.
ºº2 3
id_categoria
ºº3 ?
==
ºº@ B
categoria_bd
ººC O
.
ººO P
id_categoria
ººP \
&&
ºº] _
d
ºº` a
.
ººa b
id_concepto
ººb m
==
ººn p
categoria_bd
ººq }
.
ºº} ~
id_conceptoºº~ â
)ººâ ä
)ººä ã
{
ΩΩ 
_db
ææ 
.
ææ  
Categoria_concepto
ææ .
.
ææ. /
Remove
ææ/ 5
(
ææ5 6
categoria_bd
ææ6 B
)
ææB C
;
ææC D
}
øø 
}
¿¿ 
foreach
¬¬ 
(
¬¬ 
var
¬¬ 
categoria_upd
¬¬ *
in
¬¬+ -
categorias_upd
¬¬. <
)
¬¬< =
{
√√ 
if
ƒƒ 
(
ƒƒ 
!
ƒƒ 
categorias_bd
ƒƒ &
.
ƒƒ& '
Any
ƒƒ' *
(
ƒƒ* +
d
ƒƒ+ ,
=>
ƒƒ- /
d
ƒƒ0 1
.
ƒƒ1 2
id_categoria
ƒƒ2 >
==
ƒƒ? A
categoria_upd
ƒƒB O
.
ƒƒO P
id_categoria
ƒƒP \
&&
ƒƒ] _
d
ƒƒ` a
.
ƒƒa b
id_concepto
ƒƒb m
==
ƒƒn p
categoria_upd
ƒƒq ~
.
ƒƒ~ 
id_conceptoƒƒ ä
)ƒƒä ã
)ƒƒã å
{
≈≈ 
_db
∆∆ 
.
∆∆  
Categoria_concepto
∆∆ .
.
∆∆. /
Add
∆∆/ 2
(
∆∆2 3
categoria_upd
∆∆3 @
)
∆∆@ A
;
∆∆A B
}
«« 
}
»» 
List
…… 
<
…… %
Caracteristica_concepto
…… ,
>
……, -!
caracteristicas_upd
……. A
=
……B C
concepto_upd
……D P
.
……P Q%
Caracteristica_concepto
……Q h
.
……h i
ToList
……i o
(
……o p
)
……p q
;
……q r
List
   
<
   %
Caracteristica_concepto
   ,
>
  , - 
caracteristicas_bd
  . @
=
  A B
concepto_bd
  C N
.
  N O%
Caracteristica_concepto
  O f
.
  f g
ToList
  g m
(
  m n
)
  n o
;
  o p
foreach
ÃÃ 
(
ÃÃ 
var
ÃÃ 
caracteristica_bd
ÃÃ .
in
ÃÃ/ 1 
caracteristicas_bd
ÃÃ2 D
)
ÃÃD E
{
ÕÕ 
if
œœ 
(
œœ 
!
œœ !
caracteristicas_upd
œœ ,
.
œœ, -
Any
œœ- 0
(
œœ0 1
d
œœ1 2
=>
œœ3 5
d
œœ6 7
.
œœ7 8
id_caracteristica
œœ8 I
==
œœJ L
caracteristica_bd
œœM ^
.
œœ^ _
id_caracteristica
œœ_ p
&&
œœq s
d
œœt u
.
œœu v
id_conceptoœœv Å
==œœÇ Ñ!
caracteristica_bdœœÖ ñ
.œœñ ó
id_conceptoœœó ¢
)œœ¢ £
)œœ£ §
{
–– 
_db
—— 
.
—— %
Caracteristica_concepto
—— 3
.
——3 4
Remove
——4 :
(
——: ;
caracteristica_bd
——; L
)
——L M
;
——M N
}
““ 
}
”” 
foreach
’’ 
(
’’ 
var
’’  
caracteristica_upd
’’ /
in
’’0 2!
caracteristicas_upd
’’3 F
)
’’F G
{
÷÷ 
if
◊◊ 
(
◊◊ 
!
◊◊  
caracteristicas_bd
◊◊ +
.
◊◊+ ,
Any
◊◊, /
(
◊◊/ 0
d
◊◊0 1
=>
◊◊2 4
d
◊◊5 6
.
◊◊6 7
id_caracteristica
◊◊7 H
==
◊◊I K 
caracteristica_upd
◊◊L ^
.
◊◊^ _
id_caracteristica
◊◊_ p
&&
◊◊q s
d
◊◊t u
.
◊◊u v
id_concepto◊◊v Å
==◊◊Ç Ñ"
caracteristica_upd◊◊Ö ó
.◊◊ó ò
id_concepto◊◊ò £
)◊◊£ §
)◊◊§ •
{
ÿÿ 
_db
ŸŸ 
.
ŸŸ %
Caracteristica_concepto
ŸŸ 3
.
ŸŸ3 4
Add
ŸŸ4 7
(
ŸŸ7 8 
caracteristica_upd
ŸŸ8 J
)
ŸŸJ K
;
ŸŸK L
}
⁄⁄ 
}
€€ 
var
›› 
	resultado
›› 
=
›› 
Save
››  $
(
››$ %
)
››% &
;
››& '
	resultado
ﬁﬁ 
.
ﬁﬁ 
data
ﬁﬁ 
=
ﬁﬁ  
concepto_upd
ﬁﬁ! -
.
ﬁﬁ- .
id
ﬁﬁ. 0
;
ﬁﬁ0 1
return
ﬂﬂ 
	resultado
ﬂﬂ  
;
ﬂﬂ  !
}
‡‡ 
catch
·· 
(
·· 
	Exception
·· 
e
·· 
)
·· 
{
‚‚ 
throw
„„ 
e
„„ 
;
„„ 
}
‰‰ 
}
ÂÂ 	
public
ÁÁ 
OperationResult
ÁÁ &
DarDeBajaConceptoNegocio
ÁÁ 7
(
ÁÁ7 8
int
ÁÁ8 ;
idConceptoNegocio
ÁÁ< M
)
ÁÁM N
{
ËË 	
try
ÈÈ 
{
ÍÍ 
var
ÏÏ 
dbConceptoNegocio
ÏÏ %
=
ÏÏ& '
_db
ÏÏ( +
.
ÏÏ+ ,
Concepto_negocio
ÏÏ, <
.
ÏÏ< =
FirstOrDefault
ÏÏ= K
(
ÏÏK L
an
ÏÏL N
=>
ÏÏO Q
an
ÏÏR T
.
ÏÏT U
id
ÏÏU W
==
ÏÏX Z
idConceptoNegocio
ÏÏ[ l
)
ÏÏl m
;
ÏÏm n
dbConceptoNegocio
ÌÌ !
.
ÌÌ! "

es_vigente
ÌÌ" ,
=
ÌÌ- .
false
ÌÌ/ 4
;
ÌÌ4 5
dbConceptoNegocio
ÔÔ !
.
ÔÔ! "

fecha_baja
ÔÔ" ,
=
ÔÔ- .
DateTimeUtil
ÔÔ/ ;
.
ÔÔ; <
FechaActual
ÔÔ< G
(
ÔÔG H
)
ÔÔH I
;
ÔÔI J
var
ÒÒ 
detalles
ÒÒ 
=
ÒÒ 
_db
ÒÒ "
.
ÒÒ" #!
Detalle_transaccion
ÒÒ# 6
.
ÒÒ6 7
RemoveRange
ÒÒ7 B
(
ÒÒB C
_db
ÒÒC F
.
ÒÒF G
Transaccion
ÒÒG R
.
ÒÒR S
Where
ÒÒS X
(
ÒÒX Y
t
ÒÒY Z
=>
ÒÒ[ ]
t
ÒÒ^ _
.
ÒÒ_ `!
id_tipo_transaccion
ÒÒ` s
==
ÒÒt v"
TransaccionSettingsÒÒw ä
.ÒÒä ã
DefaultÒÒã í
.ÒÒí ì1
!IdTipoTransaccionInventarioActualÒÒì ¥
)ÒÒ¥ µ
.ÒÒµ ∂

SelectManyÒÒ∂ ¿
(ÒÒ¿ ¡
tÒÒ¡ ¬
=>ÒÒ√ ≈
tÒÒ∆ «
.ÒÒ« »#
Detalle_transaccionÒÒ» €
)ÒÒ€ ‹
.ÒÒ‹ ›
WhereÒÒ› ‚
(ÒÒ‚ „
dtÒÒ„ Â
=>ÒÒÊ Ë
dtÒÒÈ Î
.ÒÒÎ Ï#
id_concepto_negocioÒÒÏ ˇ
==ÒÒÄ Ç!
idConceptoNegocioÒÒÉ î
)ÒÒî ï
)ÒÒï ñ
;ÒÒñ ó
return
ÚÚ 
Save
ÚÚ 
(
ÚÚ 
)
ÚÚ 
;
ÚÚ 
}
ÛÛ 
catch
ÙÙ 
(
ÙÙ 
	Exception
ÙÙ 
e
ÙÙ 
)
ÙÙ 
{
ıı 
throw
ˆˆ 
new
ˆˆ 
DatosException
ˆˆ (
(
ˆˆ( )
$str
ˆˆ) O
,
ˆˆO P
e
ˆˆQ R
)
ˆˆR S
;
ˆˆS T
}
˜˜ 
}
¯¯ 	
public
¸¸ 
bool
¸¸ '
TieneStockConceptoNegocio
¸¸ -
(
¸¸- .
int
¸¸. 1
idConceptoNegocio
¸¸2 C
)
¸¸C D
{
˝˝ 	
try
˛˛ 
{
ˇˇ 
var
ÄÄ '
numeroInventarioMayorCero
ÄÄ -
=
ÄÄ. /
_db
ÄÄ0 3
.
ÄÄ3 4
Transaccion
ÄÄ4 ?
.
ÄÄ? @
Where
ÄÄ@ E
(
ÄÄE F
t
ÄÄF G
=>
ÄÄH J
t
ÄÄK L
.
ÄÄL M!
id_tipo_transaccion
ÄÄM `
==
ÄÄa c!
TransaccionSettings
ÄÄd w
.
ÄÄw x
Default
ÄÄx 
.ÄÄ Ä1
!IdTipoTransaccionInventarioActualÄÄÄ °
)ÄÄ° ¢
.ÄÄ¢ £

SelectManyÄÄ£ ≠
(ÄÄ≠ Æ
tÄÄÆ Ø
=>ÄÄ∞ ≤
tÄÄ≥ ¥
.ÄÄ¥ µ#
Detalle_transaccionÄÄµ »
)ÄÄ» …
.ÄÄ…  
WhereÄÄ  œ
(ÄÄœ –
dtÄÄ– “
=>ÄÄ” ’
dtÄÄ÷ ÿ
.ÄÄÿ Ÿ#
id_concepto_negocioÄÄŸ Ï
==ÄÄÌ Ô!
idConceptoNegocioÄÄ Å
)ÄÄÅ Ç
.ÄÄÇ É
WhereÄÄÉ à
(ÄÄà â
dtÄÄâ ã
=>ÄÄå é
dtÄÄè ë
.ÄÄë í
cantidadÄÄí ö
>ÄÄõ ú
$numÄÄù û
)ÄÄû ü
.ÄÄü †
CountÄÄ† •
(ÄÄ• ¶
)ÄÄ¶ ß
;ÄÄß ®
return
ÅÅ '
numeroInventarioMayorCero
ÅÅ 0
>
ÅÅ1 2
$num
ÅÅ3 4
;
ÅÅ4 5
}
ÇÇ 
catch
ÉÉ 
(
ÉÉ 
	Exception
ÉÉ 
e
ÉÉ 
)
ÉÉ 
{
ÑÑ 
throw
ÖÖ 
new
ÖÖ 
DatosException
ÖÖ (
(
ÖÖ( )
$str
ÖÖ) O
,
ÖÖO P
e
ÖÖQ R
)
ÖÖR S
;
ÖÖS T
}
ÜÜ 
}
àà 	
public
ââ 
OperationResult
ââ .
 InvertirEsVigenteConceptoNegocio
ââ ?
(
ââ? @
int
ââ@ C
idConceptoNegocio
ââD U
)
ââU V
{
ää 	
try
ãã 
{
åå 
var
éé 
dbConceptoNegocio
éé %
=
éé& '
_db
éé( +
.
éé+ ,
Concepto_negocio
éé, <
.
éé< =
FirstOrDefault
éé= K
(
ééK L
an
ééL N
=>
ééO Q
an
ééR T
.
ééT U
id
ééU W
==
ééX Z
idConceptoNegocio
éé[ l
)
éél m
;
éém n
dbConceptoNegocio
èè !
.
èè! "

es_vigente
èè" ,
=
èè- .
!
èè/ 0
dbConceptoNegocio
èè0 A
.
èèA B

es_vigente
èèB L
;
èèL M
return
êê 
Save
êê 
(
êê 
)
êê 
;
êê 
}
ëë 
catch
íí 
(
íí 
	Exception
íí 
e
íí 
)
íí 
{
ìì 
throw
îî 
new
îî 
DatosException
îî (
(
îî( )
$str
îî) O
,
îîO P
e
îîQ R
)
îîR S
;
îîS T
}
ïï 
}
óó 	
public
õõ 
IEnumerable
õõ 
<
õõ 
Concepto_negocio
õõ +
>
õõ+ ,-
ObtenerConceptosDeNegocioPorRol
õõ- L
(
õõL M
int
õõM P
idRol
õõQ V
)
õõV W
{
úú 	
try
ùù 
{
ûû 
return
üü 
_db
üü 
.
üü "
Concepto_negocio_rol
üü /
.
†† 
Include
††  
(
††  !
cnr
††! $
=>
††% '
cnr
††( +
.
††+ ,
Rol
††, /
)
††/ 0
.
°° 
Include
°°  
(
°°  !
cnr
°°! $
=>
°°% '
cnr
°°( +
.
°°+ ,
Concepto_negocio
°°, <
)
°°< =
.
¢¢ 
Include
¢¢  
(
¢¢  !
cnr
¢¢! $
=>
¢¢% '
cnr
¢¢( +
.
¢¢+ ,
Concepto_negocio
¢¢, <
.
¢¢< =
Detalle_maestro
¢¢= L
)
¢¢L M
.
££ 
Include
££  
(
££  !
cnr
££! $
=>
££% '
cnr
££( +
.
££+ ,
Concepto_negocio
££, <
.
££< =
Detalle_maestro4
££= M
)
££M N
.
§§ 
Where
§§ 
(
§§ 
cnr
§§ "
=>
§§# %
cnr
§§& )
.
§§) *
id_rol
§§* 0
==
§§1 3
idRol
§§4 9
&&
§§: <
cnr
§§= @
.
§§@ A
Concepto_negocio
§§A Q
.
§§Q R
Precio1
§§R Y
.
§§Y Z
Any
§§Z ]
(
§§] ^
)
§§^ _
)
§§_ `
.
§§` a
ToList
§§a g
(
§§g h
)
§§h i
.
•• 
Select
•• 
(
••  
cnr
••  #
=>
••$ &
cnr
••' *
.
••* +
Concepto_negocio
••+ ;
)
••; <
.
¶¶ 
Where
¶¶ 
(
¶¶ 
cnr
¶¶ "
=>
¶¶# %
cnr
¶¶& )
.
¶¶) *

es_vigente
¶¶* 4
)
¶¶4 5
;
¶¶5 6
}
ßß 
catch
®® 
(
®® 
	Exception
®® 
e
®® 
)
®® 
{
©© 
throw
™™ 
e
™™ 
;
™™ 
}
´´ 
}
¨¨ 	
public
ÆÆ 
IEnumerable
ÆÆ 
<
ÆÆ 
Concepto_negocio
ÆÆ +
>
ÆÆ+ ,#
ObtenerConceptoPorRol
ÆÆ- B
(
ÆÆB C
int
ÆÆC F
idRol
ÆÆG L
)
ÆÆL M
{
ØØ 	
throw
∞∞ 
new
∞∞ %
NotImplementedException
∞∞ -
(
∞∞- .
)
∞∞. /
;
∞∞/ 0
}
±± 	
public
≥≥ 
IEnumerable
≥≥ 
<
≥≥ 
Concepto_negocio
≥≥ +
>
≥≥+ ,J
<ObtenerConceptosDeNegocioPorRolIncluyendoExistenciasYPrecios
≥≥- i
(
≥≥i j
int
≥≥j m
idRol
≥≥n s
)
≥≥s t
{
¥¥ 	
try
µµ 
{
∂∂ 
return
∑∑ 
_db
∑∑ 
.
∑∑ "
Concepto_negocio_rol
∑∑ /
.
∑∑/ 0
Include
∑∑0 7
(
∑∑7 8
cnr
∑∑8 ;
=>
∑∑< >
cnr
∑∑? B
.
∑∑B C
Rol
∑∑C F
)
∑∑F G
.
∏∏ 
Include
∏∏ 
(
∏∏ 
cnr
∏∏  
=>
∏∏! #
cnr
∏∏$ '
.
∏∏' (
Concepto_negocio
∏∏( 8
.
∏∏8 9
Precio
∏∏9 ?
)
∏∏? @
.
ππ 
Include
ππ 
(
ππ 
cnr
ππ  
=>
ππ! #
cnr
ππ$ '
.
ππ' (
Concepto_negocio
ππ( 8
.
ππ8 93
%Valor_caracteristica_concepto_negocio
ππ9 ^
)
ππ^ _
.
∫∫ 
Include
∫∫ 
(
∫∫ 
cnr
∫∫  
=>
∫∫! #
cnr
∫∫$ '
.
∫∫' (
Concepto_negocio
∫∫( 8
.
∫∫8 9

Existencia
∫∫9 C
)
∫∫C D
.
ªª 
Where
ªª 
(
ªª 
cnr
ªª 
=>
ªª !
cnr
ªª" %
.
ªª% &
id_rol
ªª& ,
==
ªª- /
idRol
ªª0 5
)
ªª5 6
.
ºº 
Select
ºº 
(
ºº 
cnr
ºº 
=>
ºº  "
cnr
ºº# &
.
ºº& '
Concepto_negocio
ºº' 7
)
ºº7 8
;
ºº8 9
}
ΩΩ 
catch
ææ 
(
ææ 
	Exception
ææ 
e
ææ 
)
ææ 
{
øø 
throw
¿¿ 
e
¿¿ 
;
¿¿ 
}
¡¡ 
}
¬¬ 	
[
≈≈ 	
Obsolete
≈≈	 
(
≈≈ 
$str
≈≈ Z
,
≈≈Z [
true
≈≈\ `
)
≈≈` a
]
≈≈a b
public
∆∆ 
IEnumerable
∆∆ 
<
∆∆ 
Concepto_negocio
∆∆ +
>
∆∆+ ,A
3ObtenerConceptosDeNegocioPorRolIncluyendoExistencia
∆∆- `
(
∆∆` a
int
∆∆a d
idRol
∆∆e j
)
∆∆j k
{
«« 	
try
»» 
{
…… 
return
   
_db
   
.
   "
Concepto_negocio_rol
   /
.
ÀÀ 
Include
ÀÀ 
(
ÀÀ 
cnr
ÀÀ  
=>
ÀÀ! #
cnr
ÀÀ$ '
.
ÀÀ' (
Rol
ÀÀ( +
)
ÀÀ+ ,
.
ÃÃ 
Include
ÃÃ 
(
ÃÃ 
cnr
ÃÃ  
=>
ÃÃ! #
cnr
ÃÃ$ '
.
ÃÃ' (
Concepto_negocio
ÃÃ( 8
)
ÃÃ8 9
.
ÕÕ 
Include
ÕÕ 
(
ÕÕ 
cnr
ÕÕ  
=>
ÕÕ! #
cnr
ÕÕ$ '
.
ÕÕ' (
Concepto_negocio
ÕÕ( 8
.
ÕÕ8 9

Existencia
ÕÕ9 C
)
ÕÕC D
.
ŒŒ 
Include
ŒŒ 
(
ŒŒ 
cnr
ŒŒ  
=>
ŒŒ! #
cnr
ŒŒ$ '
.
ŒŒ' (
Concepto_negocio
ŒŒ( 8
.
ŒŒ8 9
Detalle_maestro
ŒŒ9 H
)
ŒŒH I
.
œœ 
Include
œœ 
(
œœ 
cnr
œœ  
=>
œœ! #
cnr
œœ$ '
.
œœ' (
Concepto_negocio
œœ( 8
.
œœ8 9
Detalle_maestro4
œœ9 I
)
œœI J
.
–– 
Where
–– 
(
–– 
cnr
–– 
=>
–– !
cnr
––" %
.
––% &
id_rol
––& ,
==
––- /
idRol
––0 5
)
––5 6
.
—— 
Select
—— 
(
—— 
cnr
—— 
=>
——  "
cnr
——# &
.
——& '
Concepto_negocio
——' 7
)
——7 8
.
““ 
Where
““ 
(
““ 
cn
““ 
=>
““  
cn
““! #
.
““# $

es_vigente
““$ .
)
““. /
.
““/ 0
ToList
““0 6
(
““6 7
)
““7 8
;
““8 9
}
”” 
catch
‘‘ 
(
‘‘ 
	Exception
‘‘ 
e
‘‘ 
)
‘‘ 
{
’’ 
throw
÷÷ 
e
÷÷ 
;
÷÷ 
}
◊◊ 
}
ÿÿ 	
public
⁄⁄ 
IEnumerable
⁄⁄ 
<
⁄⁄ #
Reporte_Stock_General
⁄⁄ 0
>
⁄⁄0 1(
ObtenerReporteStockGeneral
⁄⁄2 L
(
⁄⁄L M
int
⁄⁄M P
[
⁄⁄P Q
]
⁄⁄Q R$
idsActorNegocioInterno
⁄⁄S i
,
⁄⁄i j
int
⁄⁄k n)
idTipoTransaccionExistente⁄⁄o â
,⁄⁄â ä
int⁄⁄ã é2
"idUltimoEstadoTransaccionExsitente⁄⁄è ±
)⁄⁄± ≤
{
€€ 	
try
‹‹ 
{
›› 
var
ﬁﬁ 
result
ﬁﬁ 
=
ﬁﬁ 
_db
ﬁﬁ  
.
ﬁﬁ  !
Transaccion
ﬁﬁ! ,
.
ﬁﬁ, -
Where
ﬁﬁ- 2
(
ﬁﬁ2 3
t
ﬁﬁ3 4
=>
ﬁﬁ5 7$
idsActorNegocioInterno
ﬁﬁ8 N
.
ﬁﬁN O
Contains
ﬁﬁO W
(
ﬁﬁW X
t
ﬁﬁX Y
.
ﬁﬁY Z&
id_actor_negocio_interno
ﬁﬁZ r
)
ﬁﬁr s
&&
ﬂﬂ( *
t
ﬂﬂ+ ,
.
ﬂﬂ, -!
id_tipo_transaccion
ﬂﬂ- @
==
ﬂﬂA C(
idTipoTransaccionExistente
ﬂﬂD ^
&&
‡‡( *
t
‡‡+ ,
.
‡‡, - 
Estado_transaccion
‡‡- ?
.
‡‡? @
OrderByDescending
‡‡@ Q
(
‡‡Q R
est
‡‡R U
=>
‡‡V X
est
‡‡Y \
.
‡‡\ ]
id
‡‡] _
)
‡‡_ `
.
‡‡` a
FirstOrDefault
‡‡a o
(
‡‡o p
)
‡‡p q
.
‡‡q r
	id_estado
‡‡r {
==
‡‡| ~1
"idUltimoEstadoTransaccionExsitente‡‡ °
)‡‡° ¢
.
··( )

SelectMany
··) 3
(
··3 4
t
··4 5
=>
··6 8
t
··9 :
.
··: ;!
Detalle_transaccion
··; N
)
··N O
.
‚‚( )
Where
‚‚) .
(
‚‚. /
dt
‚‚/ 1
=>
‚‚2 4
dt
‚‚5 7
.
‚‚7 8
Concepto_negocio
‚‚8 H
.
‚‚H I

es_vigente
‚‚I S
)
‚‚S T
.
„„( )
Select
„„) /
(
„„/ 0
dt
„„0 2
=>
„„3 5
new
„„6 9#
Reporte_Stock_General
„„: O
(
„„O P
)
„„P Q
{
‰‰( )(
CodigoBarraConceptoNegocio
ÂÂ, F
=
ÂÂG H
dt
ÂÂI K
.
ÂÂK L
Concepto_negocio
ÂÂL \
.
ÂÂ\ ]
codigo_barra
ÂÂ] i
,
ÂÂi j#
NombreConceptoNegocio
ÊÊ, A
=
ÊÊB C
dt
ÊÊD F
.
ÊÊF G
Concepto_negocio
ÊÊG W
.
ÊÊW X
nombre
ÊÊX ^
,
ÊÊ^ _
UnidadMedida
ÁÁ, 8
=
ÁÁ9 :
dt
ÁÁ; =
.
ÁÁ= >
Concepto_negocio
ÁÁ> N
.
ÁÁN O
Detalle_maestro
ÁÁO ^
.
ÁÁ^ _
codigo
ÁÁ_ e
,
ÁÁe f
Lote
ËË, 0
=
ËË1 2
dt
ËË3 5
.
ËË5 6
lote
ËË6 :
,
ËË: ;
Stock
ÈÈ, 1
=
ÈÈ2 3
dt
ÈÈ4 6
.
ÈÈ6 7
cantidad
ÈÈ7 ?
,
ÈÈ? @
NombreConcepto
ÍÍ, :
=
ÍÍ; <
dt
ÍÍ= ?
.
ÍÍ? @
Concepto_negocio
ÍÍ@ P
.
ÍÍP Q
Detalle_maestro4
ÍÍQ a
.
ÍÍa b
nombre
ÍÍb h
,
ÍÍh i"
NombreCentroAtencion
ÎÎ, @
=
ÎÎA B
dt
ÎÎC E
.
ÎÎE F
Transaccion
ÎÎF Q
.
ÎÎQ R
Actor_negocio2
ÎÎR `
.
ÎÎ` a
Actor
ÎÎa f
.
ÎÎf g
primer_nombre
ÎÎg t
,
ÎÎt u
}
ÏÏ( )
)
ÏÏ) *
.
ÏÏ* +
ToList
ÏÏ+ 1
(
ÏÏ1 2
)
ÏÏ2 3
;
ÏÏ3 4
result
ÌÌ 
.
ÌÌ 
ForEach
ÌÌ 
(
ÌÌ 
r
ÌÌ  
=>
ÌÌ! #
r
ÌÌ$ %
.
ÌÌ% &
Stock
ÌÌ& +
=
ÌÌ, -
Math
ÌÌ. 2
.
ÌÌ2 3
Round
ÌÌ3 8
(
ÌÌ8 9
r
ÌÌ9 :
.
ÌÌ: ;
Stock
ÌÌ; @
,
ÌÌ@ A 
AplicacionSettings
ÌÌB T
.
ÌÌT U
Default
ÌÌU \
.
ÌÌ\ ]'
NumeroDecimalesEnCantidad
ÌÌ] v
)
ÌÌv w
)
ÌÌw x
;
ÌÌx y
return
ÓÓ 
result
ÓÓ 
;
ÓÓ 
}
ÔÔ 
catch
 
(
 
	Exception
 
e
 
)
 
{
ÒÒ 
throw
ÚÚ 
new
ÚÚ 
DatosException
ÚÚ (
(
ÚÚ( )
$str
ÚÚ) Q
,
ÚÚQ R
e
ÚÚS T
)
ÚÚT U
;
ÚÚU V
}
ÛÛ 
}
ÙÙ 	
public
˙˙ 
IEnumerable
˙˙ 
<
˙˙ 
Concepto_negocio
˙˙ +
>
˙˙+ ,g
XObtenerConceptosDeNegocioPorRolIncluyendoExistenciasYPreciosConUnPrecioVigenteComoMinimo˙˙- Ö
(˙˙Ö Ü
int˙˙Ü â
idRol˙˙ä è
)˙˙è ê
{
˚˚ 	
try
¸¸ 
{
˝˝ 
return
˛˛ 
_db
˛˛ 
.
˛˛ "
Concepto_negocio_rol
˛˛ /
.
˛˛/ 0
Include
˛˛0 7
(
˛˛7 8
cnr
˛˛8 ;
=>
˛˛< >
cnr
˛˛? B
.
˛˛B C
Rol
˛˛C F
)
˛˛F G
.
ˇˇ 
Include
ˇˇ 
(
ˇˇ 
cnr
ˇˇ  
=>
ˇˇ! #
cnr
ˇˇ$ '
.
ˇˇ' (
Concepto_negocio
ˇˇ( 8
)
ˇˇ8 9
.
ÄÄ 
Include
ÄÄ 
(
ÄÄ 
cnr
ÄÄ  
=>
ÄÄ! #
cnr
ÄÄ$ '
.
ÄÄ' (
Concepto_negocio
ÄÄ( 8
.
ÄÄ8 9
Precio1
ÄÄ9 @
)
ÄÄ@ A
.
ÅÅ 
Include
ÅÅ 
(
ÅÅ 
cnr
ÅÅ  
=>
ÅÅ! #
cnr
ÅÅ$ '
.
ÅÅ' (
Concepto_negocio
ÅÅ( 8
.
ÅÅ8 9

Existencia
ÅÅ9 C
)
ÅÅC D
.
ÇÇ 
Where
ÇÇ 
(
ÇÇ 
cnr
ÇÇ 
=>
ÇÇ !
cnr
ÇÇ" %
.
ÇÇ% &
id_rol
ÇÇ& ,
==
ÇÇ- /
idRol
ÇÇ0 5
&&
ÇÇ6 8
cnr
ÇÇ9 <
.
ÇÇ< =
Concepto_negocio
ÇÇ= M
.
ÇÇM N
Precio1
ÇÇN U
.
ÇÇU V
Any
ÇÇV Y
(
ÇÇY Z
p
ÇÇZ [
=>
ÇÇ\ ^
p
ÇÇ_ `
.
ÇÇ` a

es_vigente
ÇÇa k
)
ÇÇk l
)
ÇÇl m
.
ÇÇm n
ToList
ÇÇn t
(
ÇÇt u
)
ÇÇu v
.
ÉÉ 
Select
ÉÉ 
(
ÉÉ 
cnr
ÉÉ 
=>
ÉÉ  "
cnr
ÉÉ# &
.
ÉÉ& '
Concepto_negocio
ÉÉ' 7
)
ÉÉ7 8
;
ÉÉ8 9
}
ÑÑ 
catch
ÖÖ 
(
ÖÖ 
	Exception
ÖÖ 
e
ÖÖ 
)
ÖÖ 
{
ÜÜ 
throw
áá 
e
áá 
;
áá 
}
àà 
}
ââ 	
public
ãã 
IEnumerable
ãã 
<
ãã 
Concepto_negocio
ãã +
>
ãã+ ,?
1ObtenerConceptosDeNegocioPorRolYPorConceptoBasico
ãã- ^
(
ãã^ _
int
ãã_ b
idRol
ããc h
,
ããh i
int
ããj m
idConceptoBasico
ããn ~
)
ãã~ 
{
åå 	
try
çç 
{
éé 
return
èè 
_db
èè 
.
èè "
Concepto_negocio_rol
èè /
.
èè/ 0
Include
èè0 7
(
èè7 8
cnr
èè8 ;
=>
èè< >
cnr
èè? B
.
èèB C
Rol
èèC F
)
èèF G
.
êê 
Where
êê 
(
êê 
cnr
êê 
=>
êê !
cnr
êê" %
.
êê% &
id_rol
êê& ,
==
êê- /
idRol
êê0 5
&&
êê6 8
cnr
êê9 <
.
êê< =
Concepto_negocio
êê= M
.
êêM N 
id_concepto_basico
êêN `
==
êêa c
idConceptoBasico
êêd t
)
êêt u
.
ëë 
Select
ëë 
(
ëë 
cnr
ëë 
=>
ëë  "
cnr
ëë# &
.
ëë& '
Concepto_negocio
ëë' 7
)
ëë7 8
;
ëë8 9
}
íí 
catch
ìì 
(
ìì 
	Exception
ìì 
e
ìì 
)
ìì 
{
îî 
throw
ïï 
e
ïï 
;
ïï 
}
ññ 
}
óó 	
public
ôô 
IEnumerable
ôô 
<
ôô 
Concepto_negocio
ôô +
>
ôô+ ,J
<ObtenerConceptosDeNegocioPorRolIncluyendoExistenciasYPrecios
ôô- i
(
ôôi j
int
ôôj m
idRol
ôôn s
,
ôôs t
int
ôôu x
idConceptoBasicoôôy â
)ôôâ ä
{
öö 	
try
õõ 
{
úú 
return
ùù 
_db
ùù 
.
ùù "
Concepto_negocio_rol
ùù /
.
ûû 
Include
ûû $
(
ûû$ %
cnr
ûû% (
=>
ûû) +
cnr
ûû, /
.
ûû/ 0
Rol
ûû0 3
)
ûû3 4
.
üü 
Include
üü $
(
üü$ %
cnr
üü% (
=>
üü) +
cnr
üü, /
.
üü/ 0
Concepto_negocio
üü0 @
.
üü@ A3
%Valor_caracteristica_concepto_negocio
üüA f
)
üüf g
.
†† 
Include
†† $
(
††$ %
cnr
††% (
=>
††) +
cnr
††, /
.
††/ 0
Concepto_negocio
††0 @
.
††@ A

Existencia
††A K
)
††K L
.
°° 
Where
°° "
(
°°" #
cnr
°°# &
=>
°°' )
cnr
°°* -
.
°°- .
id_rol
°°. 4
==
°°5 7
idRol
°°8 =
&&
°°> @
cnr
°°A D
.
°°D E
Concepto_negocio
°°E U
.
°°U V 
id_concepto_basico
°°V h
==
°°i k
idConceptoBasico
°°l |
)
°°| }
.
¢¢ 
Select
¢¢ #
(
¢¢# $
cnr
¢¢$ '
=>
¢¢( *
cnr
¢¢+ .
.
¢¢. /
Concepto_negocio
¢¢/ ?
)
¢¢? @
.
££ 
Where
££ "
(
££" #
cnr
££# &
=>
££' )
cnr
££* -
.
££- .

es_vigente
££. 8
)
££8 9
;
££9 :
}
§§ 
catch
•• 
(
•• 
	Exception
•• 
e
•• 
)
•• 
{
¶¶ 
throw
ßß 
e
ßß 
;
ßß 
}
®® 
}
©© 	
public
´´ 
IEnumerable
´´ 
<
´´ 
Concepto_negocio
´´ +
>
´´+ ,v
gObtenerConceptosDeNegocioPorRolIncluyendoExistenciasYPreciosConUnPrecioVigenteComoMinimoPorActorNegocio´´- î
(´´î ï
int´´ï ò
idActorNegocio´´ô ß
,´´ß ®
int´´© ¨
idRol´´≠ ≤
,´´≤ ≥
int´´¥ ∑ 
idConceptoBasico´´∏ »
)´´» …
{
¨¨ 	
try
≠≠ 
{
ÆÆ 
return
ØØ 
_db
ØØ 
.
ØØ "
Concepto_negocio_rol
ØØ /
.
∞∞/ 0
Include
∞∞0 7
(
∞∞7 8
cnr
∞∞8 ;
=>
∞∞< >
cnr
∞∞? B
.
∞∞B C
Concepto_negocio
∞∞C S
.
∞∞S T
Precio1
∞∞T [
)
∞∞[ \
.
±±/ 0
Include
±±0 7
(
±±7 8
cnr
±±8 ;
=>
±±< >
cnr
±±? B
.
±±B C
Concepto_negocio
±±C S
.
±±S T
Precio1
±±T [
.
±±[ \
Select
±±\ b
(
±±b c
p
±±c d
=>
±±e g
p
±±h i
.
±±i j
Detalle_maestro3
±±j z
)
±±z {
)
±±{ |
.
≤≤/ 0
Include
≤≤0 7
(
≤≤7 8
cnr
≤≤8 ;
=>
≤≤< >
cnr
≤≤? B
.
≤≤B C
Concepto_negocio
≤≤C S
.
≤≤S T
Detalle_maestro4
≤≤T d
.
≤≤d e%
Caracteristica_concepto
≤≤e |
)
≤≤| }
.
≥≥/ 0
Include
≥≥0 7
(
≥≥7 8
cnr
≥≥8 ;
=>
≥≥< >
cnr
≥≥? B
.
≥≥B C
Concepto_negocio
≥≥C S
.
≥≥S T
Detalle_maestro4
≥≥T d
.
¥¥S T%
Caracteristica_concepto
¥¥T k
.
µµS T
Select
µµT Z
(
µµZ [
cc
µµ[ ]
=>
µµ^ `
cc
µµa c
.
µµc d
Detalle_maestro1
µµd t
)
µµt u
)
∂∂8 9
.
∑∑/ 0
Include
∑∑0 7
(
∑∑7 8
cnr
∑∑8 ;
=>
∑∑< >
cnr
∑∑? B
.
∑∑B C
Concepto_negocio
∑∑C S
.
∑∑S T

Existencia
∑∑T ^
)
∑∑^ _
.
∏∏/ 0
Where
∏∏0 5
(
∏∏5 6
cnr
∏∏6 9
=>
∏∏: <
cnr
∏∏= @
.
∏∏@ A
id_rol
∏∏A G
==
∏∏H J
idRol
∏∏K P
&&
ππ= ?
cnr
ππ@ C
.
ππC D
Concepto_negocio
ππD T
.
ππT U 
id_concepto_basico
ππU g
==
ππh j
idConceptoBasico
ππk {
&&
∫∫= ?
cnr
∫∫@ C
.
∫∫C D
Concepto_negocio
∫∫D T
.
ªªC D
Precio1
ªªD K
.
ªªK L
Any
ººD G
(
ººG H
p
ººH I
=>
ººJ L
p
ººM N
.
ººN O
id_actor_negocio
ººO _
==
ºº` b
idActorNegocio
ººc q
&&
ΩΩ= ?
p
ΩΩ@ A
.
ΩΩA B

es_vigente
ΩΩB L
)
ΩΩL M
)
ΩΩM N
.
ΩΩN O
ToList
ΩΩO U
(
ΩΩU V
)
ΩΩV W
.
ææ/ 0
Select
ææ0 6
(
ææ6 7
cnr
ææ7 :
=>
ææ; =
cnr
ææ> A
.
ææA B
Concepto_negocio
ææB R
)
ææR S
.
øø/ 0
Where
øø0 5
(
øø5 6
cn
øø6 8
=>
øø9 ;
cn
øø< >
.
øø> ?

es_vigente
øø? I
)
øøI J
.
¿¿/ 0
Distinct
¿¿0 8
(
¿¿8 9
)
¿¿9 :
;
¿¿: ;
}
¡¡ 
catch
¬¬ 
(
¬¬ 
	Exception
¬¬ 
e
¬¬ 
)
¬¬ 
{
√√ 
throw
ƒƒ 
new
ƒƒ 
DatosException
ƒƒ (
(
ƒƒ( )
$str
ƒƒ) j
,
ƒƒj k
e
ƒƒl m
)
ƒƒm n
;
ƒƒn o
}
≈≈ 
}
«« 	
public
…… 
IEnumerable
…… 
<
…… 
Concepto_negocio
…… +
>
……+ ,L
>ObtenerConceptosDeNegocioPorRolesIncluyendoExistenciasYPrecios
……- k
(
……k l
int
……l o
idRol
……p u
)
……u v
{
   	
try
ÀÀ 
{
ÃÃ 
return
ÕÕ 
_db
ÕÕ 
.
ÕÕ "
Concepto_negocio_rol
ÕÕ /
.
ÕÕ/ 0
Include
ÕÕ0 7
(
ÕÕ7 8
cnr
ÕÕ8 ;
=>
ÕÕ< >
cnr
ÕÕ? B
.
ÕÕB C
Rol
ÕÕC F
)
ÕÕF G
.
ŒŒ 
Include
ŒŒ 
(
ŒŒ 
cnr
ŒŒ  
=>
ŒŒ! #
cnr
ŒŒ$ '
.
ŒŒ' (
Concepto_negocio
ŒŒ( 8
.
ŒŒ8 9
Precio
ŒŒ9 ?
)
ŒŒ? @
.
œœ 
Include
œœ 
(
œœ 
cnr
œœ  
=>
œœ! #
cnr
œœ$ '
.
œœ' (
Concepto_negocio
œœ( 8
.
œœ8 93
%Valor_caracteristica_concepto_negocio
œœ9 ^
)
œœ^ _
.
–– 
Include
–– 
(
–– 
cnr
––  
=>
––! #
cnr
––$ '
.
––' (
Concepto_negocio
––( 8
.
––8 9

Existencia
––9 C
)
––C D
.
—— 
Where
—— 
(
—— 
cnr
—— 
=>
—— !
cnr
——" %
.
——% &
id_rol
——& ,
==
——- /
idRol
——0 5
)
——5 6
.
““ 
Select
““ 
(
““ 
cnr
““ 
=>
““  "
cnr
““# &
.
““& '
Concepto_negocio
““' 7
)
““7 8
;
““8 9
}
”” 
catch
‘‘ 
(
‘‘ 
	Exception
‘‘ 
e
‘‘ 
)
‘‘ 
{
’’ 
throw
÷÷ 
e
÷÷ 
;
÷÷ 
}
◊◊ 
}
ÿÿ 	
public
⁄⁄ 
IEnumerable
⁄⁄ 
<
⁄⁄ 
Concepto_negocio
⁄⁄ +
>
⁄⁄+ ,;
-ObtenerConceptosDeNegocioConPreciosPorFamilia
⁄⁄- Z
(
⁄⁄Z [
int
⁄⁄[ ^
	idFamilia
⁄⁄_ h
)
⁄⁄h i
{
€€ 	
try
‹‹ 
{
›› 
return
ﬁﬁ 
_db
ﬁﬁ 
.
ﬁﬁ 
Concepto_negocio
ﬁﬁ +
.
ﬁﬁ+ ,
Where
ﬁﬁ, 1
(
ﬁﬁ1 2
cn
ﬁﬁ2 4
=>
ﬁﬁ5 7
cn
ﬁﬁ8 :
.
ﬁﬁ: ; 
id_concepto_basico
ﬁﬁ; M
==
ﬁﬁN P
	idFamilia
ﬁﬁQ Z
)
ﬁﬁZ [
.
ﬂﬂ 
Include
ﬂﬂ 
(
ﬂﬂ 
cn
ﬂﬂ 
=>
ﬂﬂ  "
cn
ﬂﬂ# %
.
ﬂﬂ% &
Precio
ﬂﬂ& ,
)
ﬂﬂ, -
.
‡‡ 
Include
‡‡ 
(
‡‡ 
cn
‡‡ 
=>
‡‡  "
cn
‡‡# %
.
‡‡% &3
%Valor_caracteristica_concepto_negocio
‡‡& K
)
‡‡K L
;
‡‡L M
}
·· 
catch
‚‚ 
(
‚‚ 
	Exception
‚‚ 
e
‚‚ 
)
‚‚ 
{
„„ 
throw
‰‰ 
e
‰‰ 
;
‰‰ 
}
ÂÂ 
}
ÊÊ 	
public
ËË 
IEnumerable
ËË 
<
ËË 
Concepto_negocio
ËË +
>
ËË+ ,L
>ObtenerConceptosDeNegocioPorRolesIncluyendoExistenciasYPrecios
ËË- k
(
ËËk l
int
ËËl o
idRol
ËËp u
,
ËËu v
bool
ËËw {
	esVigenteËË| Ö
)ËËÖ Ü
{
ÈÈ 	
try
ÍÍ 
{
ÎÎ 
return
ÏÏ 
_db
ÏÏ 
.
ÏÏ "
Concepto_negocio_rol
ÏÏ /
.
ÏÏ/ 0
Include
ÏÏ0 7
(
ÏÏ7 8
cnr
ÏÏ8 ;
=>
ÏÏ< >
cnr
ÏÏ? B
.
ÏÏB C
Rol
ÏÏC F
)
ÏÏF G
.
ÌÌ 
Include
ÌÌ 
(
ÌÌ 
cnr
ÌÌ  
=>
ÌÌ! #
cnr
ÌÌ$ '
.
ÌÌ' (
Concepto_negocio
ÌÌ( 8
.
ÌÌ8 9
Precio
ÌÌ9 ?
)
ÌÌ? @
.
ÓÓ 
Include
ÓÓ 
(
ÓÓ 
cnr
ÓÓ  
=>
ÓÓ! #
cnr
ÓÓ$ '
.
ÓÓ' (
Concepto_negocio
ÓÓ( 8
.
ÓÓ8 93
%Valor_caracteristica_concepto_negocio
ÓÓ9 ^
)
ÓÓ^ _
.
ÔÔ 
Include
ÔÔ 
(
ÔÔ 
cnr
ÔÔ  
=>
ÔÔ! #
cnr
ÔÔ$ '
.
ÔÔ' (
Concepto_negocio
ÔÔ( 8
.
ÔÔ8 9

Existencia
ÔÔ9 C
)
ÔÔC D
.
 
Where
 
(
 
cnr
 
=>
 !
cnr
" %
.
% &
id_rol
& ,
==
- /
idRol
0 5
)
5 6
.
ÒÒ 
Select
ÒÒ 
(
ÒÒ 
cnr
ÒÒ 
=>
ÒÒ  "
cnr
ÒÒ# &
.
ÒÒ& '
Concepto_negocio
ÒÒ' 7
)
ÒÒ7 8
.
ÚÚ 
Where
ÚÚ 
(
ÚÚ 
cnr
ÚÚ 
=>
ÚÚ !
cnr
ÚÚ" %
.
ÚÚ% &

es_vigente
ÚÚ& 0
==
ÚÚ1 3
	esVigente
ÚÚ4 =
)
ÚÚ= >
;
ÚÚ> ?
}
ÛÛ 
catch
ÙÙ 
(
ÙÙ 
	Exception
ÙÙ 
e
ÙÙ 
)
ÙÙ 
{
ıı 
throw
ˆˆ 
e
ˆˆ 
;
ˆˆ 
}
˜˜ 
}
¯¯ 	
public
˙˙ 
IEnumerable
˙˙ 
<
˙˙ 
Concepto_negocio
˙˙ +
>
˙˙+ ,[
MObtenerConceptosDeNegocioPorRolIncluyendoExistenciasPreciosYDetallesDeMaestro
˙˙- z
(
˙˙z {
int
˙˙{ ~
idRol˙˙ Ñ
,˙˙Ñ Ö
int˙˙Ü â 
idConceptoBasico˙˙ä ö
)˙˙ö õ
{
˚˚ 	
try
¸¸ 
{
˝˝ 
var
˛˛ 
	resultado
˛˛ 
=
˛˛ 
_db
ˇˇ 
.
ˇˇ "
Concepto_negocio_rol
ˇˇ )
.
ˇˇ) *
Where
ˇˇ* /
(
ˇˇ/ 0
cnr
ˇˇ0 3
=>
ˇˇ4 6
cnr
ˇˇ7 :
.
ˇˇ: ;
id_rol
ˇˇ; A
==
ˇˇB D
idRol
ˇˇE J
)
ˇˇJ K
.
ˇˇK L
Include
ˇˇL S
(
ˇˇS T
cnr
ˇˇT W
=>
ˇˇX Z
cnr
ˇˇ[ ^
.
ˇˇ^ _
Rol
ˇˇ_ b
)
ˇˇb c
.
ˇˇc d
Select
ˇˇd j
(
ˇˇj k
cnr
ˇˇk n
=>
ˇˇo q
cnr
ˇˇr u
.
ˇˇu v
Concepto_negocioˇˇv Ü
)ˇˇÜ á
.ˇˇá à
Whereˇˇà ç
(ˇˇç é
cnˇˇé ê
=>ˇˇë ì
cnˇˇî ñ
.ˇˇñ ó

es_vigenteˇˇó °
)ˇˇ° ¢
.
ÄÄ 
Include
ÄÄ 
(
ÄÄ 
cn
ÄÄ  
=>
ÄÄ! #
cn
ÄÄ$ &
.
ÄÄ& '
Precio
ÄÄ' -
)
ÄÄ- .
.
ÅÅ 
Include
ÅÅ 
(
ÅÅ 
cn
ÅÅ  
=>
ÅÅ! #
cn
ÅÅ$ &
.
ÅÅ& '3
%Valor_caracteristica_concepto_negocio
ÅÅ' L
)
ÅÅL M
.
ÇÇ 
Include
ÇÇ 
(
ÇÇ 
cn
ÇÇ  
=>
ÇÇ! #
cn
ÇÇ$ &
.
ÇÇ& '

Existencia
ÇÇ' 1
)
ÇÇ1 2
.
ÉÉ 
Include
ÉÉ 
(
ÉÉ 
cn
ÉÉ  
=>
ÉÉ! #
cn
ÉÉ$ &
.
ÉÉ& '
Detalle_maestro
ÉÉ' 6
)
ÉÉ6 7
.
ÑÑ 
Include
ÑÑ 
(
ÑÑ 
cn
ÑÑ  
=>
ÑÑ! #
cn
ÑÑ$ &
.
ÑÑ& '
Detalle_maestro1
ÑÑ' 7
)
ÑÑ7 8
.
ÖÖ 
Include
ÖÖ 
(
ÖÖ 
cn
ÖÖ  
=>
ÖÖ! #
cn
ÖÖ$ &
.
ÖÖ& '
Detalle_maestro2
ÖÖ' 7
)
ÖÖ7 8
.
ÜÜ 
Include
ÜÜ 
(
ÜÜ 
cn
ÜÜ  
=>
ÜÜ! #
cn
ÜÜ$ &
.
ÜÜ& '
Detalle_maestro3
ÜÜ' 7
)
ÜÜ7 8
.
áá 
Include
áá 
(
áá 
cn
áá  
=>
áá! #
cn
áá$ &
.
áá& '
Detalle_maestro4
áá' 7
)
áá7 8
.
àà 
Include
àà 
(
àà 
cn
àà  
=>
àà! #
cn
àà$ &
.
àà& '(
Parametro_concepto_negocio
àà' A
)
ààA B
.
ââ 
Include
ââ 
(
ââ 
cn
ââ  
=>
ââ! #
cn
ââ$ &
.
ââ& '
Precio1
ââ' .
)
ââ. /
.
ää 
Where
ää 
(
ää 
cn
ää 
=>
ää !
cn
ää" $
.
ää$ % 
id_concepto_basico
ää% 7
==
ää8 :
idConceptoBasico
ää; K
)
ääK L
;
ääL M
return
åå 
	resultado
åå  
;
åå  !
}
çç 
catch
éé 
(
éé 
	Exception
éé 
e
éé 
)
éé 
{
èè 
throw
êê 
e
êê 
;
êê 
}
ëë 
}
íí 	
public
îî 
IEnumerable
îî 
<
îî 
Concepto_negocio
îî +
>
îî+ ,[
MObtenerConceptosDeNegocioPorRolIncluyendoExistenciasPreciosYDetallesDeMaestro
îî- z
(
îîz {
int
îî{ ~
idRolîî Ñ
,îîÑ Ö
intîîÜ â 
idConceptoBasicoîîä ö
,îîö õ
intîîú ü
[îîü †
]îî† °+
idsValoresDeCaracteristicasîî¢ Ω
)îîΩ æ
{
ïï 	
try
óó 
{
òò 
var
ôô 
length
ôô 
=
ôô )
idsValoresDeCaracteristicas
ôô 8
.
ôô8 9
Length
ôô9 ?
;
ôô? @
var
öö 
	resultado
öö 
=
öö 
_db
õõ 
.
õõ "
Concepto_negocio_rol
õõ )
.
õõ) *
Where
õõ* /
(
õõ/ 0
cnr
õõ0 3
=>
õõ4 6
cnr
õõ7 :
.
õõ: ;
id_rol
õõ; A
==
õõB D
idRol
õõE J
)
õõJ K
.
õõK L
Include
õõL S
(
õõS T
cnr
õõT W
=>
õõX Z
cnr
õõ[ ^
.
õõ^ _
Rol
õõ_ b
)
õõb c
.
õõc d
Select
õõd j
(
õõj k
cnr
õõk n
=>
õõo q
cnr
õõr u
.
õõu v
Concepto_negocioõõv Ü
)õõÜ á
.õõá à
Whereõõà ç
(õõç é
cnõõé ê
=>õõë ì
cnõõî ñ
.õõñ ó

es_vigenteõõó °
)õõ° ¢
.
úú 
Include
úú 
(
úú 
cn
úú  
=>
úú! #
cn
úú$ &
.
úú& '
Precio
úú' -
)
úú- .
.
ùù 
Include
ùù 
(
ùù 
cn
ùù  
=>
ùù! #
cn
ùù$ &
.
ùù& '3
%Valor_caracteristica_concepto_negocio
ùù' L
)
ùùL M
.
ûû 
Include
ûû 
(
ûû 
cn
ûû  
=>
ûû! #
cn
ûû$ &
.
ûû& '

Existencia
ûû' 1
)
ûû1 2
.
üü 
Include
üü 
(
üü 
cn
üü  
=>
üü! #
cn
üü$ &
.
üü& '
Detalle_maestro
üü' 6
)
üü6 7
.
†† 
Include
†† 
(
†† 
cn
††  
=>
††! #
cn
††$ &
.
††& '
Detalle_maestro1
††' 7
)
††7 8
.
°° 
Include
°° 
(
°° 
cn
°°  
=>
°°! #
cn
°°$ &
.
°°& '
Detalle_maestro2
°°' 7
)
°°7 8
.
¢¢ 
Include
¢¢ 
(
¢¢ 
cn
¢¢  
=>
¢¢! #
cn
¢¢$ &
.
¢¢& '
Detalle_maestro3
¢¢' 7
)
¢¢7 8
.
££ 
Include
££ 
(
££ 
cn
££  
=>
££! #
cn
££$ &
.
££& '
Detalle_maestro4
££' 7
)
££7 8
.
§§ 
Include
§§ 
(
§§ 
cn
§§  
=>
§§! #
cn
§§$ &
.
§§& '(
Parametro_concepto_negocio
§§' A
)
§§A B
.
•• 
Include
•• 
(
•• 
cn
••  
=>
••! #
cn
••$ &
.
••& '
Precio1
••' .
)
••. /
.
¶¶ 
Where
¶¶ 
(
¶¶ 
cn
¶¶ 
=>
¶¶ !
cn
ßß 
.
ßß  
id_concepto_basico
ßß )
==
ßß* ,
idConceptoBasico
ßß- =
&&
©© 
cn
©© 
.
©© 3
%Valor_caracteristica_concepto_negocio
©© @
.
©©@ A
Where
©©A F
(
©©F G
vcc
©©G J
=>
©©K M)
idsValoresDeCaracteristicas
©©N i
.
©©i j
Contains
©©j r
(
©©r s
vcc
©©s v
.
©©v w&
id_valor_caracteristica©©w é
)©©é è
)©©è ê
.©©ê ë
Count©©ë ñ
(©©ñ ó
)©©ó ò
==©©ô õ
length©©ú ¢
)©©¢ £
;©©£ §
return
™™ 
	resultado
™™  
;
™™  !
}
´´ 
catch
¨¨ 
(
¨¨ 
	Exception
¨¨ 
e
¨¨ 
)
¨¨ 
{
≠≠ 
throw
ÆÆ 
e
ÆÆ 
;
ÆÆ 
}
ØØ 
}
∞∞ 	
public
≤≤ 
IEnumerable
≤≤ 
<
≤≤ 
Concepto_negocio
≤≤ +
>
≤≤+ ,[
MObtenerConceptosDeNegocioPorRolIncluyendoExistenciasPreciosYDetallesDeMaestro
≤≤- z
(
≤≤z {
int
≤≤{ ~
idRol≤≤ Ñ
,≤≤Ñ Ö
int≤≤Ü â
[≤≤â ä
]≤≤ä ã+
idsValoresDeCaracteristicas≤≤å ß
)≤≤ß ®
{
≥≥ 	
try
µµ 
{
∑∑ 
var
∏∏ 
length
∏∏ 
=
∏∏ )
idsValoresDeCaracteristicas
∏∏ 8
.
∏∏8 9
Length
∏∏9 ?
;
∏∏? @
var
ππ 
	resultado
ππ 
=
ππ 
_db
∫∫ 
.
∫∫ "
Concepto_negocio_rol
∫∫ )
.
∫∫) *
Where
∫∫* /
(
∫∫/ 0
cnr
∫∫0 3
=>
∫∫4 6
cnr
∫∫7 :
.
∫∫: ;
id_rol
∫∫; A
==
∫∫B D
idRol
∫∫E J
)
∫∫J K
.
∫∫K L
Include
∫∫L S
(
∫∫S T
cnr
∫∫T W
=>
∫∫X Z
cnr
∫∫[ ^
.
∫∫^ _
Rol
∫∫_ b
)
∫∫b c
.
∫∫c d
Select
∫∫d j
(
∫∫j k
cnr
∫∫k n
=>
∫∫o q
cnr
∫∫r u
.
∫∫u v
Concepto_negocio∫∫v Ü
)∫∫Ü á
.∫∫á à
Where∫∫à ç
(∫∫ç é
cn∫∫é ê
=>∫∫ë ì
cn∫∫î ñ
.∫∫ñ ó

es_vigente∫∫ó °
)∫∫° ¢
.
ªª 
Include
ªª 
(
ªª 
cn
ªª  
=>
ªª! #
cn
ªª$ &
.
ªª& '
Precio
ªª' -
)
ªª- .
.
ºº 
Include
ºº 
(
ºº 
cn
ºº  
=>
ºº! #
cn
ºº$ &
.
ºº& '3
%Valor_caracteristica_concepto_negocio
ºº' L
)
ººL M
.
ΩΩ 
Include
ΩΩ 
(
ΩΩ 
cn
ΩΩ  
=>
ΩΩ! #
cn
ΩΩ$ &
.
ΩΩ& '

Existencia
ΩΩ' 1
)
ΩΩ1 2
.
ææ 
Include
ææ 
(
ææ 
cn
ææ  
=>
ææ! #
cn
ææ$ &
.
ææ& '
Detalle_maestro
ææ' 6
)
ææ6 7
.
øø 
Include
øø 
(
øø 
cn
øø  
=>
øø! #
cn
øø$ &
.
øø& '
Detalle_maestro1
øø' 7
)
øø7 8
.
¿¿ 
Include
¿¿ 
(
¿¿ 
cn
¿¿  
=>
¿¿! #
cn
¿¿$ &
.
¿¿& '
Detalle_maestro2
¿¿' 7
)
¿¿7 8
.
¡¡ 
Include
¡¡ 
(
¡¡ 
cn
¡¡  
=>
¡¡! #
cn
¡¡$ &
.
¡¡& '
Detalle_maestro3
¡¡' 7
)
¡¡7 8
.
¬¬ 
Include
¬¬ 
(
¬¬ 
cn
¬¬  
=>
¬¬! #
cn
¬¬$ &
.
¬¬& '
Detalle_maestro4
¬¬' 7
)
¬¬7 8
.
√√ 
Include
√√ 
(
√√ 
cn
√√  
=>
√√! #
cn
√√$ &
.
√√& '(
Parametro_concepto_negocio
√√' A
)
√√A B
.
ƒƒ 
Include
ƒƒ 
(
ƒƒ 
cn
ƒƒ  
=>
ƒƒ! #
cn
ƒƒ$ &
.
ƒƒ& '
Precio1
ƒƒ' .
)
ƒƒ. /
.
≈≈ 
Where
≈≈ 
(
≈≈ 
cn
∆∆ 
=>
∆∆ 
cn
∆∆ 
.
∆∆ 3
%Valor_caracteristica_concepto_negocio
∆∆ C
.
∆∆C D
Where
∆∆D I
(
∆∆I J
vcc
∆∆J M
=>
∆∆N P)
idsValoresDeCaracteristicas
∆∆Q l
.
∆∆l m
Contains
∆∆m u
(
∆∆u v
vcc
∆∆v y
.
∆∆y z&
id_valor_caracteristica∆∆z ë
)∆∆ë í
)∆∆í ì
.∆∆ì î
Count∆∆î ô
(∆∆ô ö
)∆∆ö õ
==∆∆ú û
length∆∆ü •
)∆∆• ¶
;∆∆¶ ß
return
«« 
	resultado
««  
;
««  !
}
»» 
catch
…… 
(
…… 
	Exception
…… 
e
…… 
)
…… 
{
   
throw
ÀÀ 
new
ÀÀ 
DatosException
ÀÀ (
(
ÀÀ( )
$str
ÀÀ) P
,
ÀÀP Q
e
ÀÀR S
)
ÀÀS T
;
ÀÀT U
}
ÃÃ 
}
ÕÕ 	
public
œœ 
IEnumerable
œœ 
<
œœ 
Concepto_negocio
œœ +
>
œœ+ ,w
hObtenerConceptosDeNegocioPorRolIncluyendoExistenciasYPreciosConUnPrecioVigenteComoMinimoParaActorNegocioœœ- ï
(œœï ñ
intœœñ ô
idActorNegocioœœö ®
,œœ® ©
intœœ™ ≠
idRolœœÆ ≥
)œœ≥ ¥
{
–– 	
try
—— 
{
““ 
return
”” 
_db
”” 
.
”” "
Concepto_negocio_rol
”” /
.
””/ 0
Include
””0 7
(
””7 8
cnr
””8 ;
=>
””< >
cnr
””? B
.
””B C
Rol
””C F
)
””F G
.
‘‘ 
Include
‘‘ 
(
‘‘ 
cnr
‘‘  
=>
‘‘! #
cnr
‘‘$ '
.
‘‘' (
Concepto_negocio
‘‘( 8
)
‘‘8 9
.
’’ 
Include
’’ 
(
’’ 
cnr
’’  
=>
’’! #
cnr
’’$ '
.
’’' (
Concepto_negocio
’’( 8
.
’’8 9
Precio1
’’9 @
)
’’@ A
.
÷÷ 
Include
÷÷ 
(
÷÷ 
cnr
÷÷  
=>
÷÷! #
cnr
÷÷$ '
.
÷÷' (
Concepto_negocio
÷÷( 8
.
÷÷8 9

Existencia
÷÷9 C
)
÷÷C D
.
◊◊ 
Where
◊◊ 
(
◊◊ 
cnr
◊◊ 
=>
◊◊ !
cnr
◊◊" %
.
◊◊% &
id_rol
◊◊& ,
==
◊◊- /
idRol
◊◊0 5
&&
◊◊6 8
cnr
◊◊9 <
.
◊◊< =
Concepto_negocio
◊◊= M
.
◊◊M N
Precio1
◊◊N U
.
◊◊U V
Any
◊◊V Y
(
◊◊Y Z
p
◊◊Z [
=>
◊◊\ ^
p
◊◊_ `
.
◊◊` a
id_actor_negocio
◊◊a q
==
◊◊r t
idActorNegocio◊◊u É
&&◊◊Ñ Ü
p◊◊á à
.◊◊à â

es_vigente◊◊â ì
)◊◊ì î
)◊◊î ï
.◊◊ï ñ
ToList◊◊ñ ú
(◊◊ú ù
)◊◊ù û
.
ÿÿ 
Select
ÿÿ 
(
ÿÿ 
cnr
ÿÿ 
=>
ÿÿ  "
cnr
ÿÿ# &
.
ÿÿ& '
Concepto_negocio
ÿÿ' 7
)
ÿÿ7 8
;
ÿÿ8 9
}
ŸŸ 
catch
⁄⁄ 
(
⁄⁄ 
	Exception
⁄⁄ 
e
⁄⁄ 
)
⁄⁄ 
{
€€ 
throw
‹‹ 
e
‹‹ 
;
‹‹ 
}
›› 
}
ﬂﬂ 	
public
·· 
Concepto_negocio
·· w
hObtenerConceptoNegocioIncluyendoValorCaracteristicaConceptoNegocioYDetalleMaestroYCaracteristicaConcepto··  à
(··à â
int··â å

idConcepto··ç ó
)··ó ò
{
‚‚ 	
try
„„ 
{
‰‰ 
return
ÂÂ 
_db
ÂÂ 
.
ÂÂ 
Concepto_negocio
ÂÂ +
.
ÊÊ+ ,
Include
ÊÊ, 3
(
ÊÊ3 4
cn
ÊÊ4 6
=>
ÊÊ7 9
cn
ÊÊ: <
.
ÊÊ< =3
%Valor_caracteristica_concepto_negocio
ÊÊ= b
)
ÊÊb c
.
ÁÁ+ ,
Include
ÁÁ, 3
(
ÁÁ3 4
dt
ÁÁ4 6
=>
ÁÁ7 9
dt
ÁÁ: <
.
ÁÁ< =
Detalle_maestro4
ÁÁ= M
)
ÁÁM N
.
ËË+ ,
Include
ËË, 3
(
ËË3 4
dt
ËË4 6
=>
ËË7 9
dt
ËË: <
.
ËË< =
Detalle_maestro4
ËË= M
.
ËËM N%
Caracteristica_concepto
ËËN e
)
ËËe f
.
ÈÈ+ ,
Single
ÈÈ, 2
(
ÈÈ2 3
cnr
ÈÈ3 6
=>
ÈÈ7 9
cnr
ÈÈ: =
.
ÈÈ= >
id
ÈÈ> @
==
ÈÈA C

idConcepto
ÈÈD N
)
ÈÈN O
;
ÈÈO P
}
ÍÍ 
catch
ÎÎ 
(
ÎÎ 
	Exception
ÎÎ 
e
ÎÎ 
)
ÎÎ 
{
ÏÏ 
throw
ÌÌ 
e
ÌÌ 
;
ÌÌ 
}
ÓÓ 
}
ÔÔ 	
public
ÒÒ 
Concepto_negocio
ÒÒ -
ObtenerConceptoNegocioPorNombre
ÒÒ  ?
(
ÒÒ? @
string
ÒÒ@ F
nombre
ÒÒG M
)
ÒÒM N
{
ÚÚ 	
try
ÛÛ 
{
ÙÙ 
var
ıı 
conceptoNegocio
ıı #
=
ıı$ %
_db
ıı& )
.
ıı) *
Concepto_negocio
ıı* :
.
ˆˆ) *
Where
ˆˆ* /
(
ˆˆ/ 0
cn
ˆˆ0 2
=>
ˆˆ3 5
cn
ˆˆ6 8
.
ˆˆ8 9
nombre
ˆˆ9 ?
==
ˆˆ@ B
nombre
ˆˆC I
&&
ˆˆJ L
cn
ˆˆM O
.
ˆˆO P

es_vigente
ˆˆP Z
)
ˆˆZ [
.
˜˜) *
FirstOrDefault
˜˜* 8
(
˜˜8 9
)
˜˜9 :
;
˜˜: ;
return
¯¯ 
conceptoNegocio
¯¯ &
;
¯¯& '
}
˘˘ 
catch
˙˙ 
(
˙˙ 
	Exception
˙˙ 
e
˙˙ 
)
˙˙ 
{
˚˚ 
throw
¸¸ 
new
¸¸ 
DatosException
¸¸ (
(
¸¸( )
$str
¸¸) W
,
¸¸W X
e
¸¸Y Z
)
¸¸Z [
;
¸¸[ \
}
˝˝ 
}
˛˛ 	
public
ÄÄ 
Concepto_negocio
ÄÄ >
0ObtenerConceptoDeNegocioPorRolYIdConceptoNegocio
ÄÄ  P
(
ÄÄP Q
int
ÄÄQ T
idRol
ÄÄU Z
,
ÄÄZ [
int
ÄÄ\ _
idConceptoNegocio
ÄÄ` q
)
ÄÄq r
{
ÅÅ 	
try
ÇÇ 
{
ÉÉ 
return
ÑÑ 
_db
ÑÑ 
.
ÑÑ "
Concepto_negocio_rol
ÑÑ /
.
ÖÖ 
Where
ÖÖ 
(
ÖÖ 
cnr
ÖÖ 
=>
ÖÖ !
cnr
ÖÖ" %
.
ÖÖ% &
id_rol
ÖÖ& ,
==
ÖÖ- /
idRol
ÖÖ0 5
)
ÖÖ5 6
.
ÜÜ 
Select
ÜÜ 
(
ÜÜ 
cn
ÜÜ 
=>
ÜÜ !
cn
ÜÜ" $
.
ÜÜ$ %
Concepto_negocio
ÜÜ% 5
)
ÜÜ5 6
.
áá 
Where
áá 
(
áá 
cn
áá 
=>
áá  
cn
áá! #
.
áá# $
id
áá$ &
==
áá' )
idConceptoNegocio
áá* ;
)
áá; <
.
áá< =
FirstOrDefault
áá= K
(
ááK L
)
ááL M
;
ááM N
}
ââ 
catch
ää 
(
ää 
	Exception
ää 
e
ää 
)
ää 
{
ãã 
throw
åå 
e
åå 
;
åå 
}
çç 
}
éé 	
public
êê 
Concepto_negocio
êê :
,ObtenerConceptoDeNegocioPorIdConceptoNegocio
êê  L
(
êêL M
int
êêM P
idConceptoNegocio
êêQ b
)
êêb c
{
ëë 	
try
íí 
{
ìì 
return
îî 
_db
îî 
.
îî 
Concepto_negocio
îî +
.
îî+ ,
Include
îî, 3
(
îî3 4
cn
îî4 6
=>
îî7 9
cn
îî: <
.
îî< =
Detalle_maestro4
îî= M
)
îîM N
.
ïï 
Where
ïï 
(
ïï 
cn
ïï 
=>
ïï  
cn
ïï! #
.
ïï# $
id
ïï$ &
==
ïï' )
idConceptoNegocio
ïï* ;
)
ïï; <
.
ïï< =
FirstOrDefault
ïï= K
(
ïïK L
)
ïïL M
;
ïïM N
}
óó 
catch
òò 
(
òò 
	Exception
òò 
e
òò 
)
òò 
{
ôô 
throw
öö 
e
öö 
;
öö 
}
õõ 
}
úú 	
public
ûû 
IEnumerable
ûû 
<
ûû 
Concepto_negocio
ûû +
>
ûû+ ,@
2ObtenerConceptosDeNegocioIncluyendoDetalleMaestro4
ûû- _
(
ûû_ `
int
ûû` c
[
ûûc d
]
ûûd e 
idsConceptoNegocio
ûûf x
)
ûûx y
{
üü 	
try
†† 
{
°° 
return
¢¢ 
_db
¢¢ 
.
¢¢ 
Concepto_negocio
¢¢ +
.
¢¢+ ,
Include
¢¢, 3
(
¢¢3 4
cn
¢¢4 6
=>
¢¢7 9
cn
¢¢: <
.
¢¢< =
Detalle_maestro4
¢¢= M
)
¢¢M N
.
££ 
Where
££ 
(
££ 
cn
££ 
=>
££   
idsConceptoNegocio
££! 3
.
££3 4
Contains
££4 <
(
££< =
cn
££= ?
.
££? @
id
££@ B
)
££B C
)
££C D
;
££D E
}
§§ 
catch
•• 
(
•• 
	Exception
•• 
e
•• 
)
•• 
{
¶¶ 
throw
ßß 
e
ßß 
;
ßß 
}
®® 
}
©© 	
public
´´ 
Concepto_negocio
´´ 9
+ObtenerConceptosDeNegocioPorRolYCodigoBarra
´´  K
(
´´K L
int
´´L O
idRol
´´P U
,
´´U V
string
´´W ]
codigoBarra
´´^ i
)
´´i j
{
¨¨ 	
try
≠≠ 
{
ÆÆ 
var
ØØ 
	resultado
ØØ 
=
ØØ 
_db
ØØ  #
.
ØØ# $"
Concepto_negocio_rol
ØØ$ 8
.
ØØ8 9
Include
ØØ9 @
(
ØØ@ A
cnr
ØØA D
=>
ØØE G
cnr
ØØH K
.
ØØK L
Rol
ØØL O
)
ØØO P
.
∞∞ 
Include
∞∞ 
(
∞∞ 
cnr
∞∞  
=>
∞∞! #
cnr
∞∞$ '
.
∞∞' (
Concepto_negocio
∞∞( 8
.
∞∞8 9
Precio
∞∞9 ?
)
∞∞? @
.
±± 
Include
±± 
(
±± 
cnr
±±  
=>
±±! #
cnr
±±$ '
.
±±' (
Concepto_negocio
±±( 8
.
±±8 93
%Valor_caracteristica_concepto_negocio
±±9 ^
)
±±^ _
.
≤≤ 
Include
≤≤ 
(
≤≤ 
cnr
≤≤  
=>
≤≤! #
cnr
≤≤$ '
.
≤≤' (
Concepto_negocio
≤≤( 8
.
≤≤8 9

Existencia
≤≤9 C
)
≤≤C D
.
≥≥ 
SingleOrDefault
≥≥ $
(
≥≥$ %
cnr
≥≥% (
=>
≥≥) +
cnr
≥≥, /
.
≥≥/ 0
id_rol
≥≥0 6
==
≥≥7 9
idRol
≥≥: ?
&&
≥≥@ B
cnr
≥≥C F
.
≥≥F G
Concepto_negocio
≥≥G W
.
≥≥W X
codigo_barra
≥≥X d
==
≥≥e g
codigoBarra
≥≥h s
)
≥≥s t
;
≥≥t u
return
¥¥ 
	resultado
¥¥  
!=
¥¥! #
null
¥¥$ (
?
¥¥) *
	resultado
¥¥+ 4
.
¥¥4 5
Concepto_negocio
¥¥5 E
:
¥¥F G
null
¥¥H L
;
¥¥L M
}
µµ 
catch
∂∂ 
(
∂∂ 
	Exception
∂∂ 
e
∂∂ 
)
∂∂ 
{
∑∑ 
throw
∏∏ 
e
∏∏ 
;
∏∏ 
}
ππ 
}
∫∫ 	
public
ºº 
Concepto_negocio
ºº ~
oObtenerConceptoDeNegocioPorCodigoBarraIncluyendoExistenciasYPreciosConUnPrecioVigenteComoMinimoParaActorNegocioºº  è
(ººè ê
intººê ì
idActorNegocioººî ¢
,ºº¢ £
intºº§ ß
idRolºº® ≠
,ºº≠ Æ
stringººØ µ
codigoBarraºº∂ ¡
)ºº¡ ¬
{
ΩΩ 	
try
ææ 
{
øø 
var
¿¿ 
	resultado
¿¿ 
=
¿¿ 
_db
¿¿  #
.
¿¿# $"
Concepto_negocio_rol
¿¿$ 8
.
¿¿8 9
Include
¿¿9 @
(
¿¿@ A
cnr
¿¿A D
=>
¿¿E G
cnr
¿¿H K
.
¿¿K L
Rol
¿¿L O
)
¿¿O P
.
¡¡ 
Include
¡¡ 
(
¡¡ 
cnr
¡¡  
=>
¡¡! #
cnr
¡¡$ '
.
¡¡' (
Concepto_negocio
¡¡( 8
)
¡¡8 9
.
¬¬ 
Include
¬¬ 
(
¬¬ 
cnr
¬¬  
=>
¬¬! #
cnr
¬¬$ '
.
¬¬' (
Concepto_negocio
¬¬( 8
.
¬¬8 9
Precio1
¬¬9 @
)
¬¬@ A
.
√√ 
Include
√√ 
(
√√ 
cnr
√√  
=>
√√! #
cnr
√√$ '
.
√√' (
Concepto_negocio
√√( 8
.
√√8 9

Existencia
√√9 C
)
√√C D
.
ƒƒ 
SingleOrDefault
ƒƒ $
(
ƒƒ$ %
cnr
ƒƒ% (
=>
ƒƒ) +
cnr
ƒƒ, /
.
ƒƒ/ 0
Concepto_negocio
ƒƒ0 @
.
ƒƒ@ A
codigo_barra
ƒƒA M
==
ƒƒN P
codigoBarra
ƒƒQ \
&&
ƒƒ] _
cnr
ƒƒ` c
.
ƒƒc d
id_rol
ƒƒd j
==
ƒƒk m
idRol
ƒƒn s
&&
≈≈ 
cnr
≈≈ 
.
≈≈ 
Concepto_negocio
≈≈ +
.
≈≈+ ,
Precio1
≈≈, 3
.
≈≈3 4
Any
≈≈4 7
(
≈≈7 8
p
≈≈8 9
=>
≈≈: <
p
≈≈= >
.
≈≈> ?
id_actor_negocio
≈≈? O
==
≈≈P R
idActorNegocio
≈≈S a
&&
≈≈b d
p
≈≈e f
.
≈≈f g

es_vigente
≈≈g q
)
≈≈q r
)
≈≈r s
;
≈≈s t
return
∆∆ 
	resultado
∆∆  
?
∆∆  !
.
∆∆! "
Concepto_negocio
∆∆" 2
;
∆∆2 3
}
«« 
catch
»» 
(
»» 
	Exception
»» 
e
»» 
)
»» 
{
…… 
throw
   
e
   
;
   
}
ÀÀ 
}
ÕÕ 	
public
œœ 
bool
œœ 0
"ExisteCodigoBarraEnConceptoVigente
œœ 6
(
œœ6 7
int
œœ7 :
idRol
œœ; @
,
œœ@ A
string
œœB H
codigoBarra
œœI T
)
œœT U
{
–– 	
try
—— 
{
““ 
var
”” 
	resultado
”” 
=
”” 
_db
””  #
.
””# $"
Concepto_negocio_rol
””$ 8
.
””8 9
Any
””9 <
(
””< =
cnr
””= @
=>
””A C
cnr
””D G
.
””G H
id_rol
””H N
==
””O Q
idRol
””R W
&&
””X Z
cnr
””[ ^
.
””^ _
Concepto_negocio
””_ o
.
””o p

es_vigente
””p z
&&
””{ }
cnr””~ Å
.””Å Ç 
Concepto_negocio””Ç í
.””í ì
codigo_barra””ì ü
==””† ¢
codigoBarra””£ Æ
&&””Ø ±
codigoBarra””≤ Ω
!=””æ ¿
null””¡ ≈
)””≈ ∆
;””∆ «
return
‘‘ 
	resultado
‘‘  
;
‘‘  !
}
’’ 
catch
÷÷ 
(
÷÷ 
	Exception
÷÷ 
e
÷÷ 
)
÷÷ 
{
◊◊ 
throw
ÿÿ 
e
ÿÿ 
;
ÿÿ 
}
ŸŸ 
}
⁄⁄ 	
public
‹‹ 
bool
‹‹ ;
-ExisteCodigoBarraEnConceptoVigenteAlActuaizar
‹‹ A
(
‹‹A B
int
‹‹B E

idConcepto
‹‹F P
,
‹‹P Q
int
‹‹R U
idRol
‹‹V [
,
‹‹[ \
string
‹‹] c
codigoBarra
‹‹d o
)
‹‹o p
{
›› 	
try
ﬁﬁ 
{
ﬂﬂ 
var
‡‡ 
	resultado
‡‡ 
=
‡‡ 
_db
‡‡  #
.
‡‡# $"
Concepto_negocio_rol
‡‡$ 8
.
‡‡8 9
Any
‡‡9 <
(
‡‡< =
cnr
‡‡= @
=>
‡‡A C
cnr
‡‡D G
.
‡‡G H
id_rol
‡‡H N
==
‡‡O Q
idRol
‡‡R W
&&
‡‡X Z
cnr
‡‡[ ^
.
‡‡^ _
Concepto_negocio
‡‡_ o
.
‡‡o p

es_vigente
‡‡p z
&&
‡‡{ }
cnr‡‡~ Å
.‡‡Å Ç 
Concepto_negocio‡‡Ç í
.‡‡í ì
codigo_barra‡‡ì ü
==‡‡† ¢
codigoBarra‡‡£ Æ
&&‡‡Ø ±
codigoBarra‡‡≤ Ω
!=‡‡æ ¿
null‡‡¡ ≈
&&‡‡∆ »
cnr‡‡… Ã
.‡‡Ã Õ 
Concepto_negocio‡‡Õ ›
.‡‡› ﬁ
id‡‡ﬁ ‡
!=‡‡· „

idConcepto‡‡‰ Ó
)‡‡Ó Ô
;‡‡Ô 
return
·· 
	resultado
··  
;
··  !
}
‚‚ 
catch
„„ 
(
„„ 
	Exception
„„ 
e
„„ 
)
„„ 
{
‰‰ 
throw
ÂÂ 
e
ÂÂ 
;
ÂÂ 
}
ÊÊ 
}
ÁÁ 	
public
ÍÍ 
IEnumerable
ÍÍ 
<
ÍÍ (
Concepto_Negocio_Comercial
ÍÍ 5
>
ÍÍ5 6r
cObtenerConceptosDeNegocioComercialesPorRolesYIdConceptoBasicoYIdCategoriaYIdsValoresCaracteristicasÍÍ7 ö
(ÍÍö õ
intÍÍõ û
[ÍÍû ü
]ÍÍü †
idsRolesÍÍ° ©
,ÍÍ© ™
intÍÍ´ Æ 
idConceptoBasicoÍÍØ ø
,ÍÍø ¿
intÍÍ¡ ƒ
idCategoriaÍÍ≈ –
,ÍÍ– —
intÍÍ“ ’
[ÍÍ’ ÷
]ÍÍ÷ ◊+
idsValoresDeCaracteristicasÍÍÿ Û
)ÍÍÛ Ù
{
ÎÎ 	
try
ÏÏ 
{
ÌÌ 
var
ÓÓ 
length
ÓÓ 
=
ÓÓ )
idsValoresDeCaracteristicas
ÓÓ 8
.
ÓÓ8 9
Length
ÓÓ9 ?
;
ÓÓ? @
var
ÔÔ 
	resultado
ÔÔ 
=
ÔÔ 
_db
ÔÔ  #
.
ÔÔ# $"
Concepto_negocio_rol
ÔÔ$ 8
.
ÔÔ8 9
Where
ÔÔ9 >
(
ÔÔ> ?
cnr
ÔÔ? B
=>
ÔÔC E
idsRoles
ÔÔF N
.
ÔÔN O
Contains
ÔÔO W
(
ÔÔW X
cnr
ÔÔX [
.
ÔÔ[ \
id_rol
ÔÔ\ b
)
ÔÔb c
)
ÔÔc d
.
8 9
Select
9 ?
(
? @
cnr
@ C
=>
D F
cnr
G J
.
J K
Concepto_negocio
K [
)
[ \
.
ÒÒ8 9
Where
ÒÒ9 >
(
ÒÒ> ?
cn
ÒÒ? A
=>
ÒÒB D
cn
ÒÒE G
.
ÒÒG H
Detalle_maestro4
ÒÒH X
.
ÒÒX Y 
Categoria_concepto
ÒÒY k
.
ÒÒk l
Select
ÒÒl r
(
ÒÒr s
cc
ÒÒs u
=>
ÒÒv x
cc
ÒÒy {
.
ÒÒ{ |
id_categoriaÒÒ| à
)ÒÒà â
.ÒÒâ ä
ContainsÒÒä í
(ÒÒí ì
idCategoriaÒÒì û
)ÒÒû ü
&&ÒÒ† ¢
cnÒÒ£ •
.ÒÒ• ¶"
id_concepto_basicoÒÒ¶ ∏
==ÒÒπ ª 
idConceptoBasicoÒÒº Ã
&&ÒÒÕ œ
cnÒÒ– “
.ÒÒ“ ”5
%Valor_caracteristica_concepto_negocioÒÒ” ¯
.ÒÒ¯ ˘
WhereÒÒ˘ ˛
(ÒÒ˛ ˇ
vccÒÒˇ Ç
=>ÒÒÉ Ö+
idsValoresDeCaracteristicasÒÒÜ °
.ÒÒ° ¢
ContainsÒÒ¢ ™
(ÒÒ™ ´
vccÒÒ´ Æ
.ÒÒÆ Ø'
id_valor_caracteristicaÒÒØ ∆
)ÒÒ∆ «
)ÒÒ« »
.ÒÒ» …
CountÒÒ… Œ
(ÒÒŒ œ
)ÒÒœ –
==ÒÒ— ”
lengthÒÒ‘ ⁄
&&ÒÒ€ ›
cnÒÒﬁ ‡
.ÒÒ‡ ·

es_vigenteÒÒ· Î
)ÒÒÎ Ï
.
ÚÚ8 9
Select
ÚÚ9 ?
(
ÚÚ? @
cn
ÚÚ@ B
=>
ÚÚC E
new
ÚÚF I(
Concepto_Negocio_Comercial
ÚÚJ d
(
ÚÚd e
)
ÚÚe f
{
ÛÛ8 9
Id
ÙÙ< >
=
ÙÙ? @
cn
ÙÙA C
.
ÙÙC D
id
ÙÙD F
,
ÙÙF G
Nombre
ıı< B
=
ııC D
cn
ııE G
.
ııG H
nombre
ııH N
,
ııN O
Codigo
ˆˆ< B
=
ˆˆC D
cn
ˆˆE G
.
ˆˆG H
codigo
ˆˆH N
,
ˆˆN O
CodigoBarra
˜˜< G
=
˜˜H I
cn
˜˜J L
.
˜˜L M
codigo_barra
˜˜M Y
,
˜˜Y Z 
NombrePresentacion
¯¯< N
=
¯¯O P
cn
¯¯Q S
.
¯¯S T
Detalle_maestro3
¯¯T d
.
¯¯d e
nombre
¯¯e k
,
¯¯k l
	Contenido
˘˘< E
=
˘˘F G
cn
˘˘H J
.
˘˘J K
	contenido
˘˘K T
,
˘˘T U,
CodigoUnidadMedidaPresentacion
˙˙< Z
=
˙˙[ \
cn
˙˙] _
.
˙˙_ `
Detalle_maestro1
˙˙` p
.
˙˙p q
codigo
˙˙q w
,
˙˙w x)
CodigoUnidadMedidaComercial
˚˚< W
=
˚˚X Y
cn
˚˚Z \
.
˚˚\ ]
Detalle_maestro
˚˚] l
.
˚˚l m
codigo
˚˚m s
}
¸¸8 9
)
¸¸9 :
;
¸¸: ;
return
˝˝ 
	resultado
˝˝  
;
˝˝  !
}
˛˛ 
catch
ˇˇ 
(
ˇˇ 
	Exception
ˇˇ 
e
ˇˇ 
)
ˇˇ 
{
ÄÄ 
throw
ÅÅ 
new
ÅÅ 
DatosException
ÅÅ (
(
ÅÅ( )
$str
ÅÅ) ~
,
ÅÅ~ 
eÅÅÄ Å
)ÅÅÅ Ç
;ÅÅÇ É
}
ÇÇ 
}
ÉÉ 	
public
ÑÑ 
IEnumerable
ÑÑ 
<
ÑÑ (
Concepto_Negocio_Comercial
ÑÑ 5
>
ÑÑ5 6f
WObtenerConceptosDeNegocioComercialesPorRolesYIdConceptoBasicoYIdsValoresCaracteristicasÑÑ7 é
(ÑÑé è
intÑÑè í
[ÑÑí ì
]ÑÑì î
idsRolesÑÑï ù
,ÑÑù û
intÑÑü ¢ 
idConceptoBasicoÑÑ£ ≥
,ÑÑ≥ ¥
intÑÑµ ∏
[ÑÑ∏ π
]ÑÑπ ∫+
idsValoresDeCaracteristicasÑÑª ÷
)ÑÑ÷ ◊
{
ÖÖ 	
try
ÜÜ 
{
áá 
var
àà 
length
àà 
=
àà )
idsValoresDeCaracteristicas
àà 8
.
àà8 9
Length
àà9 ?
;
àà? @
var
ââ 
	resultado
ââ 
=
ââ 
_db
ââ  #
.
ââ# $"
Concepto_negocio_rol
ââ$ 8
.
ââ8 9
Where
ââ9 >
(
ââ> ?
cnr
ââ? B
=>
ââC E
idsRoles
ââF N
.
ââN O
Contains
ââO W
(
ââW X
cnr
ââX [
.
ââ[ \
id_rol
ââ\ b
)
ââb c
)
ââc d
.
ää8 9
Select
ää9 ?
(
ää? @
cnr
ää@ C
=>
ääD F
cnr
ääG J
.
ääJ K
Concepto_negocio
ääK [
)
ää[ \
.
ãã8 9
Where
ãã9 >
(
ãã> ?
cn
ãã? A
=>
ããB D
cn
ããE G
.
ããG H 
id_concepto_basico
ããH Z
==
ãã[ ]
idConceptoBasico
ãã^ n
&&
ãão q
cn
ããr t
.
ããt u4
%Valor_caracteristica_concepto_negocioããu ö
.ããö õ
Whereããõ †
(ãã† °
vccãã° §
=>ãã• ß+
idsValoresDeCaracteristicasãã® √
.ãã√ ƒ
Containsããƒ Ã
(ããÃ Õ
vccããÕ –
.ãã– —'
id_valor_caracteristicaãã— Ë
)ããË È
)ããÈ Í
.ããÍ Î
CountããÎ 
(ãã Ò
)ããÒ Ú
==ããÛ ı
lengthããˆ ¸
&&ãã˝ ˇ
cnããÄ Ç
.ããÇ É

es_vigenteããÉ ç
)ããç é
.
åå8 9
Select
åå9 ?
(
åå? @
cn
åå@ B
=>
ååC E
new
ååF I(
Concepto_Negocio_Comercial
ååJ d
(
ååd e
)
ååe f
{
çç8 9
Id
éé< >
=
éé? @
cn
ééA C
.
ééC D
id
ééD F
,
ééF G
Nombre
èè< B
=
èèC D
cn
èèE G
.
èèG H
nombre
èèH N
,
èèN O
Codigo
êê< B
=
êêC D
cn
êêE G
.
êêG H
codigo
êêH N
,
êêN O
CodigoBarra
ëë< G
=
ëëH I
cn
ëëJ L
.
ëëL M
codigo_barra
ëëM Y
,
ëëY Z 
NombrePresentacion
íí< N
=
ííO P
cn
ííQ S
.
ííS T
Detalle_maestro3
ííT d
.
ííd e
nombre
ííe k
,
íík l
	Contenido
ìì< E
=
ììF G
cn
ììH J
.
ììJ K
	contenido
ììK T
,
ììT U,
CodigoUnidadMedidaPresentacion
îî< Z
=
îî[ \
cn
îî] _
.
îî_ `
Detalle_maestro1
îî` p
.
îîp q
codigo
îîq w
,
îîw x)
CodigoUnidadMedidaComercial
ïï< W
=
ïïX Y
cn
ïïZ \
.
ïï\ ]
Detalle_maestro
ïï] l
.
ïïl m
codigo
ïïm s
}
ññ8 9
)
ññ9 :
;
ññ: ;
return
óó 
	resultado
óó  
;
óó  !
}
òò 
catch
ôô 
(
ôô 
	Exception
ôô 
e
ôô 
)
ôô 
{
öö 
throw
õõ 
new
õõ 
DatosException
õõ (
(
õõ( )
$str
õõ) ~
,
õõ~ 
eõõÄ Å
)õõÅ Ç
;õõÇ É
}
úú 
}
ùù 	
public
ûû 
IEnumerable
ûû 
<
ûû (
Concepto_Negocio_Comercial
ûû 5
>
ûû5 6d
UObtenerConceptosDeNegociosComercialesPorRolesYIdCategoriaYIdsValoresDeCaracteristicasûû7 å
(ûûå ç
intûûç ê
[ûûê ë
]ûûë í
idsRolesûûì õ
,ûûõ ú
intûûù †
idCategoriaûû° ¨
,ûû¨ ≠
intûûÆ ±
[ûû± ≤
]ûû≤ ≥+
idsValoresDeCaracteristicasûû¥ œ
)ûûœ –
{
üü 	
try
†† 
{
°° 
var
¢¢ 
length
¢¢ 
=
¢¢ )
idsValoresDeCaracteristicas
¢¢ 8
.
¢¢8 9
Length
¢¢9 ?
;
¢¢? @
var
££ 
	resultado
££ 
=
££ 
_db
££  #
.
££# $"
Concepto_negocio_rol
££$ 8
.
££8 9
Where
££9 >
(
££> ?
cnr
££? B
=>
££C E
idsRoles
££F N
.
££N O
Contains
££O W
(
££W X
cnr
££X [
.
££[ \
id_rol
££\ b
)
££b c
)
££c d
.
§§8 9
Select
§§9 ?
(
§§? @
cnr
§§@ C
=>
§§D F
cnr
§§G J
.
§§J K
Concepto_negocio
§§K [
)
§§[ \
.
••8 9
Where
••9 >
(
••> ?
cn
••? A
=>
••B D
cn
••E G
.
••G H
Detalle_maestro4
••H X
.
••X Y 
Categoria_concepto
••Y k
.
••k l
Select
••l r
(
••r s
cc
••s u
=>
••v x
cc
••y {
.
••{ |
id_categoria••| à
)••à â
.••â ä
Contains••ä í
(••í ì
idCategoria••ì û
)••û ü
&&••† ¢
cn••£ •
.••• ¶5
%Valor_caracteristica_concepto_negocio••¶ À
.••À Ã
Where••Ã —
(••— “
vcc••“ ’
=>••÷ ÿ+
idsValoresDeCaracteristicas••Ÿ Ù
.••Ù ı
Contains••ı ˝
(••˝ ˛
vcc••˛ Å
.••Å Ç'
id_valor_caracteristica••Ç ô
)••ô ö
)••ö õ
.••õ ú
Count••ú °
(••° ¢
)••¢ £
==••§ ¶
length••ß ≠
&&••Æ ∞
cn••± ≥
.••≥ ¥

es_vigente••¥ æ
)••æ ø
.
¶¶8 9
Select
¶¶9 ?
(
¶¶? @
cn
¶¶@ B
=>
¶¶C E
new
¶¶F I(
Concepto_Negocio_Comercial
¶¶J d
(
¶¶d e
)
¶¶e f
{
ßß8 9
Id
®®< >
=
®®? @
cn
®®A C
.
®®C D
id
®®D F
,
®®F G
Nombre
©©< B
=
©©C D
cn
©©E G
.
©©G H
nombre
©©H N
,
©©N O
Codigo
™™< B
=
™™C D
cn
™™E G
.
™™G H
codigo
™™H N
,
™™N O
CodigoBarra
´´< G
=
´´H I
cn
´´J L
.
´´L M
codigo_barra
´´M Y
,
´´Y Z 
NombrePresentacion
¨¨< N
=
¨¨O P
cn
¨¨Q S
.
¨¨S T
Detalle_maestro3
¨¨T d
.
¨¨d e
nombre
¨¨e k
,
¨¨k l
	Contenido
≠≠< E
=
≠≠F G
cn
≠≠H J
.
≠≠J K
	contenido
≠≠K T
,
≠≠T U,
CodigoUnidadMedidaPresentacion
ÆÆ< Z
=
ÆÆ[ \
cn
ÆÆ] _
.
ÆÆ_ `
Detalle_maestro1
ÆÆ` p
.
ÆÆp q
codigo
ÆÆq w
,
ÆÆw x)
CodigoUnidadMedidaComercial
ØØ< W
=
ØØX Y
cn
ØØZ \
.
ØØ\ ]
Detalle_maestro
ØØ] l
.
ØØl m
codigo
ØØm s
}
∞∞8 9
)
∞∞9 :
;
∞∞: ;
return
±± 
	resultado
±±  
;
±±  !
}
≤≤ 
catch
≥≥ 
(
≥≥ 
	Exception
≥≥ 
e
≥≥ 
)
≥≥ 
{
¥¥ 
throw
µµ 
new
µµ 
DatosException
µµ (
(
µµ( )
$str
µµ) l
,
µµl m
e
µµn o
)
µµo p
;
µµp q
}
∂∂ 
}
∑∑ 	
public
∏∏ 
IEnumerable
∏∏ 
<
∏∏ (
Concepto_Negocio_Comercial
∏∏ 5
>
∏∏5 6X
IObtenerConceptosDeNegociosComercialesPorRolesYIdsValoresDeCaracteristicas∏∏7 Ä
(∏∏Ä Å
int∏∏Å Ñ
[∏∏Ñ Ö
]∏∏Ö Ü
idsRoles∏∏á è
,∏∏è ê
int∏∏ë î
[∏∏î ï
]∏∏ï ñ+
idsValoresDeCaracteristicas∏∏ó ≤
)∏∏≤ ≥
{
ππ 	
try
∫∫ 
{
ªª 
var
ºº 
length
ºº 
=
ºº )
idsValoresDeCaracteristicas
ºº 8
.
ºº8 9
Length
ºº9 ?
;
ºº? @
var
ΩΩ 
	resultado
ΩΩ 
=
ΩΩ 
_db
ΩΩ  #
.
ΩΩ# $"
Concepto_negocio_rol
ΩΩ$ 8
.
ΩΩ8 9
Where
ΩΩ9 >
(
ΩΩ> ?
cnr
ΩΩ? B
=>
ΩΩC E
idsRoles
ΩΩF N
.
ΩΩN O
Contains
ΩΩO W
(
ΩΩW X
cnr
ΩΩX [
.
ΩΩ[ \
id_rol
ΩΩ\ b
)
ΩΩb c
)
ΩΩc d
.
ææ8 9
Select
ææ9 ?
(
ææ? @
cnr
ææ@ C
=>
ææD F
cnr
ææG J
.
ææJ K
Concepto_negocio
ææK [
)
ææ[ \
.
øø8 9
Where
øø9 >
(
øø> ?
cn
øø? A
=>
øøB D
cn
øøE G
.
øøG H3
%Valor_caracteristica_concepto_negocio
øøH m
.
øøm n
Where
øøn s
(
øøs t
vcc
øøt w
=>
øøx z*
idsValoresDeCaracteristicasøø{ ñ
.øøñ ó
Containsøøó ü
(øøü †
vccøø† £
.øø£ §'
id_valor_caracteristicaøø§ ª
)øøª º
)øøº Ω
.øøΩ æ
Countøøæ √
(øø√ ƒ
)øøƒ ≈
==øø∆ »
lengthøø… œ
&&øø– “
cnøø” ’
.øø’ ÷

es_vigenteøø÷ ‡
)øø‡ ·
.
¿¿8 9
Select
¿¿9 ?
(
¿¿? @
cn
¿¿@ B
=>
¿¿C E
new
¿¿F I(
Concepto_Negocio_Comercial
¿¿J d
(
¿¿d e
)
¿¿e f
{
¡¡8 9
Id
¬¬< >
=
¬¬? @
cn
¬¬A C
.
¬¬C D
id
¬¬D F
,
¬¬F G
Nombre
√√< B
=
√√C D
cn
√√E G
.
√√G H
nombre
√√H N
,
√√N O
Codigo
ƒƒ< B
=
ƒƒC D
cn
ƒƒE G
.
ƒƒG H
codigo
ƒƒH N
,
ƒƒN O
CodigoBarra
≈≈< G
=
≈≈H I
cn
≈≈J L
.
≈≈L M
codigo_barra
≈≈M Y
,
≈≈Y Z 
NombrePresentacion
∆∆< N
=
∆∆O P
cn
∆∆Q S
.
∆∆S T
Detalle_maestro3
∆∆T d
.
∆∆d e
nombre
∆∆e k
,
∆∆k l
	Contenido
««< E
=
««F G
cn
««H J
.
««J K
	contenido
««K T
,
««T U,
CodigoUnidadMedidaPresentacion
»»< Z
=
»»[ \
cn
»»] _
.
»»_ `
Detalle_maestro1
»»` p
.
»»p q
codigo
»»q w
,
»»w x)
CodigoUnidadMedidaComercial
……< W
=
……X Y
cn
……Z \
.
……\ ]
Detalle_maestro
……] l
.
……l m
codigo
……m s
}
  8 9
)
  9 :
;
  : ;
return
ÀÀ 
	resultado
ÀÀ  
;
ÀÀ  !
}
ÃÃ 
catch
ÕÕ 
(
ÕÕ 
	Exception
ÕÕ 
e
ÕÕ 
)
ÕÕ 
{
ŒŒ 
throw
œœ 
new
œœ 
DatosException
œœ (
(
œœ( )
$str
œœ) l
,
œœl m
e
œœn o
)
œœo p
;
œœp q
}
–– 
}
—— 	
public
““ 
IEnumerable
““ 
<
““ (
Concepto_Negocio_Comercial
““ 5
>
““5 6X
IObtenerConceptosDeNegocioComercialesPorRolesYIdConceptoBasicoYIdCategoria““7 Ä
(““Ä Å
int““Å Ñ
[““Ñ Ö
]““Ö Ü
idsRoles““á è
,““è ê
int““ë î 
idConceptoBasico““ï •
,““• ¶
int““ß ™
idCategoria““´ ∂
)““∂ ∑
{
”” 	
try
‘‘ 
{
’’ 
var
÷÷ 
	resultado
÷÷ 
=
÷÷ 
_db
÷÷  #
.
÷÷# $"
Concepto_negocio_rol
÷÷$ 8
.
÷÷8 9
Where
÷÷9 >
(
÷÷> ?
cnr
÷÷? B
=>
÷÷C E
idsRoles
÷÷F N
.
÷÷N O
Contains
÷÷O W
(
÷÷W X
cnr
÷÷X [
.
÷÷[ \
id_rol
÷÷\ b
)
÷÷b c
)
÷÷c d
.
◊◊: ;
Select
◊◊; A
(
◊◊A B
cnr
◊◊B E
=>
◊◊F H
cnr
◊◊I L
.
◊◊L M
Concepto_negocio
◊◊M ]
)
◊◊] ^
.
◊◊^ _
Where
◊◊_ d
(
◊◊d e
cn
◊◊e g
=>
◊◊h j
cn
◊◊k m
.
◊◊m n
Detalle_maestro4
◊◊n ~
.
◊◊~ !
Categoria_concepto◊◊ ë
.◊◊ë í
Select◊◊í ò
(◊◊ò ô
cc◊◊ô õ
=>◊◊ú û
cc◊◊ü °
.◊◊° ¢
id_categoria◊◊¢ Æ
)◊◊Æ Ø
.◊◊Ø ∞
Contains◊◊∞ ∏
(◊◊∏ π
idCategoria◊◊π ƒ
)◊◊ƒ ≈
&&◊◊∆ »
cn◊◊… À
.◊◊À Ã"
id_concepto_basico◊◊Ã ﬁ
==◊◊ﬂ · 
idConceptoBasico◊◊‚ Ú
&&◊◊Û ı
cn◊◊ˆ ¯
.◊◊¯ ˘

es_vigente◊◊˘ É
)◊◊É Ñ
.
ÿÿ: ;
Select
ÿÿ; A
(
ÿÿA B
cn
ÿÿB D
=>
ÿÿE G
new
ÿÿH K(
Concepto_Negocio_Comercial
ÿÿL f
(
ÿÿf g
)
ÿÿg h
{
ŸŸ: ;
Id
⁄⁄> @
=
⁄⁄A B
cn
⁄⁄C E
.
⁄⁄E F
id
⁄⁄F H
,
⁄⁄H I
Nombre
€€> D
=
€€E F
cn
€€G I
.
€€I J
nombre
€€J P
,
€€P Q
Codigo
‹‹> D
=
‹‹E F
cn
‹‹G I
.
‹‹I J
codigo
‹‹J P
,
‹‹P Q
CodigoBarra
››> I
=
››J K
cn
››L N
.
››N O
codigo_barra
››O [
,
››[ \ 
NombrePresentacion
ﬁﬁ> P
=
ﬁﬁQ R
cn
ﬁﬁS U
.
ﬁﬁU V
Detalle_maestro3
ﬁﬁV f
.
ﬁﬁf g
nombre
ﬁﬁg m
,
ﬁﬁm n
	Contenido
ﬂﬂ> G
=
ﬂﬂH I
cn
ﬂﬂJ L
.
ﬂﬂL M
	contenido
ﬂﬂM V
,
ﬂﬂV W,
CodigoUnidadMedidaPresentacion
‡‡> \
=
‡‡] ^
cn
‡‡_ a
.
‡‡a b
Detalle_maestro1
‡‡b r
.
‡‡r s
codigo
‡‡s y
,
‡‡y z)
CodigoUnidadMedidaComercial
··> Y
=
··Z [
cn
··\ ^
.
··^ _
Detalle_maestro
··_ n
.
··n o
codigo
··o u
}
‚‚: ;
)
‚‚; <
;
‚‚< =
return
„„ 
	resultado
„„  
;
„„  !
}
‰‰ 
catch
ÂÂ 
(
ÂÂ 
	Exception
ÂÂ 
e
ÂÂ 
)
ÂÂ 
{
ÊÊ 
throw
ÁÁ 
new
ÁÁ 
DatosException
ÁÁ (
(
ÁÁ( )
$str
ÁÁ) m
,
ÁÁm n
e
ÁÁo p
)
ÁÁp q
;
ÁÁq r
}
ËË 
}
ÈÈ 	
public
ÍÍ 
IEnumerable
ÍÍ 
<
ÍÍ (
Concepto_Negocio_Comercial
ÍÍ 5
>
ÍÍ5 6K
=ObtenerConceptosDeNegocioComercialesPorRolesYIdConceptoBasico
ÍÍ7 t
(
ÍÍt u
int
ÍÍu x
[
ÍÍx y
]
ÍÍy z
idsRolesÍÍ{ É
,ÍÍÉ Ñ
intÍÍÖ à 
idConceptoBasicoÍÍâ ô
)ÍÍô ö
{
ÎÎ 	
try
ÏÏ 
{
ÌÌ 
var
ÓÓ 
	resultado
ÓÓ 
=
ÓÓ 
_db
ÓÓ  #
.
ÓÓ# $"
Concepto_negocio_rol
ÓÓ$ 8
.
ÓÓ8 9
Where
ÓÓ9 >
(
ÓÓ> ?
cnr
ÓÓ? B
=>
ÓÓC E
idsRoles
ÓÓF N
.
ÓÓN O
Contains
ÓÓO W
(
ÓÓW X
cnr
ÓÓX [
.
ÓÓ[ \
id_rol
ÓÓ\ b
)
ÓÓb c
)
ÓÓc d
.
ÔÔ: ;
Select
ÔÔ; A
(
ÔÔA B
cnr
ÔÔB E
=>
ÔÔF H
cnr
ÔÔI L
.
ÔÔL M
Concepto_negocio
ÔÔM ]
)
ÔÔ] ^
.
ÔÔ^ _
Where
ÔÔ_ d
(
ÔÔd e
cn
ÔÔe g
=>
ÔÔh j
cn
ÔÔk m
.
ÔÔm n!
id_concepto_basicoÔÔn Ä
==ÔÔÅ É 
idConceptoBasicoÔÔÑ î
&&ÔÔï ó
cnÔÔò ö
.ÔÔö õ

es_vigenteÔÔõ •
)ÔÔ• ¶
.
: ;
Select
; A
(
A B
cn
B D
=>
E G
new
H K(
Concepto_Negocio_Comercial
L f
(
f g
)
g h
{
ÒÒ: ;
Id
ÚÚ> @
=
ÚÚA B
cn
ÚÚC E
.
ÚÚE F
id
ÚÚF H
,
ÚÚH I
Nombre
ÛÛ> D
=
ÛÛE F
cn
ÛÛG I
.
ÛÛI J
nombre
ÛÛJ P
,
ÛÛP Q
Codigo
ÙÙ> D
=
ÙÙE F
cn
ÙÙG I
.
ÙÙI J
codigo
ÙÙJ P
,
ÙÙP Q
CodigoBarra
ıı> I
=
ııJ K
cn
ııL N
.
ııN O
codigo_barra
ııO [
,
ıı[ \ 
NombrePresentacion
ˆˆ> P
=
ˆˆQ R
cn
ˆˆS U
.
ˆˆU V
Detalle_maestro3
ˆˆV f
.
ˆˆf g
nombre
ˆˆg m
,
ˆˆm n
	Contenido
˜˜> G
=
˜˜H I
cn
˜˜J L
.
˜˜L M
	contenido
˜˜M V
,
˜˜V W,
CodigoUnidadMedidaPresentacion
¯¯> \
=
¯¯] ^
cn
¯¯_ a
.
¯¯a b
Detalle_maestro1
¯¯b r
.
¯¯r s
codigo
¯¯s y
,
¯¯y z)
CodigoUnidadMedidaComercial
˘˘> Y
=
˘˘Z [
cn
˘˘\ ^
.
˘˘^ _
Detalle_maestro
˘˘_ n
.
˘˘n o
codigo
˘˘o u
}
˙˙: ;
)
˙˙; <
;
˙˙< =
return
˚˚ 
	resultado
˚˚  
;
˚˚  !
}
¸¸ 
catch
˝˝ 
(
˝˝ 
	Exception
˝˝ 
e
˝˝ 
)
˝˝ 
{
˛˛ 
throw
ˇˇ 
new
ˇˇ 
DatosException
ˇˇ (
(
ˇˇ( )
$str
ˇˇ) m
,
ˇˇm n
e
ˇˇo p
)
ˇˇp q
;
ˇˇq r
}
ÄÄ 
}
ÅÅ 	
public
ÇÇ 
IEnumerable
ÇÇ 
<
ÇÇ (
Concepto_Negocio_Comercial
ÇÇ 5
>
ÇÇ5 6F
8ObtenerConceptosDeNegocioComercialesPorRolesYIdCategoria
ÇÇ7 o
(
ÇÇo p
int
ÇÇp s
[
ÇÇs t
]
ÇÇt u
idsRoles
ÇÇv ~
,
ÇÇ~ 
intÇÇÄ É
idCategoriaÇÇÑ è
)ÇÇè ê
{
ÉÉ 	
try
ÑÑ 
{
ÖÖ 
var
ÜÜ 
	resultado
ÜÜ 
=
ÜÜ 
_db
ÜÜ  #
.
ÜÜ# $"
Concepto_negocio_rol
ÜÜ$ 8
.
ÜÜ8 9
Where
ÜÜ9 >
(
ÜÜ> ?
cnr
ÜÜ? B
=>
ÜÜC E
idsRoles
ÜÜF N
.
ÜÜN O
Contains
ÜÜO W
(
ÜÜW X
cnr
ÜÜX [
.
ÜÜ[ \
id_rol
ÜÜ\ b
)
ÜÜb c
)
ÜÜc d
.
áá: ;
Select
áá; A
(
ááA B
cnr
ááB E
=>
ááF H
cnr
ááI L
.
ááL M
Concepto_negocio
ááM ]
)
áá] ^
.
áá^ _
Where
áá_ d
(
áád e
cn
ááe g
=>
ááh j
cn
áák m
.
áám n
Detalle_maestro4
áán ~
.
áá~ !
Categoria_conceptoáá ë
.ááë í
Selectááí ò
(ááò ô
ccááô õ
=>ááú û
ccááü °
.áá° ¢
id_categoriaáá¢ Æ
)ááÆ Ø
.ááØ ∞
Containsáá∞ ∏
(áá∏ π
idCategoriaááπ ƒ
)ááƒ ≈
&&áá∆ »
cnáá… À
.ááÀ Ã

es_vigenteááÃ ÷
)áá÷ ◊
.
àà: ;
Select
àà; A
(
ààA B
cn
ààB D
=>
ààE G
new
ààH K(
Concepto_Negocio_Comercial
ààL f
(
ààf g
)
ààg h
{
ââ: ;
Id
ää> @
=
ääA B
cn
ääC E
.
ääE F
id
ääF H
,
ääH I
Nombre
ãã> D
=
ããE F
cn
ããG I
.
ããI J
nombre
ããJ P
,
ããP Q
Codigo
åå> D
=
ååE F
cn
ååG I
.
ååI J
codigo
ååJ P
,
ååP Q
CodigoBarra
çç> I
=
ççJ K
cn
ççL N
.
ççN O
codigo_barra
ççO [
,
çç[ \ 
NombrePresentacion
éé> P
=
ééQ R
cn
ééS U
.
ééU V
Detalle_maestro3
ééV f
.
ééf g
nombre
éég m
,
éém n
	Contenido
èè> G
=
èèH I
cn
èèJ L
.
èèL M
	contenido
èèM V
,
èèV W,
CodigoUnidadMedidaPresentacion
êê> \
=
êê] ^
cn
êê_ a
.
êêa b
Detalle_maestro1
êêb r
.
êêr s
codigo
êês y
,
êêy z)
CodigoUnidadMedidaComercial
ëë> Y
=
ëëZ [
cn
ëë\ ^
.
ëë^ _
Detalle_maestro
ëë_ n
.
ëën o
codigo
ëëo u
}
íí: ;
)
íí; <
;
íí< =
return
ìì 
	resultado
ìì  
;
ìì  !
}
îî 
catch
ïï 
(
ïï 
	Exception
ïï 
e
ïï 
)
ïï 
{
ññ 
throw
óó 
new
óó 
DatosException
óó (
(
óó( )
$str
óó) [
,
óó[ \
e
óó] ^
)
óó^ _
;
óó_ `
}
òò 
}
ôô 	
public
öö 
IEnumerable
öö 
<
öö (
Concepto_Negocio_Comercial
öö 5
>
öö5 6:
,ObtenerConceptosDeNegocioComercialesPorRoles
öö7 c
(
ööc d
int
ööd g
[
öög h
]
ööh i
idsRoles
ööj r
)
öör s
{
õõ 	
try
úú 
{
ùù 
var
ûû 
	resultado
ûû 
=
ûû 
_db
ûû  #
.
ûû# $"
Concepto_negocio_rol
ûû$ 8
.
ûû8 9
Where
ûû9 >
(
ûû> ?
cnr
ûû? B
=>
ûûC E
idsRoles
ûûF N
.
ûûN O
Contains
ûûO W
(
ûûW X
cnr
ûûX [
.
ûû[ \
id_rol
ûû\ b
)
ûûb c
)
ûûc d
.
üü: ;
Select
üü; A
(
üüA B
cnr
üüB E
=>
üüF H
cnr
üüI L
.
üüL M
Concepto_negocio
üüM ]
)
üü] ^
.
üü^ _
Where
üü_ d
(
üüd e
cn
üüe g
=>
üüh j
cn
üük m
.
üüm n

es_vigente
üün x
)
üüx y
.
††: ;
Select
††; A
(
††A B
cn
††B D
=>
††E G
new
††H K(
Concepto_Negocio_Comercial
††L f
(
††f g
)
††g h
{
°°: ;
Id
¢¢> @
=
¢¢A B
cn
¢¢C E
.
¢¢E F
id
¢¢F H
,
¢¢H I
Nombre
££> D
=
££E F
cn
££G I
.
££I J
nombre
££J P
,
££P Q
Codigo
§§> D
=
§§E F
cn
§§G I
.
§§I J
codigo
§§J P
,
§§P Q
CodigoBarra
••> I
=
••J K
cn
••L N
.
••N O
codigo_barra
••O [
,
••[ \ 
NombrePresentacion
¶¶> P
=
¶¶Q R
cn
¶¶S U
.
¶¶U V
Detalle_maestro3
¶¶V f
.
¶¶f g
nombre
¶¶g m
,
¶¶m n
	Contenido
ßß> G
=
ßßH I
cn
ßßJ L
.
ßßL M
	contenido
ßßM V
,
ßßV W,
CodigoUnidadMedidaPresentacion
®®> \
=
®®] ^
cn
®®_ a
.
®®a b
Detalle_maestro1
®®b r
.
®®r s
codigo
®®s y
,
®®y z)
CodigoUnidadMedidaComercial
©©> Y
=
©©Z [
cn
©©\ ^
.
©©^ _
Detalle_maestro
©©_ n
.
©©n o
codigo
©©o u
}
™™: ;
)
™™; <
;
™™< =
return
´´ 
	resultado
´´  
;
´´  !
}
¨¨ 
catch
≠≠ 
(
≠≠ 
	Exception
≠≠ 
e
≠≠ 
)
≠≠ 
{
ÆÆ 
throw
ØØ 
new
ØØ 
DatosException
ØØ (
(
ØØ( )
$str
ØØ) [
,
ØØ[ \
e
ØØ] ^
)
ØØ^ _
;
ØØ_ `
}
∞∞ 
}
±± 	
public
µµ 
IEnumerable
µµ 
<
µµ (
Concepto_Negocio_Comercial
µµ 5
>
µµ5 6à
yObtenerConceptosDeNegocioComercialesPorRolesYIdConceptoBasicoYIdCategoriaYIdsValoresCaracteristicasInclyendoStockYPreciosµµ7 ∞
(µµ∞ ±
longµµ± µ&
idTransaccionExistenteµµ∂ Ã
,µµÃ Õ
intµµŒ —7
'idActorNegocioInternoQueTieneLosPreciosµµ“ ˘
,µµ˘ ˙
intµµ˚ ˛
[µµ˛ ˇ
]µµˇ Ä
idsRolesµµÅ â
,µµâ ä
intµµã é
idTarifaµµè ó
,µµó ò
intµµô ú
[µµú ù
]µµù û#
idsTiposTransaccionµµü ≤
,µµ≤ ≥
intµµ¥ ∑ 
idConceptoBasicoµµ∏ »
,µµ» …
intµµ  Õ
idCategoriaµµŒ Ÿ
,µµŸ ⁄
intµµ€ ﬁ
[µµﬁ ﬂ
]µµﬂ ‡+
idsValoresDeCaracteristicasµµ· ¸
)µµ¸ ˝
{
∂∂ 	
try
∑∑ 
{
∏∏ 
var
ππ 
length
ππ 
=
ππ )
idsValoresDeCaracteristicas
ππ 8
.
ππ8 9
Length
ππ9 ?
;
ππ? @
var
∫∫ 
	resultado
∫∫ 
=
∫∫ 
_db
∫∫  #
.
∫∫# $"
Concepto_negocio_rol
∫∫$ 8
.
∫∫8 9
Where
∫∫9 >
(
∫∫> ?
cnr
∫∫? B
=>
∫∫C E
idsRoles
∫∫F N
.
∫∫N O
Contains
∫∫O W
(
∫∫W X
cnr
∫∫X [
.
∫∫[ \
id_rol
∫∫\ b
)
∫∫b c
)
∫∫c d
.
ªª8 9
Select
ªª9 ?
(
ªª? @
cnr
ªª@ C
=>
ªªD F
cnr
ªªG J
.
ªªJ K
Concepto_negocio
ªªK [
)
ªª[ \
.
ºº8 9
Where
ºº9 >
(
ºº> ?
cn
ºº? A
=>
ººB D
cn
ººE G
.
ººG H
Detalle_maestro4
ººH X
.
ººX Y 
Categoria_concepto
ººY k
.
ººk l
Select
ººl r
(
ººr s
cc
ººs u
=>
ººv x
cc
ººy {
.
ºº{ |
id_categoriaºº| à
)ººà â
.ººâ ä
Containsººä í
(ººí ì
idCategoriaººì û
)ººû ü
&&ºº† ¢
cnºº£ •
.ºº• ¶

es_vigenteºº¶ ∞
)ºº∞ ±
.
ΩΩ8 9
Where
ΩΩ9 >
(
ΩΩ> ?
cn
ΩΩ? A
=>
ΩΩB D
cn
ΩΩE G
.
ΩΩG H 
id_concepto_basico
ΩΩH Z
==
ΩΩ[ ]
idConceptoBasico
ΩΩ^ n
&&
ææ8 :
cn
ææ; =
.
ææ= >3
%Valor_caracteristica_concepto_negocio
ææ> c
.
ææc d
Where
ææd i
(
ææi j
vcc
ææj m
=>
ææn p*
idsValoresDeCaracteristicasææq å
.ææå ç
Containsææç ï
(ææï ñ
vccææñ ô
.ææô ö'
id_valor_caracteristicaææö ±
)ææ± ≤
)ææ≤ ≥
.ææ≥ ¥
Countææ¥ π
(ææπ ∫
)ææ∫ ª
==ææº æ
lengthææø ≈
)ææ≈ ∆
.
øø! "
Select
øø" (
(
øø( )
cn
øø) +
=>
øø, .
new
øø/ 2(
Concepto_Negocio_Comercial
øø3 M
(
øøM N
)
øøN O
{
¿¿! "
Id
¡¡% '
=
¡¡( )
cn
¡¡* ,
.
¡¡, -
id
¡¡- /
,
¡¡/ 0
Nombre
¬¬% +
=
¬¬, -
cn
¬¬. 0
.
¬¬0 1
nombre
¬¬1 7
,
¬¬7 8
Codigo
√√% +
=
√√, -
cn
√√. 0
.
√√0 1
codigo
√√1 7
,
√√7 8
CodigoBarra
ƒƒ% 0
=
ƒƒ1 2
cn
ƒƒ3 5
.
ƒƒ5 6
codigo_barra
ƒƒ6 B
,
ƒƒB C 
NombrePresentacion
≈≈% 7
=
≈≈8 9
cn
≈≈: <
.
≈≈< =
Detalle_maestro3
≈≈= M
.
≈≈M N
nombre
≈≈N T
,
≈≈T U
	Contenido
∆∆% .
=
∆∆/ 0
cn
∆∆1 3
.
∆∆3 4
	contenido
∆∆4 =
,
∆∆= >,
CodigoUnidadMedidaPresentacion
««% C
=
««D E
cn
««F H
.
««H I
Detalle_maestro1
««I Y
.
««Y Z
codigo
««Z `
,
««` a)
CodigoUnidadMedidaComercial
»»% @
=
»»A B
cn
»»C E
.
»»E F
Detalle_maestro
»»F U
.
»»U V
codigo
»»V \
,
»»\ ]
Stock
……% *
=
……+ ,
cn
……- /
.
……/ 0!
Detalle_transaccion
……0 C
.
……C D
Where
……D I
(
……I J
dt
……J L
=>
……M O
dt
……P R
.
……R S
id_transaccion
……S a
==
……b d$
idTransaccionExistente
……e {
)
……{ |
.
……| }
Sum……} Ä
(……Ä Å
dt……Å É
=>……Ñ Ü
dt……á â
.……â ä
cantidad……ä í
)……í ì
,……ì î
PrecioVenta
  % 0
=
  1 2
cn
  3 5
.
  5 6
Precio1
  6 =
.
  = >
Where
  > C
(
  C D
p
  D E
=>
  F H
p
  I J
.
  J K
id_actor_negocio
  K [
==
  \ ^6
'idActorNegocioInternoQueTieneLosPrecios  _ Ü
&&  á â
p  ä ã
.  ã å

es_vigente  å ñ
&&  ó ô
p  ö õ
.  õ ú
id_tarifa_d  ú ß
==  ® ™
idTarifa  ´ ≥
)  ≥ ¥
.
ÀÀ= >
OrderByDescending
ÀÀ> O
(
ÀÀO P
p
ÀÀP Q
=>
ÀÀR T
p
ÀÀU V
.
ÀÀV W
id
ÀÀW Y
)
ÀÀY Z
.
ÃÃ= >
FirstOrDefault
ÃÃ> L
(
ÃÃL M
)
ÃÃM N
.
ÃÃN O
valor
ÃÃO T
,
ÃÃT U
CostoUnitario
ÕÕ% 2
=
ÕÕ3 4
cn
ÕÕ5 7
.
ÕÕ7 8!
Detalle_transaccion
ÕÕ8 K
.
ÕÕK L
Where
ÕÕL Q
(
ÕÕQ R
d
ÕÕR S
=>
ÕÕT V
d
ÕÕW X
.
ÕÕX Y
Transaccion
ÕÕY d
.
ÕÕd e&
id_actor_negocio_interno
ÕÕe }
==ÕÕ~ Ä7
'idActorNegocioInternoQueTieneLosPreciosÕÕÅ ®
&&ÕÕ© ´#
idsTiposTransaccionÕÕ¨ ø
.ÕÕø ¿
ContainsÕÕ¿ »
(ÕÕ» …
dÕÕ…  
.ÕÕ  À
TransaccionÕÕÀ ÷
.ÕÕ÷ ◊#
id_tipo_transaccionÕÕ◊ Í
)ÕÕÍ Î
&&ÕÕÏ Ó
dÕÕÔ 
.ÕÕ Ò
TransaccionÕÕÒ ¸
.ÕÕ¸ ˝ 
id_estado_actualÕÕ˝ ç
==ÕÕé ê
MaestroSettingsÕÕë †
.ÕÕ† °
DefaultÕÕ° ®
.ÕÕ® ©0
 IdDetalleMaestroEstadoConfirmadoÕÕ© …
)ÕÕ…  
.
ŒŒK L
OrderByDescending
ŒŒL ]
(
ŒŒ] ^
dt
ŒŒ^ `
=>
ŒŒa c
dt
ŒŒd f
.
ŒŒf g
Transaccion
ŒŒg r
.
ŒŒr s
fecha_inicio
ŒŒs 
)ŒŒ Ä
.
œœK L
ThenByDescending
œœL \
(
œœ\ ]
dt
œœ] _
=>
œœ` b
dt
œœc e
.
œœe f
id
œœf h
)
œœh i
.
––K L
FirstOrDefault
––L Z
(
––Z [
)
––[ \
.
––\ ]
precio_unitario
––] l
}
——! "
)
——" #
;
——# $
return
““ 
	resultado
““  
;
““  !
}
”” 
catch
‘‘ 
(
‘‘ 
	Exception
‘‘ 
e
‘‘ 
)
‘‘ 
{
’’ 
throw
÷÷ 
new
÷÷ 
DatosException
÷÷ (
(
÷÷( )
$str
÷÷) v
,
÷÷v w
e
÷÷x y
)
÷÷y z
;
÷÷z {
}
◊◊ 
}
ÿÿ 	
public
ŸŸ 
IEnumerable
ŸŸ 
<
ŸŸ (
Concepto_Negocio_Comercial
ŸŸ 5
>
ŸŸ5 6|
mObtenerConceptosDeNegocioComercialesPorRolesYIdConceptoBasicoYIdsValoresCaracteristicasInclyendoStockYPreciosŸŸ7 §
(ŸŸ§ •
longŸŸ• ©&
idTransaccionExistenteŸŸ™ ¿
,ŸŸ¿ ¡
intŸŸ¬ ≈7
'idActorNegocioInternoQueTieneLosPreciosŸŸ∆ Ì
,ŸŸÌ Ó
intŸŸÔ Ú
[ŸŸÚ Û
]ŸŸÛ Ù
idsRolesŸŸı ˝
,ŸŸ˝ ˛
intŸŸˇ Ç
idTarifaŸŸÉ ã
,ŸŸã å
intŸŸç ê
[ŸŸê ë
]ŸŸë í#
idsTiposTransaccionŸŸì ¶
,ŸŸ¶ ß
intŸŸ® ´ 
idConceptoBasicoŸŸ¨ º
,ŸŸº Ω
intŸŸæ ¡
[ŸŸ¡ ¬
]ŸŸ¬ √+
idsValoresDeCaracteristicasŸŸƒ ﬂ
)ŸŸﬂ ‡
{
⁄⁄ 	
try
€€ 
{
‹‹ 
var
›› 
length
›› 
=
›› )
idsValoresDeCaracteristicas
›› 8
.
››8 9
Length
››9 ?
;
››? @
var
ﬁﬁ 
	resultado
ﬁﬁ 
=
ﬁﬁ 
_db
ﬁﬁ  #
.
ﬁﬁ# $"
Concepto_negocio_rol
ﬁﬁ$ 8
.
ﬁﬁ8 9
Where
ﬁﬁ9 >
(
ﬁﬁ> ?
cnr
ﬁﬁ? B
=>
ﬁﬁC E
idsRoles
ﬁﬁF N
.
ﬁﬁN O
Contains
ﬁﬁO W
(
ﬁﬁW X
cnr
ﬁﬁX [
.
ﬁﬁ[ \
id_rol
ﬁﬁ\ b
)
ﬁﬁb c
)
ﬁﬁc d
.
ﬂﬂ8 9
Select
ﬂﬂ9 ?
(
ﬂﬂ? @
cnr
ﬂﬂ@ C
=>
ﬂﬂD F
cnr
ﬂﬂG J
.
ﬂﬂJ K
Concepto_negocio
ﬂﬂK [
)
ﬂﬂ[ \
.
‡‡8 9
Where
‡‡9 >
(
‡‡> ?
cn
‡‡? A
=>
‡‡B D
cn
‡‡E G
.
‡‡G H

es_vigente
‡‡H R
)
‡‡R S
.
··8 9
Where
··9 >
(
··> ?
cn
··? A
=>
··B D
cn
‚‚8 :
.
‚‚: ; 
id_concepto_basico
‚‚; M
==
‚‚N P
idConceptoBasico
‚‚Q a
&&
„„8 :
cn
„„; =
.
„„= >3
%Valor_caracteristica_concepto_negocio
„„> c
.
„„c d
Where
„„d i
(
„„i j
vcc
„„j m
=>
„„n p*
idsValoresDeCaracteristicas„„q å
.„„å ç
Contains„„ç ï
(„„ï ñ
vcc„„ñ ô
.„„ô ö'
id_valor_caracteristica„„ö ±
)„„± ≤
)„„≤ ≥
.„„≥ ¥
Count„„¥ π
(„„π ∫
)„„∫ ª
==„„º æ
length„„ø ≈
)„„≈ ∆
.
‰‰! "
Select
‰‰" (
(
‰‰( )
cn
‰‰) +
=>
‰‰, .
new
‰‰/ 2(
Concepto_Negocio_Comercial
‰‰3 M
(
‰‰M N
)
‰‰N O
{
ÂÂ! "
Id
ÊÊ% '
=
ÊÊ( )
cn
ÊÊ* ,
.
ÊÊ, -
id
ÊÊ- /
,
ÊÊ/ 0
Nombre
ÁÁ% +
=
ÁÁ, -
cn
ÁÁ. 0
.
ÁÁ0 1
nombre
ÁÁ1 7
,
ÁÁ7 8
Codigo
ËË% +
=
ËË, -
cn
ËË. 0
.
ËË0 1
codigo
ËË1 7
,
ËË7 8
CodigoBarra
ÈÈ% 0
=
ÈÈ1 2
cn
ÈÈ3 5
.
ÈÈ5 6
codigo_barra
ÈÈ6 B
,
ÈÈB C 
NombrePresentacion
ÍÍ% 7
=
ÍÍ8 9
cn
ÍÍ: <
.
ÍÍ< =
Detalle_maestro3
ÍÍ= M
.
ÍÍM N
nombre
ÍÍN T
,
ÍÍT U
	Contenido
ÎÎ% .
=
ÎÎ/ 0
cn
ÎÎ1 3
.
ÎÎ3 4
	contenido
ÎÎ4 =
,
ÎÎ= >,
CodigoUnidadMedidaPresentacion
ÏÏ% C
=
ÏÏD E
cn
ÏÏF H
.
ÏÏH I
Detalle_maestro1
ÏÏI Y
.
ÏÏY Z
codigo
ÏÏZ `
,
ÏÏ` a)
CodigoUnidadMedidaComercial
ÌÌ% @
=
ÌÌA B
cn
ÌÌC E
.
ÌÌE F
Detalle_maestro
ÌÌF U
.
ÌÌU V
codigo
ÌÌV \
,
ÌÌ\ ]
Stock
ÓÓ% *
=
ÓÓ+ ,
cn
ÓÓ- /
.
ÓÓ/ 0!
Detalle_transaccion
ÓÓ0 C
.
ÓÓC D
Where
ÓÓD I
(
ÓÓI J
dt
ÓÓJ L
=>
ÓÓM O
dt
ÓÓP R
.
ÓÓR S
id_transaccion
ÓÓS a
==
ÓÓb d$
idTransaccionExistente
ÓÓe {
)
ÓÓ{ |
.
ÓÓ| }
SumÓÓ} Ä
(ÓÓÄ Å
dtÓÓÅ É
=>ÓÓÑ Ü
dtÓÓá â
.ÓÓâ ä
cantidadÓÓä í
)ÓÓí ì
,ÓÓì î
PrecioVenta
ÔÔ% 0
=
ÔÔ1 2
cn
ÔÔ3 5
.
ÔÔ5 6
Precio1
ÔÔ6 =
.
ÔÔ= >
Where
ÔÔ> C
(
ÔÔC D
p
ÔÔD E
=>
ÔÔF H
p
ÔÔI J
.
ÔÔJ K
id_actor_negocio
ÔÔK [
==
ÔÔ\ ^6
'idActorNegocioInternoQueTieneLosPreciosÔÔ_ Ü
&&ÔÔá â
pÔÔä ã
.ÔÔã å

es_vigenteÔÔå ñ
&&ÔÔó ô
pÔÔö õ
.ÔÔõ ú
id_tarifa_dÔÔú ß
==ÔÔ® ™
idTarifaÔÔ´ ≥
)ÔÔ≥ ¥
.
= >
OrderByDescending
> O
(
O P
p
P Q
=>
R T
p
U V
.
V W
id
W Y
)
Y Z
.
ÒÒ= >
FirstOrDefault
ÒÒ> L
(
ÒÒL M
)
ÒÒM N
.
ÒÒN O
valor
ÒÒO T
,
ÒÒT U
CostoUnitario
ÚÚ% 2
=
ÚÚ3 4
cn
ÚÚ5 7
.
ÚÚ7 8!
Detalle_transaccion
ÚÚ8 K
.
ÚÚK L
Where
ÚÚL Q
(
ÚÚQ R
d
ÚÚR S
=>
ÚÚT V
d
ÚÚW X
.
ÚÚX Y
Transaccion
ÚÚY d
.
ÚÚd e&
id_actor_negocio_interno
ÚÚe }
==ÚÚ~ Ä7
'idActorNegocioInternoQueTieneLosPreciosÚÚÅ ®
&&ÚÚ© ´#
idsTiposTransaccionÚÚ¨ ø
.ÚÚø ¿
ContainsÚÚ¿ »
(ÚÚ» …
dÚÚ…  
.ÚÚ  À
TransaccionÚÚÀ ÷
.ÚÚ÷ ◊#
id_tipo_transaccionÚÚ◊ Í
)ÚÚÍ Î
&&ÚÚÏ Ó
dÚÚÔ 
.ÚÚ Ò
TransaccionÚÚÒ ¸
.ÚÚ¸ ˝ 
id_estado_actualÚÚ˝ ç
==ÚÚé ê
MaestroSettingsÚÚë †
.ÚÚ† °
DefaultÚÚ° ®
.ÚÚ® ©0
 IdDetalleMaestroEstadoConfirmadoÚÚ© …
)ÚÚ…  
.
ÛÛK L
OrderByDescending
ÛÛL ]
(
ÛÛ] ^
dt
ÛÛ^ `
=>
ÛÛa c
dt
ÛÛd f
.
ÛÛf g
Transaccion
ÛÛg r
.
ÛÛr s
fecha_inicio
ÛÛs 
)ÛÛ Ä
.
ÙÙK L
ThenByDescending
ÙÙL \
(
ÙÙ\ ]
dt
ÙÙ] _
=>
ÙÙ` b
dt
ÙÙc e
.
ÙÙe f
id
ÙÙf h
)
ÙÙh i
.
ııK L
FirstOrDefault
ııL Z
(
ııZ [
)
ıı[ \
.
ıı\ ]
precio_unitario
ıı] l
}
ˆˆ! "
)
ˆˆ" #
;
ˆˆ# $
return
˜˜ 
	resultado
˜˜  
;
˜˜  !
}
¯¯ 
catch
˘˘ 
(
˘˘ 
	Exception
˘˘ 
e
˘˘ 
)
˘˘ 
{
˙˙ 
throw
˚˚ 
new
˚˚ 
DatosException
˚˚ (
(
˚˚( )
$str
˚˚) v
,
˚˚v w
e
˚˚x y
)
˚˚y z
;
˚˚z {
}
¸¸ 
}
˝˝ 	
public
˛˛ 
IEnumerable
˛˛ 
<
˛˛ (
Concepto_Negocio_Comercial
˛˛ 5
>
˛˛5 6z
kObtenerConceptosDeNegociosComercialesPorRolesYIdCategoriaYIdsValoresDeCaracteristicasInclyendoStockYPrecios˛˛7 ¢
(˛˛¢ £
long˛˛£ ß&
idTransaccionExistente˛˛® æ
,˛˛æ ø
int˛˛¿ √7
'idActorNegocioInternoQueTieneLosPrecios˛˛ƒ Î
,˛˛Î Ï
int˛˛Ì 
[˛˛ Ò
]˛˛Ò Ú
idsRoles˛˛Û ˚
,˛˛˚ ¸
int˛˛˝ Ä
idTarifa˛˛Å â
,˛˛â ä
int˛˛ã é
[˛˛é è
]˛˛è ê#
idsTiposTransaccion˛˛ë §
,˛˛§ •
int˛˛¶ ©
idCategoria˛˛™ µ
,˛˛µ ∂
int˛˛∑ ∫
[˛˛∫ ª
]˛˛ª º+
idsValoresDeCaracteristicas˛˛Ω ÿ
)˛˛ÿ Ÿ
{
ˇˇ 	
try
ÅÅ 
{
ÇÇ 
var
ÉÉ 
length
ÉÉ 
=
ÉÉ )
idsValoresDeCaracteristicas
ÉÉ 8
.
ÉÉ8 9
Length
ÉÉ9 ?
;
ÉÉ? @
var
ÑÑ 
	resultado
ÑÑ 
=
ÑÑ 
_db
ÑÑ  #
.
ÑÑ# $"
Concepto_negocio_rol
ÑÑ$ 8
.
ÑÑ8 9
Where
ÑÑ9 >
(
ÑÑ> ?
cnr
ÑÑ? B
=>
ÑÑC E
idsRoles
ÑÑF N
.
ÑÑN O
Contains
ÑÑO W
(
ÑÑW X
cnr
ÑÑX [
.
ÑÑ[ \
id_rol
ÑÑ\ b
)
ÑÑb c
)
ÑÑc d
.
ÖÖ8 9
Select
ÖÖ9 ?
(
ÖÖ? @
cn
ÖÖ@ B
=>
ÖÖC E
cn
ÖÖF H
.
ÖÖH I
Concepto_negocio
ÖÖI Y
)
ÖÖY Z
.
ÜÜ8 9
Where
ÜÜ9 >
(
ÜÜ> ?
cn
ÜÜ? A
=>
ÜÜB D
cn
ÜÜE G
.
ÜÜG H
Detalle_maestro4
ÜÜH X
.
ÜÜX Y 
Categoria_concepto
ÜÜY k
.
ÜÜk l
Select
ÜÜl r
(
ÜÜr s
cc
ÜÜs u
=>
ÜÜv x
cc
ÜÜy {
.
ÜÜ{ |
id_categoriaÜÜ| à
)ÜÜà â
.ÜÜâ ä
ContainsÜÜä í
(ÜÜí ì
idCategoriaÜÜì û
)ÜÜû ü
&&ÜÜ† ¢
cnÜÜ£ •
.ÜÜ• ¶

es_vigenteÜÜ¶ ∞
)ÜÜ∞ ±
.
áá8 9
Where
áá9 >
(
áá> ?
cn
áá? A
=>
ááB D
cn
ááE G
.
ááG H3
%Valor_caracteristica_concepto_negocio
ááH m
.
ààH I
Where
ààI N
(
ààN O
vcc
ààO R
=>
ààS U)
idsValoresDeCaracteristicas
ààV q
.
ààq r
Contains
ààr z
(
ààz {
vcc
àà{ ~
.
àà~ &
id_valor_caracteristicaàà ñ
)ààñ ó
)ààó ò
.ààò ô
Countààô û
(ààû ü
)ààü †
==àà° £
lengthàà§ ™
)àà™ ´
.
ââ8 9
Select
ââ9 ?
(
ââ? @
cn
ââ@ B
=>
ââC E
new
ââF I(
Concepto_Negocio_Comercial
ââJ d
(
ââd e
)
ââe f
{
ää8 9
Id
ãã< >
=
ãã? @
cn
ããA C
.
ããC D
id
ããD F
,
ããF G
Nombre
åå< B
=
ååC D
cn
ååE G
.
ååG H
nombre
ååH N
,
ååN O
Codigo
çç< B
=
ççC D
cn
ççE G
.
ççG H
codigo
ççH N
,
ççN O
CodigoBarra
éé< G
=
ééH I
cn
ééJ L
.
ééL M
codigo_barra
ééM Y
,
ééY Z 
NombrePresentacion
èè< N
=
èèO P
cn
èèQ S
.
èèS T
Detalle_maestro3
èèT d
.
èèd e
nombre
èèe k
,
èèk l
	Contenido
êê< E
=
êêF G
cn
êêH J
.
êêJ K
	contenido
êêK T
,
êêT U,
CodigoUnidadMedidaPresentacion
ëë< Z
=
ëë[ \
cn
ëë] _
.
ëë_ `
Detalle_maestro1
ëë` p
.
ëëp q
codigo
ëëq w
,
ëëw x)
CodigoUnidadMedidaComercial
íí< W
=
ííX Y
cn
ííZ \
.
íí\ ]
Detalle_maestro
íí] l
.
ííl m
codigo
íím s
,
íís t
Stock
ìì< A
=
ììB C
cn
ììD F
.
ììF G!
Detalle_transaccion
ììG Z
.
ììZ [
Where
ìì[ `
(
ìì` a
dt
ììa c
=>
ììd f
dt
ììg i
.
ììi j
id_transaccion
ììj x
==
ììy {%
idTransaccionExistenteìì| í
)ììí ì
.ììì î
Sumììî ó
(ììó ò
dtììò ö
=>ììõ ù
dtììû †
.ìì† °
cantidadìì° ©
)ìì© ™
,ìì™ ´
PrecioVenta
îî< G
=
îîH I
cn
îîJ L
.
îîL M
Precio1
îîM T
.
ïïL M
Where
ïïM R
(
ïïR S
p
ïïS T
=>
ïïU W
p
ïïX Y
.
ïïY Z
id_actor_negocio
ïïZ j
==
ïïk m6
'idActorNegocioInternoQueTieneLosPreciosïïn ï
&&ïïñ ò
pïïô ö
.ïïö õ

es_vigenteïïõ •
&&ïï¶ ®
pïï© ™
.ïï™ ´
id_tarifa_dïï´ ∂
==ïï∑ π
idTarifaïï∫ ¬
)ïï¬ √
.
ññL M
OrderByDescending
ññM ^
(
ññ^ _
p
ññ_ `
=>
ñña c
p
ññd e
.
ññe f
id
ññf h
)
ññh i
.
óóL M
FirstOrDefault
óóM [
(
óó[ \
)
óó\ ]
.
óó] ^
valor
óó^ c
,
óóc d
CostoUnitario
òò< I
=
òòJ K
cn
òòL N
.
òòN O!
Detalle_transaccion
òòO b
.
ôôR S
Where
ôôS X
(
ôôX Y
d
ôôY Z
=>
ôô[ ]
d
ôô^ _
.
ôô_ `
Transaccion
ôô` k
.
ôôk l'
id_actor_negocio_internoôôl Ñ
==ôôÖ á7
'idActorNegocioInternoQueTieneLosPreciosôôà Ø
&&ôô∞ ≤#
idsTiposTransaccionôô≥ ∆
.ôô∆ «
Containsôô« œ
(ôôœ –
dôô– —
.ôô— “
Transaccionôô“ ›
.ôô› ﬁ#
id_tipo_transaccionôôﬁ Ò
)ôôÒ Ú
&&ôôÛ ı
dôôˆ ˜
.ôô˜ ¯
Transaccionôô¯ É
.ôôÉ Ñ 
id_estado_actualôôÑ î
==ôôï ó
MaestroSettingsôôò ß
.ôôß ®
Defaultôô® Ø
.ôôØ ∞0
 IdDetalleMaestroEstadoConfirmadoôô∞ –
)ôô– —
.
ööR S
OrderByDescending
ööS d
(
ööd e
dt
ööe g
=>
ööh j
dt
öök m
.
ööm n
Transaccion
öön y
.
ööy z
fecha_inicioööz Ü
)ööÜ á
.
õõR S
ThenByDescending
õõS c
(
õõc d
dt
õõd f
=>
õõg i
dt
õõj l
.
õõl m
id
õõm o
)
õõo p
.
úúR S
FirstOrDefault
úúS a
(
úúa b
)
úúb c
.
úúc d
precio_unitario
úúd s
}
ùù8 9
)
ùù9 :
;
ùù: ;
return
ûû 
	resultado
ûû  
;
ûû  !
}
üü 
catch
†† 
(
†† 
	Exception
†† 
e
†† 
)
†† 
{
°° 
throw
¢¢ 
new
¢¢ 
DatosException
¢¢ (
(
¢¢( )
$str
¢¢) d
,
¢¢d e
e
¢¢f g
)
¢¢g h
;
¢¢h i
}
££ 
}
§§ 	
public
•• 
IEnumerable
•• 
<
•• (
Concepto_Negocio_Comercial
•• 5
>
••5 6n
_ObtenerConceptosDeNegociosComercialesPorRolesYIdsValoresDeCaracteristicasInclyendoStockYPrecios••7 ñ
(••ñ ó
long••ó õ&
idTransaccionExistente••ú ≤
,••≤ ≥
int••¥ ∑7
'idActorNegocioInternoQueTieneLosPrecios••∏ ﬂ
,••ﬂ ‡
int••· ‰
[••‰ Â
]••Â Ê
idsRoles••Á Ô
,••Ô 
int••Ò Ù
idTarifa••ı ˝
,••˝ ˛
int••ˇ Ç
[••Ç É
]••É Ñ#
idsTiposTransaccion••Ö ò
,••ò ô
int••ö ù
[••ù û
]••û ü+
idsValoresDeCaracteristicas••† ª
)••ª º
{
¶¶ 	
try
®® 
{
©© 
var
™™ 
length
™™ 
=
™™ )
idsValoresDeCaracteristicas
™™ 8
.
™™8 9
Length
™™9 ?
;
™™? @
var
´´ 
	resultado
´´ 
=
´´ 
_db
´´  #
.
´´# $"
Concepto_negocio_rol
´´$ 8
.
´´8 9
Where
´´9 >
(
´´> ?
cnr
´´? B
=>
´´C E
idsRoles
´´F N
.
´´N O
Contains
´´O W
(
´´W X
cnr
´´X [
.
´´[ \
id_rol
´´\ b
)
´´b c
)
´´c d
.
¨¨8 9
Select
¨¨9 ?
(
¨¨? @
cn
¨¨@ B
=>
¨¨C E
cn
¨¨F H
.
¨¨H I
Concepto_negocio
¨¨I Y
)
¨¨Y Z
.
≠≠8 9
Where
≠≠9 >
(
≠≠> ?
cn
≠≠? A
=>
≠≠B D
cn
≠≠E G
.
≠≠G H

es_vigente
≠≠H R
)
≠≠R S
.
ÆÆ8 9
Where
ÆÆ9 >
(
ÆÆ> ?
cn
ÆÆ? A
=>
ÆÆB D
cn
ÆÆE G
.
ÆÆG H3
%Valor_caracteristica_concepto_negocio
ÆÆH m
.
ØØH I
Where
ØØI N
(
ØØN O
vcc
ØØO R
=>
ØØS U)
idsValoresDeCaracteristicas
ØØV q
.
ØØq r
Contains
ØØr z
(
ØØz {
vcc
ØØ{ ~
.
ØØ~ &
id_valor_caracteristicaØØ ñ
)ØØñ ó
)ØØó ò
.ØØò ô
CountØØô û
(ØØû ü
)ØØü †
==ØØ° £
lengthØØ§ ™
)ØØ™ ´
.
∞∞8 9
Select
∞∞9 ?
(
∞∞? @
cn
∞∞@ B
=>
∞∞C E
new
∞∞F I(
Concepto_Negocio_Comercial
∞∞J d
(
∞∞d e
)
∞∞e f
{
±±8 9
Id
≤≤< >
=
≤≤? @
cn
≤≤A C
.
≤≤C D
id
≤≤D F
,
≤≤F G
Nombre
≥≥< B
=
≥≥C D
cn
≥≥E G
.
≥≥G H
nombre
≥≥H N
,
≥≥N O
Codigo
¥¥< B
=
¥¥C D
cn
¥¥E G
.
¥¥G H
codigo
¥¥H N
,
¥¥N O
CodigoBarra
µµ< G
=
µµH I
cn
µµJ L
.
µµL M
codigo_barra
µµM Y
,
µµY Z 
NombrePresentacion
∂∂< N
=
∂∂O P
cn
∂∂Q S
.
∂∂S T
Detalle_maestro3
∂∂T d
.
∂∂d e
nombre
∂∂e k
,
∂∂k l
	Contenido
∑∑< E
=
∑∑F G
cn
∑∑H J
.
∑∑J K
	contenido
∑∑K T
,
∑∑T U,
CodigoUnidadMedidaPresentacion
∏∏< Z
=
∏∏[ \
cn
∏∏] _
.
∏∏_ `
Detalle_maestro1
∏∏` p
.
∏∏p q
codigo
∏∏q w
,
∏∏w x)
CodigoUnidadMedidaComercial
ππ< W
=
ππX Y
cn
ππZ \
.
ππ\ ]
Detalle_maestro
ππ] l
.
ππl m
codigo
ππm s
,
ππs t
Stock
∫∫< A
=
∫∫B C
cn
∫∫D F
.
∫∫F G!
Detalle_transaccion
∫∫G Z
.
∫∫Z [
Where
∫∫[ `
(
∫∫` a
dt
∫∫a c
=>
∫∫d f
dt
∫∫g i
.
∫∫i j
id_transaccion
∫∫j x
==
∫∫y {%
idTransaccionExistente∫∫| í
)∫∫í ì
.∫∫ì î
Sum∫∫î ó
(∫∫ó ò
dt∫∫ò ö
=>∫∫õ ù
dt∫∫û †
.∫∫† °
cantidad∫∫° ©
)∫∫© ™
,∫∫™ ´
PrecioVenta
ªª< G
=
ªªH I
cn
ªªJ L
.
ªªL M
Precio1
ªªM T
.
ººL M
Where
ººM R
(
ººR S
p
ººS T
=>
ººU W
p
ººX Y
.
ººY Z
id_actor_negocio
ººZ j
==
ººk m6
'idActorNegocioInternoQueTieneLosPreciosººn ï
&&ººñ ò
pººô ö
.ººö õ

es_vigenteººõ •
&&ºº¶ ®
pºº© ™
.ºº™ ´
id_tarifa_dºº´ ∂
==ºº∑ π
idTarifaºº∫ ¬
)ºº¬ √
.
ΩΩL M
OrderByDescending
ΩΩM ^
(
ΩΩ^ _
p
ΩΩ_ `
=>
ΩΩa c
p
ΩΩd e
.
ΩΩe f
id
ΩΩf h
)
ΩΩh i
.
ææL M
FirstOrDefault
ææM [
(
ææ[ \
)
ææ\ ]
.
ææ] ^
valor
ææ^ c
,
ææc d
CostoUnitario
øø< I
=
øøJ K
cn
øøL N
.
øøN O!
Detalle_transaccion
øøO b
.
¿¿R S
Where
¿¿S X
(
¿¿X Y
d
¿¿Y Z
=>
¿¿[ ]
d
¿¿^ _
.
¿¿_ `
Transaccion
¿¿` k
.
¿¿k l'
id_actor_negocio_interno¿¿l Ñ
==¿¿Ö á7
'idActorNegocioInternoQueTieneLosPrecios¿¿à Ø
&&¿¿∞ ≤#
idsTiposTransaccion¿¿≥ ∆
.¿¿∆ «
Contains¿¿« œ
(¿¿œ –
d¿¿– —
.¿¿— “
Transaccion¿¿“ ›
.¿¿› ﬁ#
id_tipo_transaccion¿¿ﬁ Ò
)¿¿Ò Ú
&&¿¿Û ı
d¿¿ˆ ˜
.¿¿˜ ¯
Transaccion¿¿¯ É
.¿¿É Ñ 
id_estado_actual¿¿Ñ î
==¿¿ï ó
MaestroSettings¿¿ò ß
.¿¿ß ®
Default¿¿® Ø
.¿¿Ø ∞0
 IdDetalleMaestroEstadoConfirmado¿¿∞ –
)¿¿– —
.
¡¡R S
OrderByDescending
¡¡S d
(
¡¡d e
dt
¡¡e g
=>
¡¡h j
dt
¡¡k m
.
¡¡m n
Transaccion
¡¡n y
.
¡¡y z
fecha_inicio¡¡z Ü
)¡¡Ü á
.
¬¬R S
ThenByDescending
¬¬S c
(
¬¬c d
dt
¬¬d f
=>
¬¬g i
dt
¬¬j l
.
¬¬l m
id
¬¬m o
)
¬¬o p
.
√√R S
FirstOrDefault
√√S a
(
√√a b
)
√√b c
.
√√c d
precio_unitario
√√d s
}
ƒƒ8 9
)
ƒƒ9 :
;
ƒƒ: ;
return
≈≈ 
	resultado
≈≈  
;
≈≈  !
}
∆∆ 
catch
«« 
(
«« 
	Exception
«« 
e
«« 
)
«« 
{
»» 
throw
…… 
new
…… 
DatosException
…… (
(
……( )
$str
……) d
,
……d e
e
……f g
)
……g h
;
……h i
}
   
}
ÀÀ 	
public
ÃÃ 
IEnumerable
ÃÃ 
<
ÃÃ (
Concepto_Negocio_Comercial
ÃÃ 5
>
ÃÃ5 6n
_ObtenerConceptosDeNegocioComercialesPorRolesYIdConceptoBasicoYIdCategoriaInclyendoStockYPreciosÃÃ7 ñ
(ÃÃñ ó
longÃÃó õ&
idTransaccionExistenteÃÃú ≤
,ÃÃ≤ ≥
intÃÃ¥ ∑7
'idActorNegocioInternoQueTieneLosPreciosÃÃ∏ ﬂ
,ÃÃﬂ ‡
intÃÃ· ‰
[ÃÃ‰ Â
]ÃÃÂ Ê
idsRolesÃÃÁ Ô
,ÃÃÔ 
intÃÃÒ Ù
idTarifaÃÃı ˝
,ÃÃ˝ ˛
intÃÃˇ Ç
[ÃÃÇ É
]ÃÃÉ Ñ#
idsTiposTransaccionÃÃÖ ò
,ÃÃò ô
intÃÃö ù 
idConceptoBasicoÃÃû Æ
,ÃÃÆ Ø
intÃÃ∞ ≥
idCategoriaÃÃ¥ ø
)ÃÃø ¿
{
ÕÕ 	
try
ŒŒ 
{
œœ 
var
–– 
	resultado
–– 
=
–– 
_db
––  #
.
––# $"
Concepto_negocio_rol
––$ 8
.
––8 9
Where
––9 >
(
––> ?
cnr
––? B
=>
––C E
idsRoles
––F N
.
––N O
Contains
––O W
(
––W X
cnr
––X [
.
––[ \
id_rol
––\ b
)
––b c
)
––c d
.
——8 9
Select
——9 ?
(
——? @
cnr
——@ C
=>
——D F
cnr
——G J
.
——J K
Concepto_negocio
——K [
)
——[ \
.
““8 9
Where
““9 >
(
““> ?
cn
““? A
=>
““B D
cn
““E G
.
““G H
Detalle_maestro4
““H X
.
““X Y 
Categoria_concepto
““Y k
.
““k l
Select
““l r
(
““r s
cc
““s u
=>
““v x
cc
““y {
.
““{ |
id_categoria““| à
)““à â
.““â ä
Contains““ä í
(““í ì
idCategoria““ì û
)““û ü
&&““† ¢
cn““£ •
.““• ¶

es_vigente““¶ ∞
)““∞ ±
.
””8 9
Where
””9 >
(
””> ?
cn
””? A
=>
””B D
cn
””E G
.
””G H 
id_concepto_basico
””H Z
==
””[ ]
idConceptoBasico
””^ n
)
””n o
.
‘‘! "
Select
‘‘" (
(
‘‘( )
cn
‘‘) +
=>
‘‘, .
new
‘‘/ 2(
Concepto_Negocio_Comercial
‘‘3 M
(
‘‘M N
)
‘‘N O
{
’’! "
Id
÷÷% '
=
÷÷( )
cn
÷÷* ,
.
÷÷, -
id
÷÷- /
,
÷÷/ 0
Nombre
◊◊% +
=
◊◊, -
cn
◊◊. 0
.
◊◊0 1
nombre
◊◊1 7
,
◊◊7 8
Codigo
ÿÿ% +
=
ÿÿ, -
cn
ÿÿ. 0
.
ÿÿ0 1
codigo
ÿÿ1 7
,
ÿÿ7 8
CodigoBarra
ŸŸ% 0
=
ŸŸ1 2
cn
ŸŸ3 5
.
ŸŸ5 6
codigo_barra
ŸŸ6 B
,
ŸŸB C 
NombrePresentacion
⁄⁄% 7
=
⁄⁄8 9
cn
⁄⁄: <
.
⁄⁄< =
Detalle_maestro3
⁄⁄= M
.
⁄⁄M N
nombre
⁄⁄N T
,
⁄⁄T U
	Contenido
€€% .
=
€€/ 0
cn
€€1 3
.
€€3 4
	contenido
€€4 =
,
€€= >,
CodigoUnidadMedidaPresentacion
‹‹% C
=
‹‹D E
cn
‹‹F H
.
‹‹H I
Detalle_maestro1
‹‹I Y
.
‹‹Y Z
codigo
‹‹Z `
,
‹‹` a)
CodigoUnidadMedidaComercial
››% @
=
››A B
cn
››C E
.
››E F
Detalle_maestro
››F U
.
››U V
codigo
››V \
,
››\ ]
Stock
ﬁﬁ% *
=
ﬁﬁ+ ,
cn
ﬁﬁ- /
.
ﬁﬁ/ 0!
Detalle_transaccion
ﬁﬁ0 C
.
ﬁﬁC D
Where
ﬁﬁD I
(
ﬁﬁI J
dt
ﬁﬁJ L
=>
ﬁﬁM O
dt
ﬁﬁP R
.
ﬁﬁR S
id_transaccion
ﬁﬁS a
==
ﬁﬁb d$
idTransaccionExistente
ﬁﬁe {
)
ﬁﬁ{ |
.
ﬁﬁ| }
Sumﬁﬁ} Ä
(ﬁﬁÄ Å
dtﬁﬁÅ É
=>ﬁﬁÑ Ü
dtﬁﬁá â
.ﬁﬁâ ä
cantidadﬁﬁä í
)ﬁﬁí ì
,ﬁﬁì î
PrecioVenta
ﬂﬂ% 0
=
ﬂﬂ1 2
cn
ﬂﬂ3 5
.
ﬂﬂ5 6
Precio1
ﬂﬂ6 =
.
ﬂﬂ= >
Where
ﬂﬂ> C
(
ﬂﬂC D
p
ﬂﬂD E
=>
ﬂﬂF H
p
ﬂﬂI J
.
ﬂﬂJ K
id_actor_negocio
ﬂﬂK [
==
ﬂﬂ\ ^6
'idActorNegocioInternoQueTieneLosPreciosﬂﬂ_ Ü
&&ﬂﬂá â
pﬂﬂä ã
.ﬂﬂã å

es_vigenteﬂﬂå ñ
&&ﬂﬂó ô
pﬂﬂö õ
.ﬂﬂõ ú
id_tarifa_dﬂﬂú ß
==ﬂﬂ® ™
idTarifaﬂﬂ´ ≥
)ﬂﬂ≥ ¥
.
‡‡= >
OrderByDescending
‡‡> O
(
‡‡O P
p
‡‡P Q
=>
‡‡R T
p
‡‡U V
.
‡‡V W
id
‡‡W Y
)
‡‡Y Z
.
··= >
FirstOrDefault
··> L
(
··L M
)
··M N
.
··N O
valor
··O T
,
··T U
CostoUnitario
‚‚% 2
=
‚‚3 4
cn
‚‚5 7
.
‚‚7 8!
Detalle_transaccion
‚‚8 K
.
‚‚K L
Where
‚‚L Q
(
‚‚Q R
d
‚‚R S
=>
‚‚T V
d
‚‚W X
.
‚‚X Y
Transaccion
‚‚Y d
.
‚‚d e&
id_actor_negocio_interno
‚‚e }
==‚‚~ Ä7
'idActorNegocioInternoQueTieneLosPrecios‚‚Å ®
&&‚‚© ´#
idsTiposTransaccion‚‚¨ ø
.‚‚ø ¿
Contains‚‚¿ »
(‚‚» …
d‚‚…  
.‚‚  À
Transaccion‚‚À ÷
.‚‚÷ ◊#
id_tipo_transaccion‚‚◊ Í
)‚‚Í Î
&&‚‚Ï Ó
d‚‚Ô 
.‚‚ Ò
Transaccion‚‚Ò ¸
.‚‚¸ ˝ 
id_estado_actual‚‚˝ ç
==‚‚é ê
MaestroSettings‚‚ë †
.‚‚† °
Default‚‚° ®
.‚‚® ©0
 IdDetalleMaestroEstadoConfirmado‚‚© …
)‚‚…  
.
„„K L
OrderByDescending
„„L ]
(
„„] ^
dt
„„^ `
=>
„„a c
dt
„„d f
.
„„f g
Transaccion
„„g r
.
„„r s
fecha_inicio
„„s 
)„„ Ä
.
‰‰K L
ThenByDescending
‰‰L \
(
‰‰\ ]
dt
‰‰] _
=>
‰‰` b
dt
‰‰c e
.
‰‰e f
id
‰‰f h
)
‰‰h i
.
ÂÂK L
FirstOrDefault
ÂÂL Z
(
ÂÂZ [
)
ÂÂ[ \
.
ÂÂ\ ]
precio_unitario
ÂÂ] l
}
ÊÊ! "
)
ÊÊ" #
;
ÊÊ# $
return
ÁÁ 
	resultado
ÁÁ  
;
ÁÁ  !
}
ËË 
catch
ÈÈ 
(
ÈÈ 
	Exception
ÈÈ 
e
ÈÈ 
)
ÈÈ 
{
ÍÍ 
throw
ÎÎ 
new
ÎÎ 
DatosException
ÎÎ (
(
ÎÎ( )
$str
ÎÎ) d
,
ÎÎd e
e
ÎÎf g
)
ÎÎg h
;
ÎÎh i
}
ÏÏ 
}
ÌÌ 	
public
ÓÓ 
IEnumerable
ÓÓ 
<
ÓÓ (
Concepto_Negocio_Comercial
ÓÓ 5
>
ÓÓ5 6b
SObtenerConceptosDeNegocioComercialesPorRolesYIdConceptoBasicoInclyendoStockYPreciosÓÓ7 ä
(ÓÓä ã
longÓÓã è&
idTransaccionExistenteÓÓê ¶
,ÓÓ¶ ß
intÓÓ® ´7
'idActorNegocioInternoQueTieneLosPreciosÓÓ¨ ”
,ÓÓ” ‘
intÓÓ’ ÿ
[ÓÓÿ Ÿ
]ÓÓŸ ⁄
idsRolesÓÓ€ „
,ÓÓ„ ‰
intÓÓÂ Ë
idTarifaÓÓÈ Ò
,ÓÓÒ Ú
intÓÓÛ ˆ
[ÓÓˆ ˜
]ÓÓ˜ ¯#
idsTiposTransaccionÓÓ˘ å
,ÓÓå ç
intÓÓé ë 
idConceptoBasicoÓÓí ¢
)ÓÓ¢ £
{
ÔÔ 	
try
 
{
ÒÒ 
var
ÚÚ 
	resultado
ÚÚ 
=
ÚÚ 
_db
ÚÚ  #
.
ÚÚ# $"
Concepto_negocio_rol
ÚÚ$ 8
.
ÚÚ8 9
Where
ÚÚ9 >
(
ÚÚ> ?
cnr
ÚÚ? B
=>
ÚÚC E
idsRoles
ÚÚF N
.
ÚÚN O
Contains
ÚÚO W
(
ÚÚW X
cnr
ÚÚX [
.
ÚÚ[ \
id_rol
ÚÚ\ b
)
ÚÚb c
)
ÚÚc d
.
ÛÛ8 9
Select
ÛÛ9 ?
(
ÛÛ? @
cnr
ÛÛ@ C
=>
ÛÛD F
cnr
ÛÛG J
.
ÛÛJ K
Concepto_negocio
ÛÛK [
)
ÛÛ[ \
.
ÙÙ8 9
Where
ÙÙ9 >
(
ÙÙ> ?
cn
ÙÙ? A
=>
ÙÙB D
cn
ÙÙE G
.
ÙÙG H

es_vigente
ÙÙH R
)
ÙÙR S
.
ıı8 9
Where
ıı9 >
(
ıı> ?
cn
ıı? A
=>
ııB D
cn
ııE G
.
ııG H 
id_concepto_basico
ııH Z
==
ıı[ ]
idConceptoBasico
ıı^ n
)
ıın o
.
ˆˆ! "
Select
ˆˆ" (
(
ˆˆ( )
cn
ˆˆ) +
=>
ˆˆ, .
new
ˆˆ/ 2(
Concepto_Negocio_Comercial
ˆˆ3 M
(
ˆˆM N
)
ˆˆN O
{
˜˜! "
Id
¯¯% '
=
¯¯( )
cn
¯¯* ,
.
¯¯, -
id
¯¯- /
,
¯¯/ 0
Nombre
˘˘% +
=
˘˘, -
cn
˘˘. 0
.
˘˘0 1
nombre
˘˘1 7
,
˘˘7 8
Codigo
˙˙% +
=
˙˙, -
cn
˙˙. 0
.
˙˙0 1
codigo
˙˙1 7
,
˙˙7 8
CodigoBarra
˚˚% 0
=
˚˚1 2
cn
˚˚3 5
.
˚˚5 6
codigo_barra
˚˚6 B
,
˚˚B C 
NombrePresentacion
¸¸% 7
=
¸¸8 9
cn
¸¸: <
.
¸¸< =
Detalle_maestro3
¸¸= M
.
¸¸M N
nombre
¸¸N T
,
¸¸T U
	Contenido
˝˝% .
=
˝˝/ 0
cn
˝˝1 3
.
˝˝3 4
	contenido
˝˝4 =
,
˝˝= >,
CodigoUnidadMedidaPresentacion
˛˛% C
=
˛˛D E
cn
˛˛F H
.
˛˛H I
Detalle_maestro1
˛˛I Y
.
˛˛Y Z
codigo
˛˛Z `
,
˛˛` a)
CodigoUnidadMedidaComercial
ˇˇ% @
=
ˇˇA B
cn
ˇˇC E
.
ˇˇE F
Detalle_maestro
ˇˇF U
.
ˇˇU V
codigo
ˇˇV \
,
ˇˇ\ ]
Stock
Ä	Ä	% *
=
Ä	Ä	+ ,
cn
Ä	Ä	- /
.
Ä	Ä	/ 0!
Detalle_transaccion
Ä	Ä	0 C
.
Ä	Ä	C D
Where
Ä	Ä	D I
(
Ä	Ä	I J
dt
Ä	Ä	J L
=>
Ä	Ä	M O
dt
Ä	Ä	P R
.
Ä	Ä	R S
id_transaccion
Ä	Ä	S a
==
Ä	Ä	b d$
idTransaccionExistente
Ä	Ä	e {
)
Ä	Ä	{ |
.
Ä	Ä	| }
SumÄ	Ä	} Ä
(Ä	Ä	Ä Å
dtÄ	Ä	Å É
=>Ä	Ä	Ñ Ü
dtÄ	Ä	á â
.Ä	Ä	â ä
cantidadÄ	Ä	ä í
)Ä	Ä	í ì
,Ä	Ä	ì î
PrecioVenta
Å	Å	% 0
=
Å	Å	1 2
cn
Å	Å	3 5
.
Å	Å	5 6
Precio1
Å	Å	6 =
.
Å	Å	= >
Where
Å	Å	> C
(
Å	Å	C D
p
Å	Å	D E
=>
Å	Å	F H
p
Å	Å	I J
.
Å	Å	J K
id_actor_negocio
Å	Å	K [
==
Å	Å	\ ^6
'idActorNegocioInternoQueTieneLosPreciosÅ	Å	_ Ü
&&Å	Å	á â
pÅ	Å	ä ã
.Å	Å	ã å

es_vigenteÅ	Å	å ñ
&&Å	Å	ó ô
pÅ	Å	ö õ
.Å	Å	õ ú
id_tarifa_dÅ	Å	ú ß
==Å	Å	® ™
idTarifaÅ	Å	´ ≥
)Å	Å	≥ ¥
.
Ç	Ç	= >
OrderByDescending
Ç	Ç	> O
(
Ç	Ç	O P
p
Ç	Ç	P Q
=>
Ç	Ç	R T
p
Ç	Ç	U V
.
Ç	Ç	V W
id
Ç	Ç	W Y
)
Ç	Ç	Y Z
.
É	É	= >
FirstOrDefault
É	É	> L
(
É	É	L M
)
É	É	M N
.
É	É	N O
valor
É	É	O T
,
É	É	T U
CostoUnitario
Ñ	Ñ	% 2
=
Ñ	Ñ	3 4
cn
Ñ	Ñ	5 7
.
Ñ	Ñ	7 8!
Detalle_transaccion
Ñ	Ñ	8 K
.
Ñ	Ñ	K L
Where
Ñ	Ñ	L Q
(
Ñ	Ñ	Q R
d
Ñ	Ñ	R S
=>
Ñ	Ñ	T V
d
Ñ	Ñ	W X
.
Ñ	Ñ	X Y
Transaccion
Ñ	Ñ	Y d
.
Ñ	Ñ	d e&
id_actor_negocio_interno
Ñ	Ñ	e }
==Ñ	Ñ	~ Ä7
'idActorNegocioInternoQueTieneLosPreciosÑ	Ñ	Å ®
&&Ñ	Ñ	© ´#
idsTiposTransaccionÑ	Ñ	¨ ø
.Ñ	Ñ	ø ¿
ContainsÑ	Ñ	¿ »
(Ñ	Ñ	» …
dÑ	Ñ	…  
.Ñ	Ñ	  À
TransaccionÑ	Ñ	À ÷
.Ñ	Ñ	÷ ◊#
id_tipo_transaccionÑ	Ñ	◊ Í
)Ñ	Ñ	Í Î
&&Ñ	Ñ	Ï Ó
dÑ	Ñ	Ô 
.Ñ	Ñ	 Ò
TransaccionÑ	Ñ	Ò ¸
.Ñ	Ñ	¸ ˝ 
id_estado_actualÑ	Ñ	˝ ç
==Ñ	Ñ	é ê
MaestroSettingsÑ	Ñ	ë †
.Ñ	Ñ	† °
DefaultÑ	Ñ	° ®
.Ñ	Ñ	® ©0
 IdDetalleMaestroEstadoConfirmadoÑ	Ñ	© …
)Ñ	Ñ	…  
.
Ö	Ö	K L
OrderByDescending
Ö	Ö	L ]
(
Ö	Ö	] ^
dt
Ö	Ö	^ `
=>
Ö	Ö	a c
dt
Ö	Ö	d f
.
Ö	Ö	f g
Transaccion
Ö	Ö	g r
.
Ö	Ö	r s
fecha_inicio
Ö	Ö	s 
)Ö	Ö	 Ä
.
Ü	Ü	K L
ThenByDescending
Ü	Ü	L \
(
Ü	Ü	\ ]
dt
Ü	Ü	] _
=>
Ü	Ü	` b
dt
Ü	Ü	c e
.
Ü	Ü	e f
id
Ü	Ü	f h
)
Ü	Ü	h i
.
á	á	K L
FirstOrDefault
á	á	L Z
(
á	á	Z [
)
á	á	[ \
.
á	á	\ ]
precio_unitario
á	á	] l
}
à	à	! "
)
à	à	" #
;
à	à	# $
return
â	â	 
	resultado
â	â	  
;
â	â	  !
}
ä	ä	 
catch
ã	ã	 
(
ã	ã	 
	Exception
ã	ã	 
e
ã	ã	 
)
ã	ã	 
{
å	å	 
throw
ç	ç	 
new
ç	ç	 
DatosException
ç	ç	 (
(
ç	ç	( )
$str
ç	ç	) d
,
ç	ç	d e
e
ç	ç	f g
)
ç	ç	g h
;
ç	ç	h i
}
é	é	 
}
è	è	 	
public
ê	ê	 
IEnumerable
ê	ê	 
<
ê	ê	 (
Concepto_Negocio_Comercial
ê	ê	 5
>
ê	ê	5 6^
OObtenerConceptosDeNegociosComercialesPorRolesYIdCategoriaInclyendoStockYPreciosê	ê	7 Ü
(ê	ê	Ü á
longê	ê	á ã&
idTransaccionExistenteê	ê	å ¢
,ê	ê	¢ £
intê	ê	§ ß7
'idActorNegocioInternoQueTieneLosPreciosê	ê	® œ
,ê	ê	œ –
intê	ê	— ‘
[ê	ê	‘ ’
]ê	ê	’ ÷
idsRolesê	ê	◊ ﬂ
,ê	ê	ﬂ ‡
intê	ê	· ‰
idTarifaê	ê	Â Ì
,ê	ê	Ì Ó
intê	ê	Ô Ú
[ê	ê	Ú Û
]ê	ê	Û Ù#
idsTiposTransaccionê	ê	ı à
,ê	ê	à â
intê	ê	ä ç
idCategoriaê	ê	é ô
)ê	ê	ô ö
{
ë	ë	 	
try
í	í	 
{
ì	ì	 
var
î	î	 
	resultado
î	î	 
=
î	î	 
_db
î	î	  #
.
î	î	# $"
Concepto_negocio_rol
î	î	$ 8
.
î	î	8 9
Where
î	î	9 >
(
î	î	> ?
cnr
î	î	? B
=>
î	î	C E
idsRoles
î	î	F N
.
î	î	N O
Contains
î	î	O W
(
î	î	W X
cnr
î	î	X [
.
î	î	[ \
id_rol
î	î	\ b
)
î	î	b c
)
î	î	c d
.
ï	ï	8 9
Select
ï	ï	9 ?
(
ï	ï	? @
cnr
ï	ï	@ C
=>
ï	ï	D F
cnr
ï	ï	G J
.
ï	ï	J K
Concepto_negocio
ï	ï	K [
)
ï	ï	[ \
.
ñ	ñ	8 9
Where
ñ	ñ	9 >
(
ñ	ñ	> ?
cn
ñ	ñ	? A
=>
ñ	ñ	B D
cn
ñ	ñ	E G
.
ñ	ñ	G H
Detalle_maestro4
ñ	ñ	H X
.
ñ	ñ	X Y 
Categoria_concepto
ñ	ñ	Y k
.
ñ	ñ	k l
Select
ñ	ñ	l r
(
ñ	ñ	r s
cc
ñ	ñ	s u
=>
ñ	ñ	v x
cc
ñ	ñ	y {
.
ñ	ñ	{ |
id_categoriañ	ñ	| à
)ñ	ñ	à â
.ñ	ñ	â ä
Containsñ	ñ	ä í
(ñ	ñ	í ì
idCategoriañ	ñ	ì û
)ñ	ñ	û ü
&&ñ	ñ	† ¢
cnñ	ñ	£ •
.ñ	ñ	• ¶

es_vigenteñ	ñ	¶ ∞
)ñ	ñ	∞ ±
.
ó	ó	8 9
Select
ó	ó	9 ?
(
ó	ó	? @
cn
ó	ó	@ B
=>
ó	ó	C E
new
ó	ó	F I(
Concepto_Negocio_Comercial
ó	ó	J d
(
ó	ó	d e
)
ó	ó	e f
{
ò	ò	8 9
Id
ô	ô	< >
=
ô	ô	? @
cn
ô	ô	A C
.
ô	ô	C D
id
ô	ô	D F
,
ô	ô	F G
Nombre
ö	ö	< B
=
ö	ö	C D
cn
ö	ö	E G
.
ö	ö	G H
nombre
ö	ö	H N
,
ö	ö	N O
Codigo
õ	õ	< B
=
õ	õ	C D
cn
õ	õ	E G
.
õ	õ	G H
codigo
õ	õ	H N
,
õ	õ	N O
CodigoBarra
ú	ú	< G
=
ú	ú	H I
cn
ú	ú	J L
.
ú	ú	L M
codigo_barra
ú	ú	M Y
,
ú	ú	Y Z 
NombrePresentacion
ù	ù	< N
=
ù	ù	O P
cn
ù	ù	Q S
.
ù	ù	S T
Detalle_maestro3
ù	ù	T d
.
ù	ù	d e
nombre
ù	ù	e k
,
ù	ù	k l
	Contenido
û	û	< E
=
û	û	F G
cn
û	û	H J
.
û	û	J K
	contenido
û	û	K T
,
û	û	T U,
CodigoUnidadMedidaPresentacion
ü	ü	< Z
=
ü	ü	[ \
cn
ü	ü	] _
.
ü	ü	_ `
Detalle_maestro1
ü	ü	` p
.
ü	ü	p q
codigo
ü	ü	q w
,
ü	ü	w x)
CodigoUnidadMedidaComercial
†	†	< W
=
†	†	X Y
cn
†	†	Z \
.
†	†	\ ]
Detalle_maestro
†	†	] l
.
†	†	l m
codigo
†	†	m s
,
†	†	s t
Stock
°	°	< A
=
°	°	B C
cn
°	°	D F
.
°	°	F G!
Detalle_transaccion
°	°	G Z
.
°	°	Z [
Where
°	°	[ `
(
°	°	` a
dt
°	°	a c
=>
°	°	d f
dt
°	°	g i
.
°	°	i j
id_transaccion
°	°	j x
==
°	°	y {%
idTransaccionExistente°	°	| í
)°	°	í ì
.°	°	ì î
Sum°	°	î ó
(°	°	ó ò
dt°	°	ò ö
=>°	°	õ ù
dt°	°	û †
.°	°	† °
cantidad°	°	° ©
)°	°	© ™
,°	°	™ ´
PrecioVenta
¢	¢	< G
=
¢	¢	H I
cn
¢	¢	J L
.
¢	¢	L M
Precio1
¢	¢	M T
.
£	£	L M
Where
£	£	M R
(
£	£	R S
p
£	£	S T
=>
£	£	U W
p
£	£	X Y
.
£	£	Y Z
id_actor_negocio
£	£	Z j
==
£	£	k m6
'idActorNegocioInternoQueTieneLosPrecios£	£	n ï
&&£	£	ñ ò
p£	£	ô ö
.£	£	ö õ

es_vigente£	£	õ •
&&£	£	¶ ®
p£	£	© ™
.£	£	™ ´
id_tarifa_d£	£	´ ∂
==£	£	∑ π
idTarifa£	£	∫ ¬
)£	£	¬ √
.
§	§	L M
OrderByDescending
§	§	M ^
(
§	§	^ _
p
§	§	_ `
=>
§	§	a c
p
§	§	d e
.
§	§	e f
id
§	§	f h
)
§	§	h i
.
•	•	L M
FirstOrDefault
•	•	M [
(
•	•	[ \
)
•	•	\ ]
.
•	•	] ^
valor
•	•	^ c
,
•	•	c d
CostoUnitario
¶	¶	< I
=
¶	¶	J K
cn
¶	¶	L N
.
¶	¶	N O!
Detalle_transaccion
¶	¶	O b
.
ß	ß	R S
Where
ß	ß	S X
(
ß	ß	X Y
d
ß	ß	Y Z
=>
ß	ß	[ ]
d
ß	ß	^ _
.
ß	ß	_ `
Transaccion
ß	ß	` k
.
ß	ß	k l'
id_actor_negocio_internoß	ß	l Ñ
==ß	ß	Ö á7
'idActorNegocioInternoQueTieneLosPreciosß	ß	à Ø
&&ß	ß	∞ ≤#
idsTiposTransaccionß	ß	≥ ∆
.ß	ß	∆ «
Containsß	ß	« œ
(ß	ß	œ –
dß	ß	– —
.ß	ß	— “
Transaccionß	ß	“ ›
.ß	ß	› ﬁ#
id_tipo_transaccionß	ß	ﬁ Ò
)ß	ß	Ò Ú
&&ß	ß	Û ı
dß	ß	ˆ ˜
.ß	ß	˜ ¯
Transaccionß	ß	¯ É
.ß	ß	É Ñ 
id_estado_actualß	ß	Ñ î
==ß	ß	ï ó
MaestroSettingsß	ß	ò ß
.ß	ß	ß ®
Defaultß	ß	® Ø
.ß	ß	Ø ∞0
 IdDetalleMaestroEstadoConfirmadoß	ß	∞ –
)ß	ß	– —
.
®	®	R S
OrderByDescending
®	®	S d
(
®	®	d e
dt
®	®	e g
=>
®	®	h j
dt
®	®	k m
.
®	®	m n
Transaccion
®	®	n y
.
®	®	y z
fecha_inicio®	®	z Ü
)®	®	Ü á
.
©	©	R S
ThenByDescending
©	©	S c
(
©	©	c d
dt
©	©	d f
=>
©	©	g i
dt
©	©	j l
.
©	©	l m
id
©	©	m o
)
©	©	o p
.
™	™	R S
FirstOrDefault
™	™	S a
(
™	™	a b
)
™	™	b c
.
™	™	c d
precio_unitario
™	™	d s
}
´	´	8 9
)
´	´	9 :
;
´	´	: ;
return
¨	¨	 
	resultado
¨	¨	  
;
¨	¨	  !
}
≠	≠	 
catch
Æ	Æ	 
(
Æ	Æ	 
	Exception
Æ	Æ	 
e
Æ	Æ	 
)
Æ	Æ	 
{
Ø	Ø	 
throw
∞	∞	 
new
∞	∞	 
DatosException
∞	∞	 (
(
∞	∞	( )
$str
∞	∞	) P
,
∞	∞	P Q
e
∞	∞	R S
)
∞	∞	S T
;
∞	∞	T U
}
±	±	 
}
≤	≤	 	
public
≥	≥	 
IEnumerable
≥	≥	 
<
≥	≥	 (
Concepto_Negocio_Comercial
≥	≥	 5
>
≥	≥	5 6Q
CObtenerConceptosDeNegociosComercialesPorRolesInclyendoStockYPrecios
≥	≥	7 z
(
≥	≥	z {
long
≥	≥	{ &
idTransaccionExistente≥	≥	Ä ñ
,≥	≥	ñ ó
int≥	≥	ò õ7
'idActorNegocioInternoQueTieneLosPrecios≥	≥	ú √
,≥	≥	√ ƒ
int≥	≥	≈ »
[≥	≥	» …
]≥	≥	…  
idsRoles≥	≥	À ”
,≥	≥	” ‘
int≥	≥	’ ÿ
idTarifa≥	≥	Ÿ ·
,≥	≥	· ‚
int≥	≥	„ Ê
[≥	≥	Ê Á
]≥	≥	Á Ë#
idsTiposTransaccion≥	≥	È ¸
)≥	≥	¸ ˝
{
¥	¥	 	
try
µ	µ	 
{
∂	∂	 
var
∑	∑	 
	resultado
∑	∑	 
=
∑	∑	 
_db
∑	∑	  #
.
∑	∑	# $"
Concepto_negocio_rol
∑	∑	$ 8
.
∑	∑	8 9
Where
∑	∑	9 >
(
∑	∑	> ?
cnr
∑	∑	? B
=>
∑	∑	C E
idsRoles
∑	∑	F N
.
∑	∑	N O
Contains
∑	∑	O W
(
∑	∑	W X
cnr
∑	∑	X [
.
∑	∑	[ \
id_rol
∑	∑	\ b
)
∑	∑	b c
)
∑	∑	c d
.
∏	∏	8 9
Select
∏	∏	9 ?
(
∏	∏	? @
cnr
∏	∏	@ C
=>
∏	∏	D F
cnr
∏	∏	G J
.
∏	∏	J K
Concepto_negocio
∏	∏	K [
)
∏	∏	[ \
.
π	π	8 9
Where
π	π	9 >
(
π	π	> ?
cn
π	π	? A
=>
π	π	B D
cn
π	π	E G
.
π	π	G H

es_vigente
π	π	H R
)
π	π	R S
.
∫	∫	8 9
Select
∫	∫	9 ?
(
∫	∫	? @
cn
∫	∫	@ B
=>
∫	∫	C E
new
∫	∫	F I(
Concepto_Negocio_Comercial
∫	∫	J d
(
∫	∫	d e
)
∫	∫	e f
{
ª	ª	8 9
Id
º	º	< >
=
º	º	? @
cn
º	º	A C
.
º	º	C D
id
º	º	D F
,
º	º	F G
Nombre
Ω	Ω	< B
=
Ω	Ω	C D
cn
Ω	Ω	E G
.
Ω	Ω	G H
nombre
Ω	Ω	H N
,
Ω	Ω	N O
Codigo
æ	æ	< B
=
æ	æ	C D
cn
æ	æ	E G
.
æ	æ	G H
codigo
æ	æ	H N
,
æ	æ	N O
CodigoBarra
ø	ø	< G
=
ø	ø	H I
cn
ø	ø	J L
.
ø	ø	L M
codigo_barra
ø	ø	M Y
,
ø	ø	Y Z 
NombrePresentacion
¿	¿	< N
=
¿	¿	O P
cn
¿	¿	Q S
.
¿	¿	S T
Detalle_maestro3
¿	¿	T d
.
¿	¿	d e
nombre
¿	¿	e k
,
¿	¿	k l
	Contenido
¡	¡	< E
=
¡	¡	F G
cn
¡	¡	H J
.
¡	¡	J K
	contenido
¡	¡	K T
,
¡	¡	T U,
CodigoUnidadMedidaPresentacion
¬	¬	< Z
=
¬	¬	[ \
cn
¬	¬	] _
.
¬	¬	_ `
Detalle_maestro1
¬	¬	` p
.
¬	¬	p q
codigo
¬	¬	q w
,
¬	¬	w x)
CodigoUnidadMedidaComercial
√	√	< W
=
√	√	X Y
cn
√	√	Z \
.
√	√	\ ]
Detalle_maestro
√	√	] l
.
√	√	l m
codigo
√	√	m s
,
√	√	s t
Stock
ƒ	ƒ	< A
=
ƒ	ƒ	B C
cn
ƒ	ƒ	D F
.
ƒ	ƒ	F G!
Detalle_transaccion
ƒ	ƒ	G Z
.
ƒ	ƒ	Z [
Where
ƒ	ƒ	[ `
(
ƒ	ƒ	` a
dt
ƒ	ƒ	a c
=>
ƒ	ƒ	d f
dt
ƒ	ƒ	g i
.
ƒ	ƒ	i j
id_transaccion
ƒ	ƒ	j x
==
ƒ	ƒ	y {%
idTransaccionExistenteƒ	ƒ	| í
)ƒ	ƒ	í ì
.ƒ	ƒ	ì î
Sumƒ	ƒ	î ó
(ƒ	ƒ	ó ò
dtƒ	ƒ	ò ö
=>ƒ	ƒ	õ ù
dtƒ	ƒ	û †
.ƒ	ƒ	† °
cantidadƒ	ƒ	° ©
)ƒ	ƒ	© ™
,ƒ	ƒ	™ ´
PrecioVenta
≈	≈	< G
=
≈	≈	H I
cn
≈	≈	J L
.
≈	≈	L M
Precio1
≈	≈	M T
.
∆	∆	L M
Where
∆	∆	M R
(
∆	∆	R S
p
∆	∆	S T
=>
∆	∆	U W
p
∆	∆	X Y
.
∆	∆	Y Z
id_actor_negocio
∆	∆	Z j
==
∆	∆	k m6
'idActorNegocioInternoQueTieneLosPrecios∆	∆	n ï
&&∆	∆	ñ ò
p∆	∆	ô ö
.∆	∆	ö õ

es_vigente∆	∆	õ •
&&∆	∆	¶ ®
p∆	∆	© ™
.∆	∆	™ ´
id_tarifa_d∆	∆	´ ∂
==∆	∆	∑ π
idTarifa∆	∆	∫ ¬
)∆	∆	¬ √
.
«	«	L M
OrderByDescending
«	«	M ^
(
«	«	^ _
p
«	«	_ `
=>
«	«	a c
p
«	«	d e
.
«	«	e f
id
«	«	f h
)
«	«	h i
.
»	»	L M
FirstOrDefault
»	»	M [
(
»	»	[ \
)
»	»	\ ]
.
»	»	] ^
valor
»	»	^ c
,
»	»	c d
CostoUnitario
…	…	< I
=
…	…	J K
cn
…	…	L N
.
…	…	N O!
Detalle_transaccion
…	…	O b
.
 	 	R S
Where
 	 	S X
(
 	 	X Y
d
 	 	Y Z
=>
 	 	[ ]
d
 	 	^ _
.
 	 	_ `
Transaccion
 	 	` k
.
 	 	k l'
id_actor_negocio_interno 	 	l Ñ
== 	 	Ö á7
'idActorNegocioInternoQueTieneLosPrecios 	 	à Ø
&& 	 	∞ ≤#
idsTiposTransaccion 	 	≥ ∆
. 	 	∆ «
Contains 	 	« œ
( 	 	œ –
d 	 	– —
. 	 	— “
Transaccion 	 	“ ›
. 	 	› ﬁ#
id_tipo_transaccion 	 	ﬁ Ò
) 	 	Ò Ú
&& 	 	Û ı
d 	 	ˆ ˜
. 	 	˜ ¯
Transaccion 	 	¯ É
. 	 	É Ñ 
id_estado_actual 	 	Ñ î
== 	 	ï ó
MaestroSettings 	 	ò ß
. 	 	ß ®
Default 	 	® Ø
. 	 	Ø ∞0
 IdDetalleMaestroEstadoConfirmado 	 	∞ –
) 	 	– —
.
À	À	R S
OrderByDescending
À	À	S d
(
À	À	d e
dt
À	À	e g
=>
À	À	h j
dt
À	À	k m
.
À	À	m n
Transaccion
À	À	n y
.
À	À	y z
fecha_inicioÀ	À	z Ü
)À	À	Ü á
.
Ã	Ã	R S
ThenByDescending
Ã	Ã	S c
(
Ã	Ã	c d
dt
Ã	Ã	d f
=>
Ã	Ã	g i
dt
Ã	Ã	j l
.
Ã	Ã	l m
id
Ã	Ã	m o
)
Ã	Ã	o p
.
Õ	Õ	R S
FirstOrDefault
Õ	Õ	S a
(
Õ	Õ	a b
)
Õ	Õ	b c
.
Õ	Õ	c d
precio_unitario
Õ	Õ	d s
}
Œ	Œ	8 9
)
Œ	Œ	9 :
;
Œ	Œ	: ;
return
œ	œ	 
	resultado
œ	œ	  
;
œ	œ	  !
}
–	–	 
catch
—	—	 
(
—	—	 
	Exception
—	—	 
e
—	—	 
)
—	—	 
{
“	“	 
throw
”	”	 
new
”	”	 
DatosException
”	”	 (
(
”	”	( )
$str
”	”	) P
,
”	”	P Q
e
”	”	R S
)
”	”	S T
;
”	”	T U
}
‘	‘	 
}
’	’	 	
public
Ÿ	Ÿ	 
IEnumerable
Ÿ	Ÿ	 
<
Ÿ	Ÿ	 1
#Selector_Concepto_Negocio_Comercial
Ÿ	Ÿ	 >
>
Ÿ	Ÿ	> ?9
+ObtenerConceptosDeNegociosComercialesPorRol
Ÿ	Ÿ	@ k
(
Ÿ	Ÿ	k l
int
Ÿ	Ÿ	l o
idRol
Ÿ	Ÿ	p u
)
Ÿ	Ÿ	u v
{
⁄	⁄	 	
try
€	€	 
{
‹	‹	 
return
›	›	 
_db
›	›	 
.
›	›	 "
Concepto_negocio_rol
›	›	 /
.
ﬁ	ﬁ	  
Where
ﬁ	ﬁ	  %
(
ﬁ	ﬁ	% &
cnr
ﬁ	ﬁ	& )
=>
ﬁ	ﬁ	* ,
cnr
ﬁ	ﬁ	- 0
.
ﬁ	ﬁ	0 1
id_rol
ﬁ	ﬁ	1 7
==
ﬁ	ﬁ	8 :
idRol
ﬁ	ﬁ	; @
&&
ﬁ	ﬁ	A C
cnr
ﬁ	ﬁ	D G
.
ﬁ	ﬁ	G H
Concepto_negocio
ﬁ	ﬁ	H X
.
ﬁ	ﬁ	X Y

es_vigente
ﬁ	ﬁ	Y c
)
ﬁ	ﬁ	c d
.
ﬂ	ﬂ	  
Select
ﬂ	ﬂ	  &
(
ﬂ	ﬂ	& '
cnr
ﬂ	ﬂ	' *
=>
ﬂ	ﬂ	+ -
cnr
ﬂ	ﬂ	. 1
.
ﬂ	ﬂ	1 2
Concepto_negocio
ﬂ	ﬂ	2 B
)
ﬂ	ﬂ	B C
.
‡	‡	  
Select
‡	‡	  &
(
‡	‡	& '
cn
‡	‡	' )
=>
‡	‡	* ,
new
‡	‡	- 01
#Selector_Concepto_Negocio_Comercial
‡	‡	1 T
(
‡	‡	T U
)
‡	‡	U V
{
·	·	  
Id
‚	‚	# %
=
‚	‚	& '
cn
‚	‚	( *
.
‚	‚	* +
id
‚	‚	+ -
,
‚	‚	- .

SoloNombre
„	„	# -
=
„	„	. /
cn
„	„	0 2
.
„	„	2 3
nombre
„	„	3 9
,
„	„	9 :
CodigoBarra
‰	‰	# .
=
‰	‰	/ 0
cn
‰	‰	1 3
.
‰	‰	3 4
codigo_barra
‰	‰	4 @
,
‰	‰	@ A
}
Â	Â	  
)
Â	Â	  !
.
Â	Â	! "
OrderBy
Â	Â	" )
(
Â	Â	) *
cnc
Â	Â	* -
=>
Â	Â	. 0
cnc
Â	Â	1 4
.
Â	Â	4 5

SoloNombre
Â	Â	5 ?
)
Â	Â	? @
;
Â	Â	@ A
}
Ê	Ê	 
catch
Á	Á	 
(
Á	Á	 
	Exception
Á	Á	 
e
Á	Á	 
)
Á	Á	 
{
Ë	Ë	 
throw
È	È	 
new
È	È	 
DatosException
È	È	 (
(
È	È	( )
$str
È	È	) g
,
È	È	g h
e
È	È	i j
)
È	È	j k
;
È	È	k l
}
Í	Í	 
}
Î	Î	 	
public
Ì	Ì	 
IEnumerable
Ì	Ì	 
<
Ì	Ì	 1
#Selector_Concepto_Negocio_Comercial
Ì	Ì	 >
>
Ì	Ì	> ?G
9ObtenerConceptosDeNegociosComercialesConStockPrecioPorRol
Ì	Ì	@ y
(
Ì	Ì	y z
int
Ì	Ì	z }
idRolÌ	Ì	~ É
,Ì	Ì	É Ñ
longÌ	Ì	Ö â'
idTransaccionInventarioÌ	Ì	ä °
,Ì	Ì	° ¢
intÌ	Ì	£ ¶-
idActorNegocioQueTienePreciosÌ	Ì	ß ƒ
)Ì	Ì	ƒ ≈
{
Ó	Ó	 	
try
Ô	Ô	 
{
		 
return
Ò	Ò	 
_db
Ò	Ò	 
.
Ò	Ò	 G
9ObtenerConceptosDeNegociosComercialesConStockPrecioPorRol
Ò	Ò	 T
(
Ò	Ò	T U
idRol
Ò	Ò	U Z
,
Ò	Ò	Z [%
idTransaccionInventario
Ò	Ò	\ s
,
Ò	Ò	s t,
idActorNegocioQueTienePreciosÒ	Ò	u í
)Ò	Ò	í ì
.
Ú	Ú	  
Select
Ú	Ú	  &
(
Ú	Ú	& '
cn
Ú	Ú	' )
=>
Ú	Ú	* ,
new
Ú	Ú	- 01
#Selector_Concepto_Negocio_Comercial
Ú	Ú	1 T
(
Ú	Ú	T U
)
Ú	Ú	U V
{
Û	Û	  
Id
Ù	Ù	# %
=
Ù	Ù	& '
cn
Ù	Ù	( *
.
Ù	Ù	* +
id
Ù	Ù	+ -
,
Ù	Ù	- .

SoloNombre
ı	ı	# -
=
ı	ı	. /
cn
ı	ı	0 2
.
ı	ı	2 3
nombre
ı	ı	3 9
,
ı	ı	9 :
CodigoBarra
ˆ	ˆ	# .
=
ˆ	ˆ	/ 0
cn
ˆ	ˆ	1 3
.
ˆ	ˆ	3 4
codigo_barra
ˆ	ˆ	4 @
,
ˆ	ˆ	@ A
Precio
˜	˜	# )
=
˜	˜	* +
cn
˜	˜	, .
.
˜	˜	. /
precio
˜	˜	/ 5
,
˜	˜	5 6
Stock
¯	¯	# (
=
¯	¯	) *
cn
¯	¯	+ -
.
¯	¯	- .
stock
¯	¯	. 3
,
¯	¯	3 4
EsBien
˘	˘	# )
=
˘	˘	* +
cn
˘	˘	, .
.
˘	˘	. /
tipo_familia
˘	˘	/ ;
.
˘	˘	; <
Equals
˘	˘	< B
(
˘	˘	B C
(
˘	˘	C D
(
˘	˘	D E
int
˘	˘	E H
)
˘	˘	H I
TipoFamiliaEnum
˘	˘	I X
.
˘	˘	X Y
Bien
˘	˘	Y ]
)
˘	˘	] ^
.
˘	˘	^ _
ToString
˘	˘	_ g
(
˘	˘	g h
)
˘	˘	h i
)
˘	˘	i j
}
˙	˙	  
)
˙	˙	  !
.
˙	˙	! "
OrderBy
˙	˙	" )
(
˙	˙	) *
cnc
˙	˙	* -
=>
˙	˙	. 0
cnc
˙	˙	1 4
.
˙	˙	4 5

SoloNombre
˙	˙	5 ?
)
˙	˙	? @
;
˙	˙	@ A
}
˚	˚	 
catch
¸	¸	 
(
¸	¸	 
	Exception
¸	¸	 
e
¸	¸	 
)
¸	¸	 
{
˝	˝	 
throw
˛	˛	 
new
˛	˛	 
DatosException
˛	˛	 (
(
˛	˛	( )
$str
˛	˛	) g
,
˛	˛	g h
e
˛	˛	i j
)
˛	˛	j k
;
˛	˛	k l
}
ˇ	ˇ	 
}
Ä
Ä
 	
public
Ç
Ç
 
IEnumerable
Ç
Ç
 
<
Ç
Ç
 1
#Selector_Concepto_Negocio_Comercial
Ç
Ç
 >
>
Ç
Ç
> ?E
7ObtenerConceptosDeNegociosComercialesPorRolYTipoFamilia
Ç
Ç
@ w
(
Ç
Ç
w x
int
Ç
Ç
x {
idRolÇ
Ç
| Å
,Ç
Ç
Å Ç
stringÇ
Ç
É â 
valorTipoFamiliaÇ
Ç
ä ö
)Ç
Ç
ö õ
{
É
É
 	
try
Ñ
Ñ
 
{
Ö
Ö
 
return
Ü
Ü
 
_db
Ü
Ü
 
.
Ü
Ü
 "
Concepto_negocio_rol
Ü
Ü
 /
.
á
á
  
Where
á
á
  %
(
á
á
% &
cnr
á
á
& )
=>
á
á
* ,
cnr
á
á
- 0
.
á
á
0 1
id_rol
á
á
1 7
==
á
á
8 :
idRol
á
á
; @
&&
à
à
- /
cnr
à
à
0 3
.
à
à
3 4
Concepto_negocio
à
à
4 D
.
à
à
D E

es_vigente
à
à
E O
&&
â
â
- /
cnr
â
â
0 3
.
â
â
3 4
Concepto_negocio
â
â
4 D
.
â
â
D E
Detalle_maestro4
â
â
E U
.
â
â
U V
valor
â
â
V [
==
â
â
\ ^
valorTipoFamilia
â
â
_ o
)
â
â
o p
.
ä
ä
  
Select
ä
ä
  &
(
ä
ä
& '
cnr
ä
ä
' *
=>
ä
ä
+ -
cnr
ä
ä
. 1
.
ä
ä
1 2
Concepto_negocio
ä
ä
2 B
)
ä
ä
B C
.
ã
ã
  
Select
ã
ã
  &
(
ã
ã
& '
cn
ã
ã
' )
=>
ã
ã
* ,
new
ã
ã
- 01
#Selector_Concepto_Negocio_Comercial
ã
ã
1 T
(
ã
ã
T U
)
ã
ã
U V
{
å
å
  
Id
ç
ç
# %
=
ç
ç
& '
cn
ç
ç
( *
.
ç
ç
* +
id
ç
ç
+ -
,
ç
ç
- .

SoloNombre
é
é
# -
=
é
é
. /
cn
é
é
0 2
.
é
é
2 3
nombre
é
é
3 9
,
é
é
9 :
CodigoBarra
è
è
# .
=
è
è
/ 0
cn
è
è
1 3
.
è
è
3 4
codigo_barra
è
è
4 @
,
è
è
@ A
}
ê
ê
  
)
ê
ê
  !
.
ê
ê
! "
OrderBy
ê
ê
" )
(
ê
ê
) *
cnc
ê
ê
* -
=>
ê
ê
. 0
cnc
ê
ê
1 4
.
ê
ê
4 5

SoloNombre
ê
ê
5 ?
)
ê
ê
? @
;
ê
ê
@ A
}
ë
ë
 
catch
í
í
 
(
í
í
 
	Exception
í
í
 
e
í
í
 
)
í
í
 
{
ì
ì
 
throw
î
î
 
new
î
î
 
DatosException
î
î
 (
(
î
î
( )
$str
î
î
) g
,
î
î
g h
e
î
î
i j
)
î
î
j k
;
î
î
k l
}
ï
ï
 
}
ñ
ñ
 	
public
ó
ó
 
IEnumerable
ó
ó
 
<
ó
ó
 1
#Selector_Concepto_Negocio_Comercial
ó
ó
 >
>
ó
ó
> ?T
EObtenerConceptosDeNegociosComercialesConStockPrecioPorRolYTipoFamiliaó
ó
@ Ö
(ó
ó
Ö Ü
intó
ó
Ü â
idRoló
ó
ä è
,ó
ó
è ê
longó
ó
ë ï'
idTransaccionInventarioó
ó
ñ ≠
,ó
ó
≠ Æ
intó
ó
Ø ≤-
idActorNegocioQueTienePreciosó
ó
≥ –
,ó
ó
– —
stringó
ó
“ ÿ 
valorTipoFamiliaó
ó
Ÿ È
)ó
ó
È Í
{
ò
ò
 	
try
ô
ô
 
{
ö
ö
 
return
õ
õ
 
_db
õ
õ
 
.
õ
õ
 S
EObtenerConceptosDeNegociosComercialesConStockPrecioPorRolYTipoFamilia
õ
õ
 `
(
õ
õ
` a
idRol
õ
õ
a f
,
õ
õ
f g%
idTransaccionInventario
õ
õ
h 
,õ
õ
 Ä-
idActorNegocioQueTienePreciosõ
õ
Å û
,õ
õ
û ü 
valorTipoFamiliaõ
õ
† ∞
)õ
õ
∞ ±
.
ú
ú
 
Select
ú
ú
 %
(
ú
ú
% &
cn
ú
ú
& (
=>
ú
ú
) +
new
ú
ú
, /1
#Selector_Concepto_Negocio_Comercial
ú
ú
0 S
(
ú
ú
S T
)
ú
ú
T U
{
ù
ù
 
Id
û
û
" $
=
û
û
% &
cn
û
û
' )
.
û
û
) *
id
û
û
* ,
,
û
û
, -

SoloNombre
ü
ü
" ,
=
ü
ü
- .
cn
ü
ü
/ 1
.
ü
ü
1 2
nombre
ü
ü
2 8
,
ü
ü
8 9
CodigoBarra
†
†
" -
=
†
†
. /
cn
†
†
0 2
.
†
†
2 3
codigo_barra
†
†
3 ?
,
†
†
? @
Precio
°
°
" (
=
°
°
) *
cn
°
°
+ -
.
°
°
- .
precio
°
°
. 4
,
°
°
4 5
Stock
¢
¢
" '
=
¢
¢
( )
cn
¢
¢
* ,
.
¢
¢
, -
stock
¢
¢
- 2
,
¢
¢
2 3
EsBien
£
£
" (
=
£
£
) *
cn
£
£
+ -
.
£
£
- .
tipo_familia
£
£
. :
.
£
£
: ;
Equals
£
£
; A
(
£
£
A B
(
£
£
B C
(
£
£
C D
int
£
£
D G
)
£
£
G H
TipoFamiliaEnum
£
£
H W
.
£
£
W X
Bien
£
£
X \
)
£
£
\ ]
.
£
£
] ^
ToString
£
£
^ f
(
£
£
f g
)
£
£
g h
)
£
£
h i
}
§
§
 
)
§
§
  
.
§
§
  !
OrderBy
§
§
! (
(
§
§
( )
cnc
§
§
) ,
=>
§
§
- /
cnc
§
§
0 3
.
§
§
3 4

SoloNombre
§
§
4 >
)
§
§
> ?
;
§
§
? @
}
•
•
 
catch
¶
¶
 
(
¶
¶
 
	Exception
¶
¶
 
e
¶
¶
 
)
¶
¶
 
{
ß
ß
 
throw
®
®
 
new
®
®
 
DatosException
®
®
 (
(
®
®
( )
$str
®
®
) g
,
®
®
g h
e
®
®
i j
)
®
®
j k
;
®
®
k l
}
©
©
 
}
™
™
 	
public
´
´
 
IEnumerable
´
´
 
<
´
´
 1
#Selector_Concepto_Negocio_Comercial
´
´
 >
>
´
´
> ?J
<ObtenerConceptosDeNegociosComercialesPorRolYBusquedaConcepto
´
´
@ |
(
´
´
| }
int´
´
} Ä
idRol´
´
Å Ü
,´
´
Ü á
string´
´
à é
cadenaBusqueda´
´
è ù
)´
´
ù û
{
¨
¨
 	
try
≠
≠
 
{
Æ
Æ
 
return
Ø
Ø
 
_db
Ø
Ø
 
.
Ø
Ø
 "
Concepto_negocio_rol
Ø
Ø
 /
.
∞
∞
  
Where
∞
∞
  %
(
∞
∞
% &
cnr
∞
∞
& )
=>
∞
∞
* ,
cnr
∞
∞
- 0
.
∞
∞
0 1
id_rol
∞
∞
1 7
==
∞
∞
8 :
idRol
∞
∞
; @
&&
±
±
- /
cnr
±
±
0 3
.
±
±
3 4
Concepto_negocio
±
±
4 D
.
±
±
D E

es_vigente
±
±
E O
&&
≤
≤
- /
(
≤
≤
0 1
cnr
≤
≤
1 4
.
≤
≤
4 5
Concepto_negocio
≤
≤
5 E
.
≤
≤
E F
codigo_barra
≤
≤
F R
.
≤
≤
R S
Contains
≤
≤
S [
(
≤
≤
[ \
cadenaBusqueda
≤
≤
\ j
)
≤
≤
j k
||
≤
≤
l n
cnr
≤
≤
o r
.
≤
≤
r s
Concepto_negocio≤
≤
s É
.≤
≤
É Ñ
nombre≤
≤
Ñ ä
.≤
≤
ä ã
Contains≤
≤
ã ì
(≤
≤
ì î
cadenaBusqueda≤
≤
î ¢
)≤
≤
¢ £
)≤
≤
£ §
)≤
≤
§ •
.
≥
≥
  
Select
≥
≥
  &
(
≥
≥
& '
cnr
≥
≥
' *
=>
≥
≥
+ -
cnr
≥
≥
. 1
.
≥
≥
1 2
Concepto_negocio
≥
≥
2 B
)
≥
≥
B C
.
¥
¥
  
Select
¥
¥
  &
(
¥
¥
& '
cn
¥
¥
' )
=>
¥
¥
* ,
new
¥
¥
- 01
#Selector_Concepto_Negocio_Comercial
¥
¥
1 T
(
¥
¥
T U
)
¥
¥
U V
{
µ
µ
  
Id
∂
∂
# %
=
∂
∂
& '
cn
∂
∂
( *
.
∂
∂
* +
id
∂
∂
+ -
,
∂
∂
- .

SoloNombre
∑
∑
# -
=
∑
∑
. /
cn
∑
∑
0 2
.
∑
∑
2 3
nombre
∑
∑
3 9
,
∑
∑
9 :
CodigoBarra
∏
∏
# .
=
∏
∏
/ 0
cn
∏
∏
1 3
.
∏
∏
3 4
codigo_barra
∏
∏
4 @
,
∏
∏
@ A
}
π
π
  
)
π
π
  !
.
π
π
! "
OrderBy
π
π
" )
(
π
π
) *
cnc
π
π
* -
=>
π
π
. 0
cnc
π
π
1 4
.
π
π
4 5

SoloNombre
π
π
5 ?
)
π
π
? @
;
π
π
@ A
}
∫
∫
 
catch
ª
ª
 
(
ª
ª
 
	Exception
ª
ª
 
e
ª
ª
 
)
ª
ª
 
{
º
º
 
throw
Ω
Ω
 
new
Ω
Ω
 
DatosException
Ω
Ω
 (
(
Ω
Ω
( )
$str
Ω
Ω
) {
,
Ω
Ω
{ |
e
Ω
Ω
} ~
)
Ω
Ω
~ 
;Ω
Ω
 Ä
}
æ
æ
 
}
ø
ø
 	
public
¿
¿
 
IEnumerable
¿
¿
 
<
¿
¿
 1
#Selector_Concepto_Negocio_Comercial
¿
¿
 >
>
¿
¿
> ?Y
JObtenerConceptosDeNegociosComercialesConStockPrecioPorRolYBusquedaConcepto¿
¿
@ ä
(¿
¿
ä ã
int¿
¿
ã é
idRol¿
¿
è î
,¿
¿
î ï
long¿
¿
ñ ö'
idTransaccionInventario¿
¿
õ ≤
,¿
¿
≤ ≥
int¿
¿
¥ ∑-
idActorNegocioQueTienePrecios¿
¿
∏ ’
,¿
¿
’ ÷
string¿
¿
◊ ›
cadenaBusqueda¿
¿
ﬁ Ï
)¿
¿
Ï Ì
{
¡
¡
 	
try
¬
¬
 
{
√
√
 
return
ƒ
ƒ
 
_db
ƒ
ƒ
 
.
ƒ
ƒ
 X
JObtenerConceptosDeNegociosComercialesConStockPrecioPorRolYBusquedaConcepto
ƒ
ƒ
 e
(
ƒ
ƒ
e f
idRol
ƒ
ƒ
f k
,
ƒ
ƒ
k l&
idTransaccionInventarioƒ
ƒ
m Ñ
,ƒ
ƒ
Ñ Ö-
idActorNegocioQueTienePreciosƒ
ƒ
Ü £
,ƒ
ƒ
£ §
cadenaBusquedaƒ
ƒ
• ≥
)ƒ
ƒ
≥ ¥
.
≈
≈
  
Select
≈
≈
  &
(
≈
≈
& '
cn
≈
≈
' )
=>
≈
≈
* ,
new
≈
≈
- 01
#Selector_Concepto_Negocio_Comercial
≈
≈
1 T
(
≈
≈
T U
)
≈
≈
U V
{
∆
∆
  
Id
«
«
# %
=
«
«
& '
cn
«
«
( *
.
«
«
* +
id
«
«
+ -
,
«
«
- .

SoloNombre
»
»
# -
=
»
»
. /
cn
»
»
0 2
.
»
»
2 3
nombre
»
»
3 9
,
»
»
9 :
CodigoBarra
…
…
# .
=
…
…
/ 0
cn
…
…
1 3
.
…
…
3 4
codigo_barra
…
…
4 @
,
…
…
@ A
Precio
 
 
# )
=
 
 
* +
cn
 
 
, .
.
 
 
. /
precio
 
 
/ 5
,
 
 
5 6
Stock
À
À
# (
=
À
À
) *
cn
À
À
+ -
.
À
À
- .
stock
À
À
. 3
,
À
À
3 4
EsBien
Ã
Ã
# )
=
Ã
Ã
* +
cn
Ã
Ã
, .
.
Ã
Ã
. /
tipo_familia
Ã
Ã
/ ;
.
Ã
Ã
; <
Equals
Ã
Ã
< B
(
Ã
Ã
B C
(
Ã
Ã
C D
(
Ã
Ã
D E
int
Ã
Ã
E H
)
Ã
Ã
H I
TipoFamiliaEnum
Ã
Ã
I X
.
Ã
Ã
X Y
Bien
Ã
Ã
Y ]
)
Ã
Ã
] ^
.
Ã
Ã
^ _
ToString
Ã
Ã
_ g
(
Ã
Ã
g h
)
Ã
Ã
h i
)
Ã
Ã
i j
}
Õ
Õ
  
)
Õ
Õ
  !
.
Õ
Õ
! "
OrderBy
Õ
Õ
" )
(
Õ
Õ
) *
cnc
Õ
Õ
* -
=>
Õ
Õ
. 0
cnc
Õ
Õ
1 4
.
Õ
Õ
4 5

SoloNombre
Õ
Õ
5 ?
)
Õ
Õ
? @
;
Õ
Õ
@ A
}
Œ
Œ
 
catch
œ
œ
 
(
œ
œ
 
	Exception
œ
œ
 
e
œ
œ
 
)
œ
œ
 
{
–
–
 
throw
—
—
 
new
—
—
 
DatosException
—
—
 (
(
—
—
( )
$str
—
—
) {
,
—
—
{ |
e
—
—
} ~
)
—
—
~ 
;—
—
 Ä
}
“
“
 
}
”
”
 	
public
‘
‘
 
IEnumerable
‘
‘
 
<
‘
‘
 1
#Selector_Concepto_Negocio_Comercial
‘
‘
 >
>
‘
‘
> ?W
HObtenerConceptosDeNegociosComercialesPorRolYBusquedaConceptoYTipoFamilia‘
‘
@ à
(‘
‘
à â
int‘
‘
â å
idRol‘
‘
ç í
,‘
‘
í ì
string‘
‘
î ö
cadenaBusqueda‘
‘
õ ©
,‘
‘
© ™
string‘
‘
´ ± 
valorTipoFamilia‘
‘
≤ ¬
)‘
‘
¬ √
{
’
’
 	
try
÷
÷
 
{
◊
◊
 
return
ÿ
ÿ
 
_db
ÿ
ÿ
 
.
ÿ
ÿ
 "
Concepto_negocio_rol
ÿ
ÿ
 /
.
Ÿ
Ÿ
  
Where
Ÿ
Ÿ
  %
(
Ÿ
Ÿ
% &
cnr
Ÿ
Ÿ
& )
=>
Ÿ
Ÿ
* ,
cnr
Ÿ
Ÿ
- 0
.
Ÿ
Ÿ
0 1
id_rol
Ÿ
Ÿ
1 7
==
Ÿ
Ÿ
8 :
idRol
Ÿ
Ÿ
; @
&&
⁄
⁄
- /
cnr
⁄
⁄
0 3
.
⁄
⁄
3 4
Concepto_negocio
⁄
⁄
4 D
.
⁄
⁄
D E

es_vigente
⁄
⁄
E O
&&
€
€
- /
(
€
€
0 1
cnr
€
€
1 4
.
€
€
4 5
Concepto_negocio
€
€
5 E
.
€
€
E F
codigo_barra
€
€
F R
.
€
€
R S
Contains
€
€
S [
(
€
€
[ \
cadenaBusqueda
€
€
\ j
)
€
€
j k
||
€
€
l n
cnr
€
€
o r
.
€
€
r s
Concepto_negocio€
€
s É
.€
€
É Ñ
nombre€
€
Ñ ä
.€
€
ä ã
Contains€
€
ã ì
(€
€
ì î
cadenaBusqueda€
€
î ¢
)€
€
¢ £
)€
€
£ §
&&
‹
‹
- /
cnr
‹
‹
0 3
.
‹
‹
3 4
Concepto_negocio
‹
‹
4 D
.
‹
‹
D E
Detalle_maestro4
‹
‹
E U
.
‹
‹
U V
valor
‹
‹
V [
==
‹
‹
\ ^
valorTipoFamilia
‹
‹
_ o
)
‹
‹
o p
.
›
›
  
Select
›
›
  &
(
›
›
& '
cnr
›
›
' *
=>
›
›
+ -
cnr
›
›
. 1
.
›
›
1 2
Concepto_negocio
›
›
2 B
)
›
›
B C
.
ﬁ
ﬁ
  
Select
ﬁ
ﬁ
  &
(
ﬁ
ﬁ
& '
cn
ﬁ
ﬁ
' )
=>
ﬁ
ﬁ
* ,
new
ﬁ
ﬁ
- 01
#Selector_Concepto_Negocio_Comercial
ﬁ
ﬁ
1 T
(
ﬁ
ﬁ
T U
)
ﬁ
ﬁ
U V
{
ﬂ
ﬂ
  
Id
‡
‡
# %
=
‡
‡
& '
cn
‡
‡
( *
.
‡
‡
* +
id
‡
‡
+ -
,
‡
‡
- .

SoloNombre
·
·
# -
=
·
·
. /
cn
·
·
0 2
.
·
·
2 3
nombre
·
·
3 9
,
·
·
9 :
CodigoBarra
‚
‚
# .
=
‚
‚
/ 0
cn
‚
‚
1 3
.
‚
‚
3 4
codigo_barra
‚
‚
4 @
,
‚
‚
@ A
}
„
„
  
)
„
„
  !
.
„
„
! "
OrderBy
„
„
" )
(
„
„
) *
cnc
„
„
* -
=>
„
„
. 0
cnc
„
„
1 4
.
„
„
4 5

SoloNombre
„
„
5 ?
)
„
„
? @
;
„
„
@ A
}
‰
‰
 
catch
Â
Â
 
(
Â
Â
 
	Exception
Â
Â
 
e
Â
Â
 
)
Â
Â
 
{
Ê
Ê
 
throw
Á
Á
 
new
Á
Á
 
DatosException
Á
Á
 (
(
Á
Á
( )
$str
Á
Á
) {
,
Á
Á
{ |
e
Á
Á
} ~
)
Á
Á
~ 
;Á
Á
 Ä
}
Ë
Ë
 
}
È
È
 	
public
Í
Í
 
IEnumerable
Í
Í
 
<
Í
Í
 1
#Selector_Concepto_Negocio_Comercial
Í
Í
 >
>
Í
Í
> ?e
VObtenerConceptosDeNegociosComercialesConStockPrecioPorRolYBusquedaConceptoYTipoFamiliaÍ
Í
@ ñ
(Í
Í
ñ ó
intÍ
Í
ó ö
idRolÍ
Í
õ †
,Í
Í
† °
longÍ
Í
¢ ¶'
idTransaccionInventarioÍ
Í
ß æ
,Í
Í
æ ø
intÍ
Í
¿ √-
idActorNegocioQueTienePreciosÍ
Í
ƒ ·
,Í
Í
· ‚
stringÍ
Í
„ È
cadenaBusquedaÍ
Í
Í ¯
,Í
Í
¯ ˘
stringÍ
Í
˙ Ä 
valorTipoFamiliaÍ
Í
Å ë
)Í
Í
ë í
{
Î
Î
 	
try
Ï
Ï
 
{
Ì
Ì
 
return
Ó
Ó
 
_db
Ó
Ó
 
.
Ó
Ó
 d
VObtenerConceptosDeNegociosComercialesConStockPrecioPorRolYBusquedaConceptoYTipoFamilia
Ó
Ó
 q
(
Ó
Ó
q r
idRol
Ó
Ó
r w
,
Ó
Ó
w x&
idTransaccionInventarioÓ
Ó
y ê
,Ó
Ó
ê ë-
idActorNegocioQueTienePreciosÓ
Ó
í Ø
,Ó
Ó
Ø ∞
cadenaBusquedaÓ
Ó
± ø
,Ó
Ó
ø ¿ 
valorTipoFamiliaÓ
Ó
¡ —
)Ó
Ó
— “
.
Ô
Ô
 
Select
Ô
Ô
 %
(
Ô
Ô
% &
cn
Ô
Ô
& (
=>
Ô
Ô
) +
new
Ô
Ô
, /1
#Selector_Concepto_Negocio_Comercial
Ô
Ô
0 S
(
Ô
Ô
S T
)
Ô
Ô
T U
{


 
Id
Ò
Ò
" $
=
Ò
Ò
% &
cn
Ò
Ò
' )
.
Ò
Ò
) *
id
Ò
Ò
* ,
,
Ò
Ò
, -

SoloNombre
Ú
Ú
" ,
=
Ú
Ú
- .
cn
Ú
Ú
/ 1
.
Ú
Ú
1 2
nombre
Ú
Ú
2 8
,
Ú
Ú
8 9
CodigoBarra
Û
Û
" -
=
Û
Û
. /
cn
Û
Û
0 2
.
Û
Û
2 3
codigo_barra
Û
Û
3 ?
,
Û
Û
? @
Precio
Ù
Ù
" (
=
Ù
Ù
) *
cn
Ù
Ù
+ -
.
Ù
Ù
- .
precio
Ù
Ù
. 4
,
Ù
Ù
4 5
Stock
ı
ı
" '
=
ı
ı
( )
cn
ı
ı
* ,
.
ı
ı
, -
stock
ı
ı
- 2
,
ı
ı
2 3
EsBien
ˆ
ˆ
" (
=
ˆ
ˆ
) *
cn
ˆ
ˆ
+ -
.
ˆ
ˆ
- .
tipo_familia
ˆ
ˆ
. :
.
ˆ
ˆ
: ;
Equals
ˆ
ˆ
; A
(
ˆ
ˆ
A B
(
ˆ
ˆ
B C
(
ˆ
ˆ
C D
int
ˆ
ˆ
D G
)
ˆ
ˆ
G H
TipoFamiliaEnum
ˆ
ˆ
H W
.
ˆ
ˆ
W X
Bien
ˆ
ˆ
X \
)
ˆ
ˆ
\ ]
.
ˆ
ˆ
] ^
ToString
ˆ
ˆ
^ f
(
ˆ
ˆ
f g
)
ˆ
ˆ
g h
)
ˆ
ˆ
h i
}
˜
˜
 
)
˜
˜
  
.
˜
˜
  !
OrderBy
˜
˜
! (
(
˜
˜
( )
cnc
˜
˜
) ,
=>
˜
˜
- /
cnc
˜
˜
0 3
.
˜
˜
3 4

SoloNombre
˜
˜
4 >
)
˜
˜
> ?
;
˜
˜
? @
}
¯
¯
 
catch
˘
˘
 
(
˘
˘
 
	Exception
˘
˘
 
e
˘
˘
 
)
˘
˘
 
{
˙
˙
 
throw
˚
˚
 
new
˚
˚
 
DatosException
˚
˚
 (
(
˚
˚
( )
$str
˚
˚
) {
,
˚
˚
{ |
e
˚
˚
} ~
)
˚
˚
~ 
;˚
˚
 Ä
}
¸
¸
 
}
˝
˝
 	
public
˛
˛
 
IEnumerable
˛
˛
 
<
˛
˛
 1
#Selector_Concepto_Negocio_Comercial
˛
˛
 >
>
˛
˛
> ?A
3ObtenerConceptosDeNegociosComercialesPorRolYFamilia
˛
˛
@ s
(
˛
˛
s t
int
˛
˛
t w
idRol
˛
˛
x }
,
˛
˛
} ~
int˛
˛
 Ç
	idFamilia˛
˛
É å
)˛
˛
å ç
{
ˇ
ˇ
 	
try
ÄÄ 
{
ÅÅ 
return
ÇÇ 
_db
ÇÇ 
.
ÇÇ "
Concepto_negocio_rol
ÇÇ /
.
ÉÉ, -
Where
ÉÉ- 2
(
ÉÉ2 3
cnr
ÉÉ3 6
=>
ÉÉ7 9
cnr
ÉÉ: =
.
ÉÉ= >
id_rol
ÉÉ> D
==
ÉÉE G
idRol
ÉÉH M
&&
ÑÑ, .
cnr
ÑÑ/ 2
.
ÑÑ2 3
Concepto_negocio
ÑÑ3 C
.
ÑÑC D 
id_concepto_basico
ÑÑD V
==
ÑÑW Y
	idFamilia
ÑÑZ c
&&
ÖÖ, .
cnr
ÖÖ/ 2
.
ÖÖ2 3
Concepto_negocio
ÖÖ3 C
.
ÖÖC D

es_vigente
ÖÖD N
)
ÖÖN O
.
ÜÜ, -
Select
ÜÜ- 3
(
ÜÜ3 4
cnr
ÜÜ4 7
=>
ÜÜ8 :
cnr
ÜÜ; >
.
ÜÜ> ?
Concepto_negocio
ÜÜ? O
)
ÜÜO P
.
áá, -
Select
áá- 3
(
áá3 4
cn
áá4 6
=>
áá7 9
new
áá: =1
#Selector_Concepto_Negocio_Comercial
áá> a
(
ááa b
)
ááb c
{
àà, -
Id
ââ0 2
=
ââ3 4
cn
ââ5 7
.
ââ7 8
id
ââ8 :
,
ââ: ;

SoloNombre
ää0 :
=
ää; <
cn
ää= ?
.
ää? @
nombre
ää@ F
,
ääF G
CodigoBarra
ãã0 ;
=
ãã< =
cn
ãã> @
.
ãã@ A
codigo_barra
ããA M
,
ããM N
}
åå, -
)
åå- .
;
åå. /
}
çç 
catch
éé 
(
éé 
	Exception
éé 
e
éé 
)
éé 
{
èè 
throw
êê 
new
êê 
DatosException
êê (
(
êê( )
$str
êê) r
,
êêr s
e
êêt u
)
êêu v
;
êêv w
}
ëë 
}
íí 	
public
îî 
IEnumerable
îî 
<
îî 1
#Selector_Concepto_Negocio_Comercial
îî >
>
îî> ?P
AObtenerConceptosDeNegociosComercialesConStockPrecioPorRolYFamiliaîî@ Å
(îîÅ Ç
intîîÇ Ö
idRolîîÜ ã
,îîã å
longîîç ë'
idTransaccionInventarioîîí ©
,îî© ™
intîî´ Æ-
idActorNegocioQueTienePreciosîîØ Ã
,îîÃ Õ
intîîŒ —
	idFamiliaîî“ €
)îî€ ‹
{
ïï 	
try
ññ 
{
óó 
return
òò 
_db
òò 
.
òò O
AObtenerConceptosDeNegociosComercialesConStockPrecioPorRolYFamilia
òò \
(
òò\ ]
idRol
òò] b
,
òòb c%
idTransaccionInventario
òòd {
,
òò{ |,
idActorNegocioQueTienePreciosòò} ö
,òòö õ
	idFamiliaòòú •
)òò• ¶
.
ôô  !
Select
ôô! '
(
ôô' (
cn
ôô( *
=>
ôô+ -
new
ôô. 11
#Selector_Concepto_Negocio_Comercial
ôô2 U
(
ôôU V
)
ôôV W
{
öö  !
Id
õõ$ &
=
õõ' (
cn
õõ) +
.
õõ+ ,
id
õõ, .
,
õõ. /

SoloNombre
úú$ .
=
úú/ 0
cn
úú1 3
.
úú3 4
nombre
úú4 :
,
úú: ;
CodigoBarra
ùù$ /
=
ùù0 1
cn
ùù2 4
.
ùù4 5
codigo_barra
ùù5 A
,
ùùA B
Precio
ûû$ *
=
ûû+ ,
cn
ûû- /
.
ûû/ 0
precio
ûû0 6
,
ûû6 7
Stock
üü$ )
=
üü* +
cn
üü, .
.
üü. /
stock
üü/ 4
,
üü4 5
EsBien
††$ *
=
††+ ,
cn
††- /
.
††/ 0
tipo_familia
††0 <
.
††< =
Equals
††= C
(
††C D
(
††D E
(
††E F
int
††F I
)
††I J
TipoFamiliaEnum
††J Y
.
††Y Z
Bien
††Z ^
)
††^ _
.
††_ `
ToString
††` h
(
††h i
)
††i j
)
††j k
}
°°  !
)
°°! "
.
°°" #
OrderBy
°°# *
(
°°* +
cnc
°°+ .
=>
°°/ 1
cnc
°°2 5
.
°°5 6

SoloNombre
°°6 @
)
°°@ A
;
°°A B
}
££ 
catch
§§ 
(
§§ 
	Exception
§§ 
e
§§ 
)
§§ 
{
•• 
throw
¶¶ 
new
¶¶ 
DatosException
¶¶ (
(
¶¶( )
$str
¶¶) r
,
¶¶r s
e
¶¶t u
)
¶¶u v
;
¶¶v w
}
ßß 
}
®® 	
public
©© 
IEnumerable
©© 
<
©© )
Concepto_Negocio_Comercial_
©© 6
>
©©6 7G
9ObtenerConceptosDeNegociosComercialesPorRolesYCodigoBarra
©©8 q
(
©©q r
int
©©r u
idRol
©©v {
,
©©{ |
string©©} É
codigoBarra©©Ñ è
)©©è ê
{
™™ 	
try
´´ 
{
¨¨ 
return
≠≠ 
_db
≠≠ 
.
≠≠ "
Concepto_negocio_rol
≠≠ /
.
ÆÆ, -
Where
ÆÆ- 2
(
ÆÆ2 3
cnr
ÆÆ3 6
=>
ÆÆ7 9
cnr
ÆÆ: =
.
ÆÆ= >
id_rol
ÆÆ> D
==
ÆÆE G
idRol
ÆÆH M
&&
ØØ, .
cnr
ØØ/ 2
.
ØØ2 3
Concepto_negocio
ØØ3 C
.
ØØC D
codigo_barra
ØØD P
==
ØØQ S
codigoBarra
ØØT _
&&
∞∞, .
cnr
∞∞/ 2
.
∞∞2 3
Concepto_negocio
∞∞3 C
.
∞∞C D

es_vigente
∞∞D N
)
∞∞N O
.
±±, -
Select
±±- 3
(
±±3 4
cnr
±±4 7
=>
±±8 :
cnr
±±; >
.
±±> ?
Concepto_negocio
±±? O
)
±±O P
.
≤≤, -
Select
≤≤- 3
(
≤≤3 4
cn
≤≤4 6
=>
≤≤7 9
new
≤≤: =)
Concepto_Negocio_Comercial_
≤≤> Y
(
≤≤Y Z
)
≤≤Z [
{
≥≥, -
Id
¥¥0 2
=
¥¥3 4
cn
¥¥5 7
.
¥¥7 8
id
¥¥8 :
,
¥¥: ;
	IdFamilia
µµ0 9
=
µµ: ;
cn
µµ< >
.
µµ> ? 
id_concepto_basico
µµ? Q
,
µµQ R
CodigoBarra
∂∂0 ;
=
∂∂< =
cn
∂∂> @
.
∂∂@ A
codigo_barra
∂∂A M
,
∂∂M N
Nombre
∑∑0 6
=
∑∑7 8
cn
∑∑9 ;
.
∑∑; <
nombre
∑∑< B
,
∑∑B C!
ValorConceptoBasico
∏∏0 C
=
∏∏D E
cn
∏∏F H
.
∏∏H I
Detalle_maestro4
∏∏I Y
.
∏∏Y Z
valor
∏∏Z _
,
∏∏_ `
}
ππ, -
)
ππ- .
;
ππ. /
}
∫∫ 
catch
ªª 
(
ªª 
	Exception
ªª 
e
ªª 
)
ªª 
{
ºº 
throw
ΩΩ 
new
ΩΩ 
DatosException
ΩΩ (
(
ΩΩ( )
$str
ΩΩ) d
,
ΩΩd e
e
ΩΩf g
)
ΩΩg h
;
ΩΩh i
}
ææ 
}
øø 	
public
¿¿ 
IEnumerable
¿¿ 
<
¿¿ )
Concepto_Negocio_Comercial_
¿¿ 6
>
¿¿6 7G
9ObtenerConceptosDeNegociosComercialesPorRolesYCodigoBarra
¿¿8 q
(
¿¿q r
int
¿¿r u
idRol
¿¿v {
,
¿¿{ |
string¿¿} É
codigoBarra¿¿Ñ è
,¿¿è ê
string¿¿ë ó 
valorTipoFamilia¿¿ò ®
)¿¿® ©
{
¡¡ 	
try
¬¬ 
{
√√ 
return
ƒƒ 
_db
ƒƒ 
.
ƒƒ "
Concepto_negocio_rol
ƒƒ /
.
≈≈, -
Where
≈≈- 2
(
≈≈2 3
cnr
≈≈3 6
=>
≈≈7 9
cnr
≈≈: =
.
≈≈= >
id_rol
≈≈> D
==
≈≈E G
idRol
≈≈H M
&&
∆∆, .
cnr
∆∆/ 2
.
∆∆2 3
Concepto_negocio
∆∆3 C
.
∆∆C D
codigo_barra
∆∆D P
==
∆∆Q S
codigoBarra
∆∆T _
&&
««, .
cnr
««/ 2
.
««2 3
Concepto_negocio
««3 C
.
««C D

es_vigente
««D N
&&
»», .
cnr
»»/ 2
.
»»2 3
Concepto_negocio
»»3 C
.
»»C D
Detalle_maestro4
»»D T
.
»»T U
valor
»»U Z
==
»»[ ]
valorTipoFamilia
»»^ n
)
»»n o
.
……, -
Select
……- 3
(
……3 4
cnr
……4 7
=>
……8 :
cnr
……; >
.
……> ?
Concepto_negocio
……? O
)
……O P
.
  , -
Select
  - 3
(
  3 4
cn
  4 6
=>
  7 9
new
  : =)
Concepto_Negocio_Comercial_
  > Y
(
  Y Z
)
  Z [
{
ÀÀ, -
Id
ÃÃ0 2
=
ÃÃ3 4
cn
ÃÃ5 7
.
ÃÃ7 8
id
ÃÃ8 :
,
ÃÃ: ;
	IdFamilia
ÕÕ0 9
=
ÕÕ: ;
cn
ÕÕ< >
.
ÕÕ> ? 
id_concepto_basico
ÕÕ? Q
,
ÕÕQ R
CodigoBarra
ŒŒ0 ;
=
ŒŒ< =
cn
ŒŒ> @
.
ŒŒ@ A
codigo_barra
ŒŒA M
,
ŒŒM N
Nombre
œœ0 6
=
œœ7 8
cn
œœ9 ;
.
œœ; <
nombre
œœ< B
,
œœB C!
ValorConceptoBasico
––0 C
=
––D E
cn
––F H
.
––H I
Detalle_maestro4
––I Y
.
––Y Z
valor
––Z _
,
––_ `
}
——, -
)
——- .
;
——. /
}
““ 
catch
”” 
(
”” 
	Exception
”” 
e
”” 
)
”” 
{
‘‘ 
throw
’’ 
new
’’ 
DatosException
’’ (
(
’’( )
$str
’’) d
,
’’d e
e
’’f g
)
’’g h
;
’’h i
}
÷÷ 
}
◊◊ 	
public
ÿÿ 
IEnumerable
ÿÿ 
<
ÿÿ )
Concepto_Negocio_Comercial_
ÿÿ 6
>
ÿÿ6 7O
AObtenerConceptosDeNegociosComercialesConStockPorRolesYCodigoBarra
ÿÿ8 y
(
ÿÿy z
long
ÿÿz ~&
idTransaccionInventarioÿÿ ñ
,ÿÿñ ó
intÿÿò õ
idRolÿÿú °
,ÿÿ° ¢
stringÿÿ£ ©
codigoBarraÿÿ™ µ
)ÿÿµ ∂
{
ŸŸ 	
try
⁄⁄ 
{
€€ 
_db
‹‹ 
.
‹‹ 
Configuration
‹‹ !
.
‹‹! " 
LazyLoadingEnabled
‹‹" 4
=
‹‹5 6
false
‹‹7 <
;
‹‹< =
return
›› 
_db
›› 
.
›› "
Concepto_negocio_rol
›› /
.
ﬁﬁ  
Where
ﬁﬁ  %
(
ﬁﬁ% &
cnr
ﬁﬁ& )
=>
ﬁﬁ* ,
cnr
ﬁﬁ- 0
.
ﬁﬁ0 1
id_rol
ﬁﬁ1 7
==
ﬁﬁ8 :
idRol
ﬁﬁ; @
&&
ﬂﬂ !
cnr
ﬂﬂ" %
.
ﬂﬂ% &
Concepto_negocio
ﬂﬂ& 6
.
ﬂﬂ6 7
codigo_barra
ﬂﬂ7 C
==
ﬂﬂD F
codigoBarra
ﬂﬂG R
&&
‡‡ !
cnr
‡‡" %
.
‡‡% &
Concepto_negocio
‡‡& 6
.
‡‡6 7

es_vigente
‡‡7 A
)
‡‡A B
.
··  
Select
··  &
(
··& '
cnr
··' *
=>
··+ -
cnr
··. 1
.
··1 2
Concepto_negocio
··2 B
)
··B C
.
‚‚  
Select
‚‚  &
(
‚‚& '
cn
‚‚' )
=>
‚‚* ,
new
‚‚- 0)
Concepto_Negocio_Comercial_
‚‚1 L
(
‚‚L M
)
‚‚M N
{
„„  
Id
‰‰# %
=
‰‰& '
cn
‰‰( *
.
‰‰* +
id
‰‰+ -
,
‰‰- .
	IdFamilia
ÂÂ# ,
=
ÂÂ- .
cn
ÂÂ/ 1
.
ÂÂ1 2 
id_concepto_basico
ÂÂ2 D
,
ÂÂD E
Nombre
ÊÊ# )
=
ÊÊ* +
cn
ÊÊ, .
.
ÊÊ. /
nombre
ÊÊ/ 5
,
ÊÊ5 6
CodigoBarra
ÁÁ# .
=
ÁÁ/ 0
cn
ÁÁ1 3
.
ÁÁ3 4
codigo_barra
ÁÁ4 @
,
ÁÁ@ A!
ValorConceptoBasico
ËË# 6
=
ËË7 8
cn
ËË9 ;
.
ËË; <
Detalle_maestro4
ËË< L
.
ËËL M
valor
ËËM R
,
ËËR S
Stock
ÈÈ# (
=
ÈÈ) *
cn
ÈÈ+ -
.
ÈÈ- .!
Detalle_transaccion
ÈÈ. A
.
ÈÈA B
Where
ÈÈB G
(
ÈÈG H
dt
ÈÈH J
=>
ÈÈK M
dt
ÈÈN P
.
ÈÈP Q
id_transaccion
ÈÈQ _
==
ÈÈ` b%
idTransaccionInventario
ÈÈc z
&&
ÈÈ{ }
dtÈÈ~ Ä
.ÈÈÄ Å 
Concepto_negocioÈÈÅ ë
.ÈÈë í
codigo_barraÈÈí û
==ÈÈü °
codigoBarraÈÈ¢ ≠
)ÈÈ≠ Æ
.ÈÈÆ Ø
FirstOrDefaultÈÈØ Ω
(ÈÈΩ æ
)ÈÈæ ø
.ÈÈø ¿
cantidadÈÈ¿ »
}
ÍÍ  
)
ÍÍ  !
;
ÍÍ! "
}
ÎÎ 
catch
ÏÏ 
(
ÏÏ 
	Exception
ÏÏ 
e
ÏÏ 
)
ÏÏ 
{
ÌÌ 
throw
ÓÓ 
new
ÓÓ 
DatosException
ÓÓ (
(
ÓÓ( )
$str
ÓÓ) d
,
ÓÓd e
e
ÓÓf g
)
ÓÓg h
;
ÓÓh i
}
ÔÔ 
finally
 
{
ÒÒ 
_db
ÚÚ 
.
ÚÚ 
Configuration
ÚÚ !
.
ÚÚ! " 
LazyLoadingEnabled
ÚÚ" 4
=
ÚÚ5 6
true
ÚÚ7 ;
;
ÚÚ; <
}
ÛÛ 
}
ÙÙ 	
public
ıı 
IEnumerable
ıı 
<
ıı )
Concepto_Negocio_Comercial_
ıı 6
>
ıı6 7O
AObtenerConceptosDeNegociosComercialesConStockPorRolesYCodigoBarra
ıı8 y
(
ııy z
long
ıız ~&
idTransaccionInventarioıı ñ
,ııñ ó
intııò õ
idRolııú °
,ıı° ¢
stringıı£ ©
codigoBarraıı™ µ
,ııµ ∂
stringıı∑ Ω 
valorTipoFamiliaııæ Œ
)ııŒ œ
{
ˆˆ 	
try
˜˜ 
{
¯¯ 
_db
˘˘ 
.
˘˘ 
Configuration
˘˘ !
.
˘˘! " 
LazyLoadingEnabled
˘˘" 4
=
˘˘5 6
false
˘˘7 <
;
˘˘< =
return
˙˙ 
_db
˙˙ 
.
˙˙ "
Concepto_negocio_rol
˙˙ /
.
˚˚  
Where
˚˚  %
(
˚˚% &
cnr
˚˚& )
=>
˚˚* ,
cnr
˚˚- 0
.
˚˚0 1
id_rol
˚˚1 7
==
˚˚8 :
idRol
˚˚; @
&&
¸¸ !
cnr
¸¸" %
.
¸¸% &
Concepto_negocio
¸¸& 6
.
¸¸6 7
codigo_barra
¸¸7 C
==
¸¸D F
codigoBarra
¸¸G R
&&
˝˝ !
cnr
˝˝" %
.
˝˝% &
Concepto_negocio
˝˝& 6
.
˝˝6 7

es_vigente
˝˝7 A
&&
˛˛ !
cnr
˛˛" %
.
˛˛% &
Concepto_negocio
˛˛& 6
.
˛˛6 7
Detalle_maestro4
˛˛7 G
.
˛˛G H
valor
˛˛H M
==
˛˛N P
valorTipoFamilia
˛˛Q a
)
˛˛a b
.
ˇˇ  
Select
ˇˇ  &
(
ˇˇ& '
cnr
ˇˇ' *
=>
ˇˇ+ -
cnr
ˇˇ. 1
.
ˇˇ1 2
Concepto_negocio
ˇˇ2 B
)
ˇˇB C
.
ÄÄ  
Select
ÄÄ  &
(
ÄÄ& '
cn
ÄÄ' )
=>
ÄÄ* ,
new
ÄÄ- 0)
Concepto_Negocio_Comercial_
ÄÄ1 L
(
ÄÄL M
)
ÄÄM N
{
ÅÅ  
Id
ÇÇ# %
=
ÇÇ& '
cn
ÇÇ( *
.
ÇÇ* +
id
ÇÇ+ -
,
ÇÇ- .
	IdFamilia
ÉÉ# ,
=
ÉÉ- .
cn
ÉÉ/ 1
.
ÉÉ1 2 
id_concepto_basico
ÉÉ2 D
,
ÉÉD E
Nombre
ÑÑ# )
=
ÑÑ* +
cn
ÑÑ, .
.
ÑÑ. /
nombre
ÑÑ/ 5
,
ÑÑ5 6
CodigoBarra
ÖÖ# .
=
ÖÖ/ 0
cn
ÖÖ1 3
.
ÖÖ3 4
codigo_barra
ÖÖ4 @
,
ÖÖ@ A!
ValorConceptoBasico
ÜÜ# 6
=
ÜÜ7 8
cn
ÜÜ9 ;
.
ÜÜ; <
Detalle_maestro4
ÜÜ< L
.
ÜÜL M
valor
ÜÜM R
,
ÜÜR S
Stock
áá# (
=
áá) *
cn
áá+ -
.
áá- .!
Detalle_transaccion
áá. A
.
ááA B
Where
ááB G
(
ááG H
dt
ááH J
=>
ááK M
dt
ááN P
.
ááP Q
id_transaccion
ááQ _
==
áá` b%
idTransaccionInventario
áác z
&&
áá{ }
dtáá~ Ä
.ááÄ Å 
Concepto_negocioááÅ ë
.ááë í
codigo_barraááí û
==ááü °
codigoBarraáá¢ ≠
)áá≠ Æ
.ááÆ Ø
FirstOrDefaultááØ Ω
(ááΩ æ
)ááæ ø
.ááø ¿
cantidadáá¿ »
}
àà  
)
àà  !
;
àà! "
}
ââ 
catch
ää 
(
ää 
	Exception
ää 
e
ää 
)
ää 
{
ãã 
throw
åå 
new
åå 
DatosException
åå (
(
åå( )
$str
åå) d
,
ååd e
e
ååf g
)
ååg h
;
ååh i
}
çç 
finally
éé 
{
èè 
_db
êê 
.
êê 
Configuration
êê !
.
êê! " 
LazyLoadingEnabled
êê" 4
=
êê5 6
true
êê7 ;
;
êê; <
}
ëë 
}
íí 	
public
ìì 
IEnumerable
ìì 
<
ìì )
Concepto_Negocio_Comercial_
ìì 6
>
ìì6 7P
BObtenerConceptosDeNegociosComercialesConPrecioPorRolesYCodigoBarra
ìì8 z
(
ììz {
int
ìì{ ~,
idActorNegocioQueTienePreciosìì ú
,ììú ù
intììû °
idRolìì¢ ß
,ììß ®
stringìì© Ø
codigoBarraìì∞ ª
)ììª º
{
îî 	
try
ïï 
{
ññ 
_db
óó 
.
óó 
Configuration
óó !
.
óó! " 
LazyLoadingEnabled
óó" 4
=
óó5 6
false
óó7 <
;
óó< =
return
òò 
_db
òò 
.
òò "
Concepto_negocio_rol
òò /
.
ôô  
Where
ôô  %
(
ôô% &
cnr
ôô& )
=>
ôô* ,
cnr
ôô- 0
.
ôô0 1
id_rol
ôô1 7
==
ôô8 :
idRol
ôô; @
&&
öö !
cnr
öö" %
.
öö% &
Concepto_negocio
öö& 6
.
öö6 7
codigo_barra
öö7 C
==
ööD F
codigoBarra
ööG R
&&
õõ !
cnr
õõ" %
.
õõ% &
Concepto_negocio
õõ& 6
.
õõ6 7

es_vigente
õõ7 A
)
õõA B
.
úú  
Select
úú  &
(
úú& '
cnr
úú' *
=>
úú+ -
cnr
úú. 1
.
úú1 2
Concepto_negocio
úú2 B
)
úúB C
.
ùù  
Select
ùù  &
(
ùù& '
cn
ùù' )
=>
ùù* ,
new
ùù- 0)
Concepto_Negocio_Comercial_
ùù1 L
(
ùùL M
)
ùùM N
{
ûû  
Id
üü# %
=
üü& '
cn
üü( *
.
üü* +
id
üü+ -
,
üü- .
	IdFamilia
††# ,
=
††- .
cn
††/ 1
.
††1 2 
id_concepto_basico
††2 D
,
††D E
Nombre
°°# )
=
°°* +
cn
°°, .
.
°°. /
nombre
°°/ 5
,
°°5 6
CodigoBarra
¢¢# .
=
¢¢/ 0
cn
¢¢1 3
.
¢¢3 4
codigo_barra
¢¢4 @
,
¢¢@ A!
ValorConceptoBasico
££# 6
=
££7 8
cn
££9 ;
.
££; <
Detalle_maestro4
££< L
.
££L M
valor
££M R
,
££R S
Precios
§§# *
=
§§+ ,
cn
§§- /
.
§§/ 0
Precio1
§§0 7
.
§§7 8
Where
§§8 =
(
§§= >
p
§§> ?
=>
§§@ B
p
§§C D
.
§§D E
id_actor_negocio
§§E U
==
§§V X+
idActorNegocioQueTienePrecios
§§Y v
&&
§§w y
p
§§z {
.
§§{ |

es_vigente§§| Ü
)§§Ü á
.
••8 9
Select
••9 ?
(
••? @
p
••@ A
=>
••B D
new
••E H/
!Precio_Concepto_Negocio_Comercial
••I j
(
••j k
)
••k l
{
¶¶8 9
Id
ßß< >
=
ßß? @
p
ßßA B
.
ßßB C
id
ßßC E
,
ßßE F
IdTarifa
®®< D
=
®®E F
p
®®G H
.
®®H I
id_tarifa_d
®®I T
,
®®T U
Tarifa
©©< B
=
©©C D
p
©©E F
.
©©F G
Detalle_maestro3
©©G W
.
©©W X
nombre
©©X ^
,
©©^ _
Valor
™™< A
=
™™B C
p
™™D E
.
™™E F
valor
™™F K
,
™™K L
Codigo
´´< B
=
´´C D
p
´´E F
.
´´F G
Detalle_maestro3
´´G W
.
´´W X
codigo
´´X ^
}
¨¨8 9
)
¨¨9 :
,
¨¨: ;
}
≠≠  
)
≠≠  !
;
≠≠! "
}
ÆÆ 
catch
ØØ 
(
ØØ 
	Exception
ØØ 
e
ØØ 
)
ØØ 
{
∞∞ 
throw
±± 
new
±± 
DatosException
±± (
(
±±( )
$str
±±) d
,
±±d e
e
±±f g
)
±±g h
;
±±h i
}
≤≤ 
finally
≥≥ 
{
¥¥ 
_db
µµ 
.
µµ 
Configuration
µµ !
.
µµ! " 
LazyLoadingEnabled
µµ" 4
=
µµ5 6
true
µµ7 ;
;
µµ; <
}
∂∂ 
}
∑∑ 	
public
∏∏ 
IEnumerable
∏∏ 
<
∏∏ )
Concepto_Negocio_Comercial_
∏∏ 6
>
∏∏6 7P
BObtenerConceptosDeNegociosComercialesConPrecioPorRolesYCodigoBarra
∏∏8 z
(
∏∏z {
int
∏∏{ ~,
idActorNegocioQueTienePrecios∏∏ ú
,∏∏ú ù
int∏∏û °
idRol∏∏¢ ß
,∏∏ß ®
string∏∏© Ø
codigoBarra∏∏∞ ª
,∏∏ª º
string∏∏Ω √ 
valorTipoFamilia∏∏ƒ ‘
)∏∏‘ ’
{
ππ 	
try
∫∫ 
{
ªª 
_db
ºº 
.
ºº 
Configuration
ºº !
.
ºº! " 
LazyLoadingEnabled
ºº" 4
=
ºº5 6
false
ºº7 <
;
ºº< =
return
ΩΩ 
_db
ΩΩ 
.
ΩΩ "
Concepto_negocio_rol
ΩΩ /
.
ææ  
Where
ææ  %
(
ææ% &
cnr
ææ& )
=>
ææ* ,
cnr
ææ- 0
.
ææ0 1
id_rol
ææ1 7
==
ææ8 :
idRol
ææ; @
&&
øø !
cnr
øø" %
.
øø% &
Concepto_negocio
øø& 6
.
øø6 7
codigo_barra
øø7 C
==
øøD F
codigoBarra
øøG R
&&
¿¿ !
cnr
¿¿" %
.
¿¿% &
Concepto_negocio
¿¿& 6
.
¿¿6 7

es_vigente
¿¿7 A
&&
¡¡ !
cnr
¡¡" %
.
¡¡% &
Concepto_negocio
¡¡& 6
.
¡¡6 7
Detalle_maestro4
¡¡7 G
.
¡¡G H
valor
¡¡H M
==
¡¡N P
valorTipoFamilia
¡¡Q a
)
¡¡a b
.
¬¬  
Select
¬¬  &
(
¬¬& '
cnr
¬¬' *
=>
¬¬+ -
cnr
¬¬. 1
.
¬¬1 2
Concepto_negocio
¬¬2 B
)
¬¬B C
.
√√  
Select
√√  &
(
√√& '
cn
√√' )
=>
√√* ,
new
√√- 0)
Concepto_Negocio_Comercial_
√√1 L
(
√√L M
)
√√M N
{
ƒƒ  
Id
≈≈# %
=
≈≈& '
cn
≈≈( *
.
≈≈* +
id
≈≈+ -
,
≈≈- .
	IdFamilia
∆∆# ,
=
∆∆- .
cn
∆∆/ 1
.
∆∆1 2 
id_concepto_basico
∆∆2 D
,
∆∆D E
Nombre
««# )
=
««* +
cn
««, .
.
««. /
nombre
««/ 5
,
««5 6
CodigoBarra
»»# .
=
»»/ 0
cn
»»1 3
.
»»3 4
codigo_barra
»»4 @
,
»»@ A!
ValorConceptoBasico
……# 6
=
……7 8
cn
……9 ;
.
……; <
Detalle_maestro4
……< L
.
……L M
valor
……M R
,
……R S
Precios
  # *
=
  + ,
cn
  - /
.
  / 0
Precio1
  0 7
.
  7 8
Where
  8 =
(
  = >
p
  > ?
=>
  @ B
p
  C D
.
  D E
id_actor_negocio
  E U
==
  V X+
idActorNegocioQueTienePrecios
  Y v
&&
  w y
p
  z {
.
  { |

es_vigente  | Ü
)  Ü á
.
ÀÀ8 9
Select
ÀÀ9 ?
(
ÀÀ? @
p
ÀÀ@ A
=>
ÀÀB D
new
ÀÀE H/
!Precio_Concepto_Negocio_Comercial
ÀÀI j
(
ÀÀj k
)
ÀÀk l
{
ÃÃ8 9
Id
ÕÕ< >
=
ÕÕ? @
p
ÕÕA B
.
ÕÕB C
id
ÕÕC E
,
ÕÕE F
IdTarifa
ŒŒ< D
=
ŒŒE F
p
ŒŒG H
.
ŒŒH I
id_tarifa_d
ŒŒI T
,
ŒŒT U
Tarifa
œœ< B
=
œœC D
p
œœE F
.
œœF G
Detalle_maestro3
œœG W
.
œœW X
nombre
œœX ^
,
œœ^ _
Valor
––< A
=
––B C
p
––D E
.
––E F
valor
––F K
,
––K L
Codigo
——< B
=
——C D
p
——E F
.
——F G
Detalle_maestro3
——G W
.
——W X
codigo
——X ^
}
““8 9
)
““9 :
,
““: ;
}
””  
)
””  !
;
””! "
}
‘‘ 
catch
’’ 
(
’’ 
	Exception
’’ 
e
’’ 
)
’’ 
{
÷÷ 
throw
◊◊ 
new
◊◊ 
DatosException
◊◊ (
(
◊◊( )
$str
◊◊) d
,
◊◊d e
e
◊◊f g
)
◊◊g h
;
◊◊h i
}
ÿÿ 
finally
ŸŸ 
{
⁄⁄ 
_db
€€ 
.
€€ 
Configuration
€€ !
.
€€! " 
LazyLoadingEnabled
€€" 4
=
€€5 6
true
€€7 ;
;
€€; <
}
‹‹ 
}
›› 	
public
ﬁﬁ 
IEnumerable
ﬁﬁ 
<
ﬁﬁ )
Concepto_Negocio_Comercial_
ﬁﬁ 6
>
ﬁﬁ6 7U
GObtenerConceptosDeNegociosComercialesConStockPrecioPorRolesYCodigoBarra
ﬁﬁ8 
(ﬁﬁ Ä
longﬁﬁÄ Ñ'
idTransaccionInventarioﬁﬁÖ ú
,ﬁﬁú ù
intﬁﬁû °-
idActorNegocioQueTienePreciosﬁﬁ¢ ø
,ﬁﬁø ¿
intﬁﬁ¡ ƒ
idRolﬁﬁ≈  
,ﬁﬁ  À
stringﬁﬁÃ “
codigoBarraﬁﬁ” ﬁ
)ﬁﬁﬁ ﬂ
{
ﬂﬂ 	
try
‡‡ 
{
·· 
_db
‚‚ 
.
‚‚ 
Configuration
‚‚ !
.
‚‚! " 
LazyLoadingEnabled
‚‚" 4
=
‚‚5 6
false
‚‚7 <
;
‚‚< =
return
„„ 
_db
„„ 
.
„„ "
Concepto_negocio_rol
„„ /
.
‰‰  
Where
‰‰  %
(
‰‰% &
cnr
‰‰& )
=>
‰‰* ,
cnr
‰‰- 0
.
‰‰0 1
id_rol
‰‰1 7
==
‰‰8 :
idRol
‰‰; @
&&
ÂÂ !
cnr
ÂÂ" %
.
ÂÂ% &
Concepto_negocio
ÂÂ& 6
.
ÂÂ6 7
codigo_barra
ÂÂ7 C
==
ÂÂD F
codigoBarra
ÂÂG R
&&
ÊÊ !
cnr
ÊÊ" %
.
ÊÊ% &
Concepto_negocio
ÊÊ& 6
.
ÊÊ6 7

es_vigente
ÊÊ7 A
)
ÊÊA B
.
ÁÁ  
Select
ÁÁ  &
(
ÁÁ& '
cnr
ÁÁ' *
=>
ÁÁ+ -
cnr
ÁÁ. 1
.
ÁÁ1 2
Concepto_negocio
ÁÁ2 B
)
ÁÁB C
.
ËË  
Select
ËË  &
(
ËË& '
cn
ËË' )
=>
ËË* ,
new
ËË- 0)
Concepto_Negocio_Comercial_
ËË1 L
(
ËËL M
)
ËËM N
{
ÈÈ  
Id
ÍÍ# %
=
ÍÍ& '
cn
ÍÍ( *
.
ÍÍ* +
id
ÍÍ+ -
,
ÍÍ- .
	IdFamilia
ÎÎ# ,
=
ÎÎ- .
cn
ÎÎ/ 1
.
ÎÎ1 2 
id_concepto_basico
ÎÎ2 D
,
ÎÎD E
Nombre
ÏÏ# )
=
ÏÏ* +
cn
ÏÏ, .
.
ÏÏ. /
nombre
ÏÏ/ 5
,
ÏÏ5 6
CodigoBarra
ÌÌ# .
=
ÌÌ/ 0
cn
ÌÌ1 3
.
ÌÌ3 4
codigo_barra
ÌÌ4 @
,
ÌÌ@ A!
ValorConceptoBasico
ÓÓ# 6
=
ÓÓ7 8
cn
ÓÓ9 ;
.
ÓÓ; <
Detalle_maestro4
ÓÓ< L
.
ÓÓL M
valor
ÓÓM R
,
ÓÓR S
Stock
ÔÔ# (
=
ÔÔ) *
cn
ÔÔ+ -
.
ÔÔ- .!
Detalle_transaccion
ÔÔ. A
.
ÔÔA B
Where
ÔÔB G
(
ÔÔG H
dt
ÔÔH J
=>
ÔÔK M
dt
ÔÔN P
.
ÔÔP Q
id_transaccion
ÔÔQ _
==
ÔÔ` b%
idTransaccionInventario
ÔÔc z
&&
ÔÔ{ }
dtÔÔ~ Ä
.ÔÔÄ Å 
Concepto_negocioÔÔÅ ë
.ÔÔë í
codigo_barraÔÔí û
==ÔÔü °
codigoBarraÔÔ¢ ≠
)ÔÔ≠ Æ
.ÔÔÆ Ø
FirstOrDefaultÔÔØ Ω
(ÔÔΩ æ
)ÔÔæ ø
.ÔÔø ¿
cantidadÔÔ¿ »
,ÔÔ» …
Precios
# *
=
+ ,
cn
- /
.
/ 0
Precio1
0 7
.
7 8
Where
8 =
(
= >
p
> ?
=>
@ B
p
C D
.
D E
id_actor_negocio
E U
==
V X+
idActorNegocioQueTienePrecios
Y v
&&
w y
p
z {
.
{ |

es_vigente| Ü
)Ü á
.
ÒÒ8 9
Select
ÒÒ9 ?
(
ÒÒ? @
p
ÒÒ@ A
=>
ÒÒB D
new
ÒÒE H/
!Precio_Concepto_Negocio_Comercial
ÒÒI j
(
ÒÒj k
)
ÒÒk l
{
ÚÚ8 9
Id
ÛÛ< >
=
ÛÛ? @
p
ÛÛA B
.
ÛÛB C
id
ÛÛC E
,
ÛÛE F
IdTarifa
ÙÙ< D
=
ÙÙE F
p
ÙÙG H
.
ÙÙH I
id_tarifa_d
ÙÙI T
,
ÙÙT U
Tarifa
ıı< B
=
ııC D
p
ııE F
.
ııF G
Detalle_maestro3
ııG W
.
ııW X
nombre
ııX ^
,
ıı^ _
Valor
ˆˆ< A
=
ˆˆB C
p
ˆˆD E
.
ˆˆE F
valor
ˆˆF K
,
ˆˆK L
Codigo
˜˜< B
=
˜˜C D
p
˜˜E F
.
˜˜F G
Detalle_maestro3
˜˜G W
.
˜˜W X
codigo
˜˜X ^
}
¯¯8 9
)
¯¯9 :
,
¯¯: ;
}
˘˘  
)
˘˘  !
;
˘˘! "
}
˙˙ 
catch
˚˚ 
(
˚˚ 
	Exception
˚˚ 
e
˚˚ 
)
˚˚ 
{
¸¸ 
throw
˝˝ 
new
˝˝ 
DatosException
˝˝ (
(
˝˝( )
$str
˝˝) d
,
˝˝d e
e
˝˝f g
)
˝˝g h
;
˝˝h i
}
˛˛ 
finally
ˇˇ 
{
ÄÄ 
_db
ÅÅ 
.
ÅÅ 
Configuration
ÅÅ !
.
ÅÅ! " 
LazyLoadingEnabled
ÅÅ" 4
=
ÅÅ5 6
true
ÅÅ7 ;
;
ÅÅ; <
}
ÇÇ 
}
ÉÉ 	
public
ÑÑ 
IEnumerable
ÑÑ 
<
ÑÑ )
Concepto_Negocio_Comercial_
ÑÑ 6
>
ÑÑ6 7U
GObtenerConceptosDeNegociosComercialesConStockPrecioPorRolesYCodigoBarra
ÑÑ8 
(ÑÑ Ä
longÑÑÄ Ñ'
idTransaccionInventarioÑÑÖ ú
,ÑÑú ù
intÑÑû °-
idActorNegocioQueTienePreciosÑÑ¢ ø
,ÑÑø ¿
intÑÑ¡ ƒ
idRolÑÑ≈  
,ÑÑ  À
stringÑÑÃ “
codigoBarraÑÑ” ﬁ
,ÑÑﬁ ﬂ
stringÑÑ‡ Ê 
valorTipoFamiliaÑÑÁ ˜
)ÑÑ˜ ¯
{
ÖÖ 	
try
ÜÜ 
{
áá 
_db
àà 
.
àà 
Configuration
àà !
.
àà! " 
LazyLoadingEnabled
àà" 4
=
àà5 6
false
àà7 <
;
àà< =
return
ââ 
_db
ââ 
.
ââ "
Concepto_negocio_rol
ââ /
.
ää  
Where
ää  %
(
ää% &
cnr
ää& )
=>
ää* ,
cnr
ää- 0
.
ää0 1
id_rol
ää1 7
==
ää8 :
idRol
ää; @
&&
ãã !
cnr
ãã" %
.
ãã% &
Concepto_negocio
ãã& 6
.
ãã6 7
codigo_barra
ãã7 C
==
ããD F
codigoBarra
ããG R
&&
åå !
cnr
åå" %
.
åå% &
Concepto_negocio
åå& 6
.
åå6 7

es_vigente
åå7 A
&&
çç !
cnr
çç" %
.
çç% &
Concepto_negocio
çç& 6
.
çç6 7
Detalle_maestro4
çç7 G
.
ççG H
valor
ççH M
==
ççN P
valorTipoFamilia
ççQ a
)
çça b
.
éé  
Select
éé  &
(
éé& '
cnr
éé' *
=>
éé+ -
cnr
éé. 1
.
éé1 2
Concepto_negocio
éé2 B
)
ééB C
.
èè  
Select
èè  &
(
èè& '
cn
èè' )
=>
èè* ,
new
èè- 0)
Concepto_Negocio_Comercial_
èè1 L
(
èèL M
)
èèM N
{
êê  
Id
ëë# %
=
ëë& '
cn
ëë( *
.
ëë* +
id
ëë+ -
,
ëë- .
	IdFamilia
íí# ,
=
íí- .
cn
íí/ 1
.
íí1 2 
id_concepto_basico
íí2 D
,
ííD E
Nombre
ìì# )
=
ìì* +
cn
ìì, .
.
ìì. /
nombre
ìì/ 5
,
ìì5 6
CodigoBarra
îî# .
=
îî/ 0
cn
îî1 3
.
îî3 4
codigo_barra
îî4 @
,
îî@ A!
ValorConceptoBasico
ïï# 6
=
ïï7 8
cn
ïï9 ;
.
ïï; <
Detalle_maestro4
ïï< L
.
ïïL M
valor
ïïM R
,
ïïR S
Stock
ññ# (
=
ññ) *
cn
ññ+ -
.
ññ- .!
Detalle_transaccion
ññ. A
.
ññA B
Where
ññB G
(
ññG H
dt
ññH J
=>
ññK M
dt
ññN P
.
ññP Q
id_transaccion
ññQ _
==
ññ` b%
idTransaccionInventario
ññc z
&&
ññ{ }
dtññ~ Ä
.ññÄ Å 
Concepto_negocioññÅ ë
.ññë í
codigo_barraññí û
==ññü °
codigoBarraññ¢ ≠
)ññ≠ Æ
.ññÆ Ø
FirstOrDefaultññØ Ω
(ññΩ æ
)ññæ ø
.ññø ¿
cantidadññ¿ »
,ññ» …
Precios
óó# *
=
óó+ ,
cn
óó- /
.
óó/ 0
Precio1
óó0 7
.
óó7 8
Where
óó8 =
(
óó= >
p
óó> ?
=>
óó@ B
p
óóC D
.
óóD E
id_actor_negocio
óóE U
==
óóV X+
idActorNegocioQueTienePrecios
óóY v
&&
óów y
p
óóz {
.
óó{ |

es_vigenteóó| Ü
)óóÜ á
.
òò8 9
Select
òò9 ?
(
òò? @
p
òò@ A
=>
òòB D
new
òòE H/
!Precio_Concepto_Negocio_Comercial
òòI j
(
òòj k
)
òòk l
{
ôô8 9
Id
öö< >
=
öö? @
p
ööA B
.
ööB C
id
ööC E
,
ööE F
IdTarifa
õõ< D
=
õõE F
p
õõG H
.
õõH I
id_tarifa_d
õõI T
,
õõT U
Tarifa
úú< B
=
úúC D
p
úúE F
.
úúF G
Detalle_maestro3
úúG W
.
úúW X
nombre
úúX ^
,
úú^ _
Valor
ùù< A
=
ùùB C
p
ùùD E
.
ùùE F
valor
ùùF K
,
ùùK L
Codigo
ûû< B
=
ûûC D
p
ûûE F
.
ûûF G
Detalle_maestro3
ûûG W
.
ûûW X
codigo
ûûX ^
}
üü8 9
)
üü9 :
,
üü: ;
}
††  
)
††  !
;
††! "
}
°° 
catch
¢¢ 
(
¢¢ 
	Exception
¢¢ 
e
¢¢ 
)
¢¢ 
{
££ 
throw
§§ 
new
§§ 
DatosException
§§ (
(
§§( )
$str
§§) d
,
§§d e
e
§§f g
)
§§g h
;
§§h i
}
•• 
finally
¶¶ 
{
ßß 
_db
®® 
.
®® 
Configuration
®® !
.
®®! " 
LazyLoadingEnabled
®®" 4
=
®®5 6
true
®®7 ;
;
®®; <
}
©© 
}
™™ 	
public
´´ )
Concepto_Negocio_Comercial_
´´ *B
4ObtenerConceptoDeNegocioComercialPorRolesEIdConcepto
´´+ _
(
´´_ `
int
´´` c
idRol
´´d i
,
´´i j
int
´´k n 
idConceptoNegocio´´o Ä
)´´Ä Å
{
¨¨ 	
try
≠≠ 
{
ÆÆ 
return
ØØ 
_db
ØØ 
.
ØØ "
Concepto_negocio_rol
ØØ /
.
∞∞, -
Where
∞∞- 2
(
∞∞2 3
cnr
∞∞3 6
=>
∞∞7 9
cnr
∞∞: =
.
∞∞= >
id_rol
∞∞> D
==
∞∞E G
idRol
∞∞H M
&&
±±, .
cnr
±±/ 2
.
±±2 3
Concepto_negocio
±±3 C
.
±±C D
id
±±D F
==
±±G I
idConceptoNegocio
±±J [
&&
≤≤, .
cnr
≤≤/ 2
.
≤≤2 3
Concepto_negocio
≤≤3 C
.
≤≤C D

es_vigente
≤≤D N
)
≤≤N O
.
≥≥, -
Select
≥≥- 3
(
≥≥3 4
cnr
≥≥4 7
=>
≥≥8 :
cnr
≥≥; >
.
≥≥> ?
Concepto_negocio
≥≥? O
)
≥≥O P
.
¥¥, -
Select
¥¥- 3
(
¥¥3 4
cn
¥¥4 6
=>
¥¥7 9
new
¥¥: =)
Concepto_Negocio_Comercial_
¥¥> Y
(
¥¥Y Z
)
¥¥Z [
{
µµ, -
Id
∂∂0 2
=
∂∂3 4
cn
∂∂5 7
.
∂∂7 8
id
∂∂8 :
,
∂∂: ;
	IdFamilia
∑∑0 9
=
∑∑: ;
cn
∑∑< >
.
∑∑> ? 
id_concepto_basico
∑∑? Q
,
∑∑Q R
CodigoBarra
∏∏0 ;
=
∏∏< =
cn
∏∏> @
.
∏∏@ A
codigo_barra
∏∏A M
,
∏∏M N
Nombre
ππ0 6
=
ππ7 8
cn
ππ9 ;
.
ππ; <
nombre
ππ< B
,
ππB C!
ValorConceptoBasico
∫∫0 C
=
∫∫D E
cn
∫∫F H
.
∫∫H I
Detalle_maestro4
∫∫I Y
.
∫∫Y Z
valor
∫∫Z _
,
∫∫_ `
}
ªª, -
)
ªª- .
.
ªª. /
FirstOrDefault
ªª/ =
(
ªª= >
)
ªª> ?
;
ªª? @
}
ºº 
catch
ΩΩ 
(
ΩΩ 
	Exception
ΩΩ 
e
ΩΩ 
)
ΩΩ 
{
ææ 
throw
øø 
new
øø 
DatosException
øø (
(
øø( )
$str
øø) f
,
øøf g
e
øøh i
)
øøi j
;
øøj k
}
¿¿ 
}
¡¡ 	
public
¬¬ )
Concepto_Negocio_Comercial_
¬¬ *J
<ObtenerConceptoDeNegocioComercialConStockPorRolesEIdConcepto
¬¬+ g
(
¬¬g h
long
¬¬h l&
idTransaccionInventario¬¬m Ñ
,¬¬Ñ Ö
int¬¬Ü â
idRol¬¬ä è
,¬¬è ê
int¬¬ë î!
idConceptoNegocio¬¬ï ¶
)¬¬¶ ß
{
√√ 	
try
ƒƒ 
{
≈≈ 
_db
∆∆ 
.
∆∆ 
Configuration
∆∆ !
.
∆∆! " 
LazyLoadingEnabled
∆∆" 4
=
∆∆5 6
false
∆∆7 <
;
∆∆< =
return
«« 
_db
«« 
.
«« "
Concepto_negocio_rol
«« /
.
»»  
Where
»»  %
(
»»% &
cnr
»»& )
=>
»»* ,
cnr
»»- 0
.
»»0 1
id_rol
»»1 7
==
»»8 :
idRol
»»; @
&&
…… !
cnr
……" %
.
……% &
Concepto_negocio
……& 6
.
……6 7
id
……7 9
==
……: <
idConceptoNegocio
……= N
&&
   !
cnr
  " %
.
  % &
Concepto_negocio
  & 6
.
  6 7

es_vigente
  7 A
)
  A B
.
ÀÀ  
Select
ÀÀ  &
(
ÀÀ& '
cnr
ÀÀ' *
=>
ÀÀ+ -
cnr
ÀÀ. 1
.
ÀÀ1 2
Concepto_negocio
ÀÀ2 B
)
ÀÀB C
.
ÃÃ  
Select
ÃÃ  &
(
ÃÃ& '
cn
ÃÃ' )
=>
ÃÃ* ,
new
ÃÃ- 0)
Concepto_Negocio_Comercial_
ÃÃ1 L
(
ÃÃL M
)
ÃÃM N
{
ÕÕ  
Id
ŒŒ# %
=
ŒŒ& '
cn
ŒŒ( *
.
ŒŒ* +
id
ŒŒ+ -
,
ŒŒ- .
	IdFamilia
œœ# ,
=
œœ- .
cn
œœ/ 1
.
œœ1 2 
id_concepto_basico
œœ2 D
,
œœD E
Nombre
––# )
=
––* +
cn
––, .
.
––. /
nombre
––/ 5
,
––5 6
CodigoBarra
——# .
=
——/ 0
cn
——1 3
.
——3 4
codigo_barra
——4 @
,
——@ A!
ValorConceptoBasico
““# 6
=
““7 8
cn
““9 ;
.
““; <
Detalle_maestro4
““< L
.
““L M
valor
““M R
,
““R S
Stock
””# (
=
””) *
cn
””+ -
.
””- .!
Detalle_transaccion
””. A
.
””A B
Where
””B G
(
””G H
dt
””H J
=>
””K M
dt
””N P
.
””P Q
id_transaccion
””Q _
==
””` b%
idTransaccionInventario
””c z
&&
””{ }
dt””~ Ä
.””Ä Å 
Concepto_negocio””Å ë
.””ë í
id””í î
==””ï ó!
idConceptoNegocio””ò ©
)””© ™
.””™ ´
FirstOrDefault””´ π
(””π ∫
)””∫ ª
.””ª º
cantidad””º ƒ
}
‘‘  
)
‘‘  !
.
‘‘! "
FirstOrDefault
‘‘" 0
(
‘‘0 1
)
‘‘1 2
;
‘‘2 3
}
’’ 
catch
÷÷ 
(
÷÷ 
	Exception
÷÷ 
e
÷÷ 
)
÷÷ 
{
◊◊ 
throw
ÿÿ 
new
ÿÿ 
DatosException
ÿÿ (
(
ÿÿ( )
$str
ÿÿ) f
,
ÿÿf g
e
ÿÿh i
)
ÿÿi j
;
ÿÿj k
}
ŸŸ 
finally
⁄⁄ 
{
€€ 
_db
‹‹ 
.
‹‹ 
Configuration
‹‹ !
.
‹‹! " 
LazyLoadingEnabled
‹‹" 4
=
‹‹5 6
true
‹‹7 ;
;
‹‹; <
}
›› 
}
ﬁﬁ 	
public
ﬂﬂ )
Concepto_Negocio_Comercial_
ﬂﬂ *K
=ObtenerConceptoDeNegocioComercialConPrecioPorRolesEIdConcepto
ﬂﬂ+ h
(
ﬂﬂh i
int
ﬂﬂi l,
idActorNegocioQueTienePreciosﬂﬂm ä
,ﬂﬂä ã
intﬂﬂå è
idRolﬂﬂê ï
,ﬂﬂï ñ
intﬂﬂó ö!
idConceptoNegocioﬂﬂõ ¨
)ﬂﬂ¨ ≠
{
‡‡ 	
try
·· 
{
‚‚ 
_db
„„ 
.
„„ 
Configuration
„„ !
.
„„! " 
LazyLoadingEnabled
„„" 4
=
„„5 6
false
„„7 <
;
„„< =
return
‰‰ 
_db
‰‰ 
.
‰‰ "
Concepto_negocio_rol
‰‰ /
.
ÂÂ  
Where
ÂÂ  %
(
ÂÂ% &
cnr
ÂÂ& )
=>
ÂÂ* ,
cnr
ÂÂ- 0
.
ÂÂ0 1
id_rol
ÂÂ1 7
==
ÂÂ8 :
idRol
ÂÂ; @
&&
ÊÊ !
cnr
ÊÊ" %
.
ÊÊ% &
Concepto_negocio
ÊÊ& 6
.
ÊÊ6 7
id
ÊÊ7 9
==
ÊÊ: <
idConceptoNegocio
ÊÊ= N
&&
ÁÁ !
cnr
ÁÁ" %
.
ÁÁ% &
Concepto_negocio
ÁÁ& 6
.
ÁÁ6 7

es_vigente
ÁÁ7 A
)
ÁÁA B
.
ËË  
Select
ËË  &
(
ËË& '
cnr
ËË' *
=>
ËË+ -
cnr
ËË. 1
.
ËË1 2
Concepto_negocio
ËË2 B
)
ËËB C
.
ÈÈ  
Select
ÈÈ  &
(
ÈÈ& '
cn
ÈÈ' )
=>
ÈÈ* ,
new
ÈÈ- 0)
Concepto_Negocio_Comercial_
ÈÈ1 L
(
ÈÈL M
)
ÈÈM N
{
ÍÍ  
Id
ÎÎ# %
=
ÎÎ& '
cn
ÎÎ( *
.
ÎÎ* +
id
ÎÎ+ -
,
ÎÎ- .
	IdFamilia
ÏÏ# ,
=
ÏÏ- .
cn
ÏÏ/ 1
.
ÏÏ1 2 
id_concepto_basico
ÏÏ2 D
,
ÏÏD E
Nombre
ÌÌ# )
=
ÌÌ* +
cn
ÌÌ, .
.
ÌÌ. /
nombre
ÌÌ/ 5
,
ÌÌ5 6
CodigoBarra
ÓÓ# .
=
ÓÓ/ 0
cn
ÓÓ1 3
.
ÓÓ3 4
codigo_barra
ÓÓ4 @
,
ÓÓ@ A!
ValorConceptoBasico
ÔÔ# 6
=
ÔÔ7 8
cn
ÔÔ9 ;
.
ÔÔ; <
Detalle_maestro4
ÔÔ< L
.
ÔÔL M
valor
ÔÔM R
,
ÔÔR S
Precios
# *
=
+ ,
cn
- /
.
/ 0
Precio1
0 7
.
7 8
Where
8 =
(
= >
p
> ?
=>
@ B
p
C D
.
D E
id_actor_negocio
E U
==
V X+
idActorNegocioQueTienePrecios
Y v
&&
w y
p
z {
.
{ |

es_vigente| Ü
)Ü á
.
ÒÒ8 9
Select
ÒÒ9 ?
(
ÒÒ? @
p
ÒÒ@ A
=>
ÒÒB D
new
ÒÒE H/
!Precio_Concepto_Negocio_Comercial
ÒÒI j
(
ÒÒj k
)
ÒÒk l
{
ÚÚ8 9
Id
ÛÛ< >
=
ÛÛ? @
p
ÛÛA B
.
ÛÛB C
id
ÛÛC E
,
ÛÛE F
IdTarifa
ÙÙ< D
=
ÙÙE F
p
ÙÙG H
.
ÙÙH I
id_tarifa_d
ÙÙI T
,
ÙÙT U
Tarifa
ıı< B
=
ııC D
p
ııE F
.
ııF G
Detalle_maestro3
ııG W
.
ııW X
nombre
ııX ^
,
ıı^ _
Valor
ˆˆ< A
=
ˆˆB C
p
ˆˆD E
.
ˆˆE F
valor
ˆˆF K
,
ˆˆK L
Codigo
˜˜< B
=
˜˜C D
p
˜˜E F
.
˜˜F G
Detalle_maestro3
˜˜G W
.
˜˜W X
codigo
˜˜X ^
}
¯¯8 9
)
¯¯9 :
,
¯¯: ;
}
˘˘  
)
˘˘  !
.
˘˘! "
FirstOrDefault
˘˘" 0
(
˘˘0 1
)
˘˘1 2
;
˘˘2 3
}
˙˙ 
catch
˚˚ 
(
˚˚ 
	Exception
˚˚ 
e
˚˚ 
)
˚˚ 
{
¸¸ 
throw
˝˝ 
new
˝˝ 
DatosException
˝˝ (
(
˝˝( )
$str
˝˝) f
,
˝˝f g
e
˝˝h i
)
˝˝i j
;
˝˝j k
}
˛˛ 
finally
ˇˇ 
{
ÄÄ 
_db
ÅÅ 
.
ÅÅ 
Configuration
ÅÅ !
.
ÅÅ! " 
LazyLoadingEnabled
ÅÅ" 4
=
ÅÅ5 6
true
ÅÅ7 ;
;
ÅÅ; <
}
ÇÇ 
}
ÉÉ 	
public
ÑÑ )
Concepto_Negocio_Comercial_
ÑÑ *P
BObtenerConceptoDeNegocioComercialConStockPrecioPorRolesEIdConcepto
ÑÑ+ m
(
ÑÑm n
long
ÑÑn r&
idTransaccionInventarioÑÑs ä
,ÑÑä ã
intÑÑå è-
idActorNegocioQueTienePreciosÑÑê ≠
,ÑÑ≠ Æ
intÑÑØ ≤
idRolÑÑ≥ ∏
,ÑÑ∏ π
intÑÑ∫ Ω!
idConceptoNegocioÑÑæ œ
)ÑÑœ –
{
ÖÖ 	
try
ÜÜ 
{
áá 
_db
àà 
.
àà 
Configuration
àà !
.
àà! " 
LazyLoadingEnabled
àà" 4
=
àà5 6
false
àà7 <
;
àà< =
return
ââ 
_db
ââ 
.
ââ "
Concepto_negocio_rol
ââ /
.
ää  
Where
ää  %
(
ää% &
cnr
ää& )
=>
ää* ,
cnr
ää- 0
.
ää0 1
id_rol
ää1 7
==
ää8 :
idRol
ää; @
&&
ãã !
cnr
ãã" %
.
ãã% &
Concepto_negocio
ãã& 6
.
ãã6 7
id
ãã7 9
==
ãã: <
idConceptoNegocio
ãã= N
&&
åå !
cnr
åå" %
.
åå% &
Concepto_negocio
åå& 6
.
åå6 7

es_vigente
åå7 A
)
ååA B
.
çç  
Select
çç  &
(
çç& '
cnr
çç' *
=>
çç+ -
cnr
çç. 1
.
çç1 2
Concepto_negocio
çç2 B
)
ççB C
.
éé  
Select
éé  &
(
éé& '
cn
éé' )
=>
éé* ,
new
éé- 0)
Concepto_Negocio_Comercial_
éé1 L
(
ééL M
)
ééM N
{
èè  
Id
êê# %
=
êê& '
cn
êê( *
.
êê* +
id
êê+ -
,
êê- .
	IdFamilia
ëë# ,
=
ëë- .
cn
ëë/ 1
.
ëë1 2 
id_concepto_basico
ëë2 D
,
ëëD E
Nombre
íí# )
=
íí* +
cn
íí, .
.
íí. /
nombre
íí/ 5
,
íí5 6
CodigoBarra
ìì# .
=
ìì/ 0
cn
ìì1 3
.
ìì3 4
codigo_barra
ìì4 @
,
ìì@ A!
ValorConceptoBasico
îî# 6
=
îî7 8
cn
îî9 ;
.
îî; <
Detalle_maestro4
îî< L
.
îîL M
valor
îîM R
,
îîR S
Stock
ïï# (
=
ïï) *
cn
ïï+ -
.
ïï- .!
Detalle_transaccion
ïï. A
.
ïïA B
Where
ïïB G
(
ïïG H
dt
ïïH J
=>
ïïK M
dt
ïïN P
.
ïïP Q
id_transaccion
ïïQ _
==
ïï` b%
idTransaccionInventario
ïïc z
&&
ïï{ }
dtïï~ Ä
.ïïÄ Å 
Concepto_negocioïïÅ ë
.ïïë í
idïïí î
==ïïï ó!
idConceptoNegocioïïò ©
)ïï© ™
.ïï™ ´
FirstOrDefaultïï´ π
(ïïπ ∫
)ïï∫ ª
.ïïª º
cantidadïïº ƒ
,ïïƒ ≈
Precios
ññ# *
=
ññ+ ,
cn
ññ- /
.
ññ/ 0
Precio1
ññ0 7
.
ññ7 8
Where
ññ8 =
(
ññ= >
p
ññ> ?
=>
ññ@ B
p
ññC D
.
ññD E
id_actor_negocio
ññE U
==
ññV X+
idActorNegocioQueTienePrecios
ññY v
&&
ññw y
p
ññz {
.
ññ{ |

es_vigenteññ| Ü
)ññÜ á
.
óó8 9
Select
óó9 ?
(
óó? @
p
óó@ A
=>
óóB D
new
óóE H/
!Precio_Concepto_Negocio_Comercial
óóI j
(
óój k
)
óók l
{
òò8 9
Id
ôô< >
=
ôô? @
p
ôôA B
.
ôôB C
id
ôôC E
,
ôôE F
IdTarifa
öö< D
=
ööE F
p
ööG H
.
ööH I
id_tarifa_d
ööI T
,
ööT U
Tarifa
õõ< B
=
õõC D
p
õõE F
.
õõF G
Detalle_maestro3
õõG W
.
õõW X
nombre
õõX ^
,
õõ^ _
Valor
úú< A
=
úúB C
p
úúD E
.
úúE F
valor
úúF K
,
úúK L
Codigo
ùù< B
=
ùùC D
p
ùùE F
.
ùùF G
Detalle_maestro3
ùùG W
.
ùùW X
codigo
ùùX ^
}
ûû8 9
)
ûû9 :
,
ûû: ;
}
üü  
)
üü  !
.
üü! "
FirstOrDefault
üü" 0
(
üü0 1
)
üü1 2
;
üü2 3
}
†† 
catch
°° 
(
°° 
	Exception
°° 
e
°° 
)
°° 
{
¢¢ 
throw
££ 
new
££ 
DatosException
££ (
(
££( )
$str
££) f
,
££f g
e
££h i
)
££i j
;
££j k
}
§§ 
finally
•• 
{
¶¶ 
_db
ßß 
.
ßß 
Configuration
ßß !
.
ßß! " 
LazyLoadingEnabled
ßß" 4
=
ßß5 6
true
ßß7 ;
;
ßß; <
}
®® 
}
©© 	
public
ıı 
IEnumerable
ıı 
<
ıı (
Concepto_Negocio_Comercial
ıı 5
>
ıı5 6M
?ObtenerConceptosDeNegociosComercialesPorNombreIncluyendoPrecios
ıı7 v
(
ııv w
int
ııw z6
'idActorNegocioInternoQueTieneLosPreciosıı{ ¢
,ıı¢ £
intıı§ ß
[ııß ®
]ıı® ©
idsRolesıı™ ≤
,ıı≤ ≥
stringıı¥ ∫
nombreııª ¡
)ıı¡ ¬
{
ˆˆ 	
try
˜˜ 
{
¯¯ 
return
˘˘ 
_db
˘˘ 
.
˘˘ "
Concepto_negocio_rol
˘˘ /
.
˙˙  
Where
˙˙  %
(
˙˙% &
cnr
˙˙& )
=>
˙˙* ,
idsRoles
˙˙- 5
.
˙˙5 6
Contains
˙˙6 >
(
˙˙> ?
cnr
˙˙? B
.
˙˙B C
id_rol
˙˙C I
)
˙˙I J
&&
˚˚- /
cnr
˚˚0 3
.
˚˚3 4
Concepto_negocio
˚˚4 D
.
˚˚D E
nombre
˚˚E K
.
˚˚K L
Contains
˚˚L T
(
˚˚T U
nombre
˚˚U [
)
˚˚[ \
&&
¸¸- /
cnr
¸¸0 3
.
¸¸3 4
Concepto_negocio
¸¸4 D
.
¸¸D E

es_vigente
¸¸E O
)
¸¸O P
.
˝˝  
Select
˝˝  &
(
˝˝& '
cnr
˝˝' *
=>
˝˝+ -
cnr
˝˝. 1
.
˝˝1 2
Concepto_negocio
˝˝2 B
)
˝˝B C
.
˛˛  
Select
˛˛  &
(
˛˛& '
cn
˛˛' )
=>
˛˛* ,
new
˛˛- 0(
Concepto_Negocio_Comercial
˛˛1 K
(
˛˛K L
)
˛˛L M
{
ˇˇ  
Id
ÄÄ# %
=
ÄÄ& '
cn
ÄÄ( *
.
ÄÄ* +
id
ÄÄ+ -
,
ÄÄ- .
Nombre
ÅÅ# )
=
ÅÅ* +
cn
ÅÅ, .
.
ÅÅ. /
nombre
ÅÅ/ 5
,
ÅÅ5 6
Codigo
ÇÇ# )
=
ÇÇ* +
cn
ÇÇ, .
.
ÇÇ. /
codigo
ÇÇ/ 5
,
ÇÇ5 6
CodigoBarra
ÉÉ# .
=
ÉÉ/ 0
cn
ÉÉ1 3
.
ÉÉ3 4
codigo_barra
ÉÉ4 @
,
ÉÉ@ A
Sufijo
ÑÑ# )
=
ÑÑ* +
cn
ÑÑ, .
.
ÑÑ. /
sufijo
ÑÑ/ 5
,
ÑÑ5 6
IdConceptoBasico
ÖÖ# 3
=
ÖÖ4 5
cn
ÖÖ6 8
.
ÖÖ8 9
Detalle_maestro4
ÖÖ9 I
.
ÖÖI J
id
ÖÖJ L
,
ÖÖL M"
NombreConceptoBasico
ÜÜ# 7
=
ÜÜ8 9
cn
ÜÜ: <
.
ÜÜ< =
Detalle_maestro4
ÜÜ= M
.
ÜÜM N
nombre
ÜÜN T
,
ÜÜT U!
ValorConceptoBasico
áá# 6
=
áá7 8
cn
áá9 ;
.
áá; <
Detalle_maestro4
áá< L
.
ááL M
valor
ááM R
,
ááR S
Precios
àà# *
=
àà+ ,
cn
àà- /
.
àà/ 0
Precio1
àà0 7
.
àà7 8
Where
àà8 =
(
àà= >
p
àà> ?
=>
àà@ B
p
ààC D
.
ààD E
id_actor_negocio
ààE U
==
ààV X6
'idActorNegocioInternoQueTieneLosPreciosààY Ä
&&ààÅ É
pààÑ Ö
.ààÖ Ü

es_vigenteààÜ ê
)ààê ë
.
ââ8 9
Select
ââ9 ?
(
ââ? @
p
ââ@ A
=>
ââB D
new
ââE H/
!Precio_Concepto_Negocio_Comercial
ââI j
(
ââj k
)
ââk l
{
ää8 9
Id
ãã< >
=
ãã? @
p
ããA B
.
ããB C
id
ããC E
,
ããE F
IdTarifa
åå< D
=
ååE F
p
ååG H
.
ååH I
id_tarifa_d
ååI T
,
ååT U
Tarifa
çç< B
=
ççC D
p
ççE F
.
ççF G
Detalle_maestro3
ççG W
.
ççW X
nombre
ççX ^
,
çç^ _
Valor
éé< A
=
ééB C
p
ééD E
.
ééE F
valor
ééF K
,
ééK L
Codigo
èè< B
=
èèC D
p
èèE F
.
èèF G
Detalle_maestro3
èèG W
.
èèW X
codigo
èèX ^
}
êê8 9
)
êê9 :
}
ëë  
)
ëë  !
;
ëë! "
}
íí 
catch
ìì 
(
ìì 
	Exception
ìì 
e
ìì 
)
ìì 
{
îî 
throw
ïï 
new
ïï 
DatosException
ïï (
(
ïï( )
$str
ïï) j
,
ïïj k
e
ïïl m
)
ïïm n
;
ïïn o
}
ññ 
}
óó 	
public
ôô 
IEnumerable
ôô 
<
ôô (
Concepto_Negocio_Comercial
ôô 5
>
ôô5 6X
IObtenerConceptosDeNegociosComercialesPorNombreInclyendoStockPreciosYStockôô7 Ä
(ôôÄ Å
intôôÅ Ñ%
idActorNegocioInternoôôÖ ö
,ôôö õ
intôôú ü!
idTipoTransaccionôô† ±
,ôô± ≤
intôô≥ ∂
idTarifaôô∑ ø
,ôôø ¿
intôô¡ ƒ
idUltimoEstadoôô≈ ”
,ôô” ‘
intôô’ ÿ
[ôôÿ Ÿ
]ôôŸ ⁄
idsRolesôô€ „
,ôô„ ‰
stringôôÂ Î
nombreôôÏ Ú
)ôôÚ Û
{
öö 	
try
õõ 
{
úú 
return
ùù 
_db
ùù 
.
ùù "
Concepto_negocio_rol
ùù /
.
ûû  
Where
ûû  %
(
ûû% &
cnr
ûû& )
=>
ûû* ,
idsRoles
ûû- 5
.
ûû5 6
Contains
ûû6 >
(
ûû> ?
cnr
ûû? B
.
ûûB C
id_rol
ûûC I
)
ûûI J
)
ûûJ K
.
üü  
Select
üü  &
(
üü& '
cnr
üü' *
=>
üü+ -
cnr
üü. 1
.
üü1 2
Concepto_negocio
üü2 B
)
üüB C
.
††  
Where
††  %
(
††% &
cn
††& (
=>
††) +
cn
††, .
.
††. /

es_vigente
††/ 9
&&
††: <
cn
††= ?
.
††? @
nombre
††@ F
.
††F G
Contains
††G O
(
††O P
nombre
††P V
)
††V W
)
††W X
.
°°  
Select
°°  &
(
°°& '
cn
°°' )
=>
°°* ,
new
°°- 0(
Concepto_Negocio_Comercial
°°1 K
(
°°K L
)
°°L M
{
¢¢  
Id
££# %
=
££& '
cn
££( *
.
££* +
id
££+ -
,
££- .
Nombre
§§# )
=
§§* +
cn
§§, .
.
§§. /
nombre
§§/ 5
,
§§5 6
Codigo
••# )
=
••* +
cn
••, .
.
••. /
codigo
••/ 5
,
••5 6
CodigoBarra
¶¶# .
=
¶¶/ 0
cn
¶¶1 3
.
¶¶3 4
codigo_barra
¶¶4 @
,
¶¶@ A
Sufijo
ßß# )
=
ßß* +
cn
ßß, .
.
ßß. /
sufijo
ßß/ 5
,
ßß5 6
IdConceptoBasico
®®# 3
=
®®4 5
cn
®®6 8
.
®®8 9
Detalle_maestro4
®®9 I
.
®®I J
id
®®J L
,
®®L M"
NombreConceptoBasico
©©# 7
=
©©8 9
cn
©©: <
.
©©< =
Detalle_maestro4
©©= M
.
©©M N
nombre
©©N T
,
©©T U!
ValorConceptoBasico
™™# 6
=
™™7 8
cn
™™9 ;
.
™™; <
Detalle_maestro4
™™< L
.
™™L M
valor
™™M R
,
™™R S$
ValoresCaracteristicas
´´# 9
=
´´: ;
cn
´´< >
.
´´> ?3
%Valor_caracteristica_concepto_negocio
´´? d
.
¨¨? @
Select
¨¨@ F
(
¨¨F G
vccn
¨¨G K
=>
¨¨L N
vccn
¨¨O S
.
¨¨S T"
Valor_caracteristica
¨¨T h
)
¨¨h i
.
≠≠? @
Select
≠≠@ F
(
≠≠F G
vc
≠≠G I
=>
≠≠J L
new
≠≠M P!
ValorCaracteristica
≠≠Q d
(
≠≠d e
)
≠≠e f
{
ÆÆ? @
Id
ØØC E
=
ØØF G
vc
ØØH J
.
ØØJ K
id
ØØK M
,
ØØM N
IdCaracteristica
∞∞C S
=
∞∞T U
vc
∞∞V X
.
∞∞X Y
id_caracteristica
∞∞Y j
,
∞∞j k"
NombreCaracteristica
±±C W
=
±±X Y
vc
±±Z \
.
±±\ ]
Detalle_maestro
±±] l
.
±±l m
nombre
±±m s
,
±±s t
Valor
≤≤C H
=
≤≤I J
vc
≤≤K M
.
≤≤M N
valor
≤≤N S
}
≥≥? @
)
≥≥@ A
.
≥≥A B
OrderBy
≥≥B I
(
≥≥I J
c
≥≥J K
=>
≥≥L N
c
≥≥O P
.
≥≥P Q
Valor
≥≥Q V
)
≥≥V W
,
≥≥W X
Precios
µµ# *
=
µµ+ ,
cn
µµ- /
.
µµ/ 0
Precio1
µµ0 7
.
µµ7 8
Where
µµ8 =
(
µµ= >
p
µµ> ?
=>
µµ@ B
p
µµC D
.
µµD E
id_actor_negocio
µµE U
==
µµV X#
idActorNegocioInterno
µµY n
&&
µµo q
p
µµr s
.
µµs t

es_vigente
µµt ~
)
µµ~ 
.
∂∂8 9
Select
∂∂9 ?
(
∂∂? @
p
∂∂@ A
=>
∂∂B D
new
∂∂E H/
!Precio_Concepto_Negocio_Comercial
∂∂I j
(
∂∂j k
)
∂∂k l
{
∑∑8 9
Id
∏∏< >
=
∏∏? @
p
∏∏A B
.
∏∏B C
id
∏∏C E
,
∏∏E F
IdTarifa
ππ< D
=
ππE F
p
ππG H
.
ππH I
id_tarifa_d
ππI T
,
ππT U
Tarifa
∫∫< B
=
∫∫C D
p
∫∫E F
.
∫∫F G
Detalle_maestro3
∫∫G W
.
∫∫W X
nombre
∫∫X ^
,
∫∫^ _
Valor
ªª< A
=
ªªB C
p
ªªD E
.
ªªE F
valor
ªªF K
,
ªªK L
Codigo
ºº< B
=
ººC D
p
ººE F
.
ººF G
Detalle_maestro3
ººG W
.
ººW X
codigo
ººX ^
}
ΩΩ8 9
)
ΩΩ9 :
,
ΩΩ: ; 
NombrePresentacion
øø# 5
=
øø6 7
cn
øø8 :
.
øø: ;
Detalle_maestro3
øø; K
.
øøK L
nombre
øøL R
,
øøR S
	Contenido
¿¿# ,
=
¿¿- .
cn
¿¿/ 1
.
¿¿1 2
	contenido
¿¿2 ;
,
¿¿; <,
CodigoUnidadMedidaPresentacion
¡¡# A
=
¡¡B C
cn
¡¡D F
.
¡¡F G
Detalle_maestro1
¡¡G W
.
¡¡W X
codigo
¡¡X ^
,
¡¡^ _&
UnidadMedidaPresentacion
¬¬# ;
=
¬¬< =
cn
¬¬> @
.
¬¬@ A
Detalle_maestro1
¬¬A Q
.
¬¬Q R
valor
¬¬R W
,
¬¬W X)
CodigoUnidadMedidaComercial
√√# >
=
√√? @
cn
√√A C
.
√√C D
Detalle_maestro
√√D S
.
√√S T
codigo
√√T Z
,
√√Z [#
UnidadMedidaComercial
ƒƒ# 8
=
ƒƒ9 :
cn
ƒƒ; =
.
ƒƒ= >
Detalle_maestro
ƒƒ> M
.
ƒƒM N
valor
ƒƒN S
,
ƒƒS T%
UnidadMedidaReferencial
≈≈# :
=
≈≈; <
cn
≈≈= ?
.
≈≈? @
Detalle_maestro2
≈≈@ P
.
≈≈P Q
valor
≈≈Q V
,
≈≈V W
Stock
∆∆# (
=
∆∆) *
cn
∆∆+ -
.
∆∆- .!
Detalle_transaccion
∆∆. A
.
∆∆A B
Where
∆∆B G
(
∆∆G H
dt
∆∆H J
=>
∆∆K M
dt
∆∆N P
.
∆∆P Q
Transaccion
∆∆Q \
.
∆∆\ ]!
id_tipo_transaccion
∆∆] p
==
∆∆q s 
idTipoTransaccion∆∆t Ö
&&∆∆Ü à
dt∆∆â ã
.∆∆ã å
Transaccion∆∆å ó
.∆∆ó ò(
id_actor_negocio_interno∆∆ò ∞
==∆∆± ≥%
idActorNegocioInterno∆∆¥ …
&&∆∆  Ã
dt∆∆Õ œ
.∆∆œ –
Transaccion∆∆– €
.∆∆€ ‹"
Estado_transaccion∆∆‹ Ó
.∆∆Ó Ô!
OrderByDescending∆∆Ô Ä
(∆∆Ä Å
est∆∆Å Ñ
=>∆∆Ö á
est∆∆à ã
.∆∆ã å
id∆∆å é
)∆∆é è
.∆∆è ê
FirstOrDefault∆∆ê û
(∆∆û ü
)∆∆ü †
.∆∆† °
	id_estado∆∆° ™
==∆∆´ ≠
idUltimoEstado∆∆Æ º
)∆∆º Ω
.∆∆Ω æ
Sum∆∆æ ¡
(∆∆¡ ¬
dt∆∆¬ ƒ
=>∆∆≈ «
dt∆∆»  
.∆∆  À
cantidad∆∆À ”
)∆∆” ‘
,∆∆‘ ’
PrecioVenta
««# .
=
««/ 0
cn
««1 3
.
««3 4
Precio1
««4 ;
.
««; <
Where
««< A
(
««A B
p
««B C
=>
««D F
p
««G H
.
««H I
id_actor_negocio
««I Y
==
««Z \#
idActorNegocioInterno
««] r
&&
««s u
p
««v w
.
««w x

es_vigente««x Ç
&&««É Ö
p««Ü á
.««á à
id_tarifa_d««à ì
==««î ñ
idTarifa««ó ü
)««ü †
.
»»L M
OrderByDescending
»»M ^
(
»»^ _
p
»»_ `
=>
»»a c
p
»»d e
.
»»e f
id
»»f h
)
»»h i
.
……L M
FirstOrDefault
……M [
(
……[ \
)
……\ ]
.
……] ^
valor
……^ c
}
    
)
    !
;
  ! "
}
ÃÃ 
catch
ÕÕ 
(
ÕÕ 
	Exception
ÕÕ 
e
ÕÕ 
)
ÕÕ 
{
ŒŒ 
throw
œœ 
new
œœ 
DatosException
œœ (
(
œœ( )
$str
œœ) j
,
œœj k
e
œœl m
)
œœm n
;
œœn o
}
–– 
}
—— 	
public
◊◊ 
IEnumerable
◊◊ 
<
◊◊ 
Concepto_Basico
◊◊ *
>
◊◊* +@
2ObtenerConceptosBasicosIncluyendodoCaracteristicas
◊◊, ^
(
◊◊^ _
int
◊◊_ b
	idMaestro
◊◊c l
,
◊◊l m
bool
◊◊n r
	esVigente
◊◊s |
)
◊◊| }
{
ÿÿ 	
try
ŸŸ 
{
⁄⁄ 
return
€€ 
_db
€€ 
.
€€ 
Detalle_maestro
€€ *
.
€€* +
Where
€€+ 0
(
€€0 1
dm
€€1 3
=>
€€4 6
dm
€€7 9
.
€€9 :

id_maestro
€€: D
==
€€E G
	idMaestro
€€H Q
&&
€€R T
dm
€€U W
.
€€W X

es_vigente
€€X b
==
€€c e
	esVigente
€€f o
)
€€o p
.
€€p q
Select
€€q w
(
€€w x
dm
€€x z
=>
€€{ }
new€€~ Å
Concepto_Basico€€Ç ë
(€€ë í
)€€í ì
{
‹‹ 
Id
›› 
=
›› 
dm
›› 
.
›› 
id
›› 
,
›› 
Nombre
ﬁﬁ 
=
ﬁﬁ 
dm
ﬁﬁ 
.
ﬁﬁ  
nombre
ﬁﬁ  &
,
ﬁﬁ& '
Valor
ﬂﬂ 
=
ﬂﬂ 
dm
ﬂﬂ 
.
ﬂﬂ 
valor
ﬂﬂ $
,
ﬂﬂ$ %
Caracteristicas
‡‡ #
=
‡‡$ %
dm
‡‡& (
.
‡‡( )%
Caracteristica_concepto
‡‡) @
.
‡‡@ A
Select
‡‡A G
(
‡‡G H
cc
‡‡H J
=>
‡‡K M
cc
‡‡N P
.
‡‡P Q
Detalle_maestro1
‡‡Q a
)
‡‡a b
.
‡‡b c
Select
‡‡c i
(
‡‡i j
c
‡‡j k
=>
‡‡l n
new
‡‡o r
Caracteristica‡‡s Å
(‡‡Å Ç
)‡‡Ç É
{
·· 
IdDetalleMaestro
‚‚ (
=
‚‚) *
c
‚‚+ ,
.
‚‚, -
id
‚‚- /
,
‚‚/ 0
Nombre
„„ 
=
„„  
c
„„! "
.
„„" #
nombre
„„# )
,
„„) *
Valor
‰‰ 
=
‰‰ 
c
‰‰  !
.
‰‰! "
valor
‰‰" '
,
‰‰' (
	IdMaestro
ÂÂ !
=
ÂÂ" #
c
ÂÂ$ %
.
ÂÂ% &

id_maestro
ÂÂ& 0
}
ÊÊ 
)
ÊÊ 
}
ÁÁ 
)
ÁÁ 
;
ÁÁ 
}
ËË 
catch
ÈÈ 
(
ÈÈ 
	Exception
ÈÈ 
e
ÈÈ 
)
ÈÈ 
{
ÍÍ 
throw
ÎÎ 
new
ÎÎ 
DatosException
ÎÎ (
(
ÎÎ( )
$str
ÎÎ) a
)
ÎÎa b
;
ÎÎb c
}
ÏÏ 
}
ÌÌ 	
public
ÛÛ 
OperationResult
ÛÛ &
ActualizarCaracteristica
ÛÛ 7
(
ÛÛ7 8
Detalle_maestro
ÛÛ8 G 
caracteristica_upd
ÛÛH Z
)
ÛÛZ [
{
ÙÙ 	
try
ıı 
{
ˆˆ 
Detalle_maestro
˜˜ 
caracteristica_bd
˜˜  1
=
˜˜2 3
_db
˜˜4 7
.
˜˜7 8
Detalle_maestro
˜˜8 G
.
˜˜G H
Single
˜˜H N
(
˜˜N O
dm
˜˜O Q
=>
˜˜R T
dm
˜˜U W
.
˜˜W X
id
˜˜X Z
==
˜˜[ ] 
caracteristica_upd
˜˜^ p
.
˜˜p q
id
˜˜q s
)
˜˜s t
;
˜˜t u 
caracteristica_upd
¯¯ "
.
¯¯" #
fecha_registro
¯¯# 1
=
¯¯2 3
caracteristica_bd
¯¯4 E
.
¯¯E F
fecha_registro
¯¯F T
;
¯¯T U
_db
˘˘ 
.
˘˘ 
Entry
˘˘ 
(
˘˘ 
caracteristica_bd
˘˘ +
)
˘˘+ ,
.
˘˘, -
CurrentValues
˘˘- :
.
˘˘: ;
	SetValues
˘˘; D
(
˘˘D E 
caracteristica_upd
˘˘E W
)
˘˘W X
;
˘˘X Y
List
˚˚ 
<
˚˚ "
Valor_caracteristica
˚˚ )
>
˚˚) *
valores_upd
˚˚+ 6
=
˚˚7 8 
caracteristica_upd
˚˚9 K
.
˚˚K L"
Valor_caracteristica
˚˚L `
.
˚˚` a
ToList
˚˚a g
(
˚˚g h
)
˚˚h i
;
˚˚i j
List
¸¸ 
<
¸¸ "
Valor_caracteristica
¸¸ )
>
¸¸) *

valores_bd
¸¸+ 5
=
¸¸6 7
caracteristica_bd
¸¸8 I
.
¸¸I J"
Valor_caracteristica
¸¸J ^
.
¸¸^ _
ToList
¸¸_ e
(
¸¸e f
)
¸¸f g
;
¸¸g h
foreach
˛˛ 
(
˛˛ 
var
˛˛ 
valor_db
˛˛ %
in
˛˛& (

valores_bd
˛˛) 3
)
˛˛3 4
{
ˇˇ 
if
ÅÅ 
(
ÅÅ 
valores_upd
ÅÅ #
.
ÅÅ# $
Any
ÅÅ$ '
(
ÅÅ' (
d
ÅÅ( )
=>
ÅÅ* ,
d
ÅÅ- .
.
ÅÅ. /
id
ÅÅ/ 1
==
ÅÅ2 4
valor_db
ÅÅ5 =
.
ÅÅ= >
id
ÅÅ> @
)
ÅÅ@ A
)
ÅÅA B
{
ÇÇ 
var
ÉÉ 
valor
ÉÉ !
=
ÉÉ" #
valores_upd
ÉÉ$ /
.
ÉÉ/ 0
Single
ÉÉ0 6
(
ÉÉ6 7
d
ÉÉ7 8
=>
ÉÉ9 ;
d
ÉÉ< =
.
ÉÉ= >
id
ÉÉ> @
==
ÉÉA C
valor_db
ÉÉD L
.
ÉÉL M
id
ÉÉM O
)
ÉÉO P
;
ÉÉP Q
_db
ÑÑ 
.
ÑÑ 
Entry
ÑÑ !
(
ÑÑ! "
valor_db
ÑÑ" *
)
ÑÑ* +
.
ÑÑ+ ,
CurrentValues
ÑÑ, 9
.
ÑÑ9 :
	SetValues
ÑÑ: C
(
ÑÑC D
valor
ÑÑD I
)
ÑÑI J
;
ÑÑJ K
}
ÖÖ 
else
ÜÜ 
{
áá 
_db
àà 
.
àà "
Valor_caracteristica
àà 0
.
àà0 1
Remove
àà1 7
(
àà7 8
valor_db
àà8 @
)
àà@ A
;
ààA B
}
ââ 
}
ää 
foreach
åå 
(
åå 
var
åå 
	valor_upd
åå &
in
åå' )
valores_upd
åå* 5
)
åå5 6
{
çç 
if
éé 
(
éé 
!
éé 

valores_bd
éé #
.
éé# $
Any
éé$ '
(
éé' (
d
éé( )
=>
éé* ,
d
éé- .
.
éé. /
id
éé/ 1
==
éé2 4
	valor_upd
éé5 >
.
éé> ?
id
éé? A
)
ééA B
)
ééB C
{
èè 
_db
êê 
.
êê "
Valor_caracteristica
êê 0
.
êê0 1
Add
êê1 4
(
êê4 5
	valor_upd
êê5 >
)
êê> ?
;
êê? @
}
ëë 
}
íí 
var
ìì 
	resultado
ìì 
=
ìì 
Save
ìì  $
(
ìì$ %
)
ìì% &
;
ìì& '
	resultado
îî 
.
îî 
data
îî 
=
îî   
caracteristica_upd
îî! 3
.
îî3 4
id
îî4 6
;
îî6 7
return
ïï 
	resultado
ïï  
;
ïï  !
}
ññ 
catch
óó 
(
óó 
	Exception
óó 
e
óó 
)
óó 
{
òò 
throw
ôô 
e
ôô 
;
ôô 
}
öö 
}
õõ 	
public
ùù 
IEnumerable
ùù 
<
ùù 
Concepto_negocio
ùù +
>
ùù+ ,7
)ConceptosNegocioVigentesConCaracteristica
ùù- V
(
ùùV W
int
ùùW Z
idCaracteristica
ùù[ k
)
ùùk l
{
ûû 	
try
üü 
{
†† 
return
°° 
_db
°° 
.
°° %
Caracteristica_concepto
°° 2
.
°°2 3
Where
°°3 8
(
°°8 9
cc
°°9 ;
=>
°°< >
cc
°°? A
.
°°A B
id_caracteristica
°°B S
==
°°T V
idCaracteristica
°°W g
)
°°g h
.
°°h i
Select
°°i o
(
°°o p
cc
°°p r
=>
°°s u
cc
°°v x
.
°°x y
Detalle_maestro°°y à
)°°à â
.°°â ä

SelectMany°°ä î
(°°î ï
dm°°ï ó
=>°°ò ö
dm°°õ ù
.°°ù û!
Concepto_negocio4°°û Ø
)°°Ø ∞
.°°∞ ±
Where°°± ∂
(°°∂ ∑
cn°°∑ π
=>°°∫ º
cn°°Ω ø
.°°ø ¿

es_vigente°°¿  
)°°  À
;°°À Ã
}
¢¢ 
catch
££ 
(
££ 
	Exception
££ 
e
££ 
)
££ 
{
§§ 
throw
•• 
e
•• 
;
•• 
}
¶¶ 
}
ßß 	
public
©© 
IEnumerable
©© 
<
©© 
Detalle_maestro
©© *
>
©©* +/
!FamiliasVigentesConCaracteristica
©©, M
(
©©M N
int
©©N Q
idCaracteristica
©©R b
)
©©b c
{
™™ 	
try
´´ 
{
¨¨ 
return
≠≠ 
_db
≠≠ 
.
≠≠ %
Caracteristica_concepto
≠≠ 2
.
≠≠2 3
Where
≠≠3 8
(
≠≠8 9
cc
≠≠9 ;
=>
≠≠< >
cc
≠≠? A
.
≠≠A B
id_caracteristica
≠≠B S
==
≠≠T V
idCaracteristica
≠≠W g
)
≠≠g h
.
≠≠h i
Select
≠≠i o
(
≠≠o p
cc
≠≠p r
=>
≠≠s u
cc
≠≠v x
.
≠≠x y
Detalle_maestro≠≠y à
)≠≠à â
.≠≠â ä
Where≠≠ä è
(≠≠è ê
dm≠≠ê í
=>≠≠ì ï
dm≠≠ñ ò
.≠≠ò ô

es_vigente≠≠ô £
)≠≠£ §
;≠≠§ •
}
ÆÆ 
catch
ØØ 
(
ØØ 
	Exception
ØØ 
e
ØØ 
)
ØØ 
{
∞∞ 
throw
±± 
e
±± 
;
±± 
}
≤≤ 
}
≥≥ 	
public
ªª 
OperationResult
ªª (
GuardarValorCaracteristica
ªª 9
(
ªª9 :"
Valor_caracteristica
ªª: N!
valorCaracteristica
ªªO b
)
ªªb c
{
ºº 	
try
ΩΩ 
{
ææ 
_db
øø 
.
øø "
Valor_caracteristica
øø (
.
øø( )
Add
øø) ,
(
øø, -!
valorCaracteristica
øø- @
)
øø@ A
;
øøA B
var
¿¿ 
	resultado
¿¿ 
=
¿¿ 
Save
¿¿  $
(
¿¿$ %
)
¿¿% &
;
¿¿& '
	resultado
¡¡ 
.
¡¡ 
data
¡¡ 
=
¡¡  !
valorCaracteristica
¡¡! 4
.
¡¡4 5
id
¡¡5 7
;
¡¡7 8
return
¬¬ 
	resultado
¬¬  
;
¬¬  !
}
√√ 
catch
ƒƒ 
(
ƒƒ 
	Exception
ƒƒ 
e
ƒƒ 
)
ƒƒ 
{
≈≈ 
throw
∆∆ 
e
∆∆ 
;
∆∆ 
}
«« 
}
»» 	
public
   
OperationResult
   +
ActualizarValorCaracteristica
   <
(
  < ="
Valor_caracteristica
  = Q%
valorCaracteristica_upd
  R i
)
  i j
{
ÀÀ 	
try
ÃÃ 
{
ÕÕ "
Valor_caracteristica
ŒŒ $$
valorCaracteristica_bd
ŒŒ% ;
=
ŒŒ< =
_db
ŒŒ> A
.
ŒŒA B"
Valor_caracteristica
ŒŒB V
.
ŒŒV W
Single
ŒŒW ]
(
ŒŒ] ^
vc
ŒŒ^ `
=>
ŒŒa c
vc
ŒŒd f
.
ŒŒf g
id
ŒŒg i
==
ŒŒj l&
valorCaracteristica_updŒŒm Ñ
.ŒŒÑ Ö
idŒŒÖ á
)ŒŒá à
;ŒŒà â
_db
œœ 
.
œœ 
Entry
œœ 
(
œœ $
valorCaracteristica_bd
œœ 0
)
œœ0 1
.
œœ1 2
CurrentValues
œœ2 ?
.
œœ? @
	SetValues
œœ@ I
(
œœI J%
valorCaracteristica_upd
œœJ a
)
œœa b
;
œœb c
var
–– 
	resultado
–– 
=
–– 
Save
––  $
(
––$ %
)
––% &
;
––& '
	resultado
—— 
.
—— 
data
—— 
=
——  %
valorCaracteristica_upd
——! 8
.
——8 9
id
——9 ;
;
——; <
return
““ 
	resultado
““  
;
““  !
}
”” 
catch
‘‘ 
(
‘‘ 
	Exception
‘‘ 
e
‘‘ 
)
‘‘ 
{
’’ 
throw
÷÷ 
e
÷÷ 
;
÷÷ 
}
◊◊ 
}
ÿÿ 	
public
⁄⁄ 
IEnumerable
⁄⁄ 
<
⁄⁄ "
Valor_caracteristica
⁄⁄ /
>
⁄⁄/ 0,
ObtenerValoresDeCaracteristica
⁄⁄1 O
(
⁄⁄O P
int
⁄⁄P S
idCaracteristica
⁄⁄T d
)
⁄⁄d e
{
€€ 	
try
‹‹ 
{
›› 
return
ﬁﬁ 
_db
ﬁﬁ 
.
ﬁﬁ "
Valor_caracteristica
ﬁﬁ /
.
ﬁﬁ/ 0
Where
ﬁﬁ0 5
(
ﬁﬁ5 6
vc
ﬁﬁ6 8
=>
ﬁﬁ9 ;
vc
ﬁﬁ< >
.
ﬁﬁ> ?
id_caracteristica
ﬁﬁ? P
==
ﬁﬁQ S
idCaracteristica
ﬁﬁT d
)
ﬁﬁd e
;
ﬁﬁe f
}
ﬂﬂ 
catch
‡‡ 
(
‡‡ 
	Exception
‡‡ 
e
‡‡ 
)
‡‡ 
{
·· 
throw
‚‚ 
e
‚‚ 
;
‚‚ 
}
„„ 
}
‰‰ 	
public
ÊÊ "
Valor_caracteristica
ÊÊ #(
ObtenerValorCaracteristica
ÊÊ$ >
(
ÊÊ> ?
int
ÊÊ? B#
idValorCaracteristica
ÊÊC X
)
ÊÊX Y
{
ÁÁ 	
try
ËË 
{
ÈÈ 
return
ÍÍ 
_db
ÍÍ 
.
ÍÍ "
Valor_caracteristica
ÍÍ /
.
ÍÍ/ 0
SingleOrDefault
ÍÍ0 ?
(
ÍÍ? @
vc
ÍÍ@ B
=>
ÍÍC E
vc
ÍÍF H
.
ÍÍH I
id
ÍÍI K
==
ÍÍL N#
idValorCaracteristica
ÍÍO d
)
ÍÍd e
;
ÍÍe f
}
ÎÎ 
catch
ÏÏ 
(
ÏÏ 
	Exception
ÏÏ 
e
ÏÏ 
)
ÏÏ 
{
ÌÌ 
throw
ÓÓ 
new
ÓÓ 
DatosException
ÓÓ (
(
ÓÓ( )
$str
ÓÓ) R
,
ÓÓR S
e
ÓÓT U
)
ÓÓU V
;
ÓÓV W
}
ÔÔ 
}
 	
public
˜˜ 
IEnumerable
˜˜ 
<
˜˜ 
Rol
˜˜ 
>
˜˜ @
2ObtenerRolesDeConceptosExceptoMercaderiaYServicios
˜˜  R
(
˜˜R S
int
˜˜S V
aplicaA
˜˜W ^
,
˜˜^ _
int
˜˜` c
[
˜˜c d
]
˜˜d e
idsAExcluir
˜˜f q
)
˜˜q r
{
¯¯ 	
try
˘˘ 
{
˙˙ 
return
˚˚ 
_db
˚˚ 
.
˚˚ 
Rol
˚˚ 
.
˚˚ 
Where
˚˚ $
(
˚˚$ %
r
˚˚% &
=>
˚˚' )
r
˚˚* +
.
˚˚+ ,
aplica_a
˚˚, 4
==
˚˚5 7
aplicaA
˚˚8 ?
&&
˚˚@ B
!
˚˚C D
idsAExcluir
˚˚D O
.
˚˚O P
Contains
˚˚P X
(
˚˚X Y
r
˚˚Y Z
.
˚˚Z [
id
˚˚[ ]
)
˚˚] ^
)
˚˚^ _
;
˚˚_ `
}
¸¸ 
catch
˝˝ 
(
˝˝ 
	Exception
˝˝ 
e
˝˝ 
)
˝˝ 
{
˛˛ 
throw
ˇˇ 
e
ˇˇ 
;
ˇˇ 
}
ÄÄ 
}
ÅÅ 	
public
ÉÉ 
IEnumerable
ÉÉ 
<
ÉÉ 

Existencia
ÉÉ %
>
ÉÉ% &F
8ObtenerExistenciasIncluyendoConceptoNegocioYActorNegocio
ÉÉ' _
(
ÉÉ_ `
int
ÉÉ` c
idEntidadInterna
ÉÉd t
)
ÉÉt u
{
ÑÑ 	
try
ÖÖ 
{
ÜÜ 
return
áá 
_db
áá 
.
áá 

Existencia
áá %
.
àà 
Include
àà 
(
àà 
e
àà 
=>
àà !
e
àà" #
.
àà# $
Concepto_negocio
àà$ 4
)
àà4 5
.
àà5 6
Include
àà6 =
(
àà= >
e
àà> ?
=>
àà@ B
e
ààC D
.
ààD E
Concepto_negocio
ààE U
.
ààU V
Detalle_maestro
ààV e
)
ààe f
.
ââ 
Include
ââ 
(
ââ 
e
ââ 
=>
ââ !
e
ââ" #
.
ââ# $
Actor_negocio
ââ$ 1
)
ââ1 2
.
ää 
Where
ää 
(
ää 
e
ää 
=>
ää 
e
ää  !
.
ää! "
id_punto_atencion
ää" 3
==
ää4 6
idEntidadInterna
ää7 G
)
ääG H
;
ääH I
}
ãã 
catch
åå 
(
åå 
	Exception
åå 
e
åå 
)
åå 
{
çç 
throw
éé 
e
éé 
;
éé 
}
èè 
}
êê 	
public
íí 
IEnumerable
íí 
<
íí 
Detalle_maestro
íí *
>
íí* +;
-ObtenerDetalleMaestro4DeConceptoNegocioConRol
íí, Y
(
ííY Z
int
ííZ ]
idRol
íí^ c
)
ííc d
{
ìì 	
try
îî 
{
ïï 
return
ññ 
_db
ññ 
.
ññ "
Concepto_negocio_rol
ññ /
.
ññ/ 0
Where
ññ0 5
(
ññ5 6
cnr
ññ6 9
=>
ññ: <
cnr
ññ= @
.
ññ@ A
id_rol
ññA G
==
ññH J
idRol
ññK P
)
ññP Q
.
ññQ R
Select
ññR X
(
ññX Y
cnr
ññY \
=>
ññ] _
cnr
ññ` c
.
ññc d
Concepto_negocio
ññd t
.
ññt u
Detalle_maestro4ññu Ö
)ññÖ Ü
;ññÜ á
}
óó 
catch
òò 
(
òò 
	Exception
òò 
e
òò 
)
òò 
{
ôô 
throw
öö 
e
öö 
;
öö 
}
õõ 
}
úú 	
public
ûû 
IEnumerable
ûû 
<
ûû *
Precio_Compra_Venta_Concepto
ûû 7
>
ûû7 88
*ObtenerPreciosCompraVentaDeConceptoNegocio
ûû9 c
(
ûûc d
int
ûûd g
idConceptoNegocio
ûûh y
)
ûûy z
{
üü 	
try
†† 
{
°° 
IEnumerable
¢¢ 
<
¢¢ *
Precio_Compra_Venta_Concepto
¢¢ 8
>
¢¢8 9
precios
¢¢: A
=
¢¢B C
new
¢¢D G
List
¢¢H L
<
¢¢L M*
Precio_Compra_Venta_Concepto
¢¢M i
>
¢¢i j
(
¢¢j k
)
¢¢k l
;
¢¢l m
var
§§ 
transaccionCompra
§§ %
=
§§& '
_db
§§( +
.
§§+ ,!
Detalle_transaccion
§§, ?
.
§§? @
OrderByDescending
§§@ Q
(
§§Q R
dt
§§R T
=>
§§U W
dt
§§X Z
.
§§Z [
id
§§[ ]
)
§§] ^
.
§§^ _
FirstOrDefault
§§_ m
(
§§m n
dt
§§n p
=>
§§q s
dt
§§t v
.
§§v w"
id_concepto_negocio§§w ä
==§§ã ç!
idConceptoNegocio§§é ü
&&§§† ¢
dt§§£ •
.§§• ¶
Transaccion§§¶ ±
.§§± ≤#
id_tipo_transaccion§§≤ ≈
==§§∆ »#
TransaccionSettings§§… ‹
.§§‹ ›
Default§§› ‰
.§§‰ Â.
IdTipoTransaccionOrdenDeCompra§§Â É
&&§§Ñ Ü
dt§§á â
.§§â ä
Transaccion§§ä ï
.§§ï ñ 
id_estado_actual§§ñ ¶
==§§ß ©
MaestroSettings§§™ π
.§§π ∫
Default§§∫ ¡
.§§¡ ¬0
 IdDetalleMaestroEstadoConfirmado§§¬ ‚
)§§‚ „
;§§„ ‰
decimal
•• 
precioCompra
•• $
=
••% &
transaccionCompra
••' 8
!=
••9 ;
null
••< @
?
••A B
transaccionCompra
••C T
.
••T U
precio_unitario
••U d
:
••e f
$num
••g h
;
••h i
var
ßß 
concepto
ßß 
=
ßß 
_db
ßß "
.
ßß" #
Concepto_negocio
ßß# 3
.
ßß3 4
SingleOrDefault
ßß4 C
(
ßßC D
cn
ßßD F
=>
ßßG I
cn
ßßJ L
.
ßßL M
id
ßßM O
==
ßßP R
idConceptoNegocio
ßßS d
)
ßßd e
;
ßße f
if
©© 
(
©© 
concepto
©© 
!=
©© 
null
©©  $
)
©©$ %
{
™™ 
precios
´´ 
=
´´ 
concepto
´´ &
.
´´& '
Precio1
´´' .
.
´´. /
Where
´´/ 4
(
´´4 5
p
´´5 6
=>
´´7 9
p
´´: ;
.
´´; <

es_vigente
´´< F
)
´´F G
.
¨¨ 
Select
¨¨ 
(
¨¨ 
p
¨¨ 
=>
¨¨ 
new
¨¨  #*
Precio_Compra_Venta_Concepto
¨¨$ @
(
¨¨@ A
)
¨¨A B
{
≠≠ 
IdPrecio
ÆÆ 
=
ÆÆ  !
p
ÆÆ" #
.
ÆÆ# $
id
ÆÆ$ &
,
ÆÆ& '
IdPuntoPrecio
ØØ $
=
ØØ% &
p
ØØ' (
.
ØØ( )
id_actor_negocio
ØØ) 9
,
ØØ9 :
PuntoPrecio
∞∞ "
=
∞∞# $
p
∞∞% &
.
∞∞& '
Actor_negocio
∞∞' 4
.
∞∞4 5
PrimerNombre
∞∞5 A
,
∞∞A B
IdTarifa
±± 
=
±±  !
p
±±" #
.
±±# $
id_tarifa_d
±±$ /
,
±±/ 0
Tarifa
≤≤ 
=
≤≤ 
p
≤≤  !
.
≤≤! "
Detalle_maestro3
≤≤" 2
.
≤≤2 3
nombre
≤≤3 9
,
≤≤9 :
PrecioCompra
≥≥ #
=
≥≥$ %
precioCompra
≥≥& 2
,
≥≥2 3
PrecioVenta
¥¥ "
=
¥¥# $
p
¥¥% &
.
¥¥& '
valor
¥¥' ,
,
¥¥, -
FechaInicio
µµ "
=
µµ# $
p
µµ% &
.
µµ& '
fecha_inicio
µµ' 3
,
µµ3 4
FechaFin
∂∂ 
=
∂∂  !
p
∂∂" #
.
∂∂# $
	fecha_fin
∂∂$ -
,
∂∂- .
Descripcion
∑∑ "
=
∑∑# $
p
∑∑% &
.
∑∑& '
descripcion
∑∑' 2
}
∏∏ 
)
ππ 
;
ππ 
}
∫∫ 
return
ªª 
precios
ªª 
;
ªª 
}
ºº 
catch
ΩΩ 
(
ΩΩ 
	Exception
ΩΩ 
e
ΩΩ 
)
ΩΩ 
{
ææ 
throw
øø 
e
øø 
;
øø 
}
¿¿ 
}
¡¡ 	
public
√√ 
decimal
√√ +
ObtenerPrecioPublicoDelIcbper
√√ 4
(
√√4 5
DateTime
√√5 =
fecha
√√> C
)
√√C D
{
ƒƒ 	
try
≈≈ 
{
∆∆ 
decimal
«« $
precioPublicoDelIcbper
«« .
=
««/ 0
_db
««1 4
.
««4 5
Concepto_negocio
««5 E
.
««E F
FirstOrDefault
««F T
(
««T U
cn
««U W
=>
««X Z
cn
««[ ]
.
««] ^
id
««^ `
==
««a c
ConceptoSettings
««d t
.
««t u
Default
««u |
.
««| }&
IdConceptoNegocioIcbper««} î
)««î ï
.««ï ñ
Precio1««ñ ù
.««ù û
FirstOrDefault««û ¨
(««¨ ≠
p««≠ Æ
=>««Ø ±
p««≤ ≥
.««≥ ¥
id_tarifa_d««¥ ø
==««¿ ¬
MaestroSettings««√ “
.««“ ”
Default««” ⁄
.««⁄ €,
IdDetalleMaestroTarifaNormal««€ ˜
&&««¯ ˙
p««˚ ¸
.««¸ ˝
fecha_inicio««˝ â
<=««ä å
fecha««ç í
&&««ì ï
fecha««ñ õ
<=««ú û
p««ü †
.««† °
	fecha_fin««° ™
)««™ ´
.««´ ¨
valor««¨ ±
;««± ≤
return
»» $
precioPublicoDelIcbper
»» -
;
»»- .
}
…… 
catch
   
(
   
	Exception
   
e
   
)
   
{
ÀÀ 
throw
ÃÃ 
new
ÃÃ 
DatosException
ÃÃ (
(
ÃÃ( )
$str
ÃÃ) c
,
ÃÃc d
e
ÃÃe f
)
ÃÃf g
;
ÃÃg h
}
ÕÕ 
}
ŒŒ 	
public
““ 
int
““ 4
&ObtenerMaximoCodigoParaConceptoNegocio
““ 9
(
““9 :
string
““: @
prefijo
““A H
,
““H I
int
““J M
idRolConcepto
““N [
,
““[ \
int
““] `
idConceptoBasico
““a q
)
““q r
{
”” 	
int
‘‘ 
longitud
‘‘ 
=
‘‘ 
prefijo
‘‘ "
.
‘‘" #
Length
‘‘# )
;
‘‘) *
try
’’ 
{
÷÷ 
var
◊◊ 
ultimoCodigo
◊◊  
=
◊◊! "
_db
◊◊# &
.
◊◊& '
Concepto_negocio
◊◊' 7
.
◊◊7 8
Where
ÿÿ 
(
ÿÿ 
t
ÿÿ 
=>
ÿÿ 
t
ÿÿ  
.
ÿÿ  !"
Concepto_negocio_rol
ÿÿ! 5
.
ÿÿ5 6
Any
ÿÿ6 9
(
ÿÿ9 :
cnr
ÿÿ: =
=>
ÿÿ> @
cnr
ÿÿA D
.
ÿÿD E
id_rol
ÿÿE K
==
ÿÿL N
idRolConcepto
ÿÿO \
)
ÿÿ\ ]
&&
ÿÿ^ `
t
ÿÿa b
.
ÿÿb c 
id_concepto_basico
ÿÿc u
==
ÿÿv x
idConceptoBasicoÿÿy â
&&ÿÿä å
tÿÿç é
.ÿÿé è
codigoÿÿè ï
.ÿÿï ñ

StartsWithÿÿñ †
(ÿÿ† °
prefijoÿÿ° ®
)ÿÿ® ©
)ÿÿ© ™
.ÿÿ™ ´!
OrderByDescendingÿÿ´ º
(ÿÿº Ω
cÿÿΩ æ
=>ÿÿø ¡
cÿÿ¬ √
.ÿÿ√ ƒ
idÿÿƒ ∆
)ÿÿ∆ «
.ÿÿ« »
FirstOrDefaultÿÿ» ÷
(ÿÿ÷ ◊
)ÿÿ◊ ÿ
;ÿÿÿ Ÿ
return
ŸŸ 
ultimoCodigo
ŸŸ #
!=
ŸŸ$ &
null
ŸŸ' +
?
ŸŸ, -
Convert
ŸŸ. 5
.
ŸŸ5 6
ToInt32
ŸŸ6 =
(
ŸŸ= >
ultimoCodigo
ŸŸ> J
.
ŸŸJ K
codigo
ŸŸK Q
.
ŸŸQ R
Remove
ŸŸR X
(
ŸŸX Y
$num
ŸŸY Z
,
ŸŸZ [
longitud
ŸŸ\ d
)
ŸŸd e
)
ŸŸe f
:
ŸŸg h
$num
ŸŸi j
;
ŸŸj k
}
⁄⁄ 
catch
€€ 
(
€€ 
	Exception
€€ 
e
€€ 
)
€€ 
{
‹‹ 
throw
›› 
e
›› 
;
›› 
}
ﬁﬁ 
}
‡‡ 	
public
ËË 
bool
ËË 0
"ExisteCodigoDeBarraConceptoNegocio
ËË 6
(
ËË6 7
string
ËË7 =
codigoBarra
ËË> I
)
ËËI J
{
ÈÈ 	
try
ÍÍ 
{
ÎÎ 
bool
ÏÏ 
existe
ÏÏ 
=
ÏÏ 
_db
ÏÏ !
.
ÏÏ! "
Concepto_negocio
ÏÏ" 2
.
ÏÏ2 3
Where
ÏÏ3 8
(
ÏÏ8 9
cn
ÏÏ9 ;
=>
ÏÏ< >
cn
ÏÏ? A
.
ÏÏA B
codigo_barra
ÏÏB N
==
ÏÏO Q
codigoBarra
ÏÏR ]
&&
ÌÌ8 :
cn
ÌÌ; =
.
ÌÌ= >
codigo_barra
ÌÌ> J
!=
ÌÌK M
$str
ÌÌN P
&&
ÓÓ8 :
cn
ÓÓ; =
.
ÓÓ= >

es_vigente
ÓÓ> H
)
ÓÓH I
.
ÓÓI J
Any
ÓÓJ M
(
ÓÓM N
)
ÓÓN O
;
ÓÓO P
return
ÔÔ 
existe
ÔÔ 
;
ÔÔ 
}
 
catch
ÒÒ 
(
ÒÒ 
	Exception
ÒÒ 
e
ÒÒ 
)
ÒÒ 
{
ÚÚ 
throw
ÛÛ 
new
ÛÛ 
DatosException
ÛÛ (
(
ÛÛ( )
$str
ÛÛ) [
,
ÛÛ[ \
e
ÛÛ] ^
)
ÛÛ^ _
;
ÛÛ_ `
}
ÙÙ 
}
ıı 	
public
˜˜ 
bool
˜˜ )
ExisteNombreConceptoNegocio
˜˜ /
(
˜˜/ 0
string
˜˜0 6
nombre
˜˜7 =
)
˜˜= >
{
¯¯ 	
try
˘˘ 
{
˙˙ 
bool
˚˚ 
existe
˚˚ 
=
˚˚ 
_db
˚˚ !
.
˚˚! "
Concepto_negocio
˚˚" 2
.
˚˚2 3
Where
˚˚3 8
(
˚˚8 9
cn
˚˚9 ;
=>
˚˚< >
cn
˚˚? A
.
˚˚A B
nombre
˚˚B H
==
˚˚I K
nombre
˚˚L R
&&
˚˚S U
cn
˚˚V X
.
˚˚X Y

es_vigente
˚˚Y c
)
˚˚c d
.
˚˚d e
Any
˚˚e h
(
˚˚h i
)
˚˚i j
;
˚˚j k
return
˝˝ 
existe
˝˝ 
;
˝˝ 
}
˛˛ 
catch
ˇˇ 
(
ˇˇ 
	Exception
ˇˇ 
e
ˇˇ 
)
ˇˇ 
{
ÄÄ 
throw
ÅÅ 
new
ÅÅ 
DatosException
ÅÅ (
(
ÅÅ( )
$str
ÅÅ) e
,
ÅÅe f
e
ÅÅg h
)
ÅÅh i
;
ÅÅi j
}
ÇÇ 
}
ÑÑ 	
public
ÜÜ 
bool
ÜÜ %
TieneConceptosDeNegocio
ÜÜ +
(
ÜÜ+ ,
int
ÜÜ, /
idDetalleMaestro
ÜÜ0 @
,
ÜÜ@ A
bool
ÜÜB F
	esVigente
ÜÜG P
)
ÜÜP Q
{
áá 	
try
àà 
{
ââ 
bool
ää 
existe
ää 
=
ää 
_db
ää !
.
ää! "
Detalle_maestro
ää" 1
.
ää1 2
Where
ää2 7
(
ää7 8
dm
ää8 :
=>
ää; =
dm
ää> @
.
ää@ A
id
ääA C
==
ääD F
idDetalleMaestro
ääG W
)
ääW X
.
ääX Y

SelectMany
ääY c
(
ääc d
dm
ääd f
=>
ääg i
dm
ääj l
.
ääl m
Concepto_negocio4
ääm ~
)
ää~ 
.ää Ä
WhereääÄ Ö
(ääÖ Ü
cnääÜ à
=>ääâ ã
cnääå é
.ääé è

es_vigenteääè ô
==ääö ú
	esVigenteääù ¶
)ää¶ ß
.ääß ®
Anyää® ´
(ää´ ¨
)ää¨ ≠
;ää≠ Æ
return
åå 
existe
åå 
;
åå 
}
çç 
catch
éé 
(
éé 
	Exception
éé 
e
éé 
)
éé 
{
èè 
throw
êê 
new
êê 
DatosException
êê (
(
êê( )
$str
êê) d
,
êêd e
e
êêf g
)
êêg h
;
êêh i
}
ëë 
}
ìì 	
public
ññ 
bool
ññ /
!ExisteNombreDeValorCaracteristica
ññ 5
(
ññ5 6
int
ññ6 9
idCaracteristica
ññ: J
,
ññJ K
string
ññL R
valor
ññS X
)
ññX Y
{
óó 	
try
òò 
{
ôô 
bool
öö 
existe
öö 
=
öö 
_db
öö !
.
öö! ""
Valor_caracteristica
öö" 6
.
öö6 7
Where
öö7 <
(
öö< =
vc
öö= ?
=>
öö@ B
vc
ööC E
.
ööE F
id_caracteristica
ööF W
==
ööX Z
idCaracteristica
öö[ k
&&
ööl n
vc
ööo q
.
ööq r
valor
öör w
==
ööx z
valoröö{ Ä
)ööÄ Å
.ööÅ Ç
AnyööÇ Ö
(ööÖ Ü
)ööÜ á
;ööá à
return
úú 
existe
úú 
;
úú 
}
ùù 
catch
ûû 
(
ûû 
	Exception
ûû 
e
ûû 
)
ûû 
{
üü 
throw
†† 
new
†† 
DatosException
†† (
(
††( )
$str
††) i
,
††i j
e
††k l
)
††l m
;
††m n
}
°° 
}
¢¢ 	
public
§§ 
bool
§§ 
EsBien
§§ 
(
§§ 
string
§§ !
codigoBarra
§§" -
)
§§- .
{
•• 	
try
¶¶ 
{
ßß 
Concepto_negocio
©©  
concepto
©©! )
=
©©* +
_db
©©, /
.
©©/ 0
Concepto_negocio
©©0 @
.
©©@ A
SingleOrDefault
©©A P
(
©©P Q
cn
©©Q S
=>
©©T V
cn
©©W Y
.
©©Y Z
codigo_barra
©©Z f
==
©©g i
codigoBarra
©©j u
&&
©©v x
cn
©©y {
.
©©{ |

es_vigente©©| Ü
)©©Ü á
;©©á à
if
™™ 
(
™™ 
concepto
™™ 
==
™™ 
null
™™  $
)
™™$ %
{
´´ 
throw
¨¨ 
new
¨¨ "
AdvertenciaException
¨¨ 2
(
¨¨2 3
$str
¨¨3 Y
)
¨¨Y Z
;
¨¨Z [
}
≠≠ 
bool
ÆÆ 
esBien
ÆÆ 
=
ÆÆ 
concepto
ÆÆ &
.
ÆÆ& '
Detalle_maestro4
ÆÆ' 7
.
ÆÆ7 8
valor
ÆÆ8 =
==
ÆÆ> @
$str
ÆÆA D
;
ÆÆD E
return
ØØ 
esBien
ØØ 
;
ØØ 
}
∞∞ 
catch
±± 
(
±± "
AdvertenciaException
±± '
e
±±( )
)
±±) *
{
≤≤ 
throw
≥≥ 
new
≥≥ "
AdvertenciaException
≥≥ .
(
≥≥. /
e
≥≥/ 0
.
≥≥0 1
Message
≥≥1 8
)
≥≥8 9
;
≥≥9 :
}
¥¥ 
catch
µµ 
(
µµ 
	Exception
µµ 
e
µµ 
)
µµ 
{
∂∂ 
throw
∑∑ 
new
∑∑ 
DatosException
∑∑ (
(
∑∑( )
$str
∑∑) W
,
∑∑W X
e
∑∑Y Z
)
∑∑Z [
;
∑∑[ \
}
∏∏ 
}
ππ 	
public
∫∫ 
bool
∫∫ 
EsBien
∫∫ 
(
∫∫ 
int
∫∫ 
id
∫∫ !
)
∫∫! "
{
ªª 	
try
ºº 
{
ΩΩ 
Concepto_negocio
ææ  
concepto
ææ! )
=
ææ* +
_db
ææ, /
.
ææ/ 0
Concepto_negocio
ææ0 @
.
ææ@ A
SingleOrDefault
ææA P
(
ææP Q
cn
ææQ S
=>
ææT V
cn
ææW Y
.
ææY Z
id
ææZ \
==
ææ] _
id
ææ` b
)
ææb c
;
ææc d
if
øø 
(
øø 
concepto
øø 
==
øø 
null
øø  $
)
øø$ %
{
¿¿ 
throw
¡¡ 
new
¡¡ "
AdvertenciaException
¡¡ 2
(
¡¡2 3
$str
¡¡3 ^
)
¡¡^ _
;
¡¡_ `
}
¬¬ 
bool
√√ 
esBien
√√ 
=
√√ 
concepto
√√ &
.
√√& '
Detalle_maestro4
√√' 7
.
√√7 8
valor
√√8 =
==
√√> @
$str
√√A D
;
√√D E
return
ƒƒ 
esBien
ƒƒ 
;
ƒƒ 
}
≈≈ 
catch
∆∆ 
(
∆∆ "
AdvertenciaException
∆∆ '
e
∆∆( )
)
∆∆) *
{
«« 
throw
»» 
new
»» "
AdvertenciaException
»» .
(
»». /
e
»»/ 0
.
»»0 1
Message
»»1 8
)
»»8 9
;
»»9 :
}
…… 
catch
   
(
   
	Exception
   
e
   
)
   
{
ÀÀ 
throw
ÃÃ 
new
ÃÃ 
DatosException
ÃÃ (
(
ÃÃ( )
$str
ÃÃ) W
,
ÃÃW X
e
ÃÃY Z
)
ÃÃZ [
;
ÃÃ[ \
}
ÕÕ 
}
ŒŒ 	
public
—— 
IEnumerable
—— 
<
—— 
ReporteDigemid
—— )
>
——) *,
ObtenerReporteConceptosDigemid
——+ I
(
——I J
int
——J M
idRol
——N S
,
——S T
int
——U X6
'idActorNegocioInternoQueTieneLosPrecios——Y Ä
,——Ä Å
int——Ç Ö'
idTarifaUnitariaDigemid——Ü ù
)——ù û
{
““ 	
try
”” 
{
‘‘ 
var
’’ "
idsFamiliasNoValidas
’’ (
=
’’) *
Diccionario
’’+ 6
.
’’6 7"
IdsFamilasANoMostrar
’’7 K
;
’’K L
var
÷÷ 
	resultado
÷÷ 
=
÷÷ 
_db
÷÷  #
.
÷÷# $"
Concepto_negocio_rol
÷÷$ 8
.
◊◊  
Where
◊◊  %
(
◊◊% &
cnr
◊◊& )
=>
◊◊* ,
cnr
◊◊- 0
.
◊◊0 1
id_rol
◊◊1 7
==
◊◊8 :
idRol
◊◊; @
&&
◊◊A C
cnr
◊◊D G
.
◊◊G H
Concepto_negocio
◊◊H X
.
◊◊X Y

es_vigente
◊◊Y c
)
◊◊c d
.
ÿÿ  
Select
ÿÿ  &
(
ÿÿ& '
cnr
ÿÿ' *
=>
ÿÿ+ -
cnr
ÿÿ. 1
.
ÿÿ1 2
Concepto_negocio
ÿÿ2 B
)
ÿÿB C
.
ÿÿC D
Where
ÿÿD I
(
ÿÿI J
cn
ÿÿJ L
=>
ÿÿM O
!
ÿÿP Q"
idsFamiliasNoValidas
ÿÿQ e
.
ÿÿe f
Contains
ÿÿf n
(
ÿÿn o
cn
ÿÿo q
.
ÿÿq r!
id_concepto_basicoÿÿr Ñ
)ÿÿÑ Ö
&&ÿÿÜ à
cnÿÿâ ã
.ÿÿã å
codigo_negocio1ÿÿå õ
!=ÿÿú û
$strÿÿü °
)ÿÿ° ¢
.
ŸŸ  
Select
ŸŸ  &
(
ŸŸ& '
cn
ŸŸ' )
=>
ŸŸ* ,
new
ŸŸ- 0
ReporteDigemid
ŸŸ1 ?
(
ŸŸ? @
)
ŸŸ@ A
{
⁄⁄  
CodigoConcepto
€€# 1
=
€€2 3
cn
€€4 6
.
€€6 7
codigo_negocio1
€€7 F
,
€€F G
PrecioUnitario
‹‹# 1
=
‹‹2 3
cn
‹‹4 6
.
‹‹6 7
Precio1
‹‹7 >
.
‹‹> ?
FirstOrDefault
‹‹? M
(
‹‹M N
p
‹‹N O
=>
‹‹P R
p
‹‹S T
.
‹‹T U
id_actor_negocio
‹‹U e
==
‹‹f h6
'idActorNegocioInternoQueTieneLosPrecios‹‹i ê
&&‹‹ë ì
p‹‹î ï
.‹‹ï ñ

es_vigente‹‹ñ †
&&‹‹° £
p‹‹§ •
.‹‹• ¶
id_tarifa_d‹‹¶ ±
==‹‹≤ ¥'
idTarifaUnitariaDigemid‹‹µ Ã
)‹‹Ã Õ
==‹‹Œ –
null‹‹— ’
?‹‹÷ ◊
$num‹‹ÿ Ÿ
:‹‹⁄ €
cn‹‹‹ ﬁ
.‹‹ﬁ ﬂ
Precio1‹‹ﬂ Ê
.‹‹Ê Á
FirstOrDefault‹‹Á ı
(‹‹ı ˆ
p‹‹ˆ ˜
=>‹‹¯ ˙
p‹‹˚ ¸
.‹‹¸ ˝ 
id_actor_negocio‹‹˝ ç
==‹‹é ê7
'idActorNegocioInternoQueTieneLosPrecios‹‹ë ∏
&&‹‹π ª
p‹‹º Ω
.‹‹Ω æ

es_vigente‹‹æ »
&&‹‹… À
p‹‹Ã Õ
.‹‹Õ Œ
id_tarifa_d‹‹Œ Ÿ
==‹‹⁄ ‹'
idTarifaUnitariaDigemid‹‹› Ù
)‹‹Ù ı
.‹‹ı ˆ
valor‹‹ˆ ˚
}
››  
)
››  !
.
››! "
ToList
››" (
(
››( )
)
››) *
;
››* +
return
ﬁﬁ 
	resultado
ﬁﬁ  
.
ﬁﬁ  !
Where
ﬁﬁ! &
(
ﬁﬁ& '
r
ﬁﬁ' (
=>
ﬁﬁ) +
r
ﬁﬁ, -
.
ﬁﬁ- .
PrecioUnitario
ﬁﬁ. <
>
ﬁﬁ= >
$num
ﬁﬁ? @
)
ﬁﬁ@ A
;
ﬁﬁA B
}
ﬂﬂ 
catch
‡‡ 
(
‡‡ 
	Exception
‡‡ 
e
‡‡ 
)
‡‡ 
{
·· 
throw
‚‚ 
new
‚‚ 
DatosException
‚‚ (
(
‚‚( )
$str
‚‚) [
,
‚‚[ \
e
‚‚] ^
)
‚‚^ _
;
‚‚_ `
}
„„ 
}
‰‰ 	
}
ÂÂ 
}ÊÊ Ï£
ND:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\Roles\Roles_Datos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
." #
Roles# (
{ 
public 

partial 
class 
Roles_Datos $
:$ %
IRoles_Repositorio& 8
{ 
public 
OperationResult +
actualizarAccionesPorRolYEstado >
(> ?
List? C
<C D
Accion_por_rolD R
>R S
updRolAccionesT b
,b c
Listd h
<h i
Accion_por_estadoi z
>z {
updEstadoAcciones	| ç
,
ç é
int
è í
idTipoTransaccion
ì §
,
§ •
int
¶ ©
idRol
™ Ø
,
Ø ∞
int
± ¥
idEstadoActual
µ √
)
√ ƒ
{ 	
try 
{ 
SigescomEntities  
_db! $
=% &
new' *
SigescomEntities+ ;
(; <
)< =
;= >
List 
< 
Accion_por_rol #
># $
dbRolAcciones% 2
=3 40
$obtenerAccionesPorTipoTrasaccionYRol5 Y
(Y Z
idTipoTransaccionZ k
,k l
idRolm r
)r s
.s t
ToListt z
(z {
){ |
;| }
List 
< 
Accion_por_estado &
>& '
dbEstadoAcciones( 8
=9 :9
-obtenerAccionesPorTipoTrasaccionYEstadoActual; h
(h i
idTipoTransaccioni z
,z {
idEstadoActual	| ä
)
ä ã
.
ã å
ToList
å í
(
í ì
)
ì î
;
î ï
OperationResult 
result  &
=' (
new) ,
OperationResult- <
(< =
)= >
;> ?
if 
( 
updRolAcciones "
!=# %
null& *
&&+ -
idRol. 3
!=4 6
$num7 8
)8 9
{ 
foreach   
(   
var    
updRolAccion  ! -
in  . 0
updRolAcciones  1 ?
)  ? @
{!! 
try"" 
{## 
Accion_por_rol$$ *
rolAccionViejo$$+ 9
=$$: ;
dbRolAcciones$$< I
.$$I J
SingleOrDefault$$J Y
($$Y Z
ra$$Z \
=>$$] _
ra$$` b
.$$b c
id_unidad_negocio$$c t
==$$u w
updRolAccion	$$x Ñ
.
$$Ñ Ö
id_unidad_negocio
$$Ö ñ
&&
$$ó ô
ra
$$ö ú
.
$$ú ù
id_accion_posible
$$ù Æ
==
$$Ø ±
updRolAccion
$$≤ æ
.
$$æ ø
id_accion_posible
$$ø –
)
$$– —
;
$$— “
if&& 
(&&  
rolAccionViejo&&  .
==&&/ 1
null&&2 6
)&&6 7
{'' 
_db))  #
.))# $
Accion_por_rol))$ 2
.))2 3
Add))3 6
())6 7
updRolAccion))7 C
)))C D
;))D E
}** 
}++ 
catch,, 
(,, 
	Exception,, (
e,,) *
),,* +
{-- 
result.. "
..." #
	setResult..# ,
(.., -
OperationResultEnum..- @
...@ A
Error..A F
)..F G
;..G H
result// "
.//" #

exceptions//# -
.//- .
Add//. 1
(//1 2
e//2 3
)//3 4
;//4 5
break00 !
;00! "
}11 
}22 
foreach55 
(55 
var55  
dbRolAccion55! ,
in55- /
dbRolAcciones550 =
)55= >
{66 
if77 
(77 
!77 
updRolAcciones77 +
.77+ ,
Any77, /
(77/ 0
ra770 2
=>773 5
ra776 8
.778 9
id_accion_posible779 J
==77K M
dbRolAccion77N Y
.77Y Z
id_accion_posible77Z k
&&77l n
ra77o q
.77q r
id_unidad_negocio	77r É
==
77Ñ Ü
dbRolAccion
77á í
.
77í ì
id_unidad_negocio
77ì §
)
77§ •
)
77• ¶
{88 
_db99 
.99  
Accion_por_rol99  .
.99. /
Remove99/ 5
(995 6
dbRolAccion996 A
)99A B
;99B C
}:: 
};; 
}<< 
if== 
(== 
updEstadoAcciones== %
!===& (
null==) -
&&==. 0
idEstadoActual==1 ?
!===@ B
$num==C D
)==D E
{>> 
foreach@@ 
(@@ 
var@@  
updEstadoAccion@@! 0
in@@1 3
updEstadoAcciones@@4 E
)@@E F
{AA 
tryBB 
{CC 
Accion_por_estadoDD -
estadoAccionViejoDD. ?
=DD@ A
dbEstadoAccionesDDB R
.DDR S
SingleOrDefaultDDS b
(DDb c
eaDDc e
=>DDf h
eaDDi k
.DDk l
id_accion_posibleDDl }
==	DD~ Ä
updEstadoAccion
DDÅ ê
.
DDê ë
id_accion_posible
DDë ¢
)
DD¢ £
;
DD£ §
ifFF 
(FF  
estadoAccionViejoFF  1
==FF2 4
nullFF5 9
)FF9 :
{GG 
_dbII  #
.II# $
Accion_por_estadoII$ 5
.II5 6
AddII6 9
(II9 :
updEstadoAccionII: I
)III J
;IIJ K
}JJ 
}KK 
catchLL 
(LL 
	ExceptionLL (
eLL) *
)LL* +
{MM 
resultNN "
.NN" #
	setResultNN# ,
(NN, -
OperationResultEnumNN- @
.NN@ A
ErrorNNA F
)NNF G
;NNG H
resultOO "
.OO" #

exceptionsOO# -
.OO- .
AddOO. 1
(OO1 2
eOO2 3
)OO3 4
;OO4 5
breakPP !
;PP! "
}QQ 
}RR 
foreachUU 
(UU 
varUU  
dbEstadoAccionUU! /
inUU0 2
dbEstadoAccionesUU3 C
)UUC D
{VV 
ifWW 
(WW 
!WW 
updEstadoAccionesWW .
.WW. /
AnyWW/ 2
(WW2 3
raWW3 5
=>WW6 8
raWW9 ;
.WW; <
id_accion_posibleWW< M
==WWN P
dbEstadoAccionWWQ _
.WW_ `
id_accion_posibleWW` q
)WWq r
)WWr s
{XX 
_dbYY 
.YY  
Accion_por_estadoYY  1
.YY1 2
RemoveYY2 8
(YY8 9
dbEstadoAccionYY9 G
)YYG H
;YYH I
}ZZ 
}[[ 
}\\ 
_db]] 
.]] 
SaveChanges]] 
(]]  
)]]  !
;]]! "
var^^ 
resultadoGuardar^^ $
=^^% &
new^^' *
OperationResult^^+ :
(^^: ;
OperationResultEnum^^; N
.^^N O
Success^^O V
)^^V W
;^^W X
return`` 
resultadoGuardar`` '
.``' (
code_result``( 3
==``4 6
OperationResultEnum``7 J
.``J K
Success``K R
?``S T
result``U [
:``\ ]
resultadoGuardar``^ n
;``n o
}aa 
catchbb 
(bb 
	Exceptionbb 
ebb 
)bb 
{cc 
throwdd 
edd 
;dd 
}ee 
}ff 	
publichh 
IEnumerablehh 
<hh 
Accion_por_rolhh )
>hh) *0
$obtenerAccionesPorTipoTrasaccionYRolhh+ O
(hhO P
inthhP S
idTipoTransaccionhhT e
,hhe f
inthhg j
idRolhhk p
)hhp q
{ii 	
tryjj 
{kk 
SigescomEntitiesll  
_dbll! $
=ll% &
newll' *
SigescomEntitiesll+ ;
(ll; <
)ll< =
;ll= >
returnmm 
_dbmm 
.mm 
Accion_por_rolmm )
.mm) *
Wheremm* /
(mm/ 0
aprmm0 3
=>mm4 6
aprmm7 :
.mm: ;
id_tipo_transaccionmm; N
==mmO Q
idTipoTransaccionmmR c
&&mmd f
aprmmg j
.mmj k
id_rolmmk q
==mmr t
idRolmmu z
)mmz {
;mm{ |
}nn 
catchoo 
(oo 
	Exceptionoo 
eoo 
)oo 
{pp 
throwqq 
eqq 
;qq 
}rr 
}ss 	
publictt 
IEnumerablett 
<tt 
Accion_por_estadott ,
>tt, -9
-obtenerAccionesPorTipoTrasaccionYEstadoActualtt. [
(tt[ \
inttt\ _
idTipoTransacciontt` q
,ttq r
inttts v
idEstadoOperacion	ttw à
)
ttà â
{uu 	
tryvv 
{ww 
SigescomEntitiesxx  
_dbxx! $
=xx% &
newxx' *
SigescomEntitiesxx+ ;
(xx; <
)xx< =
;xx= >
returnyy 
_dbyy 
.yy 
Accion_por_estadoyy ,
.yy, -
Whereyy- 2
(yy2 3
apeyy3 6
=>yy7 9
apeyy: =
.yy= >
id_tipo_transaccionyy> Q
==yyR T
idTipoTransaccionyyU f
&&yyg i
apeyyj m
.yym n
id_estado_actualyyn ~
==	yy Å
idEstadoOperacion
yyÇ ì
)
yyì î
;
yyî ï
}zz 
catch{{ 
({{ 
	Exception{{ 
e{{ 
){{ 
{|| 
throw}} 
e}} 
;}} 
}~~ 
} 	
public
ÄÄ 
IEnumerable
ÄÄ 
<
ÄÄ 
Tipo_transaccion
ÄÄ +
>
ÄÄ+ ,)
ObtenerTiposDeTransacciones
ÄÄ- H
(
ÄÄH I
)
ÄÄI J
{
ÅÅ 	
try
ÇÇ 
{
ÉÉ 
SigescomEntities
ÑÑ  
_db
ÑÑ! $
=
ÑÑ% &
new
ÑÑ' *
SigescomEntities
ÑÑ+ ;
(
ÑÑ; <
)
ÑÑ< =
;
ÑÑ= >
return
ÖÖ 
_db
ÖÖ 
.
ÖÖ 
Tipo_transaccion
ÖÖ +
;
ÖÖ+ ,
}
ÜÜ 
catch
áá 
(
áá 
	Exception
áá 
e
áá 
)
áá 
{
àà 
throw
ââ 
e
ââ 
;
ââ 
}
ää 
}
ãã 	
public
ññ 
int
ññ E
7ContarInterseccionRolesAccion_RolesVigentesActorNegocio
ññ J
(
ññJ K
int
ññK N
idActorNegocio
ññO ]
,
ññ] ^
int
ññ_ b

idRolPadre
ññc m
,
ññm n
int
ñño r
idAccionPosibleññs Ç
,ññÇ É
intññÑ á!
idTipoTransaccionññà ô
,ññô ö
intññõ û
idUnidadNegocioññü Æ
)ññÆ Ø
{
óó 	
SigescomEntities
òò 
_db
òò  
=
òò! "
new
òò# &
SigescomEntities
òò' 7
(
òò7 8
)
òò8 9
;
òò9 :
try
öö 
{
õõ 
_db
úú 
.
úú 
Configuration
úú !
.
úú! " 
LazyLoadingEnabled
úú" 4
=
úú5 6
false
úú7 <
;
úú< =
var
ùù 
rolesAccion
ùù 
=
ùù  !
_db
ùù" %
.
ùù% &
Accion_por_rol
ùù& 4
.
ùù4 5
Where
ùù5 :
(
ùù: ;
apr
ùù; >
=>
ùù? A
apr
ùùB E
.
ùùE F
id_accion_posible
ùùF W
==
ùùX Z
idAccionPosible
ùù[ j
&&
ùùk m
apr
ùùn q
.
ùùq r"
id_tipo_transaccionùùr Ö
==ùùÜ à!
idTipoTransaccionùùâ ö
&&ùùõ ù
aprùùû °
.ùù° ¢!
id_unidad_negocioùù¢ ≥
==ùù¥ ∂
idUnidadNegocioùù∑ ∆
)ùù∆ «
.ùù« »
Selectùù» Œ
(ùùŒ œ
aprùùœ “
=>ùù” ’
aprùù÷ Ÿ
.ùùŸ ⁄
id_rolùù⁄ ‡
)ùù‡ ·
.ùù· ‚
ToArrayùù‚ È
(ùùÈ Í
)ùùÍ Î
;ùùÎ Ï
int
üü 
idActor
üü 
=
üü 
_db
üü !
.
üü! "
Actor_negocio
üü" /
.
üü/ 0
First
üü0 5
(
üü5 6
an
üü6 8
=>
üü9 ;
an
üü< >
.
üü> ?
id
üü? A
==
üüB D
idActorNegocio
üüE S
)
üüS T
.
üüT U
id_actor
üüU ]
;
üü] ^
var
££ '
rolesVigentesActorNegocio
££ -
=
££. /
_db
££0 3
.
££3 4
Actor_negocio
££4 A
.
££A B
Where
££B G
(
££G H
an
££H J
=>
££K M
an
££N P
.
££P Q
id_actor
££Q Y
==
££Z \
idActor
££] d
&&
££e g
an
££h j
.
££j k

es_vigente
££k u
==
££v x
true
££y }
)
££} ~
.
££~ 
Select££ Ö
(££Ö Ü
an££Ü à
=>££â ã
an££å é
.££é è
id_rol££è ï
)££ï ñ
.££ñ ó
ToArray££ó û
(££û ü
)££ü †
;££† °
return
•• 
rolesAccion
•• "
.
••" #
	Intersect
••# ,
(
••, -'
rolesVigentesActorNegocio
••- F
)
••F G
.
••G H
Count
••H M
(
••M N
)
••N O
;
••O P
}
¶¶ 
catch
ßß 
(
ßß 
	Exception
ßß 
)
ßß 
{
®® 
throw
™™ 
;
™™ 
}
´´ 
finally
¨¨ 
{
≠≠ 
_db
ÆÆ 
.
ÆÆ 
Configuration
ÆÆ !
.
ÆÆ! " 
LazyLoadingEnabled
ÆÆ" 4
=
ÆÆ5 6
true
ÆÆ7 ;
;
ÆÆ; <
}
ØØ 
}
±± 	
public
≥≥ 
bool
≥≥ )
ActorNegocioTieneRolVigente
≥≥ /
(
≥≥/ 0
int
≥≥0 3
idActorNegocio
≥≥4 B
,
≥≥B C
int
≥≥D G
idRol
≥≥H M
)
≥≥M N
{
¥¥ 	
SigescomEntities
µµ 
_db
µµ  
=
µµ! "
new
µµ# &
SigescomEntities
µµ' 7
(
µµ7 8
)
µµ8 9
;
µµ9 :
try
∂∂ 
{
∑∑ 
_db
∏∏ 
.
∏∏ 
Configuration
∏∏ !
.
∏∏! " 
LazyLoadingEnabled
∏∏" 4
=
∏∏5 6
false
∏∏7 <
;
∏∏< =
int
∫∫ 
idActor
∫∫ 
=
∫∫ 
_db
∫∫ !
.
∫∫! "
Actor_negocio
∫∫" /
.
∫∫/ 0
First
∫∫0 5
(
∫∫5 6
an
∫∫6 8
=>
∫∫9 ;
an
∫∫< >
.
∫∫> ?
id
∫∫? A
==
∫∫B D
idActorNegocio
∫∫E S
)
∫∫S T
.
∫∫T U
id_actor
∫∫U ]
;
∫∫] ^
var
ºº '
contadorRolesActorNegocio
ºº -
=
ºº. /
_db
ºº0 3
.
ºº3 4
Actor_negocio
ºº4 A
.
ººA B
Where
ººB G
(
ººG H
an
ººH J
=>
ººK M
an
ººN P
.
ººP Q
id_actor
ººQ Y
==
ººZ \
idActor
ºº] d
&&
ººe g
an
ººh j
.
ººj k

es_vigente
ººk u
==
ººv x
true
ººy }
)
ºº} ~
.
ºº~ 
Countºº Ñ
(ººÑ Ö
anººÖ á
=>ººà ä
anººã ç
.ººç é
id_rolººé î
==ººï ó
idRolººò ù
)ººù û
;ººû ü
return
ΩΩ '
contadorRolesActorNegocio
ΩΩ 0
>
ΩΩ1 2
$num
ΩΩ3 4
;
ΩΩ4 5
}
ææ 
catch
øø 
(
øø 
	Exception
øø 
)
øø 
{
¿¿ 
throw
¡¡ 
new
¡¡ 
DatosException
¡¡ (
(
¡¡( )
$str
¡¡) i
)
¡¡i j
;
¡¡j k
}
¬¬ 
finally
√√ 
{
ƒƒ 
_db
≈≈ 
.
≈≈ 
Configuration
≈≈ !
.
≈≈! " 
LazyLoadingEnabled
≈≈" 4
=
≈≈5 6
true
≈≈7 ;
;
≈≈; <
}
∆∆ 
}
«« 	
public
…… 
List
…… 
<
…… 
Rol
…… 
>
…… 
ObtenerRoles
…… %
(
……% &
int
……& )
[
……) *
]
……* +
idsRoles
……, 4
)
……4 5
{
   	
SigescomEntities
ÀÀ 
_db
ÀÀ  
=
ÀÀ! "
new
ÀÀ# &
SigescomEntities
ÀÀ' 7
(
ÀÀ7 8
)
ÀÀ8 9
;
ÀÀ9 :
return
ÃÃ 
_db
ÃÃ 
.
ÃÃ 
Rol
ÃÃ 
.
ÃÃ 
Where
ÃÃ  
(
ÃÃ  !
r
ÃÃ! "
=>
ÃÃ# %
idsRoles
ÃÃ& .
.
ÃÃ. /
Contains
ÃÃ/ 7
(
ÃÃ7 8
r
ÃÃ8 9
.
ÃÃ9 :
id
ÃÃ: <
)
ÃÃ< =
)
ÃÃ= >
.
ÃÃ> ?
ToList
ÃÃ? E
(
ÃÃE F
)
ÃÃF G
;
ÃÃG H
}
ÕÕ 	
public
ŒŒ 
IEnumerable
ŒŒ 
<
ŒŒ 
RolDeNegocio_
ŒŒ (
>
ŒŒ( )
ObtenerRoles
ŒŒ* 6
(
ŒŒ6 7
int
ŒŒ7 :
idActor
ŒŒ; B
,
ŒŒB C
int
ŒŒD G

idRolPadre
ŒŒH R
)
ŒŒR S
{
œœ 	
SigescomEntities
–– 
_db
––  
=
––! "
new
––# &
SigescomEntities
––' 7
(
––7 8
)
––8 9
;
––9 :
return
—— 
_db
—— 
.
—— 
Actor_negocio
—— $
.
——$ %
Where
——% *
(
——* +
an
——+ -
=>
——. 0
an
——1 3
.
——3 4
id_actor
——4 <
==
——= ?
idActor
——@ G
&&
——H J
an
——K M
.
——M N

es_vigente
——N X
&&
——Y [
an
——\ ^
.
——^ _
Rol
——_ b
.
——b c
id_rol_padre
——c o
==
——p r

idRolPadre
——s }
)
——} ~
.
——~ 
Select—— Ö
(——Ö Ü
ann——Ü â
=>——ä å
new——ç ê
RolDeNegocio_——ë û
{——ü †
Id——° £
=——§ •
ann——¶ ©
.——© ™
Rol——™ ≠
.——≠ Æ
id——Æ ∞
,——∞ ±
Nombre——≤ ∏
=——π ∫
ann——ª æ
.——æ ø
Rol——ø ¬
.——¬ √
nombre——√ …
,——…  
AplicaA——À “
=——” ‘
(——’ ÷
int——÷ Ÿ
)——Ÿ ⁄
ann——⁄ ›
.——› ﬁ
Rol——ﬁ ·
.——· ‚
aplica_a——‚ Í
}——Î Ï
)——Ï Ì
;——Ì Ó
}
““ 	
public
”” 
Rol
”” 

obtenerRol
”” 
(
”” 
int
”” !
idRol
””" '
)
””' (
{
‘‘ 	
SigescomEntities
÷÷ 
_db
÷÷  
=
÷÷! "
new
÷÷# &
SigescomEntities
÷÷' 7
(
÷÷7 8
)
÷÷8 9
;
÷÷9 :
return
◊◊ 
_db
◊◊ 
.
◊◊ 
Rol
◊◊ 
.
◊◊ 
Single
◊◊ !
(
◊◊! "
r
◊◊" #
=>
◊◊$ &
r
◊◊' (
.
◊◊( )
id
◊◊) +
==
◊◊, .
idRol
◊◊/ 4
)
◊◊4 5
;
◊◊5 6
}
ÿÿ 	
public
⁄⁄ 
IEnumerable
⁄⁄ 
<
⁄⁄ 
Rol
⁄⁄ 
>
⁄⁄ 
ObtenerRolesHijos
⁄⁄  1
(
⁄⁄1 2
int
⁄⁄2 5

idRolPadre
⁄⁄6 @
)
⁄⁄@ A
{
€€ 	
try
‹‹ 
{
›› 
SigescomEntities
ﬁﬁ 
_db
ﬁﬁ  
=
ﬁﬁ! "
new
ﬁﬁ# &
SigescomEntities
ﬁﬁ' 7
(
ﬁﬁ7 8
)
ﬁﬁ8 9
;
ﬁﬁ9 :
return
ﬂﬂ 
_db
ﬂﬂ 
.
ﬂﬂ 
Rol
ﬂﬂ 
.
ﬂﬂ 
Where
ﬂﬂ $
(
ﬂﬂ$ %
r
ﬂﬂ% &
=>
ﬂﬂ' )
r
ﬂﬂ* +
.
ﬂﬂ+ ,
id_rol_padre
ﬂﬂ, 8
==
ﬂﬂ9 ;

idRolPadre
ﬂﬂ< F
)
ﬂﬂF G
;
ﬂﬂG H
}
‡‡ 
catch
·· 
(
·· 
	Exception
·· 
e
·· 
)
·· 
{
‚‚ 
throw
„„ 
e
„„ 
;
„„ 
}
‰‰ 
}
ÂÂ 	
}
ÁÁ 
}ËË ¢
UD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\CodigosTransaccion_Datos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
." #
Roles# (
{ 
public 

partial 
class $
CodigosTransaccion_Datos 1
:2 3+
ICodigosTransaccion_Repositorio4 S
{ 
public 
int .
"ObtenerMaximoCodigoParaTransaccion 5
(5 6
string6 <
prefijo= D
,D E
intF I
idTipoTransaccionJ [
)[ \
{ 	
SigescomEntities 
_db  
=! "
new# &
SigescomEntities' 7
(7 8
)8 9
;9 :
int 
longitud 
= 
prefijo "
." #
Length# )
;) *
try 
{ 
var 
ultimoCodigo  
=! "
_db# &
.& '
Transaccion' 2
.2 3
Where 
( 
t 
=> 
t  
.  !
id_tipo_transaccion! 4
==5 7
idTipoTransaccion8 I
&&J L
tM N
.N O
codigoO U
.U V

StartsWithV `
(` a
prefijoa h
)h i
)i j
.j k
OrderByDescendingk |
(| }
c} ~
=>	 Å
c
Ç É
.
É Ñ
id
Ñ Ü
)
Ü á
.
á à
FirstOrDefault
à ñ
(
ñ ó
)
ó ò
;
ò ô
return 
ultimoCodigo #
!=$ &
null' +
?, -
Convert. 5
.5 6
ToInt326 =
(= >
ultimoCodigo> J
.J K
codigoK Q
.Q R
RemoveR X
(X Y
$numY Z
,Z [
longitud\ d
)d e
)e f
:g h
$numi j
;j k
} 
catch   
(   
	Exception   
e   
)   
{!! 
throw"" 
e"" 
;"" 
}## 
}$$ 	
}%% 
}&& ë
SD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\TransaccionDatos_EBook.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
{ 
public 

partial 
class 
TransaccionDatos )
:* +
RepositorioBase, ;
,; <#
ITransaccionRepositorio= T
{ 
public 
List 
< 
Periodo 
> 
ObtenerPeriodos ,
(, -
)- .
{ 	
try 
{ 
return 
_db 
. 
Periodo "
." #
ToList# )
() *
)* +
;+ ,
} 
catch 
( 
	Exception 
e 
) 
{ 
throw 
e 
; 
} 
} 	
public!! 
Periodo!! 
ObtenerPeriodo!! %
(!!% &
int!!& )
	idPeriodo!!* 3
)!!3 4
{"" 	
try## 
{$$ 
return%% 
_db%% 
.%% 
Periodo%% "
.%%" #
SingleOrDefault%%# 2
(%%2 3
p%%3 4
=>%%5 7
p%%8 9
.%%9 :
id%%: <
==%%= ?
	idPeriodo%%@ I
)%%I J
;%%J K
}&& 
catch'' 
('' 
	Exception'' 
e'' 
)'' 
{(( 
throw)) 
e)) 
;)) 
}** 
}++ 	
public-- 
Periodo-- 
ObtenerPeriodo-- %
(--% &
string--& ,
nombrePeriodo--- :
)--: ;
{.. 	
try// 
{00 
return11 
_db11 
.11 
Periodo11 "
.11" #
SingleOrDefault11# 2
(112 3
p113 4
=>115 7
p118 9
.119 :
nombre11: @
==11A C
nombrePeriodo11D Q
)11Q R
;11R S
}22 
catch33 
(33 
	Exception33 
e33 
)33 
{44 
throw55 
e55 
;55 
}66 
}77 	
}88 
}99 –ü
TD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\Almacen\InventarioDatos.cs
	namespace

 	
Tsp


 
.

 
Sigescom

 
.

 
AccesoDatos

 "
.

" #
Almacen

# *
{ 
public 

partial 
class 
InventarioDatos (
:( )"
IInventarioRepositorio* @
{ 
public 
IEnumerable 
< &
VencimientoConceptoNegocio 5
>5 61
%ObtenerVencimientoConceptosIngresados7 \
(\ ]
int] `
	idAlmacena j
,j k
DateTimel t

fechaDesdeu 
,	 Ä
DateTime
Å â

fechaHasta
ä î
)
î ï
{ 	
try 
{ 
SigescomEntities  
_db! $
=% &
new' *
SigescomEntities+ ;
(; <
)< =
;= >
var 
detalles 
= 
_db "
." #2
&Accion_de_negocio_por_tipo_transaccion# I
.  !
Where! &
(& '
antt' +
=>, .
antt/ 3
.3 4 
id_accion_de_negocio4 H
==I K
TransaccionSettingsL _
._ `
Default` g
.g h1
$IdAccionDeNegocioMovimientoEnAlmacen	h å
&&
ç è
antt
ê î
.
î ï
valor
ï ö
)
ö õ
.  !

SelectMany! +
(+ ,
antt, 0
=>1 3
antt4 8
.8 9
Tipo_transaccion9 I
.I J
TransaccionJ U
)U V
.  !
Where! &
(& '
t' (
=>) +
t, -
.- .$
id_actor_negocio_interno. F
==F H
	idAlmacenI R
&&S U
tV W
.W X
id_estado_actualX h
==i k
MaestroSettingsl {
.{ |
Default	| É
.
É Ñ.
 IdDetalleMaestroEstadoConfirmado
Ñ §
)
§ •
.  !

SelectMany! +
(+ ,
t, -
=>. 0
t1 2
.2 3
Detalle_transaccion3 F
)F G
.  !
Where! &
(& '
dt' )
=>* ,
dt- /
./ 0
vencimiento0 ;
>=< >

fechaDesde? I
&&J L
dtM O
.O P
vencimientoP [
<=\ ^

fechaHasta_ i
)i j
.  !
Select! '
(' (
dt( *
=>+ -
new. 1&
VencimientoConceptoNegocio2 L
(L M
)M N
{  !

IdConcepto$ .
=/ 0
dt1 3
.3 4
id_concepto_negocio4 G
,G H
CodigoBarra$ /
=0 1
dt2 4
.4 5
Concepto_negocio5 E
.E F
codigo_barraF R
,R S
Concepto$ ,
=- .
dt/ 1
.1 2
Concepto_negocio2 B
.B C
nombreC I
,I J
UnidadMedida$ 0
=0 1
dt2 4
.4 5
Concepto_negocio5 E
.E F
Detalle_maestroF U
.U V
codigoV \
,\ ]
Lote  $ (
=  ) *
dt  + -
.  - .
lote  . 2
,  2 3
FechaVencimiento!!$ 4
=!!5 6
(!!7 8
DateTime!!8 @
)!!@ A
dt!!A C
.!!C D
vencimiento!!D O
}##  !
)$$  !
.$$! "
Distinct$$" *
($$* +
)$$+ ,
;$$, -
return%% 
detalles%% 
;%%  
}&& 
catch'' 
('' 
	Exception'' 
e'' 
)'' 
{(( 
throw(( 
new(( 
DatosException(( &
(((& '
$str((' `
,((` a
e((b c
)((c d
;((d e
}((f g
})) 	
public++ 
IEnumerable++ 
<++ &
VencimientoConceptoNegocio++ 5
>++5 61
%ObtenerVencimientoConceptosIngresados++7 \
(++\ ]
int++] `
	idAlmacen++a j
,++j k
DateTime++l t

fechaDesde++u 
,	++ Ä
DateTime
++Å â

fechaHasta
++ä î
,
++î ï
int
++ñ ô
[
++ô ö
]
++ö õ
familias
++ú §
)
++§ •
{,, 	
try-- 
{.. 
SigescomEntities//  
_db//! $
=//% &
new//' *
SigescomEntities//+ ;
(//; <
)//< =
;//= >
var00 
detalles00 
=00 
_db00 "
.00" #2
&Accion_de_negocio_por_tipo_transaccion00# I
.11  !
Where11! &
(11& '
antt11' +
=>11, .
antt11/ 3
.113 4 
id_accion_de_negocio114 H
==11I K
TransaccionSettings11L _
.11_ `
Default11` g
.11g h1
$IdAccionDeNegocioMovimientoEnAlmacen	11h å
&&
11ç è
antt
11ê î
.
11î ï
valor
11ï ö
)
11ö õ
.22  !

SelectMany22! +
(22+ ,
antt22, 0
=>221 3
antt224 8
.228 9
Tipo_transaccion229 I
.22I J
Transaccion22J U
)22U V
.33  !
Where33! &
(33& '
t33' (
=>33) +
t33, -
.33- .$
id_actor_negocio_interno33. F
==33G I
	idAlmacen33J S
&&33T V
t33W X
.33X Y
id_estado_actual33Y i
==33j l
MaestroSettings33m |
.33| }
Default	33} Ñ
.
33Ñ Ö.
 IdDetalleMaestroEstadoConfirmado
33Ö •
)
33• ¶
.44  !

SelectMany44! +
(44+ ,
t44, -
=>44. 0
t441 2
.442 3
Detalle_transaccion443 F
)44F G
.55  !
Where55! &
(55& '
dt55' )
=>55* ,
familias55- 5
.555 6
Contains556 >
(55> ?
dt55? A
.55A B
Concepto_negocio55B R
.55R S
id_concepto_basico55S e
)55e f
&&55g i
dt55j l
.55l m
vencimiento55m x
>=55y {

fechaDesde	55| Ü
&&
55á â
dt
55ä å
.
55å ç
vencimiento
55ç ò
<=
55ô õ

fechaHasta
55ú ¶
)
55¶ ß
.66  !
Select66! '
(66' (
dt66( *
=>66+ -
new66. 1&
VencimientoConceptoNegocio662 L
(66L M
)66M N
{77  !

IdConcepto88$ .
=88/ 0
dt881 3
.883 4
id_concepto_negocio884 G
,88G H
CodigoBarra99$ /
=990 1
dt992 4
.994 5
Concepto_negocio995 E
.99E F
codigo_barra99F R
,99R S
Concepto::$ ,
=::- .
dt::/ 1
.::1 2
Concepto_negocio::2 B
.::B C
nombre::C I
,::I J
UnidadMedida;;$ 0
=;;1 2
dt;;3 5
.;;5 6
Concepto_negocio;;6 F
.;;F G
Detalle_maestro;;G V
.;;V W
codigo;;W ]
,;;] ^
Lote<<$ (
=<<) *
dt<<+ -
.<<- .
lote<<. 2
,<<2 3
FechaVencimiento==$ 4
===5 6
(==7 8
DateTime==8 @
)==@ A
dt==A C
.==C D
vencimiento==D O
}>>  !
)??  !
.??! "
Distinct??" *
(??* +
)??+ ,
;??, -
return@@ 
detalles@@ 
;@@  
}AA 
catchBB 
(BB 
	ExceptionBB 
eBB 
)BB 
{CC 
throwCC 
newCC 
DatosExceptionCC &
(CC& '
$strCC' `
,CC` a
eCCb c
)CCc d
;CCd e
}CCf g
}DD 	
publicFF 
InventarioFisicoFF 
ObtenerInventarioFF  1
(FF1 2
longFF2 6
idInventarioFF7 C
,FFC D
intFFE H

idConceptoFFI S
,FFS T
stringFFU [
loteFF\ `
)FF` a
{GG 	
SigescomEntitiesHH 
_dbHH  
=HH! "
newHH# &
SigescomEntitiesHH' 7
(HH7 8
)HH8 9
;HH9 :
varII 

inventarioII 
=II 
_dbII  
.II  !
TransaccionII! ,
.II, -
SingleOrDefaultII- <
(II< =
tII= >
=>II? A
tIIB C
.IIC D
idIID F
==IIG I
idInventarioIIJ V
)IIV W
.IIW X
Detalle_transaccionIIX k
.IIk l
WhereIIl q
(IIq r
dtIIr t
=>IIu w
dtIIx z
.IIz { 
id_concepto_negocio	II{ é
==
IIè ë

idConcepto
IIí ú
&&
IIù ü
dt
II† ¢
.
II¢ £
lote
II£ ß
==
II® ™
lote
II´ Ø
)
IIØ ∞
.
II∞ ±
Select
II± ∑
(
II∑ ∏
dt
II∏ ∫
=>
IIª Ω
new
IIæ ¡
InventarioFisico
II¬ “
(
II“ ”
)
II” ‘
{JJ 
CodigoBarraKK 
=KK 
dtKK  
.KK  !
Concepto_negocioKK! 1
.KK1 2
codigo_barraKK2 >
,KK> ?
ConceptoLL 
=LL 
dtLL 
.LL 
Concepto_negocioLL .
.LL. /
nombreLL/ 5
,LL5 6
CantidadMM 
=MM 
dtMM 
.MM 
cantidadMM &
,MM& '
FamiliaNN 
=NN 
dtNN 
.NN 
Concepto_negocioNN -
.NN- .
Detalle_maestro4NN. >
.NN> ?
nombreNN? E
,NNE F
LoteOO 
=OO 
dtOO 
.OO 
loteOO 
,OO 
UnidadMedidaPP 
=PP 
dtPP !
.PP! "
Concepto_negocioPP" 2
.PP2 3
Detalle_maestroPP3 B
.PPB C
codigoPPC I
}QQ 
)RR 
.RR 
SingleOrDefaultRR 
(RR 
)RR 
;RR  
returnSS 

inventarioSS 
;SS 
}TT 	
publicUU  
InventarioValorizadoUU #'
ObtenerInventarioValorizadoUU$ ?
(UU? @
longUU@ D
idInventarioUUE Q
,UUQ R
intUUS V

idConceptoUUW a
,UUa b
stringUUc i
loteUUj n
)UUn o
{VV 	
SigescomEntitiesWW 
_dbWW  
=WW! "
newWW# &
SigescomEntitiesWW' 7
(WW7 8
)WW8 9
;WW9 :
varXX 

inventarioXX 
=XX 
_dbXX  
.XX  !
TransaccionXX! ,
.XX, -
SingleOrDefaultXX- <
(XX< =
tXX= >
=>XX? A
tXXB C
.XXC D
idXXD F
==XXG I
idInventarioXXJ V
)XXV W
.XXW X
Detalle_transaccionXXX k
.XXk l
WhereXXl q
(XXq r
dtXXr t
=>XXu w
dtXXx z
.XXz { 
id_concepto_negocio	XX{ é
==
XXè ë

idConcepto
XXí ú
&&
XXù ü
dt
XX† ¢
.
XX¢ £
lote
XX£ ß
==
XX® ™
lote
XX´ Ø
)
XXØ ∞
.
XX∞ ±
Select
XX± ∑
(
XX∑ ∏
dt
XX∏ ∫
=>
XXª Ω
new
XXæ ¡"
InventarioValorizado
XX¬ ÷
(
XX÷ ◊
)
XX◊ ÿ
{YY 
CodigoBarraZZ 
=ZZ 
dtZZ  
.ZZ  !
Concepto_negocioZZ! 1
.ZZ1 2
codigo_barraZZ2 >
,ZZ> ?
Concepto[[ 
=[[ 
dt[[ 
.[[ 
Concepto_negocio[[ .
.[[. /
nombre[[/ 5
,[[5 6
Cantidad\\ 
=\\ 
dt\\ 
.\\ 
cantidad\\ &
,\\& '
Familia]] 
=]] 
dt]] 
.]] 
Concepto_negocio]] -
.]]- .
Detalle_maestro4]]. >
.]]> ?
nombre]]? E
,]]E F
Lote^^ 
=^^ 
dt^^ 
.^^ 
lote^^ 
,^^ 
UnidadMedida__ 
=__ 
dt__ !
.__! "
Concepto_negocio__" 2
.__2 3
Detalle_maestro__3 B
.__B C
codigo__C I
,__I J

ValorTotal`` 
=`` 
dt`` 
.``  
total``  %
,``% &
ValorUnitarioaa 
=aa 
dtaa  "
.aa" #
precio_unitarioaa# 2
}bb 
)cc 
.cc 
SingleOrDefaultcc 
(cc 
)cc 
;cc  
returndd 

inventariodd 
;dd 
}ee 	
publicgg 
InventarioFisicogg #
ObtenerInventarioFisicogg  7
(gg7 8
longgg8 <
idInventariogg= I
,ggI J
intggK N

idConceptoggO Y
)ggY Z
{hh 	
SigescomEntitiesii 
_dbii  
=ii! "
newii# &
SigescomEntitiesii' 7
(ii7 8
)ii8 9
;ii9 :
varjj 

inventariojj 
=jj 
_dbjj  
.jj  !
Transaccionjj! ,
.jj, -
Wherejj- 2
(jj2 3
tjj3 4
=>jj5 7
tjj8 9
.jj9 :
idjj: <
==jj= ?
idInventariojj@ L
)jjL M
.jjM N

SelectManyjjN X
(jjX Y
tjjY Z
=>jj[ ]
tjj^ _
.jj_ `
Detalle_transaccionjj` s
)jjs t
.jjt u
Wherejju z
(jjz {
dtjj{ }
=>	jj~ Ä
dt
jjÅ É
.
jjÉ Ñ!
id_concepto_negocio
jjÑ ó
==
jjò ö

idConcepto
jjõ •
)
jj• ¶
.
jj¶ ß
GroupBy
jjß Æ
(
jjÆ Ø
dt
jjØ ±
=>
jj≤ ¥
new
jjµ ∏
{
jjπ ∫
dt
jjª Ω
.
jjΩ æ
Concepto_negocio
jjæ Œ
.
jjŒ œ
codigo_barra
jjœ €
,
jj€ ‹
dt
jj› ﬂ
.
jjﬂ ‡
Concepto_negocio
jj‡ 
.
jj Ò
nombre
jjÒ ˜
}
jj¯ ˘
)
jj˘ ˙
.
jj˙ ˚
Select
jj˚ Å
(
jjÅ Ç
dt
jjÇ Ñ
=>
jjÖ á
new
jjà ã
InventarioFisico
jjå ú
(
jjú ù
)
jjù û
{kk 
CodigoBarrall 
=ll 
dtll  
.ll  !
Keyll! $
.ll$ %
codigo_barrall% 1
,ll1 2
Conceptomm 
=mm 
dtmm 
.mm 
Keymm !
.mm! "
nombremm" (
,mm( )
Cantidadnn 
=nn 
dtnn 
.nn 
Sumnn !
(nn! "
tnn" #
=>nn$ &
tnn' (
.nn( )
cantidadnn) 1
)nn1 2
,nn2 3
Familiaoo 
=oo 
dtoo 
.oo 
FirstOrDefaultoo +
(oo+ ,
)oo, -
.oo- .
Concepto_negociooo. >
.oo> ?
Detalle_maestro4oo? O
.ooO P
nombreooP V
,ooV W
UnidadMedidapp 
=pp 
dtpp !
.pp! "
FirstOrDefaultpp" 0
(pp0 1
)pp1 2
.pp2 3
Concepto_negociopp3 C
.ppC D
Detalle_maestroppD S
.ppS T
codigoppT Z
}qq 
)rr 
.rr 
SingleOrDefaultrr 
(rr 
)rr 
;rr  
returnss 

inventarioss 
;ss 
}tt 	
public||  
InventarioValorizado|| #'
ObtenerInventarioValorizado||$ ?
(||? @
long||@ D
idInventario||E Q
,||Q R
int||S V

idConcepto||W a
)||a b
{}} 	
SigescomEntities~~ 
_db~~  
=~~! "
new~~# &
SigescomEntities~~' 7
(~~7 8
)~~8 9
;~~9 :
var 

inventario 
= 
_db  
.  !
Transaccion! ,
., -
Where- 2
(2 3
t3 4
=>5 7
t8 9
.9 :
id: <
=== ?
idInventario@ L
)L M
.M N

SelectManyN X
(X Y
tY Z
=>Z \
t] ^
.^ _
Detalle_transaccion_ r
)r s
.s t
Wheret y
(y z
dtz |
=>} 
dt
Ä Ç
.
Ç É!
id_concepto_negocio
É ñ
==
ó ô

idConcepto
ö §
)
§ •
.
• ¶
GroupBy
¶ ≠
(
≠ Æ
dt
Æ ∞
=>
± ≥
new
¥ ∑
{
∏ π
dt
∫ º
.
º Ω
Concepto_negocio
Ω Õ
.
Õ Œ
codigo_barra
Œ ⁄
,
⁄ €
dt
‹ ﬁ
.
ﬁ ﬂ
Concepto_negocio
ﬂ Ô
.
Ô 
nombre
 ˆ
}
˜ ¯
)
¯ ˘
.
˘ ˙
Select
˙ Ä
(
Ä Å
dt
Å É
=>
Ñ Ü
new
á ä"
InventarioValorizado
ã ü
(
ü †
)
† °
{
ÄÄ 
CodigoBarra
ÅÅ 
=
ÅÅ 
dt
ÅÅ  
.
ÅÅ  !
Key
ÅÅ! $
.
ÅÅ$ %
codigo_barra
ÅÅ% 1
,
ÅÅ1 2
Concepto
ÇÇ 
=
ÇÇ 
dt
ÇÇ 
.
ÇÇ 
Key
ÇÇ !
.
ÇÇ! "
nombre
ÇÇ" (
,
ÇÇ( )
Cantidad
ÉÉ 
=
ÉÉ 
dt
ÉÉ 
.
ÉÉ 
Sum
ÉÉ !
(
ÉÉ! "
t
ÉÉ" #
=>
ÉÉ# %
t
ÉÉ& '
.
ÉÉ' (
cantidad
ÉÉ( 0
)
ÉÉ0 1
,
ÉÉ1 2
Familia
ÑÑ 
=
ÑÑ 
dt
ÑÑ 
.
ÑÑ 
FirstOrDefault
ÑÑ +
(
ÑÑ+ ,
)
ÑÑ, -
.
ÑÑ- .
Concepto_negocio
ÑÑ. >
.
ÑÑ> ?
Detalle_maestro4
ÑÑ? O
.
ÑÑO P
nombre
ÑÑP V
,
ÑÑV W
UnidadMedida
ÖÖ 
=
ÖÖ 
dt
ÖÖ !
.
ÖÖ! "
FirstOrDefault
ÖÖ" 0
(
ÖÖ0 1
)
ÖÖ1 2
.
ÖÖ2 3
Concepto_negocio
ÖÖ3 C
.
ÖÖC D
Detalle_maestro
ÖÖD S
.
ÖÖS T
codigo
ÖÖT Z
,
ÖÖZ [

ValorTotal
ÜÜ 
=
ÜÜ 
dt
ÜÜ 
.
ÜÜ  
Sum
ÜÜ  #
(
ÜÜ# $
t
ÜÜ$ %
=>
ÜÜ% '
t
ÜÜ( )
.
ÜÜ) *
total
ÜÜ* /
)
ÜÜ/ 0
,
ÜÜ0 1
ValorUnitario
áá 
=
áá 
dt
áá  "
.
áá" #
FirstOrDefault
áá# 1
(
áá1 2
)
áá2 3
.
áá3 4
precio_unitario
áá4 C
}
àà 
)
ââ 
.
ââ 
SingleOrDefault
ââ 
(
ââ 
)
ââ 
;
ââ  
return
ää 

inventario
ää 
;
ää 
}
ãã 	
public
åå 
IEnumerable
åå 
<
åå 
InventarioFisico
åå +
>
åå+ ,%
ObtenerInventarioFisico
åå- D
(
ååD E
long
ååE I
idInventario
ååJ V
)
ååV W
{
çç 	
SigescomEntities
éé 
_db
éé  
=
éé! "
new
éé# &
SigescomEntities
éé' 7
(
éé7 8
)
éé8 9
;
éé9 :
var
èè 

inventario
èè 
=
èè 
_db
èè  
.
èè  !
Transaccion
èè! ,
.
èè, -
SingleOrDefault
èè- <
(
èè< =
t
èè= >
=>
èè? A
t
èèB C
.
èèC D
id
èèD F
==
èèF H
idInventario
èèH T
)
èèT U
.
èèU V!
Detalle_transaccion
èèV i
.
èèi j
Where
èèj o
(
èèo p
dt
èèp r
=>
èès u
dt
èèv x
.
èèx y
Concepto_negocioèèy â
.èèâ ä

es_vigenteèèä î
||èèï ó
dtèèò ö
.èèö õ 
Concepto_negocioèèõ ´
.èè´ ¨

fecha_bajaèè¨ ∂
>èè∑ ∏
dtèèπ ª
.èèª º
Transaccionèèº «
.èè« »
fecha_inicioèè» ‘
)èè‘ ’
.èè’ ÷
Selectèè÷ ‹
(èè‹ ›
dtèè› ﬂ
=>èè‡ ‚
newèè„ Ê 
InventarioFisicoèèÁ ˜
(èè˜ ¯
)èè¯ ˘
{
êê 
CodigoBarra
ëë 
=
ëë 
dt
ëë  
.
ëë  !
Concepto_negocio
ëë! 1
.
ëë1 2
codigo_barra
ëë2 >
,
ëë> ?
Concepto
íí 
=
íí 
dt
íí 
.
íí 
Concepto_negocio
íí .
.
íí. /
nombre
íí/ 5
,
íí5 6
Cantidad
ìì 
=
ìì 
dt
ìì 
.
ìì 
cantidad
ìì &
,
ìì& '
Familia
îî 
=
îî 
dt
îî 
.
îî 
Concepto_negocio
îî -
.
îî- .
Detalle_maestro4
îî. >
.
îî> ?
nombre
îî? E
,
îîE F
Lote
ïï 
=
ïï 
dt
ïï 
.
ïï 
lote
ïï 
,
ïï 
UnidadMedida
ññ 
=
ññ 
dt
ññ !
.
ññ! "
Concepto_negocio
ññ" 2
.
ññ2 3
Detalle_maestro
ññ3 B
.
ññB C
codigo
ññC I
}
óó 
)
òò 
;
òò 
return
ôô 

inventario
ôô 
;
ôô 
}
öö 	
public
õõ 
IEnumerable
õõ 
<
õõ "
InventarioValorizado
õõ /
>
õõ/ 0)
ObtenerInventarioValorizado
õõ1 L
(
õõL M
long
õõM Q
idInventario
õõR ^
)
õõ^ _
{
úú 	
SigescomEntities
ùù 
_db
ùù  
=
ùù! "
new
ùù# &
SigescomEntities
ùù' 7
(
ùù7 8
)
ùù8 9
;
ùù9 :
var
ûû 

inventario
ûû 
=
ûû 
_db
ûû  
.
ûû  !
Transaccion
ûû! ,
.
ûû, -
SingleOrDefault
ûû- <
(
ûû< =
t
ûû= >
=>
ûû? A
t
ûûB C
.
ûûC D
id
ûûD F
==
ûûG I
idInventario
ûûJ V
)
ûûV W
.
ûûW X!
Detalle_transaccion
ûûX k
.
ûûk l
Where
ûûl q
(
ûûq r
dt
ûûr t
=>
ûûu w
dt
ûûx z
.
ûûz {
Concepto_negocioûû{ ã
.ûûã å

es_vigenteûûå ñ
||ûûó ô
dtûûö ú
.ûûú ù 
Concepto_negocioûûù ≠
.ûû≠ Æ

fecha_bajaûûÆ ∏
>ûûπ ∫
dtûûª Ω
.ûûΩ æ
Transaccionûûæ …
.ûû…  
fecha_inicioûû  ÷
)ûû÷ ◊
.ûû◊ ÿ
Selectûûÿ ﬁ
(ûûﬁ ﬂ
dtûûﬂ ·
=>ûû‚ ‰
newûûÂ Ë$
InventarioValorizadoûûÈ ˝
(ûû˝ ˛
)ûû˛ ˇ
{
üü 
CodigoBarra
†† 
=
†† 
dt
††  
.
††  !
Concepto_negocio
††! 1
.
††1 2
codigo_barra
††2 >
,
††> ?
Concepto
°° 
=
°° 
dt
°° 
.
°° 
Concepto_negocio
°° .
.
°°. /
nombre
°°/ 5
,
°°5 6
Cantidad
¢¢ 
=
¢¢ 
dt
¢¢ 
.
¢¢ 
cantidad
¢¢ &
,
¢¢& '
Familia
££ 
=
££ 
dt
££ 
.
££ 
Concepto_negocio
££ -
.
££- .
Detalle_maestro4
££. >
.
££> ?
nombre
££? E
,
££E F
Lote
§§ 
=
§§ 
dt
§§ 
.
§§ 
lote
§§ 
,
§§ 
UnidadMedida
•• 
=
•• 
dt
•• !
.
••! "
Concepto_negocio
••" 2
.
••2 3
Detalle_maestro
••3 B
.
••B C
codigo
••C I
,
••I J

ValorTotal
¶¶ 
=
¶¶ 
dt
¶¶ 
.
¶¶  
total
¶¶  %
,
¶¶% &
ValorUnitario
ßß 
=
ßß 
dt
ßß  "
.
ßß" #
precio_unitario
ßß# 2
}
®® 
)
©© 
;
©© 
return
™™ 

inventario
™™ 
;
™™ 
}
´´ 	
public
¨¨ 
IEnumerable
¨¨ 
<
¨¨  
InventarioSemaforo
¨¨ -
>
¨¨- .'
ObtenerInventarioSemaforo
¨¨/ H
(
¨¨H I
long
¨¨I M
idInventario
¨¨N Z
)
¨¨Z [
{
≠≠ 	
SigescomEntities
ÆÆ 
_db
ÆÆ  
=
ÆÆ! "
new
ÆÆ# &
SigescomEntities
ÆÆ' 7
(
ÆÆ7 8
)
ÆÆ8 9
;
ÆÆ9 :
var
ØØ 

inventario
ØØ 
=
ØØ 
_db
ØØ  
.
ØØ  !
Transaccion
ØØ! ,
.
ØØ, -
SingleOrDefault
ØØ- <
(
ØØ< =
t
ØØ= >
=>
ØØ? A
t
ØØB C
.
ØØC D
id
ØØD F
==
ØØG I
idInventario
ØØJ V
)
ØØV W
.
ØØW X!
Detalle_transaccion
ØØX k
.
ØØk l
Where
ØØl q
(
ØØq r
dt
ØØr t
=>
ØØu w
dt
ØØx z
.
ØØz {
Concepto_negocioØØ{ ã
.ØØã å

es_vigenteØØå ñ
||ØØó ô
dtØØö ú
.ØØú ù 
Concepto_negocioØØù ≠
.ØØ≠ Æ

fecha_bajaØØÆ ∏
>ØØπ ∫
dtØØª Ω
.ØØΩ æ
TransaccionØØæ …
.ØØ…  
fecha_inicioØØ  ÷
)ØØ÷ ◊
.ØØ◊ ÿ
SelectØØÿ ﬁ
(ØØﬁ ﬂ
dtØØﬂ ·
=>ØØ‚ ‰
newØØÂ Ë"
InventarioSemaforoØØÈ ˚
(ØØ˚ ¸
)ØØ¸ ˝
{
∞∞ 
CodigoBarra
±± 
=
±± 
dt
±±  
.
±±  !
Concepto_negocio
±±! 1
.
±±1 2
codigo_barra
±±2 >
,
±±> ?
Concepto
≤≤ 
=
≤≤ 
dt
≤≤ 
.
≤≤ 
Concepto_negocio
≤≤ .
.
≤≤. /
nombre
≤≤/ 5
,
≤≤5 6
Cantidad
≥≥ 
=
≥≥ 
dt
≥≥ 
.
≥≥ 
cantidad
≥≥ &
,
≥≥& '
Familia
¥¥ 
=
¥¥ 
dt
¥¥ 
.
¥¥ 
Concepto_negocio
¥¥ -
.
¥¥- .
Detalle_maestro4
¥¥. >
.
¥¥> ?
nombre
¥¥? E
,
¥¥E F
Lote
µµ 
=
µµ 
dt
µµ 
.
µµ 
lote
µµ 
,
µµ 
UnidadMedida
∂∂ 
=
∂∂ 
dt
∂∂ !
.
∂∂! "
Concepto_negocio
∂∂" 2
.
∂∂2 3
Detalle_maestro
∂∂3 B
.
∂∂B C
codigo
∂∂C I
,
∂∂I J
StockMinimo
∑∑ 
=
∑∑ 
dt
∑∑  
.
∑∑  !
Concepto_negocio
∑∑! 1
.
∑∑1 2
stock_minimo
∑∑2 >
}
∏∏ 
)
ππ 
;
ππ 
return
∫∫ 

inventario
∫∫ 
;
∫∫ 
}
ªª 	
public
ΩΩ 
IEnumerable
ΩΩ 
<
ΩΩ 
InventarioFisico
ΩΩ +
>
ΩΩ+ ,%
ObtenerInventarioFisico
ΩΩ- D
(
ΩΩD E
long
ΩΩE I
idInventario
ΩΩJ V
,
ΩΩV W
int
ΩΩX [
[
ΩΩ[ \
]
ΩΩ\ ]
familias
ΩΩ^ f
)
ΩΩf g
{
ææ 	
SigescomEntities
øø 
_db
øø  
=
øø! "
new
øø# &
SigescomEntities
øø' 7
(
øø7 8
)
øø8 9
;
øø9 :
var
¿¿ 

inventario
¿¿ 
=
¿¿ 
_db
¿¿  
.
¿¿  !
Transaccion
¿¿! ,
.
¿¿, -
SingleOrDefault
¿¿- <
(
¿¿< =
t
¿¿= >
=>
¿¿? A
t
¿¿B C
.
¿¿C D
id
¿¿D F
==
¿¿G I
idInventario
¿¿J V
)
¿¿V W
.
¿¿W X!
Detalle_transaccion
¿¿X k
.
¿¿k l
Where
¿¿l q
(
¿¿q r
dt
¿¿r t
=>
¿¿u w
familias¿¿x Ä
.¿¿Ä Å
Contains¿¿Å â
(¿¿â ä
dt¿¿ä å
.¿¿å ç 
Concepto_negocio¿¿ç ù
.¿¿ù û"
id_concepto_basico¿¿û ∞
)¿¿∞ ±
&&¿¿≤ ¥
dt¿¿µ ∑
.¿¿∑ ∏ 
Concepto_negocio¿¿∏ »
.¿¿» …

es_vigente¿¿… ”
||¿¿‘ ÷
dt¿¿◊ Ÿ
.¿¿Ÿ ⁄ 
Concepto_negocio¿¿⁄ Í
.¿¿Í Î

fecha_baja¿¿Î ı
>¿¿ˆ ˜
dt¿¿¯ ˙
.¿¿˙ ˚
Transaccion¿¿˚ Ü
.¿¿Ü á
fecha_inicio¿¿á ì
)¿¿ì î
.¿¿î ï
Select¿¿ï õ
(¿¿õ ú
dt¿¿ú û
=>¿¿ü °
new¿¿¢ • 
InventarioFisico¿¿¶ ∂
(¿¿∂ ∑
)¿¿∑ ∏
{
¡¡ 
CodigoBarra
¬¬ 
=
¬¬ 
dt
¬¬  
.
¬¬  !
Concepto_negocio
¬¬! 1
.
¬¬1 2
codigo_barra
¬¬2 >
,
¬¬> ?
Concepto
√√ 
=
√√ 
dt
√√ 
.
√√ 
Concepto_negocio
√√ .
.
√√. /
nombre
√√/ 5
,
√√5 6
Cantidad
ƒƒ 
=
ƒƒ 
dt
ƒƒ 
.
ƒƒ 
cantidad
ƒƒ &
,
ƒƒ& '
Familia
≈≈ 
=
≈≈ 
dt
≈≈ 
.
≈≈ 
Concepto_negocio
≈≈ -
.
≈≈- .
Detalle_maestro4
≈≈. >
.
≈≈> ?
nombre
≈≈? E
,
≈≈E F
Lote
∆∆ 
=
∆∆ 
dt
∆∆ 
.
∆∆ 
lote
∆∆ 
,
∆∆ 
UnidadMedida
«« 
=
«« 
dt
«« !
.
««! "
Concepto_negocio
««" 2
.
««2 3
Detalle_maestro
««3 B
.
««B C
codigo
««C I
}
»» 
)
…… 
;
…… 
return
   

inventario
   
;
   
}
ÀÀ 	
public
ÃÃ 
IEnumerable
ÃÃ 
<
ÃÃ  
InventarioSemaforo
ÃÃ -
>
ÃÃ- .'
ObtenerInventarioSemaforo
ÃÃ/ H
(
ÃÃH I
long
ÃÃI M
idInventario
ÃÃN Z
,
ÃÃZ [
int
ÃÃ\ _
[
ÃÃ_ `
]
ÃÃ` a
familias
ÃÃb j
)
ÃÃj k
{
ÕÕ 	
SigescomEntities
ŒŒ 
_db
ŒŒ  
=
ŒŒ! "
new
ŒŒ# &
SigescomEntities
ŒŒ' 7
(
ŒŒ7 8
)
ŒŒ8 9
;
ŒŒ9 :
var
œœ 

inventario
œœ 
=
œœ 
_db
œœ  
.
œœ  !
Transaccion
œœ! ,
.
œœ, -
SingleOrDefault
œœ- <
(
œœ< =
t
œœ= >
=>
œœ? A
t
œœB C
.
œœC D
id
œœD F
==
œœG I
idInventario
œœJ V
)
œœV W
.
œœW X!
Detalle_transaccion
œœX k
.
œœk l
Where
œœl q
(
œœq r
dt
œœr t
=>
œœu w
familiasœœx Ä
.œœÄ Å
ContainsœœÅ â
(œœâ ä
dtœœä å
.œœå ç 
Concepto_negocioœœç ù
.œœù û"
id_concepto_basicoœœû ∞
)œœ∞ ±
&&œœ± ≥
dtœœ¥ ∂
.œœ∂ ∑ 
Concepto_negocioœœ∑ «
.œœ« »

es_vigenteœœ» “
||œœ” ’
dtœœ÷ ÿ
.œœÿ Ÿ 
Concepto_negocioœœŸ È
.œœÈ Í

fecha_bajaœœÍ Ù
>œœı ˆ
dtœœ˜ ˘
.œœ˘ ˙
Transaccionœœ˙ Ö
.œœÖ Ü
fecha_inicioœœÜ í
)œœí ì
.œœì î
Selectœœî ö
(œœö õ
dtœœõ ù
=>œœû †
newœœ° §"
InventarioSemaforoœœ• ∑
(œœ∑ ∏
)œœ∏ π
{
–– 
CodigoBarra
—— 
=
—— 
dt
——  
.
——  !
Concepto_negocio
——! 1
.
——1 2
codigo_barra
——2 >
,
——> ?
Concepto
““ 
=
““ 
dt
““ 
.
““ 
Concepto_negocio
““ .
.
““. /
nombre
““/ 5
,
““5 6
Cantidad
”” 
=
”” 
dt
”” 
.
”” 
cantidad
”” &
,
””& '
Familia
‘‘ 
=
‘‘ 
dt
‘‘ 
.
‘‘ 
Concepto_negocio
‘‘ -
.
‘‘- .
Detalle_maestro4
‘‘. >
.
‘‘> ?
nombre
‘‘? E
,
‘‘E F
Lote
’’ 
=
’’ 
dt
’’ 
.
’’ 
lote
’’ 
,
’’ 
UnidadMedida
÷÷ 
=
÷÷ 
dt
÷÷ !
.
÷÷! "
Concepto_negocio
÷÷" 2
.
÷÷2 3
Detalle_maestro
÷÷3 B
.
÷÷B C
codigo
÷÷C I
,
÷÷I J
StockMinimo
◊◊ 
=
◊◊ 
dt
◊◊  
.
◊◊  !
Concepto_negocio
◊◊! 1
.
◊◊1 2
stock_minimo
◊◊2 >
}
ÿÿ 
)
ŸŸ 
;
ŸŸ 
return
⁄⁄ 

inventario
⁄⁄ 
;
⁄⁄ 
}
€€ 	
public
‹‹ 
IEnumerable
‹‹ 
<
‹‹ "
InventarioValorizado
‹‹ /
>
‹‹/ 0)
ObtenerInventarioValorizado
‹‹1 L
(
‹‹L M
long
‹‹M Q
idInventario
‹‹R ^
,
‹‹^ _
int
‹‹` c
[
‹‹c d
]
‹‹d e
familias
‹‹f n
)
‹‹n o
{
›› 	
SigescomEntities
ﬁﬁ 
_db
ﬁﬁ  
=
ﬁﬁ! "
new
ﬁﬁ# &
SigescomEntities
ﬁﬁ' 7
(
ﬁﬁ7 8
)
ﬁﬁ8 9
;
ﬁﬁ9 :
var
ﬂﬂ 

inventario
ﬂﬂ 
=
ﬂﬂ 
_db
ﬂﬂ  
.
ﬂﬂ  !
Transaccion
ﬂﬂ! ,
.
ﬂﬂ, -
SingleOrDefault
ﬂﬂ- <
(
ﬂﬂ< =
t
ﬂﬂ= >
=>
ﬂﬂ? A
t
ﬂﬂB C
.
ﬂﬂC D
id
ﬂﬂD F
==
ﬂﬂG I
idInventario
ﬂﬂJ V
)
ﬂﬂV W
.
ﬂﬂW X!
Detalle_transaccion
ﬂﬂX k
.
ﬂﬂk l
Where
ﬂﬂl q
(
ﬂﬂq r
dt
ﬂﬂr t
=>
ﬂﬂu w
familiasﬂﬂx Ä
.ﬂﬂÄ Å
ContainsﬂﬂÅ â
(ﬂﬂâ ä
dtﬂﬂä å
.ﬂﬂå ç 
Concepto_negocioﬂﬂç ù
.ﬂﬂù û"
id_concepto_basicoﬂﬂû ∞
)ﬂﬂ∞ ±
)ﬂﬂ± ≤
.ﬂﬂ≤ ≥
Selectﬂﬂ≥ π
(ﬂﬂπ ∫
dtﬂﬂ∫ º
=>ﬂﬂΩ ø
newﬂﬂ¿ √$
InventarioValorizadoﬂﬂƒ ÿ
(ﬂﬂÿ Ÿ
)ﬂﬂŸ ⁄
{
‡‡ 
CodigoBarra
·· 
=
·· 
dt
··  
.
··  !
Concepto_negocio
··! 1
.
··1 2
codigo_barra
··2 >
,
··> ?
Concepto
‚‚ 
=
‚‚ 
dt
‚‚ 
.
‚‚ 
Concepto_negocio
‚‚ .
.
‚‚. /
nombre
‚‚/ 5
,
‚‚5 6
Cantidad
„„ 
=
„„ 
dt
„„ 
.
„„ 
cantidad
„„ &
,
„„& '
Familia
‰‰ 
=
‰‰ 
dt
‰‰ 
.
‰‰ 
Concepto_negocio
‰‰ -
.
‰‰- .
Detalle_maestro4
‰‰. >
.
‰‰> ?
nombre
‰‰? E
,
‰‰E F
Lote
ÂÂ 
=
ÂÂ 
dt
ÂÂ 
.
ÂÂ 
lote
ÂÂ 
,
ÂÂ 
UnidadMedida
ÊÊ 
=
ÊÊ 
dt
ÊÊ !
.
ÊÊ! "
Concepto_negocio
ÊÊ" 2
.
ÊÊ2 3
Detalle_maestro
ÊÊ3 B
.
ÊÊB C
codigo
ÊÊC I
,
ÊÊI J

ValorTotal
ÁÁ 
=
ÁÁ 
dt
ÁÁ 
.
ÁÁ  
total
ÁÁ  %
,
ÁÁ% &
ValorUnitario
ËË 
=
ËË 
dt
ËË  "
.
ËË" #
precio_unitario
ËË# 2
}
ÈÈ 
)
ÍÍ 
;
ÍÍ 
return
ÏÏ 

inventario
ÏÏ 
;
ÏÏ 
}
ÓÓ 	
}
ÛÛ 
}ÙÙ ç∏
VD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\TransaccionDatos_Reportes.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
{ 
public 

partial 
class 
TransaccionDatos )
:* +
RepositorioBase, ;
,; <#
ITransaccionRepositorio= T
{ 
public 
IEnumerable 
< <
0Resumen_Transaccion_Por_Serie_y_Concepto_Negocio K
>K L5
)ObtenerResumenTransaccionesSerieYConceptoM v
(v w
intw z
idTipoTransaccion	{ å
,
å ç
int
é ë
idUltimoEstado
í †
,
† °
DateTime
¢ ™

fechaDesde
´ µ
,
µ ∂
DateTime
∑ ø

fechaHasta
¿  
)
  À
{ 	
try 
{ 
var 
Resumen 
= 
_db !
.! "
Transaccion" -
.- .
Where. 3
(3 4
sbt4 7
=>8 :
sbt; >
.> ?
fecha_inicio? K
>=L N

fechaDesdeO Y
&&Z \
sbt] `
.` a
fecha_inicioa m
<=n p

fechaHastaq {
&&| ~
sbt	 Ç
.
Ç É!
id_tipo_transaccion
É ñ
==
ó ô
idTipoTransaccion
ö ´
&&
¨ Æ
sbt 
. 
id_estado_actual $
==% '
idUltimoEstado( 6
)6 7
.7 8

SelectMany8 B
(B C
tC D
=>E G
tH I
.I J
Detalle_transaccionJ ]
)] ^
.^ _
GroupBy 
( 
dt 
=> 
new 
{ 
dt 
. 
Transaccion  
.  !
Comprobante! ,
., - 
id_serie_comprobante- A
,A B
dt 
. 
Transaccion  
.  !
Comprobante! ,
., -
numero_serie- 9
,9 :
dt   
.   
id_concepto_negocio   (
,  ( )
dt!! 
.!! 
Concepto_negocio!! %
.!!% &
nombre!!& ,
,!!, -
dt"" 
."" 
Concepto_negocio"" %
.""% &
codigo_barra""& 2
,""2 3
dt## 
.## 
Transaccion##  
.##  !
Comprobante##! ,
.##, -
Detalle_maestro##- <
.##< =
valor##= B
,##B C
precioUnitario$$  
=$$! "
dt$$# %
.$$% &
precio_unitario$$& 5
}&& 
)&& 
.&& 
Select&& 
(&& 
dt&& 
=>&& 
new&& !<
0Resumen_Transaccion_Por_Serie_y_Concepto_Negocio&&" R
(&&R S
)&&S T
{'' 
IdSerie(( 
=(( 
dt(( 
.(( 
Key(( "
.((" # 
id_serie_comprobante((# 7
.((7 8
Value((8 =
,((= >
Serie)) 
=)) 
dt)) 
.)) 
Key))  
.))  !
numero_serie))! -
,))- .
CodigoBarra** 
=** 
dt**  "
.**" #
Key**# &
.**& '
codigo_barra**' 3
,**3 4
IdConceptoNegocio++ #
=++$ %
dt++& (
.++( )
Key++) ,
.++, -
id_concepto_negocio++- @
,++@ A
ConceptoNegocio,, !
=,," #
dt,,$ &
.,,& '
Key,,' *
.,,* +
nombre,,+ 1
,,,1 2 
NombreCortoDocumento-- &
=--' (
dt--) +
.--+ ,
Key--, /
.--/ 0
valor--0 5
,--5 6
Cantidad.. 
=.. 
dt.. 
...  
Sum..  #
(..# $
c..$ %
=>..& (
c..) *
...* +
cantidad..+ 3
)..3 4
,..4 5
Importe// 
=// 
dt// 
.// 
Sum// "
(//" #
i//# $
=>//% '
i//( )
.//) *
total//* /
)/// 0
,//0 1
}00 
)00 
;00 
return11 
Resumen11 
.11 
OrderBy11 &
(11& '
r11' (
=>11) +
r11, -
.11- .
CodigoBarra11. 9
!=11: <
null11= A
?11B C
r11D E
.11E F
CodigoBarra11F Q
:11R S
r11T U
.11U V
ConceptoNegocio11V e
)11e f
;11f g
}33 
catch44 
(44 
	Exception44 
e44 
)44 
{55 
throw66 
e66 
;66 
}77 
}:: 	
public<< 
IEnumerable<< 
<<< :
.Resumen_Transaccion_Por_Serie_y_ConceptoBasico<< I
><<I J=
1ObtenerResumenTransaccionesPorSerieYConeptoBasico<<K |
(<<| }
int	<<} Ä
idTipoTransaccion
<<Å í
,
<<í ì
int
<<î ó
idUltimoEstado
<<ò ¶
,
<<¶ ß
DateTime
<<® ∞

fechaDesde
<<± ª
,
<<ª º
DateTime
<<Ω ≈

fechaHasta
<<∆ –
)
<<– —
{== 	
try>> 
{?? 
var@@ 
Resumen@@ 
=@@ 
_db@@ !
.@@! "
Transaccion@@" -
.@@- .
Where@@. 3
(@@3 4
sbt@@4 7
=>@@8 :
sbt@@; >
.@@> ?
fecha_inicio@@? K
>=@@L N

fechaDesde@@O Y
&&@@Z \
sbt@@] `
.@@` a
fecha_inicio@@a m
<=@@n p

fechaHasta@@q {
&&@@| ~
sbt	@@ Ç
.
@@Ç É!
id_tipo_transaccion
@@É ñ
==
@@ó ô
idTipoTransaccion
@@ö ´
&&
@@¨ Æ
sbtAA 
.AA 
id_estado_actualAA $
==AA% '
idUltimoEstadoAA( 6
)AA6 7
.AA7 8

SelectManyAA8 B
(AAB C
tAAC D
=>AAE G
tAAH I
.AAI J
Detalle_transaccionAAJ ]
)AA] ^
.AA^ _
GroupByBB 
(BB 
dtBB 
=>BB 
newBB 
{CC 
dtDD 
.DD 
TransaccionDD  
.DD  !
ComprobanteDD! ,
.DD, - 
id_serie_comprobanteDD- A
,DDA B
dtEE 
.EE 
TransaccionEE  
.EE  !
ComprobanteEE! ,
.EE, -
numero_serieEE- 9
,EE9 :
dtGG 
.GG 
TransaccionGG  
.GG  !
ComprobanteGG! ,
.GG, -
Detalle_maestroGG- <
.GG< =
valorGG= B
,GGB C
IdConceptoBasicoHH "
=HH# $
dtHH% '
.HH' (
Concepto_negocioHH( 8
.HH8 9
id_concepto_basicoHH9 K
,HHK L 
NombreConceptoBasicoII &
=II' (
dtII) +
.II+ ,
Concepto_negocioII, <
.II< =
Detalle_maestro4II= M
.IIM N
nombreIIN T
}JJ 
)JJ 
.JJ 
SelectJJ 
(JJ 
dtJJ 
=>JJ 
newJJ !:
.Resumen_Transaccion_Por_Serie_y_ConceptoBasicoJJ" P
(JJP Q
)JJQ R
{KK 
IdSerieLL 
=LL 
dtLL 
.LL 
KeyLL "
.LL" # 
id_serie_comprobanteLL# 7
.LL7 8
ValueLL8 =
,LL= >
SerieMM 
=MM 
dtMM 
.MM 
KeyMM  
.MM  !
numero_serieMM! -
,MM- . 
NombreCortoDocumentoNN &
=NN' (
dtNN) +
.NN+ ,
KeyNN, /
.NN/ 0
valorNN0 5
,NN5 6
ConceptoBasicoOO  
=OO! "
dtOO# %
.OO% &
KeyOO& )
.OO) * 
NombreConceptoBasicoOO* >
,OO> ?
CantidadPP 
=PP 
dtPP 
.PP  
SumPP  #
(PP# $
cPP$ %
=>PP& (
cPP) *
.PP* +
cantidadPP+ 3
)PP3 4
,PP4 5
ImporteQQ 
=QQ 
dtQQ 
.QQ 
SumQQ "
(QQ" #
iQQ# $
=>QQ% '
iQQ( )
.QQ) *
totalQQ* /
)QQ/ 0
,QQ0 1
}RR 
)RR 
;RR 
returnSS 
ResumenSS 
;SS 
}UU 
catchVV 
(VV 
	ExceptionVV 
eVV 
)VV 
{WW 
throwXX 
eXX 
;XX 
}YY 
}ZZ 	
public\\ 
IEnumerable\\ 
<\\ +
Resumen_Transaccion_Consolidado\\ :
>\\: ;'
ObtenerResumenTransacciones\\< W
(\\W X
int\\X [
[\\[ \
]\\\ ]
idsTransaccion\\^ l
,\\l m
int\\n q
idUltimoEstado	\\r Ä
,
\\Ä Å
DateTime
\\Ç ä

fechaDesde
\\ã ï
,
\\ï ñ
DateTime
\\ó ü

fechaHasta
\\† ™
,
\\™ ´
int
\\¨ Ø
idAccionNegocio
\\∞ ø
)
\\ø ¿
{]] 	
try^^ 
{__ 
var`` 
Resumen`` 
=`` 
_db`` !
.``! "
Transaccion``" -
.``- .
Where``. 3
(``3 4
sbt``4 7
=>``8 :
sbtaa 
.aa 
fecha_inicioaa 
>=aa  "

fechaDesdeaa# -
&&aa. 0
sbtaa1 4
.aa4 5
fecha_inicioaa5 A
<=aaB D

fechaHastaaaE O
&&aaP R
idsTransaccionaaS a
.aaa b
Containsaab j
(aaj k
sbtaak n
.aan o 
id_tipo_transaccion	aao Ç
)
aaÇ É
&&
aaÑ Ü
sbt
aaá ä
.
aaä ã
id_estado_actual
aaã õ
==
aaú û
idUltimoEstado
aaü ≠
)
aa≠ Æ
.
aaÆ Ø
GroupBybb 
(bb 
tbb 
=>bb 
newbb 
{cc 
tdd 
.dd 
Tipo_transacciondd %
.dd% &
nombredd& ,
,dd, -
idTransaccionff  
=ff! "
tff# $
.ff$ %
id_tipo_transaccionff% 8
,ff8 9
entidadInternahh !
=hh" #
thh$ %
.hh% &
Actor_negocio2hh& 4
.hh4 5
Actorhh5 :
.hh: ;
primer_nombrehh; H
,hhH I
entradaSalidaii  
=ii! "
tii# $
.ii$ %
Tipo_transaccionii% 5
.ii5 62
&Accion_de_negocio_por_tipo_transaccionii6 \
.ii\ ]
FirstOrDefaultii] k
(iik l
ttiil n
=>iio q
ttiir t
.iit u!
id_accion_de_negocio	iiu â
==
iiä å
idAccionNegocio
iiç ú
)
iiú ù
.
iiù û
valor
iiû £
}jj 
)jj 
.jj 
Selectjj 
(jj 
dtjj 
=>jj 
newjj "+
Resumen_Transaccion_Consolidadojj# B
(jjB C
)jjC D
{kk 
EntidadInternann !
=nn" #
dtnn$ &
.nn& '
Keynn' *
.nn* +
entidadInternann+ 9
,nn9 :
IdTipoTransaccionoo $
=oo% &
dtoo' )
.oo) *
Keyoo* -
.oo- .
idTransaccionoo. ;
,oo; <
NombreTransaccionpp $
=pp% &
dtpp' )
.pp) *
Keypp* -
.pp- .
nombrepp. 4
,pp4 5
EntradaSalidaqq  
=qq! "
dtqq# %
.qq% &
Keyqq& )
.qq) *
entradaSalidaqq* 7
,qq7 8
Importerr 
=rr 
dtrr 
.rr  
Sumrr  #
(rr# $
irr$ %
=>rr& (
irr) *
.rr* +
importe_totalrr+ 8
)rr8 9
}ss 
)ss 
;ss 
returntt 
Resumentt 
;tt 
}uu 
catchvv 
(vv 
	Exceptionvv 
evv 
)vv 
{ww 
throwxx 
exx 
;xx 
}yy 
}zz 	
public|| 
IEnumerable|| 
<|| 2
&Resumen_Transaccion_Gasto_Por_Concepto|| A
>||A B:
.ObtenerResumenTransaccionesDeGastosPorConcepto||C q
(||q r
int||r u
idTransaccion	||v É
,
||É Ñ
int
||Ö à
idEstado
||â ë
,
||ë í
DateTime
||ì õ

fechaDesde
||ú ¶
,
||¶ ß
DateTime
||® ∞

fechaHasta
||± ª
)
||ª º
{}} 	
try~~ 
{ 
var
ÄÄ 
Resumen
ÄÄ 
=
ÄÄ 
_db
ÄÄ !
.
ÄÄ! "
Transaccion
ÄÄ" -
.
ÄÄ- .
Where
ÄÄ. 3
(
ÄÄ3 4
t
ÄÄ4 5
=>
ÄÄ6 8
t
ÄÄ9 :
.
ÄÄ: ;
fecha_inicio
ÄÄ; G
>=
ÄÄH J

fechaDesde
ÄÄK U
&&
ÄÄV X
t
ÄÄY Z
.
ÄÄZ [
fecha_inicio
ÄÄ[ g
<=
ÄÄh j

fechaHasta
ÄÄk u
&&
ÄÄv x
t
ÄÄy z
.
ÄÄz {"
id_tipo_transaccionÄÄ{ é
==ÄÄè ë
idTransaccionÄÄí ü
&&ÄÄ† ¢
tÄÄ£ §
.ÄÄ§ • 
id_estado_actualÄÄ• µ
==ÄÄ∂ ∏
idEstadoÄÄπ ¡
)ÄÄ¡ ¬
.ÄÄ¬ √

SelectManyÄÄ√ Õ
(ÄÄÕ Œ
tÄÄŒ œ
=>ÄÄ– “
tÄÄ” ‘
.ÄÄ‘ ’#
Detalle_transaccionÄÄ’ Ë
)ÄÄË È
.
ÅÅ 
Select
ÅÅ 
(
ÅÅ 
dt
ÅÅ 
=>
ÅÅ 
new
ÅÅ "4
&Resumen_Transaccion_Gasto_Por_Concepto
ÅÅ# I
(
ÅÅI J
)
ÅÅJ K
{
ÇÇ 
Fecha
ÉÉ 
=
ÉÉ 
dt
ÉÉ 
.
ÉÉ  
Transaccion
ÉÉ  +
.
ÉÉ+ ,
fecha_inicio
ÉÉ, 8
,
ÉÉ8 9
Serie
ÑÑ 
=
ÑÑ 
dt
ÑÑ 
.
ÑÑ  
Transaccion
ÑÑ  +
.
ÑÑ+ ,
Comprobante
ÑÑ, 7
.
ÑÑ7 8
numero_serie
ÑÑ8 D
,
ÑÑD E
Numero
ÖÖ 
=
ÖÖ 
dt
ÖÖ  
.
ÖÖ  !
Transaccion
ÖÖ! ,
.
ÖÖ, -
Comprobante
ÖÖ- 8
.
ÖÖ8 9
numero
ÖÖ9 ?
,
ÖÖ? @
IdConceptoNegocio
ÜÜ &
=
ÜÜ' (
dt
ÜÜ) +
.
ÜÜ+ ,!
id_concepto_negocio
ÜÜ, ?
,
ÜÜ? @
ConceptoNegocio
áá $
=
áá% &
dt
áá' )
.
áá) *
Concepto_negocio
áá* :
.
áá: ;
nombre
áá; A
,
ááA B
Detalle
àà 
=
àà 
dt
àà !
.
àà! "
detalle
àà" )
,
àà) *
Cantidad
ââ 
=
ââ 
dt
ââ  "
.
ââ" #
cantidad
ââ# +
,
ââ+ ,
Importe
ää 
=
ää 
dt
ää !
.
ää! "
total
ää" '
}
ãã 
)
ãã 
;
ãã 
return
åå 
Resumen
åå 
;
åå 
}
çç 
catch
éé 
(
éé 
	Exception
éé 
e
éé 
)
éé 
{
èè 
throw
êê 
new
êê 
DatosException
êê (
(
êê( )
$str
êê) Y
,
êêY Z
e
êê[ \
)
êê\ ]
;
êê] ^
}
ëë 
}
íí 	
public
îî 
IEnumerable
îî 
<
îî 4
&Resumen_Transaccion_Gasto_Por_Concepto
îî A
>
îîA B<
.ObtenerResumenTransaccionesDeGastosPorConcepto
îîC q
(
îîq r
int
îîr u
idTransaccionîîv É
,îîÉ Ñ
intîîÖ à
idEstadoîîâ ë
,îîë í
intîîì ñ
[îîñ ó
]îîó ò!
idsCentroAtencionîîô ™
,îî™ ´
DateTimeîî¨ ¥

fechaDesdeîîµ ø
,îîø ¿
DateTimeîî¡ …

fechaHastaîî  ‘
)îî‘ ’
{
ïï 	
try
ññ 
{
óó 
var
òò 
Resumen
òò 
=
òò 
_db
òò !
.
òò! "
Transaccion
òò" -
.
òò- .
Where
òò. 3
(
òò3 4
t
òò4 5
=>
òò6 8
t
òò9 :
.
òò: ;
fecha_inicio
òò; G
>=
òòH J

fechaDesde
òòK U
&&
òòV X
t
òòY Z
.
òòZ [
fecha_inicio
òò[ g
<=
òòh j

fechaHasta
òòk u
&&
òòv x
t
òòy z
.
òòz {"
id_tipo_transaccionòò{ é
==òòè ë
idTransaccionòòí ü
&&òò† ¢!
idsCentroAtencionòò£ ¥
.òò¥ µ
Containsòòµ Ω
(òòΩ æ
tòòæ ø
.òòø ¿(
id_actor_negocio_internoòò¿ ÿ
)òòÿ Ÿ
&&òò⁄ ‹
tòò› ﬁ
.òòﬁ ﬂ 
id_estado_actualòòﬂ Ô
==òò Ú
idEstadoòòÛ ˚
)òò˚ ¸
.òò¸ ˝

SelectManyòò˝ á
(òòá à
tòòà â
=>òòä å
tòòç é
.òòé è#
Detalle_transaccionòòè ¢
)òò¢ £
.
ôô 
Select
ôô 
(
ôô 
dt
ôô 
=>
ôô 
new
ôô  #4
&Resumen_Transaccion_Gasto_Por_Concepto
ôô$ J
(
ôôJ K
)
ôôK L
{
öö 
Fecha
õõ 
=
õõ 
dt
õõ  
.
õõ  !
Transaccion
õõ! ,
.
õõ, -
fecha_inicio
õõ- 9
,
õõ9 :
Serie
úú 
=
úú 
dt
úú  
.
úú  !
Transaccion
úú! ,
.
úú, -
Comprobante
úú- 8
.
úú8 9
numero_serie
úú9 E
,
úúE F
Numero
ùù 
=
ùù 
dt
ùù !
.
ùù! "
Transaccion
ùù" -
.
ùù- .
Comprobante
ùù. 9
.
ùù9 :
numero
ùù: @
,
ùù@ A
IdConceptoNegocio
ûû '
=
ûû( )
dt
ûû* ,
.
ûû, -!
id_concepto_negocio
ûû- @
,
ûû@ A
ConceptoNegocio
üü %
=
üü& '
dt
üü( *
.
üü* +
Concepto_negocio
üü+ ;
.
üü; <
nombre
üü< B
,
üüB C
Cantidad
†† 
=
††  
dt
††! #
.
††# $
cantidad
††$ ,
,
††, -
Importe
°° 
=
°° 
dt
°°  "
.
°°" #
total
°°# (
}
¢¢ 
)
¢¢ 
;
¢¢ 
return
££ 
Resumen
££ 
;
££ 
}
§§ 
catch
•• 
(
•• 
	Exception
•• 
e
•• 
)
•• 
{
¶¶ 
throw
ßß 
new
ßß 
DatosException
ßß (
(
ßß( )
$str
ßß) Y
,
ßßY Z
e
ßß[ \
)
ßß\ ]
;
ßß] ^
}
®® 
}
©© 	
public
´´ 
IEnumerable
´´ 
<
´´ ?
1TransaccionAgrupadoPorSerieConNumeracionInicioFin
´´ L
>
´´L M3
%ObtenerTransaccionesAgrupadasPorSerie
´´N s
(
´´s t
int
´´t w
[
´´w x
]
´´x y 
idsPuntosDeVentas´´z ã
,´´ã å
int´´ç ê
[´´ê ë
]´´ë í#
idsTiposTransaccion´´ì ¶
,´´¶ ß
int´´® ´
idUltimoEstado´´¨ ∫
,´´∫ ª
DateTime´´º ƒ

fechaDesde´´≈ œ
,´´œ –
DateTime´´— Ÿ

fechaHasta´´⁄ ‰
)´´‰ Â
{
¨¨ 	
try
≠≠ 
{
ÆÆ 
var
±± 
Resumen
±± 
=
±± 
_db
±± !
.
±±! "
Transaccion
±±" -
.
±±- .
Where
±±. 3
(
±±3 4
t
±±4 5
=>
±±6 8
t
±±9 :
.
±±: ;
fecha_inicio
±±; G
>=
±±H J

fechaDesde
±±K U
&&
±±V X
t
±±Y Z
.
±±Z [
fecha_inicio
±±[ g
<=
±±h j

fechaHasta
±±k u
&&
±±v x"
idsTiposTransaccion±±y å
.±±å ç
Contains±±ç ï
(±±ï ñ
t±±ñ ó
.±±ó ò#
id_tipo_transaccion±±ò ´
)±±´ ¨
&&
≤≤ 
idsPuntosDeVentas
≤≤ $
.
≤≤$ %
Contains
≤≤% -
(
≤≤- .
t
≤≤. /
.
≤≤/ 0&
id_actor_negocio_interno
≤≤0 H
)
≤≤H I
&&
≥≥ 
t
≥≥ 
.
≥≥ 
id_estado_actual
≥≥ %
==
≥≥& (
idUltimoEstado
≥≥) 7
)
≥≥7 8
.
µµ 
GroupBy
µµ 
(
µµ 
t
µµ 
=>
µµ 
new
µµ 
{
∂∂ 
t
∑∑ 
.
∑∑ 
Comprobante
∑∑ 
.
∑∑  !
id_tipo_comprobante
∑∑  3
,
∑∑3 4
t
∏∏ 
.
∏∏ 
Comprobante
∏∏ 
.
∏∏  
Detalle_maestro
∏∏  /
.
∏∏/ 0
valor
∏∏0 5
,
∏∏5 6
t
ππ 
.
ππ 
Comprobante
ππ 
.
ππ  
numero_serie
ππ  ,
}
∫∫ 
)
∫∫ 
.
∫∫ 
Select
∫∫ 
(
∫∫ 
t
∫∫ 
=>
∫∫ 
new
∫∫  ?
1TransaccionAgrupadoPorSerieConNumeracionInicioFin
∫∫! R
(
∫∫R S
)
∫∫S T
{
ªª 
IdTipoComprobante
ºº #
=
ºº$ %
t
ºº& '
.
ºº' (
Key
ºº( +
.
ºº+ ,!
id_tipo_comprobante
ºº, ?
,
ºº? @"
NombreCortoDocumento
ΩΩ &
=
ΩΩ' (
t
ΩΩ) *
.
ΩΩ* +
Key
ΩΩ+ .
.
ΩΩ. /
valor
ΩΩ/ 4
,
ΩΩ4 5
Serie
ææ 
=
ææ 
t
ææ 
.
ææ 
Key
ææ 
.
ææ  
numero_serie
ææ  ,
,
ææ, -
NumeroInicial
øø 
=
øø  !
t
øø" #
.
øø# $
Min
øø$ '
(
øø' (
a
øø( )
=>
øø* ,
a
øø- .
.
øø. /
Comprobante
øø/ :
.
øø: ;
numero
øø; A
)
øøA B
,
øøB C
NumeroFinal
¿¿ 
=
¿¿ 
t
¿¿  !
.
¿¿! "
Max
¿¿" %
(
¿¿% &
a
¿¿& '
=>
¿¿( *
a
¿¿+ ,
.
¿¿, -
Comprobante
¿¿- 8
.
¿¿8 9
numero
¿¿9 ?
)
¿¿? @
,
¿¿@ A

ValorVenta
¡¡ 
=
¡¡ 
t
¡¡  
.
¡¡  !

SelectMany
¡¡! +
(
¡¡+ ,
dt
¡¡, .
=>
¡¡/ 1
dt
¡¡2 4
.
¡¡4 5!
Detalle_transaccion
¡¡5 H
)
¡¡H I
.
¡¡I J
Sum
¡¡J M
(
¡¡M N
dt
¡¡N P
=>
¡¡Q S
dt
¡¡T V
.
¡¡V W
total
¡¡W \
)
¡¡\ ]
,
¡¡] ^
Igv
¬¬ 
=
¬¬ 
t
¬¬ 
.
¬¬ 

SelectMany
¬¬ $
(
¬¬$ %
dt
¬¬% '
=>
¬¬( *
dt
¬¬+ -
.
¬¬- .!
Detalle_transaccion
¬¬. A
)
¬¬A B
.
¬¬B C
Sum
¬¬C F
(
¬¬F G
dt
¬¬G I
=>
¬¬J L
dt
¬¬M O
.
¬¬O P
igv
¬¬P S
)
¬¬S T
,
¬¬T U
Icbpers
√√ 
=
√√ 
t
√√ 
.
√√ 

SelectMany
√√ (
(
√√( )
pt
√√) +
=>
√√, .
pt
√√/ 1
.
√√1 2#
Parametro_transaccion
√√2 G
)
√√G H
.
√√H I
Where
√√I N
(
√√N O
pt
√√O Q
=>
√√R T
pt
√√U W
.
√√W X
id_parametro
√√X d
==
√√e g
MaestroSettings
√√h w
.
√√w x
Default
√√x 
.√√ Ä/
IdDetalleMaestroParametroIcbper√√Ä ü
)√√ü †
.√√† °
Select√√° ß
(√√ß ®
pt√√® ™
=>√√´ ≠
pt√√Æ ∞
.√√∞ ±
valor√√± ∂
)√√∂ ∑
,√√∑ ∏
Importe
ƒƒ 
=
ƒƒ 
t
ƒƒ 
.
ƒƒ 
Sum
ƒƒ !
(
ƒƒ! "
i
ƒƒ" #
=>
ƒƒ$ &
i
ƒƒ' (
.
ƒƒ( )
importe_total
ƒƒ) 6
)
ƒƒ6 7
}
≈≈ 
)
≈≈ 
;
≈≈ 
return
∆∆ 
Resumen
∆∆ 
;
∆∆ 
}
«« 
catch
»» 
(
»» 
	Exception
»» 
e
»» 
)
»» 
{
…… 
throw
   
new
   
DatosException
   (
(
  ( )
$str
  ) I
,
  I J
e
  K L
)
  L M
;
  M N
}
ÀÀ 
}
ÃÃ 	
public
ŒŒ 
IEnumerable
ŒŒ 
<
ŒŒ A
3TransaccionAgrupadoPorSerieConNumeracionConcatenada
ŒŒ N
>
ŒŒN O4
&ObtenerTransaccionesAgrupadasPorSerie_
ŒŒP v
(
ŒŒv w
int
ŒŒw z
[
ŒŒz {
]
ŒŒ{ | 
idsPuntosDeVentasŒŒ} é
,ŒŒé è
intŒŒê ì
[ŒŒì î
]ŒŒî ï"
idsTipoTransaccionŒŒñ ®
,ŒŒ® ©
intŒŒ™ ≠$
idEstadoQueDebeTenerŒŒÆ ¬
,ŒŒ¬ √
DateTimeŒŒƒ Ã

fechaDesdeŒŒÕ ◊
,ŒŒ◊ ÿ
DateTimeŒŒŸ ·

fechaHastaŒŒ‚ Ï
)ŒŒÏ Ì
{
œœ 	
try
–– 
{
—— 
var
““ 
Resumen
““ 
=
““ 
_db
““ !
.
““! "
Transaccion
““" -
.
““- .
Where
““. 3
(
““3 4
sbt
““4 7
=>
““8 :
sbt
““; >
.
““> ?
fecha_inicio
““? K
>=
““L N

fechaDesde
““O Y
&&
““Z \
sbt
““] `
.
““` a
fecha_inicio
““a m
<=
““n p

fechaHasta
““q {
&&
““| ~!
idsTipoTransaccion““ ë
.““ë í
Contains““í ö
(““ö õ
sbt““õ û
.““û ü#
id_tipo_transaccion““ü ≤
)““≤ ≥
&&““¥ ∂!
idsPuntosDeVentas““∑ »
.““» …
Contains““… —
(““— “
sbt“““ ’
.““’ ÷(
id_actor_negocio_interno““÷ Ó
)““Ó Ô
&&
”” 
sbt
”” 
.
””  
Estado_transaccion
”” )
.
””) *
Select
””* 0
(
””0 1
et
””1 3
=>
””4 6
et
””7 9
.
””9 :
	id_estado
””: C
)
””C D
.
””D E
Contains
””E M
(
””M N"
idEstadoQueDebeTener
””N b
)
””b c
)
‘‘ 
.
’’ 
GroupBy
’’ 
(
’’ 
t
’’ 
=>
’’ 
new
’’ 
{
÷÷ 
t
◊◊ 
.
◊◊ 
Comprobante
◊◊ 
.
◊◊  "
id_serie_comprobante
◊◊  4
,
◊◊4 5
t
ÿÿ 
.
ÿÿ 
Comprobante
ÿÿ 
.
ÿÿ  
numero_serie
ÿÿ  ,
,
ÿÿ, -
t
ŸŸ 
.
ŸŸ 
Comprobante
ŸŸ 
.
ŸŸ  
Detalle_maestro
ŸŸ  /
.
ŸŸ/ 0
valor
ŸŸ0 5
}
⁄⁄ 
)
⁄⁄ 
.
⁄⁄ 
Select
⁄⁄ 
(
⁄⁄ 
t
⁄⁄ 
=>
⁄⁄ 
new
⁄⁄  A
3TransaccionAgrupadoPorSerieConNumeracionConcatenada
⁄⁄! T
(
⁄⁄T U
)
⁄⁄U V
{
€€ "
NombreCortoDocumento
‹‹ &
=
‹‹' (
t
‹‹) *
.
‹‹* +
Key
‹‹+ .
.
‹‹. /
valor
‹‹/ 4
,
‹‹4 5
Serie
›› 
=
›› 
t
›› 
.
›› 
Key
›› 
.
››  
numero_serie
››  ,
,
››, -!
NumerosComprobantes
ﬁﬁ %
=
ﬁﬁ& '
t
ﬁﬁ( )
.
ﬁﬁ) *
Select
ﬁﬁ* 0
(
ﬁﬁ0 1
_dt
ﬁﬁ1 4
=>
ﬁﬁ5 7
(
ﬁﬁ8 9
int
ﬁﬁ9 <
)
ﬁﬁ< =
_dt
ﬁﬁ= @
.
ﬁﬁ@ A
Comprobante
ﬁﬁA L
.
ﬁﬁL M
numero
ﬁﬁM S
)
ﬁﬁS T
.
ﬁﬁT U
Distinct
ﬁﬁU ]
(
ﬁﬁ] ^
)
ﬁﬁ^ _
,
ﬁﬁ_ `
ImporteSinIcbper
ﬂﬂ "
=
ﬂﬂ# $
t
ﬂﬂ% &
.
ﬂﬂ& '

SelectMany
ﬂﬂ' 1
(
ﬂﬂ1 2
dt
ﬂﬂ2 4
=>
ﬂﬂ5 7
dt
ﬂﬂ8 :
.
ﬂﬂ: ;!
Detalle_transaccion
ﬂﬂ; N
)
ﬂﬂN O
.
ﬂﬂO P
Sum
ﬂﬂP S
(
ﬂﬂS T
dt
ﬂﬂT V
=>
ﬂﬂW Y
dt
ﬂﬂZ \
.
ﬂﬂ\ ]
total
ﬂﬂ] b
)
ﬂﬂb c
,
ﬂﬂc d
Icbpers
‡‡ 
=
‡‡ 
t
‡‡ 
.
‡‡ 

SelectMany
‡‡ (
(
‡‡( )
pt
‡‡) +
=>
‡‡, .
pt
‡‡/ 1
.
‡‡1 2#
Parametro_transaccion
‡‡2 G
)
‡‡G H
.
‡‡H I
Where
‡‡I N
(
‡‡N O
pt
‡‡O Q
=>
‡‡R T
pt
‡‡U W
.
‡‡W X
id_parametro
‡‡X d
==
‡‡e g
MaestroSettings
‡‡h w
.
‡‡w x
Default
‡‡x 
.‡‡ Ä/
IdDetalleMaestroParametroIcbper‡‡Ä ü
)‡‡ü †
.‡‡† °
Select‡‡° ß
(‡‡ß ®
pt‡‡® ™
=>‡‡´ ≠
pt‡‡Æ ∞
.‡‡∞ ±
valor‡‡± ∂
)‡‡∂ ∑
,‡‡∑ ∏
}
·· 
)
·· 
;
·· 
return
‚‚ 
Resumen
‚‚ 
;
‚‚ 
}
‰‰ 
catch
ÂÂ 
(
ÂÂ 
	Exception
ÂÂ 
e
ÂÂ 
)
ÂÂ 
{
ÊÊ 
throw
ÁÁ 
new
ÁÁ 
DatosException
ÁÁ (
(
ÁÁ( )
$str
ÁÁ) I
,
ÁÁI J
e
ÁÁK L
)
ÁÁL M
;
ÁÁM N
}
ËË 
}
ÈÈ 	
public
ÏÏ 
IEnumerable
ÏÏ 
<
ÏÏ ?
1TransaccionAgrupadoPorSerieConNumeracionInicioFin
ÏÏ L
>
ÏÏL MF
7ObtenerTransaccionesAgrupadasPorSeriePorIntervaloDiarioÏÏN Ö
(ÏÏÖ Ü
intÏÏÜ â
[ÏÏâ ä
]ÏÏä ã!
idsPuntosDeVentasÏÏå ù
,ÏÏù û
intÏÏü ¢
[ÏÏ¢ £
]ÏÏ£ §#
idsTiposTransaccionÏÏ• ∏
,ÏÏ∏ π
intÏÏ∫ Ω
idUltimoEstadoÏÏæ Ã
,ÏÏÃ Õ
DateTimeÏÏŒ ÷

fechaDesdeÏÏ◊ ·
,ÏÏ· ‚
DateTimeÏÏ„ Î

fechaHastaÏÏÏ ˆ
)ÏÏˆ ˜
{
ÌÌ 	
try
ÓÓ 
{
ÔÔ 
TimeSpan
 
	horadesde
 "
=
# $
new
% (
TimeSpan
) 1
(
1 2

fechaDesde
2 <
.
< =
Hour
= A
,
A B

fechaDesde
C M
.
M N
Minute
N T
,
T U

fechaDesde
V `
.
` a
Second
a g
)
g h
;
h i
TimeSpan
ÒÒ 
	horahasta
ÒÒ "
=
ÒÒ# $
new
ÒÒ% (
TimeSpan
ÒÒ) 1
(
ÒÒ1 2

fechaHasta
ÒÒ2 <
.
ÒÒ< =
Hour
ÒÒ= A
,
ÒÒA B

fechaHasta
ÒÒC M
.
ÒÒM N
Minute
ÒÒN T
,
ÒÒT U

fechaHasta
ÒÒV `
.
ÒÒ` a
Second
ÒÒa g
)
ÒÒg h
;
ÒÒh i
var
ÛÛ 
Resumen
ÛÛ 
=
ÛÛ 
_db
ÛÛ !
.
ÛÛ! "
Transaccion
ÛÛ" -
.
ÛÛ- .
Where
ÛÛ. 3
(
ÛÛ3 4
sbt
ÛÛ4 7
=>
ÛÛ8 :
sbt
ÛÛ; >
.
ÛÛ> ?
fecha_inicio
ÛÛ? K
>=
ÛÛL N

fechaDesde
ÛÛO Y
&&
ÛÛZ \
sbt
ÛÛ] `
.
ÛÛ` a
fecha_inicio
ÛÛa m
<=
ÛÛn p

fechaHasta
ÛÛq {
&&
ÛÛ| ~"
idsTiposTransaccionÛÛ í
.ÛÛí ì
ContainsÛÛì õ
(ÛÛõ ú
sbtÛÛú ü
.ÛÛü †#
id_tipo_transaccionÛÛ† ≥
)ÛÛ≥ ¥
&&
ÙÙ 
idsPuntosDeVentas
ÙÙ $
.
ÙÙ$ %
Contains
ÙÙ% -
(
ÙÙ- .
sbt
ÙÙ. 1
.
ÙÙ1 2&
id_actor_negocio_interno
ÙÙ2 J
)
ÙÙJ K
&&
ıı 
sbt
ıı 
.
ıı 
id_estado_actual
ıı '
==
ıı( *
idUltimoEstado
ıı+ 9
&&
ˆˆ 
DbFunctions
ˆˆ 
.
ˆˆ 

CreateTime
ˆˆ )
(
ˆˆ) *
sbt
ˆˆ* -
.
ˆˆ- .
fecha_inicio
ˆˆ. :
.
ˆˆ: ;
Hour
ˆˆ; ?
,
ˆˆ? @
sbt
ˆˆA D
.
ˆˆD E
fecha_inicio
ˆˆE Q
.
ˆˆQ R
Minute
ˆˆR X
,
ˆˆX Y
sbt
ˆˆZ ]
.
ˆˆ] ^
fecha_inicio
ˆˆ^ j
.
ˆˆj k
Second
ˆˆk q
)
ˆˆq r
>=
ˆˆs u
	horadesde
ˆˆv 
&&
˜˜ 
DbFunctions
˜˜ 
.
˜˜ 

CreateTime
˜˜ )
(
˜˜) *
sbt
˜˜* -
.
˜˜- .
fecha_inicio
˜˜. :
.
˜˜: ;
Hour
˜˜; ?
,
˜˜? @
sbt
˜˜A D
.
˜˜D E
fecha_inicio
˜˜E Q
.
˜˜Q R
Minute
˜˜R X
,
˜˜X Y
sbt
˜˜Z ]
.
˜˜] ^
fecha_inicio
˜˜^ j
.
˜˜j k
Second
˜˜k q
)
˜˜q r
<=
˜˜s u
	horahasta
˜˜v 
)˜˜ Ä
.
˘˘ 
GroupBy
˘˘ 
(
˘˘ 
t
˘˘ 
=>
˘˘ 
new
˘˘ 
{
˙˙ 
t
˚˚ 
.
˚˚ 
Comprobante
˚˚ 
.
˚˚  !
id_tipo_comprobante
˚˚  3
,
˚˚3 4
t
¸¸ 
.
¸¸ 
Comprobante
¸¸ 
.
¸¸  
Detalle_maestro
¸¸  /
.
¸¸/ 0
valor
¸¸0 5
,
¸¸5 6
t
˝˝ 
.
˝˝ 
Comprobante
˝˝ 
.
˝˝  
numero_serie
˝˝  ,
}
˛˛ 
)
˛˛ 
.
˛˛ 
Select
˛˛ 
(
˛˛ 
t
˛˛ 
=>
˛˛ 
new
˛˛  ?
1TransaccionAgrupadoPorSerieConNumeracionInicioFin
˛˛! R
(
˛˛R S
)
˛˛S T
{
ˇˇ 
IdTipoComprobante
ÄÄ #
=
ÄÄ$ %
t
ÄÄ& '
.
ÄÄ' (
Key
ÄÄ( +
.
ÄÄ+ ,!
id_tipo_comprobante
ÄÄ, ?
,
ÄÄ? @"
NombreCortoDocumento
ÅÅ &
=
ÅÅ' (
t
ÅÅ) *
.
ÅÅ* +
Key
ÅÅ+ .
.
ÅÅ. /
valor
ÅÅ/ 4
,
ÅÅ4 5
Serie
ÇÇ 
=
ÇÇ 
t
ÇÇ 
.
ÇÇ 
Key
ÇÇ 
.
ÇÇ  
numero_serie
ÇÇ  ,
,
ÇÇ, -
NumeroInicial
ÉÉ 
=
ÉÉ  !
t
ÉÉ" #
.
ÉÉ# $
Min
ÉÉ$ '
(
ÉÉ' (
a
ÉÉ( )
=>
ÉÉ* ,
a
ÉÉ- .
.
ÉÉ. /
Comprobante
ÉÉ/ :
.
ÉÉ: ;
numero
ÉÉ; A
)
ÉÉA B
,
ÉÉB C
NumeroFinal
ÑÑ 
=
ÑÑ 
t
ÑÑ  !
.
ÑÑ! "
Max
ÑÑ" %
(
ÑÑ% &
a
ÑÑ& '
=>
ÑÑ( *
a
ÑÑ+ ,
.
ÑÑ, -
Comprobante
ÑÑ- 8
.
ÑÑ8 9
numero
ÑÑ9 ?
)
ÑÑ? @
,
ÑÑ@ A

ValorVenta
ÖÖ 
=
ÖÖ 
t
ÖÖ  
.
ÖÖ  !

SelectMany
ÖÖ! +
(
ÖÖ+ ,
dt
ÖÖ, .
=>
ÖÖ/ 1
dt
ÖÖ2 4
.
ÖÖ4 5!
Detalle_transaccion
ÖÖ5 H
)
ÖÖH I
.
ÖÖI J
Sum
ÖÖJ M
(
ÖÖM N
dt
ÖÖN P
=>
ÖÖQ S
dt
ÖÖT V
.
ÖÖV W
total
ÖÖW \
)
ÖÖ\ ]
,
ÖÖ] ^
Igv
ÜÜ 
=
ÜÜ 
t
ÜÜ 
.
ÜÜ 

SelectMany
ÜÜ $
(
ÜÜ$ %
dt
ÜÜ% '
=>
ÜÜ( *
dt
ÜÜ+ -
.
ÜÜ- .!
Detalle_transaccion
ÜÜ. A
)
ÜÜA B
.
ÜÜB C
Sum
ÜÜC F
(
ÜÜF G
dt
ÜÜG I
=>
ÜÜJ L
dt
ÜÜM O
.
ÜÜO P
igv
ÜÜP S
)
ÜÜS T
,
ÜÜT U
Icbpers
áá 
=
áá 
t
áá 
.
áá 

SelectMany
áá (
(
áá( )
pt
áá) +
=>
áá, .
pt
áá/ 1
.
áá1 2#
Parametro_transaccion
áá2 G
)
ááG H
.
ááH I
Where
ááI N
(
ááN O
pt
ááO Q
=>
ááR T
pt
ááU W
.
ááW X
id_parametro
ááX d
==
ááe g
MaestroSettings
ááh w
.
ááw x
Default
ááx 
.áá Ä/
IdDetalleMaestroParametroIcbperááÄ ü
)ááü †
.áá† °
Selectáá° ß
(ááß ®
ptáá® ™
=>áá´ ≠
ptááÆ ∞
.áá∞ ±
valoráá± ∂
)áá∂ ∑
,áá∑ ∏
Importe
àà 
=
àà 
t
àà 
.
àà 
Sum
àà !
(
àà! "
i
àà" #
=>
àà$ &
i
àà' (
.
àà( )
importe_total
àà) 6
)
àà6 7
}
ââ 
)
ââ 
;
ââ 
return
ää 
Resumen
ää 
;
ää 
}
ãã 
catch
åå 
(
åå 
	Exception
åå 
e
åå 
)
åå 
{
çç 
throw
éé 
new
éé 
DatosException
éé (
(
éé( )
$str
éé) I
,
ééI J
e
ééK L
)
ééL M
;
ééM N
}
èè 
}
êê 	
public
ëë 
IEnumerable
ëë 
<
ëë A
3TransaccionAgrupadoPorSerieConNumeracionConcatenada
ëë N
>
ëëN OG
8ObtenerTransaccionesAgrupadasPorSeriePorIntervaloDiario_ëëP à
(ëëà â
intëëâ å
[ëëå ç
]ëëç é!
idsPuntosDeVentasëëè †
,ëë† °
intëë¢ •
[ëë• ¶
]ëë¶ ß"
idsTipoTransaccionëë® ∫
,ëë∫ ª
intëëº ø$
idEstadoQueDebeTenerëë¿ ‘
,ëë‘ ’
DateTimeëë÷ ﬁ

fechaDesdeëëﬂ È
,ëëÈ Í
DateTimeëëÎ Û

fechaHastaëëÙ ˛
)ëë˛ ˇ
{
íí 	
try
ìì 
{
îî 
TimeSpan
ïï 
	horadesde
ïï "
=
ïï# $
new
ïï% (
TimeSpan
ïï) 1
(
ïï1 2

fechaDesde
ïï2 <
.
ïï< =
Hour
ïï= A
,
ïïA B

fechaDesde
ïïC M
.
ïïM N
Minute
ïïN T
,
ïïT U

fechaDesde
ïïV `
.
ïï` a
Second
ïïa g
)
ïïg h
;
ïïh i
TimeSpan
ññ 
	horahasta
ññ "
=
ññ# $
new
ññ% (
TimeSpan
ññ) 1
(
ññ1 2

fechaHasta
ññ2 <
.
ññ< =
Hour
ññ= A
,
ññA B

fechaHasta
ññC M
.
ññM N
Minute
ññN T
,
ññT U

fechaHasta
ññV `
.
ññ` a
Second
ñña g
)
ññg h
;
ññh i
var
òò 
Resumen
òò 
=
òò 
_db
òò !
.
òò! "
Transaccion
òò" -
.
òò- .
Where
òò. 3
(
òò3 4
sbt
òò4 7
=>
òò8 :
sbt
òò; >
.
òò> ?
fecha_inicio
òò? K
>=
òòL N

fechaDesde
òòO Y
&&
òòZ \
sbt
òò] `
.
òò` a
fecha_inicio
òòa m
<=
òòn p

fechaHasta
òòq {
&&
òò| ~!
idsTipoTransaccionòò ë
.òòë í
Containsòòí ö
(òòö õ
sbtòòõ û
.òòû ü#
id_tipo_transaccionòòü ≤
)òò≤ ≥
&&òò¥ ∂!
idsPuntosDeVentasòò∑ »
.òò» …
Containsòò… —
(òò— “
sbtòò“ ’
.òò’ ÷(
id_actor_negocio_internoòò÷ Ó
)òòÓ Ô
&&
ôô 
sbt
ôô 
.
ôô  
Estado_transaccion
ôô )
.
ôô) *
Select
ôô* 0
(
ôô0 1
et
ôô1 3
=>
ôô4 6
et
ôô7 9
.
ôô9 :
	id_estado
ôô: C
)
ôôC D
.
ôôD E
Contains
ôôE M
(
ôôM N"
idEstadoQueDebeTener
ôôN b
)
ôôb c
&&
öö 
DbFunctions
öö 
.
öö 

CreateTime
öö )
(
öö) *
sbt
öö* -
.
öö- .
fecha_inicio
öö. :
.
öö: ;
Hour
öö; ?
,
öö? @
sbt
ööA D
.
ööD E
fecha_inicio
ööE Q
.
ööQ R
Minute
ööR X
,
ööX Y
sbt
ööZ ]
.
öö] ^
fecha_inicio
öö^ j
.
ööj k
Second
öök q
)
ööq r
>=
öös u
	horadesde
ööv 
&&
õõ 
DbFunctions
õõ 
.
õõ 

CreateTime
õõ )
(
õõ) *
sbt
õõ* -
.
õõ- .
fecha_inicio
õõ. :
.
õõ: ;
Hour
õõ; ?
,
õõ? @
sbt
õõA D
.
õõD E
fecha_inicio
õõE Q
.
õõQ R
Minute
õõR X
,
õõX Y
sbt
õõZ ]
.
õõ] ^
fecha_inicio
õõ^ j
.
õõj k
Second
õõk q
)
õõq r
<=
õõs u
	horahasta
õõv 
)
úú 
.
ùù 
GroupBy
ùù 
(
ùù 
t
ùù 
=>
ùù 
new
ùù 
{
ûû 
t
üü 
.
üü 
Comprobante
üü 
.
üü  "
id_serie_comprobante
üü  4
,
üü4 5
t
†† 
.
†† 
Comprobante
†† 
.
††  
numero_serie
††  ,
,
††, -
t
°° 
.
°° 
Comprobante
°° 
.
°°  
Detalle_maestro
°°  /
.
°°/ 0
valor
°°0 5
,
°°5 6
}
¢¢ 
)
¢¢ 
.
¢¢ 
Select
¢¢ 
(
¢¢ 
t
¢¢ 
=>
¢¢ 
new
¢¢  A
3TransaccionAgrupadoPorSerieConNumeracionConcatenada
¢¢! T
(
¢¢T U
)
¢¢U V
{
££ "
NombreCortoDocumento
§§ &
=
§§' (
t
§§) *
.
§§* +
Key
§§+ .
.
§§. /
valor
§§/ 4
,
§§4 5
Serie
•• 
=
•• 
t
•• 
.
•• 
Key
•• 
.
••  
numero_serie
••  ,
,
••, -!
NumerosComprobantes
¶¶ %
=
¶¶& '
t
¶¶( )
.
¶¶) *
Select
¶¶* 0
(
¶¶0 1
_dt
¶¶1 4
=>
¶¶5 7
(
¶¶8 9
int
¶¶9 <
)
¶¶< =
_dt
¶¶= @
.
¶¶@ A
Comprobante
¶¶A L
.
¶¶L M
numero
¶¶M S
)
¶¶S T
.
¶¶T U
Distinct
¶¶U ]
(
¶¶] ^
)
¶¶^ _
,
¶¶_ `
ImporteSinIcbper
ßß "
=
ßß# $
t
ßß% &
.
ßß& '

SelectMany
ßß' 1
(
ßß1 2
dt
ßß2 4
=>
ßß5 7
dt
ßß8 :
.
ßß: ;!
Detalle_transaccion
ßß; N
)
ßßN O
.
ßßO P
Sum
ßßP S
(
ßßS T
dt
ßßT V
=>
ßßW Y
dt
ßßZ \
.
ßß\ ]
total
ßß] b
)
ßßb c
,
ßßc d
Icbpers
®® 
=
®® 
t
®® 
.
®® 

SelectMany
®® (
(
®®( )
pt
®®) +
=>
®®, .
pt
®®/ 1
.
®®1 2#
Parametro_transaccion
®®2 G
)
®®G H
.
®®H I
Where
®®I N
(
®®N O
pt
®®O Q
=>
®®R T
pt
®®U W
.
®®W X
id_parametro
®®X d
==
®®e g
MaestroSettings
®®h w
.
®®w x
Default
®®x 
.®® Ä/
IdDetalleMaestroParametroIcbper®®Ä ü
)®®ü †
.®®† °
Select®®° ß
(®®ß ®
pt®®® ™
=>®®´ ≠
pt®®Æ ∞
.®®∞ ±
valor®®± ∂
)®®∂ ∑
,®®∑ ∏
}
™™ 
)
™™ 
;
™™ 
return
´´ 
Resumen
´´ 
;
´´ 
}
≠≠ 
catch
ÆÆ 
(
ÆÆ 
	Exception
ÆÆ 
e
ÆÆ 
)
ÆÆ 
{
ØØ 
throw
∞∞ 
new
∞∞ 
DatosException
∞∞ (
(
∞∞( )
$str
∞∞) I
,
∞∞I J
e
∞∞K L
)
∞∞L M
;
∞∞M N
}
±± 
}
≤≤ 	
public
∂∂ 
IEnumerable
∂∂ 
<
∂∂ A
3TransaccionAgrupadoPorSerieConNumeracionConcatenada
∂∂ N
>
∂∂N O3
%ObtenerTransaccionesAgrupadasPorSerie
∂∂P u
(
∂∂u v
int
∂∂v y
[
∂∂y z
]
∂∂z { 
idsPuntosDeVentas∂∂| ç
,∂∂ç é
int∂∂è í!
idTipoTransaccion∂∂ì §
,∂∂§ •
int∂∂¶ ©
idUltimoEstado∂∂™ ∏
,∂∂∏ π
DateTime∂∂∫ ¬

fechaDesde∂∂√ Õ
,∂∂Õ Œ
DateTime∂∂œ ◊

fechaHasta∂∂ÿ ‚
)∂∂‚ „
{
∑∑ 	
try
∏∏ 
{
ππ 
var
∫∫ 
Resumen
∫∫ 
=
∫∫ 
_db
∫∫ !
.
∫∫! "
Transaccion
∫∫" -
.
∫∫- .
Where
∫∫. 3
(
∫∫3 4
sbt
∫∫4 7
=>
∫∫8 :
sbt
∫∫; >
.
∫∫> ?
fecha_inicio
∫∫? K
>=
∫∫L N

fechaDesde
∫∫O Y
&&
∫∫Z \
sbt
∫∫] `
.
∫∫` a
fecha_inicio
∫∫a m
<=
∫∫n p

fechaHasta
∫∫q {
&&
∫∫| ~
sbt∫∫ Ç
.∫∫Ç É#
id_tipo_transaccion∫∫É ñ
==∫∫ó ô!
idTipoTransaccion∫∫ö ´
&&∫∫¨ Æ!
idsPuntosDeVentas∫∫Ø ¿
.∫∫¿ ¡
Contains∫∫¡ …
(∫∫…  
sbt∫∫  Õ
.∫∫Õ Œ(
id_actor_negocio_interno∫∫Œ Ê
)∫∫Ê Á
&&
ªª 
sbt
ªª 
.
ªª 
id_estado_actual
ªª (
==
ªª) +
idUltimoEstado
ªª, :
)
ªª: ;
.
ΩΩ 
GroupBy
ΩΩ 
(
ΩΩ 
t
ΩΩ 
=>
ΩΩ 
new
ΩΩ 
{
ææ 
t
øø 
.
øø 
Comprobante
øø 
.
øø  "
id_serie_comprobante
øø  4
,
øø4 5
t
¿¿ 
.
¿¿ 
Comprobante
¿¿ 
.
¿¿  
numero_serie
¿¿  ,
,
¿¿, -
t
¡¡ 
.
¡¡ 
Comprobante
¡¡ 
.
¡¡  
Detalle_maestro
¡¡  /
.
¡¡/ 0
valor
¡¡0 5
}
¬¬ 
)
¬¬ 
.
¬¬ 
Select
¬¬ 
(
¬¬ 
t
¬¬ 
=>
¬¬ 
new
¬¬  A
3TransaccionAgrupadoPorSerieConNumeracionConcatenada
¬¬! T
(
¬¬T U
)
¬¬U V
{
√√ "
NombreCortoDocumento
ƒƒ &
=
ƒƒ' (
t
ƒƒ) *
.
ƒƒ* +
Key
ƒƒ+ .
.
ƒƒ. /
valor
ƒƒ/ 4
,
ƒƒ4 5
Serie
≈≈ 
=
≈≈ 
t
≈≈ 
.
≈≈ 
Key
≈≈ 
.
≈≈  
numero_serie
≈≈  ,
,
≈≈, -!
NumerosComprobantes
∆∆ %
=
∆∆& '
t
∆∆( )
.
∆∆) *
Select
∆∆* 0
(
∆∆0 1
_dt
∆∆1 4
=>
∆∆5 7
(
∆∆8 9
int
∆∆9 <
)
∆∆< =
_dt
∆∆= @
.
∆∆@ A
Comprobante
∆∆A L
.
∆∆L M
numero
∆∆M S
)
∆∆S T
,
∆∆T U
ImporteSinIcbper
»» "
=
»»# $
t
»»% &
.
»»& '

SelectMany
»»' 1
(
»»1 2
dt
»»2 4
=>
»»5 7
dt
»»8 :
.
»»: ;!
Detalle_transaccion
»»; N
)
»»N O
.
»»O P
Sum
»»P S
(
»»S T
dt
»»T V
=>
»»W Y
dt
»»Z \
.
»»\ ]
total
»»] b
)
»»b c
,
»»c d
Icbpers
…… 
=
…… 
t
…… 
.
…… 

SelectMany
…… (
(
……( )
pt
……) +
=>
……, .
pt
……/ 1
.
……1 2#
Parametro_transaccion
……2 G
)
……G H
.
……H I
Where
……I N
(
……N O
pt
……O Q
=>
……R T
pt
……U W
.
……W X
id_parametro
……X d
==
……e g
MaestroSettings
……h w
.
……w x
Default
……x 
.…… Ä/
IdDetalleMaestroParametroIcbper……Ä ü
)……ü †
.……† °
Select……° ß
(……ß ®
pt……® ™
=>……´ ≠
pt……Æ ∞
.……∞ ±
valor……± ∂
)……∂ ∑
,……∑ ∏
}
   
)
   
;
   
return
ÀÀ 
Resumen
ÀÀ 
;
ÀÀ 
}
ÕÕ 
catch
ŒŒ 
(
ŒŒ 
	Exception
ŒŒ 
e
ŒŒ 
)
ŒŒ 
{
œœ 
throw
–– 
new
–– 
DatosException
–– (
(
––( )
$str
––) I
,
––I J
e
––K L
)
––L M
;
––M N
}
—— 
}
““ 	
public
‘‘ 
IEnumerable
‘‘ 
<
‘‘ =
/TransaccionPorSerieDeComprobanteYConceptoBasico
‘‘ J
>
‘‘J KG
8ObtenerTransaccionesPorSerieDeComprobanteYConceptoBasico‘‘L Ñ
(‘‘Ñ Ö
int‘‘Ö à
[‘‘à â
]‘‘â ä!
idsPuntosDeVentas‘‘ã ú
,‘‘ú ù
int‘‘û °
[‘‘° ¢
]‘‘¢ £#
idsTiposTransaccion‘‘§ ∑
,‘‘∑ ∏
DateTime‘‘π ¡

fechaDesde‘‘¬ Ã
,‘‘Ã Õ
DateTime‘‘Œ ÷

fechaHasta‘‘◊ ·
,‘‘· ‚
int‘‘„ Ê
idUltimoEstado‘‘Á ı
)‘‘ı ˆ
{
’’ 	
try
÷÷ 
{
◊◊ 
var
ÿÿ 
Resumen
ÿÿ 
=
ÿÿ 
_db
ÿÿ !
.
ÿÿ! "
Transaccion
ÿÿ" -
.
ÿÿ- .
Where
ÿÿ. 3
(
ÿÿ3 4
t
ÿÿ4 5
=>
ÿÿ6 8
t
ÿÿ9 :
.
ÿÿ: ;
fecha_inicio
ÿÿ; G
>=
ÿÿH J

fechaDesde
ÿÿK U
&&
ÿÿV X
t
ÿÿY Z
.
ÿÿZ [
fecha_inicio
ÿÿ[ g
<=
ÿÿh j

fechaHasta
ÿÿk u
&&
ŸŸ !
idsTiposTransaccion
ŸŸ &
.
ŸŸ& '
Contains
ŸŸ' /
(
ŸŸ/ 0
t
ŸŸ0 1
.
ŸŸ1 2!
id_tipo_transaccion
ŸŸ2 E
)
ŸŸE F
&&
⁄⁄ 
idsPuntosDeVentas
⁄⁄ $
.
⁄⁄$ %
Contains
⁄⁄% -
(
⁄⁄- .
t
⁄⁄. /
.
⁄⁄/ 0&
id_actor_negocio_interno
⁄⁄0 H
)
⁄⁄H I
&&
€€ 
t
€€ 
.
€€ 
id_estado_actual
€€ %
==
€€& (
idUltimoEstado
€€) 7
)
‹‹ 
.
›› 

SelectMany
›› 
(
›› 
t
›› 
=>
››  
t
››! "
.
››" #!
Detalle_transaccion
››# 6
)
››6 7
.
››7 8
GroupBy
ﬁﬁ 
(
ﬁﬁ 
dt
ﬁﬁ 
=>
ﬁﬁ 
new
ﬁﬁ 
{
ﬂﬂ 
dt
·· 
.
·· 
Transaccion
··  
.
··  !
Comprobante
··! ,
.
··, -!
id_tipo_comprobante
··- @
,
··@ A
dt
‚‚ 
.
‚‚ 
Transaccion
‚‚  
.
‚‚  !
Comprobante
‚‚! ,
.
‚‚, -
Detalle_maestro
‚‚- <
.
‚‚< =
valor
‚‚= B
,
‚‚B C
dt
‰‰ 
.
‰‰ 
Transaccion
‰‰  
.
‰‰  !
Comprobante
‰‰! ,
.
‰‰, -
numero_serie
‰‰- 9
,
‰‰9 :
IdConceptoBasico
ÂÂ "
=
ÂÂ# $
dt
ÂÂ% '
.
ÂÂ' (
Concepto_negocio
ÂÂ( 8
.
ÂÂ8 9 
id_concepto_basico
ÂÂ9 K
,
ÂÂK L"
NombreConceptoBasico
ÊÊ &
=
ÊÊ' (
dt
ÊÊ) +
.
ÊÊ+ ,
Concepto_negocio
ÊÊ, <
.
ÊÊ< =
Detalle_maestro4
ÊÊ= M
.
ÊÊM N
nombre
ÊÊN T
}
ÁÁ 
)
ÁÁ 
.
ÁÁ 
Select
ÁÁ 
(
ÁÁ 
dt
ÁÁ 
=>
ÁÁ 
new
ÁÁ !=
/TransaccionPorSerieDeComprobanteYConceptoBasico
ÁÁ" Q
(
ÁÁQ R
)
ÁÁR S
{
ËË 
IdTipoComprobante
ÈÈ #
=
ÈÈ$ %
dt
ÈÈ& (
.
ÈÈ( )
Key
ÈÈ) ,
.
ÈÈ, -!
id_tipo_comprobante
ÈÈ- @
,
ÈÈ@ A$
NombreCortoComprobante
ÍÍ (
=
ÍÍ) *
dt
ÍÍ+ -
.
ÍÍ- .
Key
ÍÍ. 1
.
ÍÍ1 2
valor
ÍÍ2 7
,
ÍÍ7 8
Serie
ÎÎ 
=
ÎÎ 
dt
ÎÎ 
.
ÎÎ 
Key
ÎÎ  
.
ÎÎ  !
numero_serie
ÎÎ! -
,
ÎÎ- .
ConceptoBasico
ÏÏ  
=
ÏÏ! "
dt
ÏÏ# %
.
ÏÏ% &
Key
ÏÏ& )
.
ÏÏ) *"
NombreConceptoBasico
ÏÏ* >
,
ÏÏ> ?
Cantidad
ÌÌ 
=
ÌÌ 
dt
ÌÌ 
.
ÌÌ  
Sum
ÌÌ  #
(
ÌÌ# $
c
ÌÌ$ %
=>
ÌÌ& (
c
ÌÌ) *
.
ÌÌ* +
cantidad
ÌÌ+ 3
)
ÌÌ3 4
,
ÌÌ4 5
Importe
ÓÓ 
=
ÓÓ 
dt
ÓÓ 
.
ÓÓ 
Sum
ÓÓ "
(
ÓÓ" #
i
ÓÓ# $
=>
ÓÓ% '
i
ÓÓ( )
.
ÓÓ) *
total
ÓÓ* /
)
ÓÓ/ 0
}
ÔÔ 
)
ÔÔ 
;
ÔÔ 
return
 
Resumen
 
;
 
}
ÚÚ 
catch
ÛÛ 
(
ÛÛ 
	Exception
ÛÛ 
e
ÛÛ 
)
ÛÛ 
{
ÙÙ 
throw
ıı 
new
ıı 
DatosException
ıı (
(
ıı( )
$str
ıı) I
,
ııI J
e
ııK L
)
ııL M
;
ııM N
}
ˆˆ 
}
˜˜ 	
public
˘˘ 
IEnumerable
˘˘ 
<
˘˘ =
/TransaccionPorSerieDeComprobanteYConceptoBasico
˘˘ J
>
˘˘J KG
8ObtenerTransaccionesPorSerieDeComprobanteYConceptoBasico˘˘L Ñ
(˘˘Ñ Ö
int˘˘Ö à
[˘˘à â
]˘˘â ä!
idsPuntosDeVentas˘˘ã ú
,˘˘ú ù
int˘˘û °
[˘˘° ¢
]˘˘¢ £#
idsTiposTransaccion˘˘§ ∑
,˘˘∑ ∏
int˘˘π º
idEstadoActual˘˘Ω À
,˘˘À Ã
DateTime˘˘Õ ’

fechaDesde˘˘÷ ‡
,˘˘‡ ·
DateTime˘˘‚ Í

fechaHasta˘˘Î ı
)˘˘ı ˆ
{
˙˙ 	
try
˚˚ 
{
¸¸ 
var
˝˝ 
Resumen
˝˝ 
=
˝˝ 
_db
˝˝ !
.
˝˝! "
Transaccion
˝˝" -
.
˝˝- .
Where
˝˝. 3
(
˝˝3 4
t
˝˝4 5
=>
˝˝6 8
t
˝˝9 :
.
˝˝: ;
fecha_inicio
˝˝; G
>=
˝˝H J

fechaDesde
˝˝K U
&&
˝˝V X
t
˝˝Y Z
.
˝˝Z [
fecha_inicio
˝˝[ g
<=
˝˝h j

fechaHasta
˝˝k u
&&
˛˛ !
idsTiposTransaccion
˛˛ &
.
˛˛& '
Contains
˛˛' /
(
˛˛/ 0
t
˛˛0 1
.
˛˛1 2!
id_tipo_transaccion
˛˛2 E
)
˛˛E F
&&
ˇˇ 
idsPuntosDeVentas
ˇˇ $
.
ˇˇ$ %
Contains
ˇˇ% -
(
ˇˇ- .
t
ˇˇ. /
.
ˇˇ/ 0&
id_actor_negocio_interno
ˇˇ0 H
)
ˇˇH I
&&
ÄÄ 
t
ÄÄ 
.
ÄÄ 
id_estado_actual
ÄÄ %
==
ÄÄ& (
idEstadoActual
ÄÄ) 7
)
ÄÄ7 8
.
ÅÅ 

SelectMany
ÅÅ 
(
ÅÅ 
t
ÅÅ 
=>
ÅÅ  
t
ÅÅ! "
.
ÅÅ" #!
Detalle_transaccion
ÅÅ# 6
)
ÅÅ6 7
.
ÅÅ7 8
GroupBy
ÇÇ 
(
ÇÇ 
dt
ÇÇ 
=>
ÇÇ 
new
ÇÇ !
{
ÉÉ 
dt
ÖÖ 
.
ÖÖ 
Transaccion
ÖÖ "
.
ÖÖ" #
Comprobante
ÖÖ# .
.
ÖÖ. /!
id_tipo_comprobante
ÖÖ/ B
,
ÖÖB C
dt
ÜÜ 
.
ÜÜ 
Transaccion
ÜÜ "
.
ÜÜ" #
Comprobante
ÜÜ# .
.
ÜÜ. /
Detalle_maestro
ÜÜ/ >
.
ÜÜ> ?
valor
ÜÜ? D
,
ÜÜD E
dt
àà 
.
àà 
Transaccion
àà "
.
àà" #
Comprobante
àà# .
.
àà. /
numero_serie
àà/ ;
,
àà; <
IdConceptoBasico
ââ $
=
ââ% &
dt
ââ' )
.
ââ) *
Concepto_negocio
ââ* :
.
ââ: ; 
id_concepto_basico
ââ; M
,
ââM N"
NombreConceptoBasico
ää (
=
ää) *
dt
ää+ -
.
ää- .
Concepto_negocio
ää. >
.
ää> ?
Detalle_maestro4
ää? O
.
ääO P
nombre
ääP V
}
ãã 
)
ãã 
.
ãã 
Select
ãã 
(
ãã 
dt
ãã 
=>
ãã 
new
ãã  #=
/TransaccionPorSerieDeComprobanteYConceptoBasico
ãã$ S
(
ããS T
)
ããT U
{
åå 
IdTipoComprobante
çç %
=
çç& '
dt
çç( *
.
çç* +
Key
çç+ .
.
çç. /!
id_tipo_comprobante
çç/ B
,
ççB C$
NombreCortoComprobante
éé *
=
éé+ ,
dt
éé- /
.
éé/ 0
Key
éé0 3
.
éé3 4
valor
éé4 9
,
éé9 :
Serie
èè 
=
èè 
dt
èè 
.
èè 
Key
èè "
.
èè" #
numero_serie
èè# /
,
èè/ 0
ConceptoBasico
êê "
=
êê# $
dt
êê% '
.
êê' (
Key
êê( +
.
êê+ ,"
NombreConceptoBasico
êê, @
,
êê@ A
Cantidad
ëë 
=
ëë 
dt
ëë !
.
ëë! "
Sum
ëë" %
(
ëë% &
c
ëë& '
=>
ëë( *
c
ëë+ ,
.
ëë, -
cantidad
ëë- 5
)
ëë5 6
,
ëë6 7
Importe
íí 
=
íí 
dt
íí  
.
íí  !
Sum
íí! $
(
íí$ %
i
íí% &
=>
íí' )
i
íí* +
.
íí+ ,
total
íí, 1
)
íí1 2
}
ìì 
)
ìì 
;
ìì 
return
îî 
Resumen
îî 
;
îî 
}
ññ 
catch
óó 
(
óó 
	Exception
óó 
e
óó 
)
óó 
{
òò 
throw
ôô 
new
ôô 
DatosException
ôô (
(
ôô( )
$str
ôô) I
,
ôôI J
e
ôôK L
)
ôôL M
;
ôôM N
}
õõ 
}
úú 	
public
ûû 
IEnumerable
ûû 
<
ûû 
Transaccion
ûû &
>
ûû& 'H
:ObtenerTransaccionesInclusiveActoresYDetalleMaestroYEstado
ûû( b
(
ûûb c
int
ûûc f
idPuntoDeVenta
ûûg u
,
ûûu v
int
ûûw z 
idTipoTransaccionûû{ å
,ûûå ç
DateTimeûûé ñ

fechaDesdeûûó °
,ûû° ¢
intûû£ ¶
idUltimoEstadoûûß µ
,ûûµ ∂
DateTimeûû∑ ø

fechaHastaûû¿  
)ûû  À
{
üü 	
try
†† 
{
°° 
var
¢¢ 
Resumen
¢¢ 
=
¢¢ 
_db
¢¢ !
.
¢¢! "
Transaccion
¢¢" -
.
¢¢- .
Where
¢¢. 3
(
¢¢3 4
sbt
¢¢4 7
=>
¢¢8 :
sbt
¢¢; >
.
¢¢> ?
fecha_inicio
¢¢? K
>=
¢¢L N

fechaDesde
¢¢O Y
&&
¢¢Z \
sbt
¢¢] `
.
¢¢` a
fecha_inicio
¢¢a m
<=
¢¢n p

fechaHasta
¢¢q {
&&
¢¢| ~
sbt¢¢ Ç
.¢¢Ç É#
id_tipo_transaccion¢¢É ñ
==¢¢ó ô!
idTipoTransaccion¢¢ö ´
&&¢¢¨ Æ
sbt¢¢Ø ≤
.¢¢≤ ≥(
id_actor_negocio_interno¢¢≥ À
==¢¢Ã Œ
idPuntoDeVenta¢¢œ ›
&&
££ 
sbt
££ 
.
££ 
id_estado_actual
££ '
==
££( *
idUltimoEstado
££+ 9
)
§§ 
;
§§ 
return
•• 
Resumen
•• 
;
•• 
}
¶¶ 
catch
ßß 
(
ßß 
	Exception
ßß 
e
ßß 
)
ßß 
{
®® 
throw
©© 
new
©© 
DatosException
©© (
(
©©( )
$str
©©) I
,
©©I J
e
©©K L
)
©©L M
;
©©M N
}
´´ 
}
¨¨ 	
public
ÆÆ 
IEnumerable
ÆÆ 
<
ÆÆ 
Transaccion
ÆÆ &
>
ÆÆ& 'I
;ObtenerTransaccionesInclusiveActoresYDetalleMaestroYEstado_
ÆÆ( c
(
ÆÆc d
int
ÆÆd g
idPuntoDeVenta
ÆÆh v
,
ÆÆv w
int
ÆÆx { 
idTipoTransaccionÆÆ| ç
,ÆÆç é
intÆÆè í
idUltimoEstadoÆÆì °
,ÆÆ° ¢
DateTimeÆÆ£ ´

fechaDesdeÆÆ¨ ∂
,ÆÆ∂ ∑
DateTimeÆÆ∏ ¿

fechaHastaÆÆ¡ À
)ÆÆÀ Ã
{
ØØ 	
try
∞∞ 
{
±± 
var
≤≤ 
Resumen
≤≤ 
=
≤≤ 
_db
≤≤ !
.
≤≤! "
Transaccion
≤≤" -
.
≤≤- .
Where
≤≤. 3
(
≤≤3 4
sbt
≤≤4 7
=>
≤≤8 :
sbt
≤≤; >
.
≤≤> ?
fecha_inicio
≤≤? K
>=
≤≤L N

fechaDesde
≤≤O Y
&&
≤≤Z \
sbt
≤≤] `
.
≤≤` a
fecha_inicio
≤≤a m
<=
≤≤n p

fechaHasta
≤≤q {
&&
≤≤| ~
sbt≤≤ Ç
.≤≤Ç É#
id_tipo_transaccion≤≤É ñ
==≤≤ó ô!
idTipoTransaccion≤≤ö ´
&&≤≤¨ Æ
idPuntoDeVenta≤≤Ø Ω
==≤≤æ ¿
sbt≤≤¡ ƒ
.≤≤ƒ ≈(
id_actor_negocio_interno≤≤≈ ›
&&
≥≥ 
sbt
≥≥ 
.
≥≥ 
id_estado_actual
≥≥ )
==
≥≥* ,
idUltimoEstado
≥≥- ;
)
≥≥; <
;
≥≥< =
return
¥¥ 
Resumen
¥¥ 
;
¥¥ 
}
µµ 
catch
∂∂ 
(
∂∂ 
	Exception
∂∂ 
e
∂∂ 
)
∂∂ 
{
∑∑ 
throw
∏∏ 
new
∏∏ 
DatosException
∏∏ (
(
∏∏( )
$str
∏∏) I
,
∏∏I J
e
∏∏K L
)
∏∏L M
;
∏∏M N
}
ππ 
}
∫∫ 	
public
ºº 
IEnumerable
ºº 
<
ºº <
.Resumen_Transaccion_Por_Serie_y_ConceptoBasico
ºº I
>
ººI JP
AObtenerResumenTransaccionesInclusiveActoresYDetalleMaestroYEstadoººK å
(ººå ç
intººç ê
idPuntoDeVentaººë ü
,ººü †
intºº° §!
idTipoTransaccionºº• ∂
,ºº∂ ∑
DateTimeºº∏ ¿

fechaDesdeºº¡ À
,ººÀ Ã
DateTimeººÕ ’

fechaHastaºº÷ ‡
,ºº‡ ·
intºº‚ Â
idUltimoEstadoººÊ Ù
)ººÙ ı
{
ΩΩ 	
try
ææ 
{
øø 
var
¿¿ 
Resumen
¿¿ 
=
¿¿ 
_db
¿¿ !
.
¿¿! "
Transaccion
¿¿" -
.
¿¿- .
Where
¿¿. 3
(
¿¿3 4
sbt
¿¿4 7
=>
¿¿8 :
sbt
¿¿; >
.
¿¿> ?
fecha_inicio
¿¿? K
>=
¿¿L N

fechaDesde
¿¿O Y
&&
¿¿Z \
sbt
¿¿] `
.
¿¿` a
fecha_inicio
¿¿a m
<=
¿¿n p

fechaHasta
¿¿q {
&&
¿¿| ~
sbt¿¿ Ç
.¿¿Ç É#
id_tipo_transaccion¿¿É ñ
==¿¿ó ô!
idTipoTransaccion¿¿ö ´
&&¿¿¨ Æ
idPuntoDeVenta¿¿Ø Ω
==¿¿æ ¿
sbt¿¿¡ ƒ
.¿¿ƒ ≈(
id_actor_negocio_interno¿¿≈ ›
&&
¬¬ 
sbt
¬¬ 
.
¬¬ 
id_estado_actual
¬¬ '
==
¬¬( *
idUltimoEstado
¬¬+ 9
)
√√ 
.
√√ 

SelectMany
√√ 
(
√√ 
t
√√ 
=>
√√  
t
√√! "
.
√√" #!
Detalle_transaccion
√√# 6
)
√√6 7
.
√√7 8
GroupBy
ƒƒ 
(
ƒƒ 
dt
ƒƒ 
=>
ƒƒ 
new
ƒƒ 
{
≈≈ 
dt
∆∆ 
.
∆∆ 
Transaccion
∆∆  
.
∆∆  !
Comprobante
∆∆! ,
.
∆∆, -"
id_serie_comprobante
∆∆- A
,
∆∆A B
dt
«« 
.
«« 
Transaccion
««  
.
««  !
Comprobante
««! ,
.
««, -
numero_serie
««- 9
,
««9 :
dt
»» 
.
»» 
Transaccion
»»  
.
»»  !
Comprobante
»»! ,
.
»», -
Detalle_maestro
»»- <
.
»»< =
valor
»»= B
,
»»B C
IdConceptoBasico
…… "
=
……# $
dt
……% '
.
……' (
Concepto_negocio
……( 8
.
……8 9 
id_concepto_basico
……9 K
,
……K L"
NombreConceptoBasico
   &
=
  ' (
dt
  ) +
.
  + ,
Concepto_negocio
  , <
.
  < =
Detalle_maestro4
  = M
.
  M N
nombre
  N T
}
ÀÀ 
)
ÀÀ 
.
ÀÀ 
Select
ÀÀ 
(
ÀÀ 
dt
ÀÀ 
=>
ÀÀ 
new
ÀÀ !<
.Resumen_Transaccion_Por_Serie_y_ConceptoBasico
ÀÀ" P
(
ÀÀP Q
)
ÀÀQ R
{
ÃÃ 
IdSerie
ÕÕ 
=
ÕÕ 
dt
ÕÕ 
.
ÕÕ 
Key
ÕÕ "
.
ÕÕ" #"
id_serie_comprobante
ÕÕ# 7
.
ÕÕ7 8
Value
ÕÕ8 =
,
ÕÕ= >
Serie
ŒŒ 
=
ŒŒ 
dt
ŒŒ 
.
ŒŒ 
Key
ŒŒ  
.
ŒŒ  !
numero_serie
ŒŒ! -
,
ŒŒ- ."
NombreCortoDocumento
œœ &
=
œœ' (
dt
œœ) +
.
œœ+ ,
Key
œœ, /
.
œœ/ 0
valor
œœ0 5
,
œœ5 6
ConceptoBasico
––  
=
––! "
dt
––# %
.
––% &
Key
––& )
.
––) *"
NombreConceptoBasico
––* >
,
––> ?
Cantidad
—— 
=
—— 
dt
—— 
.
——  
Sum
——  #
(
——# $
c
——$ %
=>
——& (
c
——) *
.
——* +
cantidad
——+ 3
)
——3 4
,
——4 5
Importe
““ 
=
““ 
dt
““ 
.
““ 
Sum
““ "
(
““" #
i
““# $
=>
““% '
i
““( )
.
““) *
total
““* /
)
““/ 0
}
”” 
)
”” 
;
”” 
return
‘‘ 
Resumen
‘‘ 
;
‘‘ 
}
’’ 
catch
÷÷ 
(
÷÷ 
	Exception
÷÷ 
e
÷÷ 
)
÷÷ 
{
◊◊ 
throw
◊◊ 
e
◊◊ 
;
◊◊ 
}
◊◊ 
}
ÿÿ 	
public
⁄⁄ 
IEnumerable
⁄⁄ 
<
⁄⁄ <
.Resumen_Transaccion_Por_Serie_y_ConceptoBasico
⁄⁄ I
>
⁄⁄I JP
AObtenerResumenTransaccionesInclusiveActoresYDetalleMaestroYEstado⁄⁄K å
(⁄⁄å ç
int⁄⁄ç ê
idPuntoDeVenta⁄⁄ë ü
,⁄⁄ü †
int⁄⁄° §!
idTipoTransaccion⁄⁄• ∂
,⁄⁄∂ ∑
int⁄⁄∏ ª
idUltimoEstado⁄⁄º  
,⁄⁄  À
DateTime⁄⁄Ã ‘

fechaDesde⁄⁄’ ﬂ
,⁄⁄ﬂ ‡
DateTime⁄⁄· È

fechaHasta⁄⁄Í Ù
)⁄⁄Ù ı
{
€€ 	
try
‹‹ 
{
›› 
var
ﬁﬁ 
Resumen
ﬁﬁ 
=
ﬁﬁ 
_db
ﬁﬁ !
.
ﬁﬁ! "
Transaccion
ﬁﬁ" -
.
ﬁﬁ- .
Where
ﬁﬁ. 3
(
ﬁﬁ3 4
sbt
ﬁﬁ4 7
=>
ﬁﬁ8 :
sbt
ﬁﬁ; >
.
ﬁﬁ> ?
fecha_inicio
ﬁﬁ? K
>=
ﬁﬁL N

fechaDesde
ﬁﬁO Y
&&
ﬁﬁZ \
sbt
ﬁﬁ] `
.
ﬁﬁ` a
fecha_inicio
ﬁﬁa m
<=
ﬁﬁn p

fechaHasta
ﬁﬁq {
&&
ﬁﬁ| ~
sbtﬁﬁ Ç
.ﬁﬁÇ É#
id_tipo_transaccionﬁﬁÉ ñ
==ﬁﬁó ô!
idTipoTransaccionﬁﬁö ´
&&ﬁﬁ¨ Æ
idPuntoDeVentaﬁﬁØ Ω
==ﬁﬁæ ¿
sbtﬁﬁ¡ ƒ
.ﬁﬁƒ ≈(
id_actor_negocio_internoﬁﬁ≈ ›
&&
ﬂﬂ 
sbt
ﬂﬂ 
.
ﬂﬂ 
id_estado_actual
ﬂﬂ (
==
ﬂﬂ) +
idUltimoEstado
ﬂﬂ, :
)
ﬂﬂ: ;
.
‡‡ 

SelectMany
‡‡ 
(
‡‡ 
t
‡‡ 
=>
‡‡  
t
‡‡! "
.
‡‡" #!
Detalle_transaccion
‡‡# 6
)
‡‡6 7
.
‡‡7 8
GroupBy
·· 
(
·· 
dt
·· 
=>
·· 
new
·· 
{
‚‚ 
dt
„„ 
.
„„ 
Transaccion
„„  
.
„„  !
Comprobante
„„! ,
.
„„, -"
id_serie_comprobante
„„- A
,
„„A B
dt
‰‰ 
.
‰‰ 
Transaccion
‰‰  
.
‰‰  !
Comprobante
‰‰! ,
.
‰‰, -
numero_serie
‰‰- 9
,
‰‰9 :
dt
ÂÂ 
.
ÂÂ 
Transaccion
ÂÂ  
.
ÂÂ  !
Comprobante
ÂÂ! ,
.
ÂÂ, -
Detalle_maestro
ÂÂ- <
.
ÂÂ< =
valor
ÂÂ= B
,
ÂÂB C
IdConceptoBasico
ÊÊ "
=
ÊÊ# $
dt
ÊÊ% '
.
ÊÊ' (
Concepto_negocio
ÊÊ( 8
.
ÊÊ8 9 
id_concepto_basico
ÊÊ9 K
,
ÊÊK L"
NombreConceptoBasico
ÁÁ &
=
ÁÁ' (
dt
ÁÁ) +
.
ÁÁ+ ,
Concepto_negocio
ÁÁ, <
.
ÁÁ< =
Detalle_maestro4
ÁÁ= M
.
ÁÁM N
nombre
ÁÁN T
}
ËË 
)
ËË 
.
ËË 
Select
ËË 
(
ËË 
dt
ËË 
=>
ËË 
new
ËË !<
.Resumen_Transaccion_Por_Serie_y_ConceptoBasico
ËË" P
(
ËËP Q
)
ËËQ R
{
ÈÈ 
IdSerie
ÍÍ 
=
ÍÍ 
dt
ÍÍ 
.
ÍÍ 
Key
ÍÍ "
.
ÍÍ" #"
id_serie_comprobante
ÍÍ# 7
.
ÍÍ7 8
Value
ÍÍ8 =
,
ÍÍ= >
Serie
ÎÎ 
=
ÎÎ 
dt
ÎÎ 
.
ÎÎ 
Key
ÎÎ  
.
ÎÎ  !
numero_serie
ÎÎ! -
,
ÎÎ- ."
NombreCortoDocumento
ÏÏ &
=
ÏÏ' (
dt
ÏÏ) +
.
ÏÏ+ ,
Key
ÏÏ, /
.
ÏÏ/ 0
valor
ÏÏ0 5
,
ÏÏ5 6
ConceptoBasico
ÌÌ  
=
ÌÌ! "
dt
ÌÌ# %
.
ÌÌ% &
Key
ÌÌ& )
.
ÌÌ) *"
NombreConceptoBasico
ÌÌ* >
,
ÌÌ> ?
Cantidad
ÓÓ 
=
ÓÓ 
dt
ÓÓ 
.
ÓÓ  
Sum
ÓÓ  #
(
ÓÓ# $
c
ÓÓ$ %
=>
ÓÓ& (
c
ÓÓ) *
.
ÓÓ* +
cantidad
ÓÓ+ 3
)
ÓÓ3 4
,
ÓÓ4 5
Importe
ÔÔ 
=
ÔÔ 
dt
ÔÔ 
.
ÔÔ 
Sum
ÔÔ "
(
ÔÔ" #
i
ÔÔ# $
=>
ÔÔ% '
i
ÔÔ( )
.
ÔÔ) *
total
ÔÔ* /
)
ÔÔ/ 0
}
 
)
 
;
 
return
ÒÒ 
Resumen
ÒÒ 
;
ÒÒ 
}
ÚÚ 
catch
ÛÛ 
(
ÛÛ 
	Exception
ÛÛ 
e
ÛÛ 
)
ÛÛ 
{
ÙÙ 
throw
ıı 
e
ıı 
;
ıı 
}
ˆˆ 
}
˜˜ 	
public
˘˘ 
IEnumerable
˘˘ 
<
˘˘ >
0Resumen_Transaccion_Por_Serie_y_Concepto_Negocio
˘˘ K
>
˘˘K Li
ZObtenerResumenPorSerieYConceptoNegocioTransaccionesInclusiveActoresYDetalleMaestroYEstados˘˘M ß
(˘˘ß ®
int˘˘® ´
idPuntoDeVenta˘˘¨ ∫
,˘˘∫ ª
int˘˘º ø!
idTipoTransaccion˘˘¿ —
,˘˘— “
int˘˘” ÷
idUltimoEstado˘˘◊ Â
,˘˘Â Ê
DateTime˘˘Á Ô

fechaDesde˘˘ ˙
,˘˘˙ ˚
DateTime˘˘¸ Ñ

fechaHasta˘˘Ö è
)˘˘è ê
{
˙˙ 	
try
˚˚ 
{
¸¸ 
var
˝˝ 
Resumen
˝˝ 
=
˝˝ 
_db
˝˝ !
.
˝˝! "
Transaccion
˝˝" -
.
˝˝- .
Where
˝˝. 3
(
˝˝3 4
sbt
˝˝4 7
=>
˝˝8 :
sbt
˝˝; >
.
˝˝> ?
fecha_inicio
˝˝? K
>=
˝˝L N

fechaDesde
˝˝O Y
&&
˝˝Z \
sbt
˝˝] `
.
˝˝` a
fecha_inicio
˝˝a m
<=
˝˝n p

fechaHasta
˝˝q {
&&
˝˝| ~
sbt˝˝ Ç
.˝˝Ç É#
id_tipo_transaccion˝˝É ñ
==˝˝ó ô!
idTipoTransaccion˝˝ö ´
&&˝˝¨ Æ
idPuntoDeVenta˝˝Ø Ω
==˝˝æ ¿
sbt˝˝¡ ƒ
.˝˝ƒ ≈(
id_actor_negocio_interno˝˝≈ ›
&&˝˝ﬁ ‡
sbt˝˝· ‰
.˝˝‰ Â 
id_estado_actual˝˝Â ı
==˝˝ˆ ¯
idUltimoEstado˝˝˘ á
)
˛˛ 
.
˛˛ 

SelectMany
˛˛ 
(
˛˛ 
t
˛˛ 
=>
˛˛  
t
˛˛! "
.
˛˛" #!
Detalle_transaccion
˛˛# 6
)
˛˛6 7
.
˛˛7 8
GroupBy
ˇˇ 
(
ˇˇ 
dt
ˇˇ 
=>
ˇˇ 
new
ˇˇ 
{
ÄÄ 
dt
ÅÅ 
.
ÅÅ 
Transaccion
ÅÅ  
.
ÅÅ  !
Comprobante
ÅÅ! ,
.
ÅÅ, -"
id_serie_comprobante
ÅÅ- A
,
ÅÅA B
dt
ÇÇ 
.
ÇÇ 
Transaccion
ÇÇ  
.
ÇÇ  !
Comprobante
ÇÇ! ,
.
ÇÇ, -
numero_serie
ÇÇ- 9
,
ÇÇ9 :
dt
ÉÉ 
.
ÉÉ !
id_concepto_negocio
ÉÉ (
,
ÉÉ( )
dt
ÑÑ 
.
ÑÑ 
Concepto_negocio
ÑÑ %
.
ÑÑ% &
nombre
ÑÑ& ,
,
ÑÑ, -
dt
ÖÖ 
.
ÖÖ 
Concepto_negocio
ÖÖ %
.
ÖÖ% &
codigo_barra
ÖÖ& 2
,
ÖÖ2 3
dt
ÜÜ 
.
ÜÜ 
Transaccion
ÜÜ  
.
ÜÜ  !
Comprobante
ÜÜ! ,
.
ÜÜ, -
Detalle_maestro
ÜÜ- <
.
ÜÜ< =
valor
ÜÜ= B
,
ÜÜB C
precioUnitario
áá  
=
áá! "
dt
áá# %
.
áá% &
precio_unitario
áá& 5
}
ââ 
)
ââ 
.
ââ 
Select
ââ 
(
ââ 
dt
ââ 
=>
ââ 
new
ââ !>
0Resumen_Transaccion_Por_Serie_y_Concepto_Negocio
ââ" R
(
ââR S
)
ââS T
{
ää 
IdSerie
ãã 
=
ãã 
dt
ãã 
.
ãã 
Key
ãã "
.
ãã" #"
id_serie_comprobante
ãã# 7
.
ãã7 8
Value
ãã8 =
,
ãã= >
Serie
åå 
=
åå 
dt
åå 
.
åå 
Key
åå  
.
åå  !
numero_serie
åå! -
,
åå- .
CodigoBarra
çç 
=
çç 
dt
çç  "
.
çç" #
Key
çç# &
.
çç& '
codigo_barra
çç' 3
,
çç3 4
IdConceptoNegocio
éé #
=
éé$ %
dt
éé& (
.
éé( )
Key
éé) ,
.
éé, -!
id_concepto_negocio
éé- @
,
éé@ A
ConceptoNegocio
èè !
=
èè" #
dt
èè$ &
.
èè& '
Key
èè' *
.
èè* +
nombre
èè+ 1
,
èè1 2"
NombreCortoDocumento
êê &
=
êê' (
dt
êê) +
.
êê+ ,
Key
êê, /
.
êê/ 0
valor
êê0 5
,
êê5 6
Cantidad
ëë 
=
ëë 
dt
ëë 
.
ëë  
Sum
ëë  #
(
ëë# $
c
ëë$ %
=>
ëë& (
c
ëë) *
.
ëë* +
cantidad
ëë+ 3
)
ëë3 4
,
ëë4 5
Importe
íí 
=
íí 
dt
íí 
.
íí 
Sum
íí "
(
íí" #
i
íí# $
=>
íí% '
i
íí( )
.
íí) *
total
íí* /
)
íí/ 0
}
ìì 
)
ìì 
;
ìì 
return
îî 
Resumen
îî 
.
îî 
OrderBy
îî &
(
îî& '
r
îî' (
=>
îî) +
r
îî, -
.
îî- .
CodigoBarra
îî. 9
??
îî: <
r
îî= >
.
îî> ?
ConceptoNegocio
îî? N
)
îîN O
;
îîO P
}
ïï 
catch
ññ 
(
ññ 
	Exception
ññ 
e
ññ 
)
ññ 
{
óó 
throw
óó 
e
óó 
;
óó 
}
óó 
}
òò 	
public
öö 
IEnumerable
öö 
<
öö <
.Resumen_Transaccion_Por_Serie_y_ConceptoBasico
öö I
>
ööI Jh
YObtenerResumenPorSerieYConceptoBasicoTransaccionesInclusiveActoresYDetalleMaestroYEstadosööK §
(öö§ •
intöö• ®
idPuntoDeVentaöö© ∑
,öö∑ ∏
intööπ º!
idTipoTransaccionööΩ Œ
,ööŒ œ
intöö– ”
idUltimoEstadoöö‘ ‚
,öö‚ „
DateTimeöö‰ Ï

fechaDesdeööÌ ˜
,öö˜ ¯
DateTimeöö˘ Å

fechaHastaööÇ å
)ööå ç
{
õõ 	
try
úú 
{
ùù 
var
ûû 
Resumen
ûû 
=
ûû 
_db
ûû !
.
ûû! "
Transaccion
ûû" -
.
ûû- .
Where
ûû. 3
(
ûû3 4
sbt
ûû4 7
=>
ûû8 :
sbt
ûû; >
.
ûû> ?
fecha_inicio
ûû? K
>=
ûûL N

fechaDesde
ûûO Y
&&
ûûZ \
sbt
ûû] `
.
ûû` a
fecha_inicio
ûûa m
<=
ûûn p

fechaHasta
ûûq {
&&
ûû| ~
sbtûû Ç
.ûûÇ É#
id_tipo_transaccionûûÉ ñ
==ûûó ô!
idTipoTransaccionûûö ´
&&ûû¨ Æ
idPuntoDeVentaûûØ Ω
==ûûæ ¿
sbtûû¡ ƒ
.ûûƒ ≈(
id_actor_negocio_internoûû≈ ›
&&ûûﬁ ‡
sbtûû· ‰
.ûû‰ Â 
id_estado_actualûûÂ ı
==ûûˆ ¯
idUltimoEstadoûû˘ á
)
üü 
.
†† 

SelectMany
†† 
(
†† 
t
†† 
=>
†† 
t
††  
.
††  !!
Detalle_transaccion
††! 4
)
††4 5
.
††5 6
GroupBy
°° 
(
°° 
dt
°° 
=>
°° 
new
°° 
{
¢¢ 
dt
££ 
.
££ 
Transaccion
££  
.
££  !
Comprobante
££! ,
.
££, -"
id_serie_comprobante
££- A
,
££A B
dt
§§ 
.
§§ 
Transaccion
§§  
.
§§  !
Comprobante
§§! ,
.
§§, -
numero_serie
§§- 9
,
§§9 :
dt
•• 
.
•• 
Transaccion
••  
.
••  !
Comprobante
••! ,
.
••, -
Detalle_maestro
••- <
.
••< =
valor
••= B
,
••B C
IdConceptoBasico
¶¶ "
=
¶¶# $
dt
¶¶% '
.
¶¶' (
Concepto_negocio
¶¶( 8
.
¶¶8 9 
id_concepto_basico
¶¶9 K
,
¶¶K L"
NombreConceptoBasico
ßß &
=
ßß' (
dt
ßß) +
.
ßß+ ,
Concepto_negocio
ßß, <
.
ßß< =
Detalle_maestro4
ßß= M
.
ßßM N
nombre
ßßN T
}
®® 
)
®® 
.
®® 
Select
®® 
(
®® 
dt
®® 
=>
®® 
new
®® !<
.Resumen_Transaccion_Por_Serie_y_ConceptoBasico
®®" P
(
®®P Q
)
®®Q R
{
©© 
IdSerie
™™ 
=
™™ 
dt
™™ 
.
™™ 
Key
™™ "
.
™™" #"
id_serie_comprobante
™™# 7
.
™™7 8
Value
™™8 =
,
™™= >
Serie
´´ 
=
´´ 
dt
´´ 
.
´´ 
Key
´´  
.
´´  !
numero_serie
´´! -
,
´´- ."
NombreCortoDocumento
¨¨ &
=
¨¨' (
dt
¨¨) +
.
¨¨+ ,
Key
¨¨, /
.
¨¨/ 0
valor
¨¨0 5
,
¨¨5 6
ConceptoBasico
≠≠  
=
≠≠! "
dt
≠≠# %
.
≠≠% &
Key
≠≠& )
.
≠≠) *"
NombreConceptoBasico
≠≠* >
,
≠≠> ?
Cantidad
ÆÆ 
=
ÆÆ 
dt
ÆÆ 
.
ÆÆ  
Sum
ÆÆ  #
(
ÆÆ# $
c
ÆÆ$ %
=>
ÆÆ& (
c
ÆÆ) *
.
ÆÆ* +
cantidad
ÆÆ+ 3
)
ÆÆ3 4
,
ÆÆ4 5
Importe
ØØ 
=
ØØ 
dt
ØØ 
.
ØØ 
Sum
ØØ "
(
ØØ" #
i
ØØ# $
=>
ØØ% '
i
ØØ( )
.
ØØ) *
total
ØØ* /
)
ØØ/ 0
}
∞∞ 
)
∞∞ 
;
∞∞ 
return
±± 
Resumen
±± 
;
±± 
}
≤≤ 
catch
≥≥ 
(
≥≥ 
	Exception
≥≥ 
e
≥≥ 
)
≥≥ 
{
¥¥ 
throw
¥¥ 
e
¥¥ 
;
¥¥ 
}
¥¥ 
}
µµ 	
public
∑∑ 
IEnumerable
∑∑ 
<
∑∑ >
0Resumen_Transaccion_Por_Serie_y_Concepto_Negocio
∑∑ K
>
∑∑K Lh
YObtenerResumenPorSerieYConceptoNegocioTransaccionesInclusiveActoresYDetalleMaestroYEstado∑∑M ¶
(∑∑¶ ß
int∑∑ß ™
idPuntoDeVenta∑∑´ π
,∑∑π ∫
int∑∑ª æ!
idTipoTransaccion∑∑ø –
,∑∑– —
int∑∑“ ’
idUltimoEstado∑∑÷ ‰
,∑∑‰ Â
DateTime∑∑Ê Ó

fechaDesde∑∑Ô ˘
,∑∑˘ ˙
DateTime∑∑˚ É

fechaHasta∑∑Ñ é
)∑∑é è
{
∏∏ 	
try
ππ 
{
∫∫ 
var
ªª 
Resumen
ªª 
=
ªª 
_db
ªª !
.
ªª! "
Transaccion
ªª" -
.
ªª- .
Where
ªª. 3
(
ªª3 4
sbt
ªª4 7
=>
ªª8 :
sbt
ªª; >
.
ªª> ?!
id_tipo_transaccion
ªª? R
==
ªªS U
idTipoTransaccion
ªªV g
&&
ªªh j
idPuntoDeVenta
ªªk y
==
ªªz |
sbtªª} Ä
.ªªÄ Å(
id_actor_negocio_internoªªÅ ô
&&
ºº 
sbt
ºº 
.
ºº 
fecha_inicio
ºº #
>=
ºº$ &

fechaDesde
ºº' 1
&&
ºº2 4
sbt
ºº5 8
.
ºº8 9
fecha_inicio
ºº9 E
<=
ººF H

fechaHasta
ººI S
&&
ººT V
sbt
ººW Z
.
ººZ [
id_estado_actual
ºº[ k
==
ººl n
idUltimoEstado
ººo }
)
ºº} ~
.
ΩΩ 

SelectMany
ΩΩ 
(
ΩΩ 
t
ΩΩ 
=>
ΩΩ  
t
ΩΩ! "
.
ΩΩ" #!
Detalle_transaccion
ΩΩ# 6
)
ΩΩ6 7
.
ΩΩ7 8
GroupBy
ææ 
(
ææ 
dt
ææ 
=>
ææ 
new
ææ 
{
øø 
dt
¿¿ 
.
¿¿ 
Transaccion
¿¿  
.
¿¿  !
Comprobante
¿¿! ,
.
¿¿, -"
id_serie_comprobante
¿¿- A
,
¿¿A B
dt
¡¡ 
.
¡¡ 
Transaccion
¡¡  
.
¡¡  !
Comprobante
¡¡! ,
.
¡¡, -
numero_serie
¡¡- 9
,
¡¡9 :
dt
¬¬ 
.
¬¬ !
id_concepto_negocio
¬¬ (
,
¬¬( )
dt
√√ 
.
√√ 
Concepto_negocio
√√ %
.
√√% &
nombre
√√& ,
,
√√, -
dt
ƒƒ 
.
ƒƒ 
Concepto_negocio
ƒƒ %
.
ƒƒ% &
codigo_barra
ƒƒ& 2
,
ƒƒ2 3
dt
≈≈ 
.
≈≈ 
Transaccion
≈≈  
.
≈≈  !
Comprobante
≈≈! ,
.
≈≈, -
Detalle_maestro
≈≈- <
.
≈≈< =
valor
≈≈= B
,
≈≈B C
precioUnitario
∆∆  
=
∆∆! "
dt
∆∆# %
.
∆∆% &
precio_unitario
∆∆& 5
}
»» 
)
»» 
.
»» 
Select
»» 
(
»» 
dt
»» 
=>
»» 
new
»» !>
0Resumen_Transaccion_Por_Serie_y_Concepto_Negocio
»»" R
(
»»R S
)
»»S T
{
…… 
IdSerie
   
=
   
dt
   
.
   
Key
   "
.
  " #"
id_serie_comprobante
  # 7
.
  7 8
Value
  8 =
,
  = >
Serie
ÀÀ 
=
ÀÀ 
dt
ÀÀ 
.
ÀÀ 
Key
ÀÀ  
.
ÀÀ  !
numero_serie
ÀÀ! -
,
ÀÀ- .
CodigoBarra
ÃÃ 
=
ÃÃ 
dt
ÃÃ  "
.
ÃÃ" #
Key
ÃÃ# &
.
ÃÃ& '
codigo_barra
ÃÃ' 3
,
ÃÃ3 4
IdConceptoNegocio
ÕÕ #
=
ÕÕ$ %
dt
ÕÕ& (
.
ÕÕ( )
Key
ÕÕ) ,
.
ÕÕ, -!
id_concepto_negocio
ÕÕ- @
,
ÕÕ@ A
ConceptoNegocio
ŒŒ !
=
ŒŒ" #
dt
ŒŒ$ &
.
ŒŒ& '
Key
ŒŒ' *
.
ŒŒ* +
nombre
ŒŒ+ 1
,
ŒŒ1 2"
NombreCortoDocumento
œœ &
=
œœ' (
dt
œœ) +
.
œœ+ ,
Key
œœ, /
.
œœ/ 0
valor
œœ0 5
,
œœ5 6
Cantidad
–– 
=
–– 
dt
–– 
.
––  
Sum
––  #
(
––# $
c
––$ %
=>
––& (
c
––) *
.
––* +
cantidad
––+ 3
)
––3 4
,
––4 5
Importe
—— 
=
—— 
dt
—— 
.
—— 
Sum
—— "
(
——" #
i
——# $
=>
——% '
i
——( )
.
——) *
total
——* /
)
——/ 0
}
““ 
)
““ 
;
““ 
return
”” 
Resumen
”” 
.
”” 
OrderBy
”” &
(
””& '
r
””' (
=>
””) +
r
””, -
.
””- .
CodigoBarra
””. 9
??
””: <
r
””= >
.
””> ?
ConceptoNegocio
””? N
)
””N O
;
””O P
}
‘‘ 
catch
’’ 
(
’’ 
	Exception
’’ 
e
’’ 
)
’’ 
{
÷÷ 
throw
◊◊ 
e
◊◊ 
;
◊◊ 
}
ÿÿ 
}
ŸŸ 	
public
€€ 
IEnumerable
€€ 
<
€€ <
.Resumen_Transaccion_Por_Serie_y_ConceptoBasico
€€ I
>
€€I Jg
XObtenerResumenPorSerieYConceptoBasicoTransaccionesInclusiveActoresYDetalleMaestroYEstado€€K £
(€€£ §
int€€§ ß
idPuntoDeVenta€€® ∂
,€€∂ ∑
int€€∏ ª!
idTipoTransaccion€€º Õ
,€€Õ Œ
int€€œ “
idUltimoEstado€€” ·
,€€· ‚
DateTime€€„ Î

fechaDesde€€Ï ˆ
,€€ˆ ˜
DateTime€€¯ Ä

fechaHasta€€Å ã
)€€ã å
{
‹‹ 	
try
›› 
{
ﬁﬁ 
var
ﬂﬂ 
Resumen
ﬂﬂ 
=
ﬂﬂ 
_db
ﬂﬂ !
.
ﬂﬂ! "
Transaccion
ﬂﬂ" -
.
ﬂﬂ- .
Where
ﬂﬂ. 3
(
ﬂﬂ3 4
sbt
ﬂﬂ4 7
=>
ﬂﬂ8 :
sbt
ﬂﬂ; >
.
ﬂﬂ> ?!
id_tipo_transaccion
ﬂﬂ? R
==
ﬂﬂS U
idTipoTransaccion
ﬂﬂV g
&&
ﬂﬂh j
idPuntoDeVenta
ﬂﬂk y
==
ﬂﬂz |
sbtﬂﬂ} Ä
.ﬂﬂÄ Å(
id_actor_negocio_internoﬂﬂÅ ô
&&
‡‡ 
sbt
‡‡ 
.
‡‡ 
fecha_inicio
‡‡ #
>=
‡‡$ &

fechaDesde
‡‡' 1
&&
‡‡2 4
sbt
‡‡5 8
.
‡‡8 9
fecha_inicio
‡‡9 E
<=
‡‡F H

fechaHasta
‡‡I S
&&
‡‡T V
sbt
‡‡W Z
.
‡‡Z [
id_estado_actual
‡‡[ k
==
‡‡l n
idUltimoEstado
‡‡o }
)
‡‡} ~
.
·· 

SelectMany
·· 
(
·· 
t
·· 
=>
··  
t
··! "
.
··" #!
Detalle_transaccion
··# 6
)
··6 7
.
··7 8
GroupBy
‚‚ 
(
‚‚ 
dt
‚‚ 
=>
‚‚ 
new
‚‚ 
{
„„ 
dt
‰‰ 
.
‰‰ 
Transaccion
‰‰  
.
‰‰  !
Comprobante
‰‰! ,
.
‰‰, -"
id_serie_comprobante
‰‰- A
,
‰‰A B
dt
ÂÂ 
.
ÂÂ 
Transaccion
ÂÂ  
.
ÂÂ  !
Comprobante
ÂÂ! ,
.
ÂÂ, -
numero_serie
ÂÂ- 9
,
ÂÂ9 :
dt
ÊÊ 
.
ÊÊ 
Transaccion
ÊÊ  
.
ÊÊ  !
Comprobante
ÊÊ! ,
.
ÊÊ, -
Detalle_maestro
ÊÊ- <
.
ÊÊ< =
valor
ÊÊ= B
,
ÊÊB C
IdConceptoBasico
ÁÁ "
=
ÁÁ# $
dt
ÁÁ% '
.
ÁÁ' (
Concepto_negocio
ÁÁ( 8
.
ÁÁ8 9 
id_concepto_basico
ÁÁ9 K
,
ÁÁK L"
NombreConceptoBasico
ËË &
=
ËË' (
dt
ËË) +
.
ËË+ ,
Concepto_negocio
ËË, <
.
ËË< =
Detalle_maestro4
ËË= M
.
ËËM N
nombre
ËËN T
}
ÈÈ 
)
ÈÈ 
.
ÈÈ 
Select
ÈÈ 
(
ÈÈ 
dt
ÈÈ 
=>
ÈÈ 
new
ÈÈ !<
.Resumen_Transaccion_Por_Serie_y_ConceptoBasico
ÈÈ" P
(
ÈÈP Q
)
ÈÈQ R
{
ÍÍ 
IdSerie
ÎÎ 
=
ÎÎ 
dt
ÎÎ 
.
ÎÎ 
Key
ÎÎ "
.
ÎÎ" #"
id_serie_comprobante
ÎÎ# 7
.
ÎÎ7 8
Value
ÎÎ8 =
,
ÎÎ= >
Serie
ÏÏ 
=
ÏÏ 
dt
ÏÏ 
.
ÏÏ 
Key
ÏÏ  
.
ÏÏ  !
numero_serie
ÏÏ! -
,
ÏÏ- ."
NombreCortoDocumento
ÌÌ &
=
ÌÌ' (
dt
ÌÌ) +
.
ÌÌ+ ,
Key
ÌÌ, /
.
ÌÌ/ 0
valor
ÌÌ0 5
,
ÌÌ5 6
ConceptoBasico
ÓÓ  
=
ÓÓ! "
dt
ÓÓ# %
.
ÓÓ% &
Key
ÓÓ& )
.
ÓÓ) *"
NombreConceptoBasico
ÓÓ* >
,
ÓÓ> ?
Cantidad
ÔÔ 
=
ÔÔ 
dt
ÔÔ 
.
ÔÔ  
Sum
ÔÔ  #
(
ÔÔ# $
c
ÔÔ$ %
=>
ÔÔ& (
c
ÔÔ) *
.
ÔÔ* +
cantidad
ÔÔ+ 3
)
ÔÔ3 4
,
ÔÔ4 5
Importe
 
=
 
dt
 
.
 
Sum
 "
(
" #
i
# $
=>
% '
i
( )
.
) *
total
* /
)
/ 0
}
ÒÒ 
)
ÒÒ 
;
ÒÒ 
return
ÚÚ 
Resumen
ÚÚ 
;
ÚÚ 
}
ÛÛ 
catch
ÙÙ 
(
ÙÙ 
	Exception
ÙÙ 
e
ÙÙ 
)
ÙÙ 
{
ıı 
throw
ˆˆ 
e
ˆˆ 
;
ˆˆ 
}
˜˜ 
}
¯¯ 	
public
˙˙ 
IEnumerable
˙˙ 
<
˙˙ 3
%Resumen_transaccion_Venta_PorConcepto
˙˙ @
>
˙˙@ AS
DObtenerTransaccionesInclusiveActoresYDetalleMaestroYEstadoDeVendedor˙˙B Ü
(˙˙Ü á
int˙˙á ä

idEmpleado˙˙ã ï
,˙˙ï ñ
int˙˙ó ö!
idTipoTransaccion˙˙õ ¨
,˙˙¨ ≠
DateTime˙˙Æ ∂

fechaDesde˙˙∑ ¡
,˙˙¡ ¬
DateTime˙˙√ À

fechaHasta˙˙Ã ÷
,˙˙÷ ◊
int˙˙ÿ €
idUltimoEstado˙˙‹ Í
)˙˙Í Î
{
˚˚ 	
try
¸¸ 
{
˝˝ 
var
˛˛ 
Resumen
˛˛ 
=
˛˛ 
_db
˛˛ !
.
˛˛! "
Transaccion
˛˛" -
.
˛˛- .
Where
˛˛. 3
(
˛˛3 4
sbt
˛˛4 7
=>
˛˛8 :
sbt
˛˛; >
.
˛˛> ?!
id_tipo_transaccion
˛˛? R
==
˛˛S U
idTipoTransaccion
˛˛V g
&&
˛˛h j
sbt
˛˛k n
.
˛˛n o
id_empleado
˛˛o z
==
˛˛{ }

idEmpleado˛˛~ à
&&
ˇˇ 
sbt
ˇˇ 
.
ˇˇ 
fecha_inicio
ˇˇ #
>=
ˇˇ$ &

fechaDesde
ˇˇ' 1
&&
ˇˇ2 4
sbt
ˇˇ5 8
.
ˇˇ8 9
fecha_inicio
ˇˇ9 E
<=
ˇˇF H

fechaHasta
ˇˇI S
&&
ÄÄ 
sbt
ÄÄ 
.
ÄÄ 
id_estado_actual
ÄÄ '
==
ÄÄ( *
idUltimoEstado
ÄÄ+ 9
)
ÅÅ 
.
ÅÅ 

SelectMany
ÅÅ 
(
ÅÅ 
t
ÅÅ 
=>
ÅÅ !
t
ÅÅ" #
.
ÅÅ# $!
Detalle_transaccion
ÅÅ$ 7
)
ÅÅ7 8
.
ÅÅ8 9
GroupBy
ÇÇ 
(
ÇÇ 
dt
ÇÇ 
=>
ÇÇ 
new
ÇÇ 
{
ÉÉ  
idconcepto_negocio
ÑÑ $
=
ÑÑ% &
dt
ÑÑ' )
.
ÑÑ) *
Concepto_negocio
ÑÑ* :
.
ÑÑ: ;
id
ÑÑ; =
,
ÑÑ= >
dt
ÖÖ 
.
ÖÖ 
Concepto_negocio
ÖÖ %
.
ÖÖ% &
codigo_barra
ÖÖ& 2
,
ÖÖ2 3
concepto
ÜÜ 
=
ÜÜ 
dt
ÜÜ 
.
ÜÜ  
Concepto_negocio
ÜÜ  0
.
ÜÜ0 1
nombre
ÜÜ1 7
,
ÜÜ7 8
precioUnitario
áá  
=
áá! "
dt
áá# %
.
áá% &
precio_unitario
áá& 5
}
àà 
)
àà 
.
àà 
Select
àà 
(
àà 
dt
àà 
=>
àà 
new
àà !3
%Resumen_transaccion_Venta_PorConcepto
àà" G
(
ààG H
)
ààH I
{
ââ 
IdConceptoNegocio
ää #
=
ää$ %
dt
ää& (
.
ää( )
Key
ää) ,
.
ää, - 
idconcepto_negocio
ää- ?
,
ää? @
CodigoBarra
ãã 
=
ãã 
dt
ãã  "
.
ãã" #
Key
ãã# &
.
ãã& '
codigo_barra
ãã' 3
,
ãã3 4
Concepto
åå 
=
åå 
dt
åå 
.
åå  
Key
åå  #
.
åå# $
concepto
åå$ ,
,
åå, -
Cantidad
çç 
=
çç 
dt
çç 
.
çç  
Sum
çç  #
(
çç# $
c
çç$ %
=>
çç& (
c
çç) *
.
çç* +
cantidad
çç+ 3
)
çç3 4
,
çç4 5
Importe
éé 
=
éé 
dt
éé 
.
éé 
Sum
éé "
(
éé" #
i
éé# $
=>
éé% '
i
éé( )
.
éé) *
total
éé* /
)
éé/ 0
}
èè 
)
èè 
;
èè 
return
êê 
Resumen
êê 
.
êê 
OrderBy
êê &
(
êê& '
r
êê' (
=>
êê) +
r
êê, -
.
êê- .
CodigoBarra
êê. 9
!=
êê: <
null
êê= A
?
êêB C
r
êêD E
.
êêE F
CodigoBarra
êêF Q
:
êêR S
r
êêT U
.
êêU V
Concepto
êêV ^
)
êê^ _
;
êê_ `
}
ëë 
catch
íí 
(
íí 
	Exception
íí 
e
íí 
)
íí 
{
ìì 
throw
ìì 
e
ìì 
;
ìì 
}
ìì 
}
îî 	
public
ññ 
IEnumerable
ññ 
<
ññ 3
%Resumen_transaccion_Venta_PorConcepto
ññ @
>
ññ@ AS
DObtenerTransaccionesInclusiveActoresYDetalleMaestroYEstadoDeVendedorññB Ü
(ññÜ á
intññá ä

idEmpleadoññã ï
,ññï ñ
intññó ö!
idTipoTransaccionññõ ¨
,ññ¨ ≠
intññÆ ±
idUltimoEstadoññ≤ ¿
,ññ¿ ¡
DateTimeññ¬  

fechaDesdeññÀ ’
,ññ’ ÷
DateTimeññ◊ ﬂ

fechaHastaññ‡ Í
)ññÍ Î
{
óó 	
try
òò 
{
ôô 
var
öö 
Resumen
öö 
=
öö 
_db
öö !
.
öö! "
Transaccion
öö" -
.
öö- .
Where
öö. 3
(
öö3 4
sbt
öö4 7
=>
öö8 :
sbt
öö; >
.
öö> ?!
id_tipo_transaccion
öö? R
==
ööS U
idTipoTransaccion
ööV g
&&
ööh j
sbt
öök n
.
öön o
id_empleado
ööo z
==
öö{ }

idEmpleadoöö~ à
&&
õõ 
sbt
õõ 
.
õõ 
fecha_inicio
õõ #
>=
õõ$ &

fechaDesde
õõ' 1
&&
õõ2 4
sbt
õõ5 8
.
õõ8 9
fecha_inicio
õõ9 E
<=
õõF H

fechaHasta
õõI S
&&
õõT V
sbt
õõW Z
.
õõZ [
id_estado_actual
õõ[ k
==
õõl n
idUltimoEstado
õõo }
)
õõ} ~
.
úú 

SelectMany
úú 
(
úú 
t
úú 
=>
úú  
t
úú! "
.
úú" #!
Detalle_transaccion
úú# 6
)
úú6 7
.
úú7 8
GroupBy
ùù 
(
ùù 
dt
ùù 
=>
ùù 
new
ùù 
{
ûû  
idconcepto_negocio
üü $
=
üü% &
dt
üü' )
.
üü) *
Concepto_negocio
üü* :
.
üü: ;
id
üü; =
,
üü= >
dt
†† 
.
†† 
Concepto_negocio
†† %
.
††% &
codigo_barra
††& 2
,
††2 3
concepto
°° 
=
°° 
dt
°° 
.
°°  
Concepto_negocio
°°  0
.
°°0 1
nombre
°°1 7
,
°°7 8
precioUnitario
¢¢  
=
¢¢! "
dt
¢¢# %
.
¢¢% &
precio_unitario
¢¢& 5
}
§§ 
)
§§ 
.
§§ 
Select
§§ 
(
§§ 
dt
§§ 
=>
§§ 
new
§§ !3
%Resumen_transaccion_Venta_PorConcepto
§§" G
(
§§G H
)
§§H I
{
•• 
IdConceptoNegocio
¶¶ #
=
¶¶$ %
dt
¶¶& (
.
¶¶( )
Key
¶¶) ,
.
¶¶, - 
idconcepto_negocio
¶¶- ?
,
¶¶? @
CodigoBarra
ßß 
=
ßß 
dt
ßß  "
.
ßß" #
Key
ßß# &
.
ßß& '
codigo_barra
ßß' 3
,
ßß3 4
Concepto
®® 
=
®® 
dt
®® 
.
®®  
Key
®®  #
.
®®# $
concepto
®®$ ,
,
®®, -
Cantidad
©© 
=
©© 
dt
©© 
.
©©  
Sum
©©  #
(
©©# $
c
©©$ %
=>
©©& (
c
©©) *
.
©©* +
cantidad
©©+ 3
)
©©3 4
,
©©4 5
Importe
™™ 
=
™™ 
dt
™™ 
.
™™ 
Sum
™™ "
(
™™" #
i
™™# $
=>
™™% '
i
™™( )
.
™™) *
total
™™* /
)
™™/ 0
}
´´ 
)
´´ 
;
´´ 
return
¨¨ 
Resumen
¨¨ 
.
¨¨ 
OrderBy
¨¨ &
(
¨¨& '
r
¨¨' (
=>
¨¨) +
r
¨¨, -
.
¨¨- .
CodigoBarra
¨¨. 9
??
¨¨: <
r
¨¨= >
.
¨¨> ?
Concepto
¨¨? G
)
¨¨G H
;
¨¨H I
}
≠≠ 
catch
ÆÆ 
(
ÆÆ 
	Exception
ÆÆ 
e
ÆÆ 
)
ÆÆ 
{
ØØ 
throw
∞∞ 
e
∞∞ 
;
∞∞ 
}
±± 
}
≤≤ 	
public
µµ 
IEnumerable
µµ 
<
µµ +
ResumenTransaccionPorVendedor
µµ 8
>
µµ8 9O
AObtenerResumenTransaccionesInclusiveActoresYDetalleMaestroYEstado
µµ: {
(
µµ{ |
int
µµ| 
[µµ Ä
]µµÄ Å
idsEmpleadoµµÇ ç
,µµç é
intµµè í!
idTipoTransaccionµµì §
,µµ§ •
DateTimeµµ¶ Æ

fechaDesdeµµØ π
,µµπ ∫
DateTimeµµª √

fechaHastaµµƒ Œ
,µµŒ œ
intµµ– ”
idUltimoEstadoµµ‘ ‚
)µµ‚ „
{
∂∂ 	
try
∑∑ 
{
∏∏ 
var
ππ 
Resumen
ππ 
=
ππ 
_db
ππ !
.
ππ! "
Transaccion
ππ" -
.
ππ- .
Where
ππ. 3
(
ππ3 4
sbt
ππ4 7
=>
ππ8 :
sbt
ππ; >
.
ππ> ?!
id_tipo_transaccion
ππ? R
==
ππS U
idTipoTransaccion
ππV g
&&
ππh j
idsEmpleado
ππk v
.
ππv w
Contains
ππw 
(ππ Ä
sbtππÄ É
.ππÉ Ñ
id_empleadoππÑ è
)ππè ê
&&
∫∫ 
sbt
∫∫ 
.
∫∫ 
fecha_inicio
∫∫ #
>=
∫∫$ &

fechaDesde
∫∫' 1
&&
∫∫2 4
sbt
∫∫5 8
.
∫∫8 9
fecha_inicio
∫∫9 E
<=
∫∫F H

fechaHasta
∫∫I S
&&
∫∫T V
sbt
ºº 
.
ºº 
id_estado_actual
ºº $
==
ºº% '
idUltimoEstado
ºº( 6
)
ææ 
.
øø 
GroupBy
øø 
(
øø 
t
øø 
=>
øø 
new
øø 
{
¿¿ 
t
¡¡ 
.
¡¡ 
Actor_negocio
¡¡ !
.
¡¡! "
Actor
¡¡" '
.
¡¡' ((
numero_documento_identidad
¡¡( B
,
¡¡B C
nombreEmpleado
¬¬  
=
¬¬! "
t
¬¬# $
.
¬¬$ %
Actor_negocio
¬¬% 2
.
¬¬2 3
Actor
¬¬3 8
.
¬¬8 9
segundo_nombre
¬¬9 G
}
√√ 
)
√√ 
.
√√ 
Select
√√ 
(
√√ 
t
√√ 
=>
√√ 
new
√√  +
ResumenTransaccionPorVendedor
√√! >
(
√√> ?
)
√√? @
{
ƒƒ 
DNI
≈≈ 
=
≈≈ 
t
≈≈ 
.
≈≈ 
Key
≈≈ 
.
≈≈ (
numero_documento_identidad
≈≈ 8
,
≈≈8 9
Nombre
∆∆ 
=
∆∆ 
t
∆∆ 
.
∆∆ 
Key
∆∆  
.
∆∆  !
nombreEmpleado
∆∆! /
,
∆∆/ 0
Importe
«« 
=
«« 
t
«« 
.
«« 
Sum
«« !
(
««! "
i
««" #
=>
««$ &
i
««' (
.
««( )
importe_total
««) 6
)
««6 7
,
««7 8
Icbpers
»» 
=
»» 
t
»» 
.
»» 

SelectMany
»» (
(
»»( )
pt
»») +
=>
»», .
pt
»»/ 1
.
»»1 2#
Parametro_transaccion
»»2 G
)
»»G H
.
»»H I
Where
»»I N
(
»»N O
pt
»»O Q
=>
»»R T
pt
»»U W
.
»»W X
id_parametro
»»X d
==
»»e g
MaestroSettings
»»h w
.
»»w x
Default
»»x 
.»» Ä/
IdDetalleMaestroParametroIcbper»»Ä ü
)»»ü †
.»»† °
Select»»° ß
(»»ß ®
pt»»® ™
=>»»´ ≠
pt»»Æ ∞
.»»∞ ±
valor»»± ∂
)»»∂ ∑
,»»∑ ∏
}
…… 
)
…… 
;
…… 
return
   
Resumen
   
;
   
}
ÀÀ 
catch
ÃÃ 
(
ÃÃ 
	Exception
ÃÃ 
e
ÃÃ 
)
ÃÃ 
{
ÕÕ 
throw
ÕÕ 
e
ÕÕ 
;
ÕÕ 
}
ÕÕ 
}
ŒŒ 	
public
–– 
IEnumerable
–– 
<
–– +
ResumenTransaccionPorVendedor
–– 8
>
––8 9O
AObtenerResumenTransaccionesInclusiveActoresYDetalleMaestroYEstado
––: {
(
––{ |
int
––| 
[–– Ä
]––Ä Å

idEmpleado––Ç å
,––å ç
int––é ë!
idTipoTransaccion––í £
,––£ §
int––• ®
idUtimoEstado––© ∂
,––∂ ∑
DateTime––∏ ¿

fechaDesde––¡ À
,––À Ã
DateTime––Õ ’

fechaHasta––÷ ‡
)––‡ ·
{
—— 	
try
““ 
{
”” 
var
‘‘ 
Resumen
‘‘ 
=
‘‘ 
_db
‘‘ !
.
‘‘! "
Transaccion
‘‘" -
.
‘‘- .
Where
‘‘. 3
(
‘‘3 4
sbt
‘‘4 7
=>
‘‘8 :
sbt
‘‘; >
.
‘‘> ?
fecha_inicio
‘‘? K
>=
‘‘L N

fechaDesde
‘‘O Y
&&
‘‘Z \
sbt
‘‘] `
.
‘‘` a
fecha_inicio
‘‘a m
<=
‘‘n p

fechaHasta
‘‘q {
&&
‘‘| ~
sbt‘‘ Ç
.‘‘Ç É#
id_tipo_transaccion‘‘É ñ
==‘‘ó ô!
idTipoTransaccion‘‘ö ´
&&‘‘¨ Æ

idEmpleado‘‘Ø π
.‘‘π ∫
Contains‘‘∫ ¬
(‘‘¬ √
sbt‘‘√ ∆
.‘‘∆ «
id_empleado‘‘« “
)‘‘“ ”
&&
’’ 
sbt
’’ 
.
’’ 
id_estado_actual
’’ (
==
’’) +
idUtimoEstado
’’, 9
)
’’9 :
.
÷÷ 
GroupBy
÷÷ 
(
÷÷ 
t
÷÷ 
=>
÷÷ 
new
÷÷ 
{
◊◊ 
t
ÿÿ 
.
ÿÿ 
Actor_negocio
ÿÿ !
.
ÿÿ! "
Actor
ÿÿ" '
.
ÿÿ' ((
numero_documento_identidad
ÿÿ( B
,
ÿÿB C
nombreEmpleado
ŸŸ  
=
ŸŸ! "
t
ŸŸ# $
.
ŸŸ$ %
Actor_negocio
ŸŸ% 2
.
ŸŸ2 3
Actor
ŸŸ3 8
.
ŸŸ8 9
primer_nombre
ŸŸ9 F
+
ŸŸG H
$str
ŸŸI L
+
ŸŸM N
t
ŸŸO P
.
ŸŸP Q
Actor_negocio
ŸŸQ ^
.
ŸŸ^ _
Actor
ŸŸ_ d
.
ŸŸd e
segundo_nombre
ŸŸe s
}
€€ 
)
€€ 
.
€€ 
Select
€€ 
(
€€ 
t
€€ 
=>
€€ 
new
€€  +
ResumenTransaccionPorVendedor
€€! >
(
€€> ?
)
€€? @
{
‹‹ 
DNI
›› 
=
›› 
t
›› 
.
›› 
Key
›› 
.
›› (
numero_documento_identidad
›› 8
,
››8 9
Nombre
ﬁﬁ 
=
ﬁﬁ 
t
ﬁﬁ 
.
ﬁﬁ 
Key
ﬁﬁ  
.
ﬁﬁ  !
nombreEmpleado
ﬁﬁ! /
,
ﬁﬁ/ 0
Importe
ﬂﬂ 
=
ﬂﬂ 
t
ﬂﬂ 
.
ﬂﬂ 
Sum
ﬂﬂ !
(
ﬂﬂ! "
i
ﬂﬂ" #
=>
ﬂﬂ$ &
i
ﬂﬂ' (
.
ﬂﬂ( )
importe_total
ﬂﬂ) 6
)
ﬂﬂ6 7
}
‡‡ 
)
‡‡ 
;
‡‡ 
return
·· 
Resumen
·· 
;
·· 
}
‚‚ 
catch
„„ 
(
„„ 
	Exception
„„ 
e
„„ 
)
„„ 
{
‰‰ 
throw
ÂÂ 
e
ÂÂ 
;
ÂÂ 
}
ÊÊ 
}
ÁÁ 	
public
ÍÍ 
IEnumerable
ÍÍ 
<
ÍÍ +
DetalleTransaccionPorVendedor
ÍÍ 8
>
ÍÍ8 9O
AObtenerDetalleTransaccionesInclusiveActoresYDetalleMaestroYEstado
ÍÍ: {
(
ÍÍ{ |
int
ÍÍ| 
[ÍÍ Ä
]ÍÍÄ Å
idsEmpleadoÍÍÇ ç
,ÍÍç é
intÍÍè í!
idTipoTransaccionÍÍì §
,ÍÍ§ •
DateTimeÍÍ¶ Æ

fechaDesdeÍÍØ π
,ÍÍπ ∫
DateTimeÍÍª √

fechaHastaÍÍƒ Œ
,ÍÍŒ œ
intÍÍ– ”
idUltimoEstadoÍÍ‘ ‚
)ÍÍ‚ „
{
ÎÎ 	
try
ÏÏ 
{
ÌÌ 
var
ÓÓ 
Resumen
ÓÓ 
=
ÓÓ 
_db
ÓÓ !
.
ÓÓ! "
Transaccion
ÓÓ" -
.
ÓÓ- .
Where
ÓÓ. 3
(
ÓÓ3 4
sbt
ÓÓ4 7
=>
ÓÓ8 :
sbt
ÓÓ; >
.
ÓÓ> ?
fecha_inicio
ÓÓ? K
>=
ÓÓL N

fechaDesde
ÓÓO Y
&&
ÓÓZ \
sbt
ÓÓ] `
.
ÓÓ` a
fecha_inicio
ÓÓa m
<=
ÓÓn p

fechaHasta
ÓÓq {
&&
ÓÓ| ~
sbtÓÓ Ç
.ÓÓÇ É#
id_tipo_transaccionÓÓÉ ñ
==ÓÓó ô!
idTipoTransaccionÓÓö ´
&&ÓÓ¨ Æ
idsEmpleadoÓÓØ ∫
.ÓÓ∫ ª
ContainsÓÓª √
(ÓÓ√ ƒ
sbtÓÓƒ «
.ÓÓ« »
id_empleadoÓÓ» ”
)ÓÓ” ‘
&&
ÔÔ 
sbt
ÔÔ 
.
ÔÔ 
id_estado_actual
ÔÔ '
==
ÔÔ( *
idUltimoEstado
ÔÔ+ 9
)
 
.
 

SelectMany
 
(
 
t
 
=>
 !
t
" #
.
# $!
Detalle_transaccion
$ 7
)
7 8
.
8 9
GroupBy
ÒÒ 
(
ÒÒ 
dt
ÒÒ 
=>
ÒÒ 
new
ÒÒ 
{
ÚÚ 
dt
ÛÛ 
.
ÛÛ 
Concepto_negocio
ÛÛ %
.
ÛÛ% &
codigo_barra
ÛÛ& 2
,
ÛÛ2 3 
idconcepto_negocio
ÙÙ $
=
ÙÙ% &
dt
ÙÙ' )
.
ÙÙ) *
Concepto_negocio
ÙÙ* :
.
ÙÙ: ;
id
ÙÙ; =
,
ÙÙ= >
concepto
ıı 
=
ıı 
dt
ıı 
.
ıı  
Concepto_negocio
ıı  0
.
ıı0 1
nombre
ıı1 7
,
ıı7 8
dni
ˆˆ 
=
ˆˆ 
dt
ˆˆ 
.
ˆˆ 
Transaccion
ˆˆ &
.
ˆˆ& '
Actor_negocio
ˆˆ' 4
.
ˆˆ4 5
Actor
ˆˆ5 :
.
ˆˆ: ;(
numero_documento_identidad
ˆˆ; U
,
ˆˆU V
empleado
˜˜ 
=
˜˜ 
dt
˜˜ 
.
˜˜  
Transaccion
˜˜  +
.
˜˜+ ,
Actor_negocio
˜˜, 9
.
˜˜9 :
Actor
˜˜: ?
.
˜˜? @
segundo_nombre
˜˜@ N
,
˜˜N O
precioUnitario
¯¯  
=
¯¯! "
dt
¯¯# %
.
¯¯% &
precio_unitario
¯¯& 5
}
˘˘ 
)
˘˘ 
.
˘˘ 
Select
˘˘ 
(
˘˘ 
dt
˘˘ 
=>
˘˘ 
new
˘˘ !+
DetalleTransaccionPorVendedor
˘˘" ?
(
˘˘? @
)
˘˘@ A
{
˙˙ 
DNI
˚˚ 
=
˚˚ 
dt
˚˚ 
.
˚˚ 
Key
˚˚ 
.
˚˚ 
dni
˚˚ "
,
˚˚" #
Empleado
¸¸ 
=
¸¸ 
dt
¸¸ 
.
¸¸  
Key
¸¸  #
.
¸¸# $
empleado
¸¸$ ,
,
¸¸, -
IdConceptoNegocio
˝˝ #
=
˝˝$ %
dt
˝˝& (
.
˝˝( )
Key
˝˝) ,
.
˝˝, - 
idconcepto_negocio
˝˝- ?
,
˝˝? @#
CodigoConceptoNegocio
˛˛ '
=
˛˛( )
dt
˛˛* ,
.
˛˛, -
Key
˛˛- 0
.
˛˛0 1
codigo_barra
˛˛1 =
,
˛˛= >#
NombreConceptoNegocio
ˇˇ '
=
ˇˇ( )
dt
ˇˇ* ,
.
ˇˇ, -
Key
ˇˇ- 0
.
ˇˇ0 1
concepto
ˇˇ1 9
,
ˇˇ9 :
Cantidad
ÄÄ 
=
ÄÄ 
dt
ÄÄ 
.
ÄÄ  
Sum
ÄÄ  #
(
ÄÄ# $
c
ÄÄ$ %
=>
ÄÄ& (
c
ÄÄ) *
.
ÄÄ* +
cantidad
ÄÄ+ 3
)
ÄÄ3 4
,
ÄÄ4 5
Importe
ÅÅ 
=
ÅÅ 
dt
ÅÅ 
.
ÅÅ 
Sum
ÅÅ "
(
ÅÅ" #
i
ÅÅ# $
=>
ÅÅ% '
i
ÅÅ( )
.
ÅÅ) *
total
ÅÅ* /
)
ÅÅ/ 0
}
ÇÇ 
)
ÇÇ 
;
ÇÇ 
return
ÉÉ 
Resumen
ÉÉ 
.
ÉÉ 
OrderBy
ÉÉ &
(
ÉÉ& '
r
ÉÉ' (
=>
ÉÉ) +
r
ÉÉ, -
.
ÉÉ- .#
CodigoConceptoNegocio
ÉÉ. C
??
ÉÉD F
r
ÉÉG H
.
ÉÉH I#
NombreConceptoNegocio
ÉÉI ^
)
ÉÉ^ _
;
ÉÉ_ `
}
ÑÑ 
catch
ÖÖ 
(
ÖÖ 
	Exception
ÖÖ 
e
ÖÖ 
)
ÖÖ 
{
ÜÜ 
throw
ÜÜ 
e
ÜÜ 
;
ÜÜ 
}
ÜÜ 
}
áá 	
public
ââ 
IEnumerable
ââ 
<
ââ +
DetalleTransaccionPorVendedor
ââ 8
>
ââ8 9O
AObtenerDetalleTransaccionesInclusiveActoresYDetalleMaestroYEstado
ââ: {
(
ââ{ |
int
ââ| 
[ââ Ä
]ââÄ Å
idsEmpleadoââÇ ç
,ââç é
intââè í!
idTipoTransaccionââì §
,ââ§ •
intââ¶ ©
idUltimoEstadoââ™ ∏
,ââ∏ π
DateTimeââ∫ ¬

fechaDesdeââ√ Õ
,ââÕ Œ
DateTimeââœ ◊

fechaHastaââÿ ‚
)ââ‚ „
{
ää 	
try
ãã 
{
åå 
var
çç 
Resumen
çç 
=
çç 
_db
çç !
.
çç! "
Transaccion
çç" -
.
çç- .
Where
çç. 3
(
çç3 4
sbt
çç4 7
=>
çç8 :
sbt
çç; >
.
çç> ?!
id_tipo_transaccion
çç? R
==
ççS U
idTipoTransaccion
ççV g
&&
ççh j
idsEmpleado
ççk v
.
ççv w
Contains
ççw 
(çç Ä
sbtççÄ É
.ççÉ Ñ
id_empleadoççÑ è
)ççè ê
&&
éé 
sbt
éé 
.
éé 
fecha_inicio
éé #
>=
éé$ &

fechaDesde
éé' 1
&&
éé2 4
sbt
éé5 8
.
éé8 9
fecha_inicio
éé9 E
<=
ééF H

fechaHasta
ééI S
&&
ééT V
sbt
ééW Z
.
ééZ [
id_estado_actual
éé[ k
==
éél n
idUltimoEstado
ééo }
)
éé} ~
.
èè 

SelectMany
èè 
(
èè 
t
èè 
=>
èè  
t
èè! "
.
èè" #!
Detalle_transaccion
èè# 6
)
èè6 7
.
èè7 8
GroupBy
êê 
(
êê 
dt
êê 
=>
êê 
new
êê 
{
ëë  
idconcepto_negocio
íí $
=
íí% &
dt
íí' )
.
íí) *
Concepto_negocio
íí* :
.
íí: ;
id
íí; =
,
íí= >
dt
ìì 
.
ìì 
Concepto_negocio
ìì %
.
ìì% &
codigo_barra
ìì& 2
,
ìì2 3
concepto
îî 
=
îî 
dt
îî 
.
îî  
Concepto_negocio
îî  0
.
îî0 1
nombre
îî1 7
,
îî7 8
precioUnitario
ïï  
=
ïï! "
dt
ïï# %
.
ïï% &
precio_unitario
ïï& 5
}
óó 
)
óó 
.
óó 
Select
óó 
(
óó 
dt
óó 
=>
óó 
new
óó !+
DetalleTransaccionPorVendedor
óó" ?
(
óó? @
)
óó@ A
{
òò 
IdConceptoNegocio
ôô #
=
ôô$ %
dt
ôô& (
.
ôô( )
Key
ôô) ,
.
ôô, - 
idconcepto_negocio
ôô- ?
,
ôô? @#
CodigoConceptoNegocio
öö '
=
öö( )
dt
öö* ,
.
öö, -
Key
öö- 0
.
öö0 1
codigo_barra
öö1 =
,
öö= >#
NombreConceptoNegocio
õõ '
=
õõ( )
dt
õõ* ,
.
õõ, -
Key
õõ- 0
.
õõ0 1
concepto
õõ1 9
,
õõ9 :
Cantidad
úú 
=
úú 
dt
úú 
.
úú  
Sum
úú  #
(
úú# $
c
úú$ %
=>
úú& (
c
úú) *
.
úú* +
cantidad
úú+ 3
)
úú3 4
,
úú4 5
Importe
ùù 
=
ùù 
dt
ùù 
.
ùù 
Sum
ùù "
(
ùù" #
i
ùù# $
=>
ùù% '
i
ùù( )
.
ùù) *
total
ùù* /
)
ùù/ 0
}
ûû 
)
ûû 
;
ûû 
return
üü 
Resumen
üü 
.
üü 
OrderBy
üü &
(
üü& '
r
üü' (
=>
üü) +
r
üü, -
.
üü- .#
CodigoConceptoNegocio
üü. C
??
üüD F
r
üüG H
.
üüH I#
NombreConceptoNegocio
üüI ^
)
üü^ _
;
üü_ `
}
†† 
catch
°° 
(
°° 
	Exception
°° 
e
°° 
)
°° 
{
¢¢ 
throw
££ 
e
££ 
;
££ 
}
§§ 
}
•• 	
public
ßß 
IEnumerable
ßß 
<
ßß '
ResumenDeTransaccionVenta
ßß 4
>
ßß4 5)
ObtenerResumenDeTransaccion
ßß6 Q
(
ßßQ R
int
ßßR U 
idSerieComprobante
ßßV h
,
ßßh i
int
ßßj m
[
ßßm n
]
ßßn o"
idsTiposTransaccionßßp É
,ßßÉ Ñ
intßßÖ à
[ßßà â
]ßßâ ä!
idEstadosPosiblesßßã ú
,ßßú ù
intßßû ° 
idEstadoAIgnorarßß¢ ≤
,ßß≤ ≥
DateTimeßß¥ º

fechaDesdeßßΩ «
,ßß« »
DateTimeßß… —

fechaHastaßß“ ‹
)ßß‹ ›
{
®® 	
try
©© 
{
™™ 
var
´´ 
Resumen
´´ 
=
´´ 
_db
´´ !
.
´´! "
Transaccion
´´" -
.
¨¨ 
Where
¨¨ 
(
¨¨ 
t
¨¨ 
=>
¨¨ !
idsTiposTransaccion
¨¨  3
.
¨¨3 4
Contains
¨¨4 <
(
¨¨< =
t
¨¨= >
.
¨¨> ?!
id_tipo_transaccion
¨¨? R
)
¨¨R S
&&
¨¨T V
t
¨¨W X
.
¨¨X Y
fecha_inicio
¨¨Y e
>=
¨¨f h

fechaDesde
¨¨i s
&&
¨¨t v
t
¨¨w x
.
¨¨x y
fecha_inicio¨¨y Ö
<=¨¨Ü à

fechaHasta¨¨â ì
&&¨¨î ñ
t¨¨ó ò
.¨¨ò ô
Comprobante¨¨ô §
.¨¨§ •$
id_serie_comprobante¨¨• π
==¨¨∫ º"
idSerieComprobante¨¨Ω œ
&&¨¨– “!
idEstadosPosibles¨¨” ‰
.¨¨‰ Â
Contains¨¨Â Ì
(¨¨Ì Ó
(¨¨Ó Ô
int¨¨Ô Ú
)¨¨Ú Û
t¨¨Û Ù
.¨¨Ù ı 
id_estado_actual¨¨ı Ö
)¨¨Ö Ü
&&¨¨á â
(¨¨ä ã 
idEstadoAIgnorar¨¨ã õ
!=¨¨ú û
(¨¨ü †
int¨¨† £
)¨¨£ §
t¨¨§ •
.¨¨• ¶ 
id_estado_actual¨¨¶ ∂
)¨¨∂ ∑
)¨¨∑ ∏
.
≠≠ 
Select
≠≠ 
(
≠≠ 
v
≠≠ 
=>
≠≠ 
new
≠≠ "'
ResumenDeTransaccionVenta
≠≠# <
(
≠≠< =
)
≠≠= >
{
ÆÆ 
CentroAtencion
ØØ $
=
ØØ% &
v
ØØ' (
.
ØØ( )
Comprobante
ØØ) 4
.
ØØ4 5
Serie_comprobante
ØØ5 F
.
ØØF G
Actor_negocio
ØØG T
.
ØØT U
Actor
ØØU Z
.
ØØZ [
primer_nombre
ØØ[ h
,
ØØh i
Fecha
∞∞ 
=
∞∞ 
v
∞∞ 
.
∞∞  
fecha_inicio
∞∞  ,
,
∞∞, -
Numero
±± 
=
±± 
(
±±  
int
±±  #
)
±±# $
v
±±$ %
.
±±% &
Comprobante
±±& 1
.
±±1 2
numero
±±2 8
,
±±8 9
NumeroDocumento
≤≤ %
=
≤≤& '
v
≤≤( )
.
≤≤) *
Actor_negocio1
≤≤* 8
.
≤≤8 9
Actor
≤≤9 >
.
≤≤> ?(
numero_documento_identidad
≤≤? Y
,
≤≤Y Z
PrimerNombre
≥≥ "
=
≥≥# $
v
≥≥% &
.
≥≥& '
Actor_negocio1
≥≥' 5
.
≥≥5 6
Actor
≥≥6 ;
.
≥≥; <
primer_nombre
≥≥< I
,
≥≥I J
Importe
¥¥ 
=
¥¥ 
v
¥¥  !
.
¥¥! "
importe_total
¥¥" /
,
¥¥/ 0
Id
µµ 
=
µµ 
v
µµ 
.
µµ 
id
µµ 
,
µµ  
TipoDocumento
∂∂ #
=
∂∂$ %
v
∂∂& '
.
∂∂' (
Comprobante
∂∂( 3
.
∂∂3 4
Detalle_maestro
∂∂4 C
.
∂∂C D
valor
∂∂D I
,
∂∂I J
Serie
∑∑ 
=
∑∑ 
v
∑∑ 
.
∑∑  
Comprobante
∑∑  +
.
∑∑+ ,
numero_serie
∑∑, 8
,
∑∑8 9

OrdenVenta
∏∏  
=
∏∏! "
v
∏∏# $
.
∏∏$ %
codigo
∏∏% +
,
∏∏+ ,
IdTipoTransaccion
ππ '
=
ππ( )
v
ππ* +
.
ππ+ ,!
id_tipo_transaccion
ππ, ?
,
ππ? @
IdEstado
∫∫ 
=
∫∫  
(
∫∫! "
int
∫∫" %
)
∫∫% &
v
∫∫& '
.
∫∫' (
id_estado_actual
∫∫( 8
,
∫∫8 9
Estado
ªª 
=
ªª 
v
ªª  
.
ªª  !
Detalle_maestro
ªª! 0
.
ªª0 1
nombre
ªª1 7
}
ºº 
)
ºº 
;
ºº 
return
ΩΩ 
Resumen
ΩΩ 
;
ΩΩ 
}
ææ 
catch
øø 
(
øø 
	Exception
øø 
e
øø 
)
øø 
{
¿¿ 
throw
¿¿ 
new
¿¿ 
DatosException
¿¿ &
(
¿¿& '
$str
¿¿' G
,
¿¿G H
e
¿¿I J
)
¿¿J K
;
¿¿K L
}
¿¿M N
}
¡¡ 	
public
√√ 
IEnumerable
√√ 
<
√√ 
Transaccion
√√ &
>
√√& 'P
BObtenerTransaccionesInclusiveActoresYDetalleMaestroYEstadoPorSerie
√√( j
(
√√j k
int
√√k n!
idSerieComprobante√√o Å
,√√Å Ç
int√√É Ü!
idTipoTransaccion√√á ò
,√√ò ô
int√√ö ù
idUltimoEstado√√û ¨
,√√¨ ≠
DateTime√√Æ ∂

fechaDesde√√∑ ¡
,√√¡ ¬
DateTime√√√ À

fechaHasta√√Ã ÷
)√√÷ ◊
{
ƒƒ 	
try
≈≈ 
{
∆∆ 
var
«« 
Resumen
«« 
=
«« 
_db
«« !
.
««! "
Transaccion
««" -
.
»»! "
Include
»»" )
(
»») *
t
»»* +
=>
»», .
t
»»/ 0
.
»»0 1
Comprobante
»»1 <
)
»»< =
.
……! "
Where
……" '
(
……' (
sbt
……( +
=>
……, .
sbt
……/ 2
.
……2 3
fecha_inicio
……3 ?
>=
……@ B

fechaDesde
……C M
&&
……N P
sbt
……Q T
.
……T U
fecha_inicio
……U a
<=
……b d

fechaHasta
……e o
&&
  ( *
sbt
  + .
.
  . /!
id_tipo_transaccion
  / B
==
  C E
idTipoTransaccion
  F W
&&
ÀÀ( *
sbt
ÀÀ+ .
.
ÀÀ. /
Comprobante
ÀÀ/ :
.
ÀÀ: ;"
id_serie_comprobante
ÀÀ; O
==
ÀÀP R 
idSerieComprobante
ÀÀS e
&&
ÃÃ( *
sbt
ÃÃ+ .
.
ÃÃ. /
id_estado_actual
ÃÃ/ ?
==
ÃÃ@ B
idUltimoEstado
ÃÃC Q
)
ÃÃQ R
;
ÃÃR S
return
ÕÕ 
Resumen
ÕÕ 
;
ÕÕ 
}
ŒŒ 
catch
œœ 
(
œœ 
	Exception
œœ 
e
œœ 
)
œœ 
{
–– 
throw
—— 
e
—— 
;
—— 
}
““ 
}
”” 	
public
’’ 
IEnumerable
’’ 
<
’’ 
Transaccion
’’ &
>
’’& 'P
BObtenerTransaccionesInclusiveActoresYDetalleMaestroYEstadoPorSerie
’’( j
(
’’j k
int
’’k n!
idSerieComprobante’’o Å
,’’Å Ç
int’’É Ü!
idTipoTransaccion’’á ò
,’’ò ô
DateTime’’ö ¢

fechaDesde’’£ ≠
,’’≠ Æ
DateTime’’Ø ∑

fechaHasta’’∏ ¬
,’’¬ √
int’’ƒ «
idUltimoEstado’’» ÷
)’’÷ ◊
{
÷÷ 	
try
◊◊ 
{
ÿÿ 
var
ŸŸ 
Resumen
ŸŸ 
=
ŸŸ 
_db
ŸŸ !
.
ŸŸ! "
Transaccion
ŸŸ" -
.
⁄⁄ 
Include
⁄⁄ 
(
⁄⁄ 
t
⁄⁄ 
=>
⁄⁄ !
t
⁄⁄" #
.
⁄⁄# $
Comprobante
⁄⁄$ /
)
⁄⁄/ 0
.
€€ 
Where
€€ 
(
€€ 
sbt
€€ 
=>
€€ !
sbt
€€" %
.
€€% &
fecha_inicio
€€& 2
>=
€€3 5

fechaDesde
€€6 @
&&
€€A C
sbt
€€D G
.
€€G H
fecha_inicio
€€H T
<=
€€U W

fechaHasta
€€X b
&&
‹‹ 
sbt
‹‹ 
.
‹‹ !
id_tipo_transaccion
‹‹ .
==
‹‹/ 1
idTipoTransaccion
‹‹2 C
&&
›› 
sbt
›› 
.
›› 
Comprobante
›› &
.
››& '"
id_serie_comprobante
››' ;
==
››< > 
idSerieComprobante
››? Q
&&
ﬁﬁ 
sbt
ﬁﬁ 
.
ﬁﬁ 
id_estado_actual
ﬁﬁ +
==
ﬁﬁ, .
idUltimoEstado
ﬁﬁ/ =
)
ﬁﬁ= >
;
ﬁﬁ> ?
return
ﬂﬂ 
Resumen
ﬂﬂ 
;
ﬂﬂ 
}
‡‡ 
catch
·· 
(
·· 
	Exception
·· 
e
·· 
)
·· 
{
‚‚ 
throw
‚‚ 
e
‚‚ 
;
‚‚ 
}
‚‚ 
}
„„ 	
public
ÊÊ 
IEnumerable
ÊÊ 
<
ÊÊ M
?Resumen_Transaccion_Venta_PorConceptoBasico_Y_ConceptoDeNegocio
ÊÊ Z
>
ÊÊZ [J
;ObtenerTransaccionesInclusiveActoresYDetalleMaestroYEstadosÊÊ\ ó
(ÊÊó ò
intÊÊò õ
[ÊÊõ ú
]ÊÊú ù
idPuntoDeVentaÊÊû ¨
,ÊÊ¨ ≠
intÊÊÆ ±
[ÊÊ± ≤
]ÊÊ≤ ≥#
idsTiposTransaccionÊÊ¥ «
,ÊÊ« »
DateTimeÊÊ… —

fechaDesdeÊÊ“ ‹
,ÊÊ‹ ›
DateTimeÊÊﬁ Ê

fechaHastaÊÊÁ Ò
,ÊÊÒ Ú
intÊÊÛ ˆ
idUltimoEstadoÊÊ˜ Ö
)ÊÊÖ Ü
{
ÁÁ 	
try
ËË 
{
ÈÈ 
var
ÍÍ 
Resumen
ÍÍ 
=
ÍÍ 
_db
ÍÍ !
.
ÍÍ! "
Transaccion
ÍÍ" -
.
ÎÎ 
Where
ÎÎ 
(
ÎÎ 
t
ÎÎ 
=>
ÎÎ 
t
ÎÎ 
.
ÎÎ 
fecha_inicio
ÎÎ +
>=
ÎÎ, .

fechaDesde
ÎÎ/ 9
&&
ÎÎ: <
t
ÎÎ= >
.
ÎÎ> ?
fecha_inicio
ÎÎ? K
<=
ÎÎL N

fechaHasta
ÎÎO Y
&&
ÏÏ# %!
idsTiposTransaccion
ÏÏ& 9
.
ÏÏ9 :
Contains
ÏÏ: B
(
ÏÏB C
t
ÏÏC D
.
ÏÏD E!
id_tipo_transaccion
ÏÏE X
)
ÏÏX Y
&&
ÌÌ# %
idPuntoDeVenta
ÌÌ& 4
.
ÌÌ4 5
Contains
ÌÌ5 =
(
ÌÌ= >
t
ÌÌ> ?
.
ÌÌ? @&
id_actor_negocio_interno
ÌÌ@ X
)
ÌÌX Y
&&
ÓÓ# %
t
ÓÓ& '
.
ÓÓ' (
id_estado_actual
ÓÓ( 8
==
ÓÓ9 ;
idUltimoEstado
ÓÓ< J
)
ÔÔ 
.
 

SelectMany
 
(
 
t
 
=>
 !
t
" #
.
# $!
Detalle_transaccion
$ 7
)
7 8
.
ÒÒ 
GroupBy
ÒÒ 
(
ÒÒ 
dt
ÒÒ 
=>
ÒÒ 
new
ÒÒ  #
{
ÚÚ 
dt
ÛÛ 
.
ÛÛ 
Concepto_negocio
ÛÛ (
.
ÛÛ( )
codigo
ÛÛ) /
,
ÛÛ/ 0
dt
ÙÙ 
.
ÙÙ !
id_concepto_negocio
ÙÙ +
,
ÙÙ+ ,
conceptoBasico
ıı #
=
ıı$ %
dt
ıı& (
.
ıı( )
Concepto_negocio
ıı) 9
.
ıı9 :
Detalle_maestro4
ıı: J
.
ııJ K
nombre
ııK Q
,
ııQ R
codigoBarra
ˆˆ  
=
ˆˆ! "
dt
ˆˆ# %
.
ˆˆ% &
Concepto_negocio
ˆˆ& 6
.
ˆˆ6 7
codigo_barra
ˆˆ7 C
,
ˆˆC D
conceptoNegocio
˜˜ $
=
˜˜% &
dt
˜˜' )
.
˜˜) *
Concepto_negocio
˜˜* :
.
˜˜: ;
nombre
˜˜; A
,
˜˜A B
}
˙˙ 
)
˙˙ 
.
˙˙ 
Select
˙˙ 
(
˙˙ 
dt
˙˙ 
=>
˙˙  
new
˙˙! $M
?Resumen_Transaccion_Venta_PorConceptoBasico_Y_ConceptoDeNegocio
˙˙% d
(
˙˙d e
)
˙˙e f
{
˚˚ 
IdConceptoNegocio
¸¸ &
=
¸¸' (
dt
¸¸) +
.
¸¸+ ,
Key
¸¸, /
.
¸¸/ 0!
id_concepto_negocio
¸¸0 C
,
¸¸C D
NombreBasico
˝˝ !
=
˝˝" #
dt
˝˝$ &
.
˝˝& '
Key
˝˝' *
.
˝˝* +
conceptoBasico
˝˝+ 9
,
˝˝9 :
CodigoBarra
˛˛  
=
˛˛! "
dt
˛˛# %
.
˛˛% &
Key
˛˛& )
.
˛˛) *
codigoBarra
˛˛* 5
,
˛˛5 6
ConceptoNegocio
ˇˇ $
=
ˇˇ% &
dt
ˇˇ' )
.
ˇˇ) *
Key
ˇˇ* -
.
ˇˇ- .
conceptoNegocio
ˇˇ. =
,
ˇˇ= >
Cantidad
ÄÄ 
=
ÄÄ 
dt
ÄÄ  "
.
ÄÄ" #
Sum
ÄÄ# &
(
ÄÄ& '
a
ÄÄ' (
=>
ÄÄ) +
a
ÄÄ, -
.
ÄÄ- .
cantidad
ÄÄ. 6
)
ÄÄ6 7
,
ÄÄ7 8
Importe
ÅÅ 
=
ÅÅ 
dt
ÅÅ !
.
ÅÅ! "
Sum
ÅÅ" %
(
ÅÅ% &
a
ÅÅ& '
=>
ÅÅ( *
a
ÅÅ+ ,
.
ÅÅ, -
total
ÅÅ- 2
)
ÅÅ2 3
}
ÇÇ 
)
ÇÇ 
;
ÇÇ 
return
ÉÉ 
Resumen
ÉÉ 
;
ÉÉ 
}
ÑÑ 
catch
ÖÖ 
(
ÖÖ 
	Exception
ÖÖ 
e
ÖÖ 
)
ÖÖ 
{
ÜÜ 
throw
áá 
new
áá 
DatosException
áá (
(
áá( )
$str
áá) T
,
ááT U
e
ááV W
)
ááW X
;
ááX Y
}
àà 
}
ââ 	
public
ãã 
IEnumerable
ãã 
<
ãã M
?Resumen_Transaccion_Venta_PorConceptoBasico_Y_ConceptoDeNegocio
ãã Z
>
ããZ [J
;ObtenerTransaccionesInclusiveActoresYDetalleMaestroYEstadosãã\ ó
(ããó ò
intããò õ
[ããõ ú
]ããú ù
idsPuntoDeVentaããû ≠
,ãã≠ Æ
intããØ ≤
[ãã≤ ≥
]ãã≥ ¥#
idsTiposTransaccionããµ »
,ãã» …
intãã  Õ'
idEstadoQueDebeContenerããŒ Â
,ããÂ Ê
DateTimeããÁ Ô

fechaDesdeãã ˙
,ãã˙ ˚
DateTimeãã¸ Ñ

fechaHastaããÖ è
)ããè ê
{
åå 	
try
çç 
{
éé 
var
èè 
Resumen
èè 
=
èè 
_db
èè !
.
èè! "
Transaccion
èè" -
.
êê 
Where
êê 
(
êê 
t
êê 
=>
êê 
t
êê  !
.
êê! "
fecha_inicio
êê" .
>=
êê/ 1

fechaDesde
êê2 <
&&
êê= ?
t
êê@ A
.
êêA B
fecha_inicio
êêB N
<=
êêO Q

fechaHasta
êêR \
&&
ëë !
idsTiposTransaccion
ëë *
.
ëë* +
Contains
ëë+ 3
(
ëë3 4
t
ëë4 5
.
ëë5 6!
id_tipo_transaccion
ëë6 I
)
ëëI J
&&
íí 
idsPuntoDeVenta
íí &
.
íí& '
Contains
íí' /
(
íí/ 0
t
íí0 1
.
íí1 2&
id_actor_negocio_interno
íí2 J
)
ííJ K
&&
ìì 
t
ìì 
.
ìì  
Estado_transaccion
ìì +
.
ìì+ ,
Select
ìì, 2
(
ìì2 3
et
ìì3 5
=>
ìì6 8
et
ìì9 ;
.
ìì; <
	id_estado
ìì< E
)
ììE F
.
ììF G
Contains
ììG O
(
ììO P%
idEstadoQueDebeContener
ììP g
)
ììg h
)
îî 
.
ïï 

SelectMany
ïï 
(
ïï 
t
ïï 
=>
ïï  
t
ïï! "
.
ïï" #!
Detalle_transaccion
ïï# 6
)
ïï6 7
.
ïï7 8
GroupBy
ññ 
(
ññ 
dt
ññ 
=>
ññ 
new
ññ 
{
óó 
dt
òò 
.
òò 
Concepto_negocio
òò %
.
òò% &
codigo
òò& ,
,
òò, -
dt
ôô 
.
ôô !
id_concepto_negocio
ôô (
,
ôô( )
conceptoBasico
öö  
=
öö! "
dt
öö# %
.
öö% &
Concepto_negocio
öö& 6
.
öö6 7
Detalle_maestro4
öö7 G
.
ööG H
nombre
ööH N
,
ööN O
codigoBarra
õõ 
=
õõ 
dt
õõ  "
.
õõ" #
Concepto_negocio
õõ# 3
.
õõ3 4
codigo_barra
õõ4 @
,
õõ@ A
conceptoNegocio
úú !
=
úú" #
dt
úú$ &
.
úú& '
Concepto_negocio
úú' 7
.
úú7 8
nombre
úú8 >
,
úú> ?
precioUnitario
ùù  
=
ùù! "
dt
ùù# %
.
ùù% &
precio_unitario
ùù& 5
}
üü 
)
üü 
.
üü 
Select
üü 
(
üü 
dt
üü 
=>
üü 
new
üü !M
?Resumen_Transaccion_Venta_PorConceptoBasico_Y_ConceptoDeNegocio
üü" a
(
üüa b
)
üüb c
{
†† 
IdConceptoNegocio
°° #
=
°°$ %
dt
°°& (
.
°°( )
Key
°°) ,
.
°°, -!
id_concepto_negocio
°°- @
,
°°@ A
NombreBasico
¢¢ 
=
¢¢  
dt
¢¢! #
.
¢¢# $
Key
¢¢$ '
.
¢¢' (
conceptoBasico
¢¢( 6
,
¢¢6 7
CodigoBarra
££ 
=
££ 
dt
££  "
.
££" #
Key
££# &
.
££& '
codigoBarra
££' 2
,
££2 3
ConceptoNegocio
§§ !
=
§§" #
dt
§§$ &
.
§§& '
Key
§§' *
.
§§* +
conceptoNegocio
§§+ :
,
§§: ;
Cantidad
•• 
=
•• 
dt
•• 
.
••  
Sum
••  #
(
••# $
a
••$ %
=>
••& (
a
••) *
.
••* +
cantidad
••+ 3
)
••3 4
,
••4 5
Importe
¶¶ 
=
¶¶ 
dt
¶¶ 
.
¶¶ 
Sum
¶¶ "
(
¶¶" #
a
¶¶# $
=>
¶¶% '
a
¶¶( )
.
¶¶) *
total
¶¶* /
)
¶¶/ 0
}
®® 
)
®® 
;
®® 
return
©© 
Resumen
©© 
.
©© 
OrderBy
©© &
(
©©& '
r
©©' (
=>
©©) +
r
©©, -
.
©©- .
CodigoBarra
©©. 9
!=
©©: <
null
©©= A
?
©©B C
r
©©D E
.
©©E F
CodigoBarra
©©F Q
:
©©R S
r
©©T U
.
©©U V
ConceptoNegocio
©©V e
)
©©e f
;
©©f g
}
™™ 
catch
´´ 
(
´´ 
	Exception
´´ 
e
´´ 
)
´´ 
{
¨¨ 
throw
≠≠ 
new
≠≠ 
DatosException
≠≠ (
(
≠≠( )
$str
≠≠) T
,
≠≠T U
e
≠≠V W
)
≠≠W X
;
≠≠X Y
}
ÆÆ 
}
ØØ 	
public
±± 
IEnumerable
±± 
<
±± 7
)Resumen_Detalles_Consolidado_Por_Vendedor
±± D
>
±±D E:
,ObtenerResumenDetallesConsolidadoPorVendedor
±±F r
(
±±r s
int
±±s v
[
±±v w
]
±±w x
idsTransaccion±±y á
,±±á à
int±±â å
idEstadoActual±±ç õ
,±±õ ú
int±±ù †

idEmpleado±±° ´
,±±´ ¨
DateTime±±≠ µ

fechaDesde±±∂ ¿
,±±¿ ¡
DateTime±±¬  

fechaHasta±±À ’
)±±’ ÷
{
≤≤ 	
try
≥≥ 
{
¥¥ 
var
µµ 
Resumen
µµ 
=
µµ 
_db
µµ !
.
µµ! "
Transaccion
µµ" -
.
µµ- .
Where
µµ. 3
(
µµ3 4
sbt
µµ4 7
=>
µµ8 :
sbt
µµ; >
.
µµ> ?
fecha_inicio
µµ? K
>=
µµL N

fechaDesde
µµO Y
&&
µµZ \
sbt
µµ] `
.
µµ` a
fecha_inicio
µµa m
<=
µµn p

fechaHasta
µµq {
&&
µµ| ~
idsTransaccionµµ ç
.µµç é
Containsµµé ñ
(µµñ ó
sbtµµó ö
.µµö õ#
id_tipo_transaccionµµõ Æ
)µµÆ Ø
&&µµ∞ ≤
sbtµµ≥ ∂
.µµ∂ ∑
id_empleadoµµ∑ ¬
==µµ√ ≈

idEmpleadoµµ∆ –
&&µµ— ”
sbtµµ‘ ◊
.µµ◊ ÿ 
id_estado_actualµµÿ Ë
==µµÈ Î
idEstadoActualµµÏ ˙
)µµ˙ ˚
.µµ˚ ¸

SelectManyµµ¸ Ü
(µµÜ á
tµµá à
=>µµâ ã
tµµå ç
.µµç é#
Detalle_transaccionµµé °
)µµ° ¢
.µµ¢ £
GroupBy
∂∂ 
(
∂∂ 
dt
∂∂ 
=>
∂∂ 
new
∂∂  
{
∑∑ 
idTipoTransaccion
∏∏ $
=
∏∏% &
dt
∏∏' )
.
∏∏) *
Transaccion
∏∏* 5
.
∏∏5 6!
id_tipo_transaccion
∏∏6 I
,
∏∏I J

idEmpleado
ππ 
=
ππ 
dt
ππ  "
.
ππ" #
Transaccion
ππ# .
.
ππ. /
id_empleado
ππ/ :
,
ππ: ;
idConceptoNegocio
∫∫ $
=
∫∫% &
dt
∫∫' )
.
∫∫) *
Concepto_negocio
∫∫* :
.
∫∫: ;
id
∫∫; =
,
∫∫= >
precioUnitario
ªª !
=
ªª" #
dt
ªª$ &
.
ªª& '
precio_unitario
ªª' 6
}
ºº 
)
ºº 
.
ºº 
Select
ºº 
(
ºº 
dt
ºº 
=>
ºº 
new
ºº "7
)Resumen_Detalles_Consolidado_Por_Vendedor
ºº# L
(
ººL M
)
ººM N
{
ΩΩ 
IdTipoTransaccion
ææ $
=
ææ% &
dt
ææ' )
.
ææ) *
Key
ææ* -
.
ææ- .
idTipoTransaccion
ææ. ?
,
ææ? @
IdConceptoBasico
øø #
=
øø$ %
dt
øø& (
.
øø( )
FirstOrDefault
øø) 7
(
øø7 8
)
øø8 9
.
øø9 :
Concepto_negocio
øø: J
.
øøJ K
Detalle_maestro4
øøK [
.
øø[ \
id
øø\ ^
,
øø^ _
ConceptoBasico
¿¿ !
=
¿¿" #
dt
¿¿$ &
.
¿¿& '
FirstOrDefault
¿¿' 5
(
¿¿5 6
)
¿¿6 7
.
¿¿7 8
Concepto_negocio
¿¿8 H
.
¿¿H I
Detalle_maestro4
¿¿I Y
.
¿¿Y Z
nombre
¿¿Z `
,
¿¿` a
IdConceptoNegocio
¡¡ $
=
¡¡% &
dt
¡¡' )
.
¡¡) *
Key
¡¡* -
.
¡¡- .
idConceptoNegocio
¡¡. ?
,
¡¡? @
CodigoBarra
¬¬ 
=
¬¬  
dt
¬¬! #
.
¬¬# $
FirstOrDefault
¬¬$ 2
(
¬¬2 3
)
¬¬3 4
.
¬¬4 5
Concepto_negocio
¬¬5 E
.
¬¬E F
codigo_barra
¬¬F R
,
¬¬R S
ConceptoNegocio
√√ "
=
√√# $
dt
√√% '
.
√√' (
FirstOrDefault
√√( 6
(
√√6 7
)
√√7 8
.
√√8 9
Concepto_negocio
√√9 I
.
√√I J
nombre
√√J P
,
√√P Q
Cantidad
ƒƒ 
=
ƒƒ 
dt
ƒƒ  
.
ƒƒ  !
Sum
ƒƒ! $
(
ƒƒ$ %
c
ƒƒ% &
=>
ƒƒ' )
c
ƒƒ* +
.
ƒƒ+ ,
cantidad
ƒƒ, 4
)
ƒƒ4 5
,
ƒƒ5 6
Importe
≈≈ 
=
≈≈ 
dt
≈≈ 
.
≈≈  
Sum
≈≈  #
(
≈≈# $
i
≈≈$ %
=>
≈≈& (
i
≈≈) *
.
≈≈* +
total
≈≈+ 0
)
≈≈0 1
}
∆∆ 
)
∆∆ 
;
∆∆ 
return
«« 
Resumen
«« 
.
«« 
OrderBy
«« &
(
««& '
r
««' (
=>
««) +
r
««, -
.
««- .
CodigoBarra
««. 9
??
««: <
r
««= >
.
««> ?
ConceptoNegocio
««? N
)
««N O
;
««O P
}
»» 
catch
…… 
(
…… 
	Exception
…… 
e
…… 
)
…… 
{
   
throw
ÀÀ 
e
ÀÀ 
;
ÀÀ 
}
ÃÃ 
}
ÕÕ 	
public
œœ 
IEnumerable
œœ 
<
œœ 7
)Resumen_Detalles_Consolidado_Por_Vendedor
œœ D
>
œœD E<
.ObtenerResumenDetallesConsolidadoPorVendedores
œœF t
(
œœt u
int
œœu x
[
œœx y
]
œœy z
idsTransaccionœœ{ â
,œœâ ä
intœœã é
idEstadoActualœœè ù
,œœù û
intœœü ¢
[œœ¢ £
]œœ£ §
idsEmpleadoœœ• ∞
,œœ∞ ±
DateTimeœœ≤ ∫

fechaDesdeœœª ≈
,œœ≈ ∆
DateTimeœœ« œ

fechaHastaœœ– ⁄
)œœ⁄ €
{
–– 	
try
—— 
{
““ 
var
”” 
Resumen
”” 
=
”” 
_db
”” !
.
””! "
Transaccion
””" -
.
””- .
Where
””. 3
(
””3 4
sbt
””4 7
=>
””8 :
sbt
””; >
.
””> ?
fecha_inicio
””? K
>=
””L N

fechaDesde
””O Y
&&
””Z \
sbt
””] `
.
””` a
fecha_inicio
””a m
<=
””n p

fechaHasta
””q {
&&
””| ~
idsTransaccion”” ç
.””ç é
Contains””é ñ
(””ñ ó
sbt””ó ö
.””ö õ#
id_tipo_transaccion””õ Æ
)””Æ Ø
&&””∞ ≤
idsEmpleado””≥ æ
.””æ ø
Contains””ø «
(””« »
sbt””» À
.””À Ã
id_empleado””Ã ◊
)””◊ ÿ
&&””Ÿ €
sbt””‹ ﬂ
.””ﬂ ‡ 
id_estado_actual””‡ 
==””Ò Û
idEstadoActual””Ù Ç
)””Ç É
.””É Ñ

SelectMany””Ñ é
(””é è
t””è ê
=>””ë ì
t””î ï
.””ï ñ#
Detalle_transaccion””ñ ©
)””© ™
.””™ ´
GroupBy
‘‘ 
(
‘‘ 
dt
‘‘ 
=>
‘‘ 
new
‘‘  
{
’’ 
idTipoTransaccion
÷÷ $
=
÷÷% &
dt
÷÷' )
.
÷÷) *
Transaccion
÷÷* 5
.
÷÷5 6!
id_tipo_transaccion
÷÷6 I
,
÷÷I J

idEmpleado
◊◊ 
=
◊◊ 
dt
◊◊  "
.
◊◊" #
Transaccion
◊◊# .
.
◊◊. /
id_empleado
◊◊/ :
,
◊◊: ;
idConceptoBasico
ÿÿ #
=
ÿÿ$ %
dt
ÿÿ& (
.
ÿÿ( )
Concepto_negocio
ÿÿ) 9
.
ÿÿ9 :
Detalle_maestro4
ÿÿ: J
.
ÿÿJ K
id
ÿÿK M
,
ÿÿM N
}
ŸŸ 
)
ŸŸ 
.
ŸŸ 
Select
ŸŸ 
(
ŸŸ 
dt
ŸŸ 
=>
ŸŸ 
new
ŸŸ "7
)Resumen_Detalles_Consolidado_Por_Vendedor
ŸŸ# L
(
ŸŸL M
)
ŸŸM N
{
⁄⁄ 
IdTipoTransaccion
€€ $
=
€€% &
dt
€€' )
.
€€) *
Key
€€* -
.
€€- .
idTipoTransaccion
€€. ?
,
€€? @

IdEmpleado
‹‹ 
=
‹‹ 
dt
‹‹  "
.
‹‹" #
Key
‹‹# &
.
‹‹& '

idEmpleado
‹‹' 1
,
‹‹1 2
Empleado
›› 
=
›› 
dt
››  
.
››  !
FirstOrDefault
››! /
(
››/ 0
)
››0 1
.
››1 2
Transaccion
››2 =
.
››= >
Actor_negocio
››> K
.
››K L
Actor
››L Q
.
››Q R(
numero_documento_identidad
››R l
+
››m n
$str
››o t
+
››u v
dt
››w y
.
››y z
FirstOrDefault››z à
(››à â
)››â ä
.››ä ã
Transaccion››ã ñ
.››ñ ó
Actor_negocio››ó §
.››§ •
Actor››• ™
.››™ ´
primer_nombre››´ ∏
.››∏ π
Replace››π ¿
(››¿ ¡
$str››¡ ƒ
,››ƒ ≈
$str››∆ …
)››…  
,››  À
IdConceptoBasico
ﬁﬁ #
=
ﬁﬁ$ %
dt
ﬁﬁ& (
.
ﬁﬁ( )
FirstOrDefault
ﬁﬁ) 7
(
ﬁﬁ7 8
)
ﬁﬁ8 9
.
ﬁﬁ9 :
Concepto_negocio
ﬁﬁ: J
.
ﬁﬁJ K
Detalle_maestro4
ﬁﬁK [
.
ﬁﬁ[ \
id
ﬁﬁ\ ^
,
ﬁﬁ^ _
ConceptoBasico
ﬂﬂ !
=
ﬂﬂ" #
dt
ﬂﬂ$ &
.
ﬂﬂ& '
FirstOrDefault
ﬂﬂ' 5
(
ﬂﬂ5 6
)
ﬂﬂ6 7
.
ﬂﬂ7 8
Concepto_negocio
ﬂﬂ8 H
.
ﬂﬂH I
Detalle_maestro4
ﬂﬂI Y
.
ﬂﬂY Z
nombre
ﬂﬂZ `
,
ﬂﬂ` a
Cantidad
‡‡ 
=
‡‡ 
dt
‡‡  
.
‡‡  !
Sum
‡‡! $
(
‡‡$ %
c
‡‡% &
=>
‡‡' )
c
‡‡* +
.
‡‡+ ,
cantidad
‡‡, 4
)
‡‡4 5
,
‡‡5 6
Importe
·· 
=
·· 
dt
·· 
.
··  
Sum
··  #
(
··# $
i
··$ %
=>
··& (
i
··) *
.
··* +
total
··+ 0
)
··0 1
}
‚‚ 
)
‚‚ 
;
‚‚ 
return
„„ 
Resumen
„„ 
.
„„ 
OrderBy
„„ &
(
„„& '
r
„„' (
=>
„„) +
r
„„, -
.
„„- .
IdConceptoBasico
„„. >
)
„„> ?
;
„„? @
}
‰‰ 
catch
ÂÂ 
(
ÂÂ 
	Exception
ÂÂ 
e
ÂÂ 
)
ÂÂ 
{
ÊÊ 
throw
ÁÁ 
e
ÁÁ 
;
ÁÁ 
}
ËË 
}
ÈÈ 	
public
ÎÎ 
IEnumerable
ÎÎ 
<
ÎÎ ?
1Resumen_Por_Concepto_Por_Vendedor_Contado_Credito
ÎÎ L
>
ÎÎL ME
6ObtenerConsolidadoPorVendedoresPorModoPagoPorConcepto_ÎÎN Ñ
(ÎÎÑ Ö
intÎÎÖ à
[ÎÎà â
]ÎÎâ ä"
idsTipoTransaccionÎÎã ù
,ÎÎù û
intÎÎü ¢
idEstadoActualÎÎ£ ±
,ÎÎ± ≤
intÎÎ≥ ∂
[ÎÎ∂ ∑
]ÎÎ∑ ∏
idsEmpleadoÎÎπ ƒ
,ÎÎƒ ≈
intÎÎ∆ …
idParametroÎÎ  ’
,ÎÎ’ ÷
stringÎÎ◊ ›
valorParametroÎÎﬁ Ï
,ÎÎÏ Ì
DateTimeÎÎÓ ˆ

fechaDesdeÎÎ˜ Å
,ÎÎÅ Ç
DateTimeÎÎÉ ã

fechaHastaÎÎå ñ
)ÎÎñ ó
{
ÏÏ 	
try
ÌÌ 
{
ÓÓ 
var
ÔÔ 
Resumen
ÔÔ 
=
ÔÔ 
_db
ÔÔ !
.
ÔÔ! "
Transaccion
ÔÔ" -
.
ÔÔ- .
Where
ÔÔ. 3
(
ÔÔ3 4
sbt
ÔÔ4 7
=>
ÔÔ8 :
sbt
ÔÔ; >
.
ÔÔ> ?
fecha_inicio
ÔÔ? K
>=
ÔÔL N

fechaDesde
ÔÔO Y
&&
ÔÔZ \
sbt
ÔÔ] `
.
ÔÔ` a
fecha_inicio
ÔÔa m
<=
ÔÔn p

fechaHasta
ÔÔq {
&&
ÔÔ| ~!
idsTipoTransaccionÔÔ ë
.ÔÔë í
ContainsÔÔí ö
(ÔÔö õ
sbtÔÔõ û
.ÔÔû ü#
id_tipo_transaccionÔÔü ≤
)ÔÔ≤ ≥
&&ÔÔ¥ ∂
idsEmpleadoÔÔ∑ ¬
.ÔÔ¬ √
ContainsÔÔ√ À
(ÔÔÀ Ã
sbtÔÔÃ œ
.ÔÔœ –
id_empleadoÔÔ– €
)ÔÔ€ ‹
&&ÔÔ› ﬂ
sbtÔÔ‡ „
.ÔÔ„ ‰ 
id_estado_actualÔÔ‰ Ù
==ÔÔı ˜
idEstadoActualÔÔ¯ Ü
)ÔÔÜ á
.ÔÔá à

SelectManyÔÔà í
(ÔÔí ì
tÔÔì î
=>ÔÔï ó
tÔÔò ô
.ÔÔô ö#
Detalle_transaccionÔÔö ≠
)ÔÔ≠ Æ
.ÔÔÆ Ø
GroupBy
 
(
 
dt
 
=>
 
new
  
{
ÒÒ 
idTipoTransaccion
ÚÚ $
=
ÚÚ% &
dt
ÚÚ' )
.
ÚÚ) *
Transaccion
ÚÚ* 5
.
ÚÚ5 6!
id_tipo_transaccion
ÚÚ6 I
,
ÚÚI J

idEmpleado
ÛÛ 
=
ÛÛ 
dt
ÛÛ  "
.
ÛÛ" #
Transaccion
ÛÛ# .
.
ÛÛ. /
id_empleado
ÛÛ/ :
,
ÛÛ: ;
idConceptoNegocio
ÙÙ $
=
ÙÙ% &
dt
ÙÙ' )
.
ÙÙ) *
Concepto_negocio
ÙÙ* :
.
ÙÙ: ;
id
ÙÙ; =
,
ÙÙ= >
	esContado
ıı 
=
ıı 
dt
ıı !
.
ıı! "
Transaccion
ıı" -
.
ıı- .#
Parametro_transaccion
ıı. C
.
ııC D
FirstOrDefault
ııD R
(
ııR S
pt
ııS U
=>
ııV X
pt
ııY [
.
ıı[ \
id_parametro
ıı\ h
==
ııi k
idParametro
ııl w
)
ııw x
.
ııx y
valor
ııy ~
.
ıı~ 
Equalsıı Ö
(ııÖ Ü
valorParametroııÜ î
)ııî ï
}
ˆˆ 
)
ˆˆ 
.
ˆˆ 
Select
ˆˆ 
(
ˆˆ 
dt
ˆˆ 
=>
ˆˆ 
new
ˆˆ "?
1Resumen_Por_Concepto_Por_Vendedor_Contado_Credito
ˆˆ# T
(
ˆˆT U
)
ˆˆU V
{
˜˜ 
IdTipoTransaccion
¯¯ $
=
¯¯% &
dt
¯¯' )
.
¯¯) *
Key
¯¯* -
.
¯¯- .
idTipoTransaccion
¯¯. ?
,
¯¯? @

IdEmpleado
˘˘ 
=
˘˘ 
dt
˘˘  "
.
˘˘" #
Key
˘˘# &
.
˘˘& '

idEmpleado
˘˘' 1
,
˘˘1 2
Empleado
˙˙ 
=
˙˙ 
dt
˙˙  
.
˙˙  !
FirstOrDefault
˙˙! /
(
˙˙/ 0
)
˙˙0 1
.
˙˙1 2
Transaccion
˙˙2 =
.
˙˙= >
Actor_negocio
˙˙> K
.
˙˙K L
Actor
˙˙L Q
.
˙˙Q R(
numero_documento_identidad
˙˙R l
+
˙˙m n
$str
˙˙o t
+
˙˙u v
dt
˙˙w y
.
˙˙y z
FirstOrDefault˙˙z à
(˙˙à â
)˙˙â ä
.˙˙ä ã
Transaccion˙˙ã ñ
.˙˙ñ ó
Actor_negocio˙˙ó §
.˙˙§ •
Actor˙˙• ™
.˙˙™ ´
primer_nombre˙˙´ ∏
.˙˙∏ π
Replace˙˙π ¿
(˙˙¿ ¡
$str˙˙¡ ƒ
,˙˙ƒ ≈
$str˙˙∆ …
)˙˙…  
,˙˙  À
IdConceptoNegocio
˚˚ $
=
˚˚% &
dt
˚˚' )
.
˚˚) *
Key
˚˚* -
.
˚˚- .
idConceptoNegocio
˚˚. ?
,
˚˚? @
ConceptoNegocio
¸¸ "
=
¸¸# $
dt
¸¸% '
.
¸¸' (
FirstOrDefault
¸¸( 6
(
¸¸6 7
)
¸¸7 8
.
¸¸8 9
Concepto_negocio
¸¸9 I
.
¸¸I J
nombre
¸¸J P
,
¸¸P Q
CodigoBarra
˝˝ 
=
˝˝  
dt
˝˝! #
.
˝˝# $
FirstOrDefault
˝˝$ 2
(
˝˝2 3
)
˝˝3 4
.
˝˝4 5
Concepto_negocio
˝˝5 E
.
˝˝E F
codigo_barra
˝˝F R
,
˝˝R S
Cantidad
˛˛ 
=
˛˛ 
dt
˛˛  
.
˛˛  !
Sum
˛˛! $
(
˛˛$ %
i
˛˛% &
=>
˛˛' )
i
˛˛* +
.
˛˛+ ,
cantidad
˛˛, 4
)
˛˛4 5
,
˛˛5 6
Importe
ˇˇ 
=
ˇˇ 
dt
ˇˇ 
.
ˇˇ  
Sum
ˇˇ  #
(
ˇˇ# $
i
ˇˇ$ %
=>
ˇˇ& (
i
ˇˇ) *
.
ˇˇ* +
total
ˇˇ+ 0
)
ˇˇ0 1
,
ˇˇ1 2
	EsContado
ÅÅ 
=
ÅÅ 
dt
ÅÅ !
.
ÅÅ! "
Key
ÅÅ" %
.
ÅÅ% &
	esContado
ÅÅ& /
}
ÇÇ 
)
ÇÇ 
;
ÇÇ 
return
ÉÉ 
Resumen
ÉÉ 
.
ÉÉ 
OrderBy
ÉÉ &
(
ÉÉ& '
r
ÉÉ' (
=>
ÉÉ) +
r
ÉÉ, -
.
ÉÉ- .
CodigoBarra
ÉÉ. 9
??
ÉÉ: <
r
ÉÉ= >
.
ÉÉ> ?
ConceptoNegocio
ÉÉ? N
)
ÉÉN O
;
ÉÉO P
}
ÑÑ 
catch
ÖÖ 
(
ÖÖ 
	Exception
ÖÖ 
e
ÖÖ 
)
ÖÖ 
{
ÜÜ 
throw
áá 
e
áá 
;
áá 
}
àà 
}
ââ 	
public
åå 
IEnumerable
åå 
<
åå ?
1Resumen_Por_Concepto_Por_Vendedor_Contado_Credito
åå L
>
ååL MD
5ObtenerConsolidadoPorVendedoresPorModoPagoPorConceptoååN É
(ååÉ Ñ
intååÑ á
[ååá à
]ååà â"
idsTipoTransaccionååä ú
,ååú ù
intååû °
idEstadoActualåå¢ ∞
,åå∞ ±
intåå≤ µ
[ååµ ∂
]åå∂ ∑
idsEmpleadoåå∏ √
,åå√ ƒ
intåå≈ »
idParametroåå… ‘
,åå‘ ’
stringåå÷ ‹
valorParametroåå› Î
,ååÎ Ï
DateTimeååÌ ı

fechaDesdeååˆ Ä
,ååÄ Å
DateTimeååÇ ä

fechaHastaååã ï
)ååï ñ
{
çç 	
try
éé 
{
èè 
List
êê 
<
êê ?
1Resumen_Por_Concepto_Por_Vendedor_Contado_Credito
êê F
>
êêF G
	resultado
êêH Q
=
êêR S
new
êêT W
List
êêX \
<
êê\ ]@
1Resumen_Por_Concepto_Por_Vendedor_Contado_Creditoêê] é
>êêé è
(êêè ê
)êêê ë
;êêë í
var
ëë #
detallesTransacciones
ëë )
=
ëë* +
_db
ëë, /
.
ëë/ 0
Transaccion
ëë0 ;
.
ëë; <
Where
ëë< A
(
ëëA B
sbt
ëëB E
=>
ëëF H
sbt
ëëI L
.
ëëL M
fecha_inicio
ëëM Y
>=
ëëZ \

fechaDesde
ëë] g
&&
ëëh j
sbt
ëëk n
.
ëën o
fecha_inicio
ëëo {
<=
ëë| ~

fechaHastaëë â
&&ëëä å"
idsTipoTransaccionëëç ü
.ëëü †
Containsëë† ®
(ëë® ©
sbtëë© ¨
.ëë¨ ≠#
id_tipo_transaccionëë≠ ¿
)ëë¿ ¡
&&ëë¬ ƒ
idsEmpleadoëë≈ –
.ëë– —
Containsëë— Ÿ
(ëëŸ ⁄
sbtëë⁄ ›
.ëë› ﬁ
id_empleadoëëﬁ È
)ëëÈ Í
&&ëëÎ Ì
sbtëëÓ Ò
.ëëÒ Ú 
id_estado_actualëëÚ Ç
==ëëÉ Ö
idEstadoActualëëÜ î
)ëëî ï
.ëëï ñ

SelectManyëëñ †
(ëë† °
tëë° ¢
=>ëë£ •
tëë¶ ß
.ëëß ®#
Detalle_transaccionëë® ª
)ëëª º
.ëëº Ω
ToListëëΩ √
(ëë√ ƒ
)ëëƒ ≈
;ëë≈ ∆
var
íí 
idsTransacciones
íí $
=
íí% &#
detallesTransacciones
íí' <
.
íí< =
Select
íí= C
(
ííC D
d
ííD E
=>
ííE G
d
ííH I
.
ííI J
id_transaccion
ííJ X
)
ííX Y
.
ííY Z
Distinct
ííZ b
(
ííb c
)
ííc d
.
ííd e
ToArray
ííe l
(
ííl m
)
íím n
;
íín o
var
ìì 
contadoCredito
ìì "
=
ìì" #
_db
ìì$ '
.
ìì' (#
Parametro_transaccion
ìì( =
.
ìì= >
Where
ìì> C
(
ììC D
pt
ììD F
=>
ììG I
idsTransacciones
ììJ Z
.
ììZ [
Contains
ìì[ c
(
ììc d
pt
ììd f
.
ììf g
id_transaccion
ììg u
)
ììu v
&&
ììw y
pt
ììz |
.
ìì| }
id_parametroìì} â
==ììä å
idParametroììç ò
)ììô ö
.ììö õ
Selectììõ °
(ìì° ¢
ptìì¢ §
=>ìì§ ¶
newììß ™
{ìì´ ¨
IdTransaccionìì¨ π
=ììπ ∫
ptìì∫ º
.ììº Ω
id_transaccionììΩ À
,ììÀ Ã
ContadoCreditoììÕ €
=ìì€ ‹
ptìì› ﬂ
.ììﬂ ‡
valorìì‡ Â
}ììÂ Ê
)ììÊ Á
.ììÁ Ë
ToListììË Ó
(ììÓ Ô
)ììÔ 
;ìì Ò
var
îî 
idsConceptos
îî  
=
îî! "#
detallesTransacciones
îî# 8
.
îî8 9
Select
îî9 ?
(
îî? @
dt
îî@ B
=>
îîC E
dt
îîF H
.
îîH I!
id_concepto_negocio
îîI \
)
îî\ ]
.
îî] ^
Distinct
îî^ f
(
îîf g
)
îîg h
.
îîh i
ToArray
îîi p
(
îîp q
)
îîq r
;
îîr s
var
ïï 
	conceptos
ïï 
=
ïï 
_db
ïï  #
.
ïï# $
Concepto_negocio
ïï$ 4
.
ïï4 5
Where
ïï5 :
(
ïï: ;
cn
ïï; =
=>
ïï= ?
idsConceptos
ïï@ L
.
ïïL M
Contains
ïïM U
(
ïïU V
cn
ïïV X
.
ïïX Y
id
ïïY [
)
ïï[ \
)
ïï\ ]
.
ïï] ^
Select
ïï^ d
(
ïïd e
cn
ïïe g
=>
ïïh j
new
ïïk n
{
ïïo p

IdConcepto
ïïq {
=
ïï| }
cnïï~ Ä
.ïïÄ Å
idïïÅ É
,ïïÉ Ñ
CodigoBarraïïÖ ê
=ïïë í
cnïïì ï
.ïïï ñ
codigo_barraïïñ ¢
,ïï¢ £
Nombreïï§ ™
=ïï´ ¨
cnïï≠ Ø
.ïïØ ∞
nombreïï∞ ∂
}ïï∑ ∏
)ïï∏ π
;ïïπ ∫
var
ññ  
tiposTransacciones
ññ &
=
ññ' (
_db
ññ) ,
.
ññ, -
Transaccion
ññ- 8
.
ññ8 9
Where
ññ9 >
(
ññ> ?
t
ññ? @
=>
ññA C
idsTransacciones
ññD T
.
ññT U
Contains
ññU ]
(
ññ] ^
t
ññ^ _
.
ññ_ `
id
ññ` b
)
ññb c
)
ññc d
.
ññd e
Select
ññe k
(
ññk l
t
ññl m
=>
ññn p
new
ññq t
{
ññu v
IdTransaccionññw Ñ
=ññÖ Ü
tññá à
.ññà â
idññâ ã
,ññã å!
IdTipoTransaccionññç û
=ññü †
tññ° ¢
.ññ¢ £#
id_tipo_transaccionññ£ ∂
}ññ∑ ∏
)ññ∏ π
;ññπ ∫
var
óó 
	empleados
óó 
=
óó 
_db
óó  #
.
óó# $
Transaccion
óó$ /
.
óó/ 0
Where
óó0 5
(
óó5 6
t
óó6 7
=>
óó8 :
idsTransacciones
óó; K
.
óóK L
Contains
óóL T
(
óóT U
t
óóU V
.
óóV W
id
óóW Y
)
óóY Z
)
óóZ [
.
óó[ \
Select
óó\ b
(
óób c
t
óóc d
=>
óóe g
new
óóh k
{
óól m
IdTransaccion
óóm z
=
óó{ |
t
óó} ~
.
óó~ 
idóó Å
,óóÅ Ç

IdEmpleadoóóÉ ç
=óóç é
tóóé è
.óóè ê
id_empleadoóóê õ
,óóõ ú
Nombreóóù £
=óó§ •
tóó¶ ß
.óóß ®
Actor_negocioóó® µ
.óóµ ∂
Actoróó∂ ª
.óóª º*
numero_documento_identidadóóº ÷
+óó◊ ÿ
$stróóŸ ﬁ
+óóﬂ ‡
tóó· ‚
.óó‚ „
Actor_negocioóó„ 
.óó Ò
ActoróóÒ ˆ
.óóˆ ˜
primer_nombreóó˜ Ñ
.óóÑ Ö
ReplaceóóÖ å
(óóå ç
$stróóç ê
,óóê ë
$stróóí ï
)óóï ñ
}óóó ò
)óóò ô
;óóô ö
	resultado
ôô 
=
ôô #
detallesTransacciones
ôô 0
.
ôô0 1
Select
ôô1 7
(
ôô7 8
dt
ôô8 :
=>
ôô: <
new
ôô= @?
1Resumen_Por_Concepto_Por_Vendedor_Contado_Credito
ôôA r
(
ôôr s
)
ôôs t
{
ôôu v
IdTipoTransaccion
öö %
=
öö% & 
tiposTransacciones
öö' 9
.
öö9 :
Single
öö: @
(
öö@ A
tt
ööA C
=>
ööC E
tt
ööE G
.
ööG H
IdTransaccion
ööH U
==
ööU W
dt
ööX Z
.
ööZ [
id_transaccion
öö[ i
)
ööi j
.
ööj k
IdTipoTransaccion
öök |
,
öö| }

IdEmpleado
õõ 
=
õõ 
	empleados
õõ %
.
õõ% &
Single
õõ& ,
(
õõ, -
e
õõ- .
=>
õõ/ 1
e
õõ2 3
.
õõ3 4
IdTransaccion
õõ4 A
==
õõB D
dt
õõE G
.
õõG H
id_transaccion
õõH V
)
õõV W
.
õõW X

IdEmpleado
õõX b
,
õõb c
Empleado
úú 
=
úú 
	empleados
úú #
.
úú# $
Single
úú$ *
(
úú* +
e
úú+ ,
=>
úú- /
e
úú0 1
.
úú1 2
IdTransaccion
úú2 ?
==
úú@ B
dt
úúC E
.
úúE F
id_transaccion
úúF T
)
úúT U
.
úúU V
Nombre
úúV \
,
úú\ ]
IdConceptoNegocio
úú^ o
=
úúo p
dt
úúq s
.
úús t"
id_concepto_negocioúút á
,úúá à
ConceptoNegocio
ùù 
=
ùù  
	conceptos
ùù! *
.
ùù* +
Single
ùù+ 1
(
ùù1 2
c
ùù2 3
=>
ùù4 6
c
ùù7 8
.
ùù8 9

IdConcepto
ùù9 C
==
ùùD F
dt
ùùG I
.
ùùI J!
id_concepto_negocio
ùùJ ]
)
ùù] ^
.
ùù^ _
Nombre
ùù_ e
,
ùùe f
CodigoBarra
ûû 
=
ûû 
	conceptos
ûû &
.
ûû& '
Single
ûû' -
(
ûû- .
c
ûû. /
=>
ûû0 2
c
ûû3 4
.
ûû4 5

IdConcepto
ûû5 ?
==
ûû@ B
dt
ûûC E
.
ûûE F!
id_concepto_negocio
ûûF Y
)
ûûY Z
.
ûûZ [
CodigoBarra
ûû[ f
,
ûûf g
Cantidad
üü 
=
üü 
dt
üü 
.
üü 
cantidad
üü &
,
üü& '
Importe
üü( /
=
üü/ 0
dt
üü1 3
.
üü3 4
total
üü4 9
,
üü9 :
	EsContado
†† 
=
†† 
contadoCredito
†† )
.
††) *
Single
††* 0
(
††0 1
cc
††1 3
=>
††4 6
cc
††7 9
.
††9 :
IdTransaccion
††: G
==
††H J
dt
††K M
.
††M N
id_transaccion
††N \
)
††\ ]
.
††] ^
ContadoCredito
††^ l
.
††l m
Equals
††m s
(
††s t
valorParametro††t Ç
)††Ç É
}
°° 
)
°° 
.
°° 
ToList
°° 
(
°° 
)
°° 
;
°° 
	resultado
££ 
=
££ 
	resultado
££ %
.
££% &
GroupBy
££& -
(
££- .
r
££. /
=>
££/ 1
new
££2 5
{
££6 7
idTipoTransaccion
££8 I
=
££J K
r
££L M
.
££M N
IdTipoTransaccion
££N _
,
££_ `

idEmpleado
££a k
=
££l m
r
££n o
.
££o p

IdEmpleado
££p z
,
££z { 
idConceptoNegocio££| ç
=££é è
r££ê ë
.££ë í!
IdConceptoNegocio££í £
,£££ §
	esContado££• Æ
=££Ø ∞
r££± ≤
.££≤ ≥
	EsContado££≥ º
}££Ω æ
)££æ ø
.££ø ¿
Select££¿ ∆
(££∆ «
r££« »
=>££… À
new££Ã œA
1Resumen_Por_Concepto_Por_Vendedor_Contado_Credito££– Å
(££Å Ç
)££Ç É
{
§§ 
IdTipoTransaccion
•• %
=
••& '
r
••( )
.
••) *
Key
••* -
.
••- .
idTipoTransaccion
••. ?
,
••? @

IdEmpleado
••A K
=
••L M
r
••N O
.
••O P
Key
••P S
.
••S T

idEmpleado
••T ^
,
••^ _
Empleado
••` h
=
••i j
r
••k l
.
••l m
FirstOrDefault
••m {
(
••{ |
)
••| }
.
••} ~
Empleado••~ Ü
,••Ü á
IdConceptoNegocio
¶¶ %
=
¶¶& '
r
¶¶( )
.
¶¶) *
Key
¶¶* -
.
¶¶- .
idConceptoNegocio
¶¶. ?
,
¶¶? @
ConceptoNegocio
¶¶A P
=
¶¶Q R
r
¶¶S T
.
¶¶T U
FirstOrDefault
¶¶U c
(
¶¶c d
)
¶¶d e
.
¶¶e f
ConceptoNegocio
¶¶f u
,
¶¶u v
CodigoBarra
ßß 
=
ßß  !
r
ßß" #
.
ßß# $
FirstOrDefault
ßß$ 2
(
ßß2 3
)
ßß3 4
.
ßß4 5
CodigoBarra
ßß5 @
,
ßß@ A
Cantidad
ßßB J
=
ßßK L
r
ßßM N
.
ßßN O
Sum
ßßO R
(
ßßR S
i
ßßS T
=>
ßßU W
i
ßßX Y
.
ßßY Z
Cantidad
ßßZ b
)
ßßb c
,
ßßc d
Importe
®® 
=
®® 
r
®® 
.
®®  
Sum
®®  #
(
®®# $
i
®®$ %
=>
®®& (
i
®®) *
.
®®* +
Importe
®®+ 2
)
®®2 3
,
®®3 4
	EsContado
®®5 >
=
®®? @
r
®®A B
.
®®B C
Key
®®C F
.
®®F G
	esContado
®®G P
}
©© 
)
©© 
.
©© 
OrderBy
©© 
(
©© 
r
©© 
=>
©© 
r
©©  !
.
©©! "
CodigoBarra
©©" -
??
©©. 0
r
©©1 2
.
©©2 3
ConceptoNegocio
©©3 B
)
©©B C
.
©©C D
ToList
©©D J
(
©©J K
)
©©K L
;
©©L M
return
™™ 
	resultado
™™  
;
™™  !
}
´´ 
catch
¨¨ 
(
¨¨ 
	Exception
¨¨ 
e
¨¨ 
)
¨¨ 
{
≠≠ 
throw
ÆÆ 
e
ÆÆ 
;
ÆÆ 
}
ØØ 
}
∞∞ 	
public
≥≥ 
IEnumerable
≥≥ 
<
≥≥ *
DetalleTransaccionVentaCobro
≥≥ 7
>
≥≥7 85
'ObtenerDetallesEstadoCuentaClienteVenta
≥≥9 `
(
≥≥` a
int
≥≥a d
idTransaccion
≥≥e r
,
≥≥r s
int
≥≥t w
idEstadoActual≥≥x Ü
,≥≥Ü á
int≥≥à ã
idActor≥≥å ì
,≥≥ì î
int≥≥ï ò
idParametro≥≥ô §
,≥≥§ •
string≥≥¶ ¨
valorParametro≥≥≠ ª
,≥≥ª º
DateTime≥≥Ω ≈

fechaDesde≥≥∆ –
,≥≥– —
DateTime≥≥“ ⁄

fechaHasta≥≥€ Â
)≥≥Â Ê
{
¥¥ 	
try
µµ 
{
∂∂ 
var
∑∑ 
	resultado
∑∑ 
=
∑∑ 
_db
∑∑  #
.
∑∑# $
Transaccion
∑∑$ /
.
∑∑/ 0
Where
∑∑0 5
(
∑∑5 6
t
∑∑6 7
=>
∑∑8 :
t
∑∑; <
.
∑∑< =
fecha_inicio
∑∑= I
>=
∑∑J L

fechaDesde
∑∑M W
&&
∑∑X Z
t
∑∑[ \
.
∑∑\ ]
fecha_inicio
∑∑] i
<=
∑∑j l

fechaHasta
∑∑m w
&&
∑∑x z
idTransaccion∑∑{ à
==∑∑â ã
t∑∑å ç
.∑∑ç é#
id_tipo_transaccion∑∑é °
&&∑∑¢ §
idActor∑∑• ¨
==∑∑≠ Ø
t∑∑∞ ±
.∑∑± ≤(
id_actor_negocio_externo∑∑≤  
&&∑∑À Õ
t∑∑Œ œ
.∑∑œ – 
id_estado_actual∑∑– ‡
==∑∑· „
idEstadoActual∑∑‰ Ú
&&∑∑Û ı
t∑∑ˆ ˜
.∑∑˜ ¯%
Parametro_transaccion∑∑¯ ç
.∑∑ç é
Count∑∑é ì
(∑∑ì î
pt∑∑î ñ
=>∑∑ó ô
pt∑∑ö ú
.∑∑ú ù
id_parametro∑∑ù ©
==∑∑™ ¨
idParametro∑∑≠ ∏
)∑∑∏ π
==∑∑∫ º
$num∑∑Ω æ
&&∑∑ø ¡
t∑∑¬ √
.∑∑√ ƒ%
Parametro_transaccion∑∑ƒ Ÿ
.∑∑Ÿ ⁄
FirstOrDefault∑∑⁄ Ë
(∑∑Ë È
pt∑∑È Î
=>∑∑Ï Ó
pt∑∑Ô Ò
.∑∑Ò Ú
id_parametro∑∑Ú ˛
==∑∑ˇ Å
idParametro∑∑Ç ç
)∑∑ç é
.∑∑é è
valor∑∑è î
==∑∑ï ó
valorParametro∑∑ò ¶
)∑∑¶ ß
.∑∑ß ®

SelectMany∑∑® ≤
(∑∑≤ ≥
t∑∑≥ ¥
=>∑∑µ ∑
t∑∑∏ π
.∑∑π ∫#
Detalle_transaccion∑∑∫ Õ
)∑∑Õ Œ
.
∏∏ 
Select
∏∏ 
(
∏∏ 
dt
∏∏ 
=>
∏∏ !
new
∏∏" %*
DetalleTransaccionVentaCobro
∏∏& B
(
∏∏B C
)
∏∏C D
{
ππ 
IdOperacion
∫∫ #
=
∫∫$ %
dt
∫∫& (
.
∫∫( )
Transaccion
∫∫) 4
.
∫∫4 5
Transaccion2
∫∫5 A
.
∫∫A B
Transaccion2
∫∫B N
.
∫∫N O
id
∫∫O Q
,
∫∫Q R
Fecha
ªª 
=
ªª 
dt
ªª  "
.
ªª" #
Transaccion
ªª# .
.
ªª. /
fecha_inicio
ªª/ ;
,
ªª; <
Codigo
ºº 
=
ºº  
dt
ºº! #
.
ºº# $
Concepto_negocio
ºº$ 4
.
ºº4 5
codigo_barra
ºº5 A
,
ººA B
Concepto
ΩΩ  
=
ΩΩ! "
dt
ΩΩ# %
.
ΩΩ% &
Concepto_negocio
ΩΩ& 6
.
ΩΩ6 7
nombre
ΩΩ7 =
,
ΩΩ= >
Cantidad
ææ  
=
ææ! "
dt
ææ# %
.
ææ% &
cantidad
ææ& .
,
ææ. /
Importe
øø 
=
øø  !
dt
øø" $
.
øø$ %
total
øø% *
,
øø* +
}
¿¿ 
)
¿¿ 
;
¿¿ 
return
¡¡ 
	resultado
¡¡  
;
¡¡  !
}
¬¬ 
catch
√√ 
(
√√ 
	Exception
√√ 
e
√√ 
)
√√ 
{
ƒƒ 
throw
≈≈ 
new
≈≈ 
DatosException
≈≈ (
(
≈≈( )
$str
≈≈) {
,
≈≈{ |
e
≈≈} ~
)
≈≈~ 
;≈≈ Ä
}
∆∆ 
}
«« 	
public
   
IEnumerable
   
<
   *
DetalleTransaccionVentaCobro
   7
>
  7 85
'ObtenerDetallesEstadoCuentaClienteCobro
  9 `
(
  ` a
int
  a d
idTransaccion
  e r
,
  r s
int
  t w
idActor
  x 
,   Ä
int  Å Ñ
idParametro  Ö ê
,  ê ë
string  í ò
valorParametro  ô ß
,  ß ®
DateTime  © ±

fechaDesde  ≤ º
,  º Ω
DateTime  æ ∆

fechaHasta  « —
)  — “
{
ÀÀ 	
try
ÃÃ 
{
ÕÕ 
var
ŒŒ 
	resultado
ŒŒ 
=
ŒŒ 
_db
ŒŒ  #
.
ŒŒ# $
Transaccion
ŒŒ$ /
.
ŒŒ/ 0
Where
ŒŒ0 5
(
ŒŒ5 6
t
ŒŒ6 7
=>
ŒŒ8 :
t
ŒŒ; <
.
ŒŒ< =
fecha_inicio
ŒŒ= I
>=
ŒŒJ L

fechaDesde
ŒŒM W
&&
ŒŒX Z
t
ŒŒ[ \
.
ŒŒ\ ]
fecha_inicio
ŒŒ] i
<=
ŒŒj l

fechaHasta
ŒŒm w
&&
ŒŒx z
idTransaccionŒŒ{ à
==ŒŒâ ã
tŒŒå ç
.ŒŒç é#
id_tipo_transaccionŒŒé °
&&ŒŒ¢ §
idActorŒŒ• ¨
==ŒŒ≠ Ø
tŒŒ∞ ±
.ŒŒ± ≤(
id_actor_negocio_externoŒŒ≤  
&&ŒŒÀ Õ
tŒŒŒ œ
.ŒŒœ –%
Parametro_transaccionŒŒ– Â
.ŒŒÂ Ê
CountŒŒÊ Î
(ŒŒÎ Ï
ptŒŒÏ Ó
=>ŒŒÔ Ò
ptŒŒÚ Ù
.ŒŒÙ ı
id_parametroŒŒı Å
==ŒŒÇ Ñ
idParametroŒŒÖ ê
)ŒŒê ë
==ŒŒí î
$numŒŒï ñ
&&ŒŒó ô
tŒŒö õ
.ŒŒõ ú%
Parametro_transaccionŒŒú ±
.ŒŒ± ≤
FirstOrDefaultŒŒ≤ ¿
(ŒŒ¿ ¡
ptŒŒ¡ √
=>ŒŒƒ ∆
ptŒŒ« …
.ŒŒ…  
id_parametroŒŒ  ÷
==ŒŒ◊ Ÿ
idParametroŒŒ⁄ Â
)ŒŒÂ Ê
.ŒŒÊ Á
valorŒŒÁ Ï
==ŒŒÌ Ô
valorParametroŒŒ ˛
)ŒŒ˛ ˇ
.
œœ 
Select
œœ 
(
œœ 
t
œœ 
=>
œœ  
new
œœ! $*
DetalleTransaccionVentaCobro
œœ% A
(
œœA B
)
œœB C
{
–– 
IdOperacion
—— #
=
——$ %
t
——& '
.
——' (
Transaccion2
——( 4
.
——4 5
id
——5 7
,
——7 8
Fecha
““ 
=
““ 
t
““  !
.
““! "
fecha_inicio
““" .
,
““. /
Cobro
”” 
=
”” 
t
””  !
.
””! "
importe_total
””" /
,
””/ 0
Codigo
‘‘ 
=
‘‘  
$str
‘‘! $
,
‘‘$ %
Concepto
’’  
=
’’! "
$str
’’# &
,
’’& '
Cantidad
÷÷  
=
÷÷! "
$num
÷÷# $
,
÷÷$ %
Importe
◊◊ 
=
◊◊  !
$num
◊◊" #
,
◊◊# $
}
ÿÿ 
)
ÿÿ 
;
ÿÿ 
;
ÿÿ 
return
ŸŸ 
	resultado
ŸŸ  
;
ŸŸ  !
}
⁄⁄ 
catch
€€ 
(
€€ 
	Exception
€€ 
e
€€ 
)
€€ 
{
‹‹ 
throw
›› 
new
›› 
DatosException
›› (
(
››( )
$str
››) z
,
››z {
e
››| }
)
››} ~
;
››~ 
}
ﬁﬁ 
}
ﬂﬂ 	
public
„„ 
IEnumerable
„„ 
<
„„ 
Transaccion
„„ &
>
„„& 'N
@ObtenerTransaccionesInclusiveDetalleTransaccionPorActorDeNegocio
„„( h
(
„„h i
int
„„i l
idTipoTransaccion
„„m ~
,
„„~ 
int„„Ä É
idUltimoEstado„„Ñ í
,„„í ì
int„„î ó
idActorNegocio„„ò ¶
,„„¶ ß
DateTime„„® ∞

fechaDesde„„± ª
,„„ª º
DateTime„„Ω ≈

fechaHasta„„∆ –
)„„– —
{
‰‰ 	
try
ÂÂ 
{
ÊÊ 
return
ÁÁ 
_db
ÁÁ 
.
ÁÁ 
Transaccion
ÁÁ &
.
ËË% &
Include
ËË& -
(
ËË- .
t
ËË. /
=>
ËË0 2
t
ËË3 4
.
ËË4 5!
Detalle_transaccion
ËË5 H
)
ËËH I
.
ÈÈ% &
Include
ÈÈ& -
(
ÈÈ- .
t
ÈÈ. /
=>
ÈÈ0 2
t
ÈÈ3 4
.
ÈÈ4 5!
Detalle_transaccion
ÈÈ5 H
.
ÈÈH I
Select
ÈÈI O
(
ÈÈO P
dt
ÈÈP R
=>
ÈÈS U
dt
ÈÈV X
.
ÈÈX Y
Concepto_negocio
ÈÈY i
)
ÈÈi j
)
ÈÈj k
.
ÍÍ& '
Where
ÍÍ' ,
(
ÍÍ, -
t
ÍÍ- .
=>
ÍÍ/ 1
t
ÍÍ2 3
.
ÍÍ3 4
fecha_inicio
ÍÍ4 @
>=
ÍÍA C

fechaDesde
ÍÍD N
&&
ÍÍO Q
t
ÍÍR S
.
ÍÍS T
fecha_inicio
ÍÍT `
<=
ÍÍa c

fechaHasta
ÍÍd n
&&
ÎÎ2 4
t
ÎÎ5 6
.
ÎÎ6 7!
id_tipo_transaccion
ÎÎ7 J
==
ÎÎK M
idTipoTransaccion
ÎÎN _
&&
ÏÏ2 4
t
ÏÏ5 6
.
ÏÏ6 7
Actor_negocio1
ÏÏ7 E
.
ÏÏE F
id
ÏÏF H
==
ÏÏI K
idActorNegocio
ÏÏL Z
&&
ÌÌ2 4
t
ÌÌ5 6
.
ÌÌ6 7
id_estado_actual
ÌÌ7 G
==
ÌÌH J
idUltimoEstado
ÌÌK Y
)
ÓÓ, -
;
ÓÓ- .
}
ÔÔ 
catch
 
(
 
	Exception
 
e
 
)
 
{
ÒÒ 
throw
ÚÚ 
e
ÚÚ 
;
ÚÚ 
}
ÛÛ 
}
ÙÙ 	
public
ˆˆ 
IEnumerable
ˆˆ 
<
ˆˆ 
Transaccion
ˆˆ &
>
ˆˆ& '3
%ObtenerTransaccionesPorActorDeNegocio
ˆˆ( M
(
ˆˆM N
int
ˆˆN Q!
idTipoDeTransaccion
ˆˆR e
,
ˆˆe f
int
ˆˆg j
idActorDeNegocio
ˆˆk {
,
ˆˆ{ |
DateTimeˆˆ} Ö

fechaDesdeˆˆÜ ê
,ˆˆê ë
DateTimeˆˆí ö

fechaHastaˆˆõ •
)ˆˆ• ¶
{
˜˜ 	
return
¯¯ 
_db
¯¯ 
.
¯¯ 
Transaccion
¯¯ "
.
˙˙$ %
Include
˙˙% ,
(
˙˙, -
t
˙˙- .
=>
˙˙/ 1
t
˙˙2 3
.
˙˙3 4

Pago_cuota
˙˙4 >
)
˙˙> ?
.
˚˚$ %
Include
˚˚% ,
(
˚˚, -
t
˚˚- .
=>
˚˚/ 1
t
˚˚2 3
.
˚˚3 4

Pago_cuota
˚˚4 >
.
˚˚> ?
Select
˚˚? E
(
˚˚E F
c
˚˚F G
=>
˚˚H J
c
˚˚K L
.
˚˚L M
Cuota
˚˚M R
)
˚˚R S
)
˚˚S T
.
¸¸$ %
Where
¸¸% *
(
¸¸* +
t
¸¸+ ,
=>
¸¸- /
t
¸¸0 1
.
¸¸1 2
fecha_inicio
¸¸2 >
>=
¸¸? A

fechaDesde
¸¸B L
&&
¸¸M O
t
¸¸P Q
.
¸¸Q R
fecha_inicio
¸¸R ^
<=
¸¸_ a

fechaHasta
¸¸b l
&&
˝˝0 2
t
˝˝3 4
.
˝˝4 5!
id_tipo_transaccion
˝˝5 H
==
˝˝I K!
idTipoDeTransaccion
˝˝L _
&&
˛˛0 2
t
˛˛3 4
.
˛˛4 5&
id_actor_negocio_externo
˛˛5 M
==
˛˛N P
idActorDeNegocio
˛˛Q a
)
ˇˇ& '
;
ˇˇ' (
}
Ä	Ä	 	
public
à	à	 !
Deuda_Actor_Negocio
à	à	 "&
ObtenerDeudaActorNegocio
à	à	# ;
(
à	à	; <
int
à	à	< ?
idActorNegocio
à	à	@ N
,
à	à	N O
DateTime
à	à	P X
fecha
à	à	Y ^
)
à	à	^ _
{
â	â	 	
try
ä	ä	 
{
ã	ã	 
var
å	å	 
deudas
å	å	 
=
å	å	 
_db
å	å	  
.
å	å	  !
Actor_negocio
å	å	! .
.
å	å	. /
Where
å	å	/ 4
(
å	å	4 5
an
å	å	5 7
=>
å	å	8 :
an
å	å	; =
.
å	å	= >
id
å	å	> @
==
å	å	A C
idActorNegocio
å	å	D R
)
å	å	R S
.
ç	ç	( )
Select
ç	ç	) /
(
ç	ç	/ 0
an
ç	ç	0 2
=>
ç	ç	3 5
new
ç	ç	6 9!
Deuda_Actor_Negocio
ç	ç	: M
(
ç	ç	M N
)
ç	ç	N O
{
é	é	( )

TotalOrden
è	è	, 6
=
è	è	7 8
an
è	è	9 ;
.
è	è	; <
Transaccion1
è	è	< H
.
è	è	H I
Where
è	è	I N
(
è	è	N O
t
è	è	O P
=>
è	è	Q S
t
è	è	T U
.
è	è	U V
fecha_inicio
è	è	V b
<
è	è	c d
fecha
è	è	e j
)
è	è	j k
.
è	è	k l

SelectMany
è	è	l v
(
è	è	v w
t
è	è	w x
=>
è	è	y {
t
è	è	| }
.
è	è	} ~
Cuotaè	è	~ É
)è	è	É Ñ
.è	è	Ñ Ö
Whereè	è	Ö ä
(è	è	ä ã
cè	è	ã å
=>è	è	ç è
cè	è	ê ë
.è	è	ë í

por_cobrarè	è	í ú
==è	è	ù ü
trueè	è	† §
)è	è	§ •
.è	è	• ¶
Sumè	è	¶ ©
(è	è	© ™
cè	è	™ ´
=>è	è	¨ Æ
cè	è	Ø ∞
.è	è	∞ ±
totalè	è	± ∂
-è	è	∑ ∏
cè	è	π ∫
.è	è	∫ ª
revocadoè	è	ª √
)è	è	√ ƒ
,è	è	ƒ ≈
TotalPagoCuota
ê	ê	, :
=
ê	ê	; <
an
ê	ê	= ?
.
ê	ê	? @
Transaccion1
ê	ê	@ L
.
ê	ê	L M
Where
ê	ê	M R
(
ê	ê	R S
t
ê	ê	S T
=>
ê	ê	U W
t
ê	ê	X Y
.
ê	ê	Y Z
fecha_inicio
ê	ê	Z f
<
ê	ê	g h
fecha
ê	ê	i n
)
ê	ê	n o
.
ê	ê	o p

SelectMany
ê	ê	p z
(
ê	ê	z {
t
ê	ê	{ |
=>
ê	ê	} 
tê	ê	Ä Å
.ê	ê	Å Ç
Cuotaê	ê	Ç á
)ê	ê	á à
.ê	ê	à â
Whereê	ê	â é
(ê	ê	é è
cê	ê	è ê
=>ê	ê	ë ì
cê	ê	î ï
.ê	ê	ï ñ

por_cobrarê	ê	ñ †
==ê	ê	° £
trueê	ê	§ ®
)ê	ê	® ©
.ê	ê	© ™

SelectManyê	ê	™ ¥
(ê	ê	¥ µ
cê	ê	µ ∂
=>ê	ê	∑ π
cê	ê	∫ ª
.ê	ê	ª º

Pago_cuotaê	ê	º ∆
)ê	ê	∆ «
.ê	ê	« »
Whereê	ê	» Õ
(ê	ê	Õ Œ
pgê	ê	Œ –
=>ê	ê	— ”
pgê	ê	‘ ÷
.ê	ê	÷ ◊
Transaccionê	ê	◊ ‚
.ê	ê	‚ „
fecha_inicioê	ê	„ Ô
<ê	ê	 Ò
fechaê	ê	Ú ˜
)ê	ê	˜ ¯
.ê	ê	¯ ˘
Sumê	ê	˘ ¸
(ê	ê	¸ ˝
pcê	ê	˝ ˇ
=>ê	ê	Ä Ç
pcê	ê	É Ö
.ê	ê	Ö Ü
importeê	ê	Ü ç
)ê	ê	ç é
}
í	í	( )
)
í	í	) *
;
í	í	* +
var
ì	ì	 
deudasLista
ì	ì	 
=
ì	ì	  !
deudas
ì	ì	" (
.
ì	ì	( )
ToList
ì	ì	) /
(
ì	ì	/ 0
)
ì	ì	0 1
;
ì	ì	1 2
return
î	î	 
deudasLista
î	î	 "
.
î	î	" #
SingleOrDefault
î	î	# 2
(
î	î	2 3
)
î	î	3 4
;
î	î	4 5
}
ï	ï	 
catch
ñ	ñ	 
(
ñ	ñ	 
	Exception
ñ	ñ	 
e
ñ	ñ	 
)
ñ	ñ	 
{
ó	ó	 
throw
ò	ò	 
new
ò	ò	 
DatosException
ò	ò	 (
(
ò	ò	( )
$str
ò	ò	) ^
,
ò	ò	^ _
e
ò	ò	` a
)
ò	ò	a b
;
ò	ò	b c
}
ô	ô	 
}
ö	ö	 	
public
°	°	 
IEnumerable
°	°	 
<
°	°	 /
!Resumen_Transaccion_Por_Modalidad
°	°	 <
>
°	°	< =d
UObtenerResumenTransaccionesInclusiveParametroTransaccionActoresYDetalleMaestroYEstado°	°	> ì
(°	°	ì î
int°	°	î ó

idEmpleado°	°	ò ¢
,°	°	¢ £
int°	°	§ ß
[°	°	ß ®
]°	°	® ©"
idsTipoTransaccion°	°	™ º
,°	°	º Ω
int°	°	æ ¡
idUltimoEstado°	°	¬ –
,°	°	– —
DateTime°	°	“ ⁄

fechaDesde°	°	€ Â
,°	°	Â Ê
DateTime°	°	Á Ô

fechaHasta°	°	 ˙
,°	°	˙ ˚
int°	°	¸ ˇ
idParametro°	°	Ä ã
,°	°	ã å
string°	°	ç ì
[°	°	ì î
]°	°	î ï!
valoresParametros°	°	ñ ß
)°	°	ß ®
{
¢	¢	 	
try
£	£	 
{
§	§	 
var
•	•	 
resumen
•	•	 
=
•	•	 
_db
•	•	 !
.
•	•	! "
Transaccion
•	•	" -
.
¶	¶	# $
Where
¶	¶	$ )
(
¶	¶	) *
t
¶	¶	* +
=>
¶	¶	, .
t
¶	¶	/ 0
.
¶	¶	0 1
fecha_inicio
¶	¶	1 =
>=
¶	¶	> @

fechaDesde
¶	¶	A K
&&
¶	¶	L N
t
¶	¶	O P
.
¶	¶	P Q
fecha_inicio
¶	¶	Q ]
<=
¶	¶	^ `

fechaHasta
¶	¶	a k
&&
ß	ß	' )
t
ß	ß	* +
.
ß	ß	+ ,
id_empleado
ß	ß	, 7
==
ß	ß	8 :

idEmpleado
ß	ß	; E
&&
ß	ß	F H 
idsTipoTransaccion
ß	ß	I [
.
ß	ß	[ \
Contains
ß	ß	\ d
(
ß	ß	d e
t
ß	ß	e f
.
ß	ß	f g!
id_tipo_transaccion
ß	ß	g z
)
ß	ß	z {
&&
®	®	' )
t
®	®	* +
.
®	®	+ ,
id_estado_actual
®	®	, <
==
®	®	= ?
idUltimoEstado
®	®	@ N
&&
©	©	' )
(
©	©	* +
t
©	©	+ ,
.
©	©	, -#
Parametro_transaccion
©	©	- B
.
©	©	B C
Count
©	©	C H
(
©	©	H I
pt
©	©	I K
=>
©	©	L N
pt
©	©	O Q
.
©	©	Q R
id_parametro
©	©	R ^
==
©	©	_ a
idParametro
©	©	b m
)
©	©	m n
>
©	©	o p
$num
©	©	q r
&&
©	©	s u 
valoresParametros©	©	v á
.©	©	á à
Contains©	©	à ê
(©	©	ê ë
t©	©	ë í
.©	©	í ì%
Parametro_transaccion©	©	ì ®
.©	©	® ©
FirstOrDefault©	©	© ∑
(©	©	∑ ∏
pt©	©	∏ ∫
=>©	©	ª Ω
pt©	©	æ ¿
.©	©	¿ ¡
id_parametro©	©	¡ Õ
==©	©	Œ –
idParametro©	©	— ‹
)©	©	‹ ›
.©	©	› ﬁ
valor©	©	ﬁ „
)©	©	„ ‰
)©	©	‰ Â
)
´	´	' (
.
´	´	( )
GroupBy
´	´	) 0
(
´	´	0 1
t
´	´	1 2
=>
´	´	3 5
new
´	´	6 9
{
¨	¨	' (
t
≠	≠	+ ,
.
≠	≠	, -#
Parametro_transaccion
≠	≠	- B
.
≠	≠	B C
FirstOrDefault
≠	≠	C Q
(
≠	≠	Q R
pt
≠	≠	R T
=>
≠	≠	U W
pt
≠	≠	X Z
.
≠	≠	Z [
id_parametro
≠	≠	[ g
==
≠	≠	h j
idParametro
≠	≠	k v
)
≠	≠	v w
.
≠	≠	w x
valor
≠	≠	x }
,
≠	≠	} ~
t
Æ	Æ	+ ,
.
Æ	Æ	, -!
id_tipo_transaccion
Æ	Æ	- @
,
Æ	Æ	@ A
}
∞	∞	' (
)
∞	∞	( )
.
∞	∞	) *
Select
∞	∞	* 0
(
∞	∞	0 1
t
∞	∞	1 2
=>
∞	∞	3 5
new
∞	∞	6 9/
!Resumen_Transaccion_Por_Modalidad
∞	∞	: [
(
∞	∞	[ \
)
∞	∞	\ ]
{
±	±	' (
IdModalidad
≤	≤	+ 6
=
≤	≤	7 8
t
≤	≤	9 :
.
≤	≤	: ;
Key
≤	≤	; >
.
≤	≤	> ?
valor
≤	≤	? D
,
≤	≤	D E!
IdTipoDeTransaccion
≥	≥	+ >
=
≥	≥	? @
t
≥	≥	A B
.
≥	≥	B C
Key
≥	≥	C F
.
≥	≥	F G!
id_tipo_transaccion
≥	≥	G Z
,
≥	≥	Z [
Importe
¥	¥	+ 2
=
¥	¥	3 4
t
¥	¥	5 6
.
¥	¥	6 7
Sum
¥	¥	7 :
(
¥	¥	: ;
i
¥	¥	; <
=>
¥	¥	= ?
i
¥	¥	@ A
.
¥	¥	A B
importe_total
¥	¥	B O
)
¥	¥	O P
,
¥	¥	P Q
Icbpers
µ	µ	+ 2
=
µ	µ	3 4
t
µ	µ	5 6
.
µ	µ	6 7

SelectMany
µ	µ	7 A
(
µ	µ	A B
pt
µ	µ	B D
=>
µ	µ	E G
pt
µ	µ	H J
.
µ	µ	J K#
Parametro_transaccion
µ	µ	K `
)
µ	µ	` a
.
µ	µ	a b
Where
µ	µ	b g
(
µ	µ	g h
pt
µ	µ	h j
=>
µ	µ	k m
pt
µ	µ	n p
.
µ	µ	p q
id_parametro
µ	µ	q }
==µ	µ	~ Ä
MaestroSettingsµ	µ	Å ê
.µ	µ	ê ë
Defaultµ	µ	ë ò
.µ	µ	ò ô/
IdDetalleMaestroParametroIcbperµ	µ	ô ∏
)µ	µ	∏ π
.µ	µ	π ∫
Selectµ	µ	∫ ¿
(µ	µ	¿ ¡
ptµ	µ	¡ √
=>µ	µ	ƒ ∆
ptµ	µ	« …
.µ	µ	…  
valorµ	µ	  œ
)µ	µ	œ –
,µ	µ	– —#
CantidadDeOperaciones
∂	∂	+ @
=
∂	∂	A B
t
∂	∂	C D
.
∂	∂	D E
Count
∂	∂	E J
(
∂	∂	J K
)
∂	∂	K L
}
∑	∑	' (
)
∑	∑	( )
;
∑	∑	) *
return
∏	∏	 
resumen
∏	∏	 
;
∏	∏	 
}
π	π	 
catch
∫	∫	 
(
∫	∫	 
	Exception
∫	∫	 
e
∫	∫	 
)
∫	∫	 
{
ª	ª	 
throw
ª	ª	 
new
ª	ª	 
DatosException
ª	ª	 &
(
ª	ª	& '
$str
ª	ª	' G
,
ª	ª	G H
e
ª	ª	I J
)
ª	ª	J K
;
ª	ª	K L
}
ª	ª	M N
}
º	º	 	
public
æ	æ	 
IEnumerable
æ	æ	 
<
æ	æ	 /
!Detalle_Transaccion_Por_Modalidad
æ	æ	 <
>
æ	æ	< =Ñ
uObtenerDetalleTransaccionesInclusiveParametroTransaccionActorDeNegocioDetalleMaestroYEstadoAgrupadoPorConceptoNegocioæ	æ	> ≥
(æ	æ	≥ ¥
intæ	æ	¥ ∑

idEmpleadoæ	æ	∏ ¬
,æ	æ	¬ √
intæ	æ	ƒ «
[æ	æ	« »
]æ	æ	» …"
idsTipoTransaccionæ	æ	  ‹
,æ	æ	‹ ›
intæ	æ	ﬁ ·
idUltimoEstadoæ	æ	‚ 
,æ	æ	 Ò
DateTimeæ	æ	Ú ˙

fechaDesdeæ	æ	˚ Ö
,æ	æ	Ö Ü
DateTimeæ	æ	á è

fechaHastaæ	æ	ê ö
,æ	æ	ö õ
intæ	æ	ú ü
idParametroæ	æ	† ´
,æ	æ	´ ¨
stringæ	æ	≠ ≥
[æ	æ	≥ ¥
]æ	æ	¥ µ!
valoresParametrosæ	æ	∂ «
)æ	æ	« »
{
ø	ø	 	
try
¿	¿	 
{
¡	¡	 
var
¬	¬	 
detalles
¬	¬	 
=
¬	¬	 
_db
¬	¬	 "
.
¬	¬	" #
Transaccion
¬	¬	# .
.
√	√	 
Where
√	√	 !
(
√	√	! "
t
√	√	" #
=>
√	√	$ &
t
√	√	' (
.
√	√	( )
fecha_inicio
√	√	) 5
>=
√	√	6 8

fechaDesde
√	√	9 C
&&
√	√	D F
t
√	√	G H
.
√	√	H I
fecha_inicio
√	√	I U
<=
√	√	V X

fechaHasta
√	√	Y c
&&
ƒ	ƒ	 
t
ƒ	ƒ	  
.
ƒ	ƒ	  !
id_empleado
ƒ	ƒ	! ,
==
ƒ	ƒ	- /

idEmpleado
ƒ	ƒ	0 :
&&
ƒ	ƒ	; = 
idsTipoTransaccion
ƒ	ƒ	> P
.
ƒ	ƒ	P Q
Contains
ƒ	ƒ	Q Y
(
ƒ	ƒ	Y Z
t
ƒ	ƒ	Z [
.
ƒ	ƒ	[ \!
id_tipo_transaccion
ƒ	ƒ	\ o
)
ƒ	ƒ	o p
&&
≈	≈	 
t
≈	≈	  
.
≈	≈	  !
id_estado_actual
≈	≈	! 1
==
≈	≈	2 4
idUltimoEstado
≈	≈	5 C
&&
∆	∆	 
(
∆	∆	  
t
∆	∆	  !
.
∆	∆	! "#
Parametro_transaccion
∆	∆	" 7
.
∆	∆	7 8
Count
∆	∆	8 =
(
∆	∆	= >
pt
∆	∆	> @
=>
∆	∆	A C
pt
∆	∆	D F
.
∆	∆	F G
id_parametro
∆	∆	G S
==
∆	∆	T V
idParametro
∆	∆	W b
)
∆	∆	b c
>
∆	∆	d e
$num
∆	∆	f g
&&
∆	∆	h j
valoresParametros
∆	∆	k |
.
∆	∆	| }
Contains∆	∆	} Ö
(∆	∆	Ö Ü
t∆	∆	Ü á
.∆	∆	á à%
Parametro_transaccion∆	∆	à ù
.∆	∆	ù û
FirstOrDefault∆	∆	û ¨
(∆	∆	¨ ≠
pt∆	∆	≠ Ø
=>∆	∆	∞ ≤
pt∆	∆	≥ µ
.∆	∆	µ ∂
id_parametro∆	∆	∂ ¬
==∆	∆	√ ≈
idParametro∆	∆	∆ —
)∆	∆	— “
.∆	∆	“ ”
valor∆	∆	” ÿ
)∆	∆	ÿ Ÿ
)∆	∆	Ÿ ⁄
)
«	«	 
.
«	«	 

SelectMany
«	«	 (
(
«	«	( )
t
«	«	) *
=>
«	«	+ -
t
«	«	. /
.
«	«	/ 0!
Detalle_transaccion
«	«	0 C
)
«	«	C D
.
«	«	D E
GroupBy
»	»	2 9
(
»	»	9 :
dt
»	»	: <
=>
»	»	= ?
new
»	»	@ C
{
…	…	2 3
dt
 	 	6 8
.
 	 	8 9
Concepto_negocio
 	 	9 I
.
 	 	I J
codigo_barra
 	 	J V
,
 	 	V W 
idconcepto_negocio
À	À	6 H
=
À	À	I J
dt
À	À	K M
.
À	À	M N!
id_concepto_negocio
À	À	N a
,
À	À	a b
concepto
Ã	Ã	6 >
=
Ã	Ã	? @
dt
Ã	Ã	A C
.
Ã	Ã	C D
Concepto_negocio
Ã	Ã	D T
.
Ã	Ã	T U
nombre
Ã	Ã	U [
,
Ã	Ã	[ \
dt
Õ	Õ	6 8
.
Õ	Õ	8 9
Transaccion
Õ	Õ	9 D
.
Õ	Õ	D E#
Parametro_transaccion
Õ	Õ	E Z
.
Õ	Õ	Z [
FirstOrDefault
Õ	Õ	[ i
(
Õ	Õ	i j
pt
Õ	Õ	j l
=>
Õ	Õ	m o
pt
Õ	Õ	p r
.
Õ	Õ	r s
id_parametro
Õ	Õ	s 
==Õ	Õ	Ä Ç
idParametroÕ	Õ	É é
)Õ	Õ	é è
.Õ	Õ	è ê
valorÕ	Õ	ê ï
,Õ	Õ	ï ñ
}
œ	œ	2 3
)
œ	œ	3 4
.
œ	œ	4 5
Select
œ	œ	5 ;
(
œ	œ	; <
dt
œ	œ	< >
=>
œ	œ	? A
new
œ	œ	B E/
!Detalle_Transaccion_Por_Modalidad
œ	œ	F g
(
œ	œ	g h
)
œ	œ	h i
{
–	–	2 3
IdModalidad
“	“	6 A
=
“	“	B C
dt
“	“	D F
.
“	“	F G
Key
“	“	G J
.
“	“	J K
valor
“	“	K P
,
“	“	P Q
IdConceptoNegocio
”	”	6 G
=
”	”	H I
dt
”	”	J L
.
”	”	L M
Key
”	”	M P
.
”	”	P Q 
idconcepto_negocio
”	”	Q c
,
”	”	c d#
CodigoConceptoNegocio
‘	‘	6 K
=
‘	‘	L M
dt
‘	‘	N P
.
‘	‘	P Q
Key
‘	‘	Q T
.
‘	‘	T U
codigo_barra
‘	‘	U a
,
‘	‘	a b#
NombreConceptoNegocio
’	’	6 K
=
’	’	L M
dt
’	’	N P
.
’	’	P Q
Key
’	’	Q T
.
’	’	T U
concepto
’	’	U ]
,
’	’	] ^
Cantidad
÷	÷	6 >
=
÷	÷	? @
dt
÷	÷	A C
.
÷	÷	C D
Sum
÷	÷	D G
(
÷	÷	G H
c
÷	÷	H I
=>
÷	÷	J L
c
÷	÷	M N
.
÷	÷	N O
cantidad
÷	÷	O W
)
÷	÷	W X
,
÷	÷	X Y
Importe
◊	◊	6 =
=
◊	◊	> ?
dt
◊	◊	@ B
.
◊	◊	B C
Sum
◊	◊	C F
(
◊	◊	F G
t
◊	◊	G H
=>
◊	◊	I K
t
◊	◊	L M
.
◊	◊	M N
total
◊	◊	N S
)
◊	◊	S T
}
ÿ	ÿ	2 3
)
ÿ	ÿ	3 4
;
ÿ	ÿ	4 5
return
Ÿ	Ÿ	 
detalles
Ÿ	Ÿ	 
.
Ÿ	Ÿ	  
OrderBy
Ÿ	Ÿ	  '
(
Ÿ	Ÿ	' (
r
Ÿ	Ÿ	( )
=>
Ÿ	Ÿ	* ,
r
Ÿ	Ÿ	- .
.
Ÿ	Ÿ	. /#
CodigoConceptoNegocio
Ÿ	Ÿ	/ D
??
Ÿ	Ÿ	E G
r
Ÿ	Ÿ	H I
.
Ÿ	Ÿ	I J#
NombreConceptoNegocio
Ÿ	Ÿ	J _
)
Ÿ	Ÿ	_ `
;
Ÿ	Ÿ	` a
}
⁄	⁄	 
catch
€	€	 
(
€	€	 
	Exception
€	€	 
e
€	€	 
)
€	€	 
{
‹	‹	 
throw
‹	‹	 
new
‹	‹	 
DatosException
‹	‹	 &
(
‹	‹	& '
$str
‹	‹	' G
,
‹	‹	G H
e
‹	‹	I J
)
‹	‹	J K
;
‹	‹	K L
}
‹	‹	M N
}
›	›	 	
public
ﬂ	ﬂ	 
IEnumerable
ﬂ	ﬂ	 
<
ﬂ	ﬂ	 /
!Detalle_Transaccion_Por_Modalidad
ﬂ	ﬂ	 <
>
ﬂ	ﬂ	< =î
ÑObtenerDetalleTransaccionesInclusiveParametroTransaccionActorDeNegocioDetalleMaestroYEstadoAgrupadoPorConceptoNegocioYPrecioUnitarioﬂ	ﬂ	> ¬
(ﬂ	ﬂ	¬ √
intﬂ	ﬂ	√ ∆

idEmpleadoﬂ	ﬂ	« —
,ﬂ	ﬂ	— “
intﬂ	ﬂ	” ÷
[ﬂ	ﬂ	÷ ◊
]ﬂ	ﬂ	◊ ÿ"
idsTipoTransaccionﬂ	ﬂ	Ÿ Î
,ﬂ	ﬂ	Î Ï
intﬂ	ﬂ	Ì 
idUltimoEstadoﬂ	ﬂ	Ò ˇ
,ﬂ	ﬂ	ˇ Ä
DateTimeﬂ	ﬂ	Å â

fechaDesdeﬂ	ﬂ	ä î
,ﬂ	ﬂ	î ï
DateTimeﬂ	ﬂ	ñ û

fechaHastaﬂ	ﬂ	ü ©
,ﬂ	ﬂ	© ™
intﬂ	ﬂ	´ Æ
idParametroﬂ	ﬂ	Ø ∫
,ﬂ	ﬂ	∫ ª
stringﬂ	ﬂ	º ¬
[ﬂ	ﬂ	¬ √
]ﬂ	ﬂ	√ ƒ!
valoresParametrosﬂ	ﬂ	≈ ÷
)ﬂ	ﬂ	÷ ◊
{
‡	‡	 	
try
·	·	 
{
‚	‚	 
var
„	„	 
detalles
„	„	 
=
„	„	 
_db
„	„	 "
.
„	„	" #
Transaccion
„	„	# .
.
‰	‰	 
Where
‰	‰	  
(
‰	‰	  !
t
‰	‰	! "
=>
‰	‰	# %
t
Â	Â	 
.
Â	Â	 
fecha_inicio
Â	Â	 *
>=
Â	Â	+ -

fechaDesde
Â	Â	. 8
&&
Â	Â	9 ;
t
Â	Â	< =
.
Â	Â	= >
fecha_inicio
Â	Â	> J
<=
Â	Â	K M

fechaHasta
Â	Â	N X
&&
Ê	Ê	 
t
Ê	Ê	 
.
Ê	Ê	  
id_empleado
Ê	Ê	  +
==
Ê	Ê	, .

idEmpleado
Ê	Ê	/ 9
&&
Á	Á	  
idsTipoTransaccion
Á	Á	 0
.
Á	Á	0 1
Contains
Á	Á	1 9
(
Á	Á	9 :
t
Á	Á	: ;
.
Á	Á	; <!
id_tipo_transaccion
Á	Á	< O
)
Á	Á	O P
&&
Ë	Ë	 
t
Ë	Ë	 
.
Ë	Ë	  
id_estado_actual
Ë	Ë	  0
==
Ë	Ë	1 3
idUltimoEstado
Ë	Ë	4 B
&&
È	È	 
(
È	È	 
t
È	È	  
.
È	È	  !#
Parametro_transaccion
È	È	! 6
.
È	È	6 7
Count
È	È	7 <
(
È	È	< =
pt
È	È	= ?
=>
È	È	@ B
pt
È	È	C E
.
È	È	E F
id_parametro
È	È	F R
==
È	È	S U
idParametro
È	È	V a
)
È	È	a b
>
È	È	c d
$num
È	È	e f
&&
È	È	g i
valoresParametros
È	È	j {
.
È	È	{ |
ContainsÈ	È	| Ñ
(È	È	Ñ Ö
tÈ	È	Ö Ü
.È	È	Ü á%
Parametro_transaccionÈ	È	á ú
.È	È	ú ù
FirstOrDefaultÈ	È	ù ´
(È	È	´ ¨
ptÈ	È	¨ Æ
=>È	È	Ø ±
ptÈ	È	≤ ¥
.È	È	¥ µ
id_parametroÈ	È	µ ¡
==È	È	¬ ƒ
idParametroÈ	È	≈ –
)È	È	– —
.È	È	— “
valorÈ	È	“ ◊
)È	È	◊ ÿ
)È	È	ÿ Ÿ
)
Í	Í	 
.
Í	Í	 

SelectMany
Í	Í	 '
(
Í	Í	' (
t
Í	Í	( )
=>
Í	Í	* ,
t
Í	Í	- .
.
Í	Í	. /!
Detalle_transaccion
Í	Í	/ B
)
Í	Í	B C
.
Í	Í	C D
GroupBy
Î	Î	1 8
(
Î	Î	8 9
dt
Î	Î	9 ;
=>
Î	Î	< >
new
Î	Î	? B
{
Ï	Ï	1 2
dt
Ì	Ì	5 7
.
Ì	Ì	7 8
Concepto_negocio
Ì	Ì	8 H
.
Ì	Ì	H I
codigo_barra
Ì	Ì	I U
,
Ì	Ì	U V 
idconcepto_negocio
Ó	Ó	5 G
=
Ó	Ó	H I
dt
Ó	Ó	J L
.
Ó	Ó	L M!
id_concepto_negocio
Ó	Ó	M `
,
Ó	Ó	` a
concepto
Ô	Ô	5 =
=
Ô	Ô	> ?
dt
Ô	Ô	@ B
.
Ô	Ô	B C
Concepto_negocio
Ô	Ô	C S
.
Ô	Ô	S T
nombre
Ô	Ô	T Z
,
Ô	Ô	Z [
dt
		5 7
.
		7 8
Transaccion
		8 C
.
		C D#
Parametro_transaccion
		D Y
.
		Y Z
FirstOrDefault
		Z h
(
		h i
pt
		i k
=>
		l n
pt
		o q
.
		q r
id_parametro
		r ~
==		 Å
idParametro		Ç ç
)		ç é
.		é è
valor		è î
,		î ï
dt
Ò	Ò	5 7
.
Ò	Ò	7 8
precio_unitario
Ò	Ò	8 G
}
Û	Û	1 2
)
Û	Û	2 3
.
Û	Û	3 4
Select
Û	Û	4 :
(
Û	Û	: ;
dt
Û	Û	; =
=>
Û	Û	> @
new
Û	Û	A D/
!Detalle_Transaccion_Por_Modalidad
Û	Û	E f
(
Û	Û	f g
)
Û	Û	g h
{
Ù	Ù	1 2
IdModalidad
ˆ	ˆ	5 @
=
ˆ	ˆ	A B
dt
ˆ	ˆ	C E
.
ˆ	ˆ	E F
Key
ˆ	ˆ	F I
.
ˆ	ˆ	I J
valor
ˆ	ˆ	J O
,
ˆ	ˆ	O P
IdConceptoNegocio
˜	˜	5 F
=
˜	˜	G H
dt
˜	˜	I K
.
˜	˜	K L
Key
˜	˜	L O
.
˜	˜	O P 
idconcepto_negocio
˜	˜	P b
,
˜	˜	b c#
CodigoConceptoNegocio
¯	¯	5 J
=
¯	¯	K L
dt
¯	¯	M O
.
¯	¯	O P
Key
¯	¯	P S
.
¯	¯	S T
codigo_barra
¯	¯	T `
,
¯	¯	` a#
NombreConceptoNegocio
˘	˘	5 J
=
˘	˘	K L
dt
˘	˘	M O
.
˘	˘	O P
Key
˘	˘	P S
.
˘	˘	S T
concepto
˘	˘	T \
,
˘	˘	\ ]
Cantidad
˙	˙	5 =
=
˙	˙	> ?
dt
˙	˙	@ B
.
˙	˙	B C
Sum
˙	˙	C F
(
˙	˙	F G
c
˙	˙	G H
=>
˙	˙	I K
c
˙	˙	L M
.
˙	˙	M N
cantidad
˙	˙	N V
)
˙	˙	V W
,
˙	˙	W X
Importe
˚	˚	5 <
=
˚	˚	= >
dt
˚	˚	? A
.
˚	˚	A B
Sum
˚	˚	B E
(
˚	˚	E F
t
˚	˚	F G
=>
˚	˚	H J
t
˚	˚	K L
.
˚	˚	L M
total
˚	˚	M R
)
˚	˚	R S
}
¸	¸	1 2
)
¸	¸	2 3
;
¸	¸	3 4
return
˝	˝	 
detalles
˝	˝	 
.
˝	˝	  
OrderBy
˝	˝	  '
(
˝	˝	' (
r
˝	˝	( )
=>
˝	˝	* ,
r
˝	˝	- .
.
˝	˝	. /#
CodigoConceptoNegocio
˝	˝	/ D
??
˝	˝	E G
r
˝	˝	H I
.
˝	˝	I J#
NombreConceptoNegocio
˝	˝	J _
)
˝	˝	_ `
;
˝	˝	` a
}
˛	˛	 
catch
ˇ	ˇ	 
(
ˇ	ˇ	 
	Exception
ˇ	ˇ	 
e
ˇ	ˇ	 
)
ˇ	ˇ	 
{
Ä
Ä
 
throw
Ä
Ä
 
new
Ä
Ä
 
DatosException
Ä
Ä
 &
(
Ä
Ä
& '
$str
Ä
Ä
' G
,
Ä
Ä
G H
e
Ä
Ä
I J
)
Ä
Ä
J K
;
Ä
Ä
K L
}
Ä
Ä
M N
}
Å
Å
 	
public
â
â
 (
Ultimo_Precio_Compra_Venta
â
â
 ),
ObtenerUltimoPrecioCompraVenta
â
â
* H
(
â
â
H I
int
â
â
I L#
idActorNegocioInterno
â
â
M b
,
â
â
b c
int
â
â
d g
idConceptoNegocio
â
â
h y
,
â
â
y z
int
â
â
{ ~ 
idTipoTransaccionâ
â
 ê
,â
â
ê ë
intâ
â
í ï#
idTarifaPrecioVentaâ
â
ñ ©
)â
â
© ™
{
ä
ä
 	
try
ã
ã
 
{
å
å
 
var
ç
ç
 
	resultado
ç
ç
 
=
ç
ç
 
_db
ç
ç
  #
.
ç
ç
# $
Concepto_negocio
ç
ç
$ 4
.
ç
ç
4 5
Where
ç
ç
5 :
(
ç
ç
: ;
cn
ç
ç
; =
=>
ç
ç
> @
cn
ç
ç
A C
.
ç
ç
C D
id
ç
ç
D F
==
ç
ç
G I
idConceptoNegocio
ç
ç
J [
)
ç
ç
[ \
.
è
è
* +
Select
è
è
+ 1
(
è
è
1 2
cn
ê
ê
0 2
=>
ê
ê
3 5
new
ê
ê
6 9(
Ultimo_Precio_Compra_Venta
ê
ê
: T
(
ê
ê
T U
)
ê
ê
U V
{
ë
ë
0 1 
UltimoPrecioCompra
ì
ì
4 F
=
ì
ì
G H
cn
ì
ì
I K
.
ì
ì
K L!
Detalle_transaccion
ì
ì
L _
.
î
î
J K
Where
î
î
K P
(
î
î
P Q
dt
î
î
Q S
=>
î
î
T V
dt
î
î
W Y
.
î
î
Y Z
Transaccion
î
î
Z e
.
î
î
e f&
id_actor_negocio_interno
î
î
f ~
==î
î
 Å%
idActorNegocioInternoî
î
Ç ó
&&î
î
ò ö
dtî
î
õ ù
.î
î
ù û
Transaccionî
î
û ©
.î
î
© ™#
id_tipo_transaccionî
î
™ Ω
==î
î
æ ¿!
idTipoTransaccionî
î
¡ “
)î
î
“ ”
.
ï
ï
J K
OrderByDescending
ï
ï
K \
(
ï
ï
\ ]
dt
ï
ï
] _
=>
ï
ï
` b
dt
ï
ï
c e
.
ï
ï
e f
Transaccion
ï
ï
f q
.
ï
ï
q r
fecha_inicio
ï
ï
r ~
)
ï
ï
~ 
.
ñ
ñ
J K
ThenByDescending
ñ
ñ
K [
(
ñ
ñ
[ \
dt
ñ
ñ
\ ^
=>
ñ
ñ
_ a
dt
ñ
ñ
b d
.
ñ
ñ
d e
id
ñ
ñ
e g
)
ñ
ñ
g h
.
ñ
ñ
h i
FirstOrDefault
ñ
ñ
i w
(
ñ
ñ
w x
)
ñ
ñ
x y
.
ñ
ñ
y z
precio_unitarioñ
ñ
z â
,ñ
ñ
â ä
UltimoPrecioVenta
ó
ó
4 E
=
ó
ó
F G
cn
ó
ó
H J
.
ó
ó
J K
Precio1
ó
ó
K R
.
ó
ó
R S
Where
ó
ó
S X
(
ó
ó
X Y
p
ó
ó
Y Z
=>
ó
ó
[ ]
p
ó
ó
^ _
.
ó
ó
_ `
id_actor_negocio
ó
ó
` p
==
ó
ó
q s$
idActorNegocioInternoó
ó
t â
&&ó
ó
ä å
pó
ó
ç é
.ó
ó
é è

es_vigenteó
ó
è ô
==ó
ó
ö ú
trueó
ó
ù °
&&ó
ó
¢ §
pó
ó
• ¶
.ó
ó
¶ ß
id_tarifa_dó
ó
ß ≤
==ó
ó
≥ µ#
idTarifaPrecioVentaó
ó
∂ …
)ó
ó
…  
.
ò
ò
J K
OrderByDescending
ò
ò
K \
(
ò
ò
\ ]
p
ò
ò
] ^
=>
ò
ò
_ a
p
ò
ò
b c
.
ò
ò
c d
id
ò
ò
d f
)
ò
ò
f g
.
ò
ò
g h
FirstOrDefault
ò
ò
h v
(
ò
ò
v w
)
ò
ò
w x
.
ò
ò
x y
valor
ò
ò
y ~
}
ô
ô
0 1
)
õ
õ
+ ,
.
õ
õ
, -
FirstOrDefault
õ
õ
- ;
(
õ
õ
; <
)
õ
õ
< =
;
õ
õ
= >
return
ú
ú
 
	resultado
ú
ú
  
;
ú
ú
  !
}
ù
ù
 
catch
û
û
 
(
û
û
 
	Exception
û
û
 
e
û
û
 
)
û
û
 
{
ü
ü
 
throw
†
†
 
new
†
†
 
DatosException
†
†
 (
(
†
†
( )
$str
†
†
) K
,
†
†
K L
e
†
†
M N
)
†
†
N O
;
†
†
O P
}
°
°
 
}
¢
¢
 	
public
®
®
 
IEnumerable
®
®
 
<
®
®
 
Reporte_Deuda
®
®
 (
>
®
®
( )
ObtenerDeudas
®
®
* 7
(
®
®
7 8
bool
®
®
8 <
	porCobrar
®
®
= F
,
®
®
F G
int
®
®
H K
[
®
®
K L
]
®
®
L M!
idsTiposTransaccion
®
®
N a
,
®
®
a b
int
®
®
c f
[
®
®
f g
]
®
®
g h$
idsActorNegocioExterno
®
®
i 
)®
®
 Ä
{
©
©
 	
try
™
™
 
{
´
´
 
var
¨
¨
 
	resultado
¨
¨
 
=
¨
¨
 
_db
¨
¨
  #
.
¨
¨
# $
Cuota
¨
¨
$ )
.
≠
≠
) *
Where
≠
≠
* /
(
≠
≠
/ 0
c
≠
≠
0 1
=>
≠
≠
2 4
c
≠
≠
5 6
.
≠
≠
6 7

por_cobrar
≠
≠
7 A
==
≠
≠
B D
	porCobrar
≠
≠
E N
&&
Æ
Æ
1 3
c
Æ
Æ
4 5
.
Æ
Æ
5 6
saldo
Æ
Æ
6 ;
>
Æ
Æ
< =
$num
Æ
Æ
> ?
&&
Ø
Ø
1 3!
idsTiposTransaccion
Ø
Ø
4 G
.
Ø
Ø
G H
Contains
Ø
Ø
H P
(
Ø
Ø
P Q
c
Ø
Ø
Q R
.
Ø
Ø
R S
Transaccion
Ø
Ø
S ^
.
Ø
Ø
^ _!
id_tipo_transaccion
Ø
Ø
_ r
)
Ø
Ø
r s
&&
∞
∞
1 3$
idsActorNegocioExterno
∞
∞
4 J
.
∞
∞
J K
Contains
∞
∞
K S
(
∞
∞
S T
c
∞
∞
T U
.
∞
∞
U V
Transaccion
∞
∞
V a
.
∞
∞
a b&
id_actor_negocio_externo
∞
∞
b z
)
∞
∞
z {
)
±
±
/ 0
.
≤
≤
* +
Select
≤
≤
+ 1
(
≤
≤
1 2
c
≤
≤
2 3
=>
≤
≤
4 6
new
≤
≤
7 :
Reporte_Deuda
≤
≤
; H
(
≤
≤
H I
)
≤
≤
I J
{
≥
≥
* +
PrimerNombre
¥
¥
. :
=
¥
¥
; <
c
¥
¥
= >
.
¥
¥
> ?
Transaccion
¥
¥
? J
.
¥
¥
J K
Actor_negocio1
¥
¥
K Y
.
¥
¥
Y Z
Actor
¥
¥
Z _
.
¥
¥
_ `
primer_nombre
¥
¥
` m
,
¥
¥
m n
NumeroDocumento
µ
µ
. =
=
µ
µ
> ?
c
µ
µ
@ A
.
µ
µ
A B
Transaccion
µ
µ
B M
.
µ
µ
M N
Actor_negocio1
µ
µ
N \
.
µ
µ
\ ]
Actor
µ
µ
] b
.
µ
µ
b c(
numero_documento_identidad
µ
µ
c }
,
µ
µ
} ~
CodigoCuota
∂
∂
. 9
=
∂
∂
: ;
c
∂
∂
< =
.
∂
∂
= >
codigo
∂
∂
> D
,
∂
∂
D E
FechaVencimiento
∑
∑
. >
=
∑
∑
? @
c
∑
∑
A B
.
∑
∑
B C
fecha_vencimiento
∑
∑
C T
,
∑
∑
T U
TipoComprobante
∏
∏
. =
=
∏
∏
> ?
c
∏
∏
@ A
.
∏
∏
A B
Transaccion
∏
∏
B M
.
∏
∏
M N
Comprobante
∏
∏
N Y
.
∏
∏
Y Z
Detalle_maestro
∏
∏
Z i
.
∏
∏
i j
nombre
∏
∏
j p
,
∏
∏
p q
CodigoComprobante
π
π
. ?
=
π
π
@ A
c
π
π
B C
.
π
π
C D
Transaccion
π
π
D O
.
π
π
O P
Comprobante
π
π
P [
.
π
π
[ \
Detalle_maestro
π
π
\ k
.
π
π
k l
valor
π
π
l q
,
π
π
q r
NumeroSerie
∫
∫
. 9
=
∫
∫
: ;
c
∫
∫
< =
.
∫
∫
= >
Transaccion
∫
∫
> I
.
∫
∫
I J
Comprobante
∫
∫
J U
.
∫
∫
U V
numero_serie
∫
∫
V b
,
∫
∫
b c
NumeroComprobante
ª
ª
. ?
=
ª
ª
@ A
c
ª
ª
B C
.
ª
ª
C D
Transaccion
ª
ª
D O
.
ª
ª
O P
Comprobante
ª
ª
P [
.
ª
ª
[ \
numero
ª
ª
\ b
,
ª
ª
b c
Total
º
º
. 3
=
º
º
4 5
c
º
º
6 7
.
º
º
7 8
total
º
º
8 =
,
º
º
= >
PagoACuenta
Ω
Ω
. 9
=
Ω
Ω
: ;
c
Ω
Ω
< =
.
Ω
Ω
= >
pago_a_cuenta
Ω
Ω
> K
,
Ω
Ω
K L
Revocado
æ
æ
. 6
=
æ
æ
7 8
c
æ
æ
9 :
.
æ
æ
: ;
revocado
æ
æ
; C
,
æ
æ
C D
Saldo
ø
ø
. 3
=
ø
ø
4 5
c
ø
ø
6 7
.
ø
ø
7 8
saldo
ø
ø
8 =
}
¿
¿
* +
)
¿
¿
+ ,
;
¿
¿
, -
return
¡
¡
 
	resultado
¡
¡
  
;
¡
¡
  !
}
¬
¬
 
catch
√
√
 
(
√
√
 
	Exception
√
√
 
e
√
√
 
)
√
√
 
{
ƒ
ƒ
 
throw
≈
≈
 
new
≈
≈
 
DatosException
≈
≈
 (
(
≈
≈
( )
$str
≈
≈
) B
,
≈
≈
B C
e
≈
≈
D E
)
≈
≈
E F
;
≈
≈
F G
}
∆
∆
 
}
«
«
 	
public
…
…
 
IEnumerable
…
…
 
<
…
…
 
Reporte_Deuda
…
…
 (
>
…
…
( )
ObtenerDeudas
…
…
* 7
(
…
…
7 8
bool
…
…
8 <
	porCobrar
…
…
= F
,
…
…
F G
int
…
…
H K
[
…
…
K L
]
…
…
L M!
idsTiposTransaccion
…
…
N a
)
…
…
a b
{
 
 
 	
try
À
À
 
{
Ã
Ã
 
var
Õ
Õ
 
	resultado
Õ
Õ
 
=
Õ
Õ
 
_db
Õ
Õ
  #
.
Õ
Õ
# $
Cuota
Õ
Õ
$ )
.
Œ
Œ
) *
Where
Œ
Œ
* /
(
Œ
Œ
/ 0
c
Œ
Œ
0 1
=>
Œ
Œ
2 4
c
Œ
Œ
5 6
.
Œ
Œ
6 7

por_cobrar
Œ
Œ
7 A
==
Œ
Œ
B D
	porCobrar
Œ
Œ
E N
&&
œ
œ
1 3
c
œ
œ
4 5
.
œ
œ
5 6
saldo
œ
œ
6 ;
>
œ
œ
< =
$num
œ
œ
> ?
&&
–
–
1 3!
idsTiposTransaccion
–
–
4 G
.
–
–
G H
Contains
–
–
H P
(
–
–
P Q
c
–
–
Q R
.
–
–
R S
Transaccion
–
–
S ^
.
–
–
^ _!
id_tipo_transaccion
–
–
_ r
)
–
–
r s
)
—
—
/ 0
.
“
“
* +
Select
“
“
+ 1
(
“
“
1 2
c
“
“
2 3
=>
“
“
4 6
new
“
“
7 :
Reporte_Deuda
“
“
; H
(
“
“
H I
)
“
“
I J
{
”
”
* +
PrimerNombre
‘
‘
. :
=
‘
‘
; <
c
‘
‘
= >
.
‘
‘
> ?
Transaccion
‘
‘
? J
.
‘
‘
J K
Actor_negocio1
‘
‘
K Y
.
‘
‘
Y Z
Actor
‘
‘
Z _
.
‘
‘
_ `
primer_nombre
‘
‘
` m
,
‘
‘
m n
NumeroDocumento
’
’
. =
=
’
’
> ?
c
’
’
@ A
.
’
’
A B
Transaccion
’
’
B M
.
’
’
M N
Actor_negocio1
’
’
N \
.
’
’
\ ]
Actor
’
’
] b
.
’
’
b c(
numero_documento_identidad
’
’
c }
,
’
’
} ~
CodigoCuota
÷
÷
. 9
=
÷
÷
: ;
c
÷
÷
< =
.
÷
÷
= >
codigo
÷
÷
> D
,
÷
÷
D E
FechaVencimiento
◊
◊
. >
=
◊
◊
? @
c
◊
◊
A B
.
◊
◊
B C
fecha_vencimiento
◊
◊
C T
,
◊
◊
T U
TipoComprobante
ÿ
ÿ
. =
=
ÿ
ÿ
> ?
c
ÿ
ÿ
@ A
.
ÿ
ÿ
A B
Transaccion
ÿ
ÿ
B M
.
ÿ
ÿ
M N
Comprobante
ÿ
ÿ
N Y
.
ÿ
ÿ
Y Z
Detalle_maestro
ÿ
ÿ
Z i
.
ÿ
ÿ
i j
nombre
ÿ
ÿ
j p
,
ÿ
ÿ
p q
CodigoComprobante
Ÿ
Ÿ
. ?
=
Ÿ
Ÿ
@ A
c
Ÿ
Ÿ
B C
.
Ÿ
Ÿ
C D
Transaccion
Ÿ
Ÿ
D O
.
Ÿ
Ÿ
O P
Comprobante
Ÿ
Ÿ
P [
.
Ÿ
Ÿ
[ \
Detalle_maestro
Ÿ
Ÿ
\ k
.
Ÿ
Ÿ
k l
valor
Ÿ
Ÿ
l q
,
Ÿ
Ÿ
q r
NumeroSerie
⁄
⁄
. 9
=
⁄
⁄
: ;
c
⁄
⁄
< =
.
⁄
⁄
= >
Transaccion
⁄
⁄
> I
.
⁄
⁄
I J
Comprobante
⁄
⁄
J U
.
⁄
⁄
U V
numero_serie
⁄
⁄
V b
,
⁄
⁄
b c
NumeroComprobante
€
€
. ?
=
€
€
@ A
c
€
€
B C
.
€
€
C D
Transaccion
€
€
D O
.
€
€
O P
Comprobante
€
€
P [
.
€
€
[ \
numero
€
€
\ b
,
€
€
b c
Total
‹
‹
. 3
=
‹
‹
4 5
c
‹
‹
6 7
.
‹
‹
7 8
total
‹
‹
8 =
,
‹
‹
= >
PagoACuenta
›
›
. 9
=
›
›
: ;
c
›
›
< =
.
›
›
= >
pago_a_cuenta
›
›
> K
,
›
›
K L
Revocado
ﬁ
ﬁ
. 6
=
ﬁ
ﬁ
7 8
c
ﬁ
ﬁ
9 :
.
ﬁ
ﬁ
: ;
revocado
ﬁ
ﬁ
; C
,
ﬁ
ﬁ
C D
Saldo
ﬂ
ﬂ
. 3
=
ﬂ
ﬂ
4 5
c
ﬂ
ﬂ
6 7
.
ﬂ
ﬂ
7 8
saldo
ﬂ
ﬂ
8 =
}
‡
‡
* +
)
‡
‡
+ ,
;
‡
‡
, -
return
·
·
 
	resultado
·
·
  
;
·
·
  !
}
‚
‚
 
catch
„
„
 
(
„
„
 
	Exception
„
„
 
e
„
„
 
)
„
„
 
{
‰
‰
 
throw
Â
Â
 
new
Â
Â
 
DatosException
Â
Â
 (
(
Â
Â
( )
$str
Â
Â
) B
,
Â
Â
B C
e
Â
Â
D E
)
Â
Â
E F
;
Â
Â
F G
}
Ê
Ê
 
}
Á
Á
 	
public
È
È
 
IEnumerable
È
È
 
<
È
È
 
Reporte_Pago
È
È
 '
>
È
È
' (
ObtenerPagos
È
È
) 5
(
È
È
5 6
DateTime
È
È
6 >

fechaDesde
È
È
? I
,
È
È
I J
DateTime
È
È
K S

fechaHasta
È
È
T ^
,
È
È
^ _
int
È
È
` c
[
È
È
c d
]
È
È
d e!
idsTiposTransaccion
È
È
f y
,
È
È
y z
int
È
È
{ ~
[
È
È
~ 
]È
È
 Ä&
idsActorNegocioInternoÈ
È
Å ó
,È
È
ó ò
intÈ
È
ô ú
[È
È
ú ù
]È
È
ù û&
idsActorNegocioExternoÈ
È
ü µ
)È
È
µ ∂
{
Í
Í
 	
try
Î
Î
 
{
Ï
Ï
 
var
Ì
Ì
 
	resultado
Ì
Ì
 
=
Ì
Ì
 
_db
Ì
Ì
  #
.
Ì
Ì
# $
Transaccion
Ì
Ì
$ /
.
Ó
Ó
# $
Where
Ó
Ó
$ )
(
Ó
Ó
) *
t
Ó
Ó
* +
=>
Ó
Ó
, .
t
Ô
Ô
, -
.
Ô
Ô
- .
fecha_inicio
Ô
Ô
. :
>=
Ô
Ô
; =

fechaDesde
Ô
Ô
> H
&&


, .
t


/ 0
.


0 1
fecha_inicio


1 =
<=


> @

fechaHasta


A K
&&
Ò
Ò
, .!
idsTiposTransaccion
Ò
Ò
/ B
.
Ò
Ò
B C
Contains
Ò
Ò
C K
(
Ò
Ò
K L
t
Ò
Ò
L M
.
Ò
Ò
M N!
id_tipo_transaccion
Ò
Ò
N a
)
Ò
Ò
a b
&&
Ú
Ú
, .$
idsActorNegocioInterno
Ú
Ú
/ E
.
Ú
Ú
E F
Contains
Ú
Ú
F N
(
Ú
Ú
N O
t
Ú
Ú
O P
.
Ú
Ú
P Q&
id_actor_negocio_interno
Ú
Ú
Q i
)
Ú
Ú
i j
&&
Û
Û
, .$
idsActorNegocioExterno
Û
Û
/ E
.
Û
Û
E F
Contains
Û
Û
F N
(
Û
Û
N O
t
Û
Û
O P
.
Û
Û
P Q&
id_actor_negocio_externo
Û
Û
Q i
)
Û
Û
i j
)
Ù
Ù
+ ,
.
ı
ı
% &

SelectMany
ı
ı
& 0
(
ı
ı
0 1
t
ı
ı
1 2
=>
ı
ı
3 5
t
ı
ı
6 7
.
ı
ı
7 8

Pago_cuota
ı
ı
8 B
)
ı
ı
B C
.
˜
˜
% &
Select
˜
˜
& ,
(
˜
˜
, -
pc
˜
˜
- /
=>
˜
˜
0 2
new
˜
˜
3 6
Reporte_Pago
˜
˜
7 C
(
˜
˜
C D
)
˜
˜
D E
{
˘
˘
% &
PrimerNombre
˙
˙
) 5
=
˙
˙
6 7
pc
˙
˙
8 :
.
˙
˙
: ;
Cuota
˙
˙
; @
.
˙
˙
@ A
Transaccion
˙
˙
A L
.
˙
˙
L M
Actor_negocio1
˙
˙
M [
.
˙
˙
[ \
Actor
˙
˙
\ a
.
˙
˙
a b
primer_nombre
˙
˙
b o
,
˙
˙
o p
NumeroDocumento
˚
˚
) 8
=
˚
˚
9 :
pc
˚
˚
; =
.
˚
˚
= >
Cuota
˚
˚
> C
.
˚
˚
C D
Transaccion
˚
˚
D O
.
˚
˚
O P
Actor_negocio1
˚
˚
P ^
.
˚
˚
^ _
Actor
˚
˚
_ d
.
˚
˚
d e(
numero_documento_identidad
˚
˚
e 
,˚
˚
 Ä
CodigoCuota
¸
¸
) 4
=
¸
¸
5 6
pc
¸
¸
7 9
.
¸
¸
9 :
Cuota
¸
¸
: ?
.
¸
¸
? @
codigo
¸
¸
@ F
,
¸
¸
F G
	FechaPago
˝
˝
) 2
=
˝
˝
3 4
pc
˝
˝
5 7
.
˝
˝
7 8
Cuota
˝
˝
8 =
.
˝
˝
= >
Transaccion
˝
˝
> I
.
˝
˝
I J
fecha_inicio
˝
˝
J V
,
˝
˝
V W
TipoComprobante
˛
˛
) 8
=
˛
˛
9 :
pc
˛
˛
; =
.
˛
˛
= >
Cuota
˛
˛
> C
.
˛
˛
C D
Transaccion
˛
˛
D O
.
˛
˛
O P
Comprobante
˛
˛
P [
.
˛
˛
[ \
Detalle_maestro
˛
˛
\ k
.
˛
˛
k l
nombre
˛
˛
l r
,
˛
˛
r s
CodigoComprobante
ˇ
ˇ
) :
=
ˇ
ˇ
; <
pc
ˇ
ˇ
= ?
.
ˇ
ˇ
? @
Cuota
ˇ
ˇ
@ E
.
ˇ
ˇ
E F
Transaccion
ˇ
ˇ
F Q
.
ˇ
ˇ
Q R
Comprobante
ˇ
ˇ
R ]
.
ˇ
ˇ
] ^
Detalle_maestro
ˇ
ˇ
^ m
.
ˇ
ˇ
m n
valor
ˇ
ˇ
n s
,
ˇ
ˇ
s t
NumeroSerie
ÄÄ) 4
=
ÄÄ5 6
pc
ÄÄ7 9
.
ÄÄ9 :
Cuota
ÄÄ: ?
.
ÄÄ? @
Transaccion
ÄÄ@ K
.
ÄÄK L
Comprobante
ÄÄL W
.
ÄÄW X
numero_serie
ÄÄX d
,
ÄÄd e
Trazas
ÅÅ) /
=
ÅÅ0 1
pc
ÅÅ2 4
.
ÅÅ4 5
Cuota
ÅÅ5 :
.
ÅÅ: ;
Transaccion
ÅÅ; F
.
ÅÅF G

Traza_pago
ÅÅG Q
.
ÅÅQ R
Select
ÅÅR X
(
ÅÅX Y
tp
ÅÅY [
=>
ÅÅ\ ^
tp
ÅÅ_ a
.
ÅÅa b
traza
ÅÅb g
)
ÅÅg h
,
ÅÅh i
NumeroComprobante
ÇÇ) :
=
ÇÇ; <
pc
ÇÇ= ?
.
ÇÇ? @
Cuota
ÇÇ@ E
.
ÇÇE F
Transaccion
ÇÇF Q
.
ÇÇQ R
Comprobante
ÇÇR ]
.
ÇÇ] ^
numero
ÇÇ^ d
,
ÇÇd e
PagoACuenta
ÉÉ) 4
=
ÉÉ5 6
pc
ÉÉ7 9
.
ÉÉ9 :
importe
ÉÉ: A
}
ÖÖ% &
)
ÖÖ& '
;
ÖÖ' (
return
ÜÜ 
	resultado
ÜÜ  
;
ÜÜ  !
}
áá 
catch
àà 
(
àà 
	Exception
àà 
e
àà 
)
àà 
{
ââ 
throw
ää 
new
ää 
DatosException
ää (
(
ää( )
$str
ää) A
,
ääA B
e
ääC D
)
ääD E
;
ääE F
}
ãã 
}
åå 	
public
éé 
IEnumerable
éé 
<
éé 
Reporte_Pago
éé '
>
éé' (!
ObtenerPagosExterno
éé) <
(
éé< =
DateTime
éé= E

fechaDesde
ééF P
,
ééP Q
DateTime
ééR Z

fechaHasta
éé[ e
,
éée f
int
éég j
[
ééj k
]
éék l"
idsTiposTransaccionéém Ä
,ééÄ Å
intééÇ Ö
[ééÖ Ü
]ééÜ á&
idsActorNegocioExternoééà û
)ééû ü
{
èè 	
try
êê 
{
ëë 
var
íí 
	resultado
íí 
=
íí 
_db
íí  #
.
íí# $
Transaccion
íí$ /
.
ìì# $
Where
ìì$ )
(
ìì) *
t
ìì* +
=>
ìì, .
t
îî, -
.
îî- .
fecha_inicio
îî. :
>=
îî; =

fechaDesde
îî> H
&&
ïï, .
t
ïï/ 0
.
ïï0 1
fecha_inicio
ïï1 =
<=
ïï> @

fechaHasta
ïïA K
&&
ññ, .!
idsTiposTransaccion
ññ/ B
.
ññB C
Contains
ññC K
(
ññK L
t
ññL M
.
ññM N!
id_tipo_transaccion
ññN a
)
ñña b
&&
óó, .$
idsActorNegocioExterno
óó/ E
.
óóE F
Contains
óóF N
(
óóN O
t
óóO P
.
óóP Q&
id_actor_negocio_externo
óóQ i
)
óói j
)
òò+ ,
.
ôô% &

SelectMany
ôô& 0
(
ôô0 1
t
ôô1 2
=>
ôô3 5
t
ôô6 7
.
ôô7 8

Pago_cuota
ôô8 B
)
ôôB C
.
õõ% &
Select
õõ& ,
(
õõ, -
pc
õõ- /
=>
õõ0 2
new
õõ3 6
Reporte_Pago
õõ7 C
(
õõC D
)
õõD E
{
ùù% &
PrimerNombre
ûû) 5
=
ûû6 7
pc
ûû8 :
.
ûû: ;
Cuota
ûû; @
.
ûû@ A
Transaccion
ûûA L
.
ûûL M
Actor_negocio1
ûûM [
.
ûû[ \
Actor
ûû\ a
.
ûûa b
primer_nombre
ûûb o
,
ûûo p
NumeroDocumento
üü) 8
=
üü9 :
pc
üü; =
.
üü= >
Cuota
üü> C
.
üüC D
Transaccion
üüD O
.
üüO P
Actor_negocio1
üüP ^
.
üü^ _
Actor
üü_ d
.
üüd e(
numero_documento_identidad
üüe 
,üü Ä
CodigoCuota
††) 4
=
††5 6
pc
††7 9
.
††9 :
Cuota
††: ?
.
††? @
codigo
††@ F
,
††F G
	FechaPago
°°) 2
=
°°3 4
pc
°°5 7
.
°°7 8
Cuota
°°8 =
.
°°= >
Transaccion
°°> I
.
°°I J
fecha_inicio
°°J V
,
°°V W
TipoComprobante
¢¢) 8
=
¢¢9 :
pc
¢¢; =
.
¢¢= >
Cuota
¢¢> C
.
¢¢C D
Transaccion
¢¢D O
.
¢¢O P
Comprobante
¢¢P [
.
¢¢[ \
Detalle_maestro
¢¢\ k
.
¢¢k l
nombre
¢¢l r
,
¢¢r s
CodigoComprobante
££) :
=
££; <
pc
££= ?
.
££? @
Cuota
££@ E
.
££E F
Transaccion
££F Q
.
££Q R
Comprobante
££R ]
.
££] ^
Detalle_maestro
££^ m
.
££m n
valor
££n s
,
££s t
NumeroSerie
§§) 4
=
§§5 6
pc
§§7 9
.
§§9 :
Cuota
§§: ?
.
§§? @
Transaccion
§§@ K
.
§§K L
Comprobante
§§L W
.
§§W X
numero_serie
§§X d
,
§§d e
Trazas
••) /
=
••0 1
pc
••2 4
.
••4 5
Cuota
••5 :
.
••: ;
Transaccion
••; F
.
••F G

Traza_pago
••G Q
.
••Q R
Select
••R X
(
••X Y
tp
••Y [
=>
••\ ^
tp
••_ a
.
••a b
traza
••b g
)
••g h
,
••h i
NumeroComprobante
¶¶) :
=
¶¶; <
pc
¶¶= ?
.
¶¶? @
Cuota
¶¶@ E
.
¶¶E F
Transaccion
¶¶F Q
.
¶¶Q R
Comprobante
¶¶R ]
.
¶¶] ^
numero
¶¶^ d
,
¶¶d e
PagoACuenta
ßß) 4
=
ßß5 6
pc
ßß7 9
.
ßß9 :
importe
ßß: A
}
©©% &
)
©©& '
;
©©' (
return
™™ 
	resultado
™™  
;
™™  !
}
´´ 
catch
¨¨ 
(
¨¨ 
	Exception
¨¨ 
e
¨¨ 
)
¨¨ 
{
≠≠ 
throw
ÆÆ 
new
ÆÆ 
DatosException
ÆÆ (
(
ÆÆ( )
$str
ÆÆ) A
,
ÆÆA B
e
ÆÆC D
)
ÆÆD E
;
ÆÆE F
}
ØØ 
}
∞∞ 	
public
≤≤ 
IEnumerable
≤≤ 
<
≤≤ 
Reporte_Pago
≤≤ '
>
≤≤' (!
ObtenerPagosInterno
≤≤) <
(
≤≤< =
DateTime
≤≤= E

fechaDesde
≤≤F P
,
≤≤P Q
DateTime
≤≤R Z

fechaHasta
≤≤[ e
,
≤≤e f
int
≤≤g j
[
≤≤j k
]
≤≤k l"
idsTiposTransaccion≤≤m Ä
,≤≤Ä Å
int≤≤Ç Ö
[≤≤Ö Ü
]≤≤Ü á&
idsActorNegocioInterno≤≤à û
)≤≤û ü
{
≥≥ 	
try
¥¥ 
{
µµ 
var
∂∂ 
	resultado
∂∂ 
=
∂∂ 
_db
∂∂  #
.
∂∂# $
Transaccion
∂∂$ /
.
∑∑# $
Where
∑∑$ )
(
∑∑) *
t
∑∑* +
=>
∑∑, .
t
∏∏, -
.
∏∏- .
fecha_inicio
∏∏. :
>=
∏∏; =

fechaDesde
∏∏> H
&&
ππ, .
t
ππ/ 0
.
ππ0 1
fecha_inicio
ππ1 =
<=
ππ> @

fechaHasta
ππA K
&&
∫∫, .!
idsTiposTransaccion
∫∫/ B
.
∫∫B C
Contains
∫∫C K
(
∫∫K L
t
∫∫L M
.
∫∫M N!
id_tipo_transaccion
∫∫N a
)
∫∫a b
&&
ªª, .$
idsActorNegocioInterno
ªª/ E
.
ªªE F
Contains
ªªF N
(
ªªN O
t
ªªO P
.
ªªP Q&
id_actor_negocio_interno
ªªQ i
)
ªªi j
)
ºº+ ,
.
ΩΩ% &

SelectMany
ΩΩ& 0
(
ΩΩ0 1
t
ΩΩ1 2
=>
ΩΩ3 5
t
ΩΩ6 7
.
ΩΩ7 8

Pago_cuota
ΩΩ8 B
)
ΩΩB C
.
øø% &
Select
øø& ,
(
øø, -
pc
øø- /
=>
øø0 2
new
øø3 6
Reporte_Pago
øø7 C
(
øøC D
)
øøD E
{
¡¡% &
PrimerNombre
¬¬) 5
=
¬¬6 7
pc
¬¬8 :
.
¬¬: ;
Cuota
¬¬; @
.
¬¬@ A
Transaccion
¬¬A L
.
¬¬L M
Actor_negocio1
¬¬M [
.
¬¬[ \
Actor
¬¬\ a
.
¬¬a b
primer_nombre
¬¬b o
,
¬¬o p
NumeroDocumento
√√) 8
=
√√9 :
pc
√√; =
.
√√= >
Cuota
√√> C
.
√√C D
Transaccion
√√D O
.
√√O P
Actor_negocio1
√√P ^
.
√√^ _
Actor
√√_ d
.
√√d e(
numero_documento_identidad
√√e 
,√√ Ä
CodigoCuota
ƒƒ) 4
=
ƒƒ5 6
pc
ƒƒ7 9
.
ƒƒ9 :
Cuota
ƒƒ: ?
.
ƒƒ? @
codigo
ƒƒ@ F
,
ƒƒF G
	FechaPago
≈≈) 2
=
≈≈3 4
pc
≈≈5 7
.
≈≈7 8
Cuota
≈≈8 =
.
≈≈= >
Transaccion
≈≈> I
.
≈≈I J
fecha_inicio
≈≈J V
,
≈≈V W
TipoComprobante
∆∆) 8
=
∆∆9 :
pc
∆∆; =
.
∆∆= >
Cuota
∆∆> C
.
∆∆C D
Transaccion
∆∆D O
.
∆∆O P
Comprobante
∆∆P [
.
∆∆[ \
Detalle_maestro
∆∆\ k
.
∆∆k l
nombre
∆∆l r
,
∆∆r s
CodigoComprobante
««) :
=
««; <
pc
««= ?
.
««? @
Cuota
««@ E
.
««E F
Transaccion
««F Q
.
««Q R
Comprobante
««R ]
.
««] ^
Detalle_maestro
««^ m
.
««m n
valor
««n s
,
««s t
NumeroSerie
»») 4
=
»»5 6
pc
»»7 9
.
»»9 :
Cuota
»»: ?
.
»»? @
Transaccion
»»@ K
.
»»K L
Comprobante
»»L W
.
»»W X
numero_serie
»»X d
,
»»d e
Trazas
……) /
=
……0 1
pc
……2 4
.
……4 5
Cuota
……5 :
.
……: ;
Transaccion
……; F
.
……F G

Traza_pago
……G Q
.
……Q R
Select
……R X
(
……X Y
tp
……Y [
=>
……\ ^
tp
……_ a
.
……a b
traza
……b g
)
……g h
,
……h i
NumeroComprobante
  ) :
=
  ; <
pc
  = ?
.
  ? @
Cuota
  @ E
.
  E F
Transaccion
  F Q
.
  Q R
Comprobante
  R ]
.
  ] ^
numero
  ^ d
,
  d e
PagoACuenta
ÀÀ) 4
=
ÀÀ5 6
pc
ÀÀ7 9
.
ÀÀ9 :
importe
ÀÀ: A
}
ÕÕ% &
)
ÕÕ& '
;
ÕÕ' (
return
ŒŒ 
	resultado
ŒŒ  
;
ŒŒ  !
}
œœ 
catch
–– 
(
–– 
	Exception
–– 
e
–– 
)
–– 
{
—— 
throw
““ 
new
““ 
DatosException
““ (
(
““( )
$str
““) A
,
““A B
e
““C D
)
““D E
;
““E F
}
”” 
}
‘‘ 	
public
÷÷ 
IEnumerable
÷÷ 
<
÷÷ 
Reporte_Pago
÷÷ '
>
÷÷' (
ObtenerPagos
÷÷) 5
(
÷÷5 6
DateTime
÷÷6 >

fechaDesde
÷÷? I
,
÷÷I J
DateTime
÷÷K S

fechaHasta
÷÷T ^
,
÷÷^ _
int
÷÷` c
[
÷÷c d
]
÷÷d e!
idsTiposTransaccion
÷÷f y
)
÷÷y z
{
◊◊ 	
try
ÿÿ 
{
ŸŸ 
var
⁄⁄ 
	resultado
⁄⁄ 
=
⁄⁄ 
_db
⁄⁄  #
.
⁄⁄# $
Transaccion
⁄⁄$ /
.
€€# $
Where
€€$ )
(
€€) *
t
€€* +
=>
€€, .
t
‹‹, -
.
‹‹- .
fecha_inicio
‹‹. :
>=
‹‹; =

fechaDesde
‹‹> H
&&
››, .
t
››/ 0
.
››0 1
fecha_inicio
››1 =
<=
››> @

fechaHasta
››A K
&&
ﬁﬁ, .!
idsTiposTransaccion
ﬁﬁ/ B
.
ﬁﬁB C
Contains
ﬁﬁC K
(
ﬁﬁK L
t
ﬁﬁL M
.
ﬁﬁM N!
id_tipo_transaccion
ﬁﬁN a
)
ﬁﬁa b
)
ﬂﬂ+ ,
.
‡‡% &

SelectMany
‡‡& 0
(
‡‡0 1
t
‡‡1 2
=>
‡‡3 5
t
‡‡6 7
.
‡‡7 8

Pago_cuota
‡‡8 B
)
‡‡B C
.
‚‚% &
Select
‚‚& ,
(
‚‚, -
pc
‚‚- /
=>
‚‚0 2
new
‚‚3 6
Reporte_Pago
‚‚7 C
(
‚‚C D
)
‚‚D E
{
‰‰% &
PrimerNombre
ÂÂ) 5
=
ÂÂ6 7
pc
ÂÂ8 :
.
ÂÂ: ;
Cuota
ÂÂ; @
.
ÂÂ@ A
Transaccion
ÂÂA L
.
ÂÂL M
Actor_negocio1
ÂÂM [
.
ÂÂ[ \
Actor
ÂÂ\ a
.
ÂÂa b
primer_nombre
ÂÂb o
,
ÂÂo p
NumeroDocumento
ÊÊ) 8
=
ÊÊ9 :
pc
ÊÊ; =
.
ÊÊ= >
Cuota
ÊÊ> C
.
ÊÊC D
Transaccion
ÊÊD O
.
ÊÊO P
Actor_negocio1
ÊÊP ^
.
ÊÊ^ _
Actor
ÊÊ_ d
.
ÊÊd e(
numero_documento_identidad
ÊÊe 
,ÊÊ Ä
CodigoCuota
ÁÁ) 4
=
ÁÁ5 6
pc
ÁÁ7 9
.
ÁÁ9 :
Cuota
ÁÁ: ?
.
ÁÁ? @
codigo
ÁÁ@ F
,
ÁÁF G
	FechaPago
ËË) 2
=
ËË3 4
pc
ËË5 7
.
ËË7 8
Cuota
ËË8 =
.
ËË= >
Transaccion
ËË> I
.
ËËI J
fecha_inicio
ËËJ V
,
ËËV W
TipoComprobante
ÈÈ) 8
=
ÈÈ9 :
pc
ÈÈ; =
.
ÈÈ= >
Cuota
ÈÈ> C
.
ÈÈC D
Transaccion
ÈÈD O
.
ÈÈO P
Comprobante
ÈÈP [
.
ÈÈ[ \
Detalle_maestro
ÈÈ\ k
.
ÈÈk l
nombre
ÈÈl r
,
ÈÈr s
CodigoComprobante
ÍÍ) :
=
ÍÍ; <
pc
ÍÍ= ?
.
ÍÍ? @
Cuota
ÍÍ@ E
.
ÍÍE F
Transaccion
ÍÍF Q
.
ÍÍQ R
Comprobante
ÍÍR ]
.
ÍÍ] ^
Detalle_maestro
ÍÍ^ m
.
ÍÍm n
valor
ÍÍn s
,
ÍÍs t
NumeroSerie
ÎÎ) 4
=
ÎÎ5 6
pc
ÎÎ7 9
.
ÎÎ9 :
Cuota
ÎÎ: ?
.
ÎÎ? @
Transaccion
ÎÎ@ K
.
ÎÎK L
Comprobante
ÎÎL W
.
ÎÎW X
numero_serie
ÎÎX d
,
ÎÎd e
Trazas
ÏÏ) /
=
ÏÏ0 1
pc
ÏÏ2 4
.
ÏÏ4 5
Cuota
ÏÏ5 :
.
ÏÏ: ;
Transaccion
ÏÏ; F
.
ÏÏF G

Traza_pago
ÏÏG Q
.
ÏÏQ R
Select
ÏÏR X
(
ÏÏX Y
tp
ÏÏY [
=>
ÏÏ\ ^
tp
ÏÏ_ a
.
ÏÏa b
traza
ÏÏb g
)
ÏÏg h
,
ÏÏh i
NumeroComprobante
ÌÌ) :
=
ÌÌ; <
pc
ÌÌ= ?
.
ÌÌ? @
Cuota
ÌÌ@ E
.
ÌÌE F
Transaccion
ÌÌF Q
.
ÌÌQ R
Comprobante
ÌÌR ]
.
ÌÌ] ^
numero
ÌÌ^ d
,
ÌÌd e
PagoACuenta
ÓÓ) 4
=
ÓÓ5 6
pc
ÓÓ7 9
.
ÓÓ9 :
importe
ÓÓ: A
}
% &
)
& '
;
' (
return
ÒÒ 
	resultado
ÒÒ  
;
ÒÒ  !
}
ÚÚ 
catch
ÛÛ 
(
ÛÛ 
	Exception
ÛÛ 
e
ÛÛ 
)
ÛÛ 
{
ÙÙ 
throw
ıı 
new
ıı 
DatosException
ıı (
(
ıı( )
$str
ıı) A
,
ııA B
e
ııC D
)
ııD E
;
ııE F
}
ˆˆ 
}
˜˜ 	
public
ˇˇ 
IEnumerable
ˇˇ 
<
ˇˇ @
2Movimientos_concepto_negocio_actor_negocio_interno
ˇˇ M
>
ˇˇM N6
(ObtenerMovimientosConceptoNegocioConLote
ˇˇO w
(
ˇˇw x
int
ˇˇx {$
idActorNegocioInternoˇˇ| ë
,ˇˇë í
stringˇˇì ô
[ˇˇô ö
]ˇˇö õ'
conceptosNegocioConLoteˇˇú ≥
,ˇˇ≥ ¥
DateTimeˇˇµ Ω

fechaDesdeˇˇæ »
)ˇˇ» …
{
ÄÄ 	
try
ÅÅ 
{
ÇÇ 
var
ÉÉ 
movimientos
ÉÉ 
=
ÉÉ  !
_db
ÉÉ" %
.
ÉÉ% &
Transaccion
ÉÉ& 1
.
ÑÑ 
Where
ÑÑ 
(
ÑÑ 
t
ÑÑ 
=>
ÑÑ #
idActorNegocioInterno
ÑÑ  5
==
ÑÑ6 8
t
ÑÑ9 :
.
ÑÑ: ;&
id_actor_negocio_interno
ÑÑ; S
&&
ÑÑT V
t
ÑÑW X
.
ÑÑX Y
fecha_inicio
ÑÑY e
>=
ÑÑf h

fechaDesde
ÑÑi s
)
ÑÑs t
.
ÖÖ 

SelectMany
ÖÖ 
(
ÖÖ  
t
ÖÖ  !
=>
ÖÖ" $
t
ÖÖ% &
.
ÖÖ& '!
Detalle_transaccion
ÖÖ' :
)
ÖÖ: ;
.
ÖÖ; <
Where
ÖÖ< A
(
ÖÖA B
dt
ÖÖB D
=>
ÖÖE G%
conceptosNegocioConLote
ÖÖH _
.
ÖÖ_ `
Contains
ÖÖ` h
(
ÖÖh i
String
ÖÖi o
.
ÖÖo p
Concat
ÖÖp v
(
ÖÖv w
dt
ÖÖw y
.
ÖÖy z"
id_concepto_negocioÖÖz ç
,ÖÖç é
$strÖÖè í
,ÖÖí ì
dtÖÖî ñ
.ÖÖñ ó
loteÖÖó õ
)ÖÖõ ú
)ÖÖú ù
)ÖÖù û
.ÖÖû ü
GroupBy
ÜÜ 
(
ÜÜ 
dt
ÜÜ 
=>
ÜÜ !
new
ÜÜ" %
{
áá 
IdEntidadInterna
àà (
=
àà) *
dt
àà+ -
.
àà- .
Transaccion
àà. 9
.
àà9 :&
id_actor_negocio_interno
àà: R
,
ààR S
IdConceptoNegocio
ââ )
=
ââ* +
dt
ââ, .
.
ââ. /!
id_concepto_negocio
ââ/ B
,
ââB C
Lote
ää 
=
ää 
dt
ää !
.
ää! "
lote
ää" &
}
ãã 
)
ãã 
.
ãã 
Select
ãã 
(
ãã 
m
ãã 
=>
ãã  "
new
ãã# &@
2Movimientos_concepto_negocio_actor_negocio_interno
ãã' Y
(
ããY Z
)
ããZ [
{
åå  
Id_entidad_interna
çç *
=
çç+ ,
m
çç- .
.
çç. /
Key
çç/ 2
.
çç2 3
IdEntidadInterna
çç3 C
,
ççC D!
Id_concepto_negocio
éé +
=
éé, -
m
éé. /
.
éé/ 0
Key
éé0 3
.
éé3 4
IdConceptoNegocio
éé4 E
,
ééE F
Lote
èè 
=
èè 
m
èè  
.
èè  !
Key
èè! $
.
èè$ %
Lote
èè% )
,
èè) * 
Entradas_principal
êê *
=
êê+ ,
m
êê- .
.
êê. /
Where
êê/ 4
(
êê4 5
dt
êê5 7
=>
êê8 :
dt
êê; =
.
êê= >
Transaccion
êê> I
.
êêI J
Tipo_transaccion
êêJ Z
.
êêZ [5
&Accion_de_negocio_por_tipo_transaccionêê[ Å
.êêÅ Ç
AnyêêÇ Ö
(êêÖ Ü
anttêêÜ ä
=>êêã ç
anttêêé í
.êêí ì$
id_accion_de_negocioêêì ß
==êê® ™#
TransaccionSettingsêê´ æ
.êêæ ø
Defaultêêø ∆
.êê∆ «4
$IdAccionDeNegocioMovimientoEnAlmacenêê« Î
&&êêÏ Ó
anttêêÔ Û
.êêÛ Ù
valorêêÙ ˘
)êê˘ ˙
&&êê˚ ˝
dtêê˛ Ä
.êêÄ Å
TransaccionêêÅ å
.êêå ç 
id_estado_actualêêç ù
==êêû †
MaestroSettingsêê° ∞
.êê∞ ±
Defaultêê± ∏
.êê∏ π0
 IdDetalleMaestroEstadoConfirmadoêêπ Ÿ
)êêŸ ⁄
.êê⁄ €
Selectêê€ ·
(êê· ‚
dtêê‚ ‰
=>êêÂ Á
dtêêË Í
.êêÍ Î
cantidadêêÎ Û
)êêÛ Ù
.êêÙ ı
DefaultIfEmptyêêı É
(êêÉ Ñ
$numêêÑ Ö
)êêÖ Ü
.êêÜ á
Sumêêá ä
(êêä ã
)êêã å
,êêå ç
Salidas_principal
ëë )
=
ëë* +
m
ëë, -
.
ëë- .
Where
ëë. 3
(
ëë3 4
dt
ëë4 6
=>
ëë7 9
dt
ëë: <
.
ëë< =
Transaccion
ëë= H
.
ëëH I
Tipo_transaccion
ëëI Y
.
ëëY Z5
&Accion_de_negocio_por_tipo_transaccionëëZ Ä
.ëëÄ Å
AnyëëÅ Ñ
(ëëÑ Ö
anttëëÖ â
=>ëëä å
anttëëç ë
.ëëë í$
id_accion_de_negocioëëí ¶
==ëëß ©#
TransaccionSettingsëë™ Ω
.ëëΩ æ
Defaultëëæ ≈
.ëë≈ ∆4
$IdAccionDeNegocioMovimientoEnAlmacenëë∆ Í
&&ëëÎ Ì
!ëëÓ Ô
anttëëÔ Û
.ëëÛ Ù
valorëëÙ ˘
)ëë˘ ˙
&&ëë˚ ˝
dtëë˛ Ä
.ëëÄ Å
TransaccionëëÅ å
.ëëå ç 
id_estado_actualëëç ù
==ëëû †
MaestroSettingsëë° ∞
.ëë∞ ±
Defaultëë± ∏
.ëë∏ π0
 IdDetalleMaestroEstadoConfirmadoëëπ Ÿ
)ëëŸ ⁄
.ëë⁄ €
Selectëë€ ·
(ëë· ‚
dtëë‚ ‰
=>ëëÂ Á
dtëëË Í
.ëëÍ Î
cantidadëëÎ Û
)ëëÛ Ù
.ëëÙ ı
DefaultIfEmptyëëı É
(ëëÉ Ñ
$numëëÑ Ö
)ëëÖ Ü
.ëëÜ á
Sumëëá ä
(ëëä ã
)ëëã å
}
íí 
)
íí 
;
íí 
return
ìì 
movimientos
ìì "
;
ìì" #
}
îî 
catch
ïï 
(
ïï 
	Exception
ïï 
e
ïï 
)
ïï 
{
ññ 
throw
óó 
e
óó 
;
óó 
}
òò 
}
ôô 	
public
üü 
IEnumerable
üü 
<
üü %
Reporte_Concepto_Basico
üü 2
>
üü2 3-
ObtenerReportePorConceptoBasico
üü4 S
(
üüS T
DateTime
üüT \

fechaDesde
üü] g
,
üüg h
DateTime
üüi q

fechaHasta
üür |
,
üü| }
intüü~ Å 
idConceptoBasicoüüÇ í
,üüí ì
intüüî ó
[üüó ò
]üüò ô#
idsTiposTransaccionüüö ≠
,üü≠ Æ
intüüØ ≤
[üü≤ ≥
]üü≥ ¥#
idsTiposComprobanteüüµ »
,üü» …
intüü  Õ
[üüÕ Œ
]üüŒ œ&
idsActorNegocioInternoüü– Ê
)üüÊ Á
{
†† 	
try
°° 
{
¢¢ 
var
§§ 
	resultado
§§ 
=
§§ 
_db
§§  #
.
§§# $
Transaccion
§§$ /
.
••# $
Where
••$ )
(
••) *
t
••* +
=>
••, .
t
¶¶, -
.
¶¶- .
fecha_inicio
¶¶. :
>=
¶¶; =

fechaDesde
¶¶> H
&&
ßß, .
t
ßß/ 0
.
ßß0 1
fecha_inicio
ßß1 =
<=
ßß> @

fechaHasta
ßßA K
&&
®®, .$
idsActorNegocioInterno
®®/ E
.
®®E F
Contains
®®F N
(
®®N O
t
®®O P
.
®®P Q&
id_actor_negocio_interno
®®Q i
)
®®i j
&&
©©, .!
idsTiposTransaccion
©©/ B
.
©©B C
Contains
©©C K
(
©©K L
t
©©L M
.
©©M N!
id_tipo_transaccion
©©N a
)
©©a b
&&
™™, .!
idsTiposComprobante
™™/ B
.
™™B C
Contains
™™C K
(
™™K L
t
™™L M
.
™™M N
Comprobante
™™N Y
.
™™Y Z!
id_tipo_comprobante
™™Z m
)
™™m n
&&
´´, .
t
´´/ 0
.
´´0 1
id_estado_actual
´´1 A
==
´´B D
MaestroSettings
´´E T
.
´´T U
Default
´´U \
.
´´\ ].
 IdDetalleMaestroEstadoConfirmado
´´] }
)
¨¨& '
.
≠≠% &

SelectMany
≠≠& 0
(
≠≠0 1
t
≠≠1 2
=>
≠≠3 5
t
≠≠6 7
.
≠≠7 8!
Detalle_transaccion
≠≠8 K
)
≠≠K L
.
ÆÆ% &
Where
ÆÆ& +
(
ÆÆ+ ,
dt
ÆÆ, .
=>
ÆÆ/ 1
dt
ÆÆ2 4
.
ÆÆ4 5
Concepto_negocio
ÆÆ5 E
.
ÆÆE F
Detalle_maestro4
ÆÆF V
.
ÆÆV W
id
ÆÆW Y
==
ÆÆZ \
idConceptoBasico
ÆÆ] m
)
ÆÆm n
.
ØØ% &
Select
ØØ& ,
(
ØØ, -
rcb
ØØ- 0
=>
ØØ1 3
new
ØØ4 7%
Reporte_Concepto_Basico
ØØ8 O
(
ØØO P
)
ØØP Q
{
±±% &
FechaInicio
≤≤) 4
=
≤≤5 6
rcb
≤≤7 :
.
≤≤: ;
Transaccion
≤≤; F
.
≤≤F G
fecha_inicio
≤≤G S
,
≤≤S T
CantidadVendida
≥≥) 8
=
≥≥9 :
rcb
≥≥; >
.
≥≥> ?
cantidad
≥≥? G
,
≥≥G H
IdConceptoNegocio
¥¥) :
=
¥¥; <
rcb
¥¥= @
.
¥¥@ A
Concepto_negocio
¥¥A Q
.
¥¥Q R
Detalle_maestro4
¥¥R b
.
¥¥b c
id
¥¥c e
,
¥¥e f"
NombreConceptoBasico
µµ) =
=
µµ> ?
rcb
µµ@ C
.
µµC D
Concepto_negocio
µµD T
.
µµT U
Detalle_maestro4
µµU e
.
µµe f
nombre
µµf l
,
µµl m#
NombreConceptoNegocio
∂∂) >
=
∂∂? @
rcb
∂∂A D
.
∂∂D E
Concepto_negocio
∂∂E U
.
∂∂U V
nombre
∂∂V \
,
∂∂\ ]
Sufijo
∑∑) /
=
∑∑0 1
rcb
∑∑2 5
.
∑∑5 6
Concepto_negocio
∑∑6 F
.
∑∑F G
sufijo
∑∑G M
,
∑∑M N 
NombrePresentacion
∫∫) ;
=
∫∫< =
rcb
∫∫> A
.
∫∫A B
Concepto_negocio
∫∫B R
.
∫∫R S
Detalle_maestro3
∫∫S c
.
∫∫c d
nombre
∫∫d j
,
∫∫j k
	Contenido
ΩΩ) 2
=
ΩΩ3 4
rcb
ΩΩ5 8
.
ΩΩ8 9
Concepto_negocio
ΩΩ9 I
.
ΩΩI J
	contenido
ΩΩJ S
,
ΩΩS T
ValorUnidadMedida
øø) :
=
øø; <
rcb
øø= @
.
øø@ A
Concepto_negocio
øøA Q
.
øøQ R
Detalle_maestro1
øøR b
.
øøb c
valor
øøc h
,
øøh i 
NombreUnidadMedida
¿¿) ;
=
¿¿< =
rcb
¿¿> A
.
¿¿A B
Concepto_negocio
¿¿B R
.
¿¿R S
Detalle_maestro1
¿¿S c
.
¿¿c d
nombre
¿¿d j
,
¿¿j k
IdTipoComprobante
¬¬) :
=
¬¬; <
rcb
¬¬= @
.
¬¬@ A
Transaccion
¬¬A L
.
¬¬L M
Comprobante
¬¬M X
.
¬¬X Y!
id_tipo_comprobante
¬¬Y l
,
¬¬l m#
CodigoTipoComprobante
√√) >
=
√√? @
rcb
√√A D
.
√√D E
Transaccion
√√E P
.
√√P Q
Comprobante
√√Q \
.
√√\ ]
Detalle_maestro
√√] l
.
√√l m
valor
√√m r
,
√√r s
NumeroComprobante
ƒƒ) :
=
ƒƒ; <
rcb
ƒƒ= @
.
ƒƒ@ A
Transaccion
ƒƒA L
.
ƒƒL M
Comprobante
ƒƒM X
.
ƒƒX Y
numero
ƒƒY _
,
ƒƒ_ `$
NumeroSerieComprobante
≈≈) ?
=
≈≈@ A
rcb
≈≈B E
.
≈≈E F
Transaccion
≈≈F Q
.
≈≈Q R
Comprobante
≈≈R ]
.
≈≈] ^
numero_serie
≈≈^ j
,
≈≈j k
NombreCliente
««) 6
=
««7 8
rcb
««9 <
.
««< =
Transaccion
««= H
.
««H I
Actor_negocio1
««I W
.
««W X
Actor
««X ]
.
««] ^
primer_nombre
««^ k
,
««k l$
NumeroDocumentoCliente
»») ?
=
»»@ A
rcb
»»B E
.
»»E F
Transaccion
»»F Q
.
»»Q R
Actor_negocio1
»»R `
.
»»` a
Actor
»»a f
.
»»f g)
numero_documento_identidad»»g Å
,»»Å Ç
CodigoUbigeo
  ) 5
=
  6 7
rcb
  8 ;
.
  ; <
Transaccion
  < G
.
  G H
Actor_negocio2
  H V
.
  V W
Actor_negocio2
  W e
.
  e f
Actor
  f k
.
  k l
	Direccion
  l u
.
  u v
Where
  v {
(
  { |
d
  | }
=>  ~ Ä
d  Å Ç
.  Ç É!
id_tipo_direccion  É î
==  ï ó
MaestroSettings  ò ß
.  ß ®
Default  ® Ø
.  Ø ∞<
,IdDetalleMaestroTipoDireccionDomicilioFiscal  ∞ ‹
&&  › ﬂ
d  ‡ ·
.  · ‚
	es_activo  ‚ Î
)  Î Ï
.  Ï Ì
FirstOrDefault  Ì ˚
(  ˚ ¸
)  ¸ ˝
.  ˝ ˛
	id_ubigeo  ˛ á
,  á à'
DireccionCentroDeAtencion
ÀÀ) B
=
ÀÀC D
rcb
ÀÀE H
.
ÀÀH I
Transaccion
ÀÀI T
.
ÀÀT U
Actor_negocio2
ÀÀU c
.
ÀÀc d
Actor_negocio2
ÀÀd r
.
ÀÀr s
Actor
ÀÀs x
.
ÀÀx y
	DireccionÀÀy Ç
.ÀÀÇ É
WhereÀÀÉ à
(ÀÀà â
dÀÀâ ä
=>ÀÀã ç
dÀÀé è
.ÀÀè ê!
id_tipo_direccionÀÀê °
==ÀÀ¢ §
MaestroSettingsÀÀ• ¥
.ÀÀ¥ µ
DefaultÀÀµ º
.ÀÀº Ω<
,IdDetalleMaestroTipoDireccionDomicilioFiscalÀÀΩ È
&&ÀÀÍ Ï
dÀÀÌ Ó
.ÀÀÓ Ô
	es_activoÀÀÔ ¯
)ÀÀ¯ ˘
.ÀÀ˘ ˙
FirstOrDefaultÀÀ˙ à
(ÀÀà â
)ÀÀâ ä
.ÀÀä ã
detalleÀÀã í
,ÀÀí ì
}
œœ% &
)
œœ& '
;
œœ' (
return
—— 
	resultado
——  
;
——  !
}
““ 
catch
”” 
(
”” 
	Exception
”” 
e
”” 
)
”” 
{
‘‘ 
throw
’’ 
new
’’ 
DatosException
’’ (
(
’’( )
$str
’’) V
,
’’V W
e
’’X Y
)
’’Y Z
;
’’Z [
}
◊◊ 
}
ÿÿ 	
public
›› 
int
›› Q
CObtenerLaCantidadDeDetallesDeTransaccionOcurridasPorConceptoNegocio
›› V
(
››V W
int
››W Z
idConceptoNegocio
››[ l
,
››l m
int
››n q 
idTipoTransaccion››r É
)››É Ñ
{
ﬁﬁ 	
int
ﬂﬂ 
cantidad
ﬂﬂ 
=
ﬂﬂ 
_db
ﬂﬂ 
.
ﬂﬂ 
Transaccion
ﬂﬂ *
.
ﬂﬂ* +
Where
ﬂﬂ+ 0
(
ﬂﬂ0 1
t
ﬂﬂ1 2
=>
ﬂﬂ3 5
t
ﬂﬂ6 7
.
ﬂﬂ7 8!
id_tipo_transaccion
ﬂﬂ8 K
==
ﬂﬂL N
idTipoTransaccion
ﬂﬂO `
)
ﬂﬂ` a
.
‡‡* +

SelectMany
‡‡+ 5
(
‡‡5 6
t
‡‡6 7
=>
‡‡8 :
t
‡‡; <
.
‡‡< =!
Detalle_transaccion
‡‡= P
)
‡‡P Q
.
‡‡Q R
Where
‡‡R W
(
‡‡W X
dt
‡‡X Z
=>
‡‡[ ]
dt
‡‡^ `
.
‡‡` a!
id_concepto_negocio
‡‡a t
==
‡‡u w 
idConceptoNegocio‡‡x â
)‡‡â ä
.
··* +
Count
··+ 0
(
··0 1
)
··1 2
;
··2 3
return
‚‚ 
cantidad
‚‚ 
;
‚‚ 
}
„„ 	
public
ÈÈ 
IEnumerable
ÈÈ 
<
ÈÈ &
CostoUtilidadPorConcepto
ÈÈ 3
>
ÈÈ3 48
*ObtenerReporteDeUtilidadDeVentasPorFamilia
ÈÈ5 _
(
ÈÈ_ `
int
ÈÈ` c 
idTransaccionOrden
ÈÈd v
,
ÈÈv w
int
ÈÈx {&
idTransaccionMovimientoÈÈ| ì
,ÈÈì î
intÈÈï ò
idEstadoÈÈô °
,ÈÈ° ¢
DateTimeÈÈ£ ´

fechaDesdeÈÈ¨ ∂
,ÈÈ∂ ∑
DateTimeÈÈ∏ ¿

fechaHastaÈÈ¡ À
)ÈÈÀ Ã
{
ÍÍ 	
try
ÎÎ 
{
ÏÏ 
var
ÌÌ 
Resumen
ÌÌ 
=
ÌÌ 
_db
ÌÌ !
.
ÌÌ! "
Transaccion
ÌÌ" -
.
ÌÌ- .
Where
ÌÌ. 3
(
ÌÌ3 4
t
ÌÌ4 5
=>
ÌÌ6 8
t
ÌÌ9 :
.
ÌÌ: ;
fecha_inicio
ÌÌ; G
>=
ÌÌH J

fechaDesde
ÌÌK U
&&
ÌÌV X
t
ÌÌY Z
.
ÌÌZ [
fecha_inicio
ÌÌ[ g
<=
ÌÌh j

fechaHasta
ÌÌk u
&&
ÌÌv x
t
ÌÌy z
.
ÌÌz {"
id_tipo_transaccionÌÌ{ é
==ÌÌè ë"
idTransaccionOrdenÌÌí §
&&ÌÌ• ß
tÌÌ® ©
.ÌÌ© ™ 
id_estado_actualÌÌ™ ∫
==ÌÌª Ω
idEstadoÌÌæ ∆
)ÌÌ∆ «
.
ÓÓ 

SelectMany
ÓÓ 
(
ÓÓ  
t
ÓÓ  !
=>
ÓÓ" $
t
ÓÓ% &
.
ÓÓ& '!
Detalle_transaccion
ÓÓ' :
)
ÓÓ: ;
.
ÓÓ; <
Where
ÓÓ< A
(
ÓÓA B
dt
ÓÓB D
=>
ÓÓE G
dt
ÓÓH J
.
ÓÓJ K
Concepto_negocio
ÓÓK [
.
ÓÓ[ \
Detalle_maestro4
ÓÓ\ l
.
ÓÓl m
valor
ÓÓm r
.
ÓÓr s
Equals
ÓÓs y
(
ÓÓy z
$str
ÓÓz }
)
ÓÓ} ~
)
ÓÓ~ 
.
ÔÔ 
GroupBy
ÔÔ 
(
ÔÔ 
dt
ÔÔ 
=>
ÔÔ  "
new
ÔÔ# &
{
 

idConcepto
ÒÒ "
=
ÒÒ# $
dt
ÒÒ% '
.
ÒÒ' (
Concepto_negocio
ÒÒ( 8
.
ÒÒ8 9
Detalle_maestro4
ÒÒ9 I
.
ÒÒI J
id
ÒÒJ L
,
ÒÒL M
concepto
ÚÚ  
=
ÚÚ! "
dt
ÚÚ# %
.
ÚÚ% &
Concepto_negocio
ÚÚ& 6
.
ÚÚ6 7
Detalle_maestro4
ÚÚ7 G
.
ÚÚG H
nombre
ÚÚH N
,
ÚÚN O
}
ÛÛ 
)
ÛÛ 
.
ÛÛ 
Select
ÛÛ 
(
ÛÛ 
dt
ÛÛ  
=>
ÛÛ! #
new
ÛÛ$ '&
CostoUtilidadPorConcepto
ÛÛ( @
(
ÛÛ@ A
)
ÛÛA B
{
ÙÙ 

IdConcepto
ıı "
=
ıı# $
dt
ıı% '
.
ıı' (
Key
ıı( +
.
ıı+ ,

idConcepto
ıı, 6
,
ıı6 7
Concepto
ˆˆ  
=
ˆˆ! "
dt
ˆˆ# %
.
ˆˆ% &
Key
ˆˆ& )
.
ˆˆ) *
concepto
ˆˆ* 2
,
ˆˆ2 3
Cantidad
˜˜  
=
˜˜! "
dt
˜˜# %
.
˜˜% &
Sum
˜˜& )
(
˜˜) *
i
˜˜* +
=>
˜˜, .
i
˜˜/ 0
.
˜˜0 1
cantidad
˜˜1 9
)
˜˜9 :
,
˜˜: ;
Importe
¯¯ 
=
¯¯  !
dt
¯¯" $
.
¯¯$ %
Sum
¯¯% (
(
¯¯( )
i
¯¯) *
=>
¯¯+ -
i
¯¯. /
.
¯¯/ 0
total
¯¯0 5
)
¯¯5 6
,
¯¯6 7
Costo
˘˘ 
=
˘˘ 
dt
˘˘  "
.
˘˘" #
Sum
˘˘# &
(
˘˘& '
i
˘˘' (
=>
˘˘) +
i
˘˘, -
.
˘˘- .
Transaccion
˘˘. 9
.
˘˘9 :
Transaccion11
˘˘: G
.
˘˘G H
Where
˘˘H M
(
˘˘M N
tt
˘˘N P
=>
˘˘Q S
tt
˘˘T V
.
˘˘V W!
id_tipo_transaccion
˘˘W j
==
˘˘k m&
idTransaccionMovimiento˘˘n Ö
&&˘˘Ü à
tt˘˘â ã
.˘˘ã å 
id_estado_actual˘˘å ú
==˘˘ù ü
MaestroSettings˘˘† Ø
.˘˘Ø ∞
Default˘˘∞ ∑
.˘˘∑ ∏0
 IdDetalleMaestroEstadoConfirmado˘˘∏ ÿ
)˘˘ÿ Ÿ
.˘˘Ÿ ⁄

SelectMany˘˘⁄ ‰
(˘˘‰ Â
td˘˘Â Á
=>˘˘Ë Í
td˘˘Î Ì
.˘˘Ì Ó#
Detalle_transaccion˘˘Ó Å
)˘˘Å Ç
.˘˘Ç É
Where˘˘É à
(˘˘à â
dtt˘˘â å
=>˘˘ç è
dtt˘˘ê ì
.˘˘ì î 
Concepto_negocio˘˘î §
.˘˘§ • 
Detalle_maestro4˘˘• µ
.˘˘µ ∂
id˘˘∂ ∏
==˘˘π ª
dt˘˘º æ
.˘˘æ ø
Key˘˘ø ¬
.˘˘¬ √

idConcepto˘˘√ Õ
)˘˘Õ Œ
.˘˘Œ œ
Average˘˘œ ÷
(˘˘÷ ◊
dd˘˘◊ Ÿ
=>˘˘⁄ ‹
dd˘˘› ﬂ
.˘˘ﬂ ‡
total˘˘‡ Â
)˘˘Â Ê
)˘˘Ê Á
}
˙˙ 
)
˙˙ 
;
˙˙ 
return
˚˚ 
Resumen
˚˚ 
;
˚˚ 
}
¸¸ 
catch
˝˝ 
(
˝˝ 
	Exception
˝˝ 
e
˝˝ 
)
˝˝ 
{
˛˛ 
throw
ˇˇ 
new
ˇˇ 
DatosException
ˇˇ (
(
ˇˇ( )
$str
ˇˇ) O
,
ˇˇO P
e
ˇˇQ R
)
ˇˇR S
;
ˇˇS T
}
ÄÄ 
}
ÅÅ 	
public
ÇÇ 
IEnumerable
ÇÇ 
<
ÇÇ &
CostoUtilidadPorConcepto
ÇÇ 3
>
ÇÇ3 48
*ObtenerReporteDeUtilidadDeVentasPorFamilia
ÇÇ5 _
(
ÇÇ_ `
int
ÇÇ` c 
idTransaccionOrden
ÇÇd v
,
ÇÇv w
int
ÇÇx {&
idTransaccionMovimientoÇÇ| ì
,ÇÇì î
intÇÇï ò
idEstadoÇÇô °
,ÇÇ° ¢
intÇÇ£ ¶
[ÇÇ¶ ß
]ÇÇß ®!
idsCentroAtencionÇÇ© ∫
,ÇÇ∫ ª
DateTimeÇÇº ƒ

fechaDesdeÇÇ≈ œ
,ÇÇœ –
DateTimeÇÇ— Ÿ

fechaHastaÇÇ⁄ ‰
)ÇÇ‰ Â
{
ÉÉ 	
try
ÑÑ 
{
ÖÖ 
var
ÜÜ 
Resumen
ÜÜ 
=
ÜÜ 
_db
ÜÜ !
.
ÜÜ! "
Transaccion
ÜÜ" -
.
ÜÜ- .
Where
ÜÜ. 3
(
ÜÜ3 4
t
ÜÜ4 5
=>
ÜÜ6 8
t
ÜÜ9 :
.
ÜÜ: ;
fecha_inicio
ÜÜ; G
>=
ÜÜH J

fechaDesde
ÜÜK U
&&
ÜÜV X
t
ÜÜY Z
.
ÜÜZ [
fecha_inicio
ÜÜ[ g
<=
ÜÜh j

fechaHasta
ÜÜk u
&&
ÜÜv x
t
ÜÜy z
.
ÜÜz {"
id_tipo_transaccionÜÜ{ é
==ÜÜè ë"
idTransaccionOrdenÜÜí §
&&ÜÜ• ß
tÜÜ® ©
.ÜÜ© ™ 
id_estado_actualÜÜ™ ∫
==ÜÜª Ω
idEstadoÜÜæ ∆
&&ÜÜ« …!
idsCentroAtencionÜÜ  €
.ÜÜ€ ‹
ContainsÜÜ‹ ‰
(ÜÜ‰ Â
tÜÜÂ Ê
.ÜÜÊ Á(
id_actor_negocio_internoÜÜÁ ˇ
)ÜÜˇ Ä
)ÜÜÄ Å
.
áá 

SelectMany
áá 
(
áá  
t
áá  !
=>
áá" $
t
áá% &
.
áá& '!
Detalle_transaccion
áá' :
)
áá: ;
.
áá; <
Where
áá< A
(
ááA B
dt
ááB D
=>
ááE G
dt
ááH J
.
ááJ K
Concepto_negocio
ááK [
.
áá[ \
Detalle_maestro4
áá\ l
.
áál m
valor
áám r
.
áár s
Equals
áás y
(
ááy z
$str
ááz }
)
áá} ~
)
áá~ 
.
àà 
GroupBy
àà 
(
àà 
dt
àà 
=>
àà  "
new
àà# &
{
ââ 

idConcepto
ää "
=
ää# $
dt
ää% '
.
ää' (
Concepto_negocio
ää( 8
.
ää8 9
Detalle_maestro4
ää9 I
.
ääI J
id
ääJ L
,
ääL M
concepto
ãã  
=
ãã! "
dt
ãã# %
.
ãã% &
Concepto_negocio
ãã& 6
.
ãã6 7
Detalle_maestro4
ãã7 G
.
ããG H
nombre
ããH N
,
ããN O
}
åå 
)
åå 
.
åå 
Select
åå 
(
åå 
dt
åå  
=>
åå! #
new
åå$ '&
CostoUtilidadPorConcepto
åå( @
(
åå@ A
)
ååA B
{
çç 

IdConcepto
éé "
=
éé# $
dt
éé% '
.
éé' (
Key
éé( +
.
éé+ ,

idConcepto
éé, 6
,
éé6 7
Concepto
èè  
=
èè! "
dt
èè# %
.
èè% &
Key
èè& )
.
èè) *
concepto
èè* 2
,
èè2 3
Cantidad
êê  
=
êê! "
dt
êê# %
.
êê% &
Sum
êê& )
(
êê) *
i
êê* +
=>
êê, .
i
êê/ 0
.
êê0 1
cantidad
êê1 9
)
êê9 :
,
êê: ;
Importe
ëë 
=
ëë  !
dt
ëë" $
.
ëë$ %
Sum
ëë% (
(
ëë( )
i
ëë) *
=>
ëë+ -
i
ëë. /
.
ëë/ 0
total
ëë0 5
)
ëë5 6
,
ëë6 7
Costo
íí 
=
íí 
dt
íí  "
.
íí" #
Sum
íí# &
(
íí& '
i
íí' (
=>
íí) +
i
íí, -
.
íí- .
Transaccion
íí. 9
.
íí9 :
Transaccion11
íí: G
.
ííG H
Where
ííH M
(
ííM N
tt
ííN P
=>
ííQ S
tt
ííT V
.
ííV W!
id_tipo_transaccion
ííW j
==
íík m&
idTransaccionMovimientoíín Ö
&&ííÜ à
ttííâ ã
.ííã å 
id_estado_actualííå ú
==ííù ü
MaestroSettingsíí† Ø
.ííØ ∞
Defaultíí∞ ∑
.íí∑ ∏0
 IdDetalleMaestroEstadoConfirmadoíí∏ ÿ
)ííÿ Ÿ
.ííŸ ⁄

SelectManyíí⁄ ‰
(íí‰ Â
tdííÂ Á
=>ííË Í
tdííÎ Ì
.ííÌ Ó#
Detalle_transaccionííÓ Å
)ííÅ Ç
.ííÇ É
WhereííÉ à
(ííà â
dttííâ å
=>ííç è
dttííê ì
.ííì î 
Concepto_negocioííî §
.íí§ • 
Detalle_maestro4íí• µ
.ííµ ∂
idíí∂ ∏
==ííπ ª
dtííº æ
.ííæ ø
Keyííø ¬
.íí¬ √

idConceptoíí√ Õ
)ííÕ Œ
.ííŒ œ
Averageííœ ÷
(íí÷ ◊
ddíí◊ Ÿ
=>íí⁄ ‹
ddíí› ﬂ
.ííﬂ ‡
totalíí‡ Â
)ííÂ Ê
)ííÊ Á
}
ìì 
)
ìì 
;
ìì 
return
îî 
Resumen
îî 
;
îî 
}
ïï 
catch
ññ 
(
ññ 
	Exception
ññ 
e
ññ 
)
ññ 
{
óó 
throw
òò 
new
òò 
DatosException
òò (
(
òò( )
$str
òò) O
,
òòO P
e
òòQ R
)
òòR S
;
òòS T
}
ôô 
}
öö 	
public
úú 
IEnumerable
úú 
<
úú &
CostoUtilidadPorConcepto
úú 3
>
úú3 49
+ObtenerReporteDeUtilidadDeVentasPorConcepto
úú5 `
(
úú` a
int
úúa d 
idTransaccionOrden
úúe w
,
úúw x
int
úúy |&
idTransaccionMovimientoúú} î
,úúî ï
intúúñ ô
idEstadoúúö ¢
,úú¢ £
intúú§ ß
[úúß ®
]úú® ©!
idsConceptoBasicoúú™ ª
,úúª º
DateTimeúúΩ ≈

fechaDesdeúú∆ –
,úú– —
DateTimeúú“ ⁄

fechaHastaúú€ Â
)úúÂ Ê
{
ùù 	
try
ûû 
{
üü 
var
†† 
Resumen
†† 
=
†† 
_db
†† !
.
††! "
Transaccion
††" -
.
††- .
Where
††. 3
(
††3 4
t
††4 5
=>
††6 8
t
††9 :
.
††: ;
fecha_inicio
††; G
>=
††H J

fechaDesde
††K U
&&
††V X
t
††Y Z
.
††Z [
fecha_inicio
††[ g
<=
††h j

fechaHasta
††k u
&&
††v x
t
††y z
.
††z {"
id_tipo_transaccion††{ é
==††è ë"
idTransaccionOrden††í §
&&††• ß
t††® ©
.††© ™ 
id_estado_actual††™ ∫
==††ª Ω
idEstado††æ ∆
)††∆ «
.
°° 

SelectMany
°°  
(
°°  !
t
°°! "
=>
°°# %
t
°°& '
.
°°' (!
Detalle_transaccion
°°( ;
)
°°; <
.
°°< =
Where
°°= B
(
°°B C
dt
°°C E
=>
°°F H
dt
°°I K
.
°°K L
Concepto_negocio
°°L \
.
°°\ ]
Detalle_maestro4
°°] m
.
°°m n
valor
°°n s
.
°°s t
Equals
°°t z
(
°°z {
$str
°°{ ~
)
°°~ 
)°° Ä
.
¢¢ 
Where
¢¢ 
(
¢¢ 
dt
¢¢ 
=>
¢¢ !
idsConceptoBasico
¢¢" 3
.
¢¢3 4
Contains
¢¢4 <
(
¢¢< =
dt
¢¢= ?
.
¢¢? @
Concepto_negocio
¢¢@ P
.
¢¢P Q
Detalle_maestro4
¢¢Q a
.
¢¢a b
id
¢¢b d
)
¢¢d e
)
¢¢e f
.
££ 
GroupBy
££ 
(
££ 
dt
££  
=>
££! #
new
££$ '
{
§§ 

idConcepto
•• #
=
••$ %
dt
••& (
.
••( )!
id_concepto_negocio
••) <
,
••< =
concepto
¶¶ !
=
¶¶" #
dt
¶¶$ &
.
¶¶& '
Concepto_negocio
¶¶' 7
.
¶¶7 8
nombre
¶¶8 >
,
¶¶> ?
}
ßß 
)
ßß 
.
ßß 
Select
ßß 
(
ßß 
dt
ßß !
=>
ßß" $
new
ßß% (&
CostoUtilidadPorConcepto
ßß) A
(
ßßA B
)
ßßB C
{
®® 

IdConcepto
©© #
=
©©$ %
dt
©©& (
.
©©( )
Key
©©) ,
.
©©, -

idConcepto
©©- 7
,
©©7 8
Concepto
™™ !
=
™™" #
dt
™™$ &
.
™™& '
Key
™™' *
.
™™* +
concepto
™™+ 3
,
™™3 4
Cantidad
´´ !
=
´´" #
dt
´´$ &
.
´´& '
Sum
´´' *
(
´´* +
i
´´+ ,
=>
´´- /
i
´´0 1
.
´´1 2
cantidad
´´2 :
)
´´: ;
,
´´; <
Importe
¨¨  
=
¨¨! "
dt
¨¨# %
.
¨¨% &
Sum
¨¨& )
(
¨¨) *
i
¨¨* +
=>
¨¨, .
i
¨¨/ 0
.
¨¨0 1
total
¨¨1 6
)
¨¨6 7
,
¨¨7 8
Costo
≠≠ 
=
≠≠  
dt
≠≠! #
.
≠≠# $
Sum
≠≠$ '
(
≠≠' (
i
≠≠( )
=>
≠≠* ,
i
≠≠- .
.
≠≠. /
Transaccion
≠≠/ :
.
≠≠: ;
Transaccion11
≠≠; H
.
≠≠H I
Where
≠≠I N
(
≠≠N O
tt
≠≠O Q
=>
≠≠R T
tt
≠≠U W
.
≠≠W X!
id_tipo_transaccion
≠≠X k
==
≠≠l n&
idTransaccionMovimiento≠≠o Ü
&&≠≠á â
tt≠≠ä å
.≠≠å ç 
id_estado_actual≠≠ç ù
==≠≠û †
MaestroSettings≠≠° ∞
.≠≠∞ ±
Default≠≠± ∏
.≠≠∏ π0
 IdDetalleMaestroEstadoConfirmado≠≠π Ÿ
)≠≠Ÿ ⁄
.≠≠⁄ €

SelectMany≠≠€ Â
(≠≠Â Ê
td≠≠Ê Ë
=>≠≠È Î
td≠≠Ï Ó
.≠≠Ó Ô#
Detalle_transaccion≠≠Ô Ç
)≠≠Ç É
.≠≠É Ñ
Where≠≠Ñ â
(≠≠â ä
d≠≠ä ã
=>≠≠å é
d≠≠è ê
.≠≠ê ë#
id_concepto_negocio≠≠ë §
==≠≠• ß
dt≠≠® ™
.≠≠™ ´
Key≠≠´ Æ
.≠≠Æ Ø

idConcepto≠≠Ø π
)≠≠π ∫
.≠≠∫ ª
Sum≠≠ª æ
(≠≠æ ø
dd≠≠ø ¡
=>≠≠¬ ƒ
dd≠≠≈ «
.≠≠« »
total≠≠» Õ
)≠≠Õ Œ
)≠≠Œ œ
}
ÆÆ 
)
ÆÆ 
;
ÆÆ 
return
ØØ 
Resumen
ØØ 
;
ØØ 
}
∞∞ 
catch
±± 
(
±± 
	Exception
±± 
e
±± 
)
±± 
{
≤≤ 
throw
≥≥ 
new
≥≥ 
DatosException
≥≥ (
(
≥≥( )
$str
≥≥) O
,
≥≥O P
e
≥≥Q R
)
≥≥R S
;
≥≥S T
}
¥¥ 
}
µµ 	
public
∑∑ 
IEnumerable
∑∑ 
<
∑∑ &
CostoUtilidadPorConcepto
∑∑ 3
>
∑∑3 49
+ObtenerReporteDeUtilidadDeVentasPorConcepto
∑∑5 `
(
∑∑` a
int
∑∑a d 
idTransaccionOrden
∑∑e w
,
∑∑w x
int
∑∑y |&
idTransaccionMovimiento∑∑} î
,∑∑î ï
int∑∑ñ ô
idEstado∑∑ö ¢
,∑∑¢ £
int∑∑§ ß
[∑∑ß ®
]∑∑® ©!
idsCentroAtencion∑∑™ ª
,∑∑ª º
int∑∑Ω ¿
[∑∑¿ ¡
]∑∑¡ ¬!
idsConceptoBasico∑∑√ ‘
,∑∑‘ ’
DateTime∑∑÷ ﬁ

fechaDesde∑∑ﬂ È
,∑∑È Í
DateTime∑∑Î Û

fechaHasta∑∑Ù ˛
)∑∑˛ ˇ
{
∏∏ 	
try
ππ 
{
∫∫ 
var
ªª 
Resumen
ªª 
=
ªª 
_db
ªª !
.
ªª! "
Transaccion
ªª" -
.
ªª- .
Where
ªª. 3
(
ªª3 4
t
ªª4 5
=>
ªª6 8
t
ªª9 :
.
ªª: ;
fecha_inicio
ªª; G
>=
ªªH J

fechaDesde
ªªK U
&&
ªªV X
t
ªªY Z
.
ªªZ [
fecha_inicio
ªª[ g
<=
ªªh j

fechaHasta
ªªk u
&&
ªªv x
t
ªªy z
.
ªªz {"
id_tipo_transaccionªª{ é
==ªªè ë"
idTransaccionOrdenªªí §
&&ªª• ß!
idsCentroAtencionªª® π
.ªªπ ∫
Containsªª∫ ¬
(ªª¬ √
tªª√ ƒ
.ªªƒ ≈(
id_actor_negocio_internoªª≈ ›
)ªª› ﬁ
&&ªªﬂ ·
tªª‚ „
.ªª„ ‰ 
id_estado_actualªª‰ Ù
==ªªı ˜
idEstadoªª¯ Ä
)ªªÄ Å
.
ºº 

SelectMany
ºº  
(
ºº  !
t
ºº! "
=>
ºº# %
t
ºº& '
.
ºº' (!
Detalle_transaccion
ºº( ;
)
ºº; <
.
ºº< =
Where
ºº= B
(
ººB C
dt
ººC E
=>
ººF H
dt
ººI K
.
ººK L
Concepto_negocio
ººL \
.
ºº\ ]
Detalle_maestro4
ºº] m
.
ººm n
valor
ººn s
.
ººs t
Equals
ººt z
(
ººz {
$str
ºº{ ~
)
ºº~ 
)ºº Ä
.
ΩΩ 
Where
ΩΩ 
(
ΩΩ 
dt
ΩΩ 
=>
ΩΩ !
idsConceptoBasico
ΩΩ" 3
.
ΩΩ3 4
Contains
ΩΩ4 <
(
ΩΩ< =
dt
ΩΩ= ?
.
ΩΩ? @
Concepto_negocio
ΩΩ@ P
.
ΩΩP Q
Detalle_maestro4
ΩΩQ a
.
ΩΩa b
id
ΩΩb d
)
ΩΩd e
)
ΩΩe f
.
ææ 
GroupBy
ææ 
(
ææ 
dt
ææ  
=>
ææ! #
new
ææ$ '
{
øø 

idConcepto
¿¿ #
=
¿¿$ %
dt
¿¿& (
.
¿¿( )!
id_concepto_negocio
¿¿) <
,
¿¿< =
concepto
¡¡ !
=
¡¡" #
dt
¡¡$ &
.
¡¡& '
Concepto_negocio
¡¡' 7
.
¡¡7 8
nombre
¡¡8 >
,
¡¡> ?
}
¬¬ 
)
¬¬ 
.
¬¬ 
Select
¬¬ 
(
¬¬ 
dt
¬¬ !
=>
¬¬" $
new
¬¬% (&
CostoUtilidadPorConcepto
¬¬) A
(
¬¬A B
)
¬¬B C
{
√√ 

IdConcepto
ƒƒ #
=
ƒƒ$ %
dt
ƒƒ& (
.
ƒƒ( )
Key
ƒƒ) ,
.
ƒƒ, -

idConcepto
ƒƒ- 7
,
ƒƒ7 8
Concepto
≈≈ !
=
≈≈" #
dt
≈≈$ &
.
≈≈& '
Key
≈≈' *
.
≈≈* +
concepto
≈≈+ 3
,
≈≈3 4
Cantidad
∆∆ !
=
∆∆" #
dt
∆∆$ &
.
∆∆& '
Sum
∆∆' *
(
∆∆* +
i
∆∆+ ,
=>
∆∆- /
i
∆∆0 1
.
∆∆1 2
cantidad
∆∆2 :
)
∆∆: ;
,
∆∆; <
Importe
««  
=
««! "
dt
««# %
.
««% &
Sum
««& )
(
««) *
i
««* +
=>
««, .
i
««/ 0
.
««0 1
total
««1 6
)
««6 7
,
««7 8
Costo
»» 
=
»»  
dt
»»! #
.
»»# $
Sum
»»$ '
(
»»' (
i
»»( )
=>
»»* ,
i
»»- .
.
»». /
Transaccion
»»/ :
.
»»: ;
Transaccion11
»»; H
.
»»H I
Where
»»I N
(
»»N O
tt
»»O Q
=>
»»R T
tt
»»U W
.
»»W X!
id_tipo_transaccion
»»X k
==
»»l n&
idTransaccionMovimiento»»o Ü
&&»»á â
tt»»ä å
.»»å ç 
id_estado_actual»»ç ù
==»»û †
MaestroSettings»»° ∞
.»»∞ ±
Default»»± ∏
.»»∏ π0
 IdDetalleMaestroEstadoConfirmado»»π Ÿ
)»»Ÿ ⁄
.»»⁄ €

SelectMany»»€ Â
(»»Â Ê
td»»Ê Ë
=>»»È Î
td»»Ï Ó
.»»Ó Ô#
Detalle_transaccion»»Ô Ç
)»»Ç É
.»»É Ñ
Where»»Ñ â
(»»â ä
d»»ä ã
=>»»å é!
idsConceptoBasico»»è †
.»»† °
Contains»»° ©
(»»© ™
d»»™ ´
.»»´ ¨ 
Concepto_negocio»»¨ º
.»»º Ω 
Detalle_maestro4»»Ω Õ
.»»Õ Œ
id»»Œ –
)»»– —
)»»— “
.»»“ ”
Sum»»” ÷
(»»÷ ◊
dd»»◊ Ÿ
=>»»⁄ ‹
dd»»› ﬂ
.»»ﬂ ‡
total»»‡ Â
)»»Â Ê
)»»Ê Á
}
…… 
)
…… 
;
…… 
return
   
Resumen
   
;
   
}
ÀÀ 
catch
ÃÃ 
(
ÃÃ 
	Exception
ÃÃ 
e
ÃÃ 
)
ÃÃ 
{
ÕÕ 
throw
ŒŒ 
new
ŒŒ 
DatosException
ŒŒ (
(
ŒŒ( )
$str
ŒŒ) O
,
ŒŒO P
e
ŒŒQ R
)
ŒŒR S
;
ŒŒS T
}
œœ 
}
–– 	
public
”” 
IEnumerable
”” 
<
”” ,
ItemConGrupoOperacionComercial
”” 9
>
””9 :3
%ObtenerItemOperacionPorCaracteristica
””; `
(
””` a
int
””a d
idTipoTransaccion
””e v
,
””v w
int
””x {
idEstadoActual””| ä
,””ä ã
DateTime””å î

fechaDesde””ï ü
,””ü †
DateTime””° ©

fechaHasta””™ ¥
,””¥ µ
int””∂ π
[””π ∫
]””∫ ª&
idsActorNegocioInterno””º “
,””“ ”
int””‘ ◊ 
idCaracteristica””ÿ Ë
)””Ë È
{
‘‘ 	
List
’’ 
<
’’ ,
ItemConGrupoOperacionComercial
’’ /
>
’’/ 0
Items
’’1 6
;
’’6 7
try
÷÷ 
{
◊◊ 
Items
ÿÿ 
=
ÿÿ 
_db
ÿÿ 
.
ÿÿ 
Transaccion
ÿÿ '
.
ŸŸ 
Where
ŸŸ 
(
ŸŸ 
t
ŸŸ 
=>
ŸŸ 
t
ŸŸ  !
.
ŸŸ! "
fecha_inicio
ŸŸ" .
>=
ŸŸ/ 1

fechaDesde
ŸŸ2 <
&&
ŸŸ= ?
t
ŸŸ@ A
.
ŸŸA B
fecha_inicio
ŸŸB N
<=
ŸŸO Q

fechaHasta
ŸŸR \
&&
⁄⁄ 
t
⁄⁄ 
.
⁄⁄ !
id_tipo_transaccion
⁄⁄ ,
==
⁄⁄- /
idTipoTransaccion
⁄⁄0 A
&&
€€ $
idsActorNegocioInterno
€€ -
.
€€- .
Contains
€€. 6
(
€€6 7
t
€€7 8
.
€€8 9&
id_actor_negocio_interno
€€9 Q
)
€€Q R
&&
‹‹ 
t
‹‹ 
.
‹‹ 
id_estado_actual
‹‹ )
==
‹‹* ,
idEstadoActual
‹‹- ;
)
›› 
.
ﬁﬁ 

SelectMany
ﬁﬁ 
(
ﬁﬁ 
t
ﬁﬁ 
=>
ﬁﬁ  
t
ﬁﬁ! "
.
ﬁﬁ" #!
Detalle_transaccion
ﬁﬁ# 6
)
ﬁﬁ6 7
.
ﬁﬁ7 8
GroupBy
ﬂﬂ 
(
ﬂﬂ 
dt
ﬂﬂ 
=>
ﬂﬂ 
new
ﬂﬂ 
{
‡‡ 

IdConcepto
·· 
=
·· 
dt
·· !
.
··! "
Concepto_negocio
··" 2
.
··2 3
id
··3 5
,
··5 6

NombreItem
‚‚ 
=
‚‚ 
dt
‚‚ !
.
‚‚! "
Concepto_negocio
‚‚" 2
.
‚‚2 3
nombre
‚‚3 9
}
ÊÊ 
)
ÊÊ 
.
ÊÊ 
Select
ÊÊ 
(
ÊÊ 
dt
ÊÊ 
=>
ÊÊ 
new
ÊÊ !,
ItemConGrupoOperacionComercial
ÊÊ" @
(
ÊÊ@ A
)
ÊÊA B
{
ÁÁ 
IdItem
ËË 
=
ËË 
dt
ËË 
.
ËË 
Key
ËË !
.
ËË! "

IdConcepto
ËË" ,
,
ËË, -

NombreItem
ÈÈ 
=
ÈÈ 
dt
ÈÈ !
.
ÈÈ! "
Key
ÈÈ" %
.
ÈÈ% &

NombreItem
ÈÈ& 0
,
ÍÍ 
Cantidad
ÌÌ 
=
ÌÌ 
dt
ÌÌ 
.
ÌÌ  
Sum
ÌÌ  #
(
ÌÌ# $
a
ÌÌ$ %
=>
ÌÌ& (
a
ÌÌ) *
.
ÌÌ* +
cantidad
ÌÌ+ 3
)
ÌÌ3 4
,
ÌÌ4 5
Importe
ÓÓ 
=
ÓÓ 
dt
ÓÓ 
.
ÓÓ 
Sum
ÓÓ "
(
ÓÓ" #
a
ÓÓ# $
=>
ÓÓ% '
a
ÓÓ( )
.
ÓÓ) *
total
ÓÓ* /
)
ÓÓ/ 0
}
 
)
 
.
 
ToList
 
(
 
)
 
;
 
var
ÚÚ !
idsConceptosNegocio
ÚÚ '
=
ÚÚ( )
Items
ÚÚ* /
.
ÚÚ/ 0
Select
ÚÚ0 6
(
ÚÚ6 7
i
ÚÚ7 8
=>
ÚÚ9 ;
i
ÚÚ< =
.
ÚÚ= >
IdItem
ÚÚ> D
)
ÚÚD E
.
ÚÚE F
ToArray
ÚÚF M
(
ÚÚM N
)
ÚÚN O
;
ÚÚO P
var
ÙÙ 
marcas
ÙÙ 
=
ÙÙ 
_db
ÙÙ  
.
ÙÙ  !
Concepto_negocio
ÙÙ! 1
.
ÙÙ1 2
Where
ÙÙ2 7
(
ÙÙ7 8
cn
ÙÙ8 :
=>
ÙÙ; =!
idsConceptosNegocio
ÙÙ> Q
.
ÙÙQ R
Contains
ÙÙR Z
(
ÙÙZ [
cn
ÙÙ[ ]
.
ÙÙ] ^
id
ÙÙ^ `
)
ÙÙ` a
)
ÙÙa b
.
ÙÙb c

SelectMany
ÙÙc m
(
ÙÙm n
cn
ÙÙn p
=>
ÙÙq s
cn
ÙÙt v
.
ÙÙv w4
%Valor_caracteristica_concepto_negocioÙÙw ú
)ÙÙú ù
.ÙÙù û
WhereÙÙû £
(ÙÙ£ §
vccnÙÙ§ ®
=>ÙÙ© ´
vccnÙÙ¨ ∞
.ÙÙ∞ ±$
Valor_caracteristicaÙÙ± ≈
.ÙÙ≈ ∆!
id_caracteristicaÙÙ∆ ◊
==ÙÙÿ ⁄ 
idCaracteristicaÙÙ€ Î
)ÙÙÎ Ï
.ÙÙÏ Ì
SelectÙÙÌ Û
(ÙÙÛ Ù
vccnÙÙÙ ¯
=>ÙÙ¯ ˙
newÙÙ˚ ˛.
ItemConGrupoOperacionComercialÙÙˇ ù
(ÙÙù û
)ÙÙû ü
{ÙÙ† °
IdItemÙÙ° ß
=ÙÙß ®
vccnÙÙ© ≠
.ÙÙ≠ Æ#
id_concepto_negocioÙÙÆ ¡
,ÙÙ¡ ¬
IdGrupoÙÙ√  
=ÙÙ  À
vccnÙÙÃ –
.ÙÙ– —$
Valor_caracteristicaÙÙ— Â
.ÙÙÂ Ê
idÙÙÊ Ë
,ÙÙË È
NombreGrupoÙÙÍ ı
=ÙÙı ˆ
vccnÙÙ˜ ˚
.ÙÙ˚ ¸$
Valor_caracteristicaÙÙ¸ ê
.ÙÙê ë
valorÙÙë ñ
}ÙÙó ò
)ÙÙò ô
.ÙÙô ö
ToListÙÙö †
(ÙÙ† °
)ÙÙ° ¢
;ÙÙ¢ £
Items
ˆˆ 
.
ˆˆ 
ForEach
ˆˆ 
(
ˆˆ 
i
ˆˆ 
=>
ˆˆ  "
{
˜˜ 
i
¯¯ 
.
¯¯ 
IdGrupo
¯¯ 
=
¯¯ 
marcas
¯¯  &
.
¯¯& '
Any
¯¯' *
(
¯¯* +
m
¯¯+ ,
=>
¯¯- /
m
¯¯0 1
.
¯¯1 2
IdItem
¯¯2 8
==
¯¯9 ;
i
¯¯< =
.
¯¯= >
IdItem
¯¯> D
)
¯¯D E
?
¯¯E F
marcas
¯¯G M
.
¯¯M N
Single
¯¯N T
(
¯¯T U
m
¯¯U V
=>
¯¯W Y
m
¯¯Z [
.
¯¯[ \
IdItem
¯¯\ b
==
¯¯c e
i
¯¯f g
.
¯¯g h
IdItem
¯¯h n
)
¯¯n o
.
¯¯o p
IdGrupo
¯¯p w
:
¯¯w x
$num
¯¯x y
;
¯¯y z
i
˘˘ 
.
˘˘ 
NombreGrupo
˘˘ !
=
˘˘" #
marcas
˘˘$ *
.
˘˘* +
Any
˘˘+ .
(
˘˘. /
m
˘˘/ 0
=>
˘˘1 3
m
˘˘4 5
.
˘˘5 6
IdItem
˘˘6 <
==
˘˘= ?
i
˘˘@ A
.
˘˘A B
IdItem
˘˘B H
)
˘˘H I
?
˘˘J K
marcas
˘˘L R
.
˘˘R S
Single
˘˘S Y
(
˘˘Y Z
m
˘˘Z [
=>
˘˘\ ^
m
˘˘_ `
.
˘˘` a
IdItem
˘˘a g
==
˘˘h j
i
˘˘k l
.
˘˘l m
IdItem
˘˘m s
)
˘˘s t
.
˘˘t u
NombreGrupo˘˘u Ä
:˘˘Ä Å
$str˘˘Å Ö
;˘˘Ö Ü
}
˙˙ 
)
˙˙ 
;
˙˙ 
return
˝˝ 
Items
˝˝ 
;
˝˝ 
}
˛˛ 
catch
ˇˇ 
(
ˇˇ 
	Exception
ˇˇ 
e
ˇˇ 
)
ˇˇ 
{
ÄÄ 
throw
ÅÅ 
new
ÅÅ 
DatosException
ÅÅ (
(
ÅÅ( )
$str
ÅÅ) K
,
ÅÅK L
e
ÅÅL M
)
ÅÅM N
;
ÅÅN O
}
ÇÇ 
}
ÉÉ 	
public
ÖÖ 
IEnumerable
ÖÖ 
<
ÖÖ -
ItemDetalladoOperacionComercial
ÖÖ :
>
ÖÖ: ;6
(ObtenerItemsDetalladoDeVentaConMedioPago
ÖÖ< d
(
ÖÖd e
int
ÖÖe h
idTipoTransaccion
ÖÖi z
,
ÖÖz {
int
ÖÖ| 
idEstadoActualÖÖÄ é
,ÖÖé è
DateTimeÖÖê ò

fechaDesdeÖÖô £
,ÖÖ£ §
DateTimeÖÖ• ≠

fechaHastaÖÖÆ ∏
,ÖÖ∏ π
intÖÖ∫ Ω
[ÖÖΩ æ
]ÖÖæ ø"
idsCaracteristicasÖÖ¿ “
,ÖÖ“ ”
intÖÖ‘ ◊
idPuntoVentaÖÖÿ ‰
)ÖÖ‰ Â
{
ÜÜ 	
List
áá 
<
áá -
ItemDetalladoOperacionComercial
áá 0
>
áá0 1
Items
áá2 7
;
áá7 8
try
àà 
{
ââ 
Items
ää 
=
ää 
_db
ää 
.
ää 
Transaccion
ää '
.
ãã 
Where
ãã 
(
ãã 
t
ãã 
=>
ãã 
t
ãã  !
.
ãã! "
fecha_inicio
ãã" .
>=
ãã/ 1

fechaDesde
ãã2 <
&&
ãã= ?
t
ãã@ A
.
ããA B
fecha_inicio
ããB N
<=
ããO Q

fechaHasta
ããR \
&&
åå 
t
åå 
.
åå !
id_tipo_transaccion
åå ,
==
åå- /
idTipoTransaccion
åå0 A
&&
çç 
t
çç 
.
çç &
id_actor_negocio_interno
çç 1
==
çç1 3
idPuntoVenta
çç4 @
&&
éé 
t
éé 
.
éé 
id_estado_actual
éé )
==
éé* ,
idEstadoActual
éé- ;
)
èè 
.
êê 

SelectMany
êê 
(
êê 
t
êê 
=>
êê  
t
êê! "
.
êê" #!
Detalle_transaccion
êê# 6
)
êê6 7
.
ëë 
Select
ëë 
(
ëë 
dt
ëë 
=>
ëë 
new
ëë -
ItemDetalladoOperacionComercial
ëë  ?
(
ëë? @
)
ëë@ A
{
íí 
IdItem
ìì 
=
ìì 
dt
ìì 
.
ìì !
id_concepto_negocio
ìì 1
,
ìì1 2
IdOperacion
îî 
=
îî 
dt
îî !
.
îî! "
id_transaccion
îî" 0
,
îî0 1 
IdOperacionWrapper
ïï $
=
ïï% &
dt
ïï' )
.
ïï) *
Transaccion
ïï* 5
.
ïï5 6"
id_transaccion_padre
ïï6 J
,
ïïJ K
Fecha
ññ 
=
ññ 
dt
ññ 
.
ññ 
Transaccion
ññ (
.
ññ( )
fecha_inicio
ññ) 5
,
ññ5 6
Comprobante
óó 
=
óó 
dt
óó !
.
óó! "
Transaccion
óó" -
.
óó- .
Comprobante
óó. 9
.
óó9 :
numero_serie
óó: F
+
óóG H
$str
óóI L
+
óóL M
dt
óóM O
.
óóO P
Transaccion
óóP [
.
óó[ \
Comprobante
óó\ g
.
óóg h
numero
óóh n
,
óón o
Familia
òò 
=
òò 
dt
òò 
.
òò 
Concepto_negocio
òò .
.
òò. /
Detalle_maestro4
òò/ ?
.
òò? @
nombre
òò@ F
,
òòF G
Sufijo
ôô 
=
ôô 
dt
ôô 
.
ôô 
Concepto_negocio
ôô -
.
ôô- .
sufijo
ôô. 4
,
ôô4 5
Cantidad
öö 
=
öö 
dt
öö 
.
öö 
cantidad
öö &
,
öö& '
Importe
õõ 
=
õõ 
dt
õõ 
.
õõ 
total
õõ $
}
úú 
)
úú 
.
úú 
ToList
úú 
(
úú 
)
úú 
;
úú 
var
ùù !
idsConceptosNegocio
ùù '
=
ùù( )
Items
ùù* /
.
ùù/ 0
Select
ùù0 6
(
ùù6 7
i
ùù7 8
=>
ùù9 ;
i
ùù< =
.
ùù= >
IdItem
ùù> D
)
ùùD E
.
ùùE F
ToArray
ùùF M
(
ùùM N
)
ùùN O
;
ùùO P
var
ûû 
caracteristicas
ûû #
=
ûû$ %
_db
ûû& )
.
ûû) *
Concepto_negocio
ûû* :
.
ûû: ;
Where
ûû; @
(
ûû@ A
cn
ûûA C
=>
ûûD F!
idsConceptosNegocio
ûûG Z
.
ûûZ [
Contains
ûû[ c
(
ûûc d
cn
ûûd f
.
ûûf g
id
ûûg i
)
ûûi j
)
ûûj k
.
ûûk l

SelectMany
ûûl v
(
ûûv w
cn
ûûw y
=>
ûûz |
cn
ûû} 
.ûû Ä5
%Valor_caracteristica_concepto_negocioûûÄ •
)ûû• ¶
.ûû¶ ß
Whereûûß ¨
(ûû¨ ≠
vccnûû≠ ±
=>ûû≤ ¥"
idsCaracteristicasûûµ «
.ûû« »
Containsûû» –
(ûû– —
vccnûû— ’
.ûû’ ÷$
Valor_caracteristicaûû÷ Í
.ûûÍ Î!
id_caracteristicaûûÎ ¸
)ûû¸ ˝
)ûû˝ ˛
.ûû˛ ˇ
Selectûûˇ Ö
(ûûÖ Ü
vccnûûÜ ä
=>ûûã ç
newûûé ë.
ItemConGrupoOperacionComercialûûí ∞
(ûû∞ ±
)ûû± ≤
{ûû≥ ¥
IdItemûûµ ª
=ûûº Ω
vccnûûæ ¬
.ûû¬ √#
id_concepto_negocioûû√ ÷
,ûû÷ ◊
IdGrupoûûÿ ﬂ
=ûû‡ ·
vccnûû‚ Ê
.ûûÊ Á$
Valor_caracteristicaûûÁ ˚
.ûû˚ ¸!
id_caracteristicaûû¸ ç
,ûûç é
NombreGrupoûûè ö
=ûûõ ú
vccnûûù °
.ûû° ¢$
Valor_caracteristicaûû¢ ∂
.ûû∂ ∑
valorûû∑ º
}ûûΩ æ
)ûûæ ø
.ûûø ¿
ToListûû¿ ∆
(ûû∆ «
)ûû« »
;ûû» …
var
†† &
idsTransaccionesWrappers
†† ,
=
††- .
Items
††/ 4
.
††4 5
Select
††5 ;
(
††; <
i
††< =
=>
††> @
i
††A B
.
††B C 
IdOperacionWrapper
††C U
)
††U V
.
††V W
Distinct
††W _
(
††_ `
)
††` a
.
††a b
ToArray
††b i
(
††i j
)
††j k
;
††k l
var
°° 
mediosPagoItems
°° #
=
°°$ %
_db
°°& )
.
°°) *
Transaccion
°°* 5
.
°°5 6
Where
°°6 ;
(
°°; <
t
°°< =
=>
°°> @&
idsTransaccionesWrappers
°°A Y
.
°°Y Z
Contains
°°Z b
(
°°b c
t
°°c d
.
°°d e"
id_transaccion_padre
°°e y
)
°°y z
&&
°°{ }
t
°°~ 
.°° Ä#
id_tipo_transaccion°°Ä ì
==°°î ñ#
TransaccionSettings°°ó ™
.°°™ ´
Default°°´ ≤
.°°≤ ≥9
)IdTipoTransaccionCobranzaFacturasClientes°°≥ ‹
)°°‹ ›
.°°› ﬁ
Select°°ﬁ ‰
(°°‰ Â
t°°Â Ê
=>°°Á È
new°°Í Ì.
ItemConGrupoOperacionComercial°°Ó å
(°°å ç
)°°ç é
{°°è ê
IdItem°°ê ñ
=°°ñ ó
t°°ó ò
.°°ò ô$
id_transaccion_padre°°ô ≠
,°°≠ Æ
IdGrupo°°∞ ∑
=°°∑ ∏
t°°π ∫
.°°∫ ª

Traza_pago°°ª ≈
.°°≈ ∆
FirstOrDefault°°∆ ‘
(°°‘ ’
)°°’ ÷
.°°÷ ◊
id_medio_pago°°◊ ‰
}°°‰ Â
)°°Â Ê
.°°Ê Á
ToList°°Á Ì
(°°Ì Ó
)°°Ó Ô
;°°Ô 
var
¢¢ 
idsMediosPagos
¢¢ "
=
¢¢# $
mediosPagoItems
¢¢% 4
.
¢¢4 5
Select
¢¢5 ;
(
¢¢; <
mp
¢¢< >
=>
¢¢? A
mp
¢¢B D
.
¢¢D E
IdGrupo
¢¢E L
)
¢¢L M
.
¢¢M N
Distinct
¢¢N V
(
¢¢V W
)
¢¢W X
.
¢¢X Y
ToArray
¢¢Y `
(
¢¢` a
)
¢¢a b
;
¢¢b c
var
££ &
mediosPagoDetalleMaestro
££ ,
=
££- .
_db
££/ 2
.
££2 3
Detalle_maestro
££3 B
.
££B C
Where
££C H
(
££H I
dm
££I K
=>
££L N
dm
££O Q
.
££Q R

id_maestro
££R \
==
££] _
MaestroSettings
££` o
.
££o p
Default
££p w
.
££w x#
IdMaestroMedioDePago££x å
)££å ç
.££ç é
ToList££é î
(££î ï
)££ï ñ
;££ñ ó
mediosPagoItems
§§ 
.
§§  
ForEach
§§  '
(
§§' (
mp
§§( *
=>
§§+ -
mp
§§. 0
.
§§0 1
NombreGrupo
§§1 <
=
§§= >&
mediosPagoDetalleMaestro
§§? W
.
§§W X
Single
§§X ^
(
§§^ _
mp_
§§_ b
=>
§§c e
mp_
§§f i
.
§§i j
id
§§j l
==
§§m o
mp
§§p r
.
§§r s
IdGrupo
§§s z
)
§§z {
.
§§{ |
nombre§§| Ç
)§§Ç É
;§§É Ñ
Items
¶¶ 
.
¶¶ 
ForEach
¶¶ 
(
¶¶ 
item
¶¶ "
=>
¶¶" $
{
¶¶% &
for
ßß 
(
ßß 
int
ßß 
i
ßß 
=
ßß  
$num
ßß! "
;
ßß" #
i
ßß$ %
<
ßß& ' 
idsCaracteristicas
ßß( :
.
ßß: ;
Count
ßß; @
(
ßß@ A
)
ßßA B
;
ßßB C
i
ßßD E
++
ßßE G
)
ßßG H
{
®® 
Type
©© 
type
©© !
=
©©" #
item
©©$ (
.
©©( )
GetType
©©) 0
(
©©0 1
)
©©1 2
;
©©2 3
System
™™ 
.
™™ 

Reflection
™™ )
.
™™) *
PropertyInfo
™™* 6
propertyInfo
™™7 C
=
™™D E
type
™™F J
.
™™J K
GetProperty
™™K V
(
™™V W
$str
™™W g
+
™™h i
(
™™j k
i
™™k l
+
™™l m
$num
™™m n
)
™™n o
)
™™o p
;
™™p q
propertyInfo
´´ $
.
´´$ %
SetValue
´´% -
(
´´- .
item
´´. 2
,
´´2 3
caracteristicas
¨¨ '
.
¨¨' (
Any
¨¨( +
(
¨¨+ ,
m
¨¨, -
=>
¨¨. 0
m
¨¨1 2
.
¨¨2 3
IdItem
¨¨3 9
==
¨¨: <
item
¨¨= A
.
¨¨A B
IdItem
¨¨B H
&&
≠≠ 
m
≠≠ 
.
≠≠ 
IdGrupo
≠≠ $
==
≠≠% ' 
idsCaracteristicas
≠≠( :
[
≠≠: ;
i
≠≠; <
]
≠≠< =
)
≠≠= >
?
≠≠? @
caracteristicas
≠≠A P
.
≠≠P Q
Single
≠≠Q W
(
≠≠W X
m
≠≠X Y
=>
≠≠Z \
m
≠≠] ^
.
≠≠^ _
IdItem
≠≠_ e
==
≠≠f h
item
≠≠i m
.
≠≠m n
IdItem
≠≠n t
&&
≠≠u w
m
≠≠x y
.
≠≠y z
IdGrupo≠≠z Å
==≠≠Ç Ñ"
idsCaracteristicas≠≠Ö ó
[≠≠ó ò
i≠≠ò ô
]≠≠ô ö
)≠≠ö õ
.≠≠õ ú
NombreGrupo≠≠ú ß
:≠≠® ©
$str≠≠™ ¨
)≠≠¨ ≠
;≠≠≠ Æ
}
ÆÆ 
item
ØØ 
.
ØØ 
	MedioPago
ØØ "
=
ØØ# $
mediosPagoItems
ØØ% 4
.
ØØ4 5
Any
ØØ5 8
(
ØØ8 9
mpi
ØØ9 <
=>
ØØ= ?
mpi
ØØ@ C
.
ØØC D
IdItem
ØØD J
==
ØØK M
item
ØØN R
.
ØØR S 
IdOperacionWrapper
ØØS e
)
ØØe f
?
ØØf g
mediosPagoItems
ØØg v
.
ØØv w
First
ØØw |
(
ØØ| }
mpiØØ} Ä
=>ØØÅ É
mpiØØÑ á
.ØØá à
IdItemØØà é
==ØØè ë
itemØØí ñ
.ØØñ ó"
IdOperacionWrapperØØó ©
)ØØ© ™
.ØØ™ ´
NombreGrupoØØ´ ∂
:ØØ∂ ∑
$strØØ∑ ¿
;ØØ¿ ¡
}
∞∞ 
)
∞∞ 
;
∞∞ 
return
≤≤ 
Items
≤≤ 
;
≤≤ 
}
≥≥ 
catch
¥¥ 
(
¥¥ 
	Exception
¥¥ 
e
¥¥ 
)
¥¥ 
{
µµ 
throw
∂∂ 
new
∂∂ 
DatosException
∂∂ (
(
∂∂( )
$str
∂∂) K
,
∂∂K L
e
∂∂M N
)
∂∂N O
;
∂∂O P
}
∑∑ 
}
∏∏ 	
public
∫∫ 
IEnumerable
∫∫ 
<
∫∫ "
VentaConceptoCliente
∫∫ /
>
∫∫/ 06
(ObtenerItemVentaPorFamiliaCaracteristica
∫∫1 Y
(
∫∫Y Z
int
∫∫Z ]
idTipoTransaccion
∫∫^ o
,
∫∫o p
int
∫∫q t
idEstadoActual∫∫u É
,∫∫É Ñ
DateTime∫∫Ö ç

fechaDesde∫∫é ò
,∫∫ò ô
DateTime∫∫ö ¢

fechaHasta∫∫£ ≠
,∫∫≠ Æ
int∫∫Ø ≤
[∫∫≤ ≥
]∫∫≥ ¥&
idsActorNegocioInterno∫∫µ À
,∫∫À Ã
int∫∫Õ –
	idFamilia∫∫— ⁄
,∫∫⁄ €
int∫∫‹ ﬂ 
idCaracteristica∫∫‡ 
,∫∫ Ò
int∫∫Ú ı%
idValorCaracteristica∫∫ˆ ã
)∫∫ã å
{
ªª 	
try
ºº 
{
ΩΩ 
var
ææ 
Items
ææ 
=
ææ 
_db
ææ 
.
ææ  
Transaccion
ææ  +
.
øø 
Where
øø 
(
øø 
t
øø 
=>
øø 
t
øø  !
.
øø! "
fecha_inicio
øø" .
>=
øø/ 1

fechaDesde
øø2 <
&&
øø= ?
t
øø@ A
.
øøA B
fecha_inicio
øøB N
<=
øøO Q

fechaHasta
øøR \
&&
¿¿ 
t
¿¿ 
.
¿¿ !
id_tipo_transaccion
¿¿ ,
==
¿¿- /
idTipoTransaccion
¿¿0 A
&&
¡¡ $
idsActorNegocioInterno
¡¡ -
.
¡¡- .
Contains
¡¡. 6
(
¡¡6 7
t
¡¡7 8
.
¡¡8 9&
id_actor_negocio_interno
¡¡9 Q
)
¡¡Q R
&&
¬¬ 
t
¬¬ 
.
¬¬ 
id_estado_actual
¬¬ )
==
¬¬* ,
idEstadoActual
¬¬- ;
)
√√ 
.
ƒƒ 

SelectMany
ƒƒ 
(
ƒƒ 
t
ƒƒ 
=>
ƒƒ  
t
ƒƒ! "
.
ƒƒ" #!
Detalle_transaccion
ƒƒ# 6
)
ƒƒ6 7
.
ƒƒ7 8
Where
≈≈ 
(
≈≈ 
dt
≈≈ 
=>
≈≈ 
dt
≈≈ 
.
≈≈ 
Concepto_negocio
≈≈ /
.
≈≈/ 0
Detalle_maestro4
≈≈0 @
.
≈≈@ A
id
≈≈A C
==
≈≈D F
	idFamilia
≈≈G P
&&
∆∆ 
dt
∆∆ 
.
∆∆ 
Concepto_negocio
∆∆ &
.
∆∆& '3
%Valor_caracteristica_concepto_negocio
∆∆' L
.
∆∆L M
Any
∆∆M P
(
∆∆P Q
vccn
∆∆Q U
=>
∆∆V X
vccn
∆∆Y ]
.
∆∆] ^"
Valor_caracteristica
∆∆^ r
.
∆∆r s 
id_caracteristica∆∆s Ñ
==∆∆Ö á 
idCaracteristica∆∆à ò
)∆∆ò ô
&&
«« 
dt
«« 
.
«« 
Concepto_negocio
«« &
.
««& '3
%Valor_caracteristica_concepto_negocio
««' L
.
««L M
Any
««M P
(
««P Q
vccn
««Q U
=>
««V X
vccn
««Y ]
.
««] ^%
id_valor_caracteristica
««^ u
==
««v x$
idValorCaracteristica««y é
)««é è
)««è ê
.
»» 
Select
»» 
(
»» 
dt
»» 
=>
»» 
new
»» !"
VentaConceptoCliente
»»" 6
(
»»6 7
)
»»7 8
{
……  
DocumentoIdentidad
   &
=
  ' (
dt
  ) +
.
  + ,
Transaccion
  , 7
.
  7 8
Actor_negocio1
  8 F
.
  F G
Actor
  G L
.
  L M(
numero_documento_identidad
  M g
,
  g h
RazonSocial
ÀÀ 
=
ÀÀ  !
dt
ÀÀ" $
.
ÀÀ$ %
Transaccion
ÀÀ% 0
.
ÀÀ0 1
Actor_negocio1
ÀÀ1 ?
.
ÀÀ? @
Actor
ÀÀ@ E
.
ÀÀE F
primer_nombre
ÀÀF S
.
ÀÀS T
Replace
ÀÀT [
(
ÀÀ[ \
$str
ÀÀ\ _
,
ÀÀ_ `
$str
ÀÀa d
)
ÀÀd e
,
ÀÀe f
	Direccion
ÃÃ 
=
ÃÃ 
dt
ÃÃ  "
.
ÃÃ" #
Transaccion
ÃÃ# .
.
ÃÃ. /
Actor_negocio1
ÃÃ/ =
.
ÃÃ= >
Actor
ÃÃ> C
.
ÃÃC D
	Direccion
ÃÃD M
.
ÃÃM N
FirstOrDefault
ÃÃN \
(
ÃÃ\ ]
)
ÃÃ] ^
.
ÃÃ^ _
detalle
ÃÃ_ f
,
ÃÃf g
IdUbigeo
ÕÕ 
=
ÕÕ 
dt
ÕÕ !
.
ÕÕ! "
Transaccion
ÕÕ" -
.
ÕÕ- .
Actor_negocio1
ÕÕ. <
.
ÕÕ< =
Actor
ÕÕ= B
.
ÕÕB C
	Direccion
ÕÕC L
.
ÕÕL M
FirstOrDefault
ÕÕM [
(
ÕÕ[ \
)
ÕÕ\ ]
.
ÕÕ] ^
	id_ubigeo
ÕÕ^ g
,
ÕÕg h
Ubigeo
ŒŒ 
=
ŒŒ 
dt
ŒŒ 
.
ŒŒ  
Transaccion
ŒŒ  +
.
ŒŒ+ ,
Actor_negocio1
ŒŒ, :
.
ŒŒ: ;
Actor
ŒŒ; @
.
ŒŒ@ A
	Direccion
ŒŒA J
.
ŒŒJ K
FirstOrDefault
ŒŒK Y
(
ŒŒY Z
)
ŒŒZ [
.
ŒŒ[ \
Ubigeo
ŒŒ\ b
.
ŒŒb c
descripcion_larga
ŒŒc t
,
ŒŒt u
FechaInicio
œœ 
=
œœ  !
dt
œœ" $
.
œœ$ %
Transaccion
œœ% 0
.
œœ0 1
fecha_inicio
œœ1 =
,
œœ= >
SerieComprobante
–– $
=
––% &
dt
––' )
.
––) *
Transaccion
––* 5
.
––5 6
Comprobante
––6 A
.
––A B
numero_serie
––B N
,
––N O
NumeroComprobante
—— %
=
——& '
dt
——( *
.
——* +
Transaccion
——+ 6
.
——6 7
Comprobante
——7 B
.
——B C
numero
——C I
,
——I J
Concepto
““ 
=
““ 
dt
““ !
.
““! "
Concepto_negocio
““" 2
.
““2 3
nombre
““3 9
,
““9 :
Cantidad
”” 
=
”” 
dt
”” !
.
””! "
cantidad
””" *
,
””* +
UnidadMedida
‘‘  
=
‘‘! "
dt
‘‘# %
.
‘‘% &
Concepto_negocio
‘‘& 6
.
‘‘6 7
Detalle_maestro2
‘‘7 G
.
‘‘G H
codigo
‘‘H N
}
÷÷ 
)
÷÷ 
.
÷÷ 
ToList
÷÷ 
(
÷÷ 
)
÷÷ 
;
÷÷ 
return
◊◊ 
Items
◊◊ 
;
◊◊ 
}
ÿÿ 
catch
ŸŸ 
(
ŸŸ 
	Exception
ŸŸ 
e
ŸŸ 
)
ŸŸ 
{
⁄⁄ 
throw
€€ 
new
€€ 
DatosException
€€ (
(
€€( )
$str
€€) K
,
€€K L
e
€€M N
)
€€N O
;
€€O P
}
‹‹ 
}
›› 	
public
ﬂﬂ 
IEnumerable
ﬂﬂ 
<
ﬂﬂ "
VentaConceptoCliente
ﬂﬂ /
>
ﬂﬂ/ 0/
!ObtenerItemVentaPorCaracteristica
ﬂﬂ1 R
(
ﬂﬂR S
int
ﬂﬂS V
idTipoTransaccion
ﬂﬂW h
,
ﬂﬂh i
int
ﬂﬂj m
idEstadoActual
ﬂﬂn |
,
ﬂﬂ| }
DateTimeﬂﬂ~ Ü

fechaDesdeﬂﬂá ë
,ﬂﬂë í
DateTimeﬂﬂì õ

fechaHastaﬂﬂú ¶
,ﬂﬂ¶ ß
intﬂﬂ® ´
[ﬂﬂ´ ¨
]ﬂﬂ¨ ≠&
idsActorNegocioInternoﬂﬂÆ ƒ
,ﬂﬂƒ ≈
intﬂﬂ∆ … 
idCaracteristicaﬂﬂ  ⁄
,ﬂﬂ⁄ €
intﬂﬂ‹ ﬂ%
idValorCaracteristicaﬂﬂ‡ ı
)ﬂﬂı ˆ
{
‡‡ 	
try
·· 
{
‚‚ 
var
„„ 
Items
„„ 
=
„„ 
_db
„„ 
.
„„  
Transaccion
„„  +
.
‰‰ 
Where
‰‰ 
(
‰‰ 
t
‰‰ 
=>
‰‰ 
t
‰‰  !
.
‰‰! "
fecha_inicio
‰‰" .
>=
‰‰/ 1

fechaDesde
‰‰2 <
&&
‰‰= ?
t
‰‰@ A
.
‰‰A B
fecha_inicio
‰‰B N
<=
‰‰O Q

fechaHasta
‰‰R \
&&
ÂÂ 
t
ÂÂ 
.
ÂÂ !
id_tipo_transaccion
ÂÂ ,
==
ÂÂ- /
idTipoTransaccion
ÂÂ0 A
&&
ÊÊ $
idsActorNegocioInterno
ÊÊ -
.
ÊÊ- .
Contains
ÊÊ. 6
(
ÊÊ6 7
t
ÊÊ7 8
.
ÊÊ8 9&
id_actor_negocio_interno
ÊÊ9 Q
)
ÊÊQ R
&&
ÁÁ 
t
ÁÁ 
.
ÁÁ 
id_estado_actual
ÁÁ )
==
ÁÁ* ,
idEstadoActual
ÁÁ- ;
)
ËË 
.
ÈÈ 

SelectMany
ÈÈ 
(
ÈÈ 
t
ÈÈ 
=>
ÈÈ  
t
ÈÈ! "
.
ÈÈ" #!
Detalle_transaccion
ÈÈ# 6
)
ÈÈ6 7
.
ÈÈ7 8
Where
ÍÍ 
(
ÍÍ 
dt
ÍÍ 
=>
ÍÍ 
dt
ÍÍ 
.
ÍÍ 
Concepto_negocio
ÍÍ /
.
ÍÍ/ 03
%Valor_caracteristica_concepto_negocio
ÍÍ0 U
.
ÍÍU V
Any
ÍÍV Y
(
ÍÍY Z
vccn
ÍÍZ ^
=>
ÍÍ_ a
vccn
ÍÍb f
.
ÍÍf g"
Valor_caracteristica
ÍÍg {
.
ÍÍ{ | 
id_caracteristicaÍÍ| ç
==ÍÍé ê 
idCaracteristicaÍÍë °
)ÍÍ° ¢
&&
ÎÎ 
dt
ÎÎ 
.
ÎÎ 
Concepto_negocio
ÎÎ &
.
ÎÎ& '3
%Valor_caracteristica_concepto_negocio
ÎÎ' L
.
ÎÎL M
Any
ÎÎM P
(
ÎÎP Q
vccn
ÎÎQ U
=>
ÎÎV X
vccn
ÎÎY ]
.
ÎÎ] ^%
id_valor_caracteristica
ÎÎ^ u
==
ÎÎv x$
idValorCaracteristicaÎÎy é
)ÎÎé è
)ÎÎè ê
.
ÏÏ 
Select
ÏÏ 
(
ÏÏ 
dt
ÏÏ 
=>
ÏÏ 
new
ÏÏ !"
VentaConceptoCliente
ÏÏ" 6
(
ÏÏ6 7
)
ÏÏ7 8
{
ÌÌ  
DocumentoIdentidad
ÓÓ &
=
ÓÓ' (
dt
ÓÓ) +
.
ÓÓ+ ,
Transaccion
ÓÓ, 7
.
ÓÓ7 8
Actor_negocio1
ÓÓ8 F
.
ÓÓF G
Actor
ÓÓG L
.
ÓÓL M(
numero_documento_identidad
ÓÓM g
,
ÓÓg h
RazonSocial
ÔÔ 
=
ÔÔ  !
dt
ÔÔ" $
.
ÔÔ$ %
Transaccion
ÔÔ% 0
.
ÔÔ0 1
Actor_negocio1
ÔÔ1 ?
.
ÔÔ? @
Actor
ÔÔ@ E
.
ÔÔE F
primer_nombre
ÔÔF S
.
ÔÔS T
Replace
ÔÔT [
(
ÔÔ[ \
$str
ÔÔ\ _
,
ÔÔ_ `
$str
ÔÔa d
)
ÔÔd e
,
ÔÔe f
	Direccion
 
=
 
dt
  "
.
" #
Transaccion
# .
.
. /
Actor_negocio1
/ =
.
= >
Actor
> C
.
C D
	Direccion
D M
.
M N
FirstOrDefault
N \
(
\ ]
)
] ^
.
^ _
detalle
_ f
,
f g
IdUbigeo
ÒÒ 
=
ÒÒ 
dt
ÒÒ !
.
ÒÒ! "
Transaccion
ÒÒ" -
.
ÒÒ- .
Actor_negocio1
ÒÒ. <
.
ÒÒ< =
Actor
ÒÒ= B
.
ÒÒB C
	Direccion
ÒÒC L
.
ÒÒL M
FirstOrDefault
ÒÒM [
(
ÒÒ[ \
)
ÒÒ\ ]
.
ÒÒ] ^
	id_ubigeo
ÒÒ^ g
,
ÒÒg h
Ubigeo
ÚÚ 
=
ÚÚ 
dt
ÚÚ 
.
ÚÚ  
Transaccion
ÚÚ  +
.
ÚÚ+ ,
Actor_negocio1
ÚÚ, :
.
ÚÚ: ;
Actor
ÚÚ; @
.
ÚÚ@ A
	Direccion
ÚÚA J
.
ÚÚJ K
FirstOrDefault
ÚÚK Y
(
ÚÚY Z
)
ÚÚZ [
.
ÚÚ[ \
Ubigeo
ÚÚ\ b
.
ÚÚb c
descripcion_larga
ÚÚc t
,
ÚÚt u
FechaInicio
ÛÛ 
=
ÛÛ  !
dt
ÛÛ" $
.
ÛÛ$ %
Transaccion
ÛÛ% 0
.
ÛÛ0 1
fecha_inicio
ÛÛ1 =
,
ÛÛ= >
SerieComprobante
ÙÙ $
=
ÙÙ% &
dt
ÙÙ' )
.
ÙÙ) *
Transaccion
ÙÙ* 5
.
ÙÙ5 6
Comprobante
ÙÙ6 A
.
ÙÙA B
numero_serie
ÙÙB N
,
ÙÙN O
NumeroComprobante
ıı %
=
ıı& '
dt
ıı( *
.
ıı* +
Transaccion
ıı+ 6
.
ıı6 7
Comprobante
ıı7 B
.
ııB C
numero
ııC I
,
ııI J
Concepto
ˆˆ 
=
ˆˆ 
dt
ˆˆ !
.
ˆˆ! "
Concepto_negocio
ˆˆ" 2
.
ˆˆ2 3
nombre
ˆˆ3 9
,
ˆˆ9 :
Cantidad
˜˜ 
=
˜˜ 
dt
˜˜ !
.
˜˜! "
cantidad
˜˜" *
,
˜˜* +
UnidadMedida
¯¯  
=
¯¯! "
dt
¯¯# %
.
¯¯% &
Concepto_negocio
¯¯& 6
.
¯¯6 7
Detalle_maestro2
¯¯7 G
.
¯¯G H
codigo
¯¯H N
}
˙˙ 
)
˙˙ 
.
˙˙ 
ToList
˙˙ 
(
˙˙ 
)
˙˙ 
;
˙˙ 
return
˚˚ 
Items
˚˚ 
;
˚˚ 
}
¸¸ 
catch
˝˝ 
(
˝˝ 
	Exception
˝˝ 
e
˝˝ 
)
˝˝ 
{
˛˛ 
throw
ˇˇ 
new
ˇˇ 
DatosException
ˇˇ (
(
ˇˇ( )
$str
ˇˇ) K
,
ˇˇK L
e
ˇˇM N
)
ˇˇN O
;
ˇˇO P
}
ÄÄ 
}
ÅÅ 	
public
ÉÉ 
IEnumerable
ÉÉ 
<
ÉÉ "
VentaConceptoCliente
ÉÉ /
>
ÉÉ/ 0)
ObtenerItemVentaPorConcepto
ÉÉ1 L
(
ÉÉL M
int
ÉÉM P
idTipoTransaccion
ÉÉQ b
,
ÉÉb c
int
ÉÉd g
idEstadoActual
ÉÉh v
,
ÉÉv w
DateTimeÉÉx Ä

fechaDesdeÉÉÅ ã
,ÉÉã å
DateTimeÉÉç ï

fechaHastaÉÉñ †
,ÉÉ† °
intÉÉ¢ •
[ÉÉ• ¶
]ÉÉ¶ ß&
idsActorNegocioInternoÉÉ® æ
,ÉÉæ ø
intÉÉ¿ √

idConceptoÉÉƒ Œ
)ÉÉŒ œ
{
ÑÑ 	
try
ÖÖ 
{
ÜÜ 
var
áá 
Items
áá 
=
áá 
_db
áá 
.
áá  
Transaccion
áá  +
.
àà 
Where
àà 
(
àà 
t
àà 
=>
àà  
t
àà! "
.
àà" #
fecha_inicio
àà# /
>=
àà0 2

fechaDesde
àà3 =
&&
àà> @
t
ààA B
.
ààB C
fecha_inicio
ààC O
<=
ààP R

fechaHasta
ààS ]
&&
ââ 
t
ââ 
.
ââ !
id_tipo_transaccion
ââ -
==
ââ. 0
idTipoTransaccion
ââ1 B
&&
ää $
idsActorNegocioInterno
ää .
.
ää. /
Contains
ää/ 7
(
ää7 8
t
ää8 9
.
ää9 :&
id_actor_negocio_interno
ää: R
)
ääR S
&&
ãã 
t
ãã 
.
ãã 
id_estado_actual
ãã *
==
ãã+ -
idEstadoActual
ãã. <
)
åå 
.
çç 

SelectMany
çç 
(
çç 
t
çç 
=>
çç !
t
çç" #
.
çç# $!
Detalle_transaccion
çç$ 7
)
çç7 8
.
éé 
Where
éé 
(
éé 
dt
éé 
=>
éé 
dt
éé  
.
éé  !
Concepto_negocio
éé! 1
.
éé1 2
id
éé2 4
==
éé5 7

idConcepto
éé8 B
)
ééB C
.
èè 
Select
èè 
(
èè 
dt
èè 
=>
èè 
new
èè ""
VentaConceptoCliente
èè# 7
(
èè7 8
)
èè8 9
{
êê  
DocumentoIdentidad
ëë '
=
ëë( )
dt
ëë* ,
.
ëë, -
Transaccion
ëë- 8
.
ëë8 9
Actor_negocio1
ëë9 G
.
ëëG H
Actor
ëëH M
.
ëëM N(
numero_documento_identidad
ëëN h
,
ëëh i
RazonSocial
íí  
=
íí! "
dt
íí# %
.
íí% &
Transaccion
íí& 1
.
íí1 2
Actor_negocio1
íí2 @
.
íí@ A
Actor
ííA F
.
ííF G
primer_nombre
ííG T
.
ííT U
Replace
ííU \
(
íí\ ]
$str
íí] `
,
íí` a
$str
ííb e
)
ííe f
,
ííf g
	Direccion
ìì 
=
ìì  
dt
ìì! #
.
ìì# $
Transaccion
ìì$ /
.
ìì/ 0
Actor_negocio1
ìì0 >
.
ìì> ?
Actor
ìì? D
.
ììD E
	Direccion
ììE N
.
ììN O
FirstOrDefault
ììO ]
(
ìì] ^
)
ìì^ _
.
ìì_ `
detalle
ìì` g
,
ììg h
IdUbigeo
îî 
=
îî 
dt
îî  "
.
îî" #
Transaccion
îî# .
.
îî. /
Actor_negocio1
îî/ =
.
îî= >
Actor
îî> C
.
îîC D
	Direccion
îîD M
.
îîM N
FirstOrDefault
îîN \
(
îî\ ]
)
îî] ^
.
îî^ _
	id_ubigeo
îî_ h
,
îîh i
Ubigeo
ïï 
=
ïï 
dt
ïï  
.
ïï  !
Transaccion
ïï! ,
.
ïï, -
Actor_negocio1
ïï- ;
.
ïï; <
Actor
ïï< A
.
ïïA B
	Direccion
ïïB K
.
ïïK L
FirstOrDefault
ïïL Z
(
ïïZ [
)
ïï[ \
.
ïï\ ]
Ubigeo
ïï] c
.
ïïc d
descripcion_larga
ïïd u
,
ïïu v
FechaInicio
ññ  
=
ññ! "
dt
ññ# %
.
ññ% &
Transaccion
ññ& 1
.
ññ1 2
fecha_inicio
ññ2 >
,
ññ> ?
SerieComprobante
óó %
=
óó& '
dt
óó( *
.
óó* +
Transaccion
óó+ 6
.
óó6 7
Comprobante
óó7 B
.
óóB C
numero_serie
óóC O
,
óóO P
NumeroComprobante
òò &
=
òò' (
dt
òò) +
.
òò+ ,
Transaccion
òò, 7
.
òò7 8
Comprobante
òò8 C
.
òòC D
numero
òòD J
,
òòJ K
Concepto
ôô 
=
ôô 
dt
ôô  "
.
ôô" #
Concepto_negocio
ôô# 3
.
ôô3 4
nombre
ôô4 :
,
ôô: ;
Cantidad
öö 
=
öö 
dt
öö  "
.
öö" #
cantidad
öö# +
,
öö+ ,
UnidadMedida
õõ !
=
õõ" #
dt
õõ$ &
.
õõ& '
Concepto_negocio
õõ' 7
.
õõ7 8
Detalle_maestro2
õõ8 H
.
õõH I
codigo
õõI O
}
úú 
)
úú 
.
úú 
ToList
úú 
(
úú 
)
úú 
;
úú 
return
ùù 
Items
ùù 
;
ùù 
}
ûû 
catch
üü 
(
üü 
	Exception
üü 
e
üü 
)
üü 
{
†† 
throw
°° 
new
°° 
DatosException
°° (
(
°°( )
$str
°°) K
,
°°K L
e
°°M N
)
°°N O
;
°°O P
}
¢¢ 
}
££ 	
public
•• 
IEnumerable
•• 
<
•• )
ResumenDeTransaccionGeneral
•• 6
>
••6 7+
ObtenerResumenDeTransacciones
••8 U
(
••U V
int
••V Y
[
••Y Z
]
••Z [!
idsTiposTransaccion
••\ o
,
••o p
int
••q t
idEstadoActual••u É
,••É Ñ
DateTime••Ö ç

fechaDesde••é ò
,••ò ô
DateTime••ö ¢

fechaHasta••£ ≠
,••≠ Æ
int••Ø ≤ 
idCentroAtencion••≥ √
)••√ ƒ
{
¶¶ 	
try
ßß 
{
®® 
var
©© 
_db
©© 
=
©© 
new
©© 
SigescomEntities
©© .
(
©©. /
)
©©/ 0
;
©©0 1
return
™™ 
_db
™™ 
.
™™ 
Transaccion
™™ &
.
™™& '
Where
™™' ,
(
™™, -
t
™™- .
=>
™™/ 1
t
™™2 3
.
™™3 4
fecha_inicio
™™4 @
>=
™™A C

fechaDesde
™™D N
&&
™™O Q
t
™™R S
.
™™S T
fecha_inicio
™™T `
<=
™™a c

fechaHasta
™™d n
&&
™™o q"
idsTiposTransaccion™™r Ö
.™™Ö Ü
Contains™™Ü é
(™™é è
t™™è ê
.™™ê ë#
id_tipo_transaccion™™ë §
)™™§ •
&&™™¶ ®
t™™© ™
.™™™ ´(
id_actor_negocio_interno™™´ √
==™™ƒ ∆ 
idCentroAtencion™™« ◊
)™™◊ ÿ
.™™ÿ Ÿ
Select™™Ÿ ﬂ
(™™ﬂ ‡
t™™‡ ·
=>™™‚ ‰
new™™Â Ë+
ResumenDeTransaccionGeneral™™È Ñ
(™™Ñ Ö
)™™Ö Ü
{
´´ 
Id
¨¨ 
=
¨¨ 
t
¨¨ 
.
¨¨ 
id
¨¨ 
,
¨¨ !
ActorNegocioExterno
≠≠ '
=
≠≠( )
t
≠≠* +
.
≠≠+ ,
Actor_negocio1
≠≠, :
.
≠≠: ;
Actor
≠≠; @
.
≠≠@ A
primer_nombre
≠≠A N
.
≠≠N O
Replace
≠≠O V
(
≠≠V W
$str
≠≠W Z
,
≠≠Z [
$str
≠≠\ _
)
≠≠_ `
,
≠≠` a
Comprobante
ÆÆ 
=
ÆÆ  !
t
ÆÆ" #
.
ÆÆ# $
Comprobante
ÆÆ$ /
.
ÆÆ/ 0
numero_serie
ÆÆ0 <
+
ÆÆ= >
$str
ÆÆ> A
+
ÆÆA B
t
ÆÆC D
.
ÆÆD E
Comprobante
ÆÆE P
.
ÆÆP Q
numero
ÆÆQ W
,
ÆÆW X,
ComprobanteOperacionReferencia
ØØ 2
=
ØØ2 3
t
ØØ4 5
.
ØØ5 6
Transaccion3
ØØ6 B
.
ØØB C
Comprobante
ØØC N
.
ØØN O
numero_serie
ØØO [
+
ØØ\ ]
$str
ØØ^ a
+
ØØa b
t
ØØb c
.
ØØc d
Transaccion3
ØØd p
.
ØØp q
Comprobante
ØØq |
.
ØØ| }
numeroØØ} É
,ØØÉ Ñ
Empleado
∞∞ 
=
∞∞ 
t
∞∞ 
.
∞∞  
Actor_negocio
∞∞  -
.
∞∞- .
Actor
∞∞. 3
.
∞∞3 4
segundo_nombre
∞∞4 B
,
∞∞B C
Fecha
±± 
=
±± 
t
±± 
.
±± 
fecha_inicio
±± )
,
±±) *&
FechaOperacionReferencia
≤≤ ,
=
≤≤, -
t
≤≤. /
.
≤≤/ 0
Transaccion3
≤≤0 <
.
≤≤< =
fecha_inicio
≤≤= I
,
≤≤I J
ImporteTotal
≥≥  
=
≥≥  !
t
≥≥" #
.
≥≥# $
importe_total
≥≥$ 1
,
≥≥1 2
Observacion
¥¥ 
=
¥¥  
t
¥¥! "
.
¥¥" #

comentario
¥¥# -
}
µµ 
)
µµ 
;
µµ 
}
∂∂ 
catch
∑∑ 
(
∑∑ 
	Exception
∑∑ 
e
∑∑ 
)
∑∑ 
{
∏∏ 
throw
ππ 
e
ππ 
;
ππ 
}
∫∫ 
}
ªª 	
public
ææ 
IEnumerable
ææ 
<
ææ )
ResumenDeTransaccionGeneral
ææ 6
>
ææ6 7+
ObtenerResumenDeTransacciones
ææ8 U
(
ææU V
int
ææV Y
[
ææY Z
]
ææZ [!
idsTiposTransaccion
ææ\ o
,
ææo p
int
ææq t
idEstadoActualææu É
,ææÉ Ñ
DateTimeææÖ ç

fechaDesdeææé ò
,ææò ô
DateTimeææö ¢

fechaHastaææ£ ≠
,ææ≠ Æ
intææØ ≤ 
idCentroAtencionææ≥ √
,ææ√ ƒ
intææ≈ »,
idParametroParaTipoOperacionææ… Â
)ææÂ Ê
{
øø 	
try
¿¿ 
{
¡¡ 
var
¬¬ 
_db
¬¬ 
=
¬¬ 
new
¬¬ 
SigescomEntities
¬¬ .
(
¬¬. /
)
¬¬/ 0
;
¬¬0 1
var
√√ 
	resultado
√√ 
=
√√ 
_db
√√ "
.
√√" #
Transaccion
√√# .
.
√√. /
Where
√√/ 4
(
√√4 5
t
√√5 6
=>
√√7 9
t
√√: ;
.
√√; <
fecha_inicio
√√< H
>=
√√I K

fechaDesde
√√L V
&&
√√W Y
t
√√Z [
.
√√[ \
fecha_inicio
√√\ h
<=
√√i k

fechaHasta
√√l v
&&
√√w y"
idsTiposTransaccion√√z ç
.√√ç é
Contains√√é ñ
(√√ñ ó
t√√ó ò
.√√ò ô#
id_tipo_transaccion√√ô ¨
)√√¨ ≠
&&√√Æ ∞
t√√± ≤
.√√≤ ≥(
id_actor_negocio_interno√√≥ À
==√√Ã Œ 
idCentroAtencion√√œ ﬂ
)√√ﬂ ‡
.√√‡ ·
Select√√· Á
(√√Á Ë
t√√Ë È
=>√√Í Ï
new√√Ì +
ResumenDeTransaccionGeneral√√Ò å
(√√å ç
)√√ç é
{
ƒƒ 
Id
≈≈ 
=
≈≈ 
t
≈≈ 
.
≈≈ 
id
≈≈ 
,
≈≈ !
ActorNegocioExterno
∆∆ '
=
∆∆( )
t
∆∆* +
.
∆∆+ ,
Actor_negocio1
∆∆, :
.
∆∆: ;
Actor
∆∆; @
.
∆∆@ A
primer_nombre
∆∆A N
.
∆∆N O
Replace
∆∆O V
(
∆∆V W
$str
∆∆W Z
,
∆∆Z [
$str
∆∆\ _
)
∆∆_ `
,
∆∆` a
Comprobante
«« 
=
««  !
t
««" #
.
««# $
Comprobante
««$ /
.
««/ 0
numero_serie
««0 <
+
««= >
$str
««? B
+
««C D
t
««E F
.
««F G
Comprobante
««G R
.
««R S
numero
««S Y
,
««Y Z,
ComprobanteOperacionReferencia
»» 2
=
»»3 4
t
»»5 6
.
»»6 7
Transaccion3
»»7 C
.
»»C D
Comprobante
»»D O
.
»»O P
numero_serie
»»P \
+
»»] ^
$str
»»_ b
+
»»c d
t
»»e f
.
»»f g
Transaccion3
»»g s
.
»»s t
Comprobante
»»t 
.»» Ä
numero»»Ä Ü
,»»Ü á
Empleado
…… 
=
…… 
t
……  
.
……  !
Actor_negocio
……! .
.
……. /
Actor
……/ 4
.
……4 5
segundo_nombre
……5 C
,
……C D
Fecha
   
=
   
t
   
.
   
fecha_inicio
   *
,
  * +&
FechaOperacionReferencia
ÀÀ ,
=
ÀÀ- .
t
ÀÀ/ 0
.
ÀÀ0 1
Transaccion3
ÀÀ1 =
.
ÀÀ= >
fecha_inicio
ÀÀ> J
,
ÀÀJ K
ImporteTotal
ÃÃ  
=
ÃÃ! "
t
ÃÃ# $
.
ÃÃ$ %
importe_total
ÃÃ% 2
,
ÃÃ2 3
Observacion
ÕÕ 
=
ÕÕ  !
t
ÕÕ" #
.
ÕÕ# $

comentario
ÕÕ$ .
,
ÕÕ. /&
CodigoTipoOperacionSunat
ŒŒ ,
=
ŒŒ, -
t
ŒŒ. /
.
ŒŒ/ 0#
Parametro_transaccion
ŒŒ0 E
.
ŒŒE F
FirstOrDefault
ŒŒF T
(
ŒŒT U
pt
ŒŒU W
=>
ŒŒW Y
pt
ŒŒZ \
.
ŒŒ\ ]
id_parametro
ŒŒ] i
==
ŒŒi k+
idParametroParaTipoOperacionŒŒl à
)ŒŒà â
.ŒŒâ ä
valorŒŒä è
}
–– 
)
–– 
;
–– 
return
““ 
	resultado
““  
;
““  !
}
‘‘ 
catch
’’ 
(
’’ 
	Exception
’’ 
e
’’ 
)
’’ 
{
÷÷ 
throw
◊◊ 
e
◊◊ 
;
◊◊ 
}
ÿÿ 
}
ŸŸ 	
public
€€ 
IEnumerable
€€ 
<
€€ 
Movimiento_Caja
€€ *
>
€€* +%
ObtenerMovimientoDeCaja
€€, C
(
€€C D
int
€€D G/
!idAccionDeNegocioMovimientoEnCaja
€€H i
,
€€i j
DateTime
€€k s

fechaDesde
€€t ~
,
€€~ 
DateTime€€Ä à

fechaHasta€€â ì
)€€ì î
{
‹‹ 	
try
›› 
{
ﬁﬁ 
var
ﬂﬂ 
Resumen
ﬂﬂ 
=
ﬂﬂ 
_db
ﬂﬂ !
.
ﬂﬂ! "4
&Accion_de_negocio_por_tipo_transaccion
ﬂﬂ" H
.
‡‡  !
Where
‡‡! &
(
‡‡& '
antt
‡‡' +
=>
‡‡, .
antt
‡‡/ 3
.
‡‡3 4"
id_accion_de_negocio
‡‡4 H
==
‡‡I K/
!idAccionDeNegocioMovimientoEnCaja
‡‡L m
)
‡‡m n
.
··  !

SelectMany
··! +
(
··+ ,
antt
··, 0
=>
··1 3
antt
··4 8
.
··8 9
Tipo_transaccion
··9 I
.
··I J
Transaccion
··J U
)
··U V
.
··V W
Where
··W \
(
··\ ]
t
··] ^
=>
··_ a
t
··b c
.
··c d
fecha_inicio
··d p
>=
··q s

fechaDesde
··t ~
&&·· Å
t··Ç É
.··É Ñ
fecha_inicio··Ñ ê
<=··ë ì

fechaHasta··î û
&&··ü °
t··¢ £
.··£ § 
id_estado_actual··§ ¥
==··µ ∑
MaestroSettings··∏ «
.··« »
Default··» œ
.··œ –0
 IdDetalleMaestroEstadoConfirmado··– 
)·· Ò
.
‚‚ 
Select
‚‚ 
(
‚‚ 
t
‚‚ 
=>
‚‚  
new
‚‚! $
Movimiento_Caja
‚‚% 4
(
‚‚4 5
)
‚‚5 6
{
„„ 

IdConcepto
‰‰ "
=
‰‰# $
t
‰‰% &
.
‰‰& '!
id_tipo_transaccion
‰‰' :
,
‰‰: ;
Fecha
ÂÂ 
=
ÂÂ 
t
ÂÂ  !
.
ÂÂ! "
fecha_inicio
ÂÂ" .
,
ÂÂ. /
IdCaja
ÊÊ 
=
ÊÊ  
t
ÊÊ! "
.
ÊÊ" #&
id_actor_negocio_interno
ÊÊ# ;
,
ÊÊ; <

NombreCaja
ÁÁ "
=
ÁÁ# $
t
ÁÁ% &
.
ÁÁ& '
Actor_negocio2
ÁÁ' 5
.
ÁÁ5 6
Actor
ÁÁ6 ;
.
ÁÁ; <
primer_nombre
ÁÁ< I
,
ÁÁI J
Concepto
ËË  
=
ËË! "
t
ËË# $
.
ËË$ %
Tipo_transaccion
ËË% 5
.
ËË5 6
nombre
ËË6 <
,
ËË< =#
CodigoTipoComprobante
ÈÈ -
=
ÈÈ. /
t
ÈÈ0 1
.
ÈÈ1 2
Comprobante
ÈÈ2 =
.
ÈÈ= >
Detalle_maestro
ÈÈ> M
.
ÈÈM N
valor
ÈÈN S
,
ÈÈS T%
SerieYNumeroComprobante
ÍÍ /
=
ÍÍ0 1
t
ÍÍ2 3
.
ÍÍ3 4
Comprobante
ÍÍ4 ?
.
ÍÍ? @
numero_serie
ÍÍ@ L
+
ÍÍM N
$str
ÍÍO R
+
ÍÍS T
t
ÍÍU V
.
ÍÍV W
Comprobante
ÍÍW b
.
ÍÍb c
numero
ÍÍc i
,
ÍÍi j
Monto
ÎÎ 
=
ÎÎ 
t
ÎÎ  !
.
ÎÎ! "
importe_total
ÎÎ" /
,
ÎÎ/ 0
	EsIngreso
ÏÏ !
=
ÏÏ" #
t
ÏÏ$ %
.
ÏÏ% &
Tipo_transaccion
ÏÏ& 6
.
ÏÏ6 74
&Accion_de_negocio_por_tipo_transaccion
ÏÏ7 ]
.
ÏÏ] ^
FirstOrDefault
ÏÏ^ l
(
ÏÏl m
anpt
ÏÏm q
=>
ÏÏr t
anpt
ÏÏu y
.
ÏÏy z#
id_accion_de_negocioÏÏz é
==ÏÏè ë1
!idAccionDeNegocioMovimientoEnCajaÏÏí ≥
)ÏÏ≥ ¥
.ÏÏ¥ µ
valorÏÏµ ∫
}
ÌÌ 
)
ÌÌ 
;
ÌÌ 
return
ÓÓ 
Resumen
ÓÓ 
;
ÓÓ 
}
ÔÔ 
catch
 
(
 
	Exception
 
e
 
)
 
{
ÒÒ 
throw
ÚÚ 
new
ÚÚ 
DatosException
ÚÚ (
(
ÚÚ( )
$str
ÚÚ) O
,
ÚÚO P
e
ÚÚQ R
)
ÚÚR S
;
ÚÚS T
}
ÛÛ 
}
ÙÙ 	
public
ıı 
IEnumerable
ıı 
<
ıı 
Movimiento_Caja
ıı *
>
ıı* +%
ObtenerMovimientoDeCaja
ıı, C
(
ııC D
int
ııD G/
!idAccionDeNegocioMovimientoEnCaja
ııH i
,
ııi j
int
ıık n
idCentroAtencion
ııo 
,ıı Ä
DateTimeııÅ â

fechaDesdeııä î
,ııî ï
DateTimeııñ û

fechaHastaııü ©
)ıı© ™
{
ˆˆ 	
try
˜˜ 
{
¯¯ 
var
˘˘ 
Resumen
˘˘ 
=
˘˘ 
_db
˘˘ !
.
˘˘! "4
&Accion_de_negocio_por_tipo_transaccion
˘˘" H
.
˙˙  !
Where
˙˙! &
(
˙˙& '
antt
˙˙' +
=>
˙˙, .
antt
˙˙/ 3
.
˙˙3 4"
id_accion_de_negocio
˙˙4 H
==
˙˙I K/
!idAccionDeNegocioMovimientoEnCaja
˙˙L m
)
˙˙m n
.
˚˚  !

SelectMany
˚˚! +
(
˚˚+ ,
antt
˚˚, 0
=>
˚˚1 3
antt
˚˚4 8
.
˚˚8 9
Tipo_transaccion
˚˚9 I
.
˚˚I J
Transaccion
˚˚J U
)
˚˚U V
.
˚˚V W
Where
˚˚W \
(
˚˚\ ]
t
˚˚] ^
=>
˚˚_ a
t
˚˚b c
.
˚˚c d
fecha_inicio
˚˚d p
>=
˚˚q s

fechaDesde
˚˚t ~
&&˚˚ Å
t˚˚Ç É
.˚˚É Ñ
fecha_inicio˚˚Ñ ê
<=˚˚ë ì

fechaHasta˚˚î û
&&˚˚ü °
t˚˚¢ £
.˚˚£ §(
id_actor_negocio_interno˚˚§ º
==˚˚Ω ø 
idCentroAtencion˚˚¿ –
&&˚˚— ”
t˚˚‘ ’
.˚˚’ ÷ 
id_estado_actual˚˚÷ Ê
==˚˚Á È
MaestroSettings˚˚Í ˘
.˚˚˘ ˙
Default˚˚˙ Å
.˚˚Å Ç0
 IdDetalleMaestroEstadoConfirmado˚˚Ç ¢
)˚˚¢ £
.
¸¸ 
Select
¸¸ 
(
¸¸ 
t
¸¸ 
=>
¸¸ 
new
¸¸  #
Movimiento_Caja
¸¸$ 3
(
¸¸3 4
)
¸¸4 5
{
˝˝ 

IdConcepto
˛˛ !
=
˛˛" #
t
˛˛$ %
.
˛˛% &!
id_tipo_transaccion
˛˛& 9
,
˛˛9 :
Fecha
ˇˇ 
=
ˇˇ 
t
ˇˇ  
.
ˇˇ  !
fecha_inicio
ˇˇ! -
,
ˇˇ- .
IdCaja
ÄÄ 
=
ÄÄ 
t
ÄÄ  !
.
ÄÄ! "&
id_actor_negocio_interno
ÄÄ" :
,
ÄÄ: ;

NombreCaja
ÅÅ !
=
ÅÅ" #
t
ÅÅ$ %
.
ÅÅ% &
Actor_negocio2
ÅÅ& 4
.
ÅÅ4 5
Actor
ÅÅ5 :
.
ÅÅ: ;
primer_nombre
ÅÅ; H
,
ÅÅH I
Concepto
ÇÇ 
=
ÇÇ  !
t
ÇÇ" #
.
ÇÇ# $
Tipo_transaccion
ÇÇ$ 4
.
ÇÇ4 5
nombre
ÇÇ5 ;
,
ÇÇ; <#
CodigoTipoComprobante
ÉÉ ,
=
ÉÉ- .
t
ÉÉ/ 0
.
ÉÉ0 1
Comprobante
ÉÉ1 <
.
ÉÉ< =
Detalle_maestro
ÉÉ= L
.
ÉÉL M
valor
ÉÉM R
,
ÉÉR S%
SerieYNumeroComprobante
ÑÑ .
=
ÑÑ/ 0
t
ÑÑ1 2
.
ÑÑ2 3
Comprobante
ÑÑ3 >
.
ÑÑ> ?
numero_serie
ÑÑ? K
+
ÑÑL M
$str
ÑÑN Q
+
ÑÑR S
t
ÑÑT U
.
ÑÑU V
Comprobante
ÑÑV a
.
ÑÑa b
numero
ÑÑb h
,
ÑÑh i
Monto
ÖÖ 
=
ÖÖ 
t
ÖÖ  
.
ÖÖ  !
importe_total
ÖÖ! .
,
ÖÖ. /
	EsIngreso
ÜÜ  
=
ÜÜ! "
t
ÜÜ# $
.
ÜÜ$ %
Tipo_transaccion
ÜÜ% 5
.
ÜÜ5 64
&Accion_de_negocio_por_tipo_transaccion
ÜÜ6 \
.
ÜÜ\ ]
FirstOrDefault
ÜÜ] k
(
ÜÜk l
anpt
ÜÜl p
=>
ÜÜq s
anpt
ÜÜt x
.
ÜÜx y#
id_accion_de_negocioÜÜy ç
==ÜÜé ê1
!idAccionDeNegocioMovimientoEnCajaÜÜë ≤
)ÜÜ≤ ≥
.ÜÜ≥ ¥
valorÜÜ¥ π
}
áá 
)
áá 
;
áá 
return
àà 
Resumen
àà 
;
àà 
}
ââ 
catch
ää 
(
ää 
	Exception
ää 
e
ää 
)
ää 
{
ãã 
throw
åå 
new
åå 
DatosException
åå (
(
åå( )
$str
åå) O
,
ååO P
e
ååQ R
)
ååR S
;
ååS T
}
çç 
}
éé 	
public
èè 
IEnumerable
èè 
<
èè 
Movimiento_Caja
èè *
>
èè* +%
ObtenerMovimientoDeCaja
èè, C
(
èèC D
int
èèD G/
!idAccionDeNegocioMovimientoEnCaja
èèH i
,
èèi j
int
èèk n
[
èèn o
]
èèo p 
idsCentroAtencionèèq Ç
,èèÇ É
DateTimeèèÑ å

fechaDesdeèèç ó
,èèó ò
DateTimeèèô °

fechaHastaèè¢ ¨
)èè¨ ≠
{
êê 	
try
ëë 
{
íí 
var
ìì 
Resumen
ìì 
=
ìì 
_db
ìì !
.
ìì! "4
&Accion_de_negocio_por_tipo_transaccion
ìì" H
.
îî  !
Where
îî! &
(
îî& '
antt
îî' +
=>
îî, .
antt
îî/ 3
.
îî3 4"
id_accion_de_negocio
îî4 H
==
îîI K/
!idAccionDeNegocioMovimientoEnCaja
îîL m
)
îîm n
.
ïï  !

SelectMany
ïï! +
(
ïï+ ,
antt
ïï, 0
=>
ïï1 3
antt
ïï4 8
.
ïï8 9
Tipo_transaccion
ïï9 I
.
ïïI J
Transaccion
ïïJ U
)
ïïU V
.
ïïV W
Where
ïïW \
(
ïï\ ]
t
ïï] ^
=>
ïï_ a
t
ïïb c
.
ïïc d
fecha_inicio
ïïd p
>=
ïïq s

fechaDesde
ïït ~
&&ïï Å
tïïÇ É
.ïïÉ Ñ
fecha_inicioïïÑ ê
<=ïïë ì

fechaHastaïïî û
&&ïïü °!
idsCentroAtencionïï¢ ≥
.ïï≥ ¥
Containsïï¥ º
(ïïº Ω
tïïΩ æ
.ïïæ ø(
id_actor_negocio_internoïïø ◊
)ïï◊ ÿ
&&ïïŸ €
tïï‹ ›
.ïï› ﬁ 
id_estado_actualïïﬁ Ó
==ïïÔ Ò
MaestroSettingsïïÚ Å
.ïïÅ Ç
DefaultïïÇ â
.ïïâ ä0
 IdDetalleMaestroEstadoConfirmadoïïä ™
)ïï™ ´
.
ññ 
Select
ññ 
(
ññ 
t
ññ 
=>
ññ  
new
ññ! $
Movimiento_Caja
ññ% 4
(
ññ4 5
)
ññ5 6
{
óó 

IdConcepto
òò "
=
òò# $
t
òò% &
.
òò& '!
id_tipo_transaccion
òò' :
,
òò: ;
Fecha
ôô 
=
ôô 
t
ôô  !
.
ôô! "
fecha_inicio
ôô" .
,
ôô. /
IdCaja
öö 
=
öö  
t
öö! "
.
öö" #&
id_actor_negocio_interno
öö# ;
,
öö; <

NombreCaja
õõ "
=
õõ# $
t
õõ% &
.
õõ& '
Actor_negocio2
õõ' 5
.
õõ5 6
Actor
õõ6 ;
.
õõ; <
primer_nombre
õõ< I
,
õõI J
Concepto
úú  
=
úú! "
t
úú# $
.
úú$ %
Tipo_transaccion
úú% 5
.
úú5 6
nombre
úú6 <
,
úú< =#
CodigoTipoComprobante
ùù -
=
ùù. /
t
ùù0 1
.
ùù1 2
Comprobante
ùù2 =
.
ùù= >
Detalle_maestro
ùù> M
.
ùùM N
valor
ùùN S
,
ùùS T%
SerieYNumeroComprobante
ûû /
=
ûû0 1
t
ûû2 3
.
ûû3 4
Comprobante
ûû4 ?
.
ûû? @
numero_serie
ûû@ L
+
ûûM N
$str
ûûO R
+
ûûS T
t
ûûU V
.
ûûV W
Comprobante
ûûW b
.
ûûb c
numero
ûûc i
,
ûûi j
Monto
üü 
=
üü 
t
üü  !
.
üü! "
importe_total
üü" /
,
üü/ 0
	EsIngreso
†† !
=
††" #
t
††$ %
.
††% &
Tipo_transaccion
††& 6
.
††6 74
&Accion_de_negocio_por_tipo_transaccion
††7 ]
.
††] ^
FirstOrDefault
††^ l
(
††l m
anpt
††m q
=>
††r t
anpt
††u y
.
††y z#
id_accion_de_negocio††z é
==††è ë1
!idAccionDeNegocioMovimientoEnCaja††í ≥
)††≥ ¥
.††¥ µ
valor††µ ∫
}
°° 
)
°° 
;
°° 
return
¢¢ 
Resumen
¢¢ 
;
¢¢ 
}
££ 
catch
§§ 
(
§§ 
	Exception
§§ 
e
§§ 
)
§§ 
{
•• 
throw
¶¶ 
new
¶¶ 
DatosException
¶¶ (
(
¶¶( )
$str
¶¶) O
,
¶¶O P
e
¶¶Q R
)
¶¶R S
;
¶¶S T
}
ßß 
}
®® 	
public
´´ 
IEnumerable
´´ 
<
´´ 
DetalleCuotaPago
´´ +
>
´´+ ,1
#ObtenerDetallesCuotaPagoDeOperacion
´´- P
(
´´P Q
long
´´Q U
idOperacion
´´V a
)
´´a b
{
¨¨ 	
try
≠≠ 
{
ÆÆ 
return
ØØ 
_db
ØØ 
.
ØØ 
Cuota
ØØ  
.
ØØ  !
Where
ØØ! &
(
ØØ& '
c
ØØ' (
=>
ØØ) +
c
ØØ, -
.
ØØ- .
id_transaccion
ØØ. <
==
ØØ= ?
idOperacion
ØØ@ K
)
ØØK L
.
∞∞ 
Select
∞∞ 
(
∞∞ 
t
∞∞ 
=>
∞∞  
new
∞∞! $
DetalleCuotaPago
∞∞% 5
(
∞∞5 6
)
∞∞6 7
{
±± 
Id
≤≤ 
=
≤≤ 
t
≤≤ 
.
≤≤ 
id
≤≤ !
,
≤≤! "
IdOperacion
≥≥ #
=
≥≥$ %
t
≥≥& '
.
≥≥' (
id_transaccion
≥≥( 6
,
≥≥6 7
Codigo
¥¥ 
=
¥¥  
t
¥¥! "
.
¥¥" #
codigo
¥¥# )
,
¥¥) *
Total
µµ 
=
µµ 
t
µµ  !
.
µµ! "
total
µµ" '
,
µµ' (
Pagado
∂∂ 
=
∂∂  
t
∂∂! "
.
∂∂" #
pago_a_cuenta
∂∂# 0
,
∂∂0 1
Revocado
∑∑  
=
∑∑! "
t
∑∑# $
.
∑∑$ %
revocado
∑∑% -
,
∑∑- .
Saldo
∏∏ 
=
∏∏ 
t
∏∏  !
.
∏∏! "
saldo
∏∏" '
,
∏∏' (
}
ππ 
)
ππ 
;
ππ 
}
∫∫ 
catch
ªª 
(
ªª 
	Exception
ªª 
e
ªª 
)
ªª 
{
ºº 
throw
ΩΩ 
new
ΩΩ 
DatosException
ΩΩ (
(
ΩΩ( )
$str
ΩΩ) O
,
ΩΩO P
e
ΩΩQ R
)
ΩΩR S
;
ΩΩS T
}
ææ 
}
øø 	
}
ƒƒ 
}≈≈ ≥Œ(
MD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\TransaccionDatos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
{ 
public 

partial 
class 
TransaccionDatos )
:* +
RepositorioBase, ;
,; <#
ITransaccionRepositorio= T
{ 
public #
Transaccion_consolidada &0
$ObtenerResumenTransaccionesDespuesDe' K
(K L
intL O
idTipoTransaccionP a
,a b
intc f
idUltimoEstadog u
,u v
DateTimew 

fechaDesde
Ä ä
,
ä ã
DateTime
å î

fechaHasta
ï ü
,
ü †
int
° §
idSerie
• ¨
,
¨ ≠
long
Æ ≤
idMinimo
≥ ª
)
ª º
{ 	
try 
{ 
var 
Resumen 
= 
_db !
.! "
Transaccion" -
.- .
Where. 3
(3 4
sbt4 7
=>8 :
sbt; >
.> ?
id_tipo_transaccion? R
==S U
idTipoTransaccionV g
&& 
sbt 
. 
Comprobante "
." # 
id_serie_comprobante# 7
==8 :
idSerie; B
&& 
sbt 
. 
fecha_inicio #
>=$ &

fechaDesde' 1
&&2 4
sbt5 8
.8 9
fecha_inicio9 E
<=F H

fechaHastaI S
&&   
sbt   
.   
id_estado_actual   '
==  ( *
idUltimoEstado  + 9
&&!! 
sbt!! 
.!! 
id!! 
>!! 
idMinimo!! $
)!!$ %
."" 

SelectMany"" 
("" 
t"" 
=>""  
t""! "
.""" #
Detalle_transaccion""# 6
)""6 7
.""7 8
GroupBy## 
(## 
dt## 
=>## 
new## 
{$$ 
Fecha%% 
=%% 
new%% 
{%% 
y%%  !
=%%" #
dt%%$ &
.%%& '
Transaccion%%' 2
.%%2 3
fecha_inicio%%3 ?
.%%? @
Year%%@ D
,%%D E
m%%F G
=%%H I
dt%%J L
.%%L M
Transaccion%%M X
.%%X Y
fecha_inicio%%Y e
.%%e f
Month%%f k
,%%k l
d%%m n
=%%o p
dt%%q s
.%%s t
Transaccion%%t 
.	%% Ä
fecha_inicio
%%Ä å
.
%%å ç
Day
%%ç ê
}
%%ë í
,
%%í ì
dt'' 
.'' 
Transaccion''  
.''  !
Comprobante''! ,
.'', - 
id_serie_comprobante''- A
,''A B
dt(( 
.(( 
Transaccion((  
.((  !
Comprobante((! ,
.((, -
numero_serie((- 9
}** 
)** 
.** 
Select** 
(** 
dt** 
=>** 
new** !#
Transaccion_consolidada**" 9
(**9 :
)**: ;
{++ 
Anyo,, 
=,, 
dt,, 
.,, 
Key,, 
.,,  
Fecha,,  %
.,,% &
y,,& '
,,,' (
Mes-- 
=-- 
dt-- 
.-- 
Key-- 
.-- 
Fecha-- $
.--$ %
m--% &
,--& '
Dia.. 
=.. 
dt.. 
... 
Key.. 
... 
Fecha.. $
...$ %
d..% &
,..& '
IdSerie// 
=// 
dt// 
.// 
Key// "
.//" # 
id_serie_comprobante//# 7
,//7 8
Serie00 
=00 
dt00 
.00 
Key00  
.00  !
numero_serie00! -
,00- .
NumeroInicial11 
=11  !
(11" #
int11# &
)11& '
dt11' )
.11) *
Min11* -
(11- .
m11. /
=>110 2
m113 4
.114 5
Transaccion115 @
.11@ A
Comprobante11A L
.11L M
numero11M S
)11S T
,11T U
NumeroFinal22 
=22 
(22  !
int22! $
)22$ %
dt22% '
.22' (
Max22( +
(22+ ,
m22, -
=>22. 0
m221 2
.222 3
Transaccion223 >
.22> ?
Comprobante22? J
.22J K
numero22K Q
)22Q R
,22R S
IGV33 
=33 
dt33 
.33 
Sum33 
(33 
c33  
=>33! #
(33$ %
decimal33% ,
)33, -
c33- .
.33. /
igv33/ 2
)332 3
,333 4
Total44 
=44 
dt44 
.44 
Sum44  
(44  !
c44! "
=>44# %
c44& '
.44' (
total44( -
)44- .
,44. /
UltimoId55 
=55 
dt55 
.55  
Max55  #
(55# $
c55$ %
=>55& (
c55) *
.55* +
id_transaccion55+ 9
)559 :
}66 
)66 
.66 
SingleOrDefault66  
(66  !
)66! "
;66" #
return77 
Resumen77 
;77 
}99 
catch:: 
(:: 
	Exception:: 
e:: 
):: 
{;; 
throw<< 
new<< 
DatosException<< (
(<<( )
$str<<) T
,<<T U
e<<V W
)<<W X
;<<X Y
}== 
}>> 	
public?? 
OperationResult?? 4
(CrearTransaccionYModificarActorDeNegocio?? G
(??G H
Transaccion??H S
orden??T Y
,??Y Z
Actor_negocio??[ h
updmesa??i p
)??p q
{@@ 	
tryAA 
{BB 
OperationResultCC 
resultCC  &
=CC' (
newCC) ,
OperationResultCC- <
(CC< =
)CC= >
;CC> ?
_dbDD 
.DD 
TransaccionDD 
.DD  
AddDD  #
(DD# $
ordenDD$ )
)DD) *
;DD* +
Actor_negocioEE 
dbMesaEE $
=EE% &
_dbEE' *
.EE* +
Actor_negocioEE+ 8
.EE8 9
SingleOrDefaultEE9 H
(EEH I
mEEI J
=>EEK M
mEEN O
.EEO P
idEEP R
==EES U
updmesaEEV ]
.EE] ^
idEE^ `
)EE` a
;EEa b
_dbFF 
.FF 
EntryFF 
(FF 
dbMesaFF  
)FF  !
.FF! "
CurrentValuesFF" /
.FF/ 0
	SetValuesFF0 9
(FF9 :
updmesaFF: A
)FFA B
;FFB C
resultGG 
=GG 
SaveGG 
(GG 
)GG 
;GG  
resultHH 
.HH 
dataHH 
=HH 
(HH 
longHH #
)HH# $
ordenHH$ )
.HH) * 
id_transaccion_padreHH* >
;HH> ?
resultII 
.II 
messageII 
=II  
ordenII! &
.II& '
idII' )
.II) *
ToStringII* 2
(II2 3
)II3 4
;II4 5
returnJJ 
resultJJ 
;JJ 
}KK 
catchLL 
(LL 
	ExceptionLL 
eLL 
)LL 
{MM 
throwNN 
eNN 
;NN 
}OO 
}PP 	
publicQQ 
OperationResultQQ 0
$CrearTransaccionYCrearActorDeNegocioQQ C
(QQC D
TransaccionQQD O
ordenQQP U
,QQU V
Actor_negocioQQW d
mesaQQe i
)QQi j
{RR 	
trySS 
{TT 
OperationResultUU 
resultUU  &
=UU' (
newUU) ,
OperationResultUU- <
(UU< =
)UU= >
;UU> ?
_dbVV 
.VV 
TransaccionVV 
.VV  
AddVV  #
(VV# $
ordenVV$ )
)VV) *
;VV* +
_dbWW 
.WW 
Actor_negocioWW !
.WW! "
AddWW" %
(WW% &
mesaWW& *
)WW* +
;WW+ ,
resultXX 
=XX 
SaveXX 
(XX 
)XX 
;XX  
resultYY 
.YY 
dataYY 
=YY 
(YY 
longYY #
)YY# $
ordenYY$ )
.YY) * 
id_transaccion_padreYY* >
;YY> ?
resultZZ 
.ZZ 
messageZZ 
=ZZ  
ordenZZ! &
.ZZ& '
idZZ' )
.ZZ) *
ToStringZZ* 2
(ZZ2 3
)ZZ3 4
;ZZ4 5
return[[ 
result[[ 
;[[ 
}\\ 
catch]] 
(]] 
	Exception]] 
e]] 
)]] 
{^^ 
throw__ 
e__ 
;__ 
}`` 
}aa 	
publicbb #
Transaccion_consolidadabb &,
 ObtenerResumenTransaccionesEntrebb' G
(bbG H
intbbH K
idTipoTransaccionbbL ]
,bb] ^
intbb_ b
idUltimoEstadobbc q
,bbq r
DateTimebbs {
fechaInicio	bb| á
,
bbá à
DateTime
bbâ ë
fechaFin
bbí ö
,
bbö õ
int
bbú ü
idSerie
bb† ß
,
bbß ®
long
bb© ≠
idMinimo
bbÆ ∂
,
bb∂ ∑
long
bb∏ º
idMaximo
bbΩ ≈
)
bb≈ ∆
{cc 	
trydd 
{ee 
varff 
Resumenff 
=ff 
_dbff !
.ff! "
Transaccionff" -
.ff- .
Whereff. 3
(ff3 4
sbtff4 7
=>ff8 :
sbtff; >
.ff> ?
id_tipo_transaccionff? R
==ffS U
idTipoTransaccionffV g
&&gg 
sbtgg 
.gg 
Comprobantegg "
.gg" # 
id_serie_comprobantegg# 7
==gg8 :
idSeriegg; B
&&hh 
sbthh 
.hh 
fecha_iniciohh #
>=hh$ &
fechaIniciohh' 2
&&hh3 5
sbthh6 9
.hh9 :
fecha_iniciohh: F
<=hhG I
fechaFinhhJ R
&&ii 
sbtii 
.ii 
id_estado_actualii '
==ii( *
idUltimoEstadoii+ 9
&&jj 
sbtjj 
.jj 
idjj 
>jj 
idMinimojj $
&&jj% '
sbtjj( +
.jj+ ,
idjj, .
<jj/ 0
idMaximojj1 9
)jj9 :
.kk 

SelectManykk 
(kk 
tkk 
=>kk  
tkk! "
.kk" #
Detalle_transaccionkk# 6
)kk6 7
.kk7 8
GroupByll 
(ll 
dtll 
=>ll 
newll 
{mm 
Fechann 
=nn 
newnn 
{nn 
ynn  !
=nn" #
dtnn$ &
.nn& '
Transaccionnn' 2
.nn2 3
fecha_inicionn3 ?
.nn? @
Yearnn@ D
,nnD E
mnnF G
=nnH I
dtnnJ L
.nnL M
TransaccionnnM X
.nnX Y
fecha_inicionnY e
.nne f
Monthnnf k
,nnk l
dnnm n
=nno p
dtnnq s
.nns t
Transaccionnnt 
.	nn Ä
fecha_inicio
nnÄ å
.
nnå ç
Day
nnç ê
}
nnë í
,
nní ì
CodigoComprobantepp #
=pp$ %
dtpp& (
.pp( )
Transaccionpp) 4
.pp4 5
Comprobantepp5 @
.pp@ A
Detalle_maestroppA P
.ppP Q
codigoppQ W
,ppW X
dtqq 
.qq 
Transaccionqq  
.qq  !
Comprobanteqq! ,
.qq, - 
id_serie_comprobanteqq- A
,qqA B
dtrr 
.rr 
Transaccionrr  
.rr  !
Comprobanterr! ,
.rr, -
numero_serierr- 9
}tt 
)tt 
.tt 
Selecttt 
(tt 
dttt 
=>tt 
newtt !#
Transaccion_consolidadatt" 9
(tt9 :
)tt: ;
{uu 
Anyovv 
=vv 
dtvv 
.vv 
Keyvv 
.vv  
Fechavv  %
.vv% &
yvv& '
,vv' (
Mesww 
=ww 
dtww 
.ww 
Keyww 
.ww 
Fechaww $
.ww$ %
mww% &
,ww& '
Diaxx 
=xx 
dtxx 
.xx 
Keyxx 
.xx 
Fechaxx $
.xx$ %
dxx% &
,xx& '!
CodigoTipoComprobanteyy '
=yy( )
dtyy* ,
.yy, -
Keyyy- 0
.yy0 1
CodigoComprobanteyy1 B
,yyB C
IdSeriezz 
=zz 
dtzz 
.zz 
Keyzz "
.zz" # 
id_serie_comprobantezz# 7
,zz7 8
Serie{{ 
={{ 
dt{{ 
.{{ 
Key{{  
.{{  !
numero_serie{{! -
,{{- .
NumeroInicial|| 
=||  !
(||" #
int||# &
)||& '
dt||' )
.||) *
Min||* -
(||- .
m||. /
=>||0 2
m||3 4
.||4 5
Transaccion||5 @
.||@ A
Comprobante||A L
.||L M
numero||M S
)||S T
,||T U
NumeroFinal}} 
=}} 
(}}  !
int}}! $
)}}$ %
dt}}% '
.}}' (
Max}}( +
(}}+ ,
m}}, -
=>}}. 0
m}}1 2
.}}2 3
Transaccion}}3 >
.}}> ?
Comprobante}}? J
.}}J K
numero}}K Q
)}}Q R
,}}R S
IGV~~ 
=~~ 
dt~~ 
.~~ 
Sum~~ 
(~~ 
c~~  
=>~~! #
(~~$ %
decimal~~% ,
)~~, -
c~~- .
.~~. /
igv~~/ 2
)~~2 3
,~~3 4
Total 
= 
dt 
. 
Sum  
(  !
c! "
=># %
c& '
.' (
total( -
)- .
,. /
UltimoId
ÄÄ 
=
ÄÄ 
dt
ÄÄ 
.
ÄÄ  
Max
ÄÄ  #
(
ÄÄ# $
c
ÄÄ$ %
=>
ÄÄ& (
c
ÄÄ) *
.
ÄÄ* +
id_transaccion
ÄÄ+ 9
)
ÄÄ9 :
}
ÅÅ 
)
ÅÅ 
.
ÅÅ 
SingleOrDefault
ÅÅ  
(
ÅÅ  !
)
ÅÅ! "
;
ÅÅ" #
return
ÇÇ 
Resumen
ÇÇ 
;
ÇÇ 
}
ÑÑ 
catch
ÖÖ 
(
ÖÖ 
	Exception
ÖÖ 
e
ÖÖ 
)
ÖÖ 
{
ÜÜ 
throw
áá 
new
áá 
DatosException
áá (
(
áá( )
$str
áá) T
,
ááT U
e
ááV W
)
ááW X
;
ááX Y
}
ââ 
}
ää 	
public
åå 
long
åå )
ObtenerIdPrimeraTransaccion
åå /
(
åå/ 0
int
åå0 3
[
åå3 4
]
åå4 5 
idsTipoTransaccion
åå6 H
,
ååH I
int
ååJ M
[
ååM N
]
ååN O"
idsTiposComprobantes
ååP d
,
ååd e
int
ååf i%
idEstadoActualSiExisteååj Ä
,ååÄ Å
intååÇ Ö'
idEstadoAnteriorOActualååÜ ù
,ååù û
DateTimeååü ß!
fechaEmisionDesdeåå® π
,ååπ ∫
DateTimeååª √!
fechaEmisionHastaååƒ ’
,åå’ ÷
intåå◊ ⁄
idSerieåå€ ‚
)åå‚ „
{
çç 	
try
éé 
{
èè 
var
êê 
	resultado
êê 
=
êê 
_db
êê  #
.
êê# $
Transaccion
êê$ /
.
ëë 
Where
ëë 
(
ëë 
t
ëë 
=>
ëë  
idsTipoTransaccion
íí &
.
íí& '
Contains
íí' /
(
íí/ 0
t
íí0 1
.
íí1 2!
id_tipo_transaccion
íí2 E
)
ííE F
&&
ìì 
t
ìì 
.
ìì 
Comprobante
ìì $
.
ìì$ %"
id_serie_comprobante
ìì% 9
==
ìì: <
idSerie
ìì= D
&&
îî 
t
îî 
.
îî 
fecha_inicio
îî %
>=
îî& (
fechaEmisionDesde
îî) :
&&
ïï 
t
ïï 
.
ïï 
fecha_inicio
ïï %
<=
ïï& (
fechaEmisionHasta
ïï) :
)
úú 
.
úú 
Min
úú 
(
úú 
t
úú 
=>
úú 
t
úú  
.
úú  !
id_comprobante
úú! /
)
úú/ 0
;
úú0 1
return
ùù 
	resultado
ùù  
!=
ùù! #
null
ùù$ (
?
ùù) *
	resultado
ùù+ 4
:
ùù5 6
$num
ùù7 8
;
ùù8 9
}
ûû 
catch
üü 
(
üü 
	Exception
üü 
e
üü 
)
üü 
{
†† 
throw
°° 
new
°° 
DatosException
°° (
(
°°( )
$str
°°) X
,
°°X Y
e
°°Z [
)
°°[ \
;
°°\ ]
}
¢¢ 
}
££ 	
public
•• 
long
•• (
ObtenerIdUltimaTransaccion
•• .
(
••. /
int
••/ 2
[
••2 3
]
••3 4 
idsTipoTransaccion
••5 G
,
••G H
int
••I L
[
••L M
]
••M N"
idsTiposComprobantes
••O c
,
••c d
int
••e h$
idEstadoActualSiExiste
••i 
,•• Ä
int••Å Ñ'
idEstadoAnteriorOActual••Ö ú
,••ú ù
DateTime••û ¶!
fechaEmisionDesde••ß ∏
,••∏ π
DateTime••∫ ¬!
fechaEmisionHasta••√ ‘
,••‘ ’
int••÷ Ÿ
idSerie••⁄ ·
)••· ‚
{
¶¶ 	
try
ßß 
{
®® 
var
©© 
	resultado
©© 
=
©© 
_db
©©  #
.
©©# $
Transaccion
©©$ /
.
™™ 
Where
™™ 
(
™™ 
t
™™ 
=>
™™   
idsTipoTransaccion
´´ '
.
´´' (
Contains
´´( 0
(
´´0 1
t
´´1 2
.
´´2 3!
id_tipo_transaccion
´´3 F
)
´´F G
&&
¨¨ 
t
¨¨ 
.
¨¨ 
Comprobante
¨¨ %
.
¨¨% &"
id_serie_comprobante
¨¨& :
==
¨¨; =
idSerie
¨¨> E
&&
≠≠ 
t
≠≠ 
.
≠≠ 
fecha_inicio
≠≠ &
>=
≠≠' )
fechaEmisionDesde
≠≠* ;
&&
ÆÆ 
t
ÆÆ 
.
ÆÆ 
fecha_inicio
ÆÆ &
<=
ÆÆ' )
fechaEmisionHasta
ÆÆ* ;
)
µµ 
.
µµ 
Max
µµ 
(
µµ 
t
µµ 
=>
µµ 
t
µµ  !
.
µµ! "
id_comprobante
µµ" 0
)
µµ0 1
;
µµ1 2
return
∂∂ 
	resultado
∂∂  
!=
∂∂! #
null
∂∂$ (
?
∂∂) *
Convert
∂∂+ 2
.
∂∂2 3
ToInt64
∂∂3 :
(
∂∂: ;
	resultado
∂∂; D
)
∂∂D E
:
∂∂F G
$num
∂∂H I
;
∂∂I J
}
∑∑ 
catch
∏∏ 
(
∏∏ 
	Exception
∏∏ 
e
∏∏ 
)
∏∏ 
{
ππ 
throw
∫∫ 
new
∫∫ 
DatosException
∫∫ (
(
∫∫( )
$str
∫∫) W
,
∫∫W X
e
∫∫Y Z
)
∫∫Z [
;
∫∫[ \
}
ªª 
}
ºº 	
public
¿¿ 
long
¿¿ :
,ObtenerNumeroDeComprobantePrimeraTransaccion
¿¿ @
(
¿¿@ A
int
¿¿A D
[
¿¿D E
]
¿¿E F 
idsTipoTransaccion
¿¿G Y
,
¿¿Y Z
int
¿¿[ ^
[
¿¿^ _
]
¿¿_ `"
idsTiposComprobantes
¿¿a u
,
¿¿u v
int
¿¿w z
idUltimoEstado¿¿{ â
,¿¿â ä
DateTime¿¿ã ì!
fechaEmisionDesde¿¿î •
,¿¿• ¶
DateTime¿¿ß Ø!
fechaEmisionHasta¿¿∞ ¡
,¿¿¡ ¬
int¿¿√ ∆
idSerie¿¿« Œ
)¿¿Œ œ
{
¡¡ 	
try
¬¬ 
{
√√ 
var
ƒƒ 
	resultado
ƒƒ 
=
ƒƒ 
_db
ƒƒ  #
.
ƒƒ# $
Transaccion
ƒƒ$ /
.
≈≈ 
Where
≈≈ 
(
≈≈ 
t
≈≈ 
=>
≈≈  
idsTipoTransaccion
∆∆ &
.
∆∆& '
Contains
∆∆' /
(
∆∆/ 0
t
∆∆0 1
.
∆∆1 2!
id_tipo_transaccion
∆∆2 E
)
∆∆E F
&&
«« 
t
«« 
.
«« 
Comprobante
«« $
.
««$ %"
id_serie_comprobante
««% 9
==
««: <
idSerie
««= D
&&
»» 
t
»» 
.
»» 
fecha_inicio
»» %
>=
»»& (
fechaEmisionDesde
»») :
&&
…… 
t
…… 
.
…… 
fecha_inicio
…… %
<=
……& (
fechaEmisionHasta
……) :
&&
   
t
   
.
   
id_estado_actual
   )
==
  * ,
idUltimoEstado
  - ;
)
ÀÀ 
.
ÀÀ 
OrderBy
ÀÀ 
(
ÀÀ 
t
ÀÀ 
=>
ÀÀ  "
t
ÀÀ# $
.
ÀÀ$ %
Comprobante
ÀÀ% 0
.
ÀÀ0 1
numero
ÀÀ1 7
)
ÀÀ7 8
.
ÀÀ8 9
FirstOrDefault
ÀÀ9 G
(
ÀÀG H
)
ÀÀH I
;
ÀÀI J
return
ÃÃ 
	resultado
ÃÃ  
!=
ÃÃ! #
null
ÃÃ$ (
?
ÃÃ) *
	resultado
ÃÃ+ 4
.
ÃÃ4 5
Comprobante
ÃÃ5 @
.
ÃÃ@ A
numero
ÃÃA G
:
ÃÃH I
$num
ÃÃJ K
;
ÃÃK L
}
ÕÕ 
catch
ŒŒ 
(
ŒŒ 
	Exception
ŒŒ 
e
ŒŒ 
)
ŒŒ 
{
œœ 
throw
–– 
new
–– 
DatosException
–– (
(
––( )
$str
––) n
,
––n o
e
––p q
)
––q r
;
––r s
}
—— 
}
““ 	
public
‘‘ 
long
‘‘ 9
+ObtenerNumeroDeComprobanteUltimaTransaccion
‘‘ ?
(
‘‘? @
int
‘‘@ C
[
‘‘C D
]
‘‘D E 
idsTipoTransaccion
‘‘F X
,
‘‘X Y
int
‘‘Z ]
[
‘‘] ^
]
‘‘^ _"
idsTiposComprobantes
‘‘` t
,
‘‘t u
int
‘‘v y
idUltimoEstado‘‘z à
,‘‘à â
DateTime‘‘ä í!
fechaEmisionDesde‘‘ì §
,‘‘§ •
DateTime‘‘¶ Æ!
fechaEmisionHasta‘‘Ø ¿
,‘‘¿ ¡
int‘‘¬ ≈
idSerie‘‘∆ Õ
)‘‘Õ Œ
{
’’ 	
try
÷÷ 
{
◊◊ 
var
ÿÿ 
	resultado
ÿÿ 
=
ÿÿ 
_db
ÿÿ  #
.
ÿÿ# $
Transaccion
ÿÿ$ /
.
ŸŸ 
Where
ŸŸ 
(
ŸŸ 
t
ŸŸ 
=>
ŸŸ   
idsTipoTransaccion
⁄⁄ '
.
⁄⁄' (
Contains
⁄⁄( 0
(
⁄⁄0 1
t
⁄⁄1 2
.
⁄⁄2 3!
id_tipo_transaccion
⁄⁄3 F
)
⁄⁄F G
&&
€€ 
t
€€ 
.
€€ 
Comprobante
€€ %
.
€€% &"
id_serie_comprobante
€€& :
==
€€; =
idSerie
€€> E
&&
‹‹ 
t
‹‹ 
.
‹‹ 
fecha_inicio
‹‹ &
>=
‹‹' )
fechaEmisionDesde
‹‹* ;
&&
›› 
t
›› 
.
›› 
fecha_inicio
›› &
<=
››' )
fechaEmisionHasta
››* ;
&&
ﬁﬁ 
t
ﬁﬁ 
.
ﬁﬁ 
id_estado_actual
ﬁﬁ *
==
ﬁﬁ+ -
idUltimoEstado
ﬁﬁ. <
)
ﬂﬂ 
.
ﬂﬂ 
OrderByDescending
ﬂﬂ '
(
ﬂﬂ' (
t
ﬂﬂ( )
=>
ﬂﬂ* ,
t
ﬂﬂ- .
.
ﬂﬂ. /
Comprobante
ﬂﬂ/ :
.
ﬂﬂ: ;
numero
ﬂﬂ; A
)
ﬂﬂA B
.
ﬂﬂB C
FirstOrDefault
ﬂﬂC Q
(
ﬂﬂQ R
)
ﬂﬂR S
;
ﬂﬂS T
return
‡‡ 
	resultado
‡‡  
!=
‡‡! #
null
‡‡$ (
?
‡‡) *
	resultado
‡‡+ 4
.
‡‡4 5
Comprobante
‡‡5 @
.
‡‡@ A
numero
‡‡A G
:
‡‡H I
$num
‡‡J K
;
‡‡K L
}
·· 
catch
‚‚ 
(
‚‚ 
	Exception
‚‚ 
e
‚‚ 
)
‚‚ 
{
„„ 
throw
‰‰ 
new
‰‰ 
DatosException
‰‰ (
(
‰‰( )
$str
‰‰) m
,
‰‰m n
e
‰‰o p
)
‰‰p q
;
‰‰q r
}
ÂÂ 
}
ÊÊ 	
public
ÏÏ 
IEnumerable
ÏÏ 
<
ÏÏ %
Transaccion_consolidada
ÏÏ 2
>
ÏÏ2 3F
8ObtenerTransaccionesConsolidadasEntreNumeroDeComprobante
ÏÏ4 l
(
ÏÏl m
int
ÏÏm p 
idTipoTransaccionÏÏq Ç
,ÏÏÇ É
intÏÏÑ á
idUltimoEstadoÏÏà ñ
,ÏÏñ ó
intÏÏò õ
idSerieÏÏú £
,ÏÏ£ §
longÏÏ• ©
numeroMinimoÏÏ™ ∂
,ÏÏ∂ ∑
longÏÏ∏ º
numeroMaximoÏÏΩ …
)ÏÏ…  
{
ÌÌ 	
try
ÓÓ 
{
ÔÔ 
var
 
transacciones
 !
=
" #
_db
$ '
.
' (
Transaccion
( 3
.
3 4
Where
4 9
(
9 :
t
: ;
=>
< >
t
ÒÒ 
.
ÒÒ !
id_tipo_transaccion
ÒÒ &
==
ÒÒ' )
idTipoTransaccion
ÒÒ* ;
&&
ÚÚ 
t
ÚÚ 
.
ÚÚ 
Comprobante
ÚÚ  
.
ÚÚ  !"
id_serie_comprobante
ÚÚ! 5
==
ÚÚ6 8
idSerie
ÚÚ9 @
&&
ÛÛ 
t
ÛÛ 
.
ÛÛ 
Comprobante
ÛÛ  
.
ÛÛ  !
numero
ÛÛ! '
>
ÛÛ( )
numeroMinimo
ÛÛ* 6
&&
ÛÛ7 9
t
ÛÛ: ;
.
ÛÛ; <
Comprobante
ÛÛ< G
.
ÛÛG H
numero
ÛÛH N
<
ÛÛO P
numeroMaximo
ÛÛQ ]
&&
ÙÙ 
t
ÙÙ 
.
ÙÙ 
id_estado_actual
ÙÙ %
==
ÙÙ& (
idUltimoEstado
ÙÙ) 7
)
ÙÙ7 8
.
ıı 
Select
ıı 
(
ıı 
t
ıı 
=>
ıı  
new
ıı! $
{
ˆˆ 
Anyo
˜˜ 
=
˜˜ 
t
˜˜  
.
˜˜  !
fecha_inicio
˜˜! -
.
˜˜- .
Year
˜˜. 2
,
˜˜2 3
Mes
¯¯ 
=
¯¯ 
t
¯¯ 
.
¯¯  
fecha_inicio
¯¯  ,
.
¯¯, -
Month
¯¯- 2
,
¯¯2 3
Dia
˘˘ 
=
˘˘ 
t
˘˘ 
.
˘˘  
fecha_inicio
˘˘  ,
.
˘˘, -
Day
˘˘- 0
,
˘˘0 1
IdComprobante
˙˙ %
=
˙˙& '
t
˙˙( )
.
˙˙) *
Comprobante
˙˙* 5
.
˙˙5 6
id
˙˙6 8
,
˙˙8 9#
CodigoTipoComprobante
˚˚ -
=
˚˚. /
t
˚˚0 1
.
˚˚1 2
Comprobante
˚˚2 =
.
˚˚= >
Detalle_maestro
˚˚> M
.
˚˚M N
codigo
˚˚N T
,
˚˚T U
IdSerie
¸¸ 
=
¸¸  !
t
¸¸" #
.
¸¸# $
Comprobante
¸¸$ /
.
¸¸/ 0"
id_serie_comprobante
¸¸0 D
,
¸¸D E
Serie
˝˝ 
=
˝˝ 
t
˝˝  !
.
˝˝! "
Comprobante
˝˝" -
.
˝˝- .
numero_serie
˝˝. :
,
˝˝: ;!
NumeroDeComprobante
˛˛ +
=
˛˛, -
t
˛˛. /
.
˛˛/ 0
Comprobante
˛˛0 ;
.
˛˛; <
numero
˛˛< B
,
˛˛B C
IGV
ˇˇ 
=
ˇˇ 
t
ˇˇ 
.
ˇˇ  !
Detalle_transaccion
ˇˇ  3
.
ˇˇ3 4
Sum
ˇˇ4 7
(
ˇˇ7 8
tt
ˇˇ8 :
=>
ˇˇ; =
(
ˇˇ> ?
decimal
ˇˇ? F
)
ˇˇF G
tt
ˇˇG I
.
ˇˇI J
igv
ˇˇJ M
)
ˇˇM N
,
ˇˇN O
Total
ÄÄ 
=
ÄÄ 
t
ÄÄ  !
.
ÄÄ! "
importe_total
ÄÄ" /
,
ÄÄ/ 0
CodigoMoneda
ÅÅ $
=
ÅÅ% &
t
ÅÅ' (
.
ÅÅ( )
Detalle_maestro1
ÅÅ) 9
.
ÅÅ9 :
codigo
ÅÅ: @
,
ÅÅ@ A

TipoCambio
ÇÇ "
=
ÇÇ# $
t
ÇÇ% &
.
ÇÇ& '
tipo_cambio
ÇÇ' 2
}
ÑÑ 
)
ÑÑ 
.
ÑÑ 
ToList
ÑÑ 
(
ÑÑ 
)
ÑÑ 
;
ÑÑ  
var
ÜÜ 
resumen
ÜÜ 
=
ÜÜ 
transacciones
ÜÜ +
.
áá 
GroupBy
áá 
(
áá 
g
áá 
=>
áá !
new
áá" %
{
àà 
Fecha
ââ 
=
ââ 
new
ââ  #
{
ââ$ %
y
ââ& '
=
ââ( )
g
ââ* +
.
ââ+ ,
Anyo
ââ, 0
,
ââ0 1
m
ââ2 3
=
ââ4 5
g
ââ6 7
.
ââ7 8
Mes
ââ8 ;
,
ââ; <
d
ââ= >
=
ââ? @
g
ââA B
.
ââB C
Dia
ââC F
}
ââG H
,
ââH I
g
ää 
.
ää #
CodigoTipoComprobante
ää /
,
ää/ 0
g
ãã 
.
ãã 
IdSerie
ãã !
,
ãã! "
g
åå 
.
åå 
Serie
åå 
,
åå  
g
çç 
.
çç 
CodigoMoneda
çç &
}
éé 
)
éé 
.
éé 
Select
éé 
(
éé 
t
éé 
=>
éé  "
new
éé# &%
Transaccion_consolidada
éé' >
(
éé> ?
)
éé? @
{
èè 
Anyo
êê 
=
êê 
t
êê  
.
êê  !
Key
êê! $
.
êê$ %
Fecha
êê% *
.
êê* +
y
êê+ ,
,
êê, -
Mes
ëë 
=
ëë 
t
ëë 
.
ëë  
Key
ëë  #
.
ëë# $
Fecha
ëë$ )
.
ëë) *
m
ëë* +
,
ëë+ ,
Dia
íí 
=
íí 
t
íí 
.
íí  
Key
íí  #
.
íí# $
Fecha
íí$ )
.
íí) *
d
íí* +
,
íí+ ,#
CodigoTipoComprobante
ìì -
=
ìì. /
t
ìì0 1
.
ìì1 2
Key
ìì2 5
.
ìì5 6#
CodigoTipoComprobante
ìì6 K
,
ììK L
IdSerie
îî 
=
îî  !
t
îî" #
.
îî# $
Key
îî$ '
.
îî' (
IdSerie
îî( /
,
îî/ 0
Serie
ïï 
=
ïï 
t
ïï  !
.
ïï! "
Key
ïï" %
.
ïï% &
Serie
ïï& +
,
ïï+ ,
NumeroInicial
ññ %
=
ññ& '
(
ññ( )
int
ññ) ,
)
ññ, -
t
ññ- .
.
ññ. /
Min
ññ/ 2
(
ññ2 3
m
ññ3 4
=>
ññ5 7
m
ññ8 9
.
ññ9 :!
NumeroDeComprobante
ññ: M
)
ññM N
,
ññN O
NumeroFinal
óó #
=
óó$ %
(
óó& '
int
óó' *
)
óó* +
t
óó+ ,
.
óó, -
Max
óó- 0
(
óó0 1
m
óó1 2
=>
óó3 5
m
óó6 7
.
óó7 8!
NumeroDeComprobante
óó8 K
)
óóK L
,
óóL M
IGV
òò 
=
òò 
t
òò 
.
òò  
Sum
òò  #
(
òò# $
tt
òò$ &
=>
òò' )
(
òò* +
decimal
òò+ 2
)
òò2 3
tt
òò3 5
.
òò5 6
IGV
òò6 9
)
òò9 :
,
òò: ;
Total
ôô 
=
ôô 
t
ôô  !
.
ôô! "
Sum
ôô" %
(
ôô% &
tt
ôô& (
=>
ôô) +
tt
ôô, .
.
ôô. /
Total
ôô/ 4
)
ôô4 5
,
ôô5 6
CodigoMoneda
öö $
=
öö% &
t
öö' (
.
öö( )
Key
öö) ,
.
öö, -
CodigoMoneda
öö- 9
,
öö9 :

TipoCambio
õõ "
=
õõ# $
t
õõ% &
.
õõ& '
FirstOrDefault
õõ' 5
(
õõ5 6
)
õõ6 7
.
õõ7 8

TipoCambio
õõ8 B
,
õõB C
UltimoId
úú  
=
úú! "
t
úú# $
.
úú$ %
Max
úú% (
(
úú( )
tt
úú) +
=>
úú, .
tt
úú/ 1
.
úú1 2
IdComprobante
úú2 ?
)
úú? @
,
úú@ A
}
üü 
)
üü 
.
üü 
ToList
üü 
(
üü 
)
üü 
.
üü  
OrderBy
üü  '
(
üü' (
t
üü( )
=>
üü* ,
t
üü- .
.
üü. /
FechaEmision
üü/ ;
)
üü; <
.
üü< =
ThenBy
üü= C
(
üüC D
t
üüD E
=>
üüF H
t
üüI J
.
üüJ K
Serie
üüK P
)
üüP Q
;
üüQ R
return
°° 
resumen
°° 
;
°° 
}
¢¢ 
catch
££ 
(
££ 
	Exception
££ 
e
££ 
)
££ 
{
§§ 
throw
•• 
new
•• 
DatosException
•• (
(
••( )
$str
••) T
,
••T U
e
••V W
)
••W X
;
••X Y
}
¶¶ 
}
´´ 	
public
≠≠ 
IEnumerable
≠≠ 
<
≠≠ %
Transaccion_consolidada
≠≠ 2
>
≠≠2 3P
BObtenerTransaccionesConsolidadasEntreNumeroDeComprobantefechaHasta
≠≠4 v
(
≠≠v w
int
≠≠w z 
idTipoTransaccion≠≠{ å
,≠≠å ç
int≠≠é ë
idUltimoEstado≠≠í †
,≠≠† °
int≠≠¢ •
idSerie≠≠¶ ≠
,≠≠≠ Æ
long≠≠Ø ≥
numeroMinimo≠≠¥ ¿
,≠≠¿ ¡
long≠≠¬ ∆
numeroMaximo≠≠« ”
,≠≠” ‘
DateTime≠≠’ ›

fechaDesde≠≠ﬁ Ë
,≠≠Ë È
DateTime≠≠Í Ú

fechaHasta≠≠Û ˝
)≠≠˝ ˛
{
ÆÆ 	
try
ØØ 
{
∞∞ 
var
±± 
transacciones
±± !
=
±±" #
_db
±±$ '
.
±±' (
Transaccion
±±( 3
.
±±3 4
Where
±±4 9
(
±±9 :
t
±±: ;
=>
±±< >
t
≤≤ 
.
≤≤ 
fecha_inicio
≤≤ 
>=
≤≤ !

fechaDesde
≤≤" ,
&&
≤≤- /
t
≤≤0 1
.
≤≤1 2
fecha_inicio
≤≤2 >
<=
≤≤? A

fechaHasta
≤≤B L
&&
≥≥ 
t
≥≥ 
.
≥≥ !
id_tipo_transaccion
≥≥ (
==
≥≥) +
idTipoTransaccion
≥≥, =
&&
¥¥ 
t
¥¥ 
.
¥¥ 
Comprobante
¥¥  
.
¥¥  !"
id_serie_comprobante
¥¥! 5
==
¥¥6 8
idSerie
¥¥9 @
&&
µµ 
t
µµ 
.
µµ 
Comprobante
µµ  
.
µµ  !
numero
µµ! '
>
µµ( )
numeroMinimo
µµ* 6
&&
µµ7 9
t
µµ: ;
.
µµ; <
Comprobante
µµ< G
.
µµG H
numero
µµH N
<
µµO P
numeroMaximo
µµQ ]
&&
∂∂ 
t
∂∂ 
.
∂∂ 
id_estado_actual
∂∂ %
==
∂∂& (
idUltimoEstado
∂∂) 7
)
∂∂7 8
.
∑∑ 
Select
∑∑ 
(
∑∑ 
t
∑∑ 
=>
∑∑  
new
∑∑! $
{
∏∏ 
Anyo
ππ 
=
ππ 
t
ππ  
.
ππ  !
fecha_inicio
ππ! -
.
ππ- .
Year
ππ. 2
,
ππ2 3
Mes
∫∫ 
=
∫∫ 
t
∫∫ 
.
∫∫  
fecha_inicio
∫∫  ,
.
∫∫, -
Month
∫∫- 2
,
∫∫2 3
Dia
ªª 
=
ªª 
t
ªª 
.
ªª  
fecha_inicio
ªª  ,
.
ªª, -
Day
ªª- 0
,
ªª0 1
IdComprobante
ºº %
=
ºº& '
t
ºº( )
.
ºº) *
Comprobante
ºº* 5
.
ºº5 6
id
ºº6 8
,
ºº8 9#
CodigoTipoComprobante
ΩΩ -
=
ΩΩ. /
t
ΩΩ0 1
.
ΩΩ1 2
Comprobante
ΩΩ2 =
.
ΩΩ= >
Detalle_maestro
ΩΩ> M
.
ΩΩM N
codigo
ΩΩN T
,
ΩΩT U
IdSerie
ææ 
=
ææ  !
t
ææ" #
.
ææ# $
Comprobante
ææ$ /
.
ææ/ 0"
id_serie_comprobante
ææ0 D
,
ææD E
Serie
øø 
=
øø 
t
øø  !
.
øø! "
Comprobante
øø" -
.
øø- .
numero_serie
øø. :
,
øø: ;!
NumeroDeComprobante
¿¿ +
=
¿¿, -
t
¿¿. /
.
¿¿/ 0
Comprobante
¿¿0 ;
.
¿¿; <
numero
¿¿< B
,
¿¿B C
IGV
¡¡ 
=
¡¡ 
t
¡¡ 
.
¡¡  !
Detalle_transaccion
¡¡  3
.
¡¡3 4
Sum
¡¡4 7
(
¡¡7 8
tt
¡¡8 :
=>
¡¡; =
(
¡¡> ?
decimal
¡¡? F
)
¡¡F G
tt
¡¡G I
.
¡¡I J
igv
¡¡J M
)
¡¡M N
,
¡¡N O
Total
¬¬ 
=
¬¬ 
t
¬¬  !
.
¬¬! "
importe_total
¬¬" /
,
¬¬/ 0
CodigoMoneda
√√ $
=
√√% &
t
√√' (
.
√√( )
Detalle_maestro1
√√) 9
.
√√9 :
codigo
√√: @
,
√√@ A

TipoCambio
ƒƒ "
=
ƒƒ# $
t
ƒƒ% &
.
ƒƒ& '
tipo_cambio
ƒƒ' 2
}
∆∆ 
)
∆∆ 
.
∆∆ 
ToList
∆∆ 
(
∆∆ 
)
∆∆ 
;
∆∆  
var
»» 
resumen
»» 
=
»» 
transacciones
»» +
.
…… 
GroupBy
…… 
(
…… 
g
…… 
=>
…… !
new
……" %
{
   
Fecha
ÀÀ 
=
ÀÀ 
new
ÀÀ  #
{
ÀÀ$ %
y
ÀÀ& '
=
ÀÀ( )
g
ÀÀ* +
.
ÀÀ+ ,
Anyo
ÀÀ, 0
,
ÀÀ0 1
m
ÀÀ2 3
=
ÀÀ4 5
g
ÀÀ6 7
.
ÀÀ7 8
Mes
ÀÀ8 ;
,
ÀÀ; <
d
ÀÀ= >
=
ÀÀ? @
g
ÀÀA B
.
ÀÀB C
Dia
ÀÀC F
}
ÀÀG H
,
ÀÀH I
g
ÃÃ 
.
ÃÃ #
CodigoTipoComprobante
ÃÃ /
,
ÃÃ/ 0
g
ÕÕ 
.
ÕÕ 
IdSerie
ÕÕ !
,
ÕÕ! "
g
ŒŒ 
.
ŒŒ 
Serie
ŒŒ 
,
ŒŒ  
g
œœ 
.
œœ 
CodigoMoneda
œœ &
}
–– 
)
–– 
.
–– 
Select
–– 
(
–– 
t
–– 
=>
––  "
new
––# &%
Transaccion_consolidada
––' >
(
––> ?
)
––? @
{
—— 
Anyo
““ 
=
““ 
t
““  
.
““  !
Key
““! $
.
““$ %
Fecha
““% *
.
““* +
y
““+ ,
,
““, -
Mes
”” 
=
”” 
t
”” 
.
””  
Key
””  #
.
””# $
Fecha
””$ )
.
””) *
m
””* +
,
””+ ,
Dia
‘‘ 
=
‘‘ 
t
‘‘ 
.
‘‘  
Key
‘‘  #
.
‘‘# $
Fecha
‘‘$ )
.
‘‘) *
d
‘‘* +
,
‘‘+ ,#
CodigoTipoComprobante
’’ -
=
’’. /
t
’’0 1
.
’’1 2
Key
’’2 5
.
’’5 6#
CodigoTipoComprobante
’’6 K
,
’’K L
IdSerie
÷÷ 
=
÷÷  !
t
÷÷" #
.
÷÷# $
Key
÷÷$ '
.
÷÷' (
IdSerie
÷÷( /
,
÷÷/ 0
Serie
◊◊ 
=
◊◊ 
t
◊◊  !
.
◊◊! "
Key
◊◊" %
.
◊◊% &
Serie
◊◊& +
,
◊◊+ ,
NumeroInicial
ÿÿ %
=
ÿÿ& '
(
ÿÿ( )
int
ÿÿ) ,
)
ÿÿ, -
t
ÿÿ- .
.
ÿÿ. /
Min
ÿÿ/ 2
(
ÿÿ2 3
m
ÿÿ3 4
=>
ÿÿ5 7
m
ÿÿ8 9
.
ÿÿ9 :!
NumeroDeComprobante
ÿÿ: M
)
ÿÿM N
,
ÿÿN O
NumeroFinal
ŸŸ #
=
ŸŸ$ %
(
ŸŸ& '
int
ŸŸ' *
)
ŸŸ* +
t
ŸŸ+ ,
.
ŸŸ, -
Max
ŸŸ- 0
(
ŸŸ0 1
m
ŸŸ1 2
=>
ŸŸ3 5
m
ŸŸ6 7
.
ŸŸ7 8!
NumeroDeComprobante
ŸŸ8 K
)
ŸŸK L
,
ŸŸL M
IGV
⁄⁄ 
=
⁄⁄ 
t
⁄⁄ 
.
⁄⁄  
Sum
⁄⁄  #
(
⁄⁄# $
tt
⁄⁄$ &
=>
⁄⁄' )
(
⁄⁄* +
decimal
⁄⁄+ 2
)
⁄⁄2 3
tt
⁄⁄3 5
.
⁄⁄5 6
IGV
⁄⁄6 9
)
⁄⁄9 :
,
⁄⁄: ;
Total
€€ 
=
€€ 
t
€€  !
.
€€! "
Sum
€€" %
(
€€% &
tt
€€& (
=>
€€) +
tt
€€, .
.
€€. /
Total
€€/ 4
)
€€4 5
,
€€5 6
CodigoMoneda
‹‹ $
=
‹‹% &
t
‹‹' (
.
‹‹( )
Key
‹‹) ,
.
‹‹, -
CodigoMoneda
‹‹- 9
,
‹‹9 :

TipoCambio
›› "
=
››# $
t
››% &
.
››& '
FirstOrDefault
››' 5
(
››5 6
)
››6 7
.
››7 8

TipoCambio
››8 B
,
››B C
UltimoId
ﬁﬁ  
=
ﬁﬁ! "
t
ﬁﬁ# $
.
ﬁﬁ$ %
Max
ﬁﬁ% (
(
ﬁﬁ( )
tt
ﬁﬁ) +
=>
ﬁﬁ, .
tt
ﬁﬁ/ 1
.
ﬁﬁ1 2
IdComprobante
ﬁﬁ2 ?
)
ﬁﬁ? @
,
ﬁﬁ@ A
}
·· 
)
·· 
.
·· 
ToList
·· 
(
·· 
)
·· 
.
··  
OrderBy
··  '
(
··' (
t
··( )
=>
··* ,
t
··- .
.
··. /
FechaEmision
··/ ;
)
··; <
.
··< =
ThenBy
··= C
(
··C D
t
··D E
=>
··F H
t
··I J
.
··J K
Serie
··K P
)
··P Q
;
··Q R
return
„„ 
resumen
„„ 
;
„„ 
}
‰‰ 
catch
ÂÂ 
(
ÂÂ 
	Exception
ÂÂ 
e
ÂÂ 
)
ÂÂ 
{
ÊÊ 
throw
ÁÁ 
new
ÁÁ 
DatosException
ÁÁ (
(
ÁÁ( )
$str
ÁÁ) T
,
ÁÁT U
e
ÁÁV W
)
ÁÁW X
;
ÁÁX Y
}
ËË 
}
ÌÌ 	
public
ÒÒ 
IEnumerable
ÒÒ 
<
ÒÒ %
Transaccion_consolidada
ÒÒ 2
>
ÒÒ2 33
%ObtenerTransaccionesConsolidadasEntre
ÒÒ4 Y
(
ÒÒY Z
int
ÒÒZ ]
idTipoTransaccion
ÒÒ^ o
,
ÒÒo p
int
ÒÒq t
idUltimoEstadoÒÒu É
,ÒÒÉ Ñ
intÒÒÖ à
idSerieÒÒâ ê
,ÒÒê ë
longÒÒí ñ
idMinimoÒÒó ü
,ÒÒü †
longÒÒ° •
idMaximoÒÒ¶ Æ
)ÒÒÆ Ø
{
ÚÚ 	
try
ÛÛ 
{
ÙÙ 
var
ˆˆ 
Resumen
ˆˆ 
=
ˆˆ 
_db
ˆˆ !
.
ˆˆ! "
Transaccion
ˆˆ" -
.
ˆˆ- .
Where
ˆˆ. 3
(
ˆˆ3 4
sbt
ˆˆ4 7
=>
ˆˆ8 :
sbt
˜˜ 
.
˜˜ !
id_tipo_transaccion
˜˜ (
==
˜˜) +
idTipoTransaccion
˜˜, =
&&
¯¯ 
sbt
¯¯ 
.
¯¯ 
Comprobante
¯¯ "
.
¯¯" #"
id_serie_comprobante
¯¯# 7
==
¯¯8 :
idSerie
¯¯; B
&&
˘˘ 
sbt
˘˘ 
.
˘˘ 
id_comprobante
˘˘ %
>
˘˘& '
idMinimo
˘˘( 0
&&
˘˘1 3
sbt
˘˘4 7
.
˘˘7 8
id_comprobante
˘˘8 F
<
˘˘G H
idMaximo
˘˘I Q
&&
˙˙ 
sbt
˙˙ 
.
˙˙ 
id_estado_actual
˙˙ '
==
˙˙( *
idUltimoEstado
˙˙+ 9
)
˚˚ 
.
˚˚ 

SelectMany
˚˚ 
(
˚˚ 
t
˚˚ 
=>
˚˚ !
t
˚˚" #
.
˚˚# $!
Detalle_transaccion
˚˚$ 7
)
˚˚7 8
.
˚˚8 9
GroupBy
¸¸ 
(
¸¸ 
dt
¸¸ 
=>
¸¸ 
new
¸¸ 
{
˝˝ 
Fecha
˛˛ 
=
˛˛ 
new
˛˛ 
{
˛˛ 
y
˛˛  !
=
˛˛" #
dt
˛˛$ &
.
˛˛& '
Transaccion
˛˛' 2
.
˛˛2 3
fecha_inicio
˛˛3 ?
.
˛˛? @
Year
˛˛@ D
,
˛˛D E
m
˛˛F G
=
˛˛H I
dt
˛˛J L
.
˛˛L M
Transaccion
˛˛M X
.
˛˛X Y
fecha_inicio
˛˛Y e
.
˛˛e f
Month
˛˛f k
,
˛˛k l
d
˛˛m n
=
˛˛o p
dt
˛˛q s
.
˛˛s t
Transaccion
˛˛t 
.˛˛ Ä
fecha_inicio˛˛Ä å
.˛˛å ç
Day˛˛ç ê
}˛˛ë í
,˛˛í ì
CodigoComprobante
ÄÄ #
=
ÄÄ$ %
dt
ÄÄ& (
.
ÄÄ( )
Transaccion
ÄÄ) 4
.
ÄÄ4 5
Comprobante
ÄÄ5 @
.
ÄÄ@ A
Detalle_maestro
ÄÄA P
.
ÄÄP Q
codigo
ÄÄQ W
,
ÄÄW X
dt
ÅÅ 
.
ÅÅ 
Transaccion
ÅÅ  
.
ÅÅ  !
Comprobante
ÅÅ! ,
.
ÅÅ, -"
id_serie_comprobante
ÅÅ- A
,
ÅÅA B
dt
ÇÇ 
.
ÇÇ 
Transaccion
ÇÇ  
.
ÇÇ  !
Comprobante
ÇÇ! ,
.
ÇÇ, -
numero_serie
ÇÇ- 9
}
ÖÖ 
)
ÖÖ 
.
ÖÖ 
Select
ÖÖ 
(
ÖÖ 
dt
ÖÖ 
=>
ÖÖ 
new
ÖÖ !%
Transaccion_consolidada
ÖÖ" 9
(
ÖÖ9 :
)
ÖÖ: ;
{
ÜÜ 
Anyo
áá 
=
áá 
dt
áá 
.
áá 
Key
áá 
.
áá  
Fecha
áá  %
.
áá% &
y
áá& '
,
áá' (
Mes
àà 
=
àà 
dt
àà 
.
àà 
Key
àà 
.
àà 
Fecha
àà $
.
àà$ %
m
àà% &
,
àà& '
Dia
ââ 
=
ââ 
dt
ââ 
.
ââ 
Key
ââ 
.
ââ 
Fecha
ââ $
.
ââ$ %
d
ââ% &
,
ââ& '#
CodigoTipoComprobante
ää '
=
ää( )
dt
ää* ,
.
ää, -
Key
ää- 0
.
ää0 1
CodigoComprobante
ää1 B
,
ääB C
IdSerie
ãã 
=
ãã 
dt
ãã 
.
ãã 
Key
ãã "
.
ãã" #"
id_serie_comprobante
ãã# 7
,
ãã7 8
Serie
åå 
=
åå 
dt
åå 
.
åå 
Key
åå  
.
åå  !
numero_serie
åå! -
,
åå- .
NumeroInicial
çç 
=
çç  !
(
çç" #
int
çç# &
)
çç& '
dt
çç' )
.
çç) *
Min
çç* -
(
çç- .
m
çç. /
=>
çç0 2
m
çç3 4
.
çç4 5
Transaccion
çç5 @
.
çç@ A
Comprobante
ççA L
.
ççL M
numero
ççM S
)
ççS T
,
ççT U
NumeroFinal
éé 
=
éé 
(
éé  !
int
éé! $
)
éé$ %
dt
éé% '
.
éé' (
Max
éé( +
(
éé+ ,
m
éé, -
=>
éé. 0
m
éé1 2
.
éé2 3
Transaccion
éé3 >
.
éé> ?
Comprobante
éé? J
.
ééJ K
numero
ééK Q
)
ééQ R
,
ééR S
IGV
èè 
=
èè 
dt
èè 
.
èè 
Sum
èè 
(
èè 
c
èè  
=>
èè! #
(
èè$ %
decimal
èè% ,
)
èè, -
c
èè- .
.
èè. /
igv
èè/ 2
)
èè2 3
,
èè3 4
Total
êê 
=
êê 
dt
êê 
.
êê 
Sum
êê  
(
êê  !
c
êê! "
=>
êê# %
c
êê& '
.
êê' (
total
êê( -
)
êê- .
,
êê. /
UltimoId
íí 
=
íí 
dt
íí 
.
íí  
Max
íí  #
(
íí# $
c
íí$ %
=>
íí& (
c
íí) *
.
íí* +
Transaccion
íí+ 6
.
íí6 7
id_comprobante
íí7 E
)
ííE F
}
ìì 
)
ìì 
.
ìì 
ToList
ìì 
(
ìì 
)
ìì 
.
ìì 
OrderBy
ìì !
(
ìì! "
t
ìì" #
=>
ìì$ &
t
ìì' (
.
ìì( )
FechaEmision
ìì) 5
)
ìì5 6
.
ìì6 7
ThenBy
ìì7 =
(
ìì= >
t
ìì> ?
=>
ìì@ B
t
ììC D
.
ììD E
Serie
ììE J
)
ììJ K
;
ììK L
return
îî 
Resumen
îî 
;
îî 
}
ññ 
catch
óó 
(
óó 
	Exception
óó 
e
óó 
)
óó 
{
òò 
throw
ôô 
new
ôô 
DatosException
ôô (
(
ôô( )
$str
ôô) T
,
ôôT U
e
ôôV W
)
ôôW X
;
ôôX Y
}
õõ 
}
úú 	
public
ûû %
Transaccion_consolidada
ûû &0
"ObtenerResumenTransaccionesAntesDe
ûû' I
(
ûûI J
int
ûûJ M
idTipoTransaccion
ûûN _
,
ûû_ `
int
ûûa d
idUltimoEstado
ûûe s
,
ûûs t
DateTime
ûûu }
fechaInicioûû~ â
,ûûâ ä
DateTimeûûã ì
fechaFinûûî ú
,ûûú ù
intûûû °
idSerieûû¢ ©
,ûû© ™
longûû´ Ø
idMaximoûû∞ ∏
)ûû∏ π
{
üü 	
try
†† 
{
°° 
var
¢¢ 
Resumen
¢¢ 
=
¢¢ 
_db
¢¢ !
.
¢¢! "
Transaccion
¢¢" -
.
¢¢- .
Where
¢¢. 3
(
¢¢3 4
sbt
¢¢4 7
=>
¢¢8 :
sbt
¢¢; >
.
¢¢> ?!
id_tipo_transaccion
¢¢? R
==
¢¢S U
idTipoTransaccion
¢¢V g
&&
¢¢h j
sbt
¢¢k n
.
¢¢n o
Comprobante
¢¢o z
.
¢¢z {#
id_serie_comprobante¢¢{ è
==¢¢ê í
idSerie¢¢ì ö
&&
££ 
sbt
££ 
.
££ 
fecha_inicio
££ #
>=
££$ &
fechaInicio
££' 2
&&
££3 5
sbt
££6 9
.
££9 :
fecha_inicio
££: F
<=
££G I
fechaFin
££J R
&&
§§ 
sbt
§§ 
.
§§ 
id_estado_actual
§§ '
==
§§( *
idUltimoEstado
§§+ 9
&&
•• 
sbt
•• 
.
•• 
id
•• 
<
•• 
idMaximo
•• $
)
••$ %
.
ßß 

SelectMany
ßß 
(
ßß 
t
ßß 
=>
ßß  
t
ßß! "
.
ßß" #!
Detalle_transaccion
ßß# 6
)
ßß6 7
.
ßß7 8
GroupBy
®® 
(
®® 
dt
®® 
=>
®® 
new
®® 
{
©© 
Fecha
™™ 
=
™™ 
new
™™ 
{
™™ 
y
™™  !
=
™™" #
dt
™™$ &
.
™™& '
Transaccion
™™' 2
.
™™2 3
fecha_inicio
™™3 ?
.
™™? @
Year
™™@ D
,
™™D E
m
™™F G
=
™™H I
dt
™™J L
.
™™L M
Transaccion
™™M X
.
™™X Y
fecha_inicio
™™Y e
.
™™e f
Month
™™f k
,
™™k l
d
™™m n
=
™™o p
dt
™™q s
.
™™s t
Transaccion
™™t 
.™™ Ä
fecha_inicio™™Ä å
.™™å ç
Day™™ç ê
}™™ë í
,™™í ì
CodigoComprobante
´´ #
=
´´$ %
dt
´´& (
.
´´( )
Transaccion
´´) 4
.
´´4 5
Comprobante
´´5 @
.
´´@ A
Detalle_maestro
´´A P
.
´´P Q
codigo
´´Q W
,
´´W X
dt
¨¨ 
.
¨¨ 
Transaccion
¨¨  
.
¨¨  !
Comprobante
¨¨! ,
.
¨¨, -"
id_serie_comprobante
¨¨- A
,
¨¨A B
dt
≠≠ 
.
≠≠ 
Transaccion
≠≠  
.
≠≠  !
Comprobante
≠≠! ,
.
≠≠, -
numero_serie
≠≠- 9
}
ØØ 
)
ØØ 
.
ØØ 
Select
ØØ 
(
ØØ 
dt
ØØ 
=>
ØØ 
new
ØØ !%
Transaccion_consolidada
ØØ" 9
(
ØØ9 :
)
ØØ: ;
{
∞∞ 
Anyo
±± 
=
±± 
dt
±± 
.
±± 
Key
±± 
.
±±  
Fecha
±±  %
.
±±% &
y
±±& '
,
±±' (
Mes
≤≤ 
=
≤≤ 
dt
≤≤ 
.
≤≤ 
Key
≤≤ 
.
≤≤ 
Fecha
≤≤ $
.
≤≤$ %
m
≤≤% &
,
≤≤& '
Dia
≥≥ 
=
≥≥ 
dt
≥≥ 
.
≥≥ 
Key
≥≥ 
.
≥≥ 
Fecha
≥≥ $
.
≥≥$ %
d
≥≥% &
,
≥≥& '#
CodigoTipoComprobante
¥¥ '
=
¥¥( )
dt
¥¥* ,
.
¥¥, -
Key
¥¥- 0
.
¥¥0 1
CodigoComprobante
¥¥1 B
,
¥¥B C
IdSerie
µµ 
=
µµ 
dt
µµ 
.
µµ 
Key
µµ "
.
µµ" #"
id_serie_comprobante
µµ# 7
,
µµ7 8
Serie
∂∂ 
=
∂∂ 
dt
∂∂ 
.
∂∂ 
Key
∂∂  
.
∂∂  !
numero_serie
∂∂! -
,
∂∂- .
NumeroInicial
∑∑ 
=
∑∑  !
(
∑∑" #
int
∑∑# &
)
∑∑& '
dt
∑∑' )
.
∑∑) *
Min
∑∑* -
(
∑∑- .
m
∑∑. /
=>
∑∑0 2
m
∑∑3 4
.
∑∑4 5
Transaccion
∑∑5 @
.
∑∑@ A
Comprobante
∑∑A L
.
∑∑L M
numero
∑∑M S
)
∑∑S T
,
∑∑T U
NumeroFinal
∏∏ 
=
∏∏ 
(
∏∏  !
int
∏∏! $
)
∏∏$ %
dt
∏∏% '
.
∏∏' (
Max
∏∏( +
(
∏∏+ ,
m
∏∏, -
=>
∏∏. 0
m
∏∏1 2
.
∏∏2 3
Transaccion
∏∏3 >
.
∏∏> ?
Comprobante
∏∏? J
.
∏∏J K
numero
∏∏K Q
)
∏∏Q R
,
∏∏R S
IGV
ππ 
=
ππ 
dt
ππ 
.
ππ 
Sum
ππ 
(
ππ 
c
ππ  
=>
ππ! #
(
ππ$ %
decimal
ππ% ,
)
ππ, -
c
ππ- .
.
ππ. /
igv
ππ/ 2
)
ππ2 3
,
ππ3 4
Total
∫∫ 
=
∫∫ 
dt
∫∫ 
.
∫∫ 
Sum
∫∫  
(
∫∫  !
c
∫∫! "
=>
∫∫# %
c
∫∫& '
.
∫∫' (
total
∫∫( -
)
∫∫- .
,
∫∫. /
UltimoId
ªª 
=
ªª 
dt
ªª 
.
ªª  
Max
ªª  #
(
ªª# $
c
ªª$ %
=>
ªª& (
c
ªª) *
.
ªª* +
id_transaccion
ªª+ 9
)
ªª9 :
}
ºº 
)
ºº 
.
ºº 
SingleOrDefault
ºº  
(
ºº  !
)
ºº! "
;
ºº" #
return
ΩΩ 
Resumen
ΩΩ 
;
ΩΩ 
}
øø 
catch
¿¿ 
(
¿¿ 
	Exception
¿¿ 
e
¿¿ 
)
¿¿ 
{
¡¡ 
throw
¬¬ 
new
¬¬ 
DatosException
¬¬ (
(
¬¬( )
$str
¬¬) T
,
¬¬T U
e
¬¬V W
)
¬¬W X
;
¬¬X Y
}
√√ 
}
ƒƒ 	
public
∆∆ %
Transaccion_consolidada
∆∆ &)
ObtenerResumenTransacciones
∆∆' B
(
∆∆B C
int
∆∆C F
idTipoTransaccion
∆∆G X
,
∆∆X Y
int
∆∆Z ]
idUltimoEstado
∆∆^ l
,
∆∆l m
DateTime
∆∆n v
fechaInicio∆∆w Ç
,∆∆Ç É
DateTime∆∆Ñ å
fechaFin∆∆ç ï
,∆∆ï ñ
int∆∆ó ö
idSerie∆∆õ ¢
)∆∆¢ £
{
«« 	
try
»» 
{
…… 
var
   
Resumen
   
=
   
_db
   !
.
  ! "
Transaccion
  " -
.
ÀÀ 
Where
ÀÀ 
(
ÀÀ 
t
ÀÀ 
=>
ÀÀ 
t
ÃÃ 
.
ÃÃ 
fecha_inicio
ÃÃ "
>=
ÃÃ# %
fechaInicio
ÃÃ& 1
&&
ÃÃ2 4
t
ÃÃ5 6
.
ÃÃ6 7
fecha_inicio
ÃÃ7 C
<=
ÃÃD F
fechaFin
ÃÃG O
&&
ÕÕ 
t
ÕÕ 
.
ÕÕ !
id_tipo_transaccion
ÕÕ ,
==
ÕÕ- /
idTipoTransaccion
ÕÕ0 A
&&
ŒŒ 
t
ŒŒ 
.
ŒŒ 
Comprobante
ŒŒ $
.
ŒŒ$ %"
id_serie_comprobante
ŒŒ% 9
==
ŒŒ: <
idSerie
ŒŒ= D
&&
œœ 
t
œœ 
.
œœ 
id_estado_actual
œœ )
==
œœ* ,
idUltimoEstado
œœ- ;
)
–– 
.
—— 
GroupBy
““ 
(
““ 
dt
““ 
=>
““ 
new
““ 
{
”” 
Fecha
‘‘ 
=
‘‘ 
new
‘‘ 
{
‘‘ 
y
‘‘  !
=
‘‘" #
dt
‘‘$ &
.
‘‘& '
fecha_inicio
‘‘' 3
.
‘‘3 4
Year
‘‘4 8
,
‘‘8 9
m
‘‘: ;
=
‘‘< =
dt
‘‘> @
.
‘‘@ A
fecha_inicio
‘‘A M
.
‘‘M N
Month
‘‘N S
,
‘‘S T
d
‘‘U V
=
‘‘W X
dt
‘‘Y [
.
‘‘[ \
fecha_inicio
‘‘\ h
.
‘‘h i
Day
‘‘i l
}
‘‘m n
,
‘‘n o
CodigoComprobante
’’ #
=
’’$ %
dt
’’& (
.
’’( )
Comprobante
’’) 4
.
’’4 5
Detalle_maestro
’’5 D
.
’’D E
codigo
’’E K
,
’’K L
dt
÷÷ 
.
÷÷ 
Comprobante
÷÷  
.
÷÷  !"
id_serie_comprobante
÷÷! 5
,
÷÷5 6
dt
◊◊ 
.
◊◊ 
Comprobante
◊◊  
.
◊◊  !
numero_serie
◊◊! -
}
ŸŸ 
)
ŸŸ 
.
ŸŸ 
Select
ŸŸ 
(
ŸŸ 
dt
ŸŸ 
=>
ŸŸ 
new
ŸŸ !%
Transaccion_consolidada
ŸŸ" 9
(
ŸŸ9 :
)
ŸŸ: ;
{
⁄⁄ 
Anyo
€€ 
=
€€ 
dt
€€ 
.
€€ 
Key
€€ 
.
€€  
Fecha
€€  %
.
€€% &
y
€€& '
,
€€' (
Mes
‹‹ 
=
‹‹ 
dt
‹‹ 
.
‹‹ 
Key
‹‹ 
.
‹‹ 
Fecha
‹‹ $
.
‹‹$ %
m
‹‹% &
,
‹‹& '
Dia
›› 
=
›› 
dt
›› 
.
›› 
Key
›› 
.
›› 
Fecha
›› $
.
››$ %
d
››% &
,
››& '#
CodigoTipoComprobante
ﬁﬁ '
=
ﬁﬁ( )
dt
ﬁﬁ* ,
.
ﬁﬁ, -
Key
ﬁﬁ- 0
.
ﬁﬁ0 1
CodigoComprobante
ﬁﬁ1 B
,
ﬁﬁB C
IdSerie
‡‡ 
=
‡‡ 
dt
‡‡ 
.
‡‡ 
Key
‡‡ "
.
‡‡" #"
id_serie_comprobante
‡‡# 7
,
‡‡7 8
Serie
·· 
=
·· 
dt
·· 
.
·· 
Key
··  
.
··  !
numero_serie
··! -
,
··- .
NumeroInicial
‚‚ 
=
‚‚  !
(
‚‚" #
int
‚‚# &
)
‚‚& '
dt
‚‚' )
.
‚‚) *
Min
‚‚* -
(
‚‚- .
m
‚‚. /
=>
‚‚0 2
m
‚‚3 4
.
‚‚4 5
Comprobante
‚‚5 @
.
‚‚@ A
numero
‚‚A G
)
‚‚G H
,
‚‚H I
NumeroFinal
„„ 
=
„„ 
(
„„  !
int
„„! $
)
„„$ %
dt
„„% '
.
„„' (
Max
„„( +
(
„„+ ,
m
„„, -
=>
„„. 0
m
„„1 2
.
„„2 3
Comprobante
„„3 >
.
„„> ?
numero
„„? E
)
„„E F
,
„„F G
IGV
‰‰ 
=
‰‰ 
dt
‰‰ 
.
‰‰ 
Sum
‰‰ 
(
‰‰ 
c
‰‰  
=>
‰‰! #
(
‰‰$ %
decimal
‰‰% ,
)
‰‰, -
(
‰‰- .
c
‰‰. /
.
‰‰/ 0!
Detalle_transaccion
‰‰0 C
.
‰‰C D
Sum
‰‰D G
(
‰‰G H
_dt
‰‰H K
=>
‰‰L N
_dt
‰‰O R
.
‰‰R S
igv
‰‰S V
)
‰‰V W
)
‰‰W X
)
‰‰X Y
,
‰‰Y Z
Total
ÂÂ 
=
ÂÂ 
dt
ÂÂ 
.
ÂÂ 
Sum
ÂÂ  
(
ÂÂ  !
c
ÂÂ! "
=>
ÂÂ# %
c
ÂÂ& '
.
ÂÂ' (
importe_total
ÂÂ( 5
)
ÂÂ5 6
,
ÂÂ6 7
UltimoId
ÊÊ 
=
ÊÊ 
dt
ÊÊ 
.
ÊÊ  
Max
ÊÊ  #
(
ÊÊ# $
c
ÊÊ$ %
=>
ÊÊ& (
c
ÊÊ) *
.
ÊÊ* +
id
ÊÊ+ -
)
ÊÊ- .
}
ÁÁ 
)
ÁÁ 
;
ÁÁ 
return
ÍÍ 
Resumen
ÍÍ 
.
ÍÍ 
SingleOrDefault
ÍÍ .
(
ÍÍ. /
)
ÍÍ/ 0
;
ÍÍ0 1
}
ÏÏ 
catch
ÌÌ 
(
ÌÌ 
	Exception
ÌÌ 
e
ÌÌ 
)
ÌÌ 
{
ÓÓ 
throw
ÔÔ 
new
ÔÔ 
DatosException
ÔÔ (
(
ÔÔ( )
$str
ÔÔ) T
,
ÔÔT U
e
ÔÔV W
)
ÔÔW X
;
ÔÔX Y
}
 
}
ÒÒ 	
public
ÛÛ 
IEnumerable
ÛÛ 
<
ÛÛ %
Transaccion_consolidada
ÛÛ 2
>
ÛÛ2 3)
ObtenerResumenTransacciones
ÛÛ4 O
(
ÛÛO P
int
ÛÛP S
idTipoTransaccion
ÛÛT e
,
ÛÛe f
int
ÛÛg j
idTipoComprobante
ÛÛk |
,
ÛÛ| }
intÛÛ~ Å
idUltimoEstadoÛÛÇ ê
,ÛÛê ë
longÛÛí ñ
idMinimoÛÛó ü
,ÛÛü †
longÛÛ° •
idMaximoÛÛ¶ Æ
)ÛÛÆ Ø
{
ÙÙ 	
try
ıı 
{
ˆˆ 
var
˜˜ 
Resumen
˜˜ 
=
˜˜ 
_db
˜˜ !
.
˜˜! "
Transaccion
˜˜" -
.
˜˜- .
Where
˜˜. 3
(
˜˜3 4
sbt
˜˜4 7
=>
˜˜8 :
sbt
˜˜; >
.
˜˜> ?!
id_tipo_transaccion
˜˜? R
==
˜˜S U
idTipoTransaccion
˜˜V g
&&
˜˜h j
sbt
˜˜k n
.
˜˜n o
Comprobante
˜˜o z
.
˜˜z {"
id_tipo_comprobante˜˜{ é
==˜˜è ë!
idTipoComprobante˜˜í £
&&˜˜§ ¶
sbt
¯¯ 
.
¯¯ 
id_estado_actual
¯¯ $
==
¯¯% '
idUltimoEstado
¯¯( 6
&&
¯¯7 9
sbt
¯¯: =
.
¯¯= >
id
¯¯> @
>
¯¯A B
idMinimo
¯¯C K
&&
¯¯L N
sbt
¯¯O R
.
¯¯R S
id
¯¯S U
<
¯¯V W
idMaximo
¯¯X `
)
¯¯` a
.
¯¯a b

SelectMany
¯¯b l
(
¯¯l m
t
¯¯m n
=>
¯¯o q
t
¯¯r s
.
¯¯s t"
Detalle_transaccion¯¯t á
)¯¯á à
.¯¯à â
GroupBy
˘˘ 
(
˘˘ 
dt
˘˘ 
=>
˘˘ 
new
˘˘ 
{
˙˙ 
Fecha
˚˚ 
=
˚˚ 
new
˚˚ 
{
˚˚ 
y
˚˚  !
=
˚˚" #
dt
˚˚$ &
.
˚˚& '
Transaccion
˚˚' 2
.
˚˚2 3
fecha_inicio
˚˚3 ?
.
˚˚? @
Year
˚˚@ D
,
˚˚D E
m
˚˚F G
=
˚˚H I
dt
˚˚J L
.
˚˚L M
Transaccion
˚˚M X
.
˚˚X Y
fecha_inicio
˚˚Y e
.
˚˚e f
Month
˚˚f k
,
˚˚k l
d
˚˚m n
=
˚˚o p
dt
˚˚q s
.
˚˚s t
Transaccion
˚˚t 
.˚˚ Ä
fecha_inicio˚˚Ä å
.˚˚å ç
Day˚˚ç ê
}˚˚ë í
,˚˚í ì
CodigoComprobante
¸¸ #
=
¸¸$ %
dt
¸¸& (
.
¸¸( )
Transaccion
¸¸) 4
.
¸¸4 5
Comprobante
¸¸5 @
.
¸¸@ A
Detalle_maestro
¸¸A P
.
¸¸P Q
codigo
¸¸Q W
,
¸¸W X
dt
˝˝ 
.
˝˝ 
Transaccion
˝˝  
.
˝˝  !
Comprobante
˝˝! ,
.
˝˝, -"
id_serie_comprobante
˝˝- A
,
˝˝A B
dt
˛˛ 
.
˛˛ 
Transaccion
˛˛  
.
˛˛  !
Comprobante
˛˛! ,
.
˛˛, -
numero_serie
˛˛- 9
,
˛˛9 :
}
ÄÄ 
)
ÄÄ 
.
ÄÄ 
Select
ÄÄ 
(
ÄÄ 
dt
ÄÄ 
=>
ÄÄ 
new
ÄÄ !%
Transaccion_consolidada
ÄÄ" 9
(
ÄÄ9 :
)
ÄÄ: ;
{
ÅÅ 
Anyo
ÇÇ 
=
ÇÇ 
dt
ÇÇ 
.
ÇÇ 
Key
ÇÇ 
.
ÇÇ  
Fecha
ÇÇ  %
.
ÇÇ% &
y
ÇÇ& '
,
ÇÇ' (
Mes
ÉÉ 
=
ÉÉ 
dt
ÉÉ 
.
ÉÉ 
Key
ÉÉ 
.
ÉÉ 
Fecha
ÉÉ $
.
ÉÉ$ %
m
ÉÉ% &
,
ÉÉ& '
Dia
ÑÑ 
=
ÑÑ 
dt
ÑÑ 
.
ÑÑ 
Key
ÑÑ 
.
ÑÑ 
Fecha
ÑÑ $
.
ÑÑ$ %
d
ÑÑ% &
,
ÑÑ& '#
CodigoTipoComprobante
ÖÖ '
=
ÖÖ( )
dt
ÖÖ* ,
.
ÖÖ, -
Key
ÖÖ- 0
.
ÖÖ0 1
CodigoComprobante
ÖÖ1 B
,
ÖÖB C
IdSerie
ÜÜ 
=
ÜÜ 
dt
ÜÜ 
.
ÜÜ 
Key
ÜÜ "
.
ÜÜ" #"
id_serie_comprobante
ÜÜ# 7
,
ÜÜ7 8
Serie
áá 
=
áá 
dt
áá 
.
áá 
Key
áá  
.
áá  !
numero_serie
áá! -
,
áá- .
NumeroInicial
àà 
=
àà  !
(
àà" #
int
àà# &
)
àà& '
dt
àà' )
.
àà) *
Min
àà* -
(
àà- .
m
àà. /
=>
àà0 2
m
àà3 4
.
àà4 5
Transaccion
àà5 @
.
àà@ A
Comprobante
ààA L
.
ààL M
numero
ààM S
)
ààS T
,
ààT U
NumeroFinal
ââ 
=
ââ 
(
ââ  !
int
ââ! $
)
ââ$ %
dt
ââ% '
.
ââ' (
Max
ââ( +
(
ââ+ ,
m
ââ, -
=>
ââ. 0
m
ââ1 2
.
ââ2 3
Transaccion
ââ3 >
.
ââ> ?
Comprobante
ââ? J
.
ââJ K
numero
ââK Q
)
ââQ R
,
ââR S
IGV
ää 
=
ää 
dt
ää 
.
ää 
Sum
ää 
(
ää 
c
ää  
=>
ää! #
(
ää$ %
decimal
ää% ,
)
ää, -
c
ää- .
.
ää. /
igv
ää/ 2
)
ää2 3
,
ää3 4
Total
ãã 
=
ãã 
dt
ãã 
.
ãã 
Sum
ãã  
(
ãã  !
c
ãã! "
=>
ãã# %
c
ãã& '
.
ãã' (
total
ãã( -
)
ãã- .
,
ãã. /
UltimoId
åå 
=
åå 
dt
åå 
.
åå  
Max
åå  #
(
åå# $
c
åå$ %
=>
åå& (
c
åå) *
.
åå* +
id_transaccion
åå+ 9
)
åå9 :
}
çç 
)
çç 
;
çç 
return
éé 
Resumen
éé 
;
éé 
}
êê 
catch
ëë 
(
ëë 
	Exception
ëë 
e
ëë 
)
ëë 
{
íí 
throw
ìì 
new
ìì 
DatosException
ìì (
(
ìì( )
$str
ìì) T
,
ììT U
e
ììV W
)
ììW X
;
ììX Y
}
ïï 
}
ññ 	
public
òò 
IEnumerable
òò 
<
òò %
Transaccion_consolidada
òò 2
>
òò2 3)
ObtenerResumenTransacciones
òò4 O
(
òòO P
int
òòP S
idTipoTransaccion
òòT e
,
òòe f
int
òòg j
idTipoComprobante
òòk |
,
òò| }
intòò~ Å
idUltimoEstadoòòÇ ê
,òòê ë
DateTimeòòí ö

fechaDesdeòòõ •
,òò• ¶
DateTimeòòß Ø

fechaHastaòò∞ ∫
)òò∫ ª
{
ôô 	
try
öö 
{
õõ 
var
úú 
Resumen
úú 
=
úú 
_db
úú !
.
úú! "
Transaccion
úú" -
.
úú- .
Where
úú. 3
(
úú3 4
sbt
úú4 7
=>
úú8 :
sbt
úú; >
.
úú> ?!
id_tipo_transaccion
úú? R
==
úúS U
idTipoTransaccion
úúV g
&&
úúh j
sbt
úúk n
.
úún o
Comprobante
úúo z
.
úúz {"
id_tipo_comprobanteúú{ é
==úúè ë!
idTipoComprobanteúúí £
&&úú§ ¶
sbt
ùù 
.
ùù 
id_estado_actual
ùù $
==
ùù% '
idUltimoEstado
ùù( 6
&&
ùù7 9
sbt
ùù: =
.
ùù= >
fecha_inicio
ùù> J
>=
ùùK M

fechaDesde
ùùN X
&&
ùùY [
sbt
ùù\ _
.
ùù_ `
fecha_inicio
ùù` l
<=
ùùm o

fechaHasta
ùùp z
)
ùùz {
.
ùù{ |

SelectManyùù| Ü
(ùùÜ á
tùùá à
=>ùùâ ã
tùùå ç
.ùùç é#
Detalle_transaccionùùé °
)ùù° ¢
.ùù¢ £
GroupBy
ûû 
(
ûû 
dt
ûû 
=>
ûû 
new
ûû 
{
üü 
Fecha
†† 
=
†† 
new
†† 
{
†† 
y
††  !
=
††" #
dt
††$ &
.
††& '
Transaccion
††' 2
.
††2 3
fecha_inicio
††3 ?
.
††? @
Year
††@ D
,
††D E
m
††F G
=
††H I
dt
††J L
.
††L M
Transaccion
††M X
.
††X Y
fecha_inicio
††Y e
.
††e f
Month
††f k
,
††k l
d
††m n
=
††o p
dt
††q s
.
††s t
Transaccion
††t 
.†† Ä
fecha_inicio††Ä å
.††å ç
Day††ç ê
}††ë í
,††í ì
CodigoComprobante
°° #
=
°°$ %
dt
°°& (
.
°°( )
Transaccion
°°) 4
.
°°4 5
Comprobante
°°5 @
.
°°@ A
Detalle_maestro
°°A P
.
°°P Q
codigo
°°Q W
,
°°W X
dt
¢¢ 
.
¢¢ 
Transaccion
¢¢  
.
¢¢  !
Comprobante
¢¢! ,
.
¢¢, -"
id_serie_comprobante
¢¢- A
,
¢¢A B
dt
££ 
.
££ 
Transaccion
££  
.
££  !
Comprobante
££! ,
.
££, -
numero_serie
££- 9
}
•• 
)
•• 
.
•• 
Select
•• 
(
•• 
dt
•• 
=>
•• 
new
•• !%
Transaccion_consolidada
••" 9
(
••9 :
)
••: ;
{
¶¶ 
Anyo
ßß 
=
ßß 
dt
ßß 
.
ßß 
Key
ßß 
.
ßß  
Fecha
ßß  %
.
ßß% &
y
ßß& '
,
ßß' (
Mes
®® 
=
®® 
dt
®® 
.
®® 
Key
®® 
.
®® 
Fecha
®® $
.
®®$ %
m
®®% &
,
®®& '
Dia
©© 
=
©© 
dt
©© 
.
©© 
Key
©© 
.
©© 
Fecha
©© $
.
©©$ %
d
©©% &
,
©©& '#
CodigoTipoComprobante
™™ '
=
™™( )
dt
™™* ,
.
™™, -
Key
™™- 0
.
™™0 1
CodigoComprobante
™™1 B
,
™™B C
IdSerie
´´ 
=
´´ 
dt
´´ 
.
´´ 
Key
´´ "
.
´´" #"
id_serie_comprobante
´´# 7
,
´´7 8
Serie
¨¨ 
=
¨¨ 
dt
¨¨ 
.
¨¨ 
Key
¨¨  
.
¨¨  !
numero_serie
¨¨! -
,
¨¨- .
NumeroInicial
≠≠ 
=
≠≠  !
(
≠≠" #
int
≠≠# &
)
≠≠& '
dt
≠≠' )
.
≠≠) *
Min
≠≠* -
(
≠≠- .
m
≠≠. /
=>
≠≠0 2
m
≠≠3 4
.
≠≠4 5
Transaccion
≠≠5 @
.
≠≠@ A
Comprobante
≠≠A L
.
≠≠L M
numero
≠≠M S
)
≠≠S T
,
≠≠T U
NumeroFinal
ÆÆ 
=
ÆÆ 
(
ÆÆ  !
int
ÆÆ! $
)
ÆÆ$ %
dt
ÆÆ% '
.
ÆÆ' (
Max
ÆÆ( +
(
ÆÆ+ ,
m
ÆÆ, -
=>
ÆÆ. 0
m
ÆÆ1 2
.
ÆÆ2 3
Transaccion
ÆÆ3 >
.
ÆÆ> ?
Comprobante
ÆÆ? J
.
ÆÆJ K
numero
ÆÆK Q
)
ÆÆQ R
,
ÆÆR S
IGV
ØØ 
=
ØØ 
dt
ØØ 
.
ØØ 
Sum
ØØ 
(
ØØ 
c
ØØ  
=>
ØØ! #
(
ØØ$ %
decimal
ØØ% ,
)
ØØ, -
c
ØØ- .
.
ØØ. /
igv
ØØ/ 2
)
ØØ2 3
,
ØØ3 4
Total
∞∞ 
=
∞∞ 
dt
∞∞ 
.
∞∞ 
Sum
∞∞  
(
∞∞  !
c
∞∞! "
=>
∞∞# %
c
∞∞& '
.
∞∞' (
total
∞∞( -
)
∞∞- .
,
∞∞. /
UltimoId
±± 
=
±± 
dt
±± 
.
±±  
Max
±±  #
(
±±# $
c
±±$ %
=>
±±& (
c
±±) *
.
±±* +
id_transaccion
±±+ 9
)
±±9 :
}
≤≤ 
)
≤≤ 
;
≤≤ 
return
≥≥ 
Resumen
≥≥ 
;
≥≥ 
}
µµ 
catch
∂∂ 
(
∂∂ 
	Exception
∂∂ 
e
∂∂ 
)
∂∂ 
{
∑∑ 
throw
∏∏ 
new
∏∏ 
DatosException
∏∏ (
(
∏∏( )
$str
∏∏) T
,
∏∏T U
e
∏∏V W
)
∏∏W X
;
∏∏X Y
}
ππ 
}
∫∫ 	
public
ºº 
IEnumerable
ºº 
<
ºº 
Transaccion
ºº &
>
ºº& '"
ObtenerTransacciones
ºº( <
(
ºº< =
long
ºº= A
[
ººA B
]
ººB C
idsTransacciones
ººD T
)
ººT U
{
ΩΩ 	
try
ææ 
{
øø 
return
¿¿ 
_db
¿¿ 
.
¿¿ 
Transaccion
¿¿ &
.
¿¿& '
Where
¿¿' ,
(
¿¿, -
st
¿¿- /
=>
¿¿0 2
idsTransacciones
¿¿3 C
.
¿¿C D
Contains
¿¿D L
(
¿¿L M
st
¿¿M O
.
¿¿O P
id
¿¿P R
)
¿¿R S
)
¿¿S T
.
¿¿T U
ToList
¿¿U [
(
¿¿[ \
)
¿¿\ ]
;
¿¿] ^
}
¡¡ 
catch
¬¬ 
(
¬¬ 
	Exception
¬¬ 
e
¬¬ 
)
¬¬ 
{
√√ 
throw
ƒƒ 
e
ƒƒ 
;
ƒƒ 
}
≈≈ 
}
∆∆ 	
public
»» 
IEnumerable
»» 
<
»» 
Transaccion
»» &
>
»»& '"
ObtenerTransacciones
»»( <
(
»»< =
long
»»= A
[
»»A B
]
»»B C
idsTransaccion
»»D R
,
»»R S
int
»»T W
idTipoTransaccion
»»X i
)
»»i j
{
…… 	
try
   
{
ÀÀ 
return
ÃÃ 
_db
ÃÃ 
.
ÃÃ 
Transaccion
ÃÃ &
.
ÃÃ& '
Include
ÕÕ 
(
ÕÕ 
t
ÕÕ 
=>
ÕÕ 
t
ÕÕ 
.
ÕÕ !
Detalle_transaccion
ÕÕ 2
)
ÕÕ2 3
.
ÕÕ3 4
Include
ŒŒ 
(
ŒŒ 
t
ŒŒ 
=>
ŒŒ 
t
ŒŒ 
.
ŒŒ 
Comprobante
ŒŒ *
)
ŒŒ* +
.
ŒŒ+ ,
Include
œœ 
(
œœ 
t
œœ 
=>
œœ 
t
œœ 
.
œœ 
Transaccion1
œœ +
)
œœ+ ,
.
œœ, -
Include
–– 
(
–– 
t
–– 
=>
–– 
t
–– 
.
–– !
Detalle_transaccion
–– 2
.
––2 3
Select
––3 9
(
––9 :
dst
––: =
=>
––> @
dst
––A D
.
––D E
Cuenta_contable
––E T
)
––T U
)
––U V
.
––V W
Where
—— 
(
—— 
t
—— 
=>
—— 
idsTransaccion
—— )
.
——) *
Contains
——* 2
(
——2 3
t
——3 4
.
——4 5
id
——5 7
)
——7 8
&&
——9 ;
t
——< =
.
——= >!
id_tipo_transaccion
——> Q
==
——R T
idTipoTransaccion
——U f
)
——f g
;
——g h
}
““ 
catch
”” 
(
”” 
	Exception
”” 
e
”” 
)
”” 
{
‘‘ 
throw
’’ 
e
’’ 
;
’’ 
}
÷÷ 
}
◊◊ 	
public
⁄⁄ 
IEnumerable
⁄⁄ 
<
⁄⁄ 
Transaccion
⁄⁄ &
>
⁄⁄& '"
ObtenerTransacciones
⁄⁄( <
(
⁄⁄< =
int
⁄⁄= @
idTipoTransaccion
⁄⁄A R
,
⁄⁄R S
int
⁄⁄T W
idUltimoEstado
⁄⁄X f
)
⁄⁄f g
{
€€ 	
try
‹‹ 
{
›› 
return
ﬁﬁ 
_db
ﬁﬁ 
.
ﬁﬁ 
Transaccion
ﬁﬁ &
.
ﬂﬂ# $
Where
ﬂﬂ$ )
(
ﬂﬂ) *
t
ﬂﬂ* +
=>
ﬂﬂ, .
t
ﬂﬂ/ 0
.
ﬂﬂ0 1!
id_tipo_transaccion
ﬂﬂ1 D
==
ﬂﬂE G
idTipoTransaccion
ﬂﬂH Y
&&
‡‡/ 1
t
‡‡2 3
.
‡‡3 4
id_estado_actual
‡‡4 D
==
‡‡E G
idUltimoEstado
‡‡H V
)
··# $
;
··$ %
}
„„ 
catch
‰‰ 
(
‰‰ 
	Exception
‰‰ 
e
‰‰ 
)
‰‰ 
{
ÂÂ 
throw
ÊÊ 
new
ÊÊ 
DatosException
ÊÊ (
(
ÊÊ( )
$str
ÊÊ) I
,
ÊÊI J
e
ÊÊK L
)
ÊÊL M
;
ÊÊM N
}
ÁÁ 
}
ËË 	
public
ÏÏ 
Transaccion
ÏÏ &
ObtenerUltimaTransaccion
ÏÏ 3
(
ÏÏ3 4
int
ÏÏ4 7
idTipoTransaccion
ÏÏ8 I
)
ÏÏI J
{
ÌÌ 	
try
ÓÓ 
{
ÔÔ 
return
 
_db
 
.
 
Transaccion
 &
.
& '
Where
' ,
(
, -
t
- .
=>
/ 1
t
2 3
.
3 4!
id_tipo_transaccion
4 G
==
H J
idTipoTransaccion
K \
)
\ ]
.
] ^
OrderByDescending
^ o
(
o p
t
p q
=>
r t
t
u v
.
v w
id
w y
)
y z
.
z {
FirstOrDefault{ â
(â ä
)ä ã
;ã å
}
ÒÒ 
catch
ÚÚ 
(
ÚÚ 
	Exception
ÚÚ 
e
ÚÚ 
)
ÚÚ 
{
ÛÛ 
throw
ÙÙ 
e
ÙÙ 
;
ÙÙ 
}
ıı 
}
ˆˆ 	
public
¸¸ 
Transaccion
¸¸ &
ObtenerUltimaTransaccion
¸¸ 3
(
¸¸3 4
int
¸¸4 7#
idActorNegocioInterno
¸¸8 M
,
¸¸M N
int
¸¸O R
idTipoTransaccion
¸¸S d
)
¸¸d e
{
˝˝ 	
try
˛˛ 
{
ˇˇ 
return
ÄÄ 
_db
ÄÄ 
.
ÄÄ 
Transaccion
ÄÄ &
.
ÅÅ 
Where
ÅÅ  
(
ÅÅ  !
t
ÅÅ! "
=>
ÅÅ# %
t
ÅÅ& '
.
ÅÅ' (&
id_actor_negocio_interno
ÅÅ( @
==
ÅÅA C#
idActorNegocioInterno
ÅÅD Y
&&
ÅÅZ \
t
ÅÅ] ^
.
ÅÅ^ _!
id_tipo_transaccion
ÅÅ_ r
==
ÅÅs u 
idTipoTransaccionÅÅv á
)ÅÅá à
.
ÇÇ 
OrderByDescending
ÇÇ ,
(
ÇÇ, -
t
ÇÇ- .
=>
ÇÇ/ 1
t
ÇÇ2 3
.
ÇÇ3 4
id
ÇÇ4 6
)
ÇÇ6 7
.
ÇÇ7 8
FirstOrDefault
ÇÇ8 F
(
ÇÇF G
)
ÇÇG H
;
ÇÇH I
}
ÉÉ 
catch
ÑÑ 
(
ÑÑ 
	Exception
ÑÑ 
e
ÑÑ 
)
ÑÑ 
{
ÖÖ 
throw
ÜÜ 
e
ÜÜ 
;
ÜÜ 
}
áá 
}
àà 	
public
ää 
long
ää 
[
ää 
]
ää 2
$ObtenerIdsDeTransaccionesPosteriores
ää :
(
ää: ;
int
ää; >#
idActorNegocioInterno
ää? T
,
ääT U
int
ääV Y
idTipoTransaccion
ääZ k
,
ääk l
DateTime
ääm u
fecha
ääv {
)
ää{ |
{
ãã 	
try
åå 
{
çç 
return
éé 
_db
éé 
.
éé 
Transaccion
éé &
.
éé& '
Where
éé' ,
(
éé, -
t
éé- .
=>
éé/ 1
t
éé2 3
.
éé3 4&
id_actor_negocio_interno
éé4 L
==
ééM O#
idActorNegocioInterno
ééP e
&&
ééf h
t
ééi j
.
ééj k!
id_tipo_transaccion
éék ~
==éé Å!
idTipoTransaccionééÇ ì
&&ééî ñ
tééó ò
.ééò ô
fecha_inicioééô •
>éé¶ ß
fechaéé® ≠
)éé≠ Æ
.ééÆ Ø
SelectééØ µ
(ééµ ∂
téé∂ ∑
=>éé∏ ∫
tééª º
.ééº Ω
idééΩ ø
)ééø ¿
.éé¿ ¡
ToArrayéé¡ »
(éé» …
)éé…  
;éé  À
}
èè 
catch
êê 
(
êê 
	Exception
êê 
e
êê 
)
êê 
{
ëë 
throw
íí 
e
íí 
;
íí 
}
ìì 
}
îî 	
public
ïï 
Transaccion
ïï -
ObtenerUltimaTransaccionAntesDe
ïï :
(
ïï: ;
int
ïï; >
idTipoTransaccion
ïï? P
,
ïïP Q
DateTime
ïïR Z
fechaInicio
ïï[ f
)
ïïf g
{
ññ 	
try
óó 
{
òò 
return
ôô 
_db
ôô 
.
ôô 
Transaccion
ôô &
.
ôô& '
Include
ôô' .
(
ôô. /
t
ôô/ 0
=>
ôô1 3
t
ôô4 5
.
ôô5 6!
Detalle_transaccion
ôô6 I
)
ôôI J
.
öö 
Where
öö  
(
öö  !
t
öö! "
=>
öö# %
t
öö& '
.
öö' (!
id_tipo_transaccion
öö( ;
==
öö< >
idTipoTransaccion
öö? P
&&
ööQ S
t
ööT U
.
ööU V
fecha_inicio
ööV b
<=
ööc e
fechaInicio
ööf q
)
ööq r
.
õõ 
OrderByDescending
õõ ,
(
õõ, -
t
õõ- .
=>
õõ/ 1
t
õõ2 3
.
õõ3 4
id
õõ4 6
)
õõ6 7
.
õõ7 8
FirstOrDefault
õõ8 F
(
õõF G
)
õõG H
;
õõH I
}
úú 
catch
ùù 
(
ùù 
	Exception
ùù 
e
ùù 
)
ùù 
{
ûû 
throw
üü 
e
üü 
;
üü 
}
†† 
}
°° 	
public
¢¢ 
Transaccion
¢¢ -
ObtenerUltimaTransaccionAntesDe
¢¢ :
(
¢¢: ;
int
¢¢; >#
idActorNegocioInterno
¢¢? T
,
¢¢T U
int
¢¢V Y
idTipoTransaccion
¢¢Z k
,
¢¢k l
DateTime
¢¢m u
fechaInicio¢¢v Å
)¢¢Å Ç
{
££ 	
try
§§ 
{
•• 
return
¶¶ 
_db
¶¶ 
.
¶¶ 
Transaccion
¶¶ &
.
¶¶& '
Include
¶¶' .
(
¶¶. /
t
¶¶/ 0
=>
¶¶1 3
t
¶¶4 5
.
¶¶5 6!
Detalle_transaccion
¶¶6 I
)
¶¶I J
.
ßß 
Where
ßß  
(
ßß  !
t
ßß! "
=>
ßß# %
t
ßß& '
.
ßß' (&
id_actor_negocio_interno
ßß( @
==
ßßA C#
idActorNegocioInterno
ßßD Y
&&
ßßZ \
t
ßß] ^
.
ßß^ _!
id_tipo_transaccion
ßß_ r
==
ßßs u 
idTipoTransaccionßßv á
&&ßßà ä
tßßã å
.ßßå ç
fecha_inicioßßç ô
<=ßßö ú
fechaInicioßßù ®
)ßß® ©
.
®® 
OrderByDescending
®® ,
(
®®, -
t
®®- .
=>
®®/ 1
t
®®2 3
.
®®3 4
id
®®4 6
)
®®6 7
.
®®7 8
FirstOrDefault
®®8 F
(
®®F G
)
®®G H
;
®®H I
}
©© 
catch
™™ 
(
™™ 
	Exception
™™ 
e
™™ 
)
™™ 
{
´´ 
throw
¨¨ 
e
¨¨ 
;
¨¨ 
}
≠≠ 
}
ÆÆ 	
public
∑∑ !
Detalle_transaccion
∑∑ "9
+ObtenerDetalleTransaccionPorConceptoNegocio
∑∑# N
(
∑∑N O
int
∑∑O R#
idActorNegocioInterno
∑∑S h
,
∑∑h i
int
∑∑j m
idTipoTransaccion
∑∑n 
,∑∑ Ä
int∑∑Å Ñ!
idConceptoNegocio∑∑Ö ñ
)∑∑ñ ó
{
∏∏ 	
try
ππ 
{
∫∫ 
return
ªª 
_db
ªª 
.
ªª 
Transaccion
ªª &
.
ªª& '
Where
ªª' ,
(
ªª, -
t
ªª- .
=>
ªª/ 1
t
ªª2 3
.
ªª3 4!
id_tipo_transaccion
ªª4 G
==
ªªH J
idTipoTransaccion
ªªK \
&&
ªª] _
t
ªª` a
.
ªªa b&
id_actor_negocio_interno
ªªb z
==
ªª{ }$
idActorNegocioInternoªª~ ì
)ªªì î
.
ºº& '
OrderByDescending
ºº' 8
(
ºº8 9
t
ºº9 :
=>
ºº; =
t
ºº> ?
.
ºº? @
id
ºº@ B
)
ººB C
.
ººC D

SelectMany
ººD N
(
ººN O
t
ººO P
=>
ººQ S
t
ººT U
.
ººU V!
Detalle_transaccion
ººV i
)
ººi j
.
ΩΩ& '
Where
ΩΩ' ,
(
ΩΩ, -
dt
ΩΩ- /
=>
ΩΩ0 2
dt
ΩΩ3 5
.
ΩΩ5 6!
id_concepto_negocio
ΩΩ6 I
==
ΩΩJ L
idConceptoNegocio
ΩΩM ^
)
ΩΩ^ _
.
ΩΩ_ `
FirstOrDefault
ΩΩ` n
(
ΩΩn o
)
ΩΩo p
;
ΩΩp q
}
ææ 
catch
øø 
(
øø 
	Exception
øø 
e
øø 
)
øø 
{
¿¿ 
throw
¡¡ 
new
¡¡ 
DatosException
¡¡ (
(
¡¡( )
$str
¡¡) O
,
¡¡O P
e
¡¡Q R
)
¡¡R S
;
¡¡S T
}
¬¬ 
}
√√ 	
public
≈≈ 
Transaccion
≈≈ '
ObtenerPrimeraTransaccion
≈≈ 4
(
≈≈4 5
int
≈≈5 8
idActorNegocio
≈≈9 G
,
≈≈G H
int
≈≈I L
idTipoTransaccion
≈≈M ^
)
≈≈^ _
{
∆∆ 	
try
«« 
{
»» 
return
…… 
_db
…… 
.
…… 
Transaccion
…… &
.
……& '
Include
……' .
(
……. /
t
……/ 0
=>
……1 3
t
……4 5
.
……5 6!
Detalle_transaccion
……6 I
)
……I J
.
   
Where
    
(
    !
t
  ! "
=>
  # %
t
  & '
.
  ' (&
id_actor_negocio_externo
  ( @
==
  A C
idActorNegocio
  D R
&&
  S U
t
  V W
.
  W X!
id_tipo_transaccion
  X k
==
  l n 
idTipoTransaccion  o Ä
)  Ä Å
.  Å Ç!
OrderByDescending  Ç ì
(  ì î
t  î ï
=>  ñ ò
t  ô ö
.  ö õ
id  õ ù
)  ù û
.  û ü
FirstOrDefault  ü ≠
(  ≠ Æ
)  Æ Ø
;  Ø ∞
}
ÀÀ 
catch
ÃÃ 
(
ÃÃ 
	Exception
ÃÃ 
e
ÃÃ 
)
ÃÃ 
{
ÕÕ 
throw
ŒŒ 
e
ŒŒ 
;
ŒŒ 
}
œœ 
}
–– 	
public
““ 
Tipo_cambio
““ !
ObtenerTipoDeCambio
““ .
(
““. /
DateTime
““/ 7
fecha
““8 =
)
““= >
{
”” 	
try
‘‘ 
{
’’ 
var
÷÷ 

tipoCambio
÷÷ 
=
÷÷  
_db
÷÷! $
.
÷÷$ %
Tipo_cambio
÷÷% 0
.
÷÷0 1
SingleOrDefault
÷÷1 @
(
÷÷@ A
tc
÷÷A C
=>
÷÷D F
tc
÷÷G I
.
÷÷I J
fecha
÷÷J O
==
÷÷P R
fecha
÷÷S X
)
÷÷X Y
;
÷÷Y Z
var
◊◊  
tipoCambioOpcional
◊◊ &
=
◊◊' (
_db
◊◊) ,
.
◊◊, -
Tipo_cambio
◊◊- 8
.
◊◊8 9
Where
◊◊9 >
(
◊◊> ?
tc
◊◊? A
=>
◊◊B D
tc
◊◊E G
.
◊◊G H
fecha
◊◊H M
<
◊◊N O
fecha
◊◊P U
)
◊◊U V
.
◊◊V W
OrderByDescending
◊◊W h
(
◊◊h i
tc
◊◊i k
=>
◊◊l n
tc
◊◊o q
.
◊◊q r
id
◊◊r t
)
◊◊t u
.
◊◊u v
First
◊◊v {
(
◊◊{ |
)
◊◊| }
;
◊◊} ~
return
ÿÿ 

tipoCambio
ÿÿ !
!=
ÿÿ" $
null
ÿÿ% )
?
ÿÿ* +

tipoCambio
ÿÿ, 6
:
ÿÿ7 8 
tipoCambioOpcional
ÿÿ9 K
;
ÿÿK L
}
ŸŸ 
catch
⁄⁄ 
(
⁄⁄ 
	Exception
⁄⁄ 
e
⁄⁄ 
)
⁄⁄ 
{
€€ 
throw
‹‹ 
e
‹‹ 
;
‹‹ 
}
›› 
}
ﬁﬁ 	
public
‡‡ 
IEnumerable
‡‡ 
<
‡‡ !
Cuenta_Cobrar_Pagar
‡‡ .
>
‡‡. /+
ObtenerCuentasPorCobrarOPagar
‡‡0 M
(
‡‡M N
bool
‡‡N R
	porCobrar
‡‡S \
)
‡‡\ ]
{
·· 	
try
‚‚ 
{
„„ 
var
‰‰ 
cuotas
‰‰ 
=
‰‰ 
_db
‰‰  
.
‰‰  !
Cuota
‰‰! &
.
‰‰& '
Where
ÂÂ 
(
ÂÂ 
c
ÂÂ 
=>
ÂÂ 
c
ÂÂ 
.
ÂÂ  

por_cobrar
ÂÂ  *
==
ÂÂ+ -
	porCobrar
ÂÂ. 7
&&
ÊÊ 
c
ÊÊ 
.
ÊÊ 
saldo
ÊÊ 
>
ÊÊ 
$num
ÊÊ  !
)
ÊÊ! "
.
ÊÊ" #
Select
ÁÁ 
(
ÁÁ 
c
ÁÁ 
=>
ÁÁ 
new
ÁÁ "!
Cuenta_Cobrar_Pagar
ÁÁ# 6
(
ÁÁ6 7
)
ÁÁ7 8
{
ËË 
IdCuota
ÈÈ 
=
ÈÈ  
c
ÈÈ! "
.
ÈÈ" #
id
ÈÈ# %
,
ÈÈ% &
CodigoCuota
ÍÍ "
=
ÍÍ# $
c
ÍÍ% &
.
ÍÍ& '
codigo
ÍÍ' -
,
ÍÍ- .
IdTransaccion
ÎÎ $
=
ÎÎ% &
c
ÎÎ' (
.
ÎÎ( )
id_transaccion
ÎÎ) 7
,
ÎÎ7 8
IdTipoTransaccion
ÏÏ (
=
ÏÏ) *
c
ÏÏ+ ,
.
ÏÏ, -
Transaccion
ÏÏ- 8
.
ÏÏ8 9!
id_tipo_transaccion
ÏÏ9 L
,
ÏÏL M
TipoTransaccion
ÌÌ &
=
ÌÌ' (
c
ÌÌ) *
.
ÌÌ* +
Transaccion
ÌÌ+ 6
.
ÌÌ6 7
Transaccion2
ÌÌ7 C
.
ÌÌC D
Tipo_transaccion
ÌÌD T
.
ÌÌT U
nombre
ÌÌU [
,
ÌÌ[ \
IdActorComercial
ÓÓ '
=
ÓÓ( )
c
ÓÓ* +
.
ÓÓ+ ,
Transaccion
ÓÓ, 7
.
ÓÓ7 8&
id_actor_negocio_externo
ÓÓ8 P
,
ÓÓP Q/
!CodigoTipoDocumentoActorComercial
ÔÔ 8
=
ÔÔ9 :
c
ÔÔ; <
.
ÔÔ< =
Transaccion
ÔÔ= H
.
ÔÔH I
Actor_negocio1
ÔÔI W
.
ÔÔW X
Actor
ÔÔX ]
.
ÔÔ] ^
Detalle_maestro
ÔÔ^ m
.
ÔÔm n
valor
ÔÔn s
,
ÔÔs t+
NumeroDocumentoActorComercial
 4
=
5 6
c
7 8
.
8 9
Transaccion
9 D
.
D E
Actor_negocio1
E S
.
S T
Actor
T Y
.
Y Z(
numero_documento_identidad
Z t
,
t u
ActorComercial
ÒÒ %
=
ÒÒ& '
c
ÒÒ( )
.
ÒÒ) *
Transaccion
ÒÒ* 5
.
ÒÒ5 6
Actor_negocio1
ÒÒ6 D
.
ÒÒD E
Actor
ÒÒE J
.
ÒÒJ K
primer_nombre
ÒÒK X
.
ÒÒX Y
Replace
ÒÒY `
(
ÒÒ` a
$str
ÒÒa d
,
ÒÒd e
$str
ÒÒf i
)
ÒÒi j
,
ÒÒj k
NombreGrupo
ÚÚ "
=
ÚÚ# $
c
ÚÚ% &
.
ÚÚ& '
Transaccion
ÚÚ' 2
.
ÚÚ2 3
Actor_negocio3
ÚÚ3 A
.
ÚÚA B
Actor
ÚÚB G
.
ÚÚG H
primer_nombre
ÚÚH U
,
ÚÚU V#
CodigoTipoComprobante
ÛÛ ,
=
ÛÛ- .
c
ÛÛ/ 0
.
ÛÛ0 1
Transaccion
ÛÛ1 <
.
ÛÛ< =
Comprobante
ÛÛ= H
.
ÛÛH I
Detalle_maestro
ÛÛI X
.
ÛÛX Y
valor
ÛÛY ^
,
ÛÛ^ _
TipoComprobante
ÙÙ &
=
ÙÙ' (
c
ÙÙ) *
.
ÙÙ* +
Transaccion
ÙÙ+ 6
.
ÙÙ6 7
Comprobante
ÙÙ7 B
.
ÙÙB C
Detalle_maestro
ÙÙC R
.
ÙÙR S
nombre
ÙÙS Y
,
ÙÙY Z
SerieComprobante
ıı '
=
ıı( )
c
ıı* +
.
ıı+ ,
Transaccion
ıı, 7
.
ıı7 8
Comprobante
ıı8 C
.
ııC D
numero_serie
ııD P
,
ııP Q
NumeroComprobante
ˆˆ (
=
ˆˆ) *
c
ˆˆ+ ,
.
ˆˆ, -
Transaccion
ˆˆ- 8
.
ˆˆ8 9
Comprobante
ˆˆ9 D
.
ˆˆD E
numero
ˆˆE K
,
ˆˆK L
FechaInicio
˜˜ "
=
˜˜# $
c
˜˜% &
.
˜˜& '
fecha_emision
˜˜' 4
,
˜˜4 5
FechaFin
¯¯ 
=
¯¯  !
c
¯¯" #
.
¯¯# $
fecha_vencimiento
¯¯$ 5
,
¯¯5 6
PagoACuenta
˘˘ "
=
˘˘# $
c
˘˘% &
.
˘˘& '
pago_a_cuenta
˘˘' 4
,
˘˘4 5
Total
˙˙ 
=
˙˙ 
c
˙˙  
.
˙˙  !
total
˙˙! &
,
˙˙& '
Revocado
˚˚ 
=
˚˚  !
c
˚˚" #
.
˚˚# $
revocado
˚˚$ ,
,
˚˚, -
Saldo
¸¸ 
=
¸¸ 
c
¸¸  
.
¸¸  !
saldo
¸¸! &
}
˝˝ 
)
˝˝ 
.
˝˝ 
OrderByDescending
˝˝ '
(
˝˝' (
c
˝˝( )
=>
˝˝* ,
c
˝˝- .
.
˝˝. /
IdCuota
˝˝/ 6
)
˝˝6 7
;
˝˝7 8
return
˛˛ 
cuotas
˛˛ 
;
˛˛ 
}
ˇˇ 
catch
ÄÄ 
(
ÄÄ 
	Exception
ÄÄ 
e
ÄÄ 
)
ÄÄ 
{
ÅÅ 
throw
ÇÇ 
new
ÇÇ 
DatosException
ÇÇ (
(
ÇÇ( )
$str
ÇÇ) U
,
ÇÇU V
e
ÇÇW X
)
ÇÇX Y
;
ÇÇY Z
}
ÉÉ 
}
ÑÑ 	
public
ÜÜ 
IEnumerable
ÜÜ 
<
ÜÜ !
Cuenta_Cobrar_Pagar
ÜÜ .
>
ÜÜ. /4
&ObtenerCuentasPorCobrarOPagarPorGrupos
ÜÜ0 V
(
ÜÜV W
bool
ÜÜW [
	porCobrar
ÜÜ\ e
,
ÜÜe f
int
ÜÜg j
?
ÜÜj k
[
ÜÜk l
]
ÜÜl m
	idsGrupos
ÜÜn w
)
ÜÜw x
{
áá 	
try
àà 
{
ââ 
var
ää 
cuotas
ää 
=
ää 
_db
ää  
.
ää  !
Cuota
ää! &
.
ää& '
Where
ãã 
(
ãã 
c
ãã 
=>
ãã 
c
ãã 
.
ãã  

por_cobrar
ãã  *
==
ãã+ -
	porCobrar
ãã. 7
&&
ãã8 :
c
ãã; <
.
ãã< =
saldo
ãã= B
>
ããC D
$num
ããE F
&&
ããG I
	idsGrupos
ããJ S
.
ããS T
Contains
ããT \
(
ãã\ ]
c
ãã] ^
.
ãã^ _
Transaccion
ãã_ j
.
ããj k(
id_actor_negocio_externo1ããk Ñ
)ããÑ Ö
)ããÖ Ü
.ããÜ á
Select
åå 
(
åå 
c
åå 
=>
åå 
new
åå "!
Cuenta_Cobrar_Pagar
åå# 6
(
åå6 7
)
åå7 8
{
çç 
IdCuota
éé 
=
éé  
c
éé! "
.
éé" #
id
éé# %
,
éé% &
CodigoCuota
èè "
=
èè# $
c
èè% &
.
èè& '
codigo
èè' -
,
èè- .
IdTransaccion
êê $
=
êê% &
c
êê' (
.
êê( )
id_transaccion
êê) 7
,
êê7 8
IdTipoTransaccion
ëë (
=
ëë) *
c
ëë+ ,
.
ëë, -
Transaccion
ëë- 8
.
ëë8 9!
id_tipo_transaccion
ëë9 L
,
ëëL M
TipoTransaccion
íí &
=
íí' (
c
íí) *
.
íí* +
Transaccion
íí+ 6
.
íí6 7
Transaccion2
íí7 C
.
ííC D
Tipo_transaccion
ííD T
.
ííT U
nombre
ííU [
,
íí[ \
IdActorComercial
ìì '
=
ìì( )
c
ìì* +
.
ìì+ ,
Transaccion
ìì, 7
.
ìì7 8&
id_actor_negocio_externo
ìì8 P
,
ììP Q/
!CodigoTipoDocumentoActorComercial
îî 8
=
îî9 :
c
îî; <
.
îî< =
Transaccion
îî= H
.
îîH I
Actor_negocio1
îîI W
.
îîW X
Actor
îîX ]
.
îî] ^
Detalle_maestro
îî^ m
.
îîm n
valor
îîn s
,
îîs t+
NumeroDocumentoActorComercial
ïï 4
=
ïï5 6
c
ïï7 8
.
ïï8 9
Transaccion
ïï9 D
.
ïïD E
Actor_negocio1
ïïE S
.
ïïS T
Actor
ïïT Y
.
ïïY Z(
numero_documento_identidad
ïïZ t
,
ïït u
ActorComercial
ññ %
=
ññ& '
c
ññ( )
.
ññ) *
Transaccion
ññ* 5
.
ññ5 6
Actor_negocio1
ññ6 D
.
ññD E
Actor
ññE J
.
ññJ K
primer_nombre
ññK X
.
ññX Y
Replace
ññY `
(
ññ` a
$str
ñña d
,
ññd e
$str
ññf i
)
ññi j
,
ññj k
NombreGrupo
óó "
=
óó# $
c
óó% &
.
óó& '
Transaccion
óó' 2
.
óó2 3
Actor_negocio3
óó3 A
.
óóA B
Actor
óóB G
.
óóG H
primer_nombre
óóH U
,
óóU V#
CodigoTipoComprobante
òò ,
=
òò- .
c
òò/ 0
.
òò0 1
Transaccion
òò1 <
.
òò< =
Comprobante
òò= H
.
òòH I
Detalle_maestro
òòI X
.
òòX Y
valor
òòY ^
,
òò^ _
TipoComprobante
ôô &
=
ôô' (
c
ôô) *
.
ôô* +
Transaccion
ôô+ 6
.
ôô6 7
Comprobante
ôô7 B
.
ôôB C
Detalle_maestro
ôôC R
.
ôôR S
nombre
ôôS Y
,
ôôY Z
SerieComprobante
öö '
=
öö( )
c
öö* +
.
öö+ ,
Transaccion
öö, 7
.
öö7 8
Comprobante
öö8 C
.
ööC D
numero_serie
ööD P
,
ööP Q
NumeroComprobante
õõ (
=
õõ) *
c
õõ+ ,
.
õõ, -
Transaccion
õõ- 8
.
õõ8 9
Comprobante
õõ9 D
.
õõD E
numero
õõE K
,
õõK L
FechaInicio
úú "
=
úú# $
c
úú% &
.
úú& '
fecha_emision
úú' 4
,
úú4 5
FechaFin
ùù 
=
ùù  !
c
ùù" #
.
ùù# $
fecha_vencimiento
ùù$ 5
,
ùù5 6
PagoACuenta
ûû "
=
ûû# $
c
ûû% &
.
ûû& '
pago_a_cuenta
ûû' 4
,
ûû4 5
Total
üü 
=
üü 
c
üü  
.
üü  !
total
üü! &
,
üü& '
Revocado
†† 
=
††  !
c
††" #
.
††# $
revocado
††$ ,
,
††, -
Saldo
°° 
=
°° 
c
°°  
.
°°  !
saldo
°°! &
}
¢¢ 
)
¢¢ 
.
¢¢ 
OrderByDescending
¢¢ '
(
¢¢' (
c
¢¢( )
=>
¢¢* ,
c
¢¢- .
.
¢¢. /
IdCuota
¢¢/ 6
)
¢¢6 7
;
¢¢7 8
return
££ 
cuotas
££ 
;
££ 
}
§§ 
catch
•• 
(
•• 
	Exception
•• 
e
•• 
)
•• 
{
¶¶ 
throw
ßß 
new
ßß 
DatosException
ßß (
(
ßß( )
$str
ßß) U
,
ßßU V
e
ßßW X
)
ßßX Y
;
ßßY Z
}
®® 
}
©© 	
public
´´ 
IEnumerable
´´ 
<
´´ 

Cobro_Pago
´´ %
>
´´% &!
ObtenerCobrosOPagos
´´' :
(
´´: ;
bool
´´; ?
esCobro
´´@ G
,
´´G H
DateTime
´´I Q

fechaDesde
´´R \
,
´´\ ]
DateTime
´´^ f

fechaHasta
´´g q
)
´´q r
{
¨¨ 	
try
≠≠ 
{
ÆÆ 
var
ØØ 
movimientos
ØØ 
=
ØØ  !
_db
ØØ" %
.
ØØ% &
Transaccion
ØØ& 1
.
ØØ1 2
Where
∞∞ 
(
∞∞ 
t
∞∞ 
=>
∞∞ 
t
∞∞  
.
∞∞  !
fecha_inicio
∞∞! -
>=
∞∞. 0

fechaDesde
∞∞1 ;
&&
∞∞< >
t
∞∞? @
.
∞∞@ A
fecha_inicio
∞∞A M
<=
∞∞N P

fechaHasta
∞∞Q [
&&
∞∞\ ^
t
∞∞_ `
.
∞∞` a
Tipo_transaccion
∞∞a q
.
∞∞q r5
&Accion_de_negocio_por_tipo_transaccion∞∞r ò
.∞∞ò ô
Any∞∞ô ú
(∞∞ú ù
antt∞∞ù °
=>∞∞¢ §
antt∞∞• ©
.∞∞© ™$
id_accion_de_negocio∞∞™ æ
==∞∞ø ¡#
TransaccionSettings∞∞¬ ’
.∞∞’ ÷
Default∞∞÷ ›
.∞∞› ﬁ1
!IdAccionDeNegocioMovimientoEnCaja∞∞ﬁ ˇ
&&∞∞Ä Ç
antt∞∞É á
.∞∞á à
valor∞∞à ç
==∞∞é ê
esCobro∞∞ë ò
)∞∞ò ô
&&∞∞ö ú
t∞∞ù û
.∞∞û ü 
id_estado_actual∞∞ü Ø
==∞∞∞ ≤
MaestroSettings∞∞≥ ¬
.∞∞¬ √
Default∞∞√  
.∞∞  À0
 IdDetalleMaestroEstadoConfirmado∞∞À Î
)∞∞Î Ï
.∞∞Ï Ì
Select
±± 
(
±± 
t
±± 
=>
±± 
new
±±  #

Cobro_Pago
±±$ .
(
±±. /
)
±±/ 0
{
≤≤ 
Id
≥≥ 
=
≥≥ 
t
≥≥ 
.
≥≥ 
id
≥≥ !
,
≥≥! "
FechaInicio
¥¥ #
=
¥¥$ %
t
¥¥& '
.
¥¥' (
fecha_inicio
¥¥( 4
,
¥¥4 5)
CodigoTipoDocumentoEmpleado
µµ 3
=
µµ4 5
t
µµ6 7
.
µµ7 8
Actor_negocio
µµ8 E
.
µµE F
Actor
µµF K
.
µµK L
Detalle_maestro
µµL [
.
µµ[ \
valor
µµ\ a
,
µµa b%
NumeroDocumentoEmpleado
∂∂ /
=
∂∂0 1
t
∂∂2 3
.
∂∂3 4
Actor_negocio
∂∂4 A
.
∂∂A B
Actor
∂∂B G
.
∂∂G H(
numero_documento_identidad
∂∂H b
,
∂∂b c
Empleado
∑∑  
=
∑∑! "
t
∑∑# $
.
∑∑$ %
Actor_negocio
∑∑% 2
.
∑∑2 3
Actor
∑∑3 8
.
∑∑8 9
primer_nombre
∑∑9 F
.
∑∑F G
Replace
∑∑G N
(
∑∑N O
$str
∑∑O R
,
∑∑R S
$str
∑∑T W
)
∑∑W X
,
∑∑X Y/
!CodigoTipoDocumentoActorComercial
∏∏ 9
=
∏∏: ;
t
∏∏< =
.
∏∏= >
Actor_negocio1
∏∏> L
.
∏∏L M
Actor
∏∏M R
.
∏∏R S
Detalle_maestro
∏∏S b
.
∏∏b c
valor
∏∏c h
,
∏∏h i+
NumeroDocumentoActorComercial
ππ 5
=
ππ6 7
t
ππ8 9
.
ππ9 :
Actor_negocio1
ππ: H
.
ππH I
Actor
ππI N
.
ππN O(
numero_documento_identidad
ππO i
,
ππi j
ActorComercial
∫∫ &
=
∫∫' (
t
∫∫) *
.
∫∫* +
Actor_negocio1
∫∫+ 9
.
∫∫9 :
Actor
∫∫: ?
.
∫∫? @
primer_nombre
∫∫@ M
.
∫∫M N
Replace
∫∫N U
(
∫∫U V
$str
∫∫V Y
,
∫∫Y Z
$str
∫∫[ ^
)
∫∫^ _
,
∫∫_ `
Total
ªª 
=
ªª 
t
ªª  !
.
ªª! "
importe_total
ªª" /
,
ªª/ 0
MedioDePago
ºº #
=
ºº$ %
t
ºº& '
.
ºº' (

Traza_pago
ºº( 2
.
ºº2 3
Count
ºº3 8
>
ºº9 :
$num
ºº; <
?
ºº= >
t
ºº? @
.
ºº@ A

Traza_pago
ººA K
.
ººK L
FirstOrDefault
ººL Z
(
ººZ [
)
ºº[ \
.
ºº\ ]
Detalle_maestro1
ºº] m
.
ººm n
nombre
ººn t
:
ººu v
$str
ººw z
,
ººz {
EsCobro
ΩΩ 
=
ΩΩ  !
esCobro
ΩΩ" )
,
ΩΩ) *
TipoDeOperacion
ææ '
=
ææ( )
(
ææ* +
t
ææ+ ,
.
ææ, -

Pago_cuota
ææ- 7
.
ææ7 8
Count
ææ8 =
==
ææ> @
$num
ææA B
&&
ææC E
t
ææF G
.
ææG H"
id_transaccion_padre
ææH \
!=
ææ] _
null
ææ` d
)
ææd e
?
ææf g
t
ææh i
.
ææi j
Transaccion2
ææj v
.
ææv w
Tipo_transaccionææw á
.ææá à
nombreææà é
:ææè ê
$strææë î
,ææî ï
TipoDocumento
øø %
=
øø& '
t
øø( )
.
øø) *
Comprobante
øø* 5
.
øø5 6
Detalle_maestro
øø6 E
.
øøE F
nombre
øøF L
,
øøL M"
SerieNumeroDocumento
¿¿ ,
=
¿¿- .
t
¿¿/ 0
.
¿¿0 1
Comprobante
¿¿1 <
.
¿¿< =
numero_serie
¿¿= I
+
¿¿J K
$str
¿¿L O
+
¿¿P Q
t
¿¿R S
.
¿¿S T
Comprobante
¿¿T _
.
¿¿_ `
numero
¿¿` f
}
¡¡ 
)
¡¡ 
.
¡¡ 
OrderByDescending
¡¡ (
(
¡¡( )
c
¡¡) *
=>
¡¡+ -
c
¡¡. /
.
¡¡/ 0
Id
¡¡0 2
)
¡¡2 3
;
¡¡3 4
return
¬¬ 
movimientos
¬¬ "
;
¬¬" #
}
√√ 
catch
ƒƒ 
(
ƒƒ 
	Exception
ƒƒ 
e
ƒƒ 
)
ƒƒ 
{
≈≈ 
throw
∆∆ 
new
∆∆ 
DatosException
∆∆ (
(
∆∆( )
$str
∆∆) J
,
∆∆J K
e
∆∆L M
)
∆∆M N
;
∆∆N O
}
«« 
}
»» 	
public
   
IEnumerable
   
<
   
Transaccion
   &
>
  & 'H
:ObtenerTransaccionesInclusiveActoresYDetalleMaestroYEstado
  ( b
(
  b c
int
  c f
idTipoTransaccion
  g x
,
  x y
int
  z }
idUltimoEstado  ~ å
,  å ç
DateTime  é ñ

fechaDesde  ó °
,  ° ¢
DateTime  £ ´

fechaHasta  ¨ ∂
,  ∂ ∑
int  ∏ ª
idSerie  º √
)  √ ƒ
{
ÀÀ 	
try
ÃÃ 
{
ÕÕ 
return
ŒŒ 
_db
ŒŒ 
.
ŒŒ 
Transaccion
ŒŒ &
.
ŒŒ& '
Include
ŒŒ' .
(
ŒŒ. /
t
ŒŒ/ 0
=>
ŒŒ1 3
t
ŒŒ4 5
.
ŒŒ5 6
Actor_negocio
ŒŒ6 C
)
ŒŒC D
.
ŒŒD E
Include
ŒŒE L
(
ŒŒL M
t
ŒŒM N
=>
ŒŒO Q
t
ŒŒR S
.
ŒŒS T
Actor_negocio1
ŒŒT b
)
ŒŒb c
.
ŒŒc d
Include
ŒŒd k
(
ŒŒk l
t
ŒŒl m
=>
ŒŒn p
t
ŒŒq r
.
ŒŒr s
Actor_negocio2ŒŒs Å
)ŒŒÅ Ç
.
œœ 
Include
œœ 
(
œœ 
t
œœ 
=>
œœ !
t
œœ" #
.
œœ# $
Actor_negocio
œœ$ 1
.
œœ1 2
Actor
œœ2 7
.
œœ7 8
Detalle_maestro
œœ8 G
)
œœG H
.
–– 
Include
–– 
(
–– 
t
–– 
=>
–– !
t
––" #
.
––# $
Actor_negocio1
––$ 2
.
––2 3
Actor
––3 8
.
––8 9
Detalle_maestro
––9 H
)
––H I
.
—— 
Include
—— 
(
—— 
t
—— 
=>
—— !
t
——" #
.
——# $
Actor_negocio2
——$ 2
.
——2 3
Actor
——3 8
.
——8 9
Detalle_maestro
——9 H
)
——H I
.
““ 
Include
““ 
(
““ 
t
““ 
=>
““ !
t
““" #
.
““# $
Detalle_maestro1
““$ 4
)
““4 5
.
““5 6
Include
““6 =
(
““= >
t
““> ?
=>
““@ B
t
““C D
.
““D E 
Estado_transaccion
““E W
.
““W X
Select
““X ^
(
““^ _
et
““_ a
=>
““b d
et
““e g
.
““g h
Detalle_maestro
““h w
)
““w x
)
““x y
.
”” 
Include
”” 
(
”” 
t
”” 
=>
”” !
t
””" #
.
””# $
Comprobante
””$ /
)
””/ 0
.
””0 1
Include
””1 8
(
””8 9
t
””9 :
=>
””; =
t
””> ?
.
””? @
Comprobante
””@ K
.
””K L
Detalle_maestro
””L [
)
””[ \
.
‘‘ 
Where
‘‘ 
(
‘‘ 
t
‘‘ 
=>
‘‘ 
t
‘‘ 
.
‘‘  !
id_tipo_transaccion
‘‘  3
==
‘‘4 6
idTipoTransaccion
‘‘7 H
&&
‘‘I K
t
‘‘L M
.
‘‘M N
Comprobante
‘‘N Y
.
‘‘Y Z"
id_serie_comprobante
‘‘Z n
==
‘‘o q
idSerie
‘‘r y
&&
‘‘z |
t
‘‘} ~
.
‘‘~ 
id_estado_actual‘‘ è
==‘‘ê í
idUltimoEstado‘‘ì °
&&‘‘¢ §
t‘‘• ¶
.‘‘¶ ß
fecha_inicio‘‘ß ≥
>=‘‘¥ ∂

fechaDesde‘‘∑ ¡
&&‘‘¬ ƒ
t‘‘≈ ∆
.‘‘∆ «
fecha_inicio‘‘« ”
<=‘‘‘ ÷

fechaHasta‘‘◊ ·
)‘‘· ‚
;‘‘‚ „
}
’’ 
catch
÷÷ 
(
÷÷ 
	Exception
÷÷ 
e
÷÷ 
)
÷÷ 
{
◊◊ 
throw
ÿÿ 
e
ÿÿ 
;
ÿÿ 
}
ŸŸ 
}
⁄⁄ 	
public
‹‹ 
IEnumerable
‹‹ 
<
‹‹ 
Transaccion
‹‹ &
>
‹‹& 'H
:ObtenerTransaccionesInclusiveActoresYDetalleMaestroYEstado
‹‹( b
(
‹‹b c
int
‹‹c f
idTipoTransaccion
‹‹g x
,
‹‹x y
DateTime‹‹z Ç

fechaDesde‹‹É ç
,‹‹ç é
DateTime‹‹è ó

fechaHasta‹‹ò ¢
,‹‹¢ £
int‹‹§ ß
idUltimoEstado‹‹® ∂
,‹‹∂ ∑
int‹‹∏ ª
idSerie‹‹º √
)‹‹√ ƒ
{
›› 	
try
ﬁﬁ 
{
ﬂﬂ 
return
‡‡ 
_db
‡‡ 
.
‡‡ 
Transaccion
‡‡ &
.
·· 
Include
·· 
(
·· 
t
·· 
=>
·· !
t
··" #
.
··# $
Actor_negocio
··$ 1
)
··1 2
.
‚‚ 
Include
‚‚ 
(
‚‚ 
t
‚‚ 
=>
‚‚ !
t
‚‚" #
.
‚‚# $
Actor_negocio
‚‚$ 1
.
‚‚1 2
Actor
‚‚2 7
)
‚‚7 8
.
„„ 
Include
„„ 
(
„„ 
t
„„ 
=>
„„ !
t
„„" #
.
„„# $
Actor_negocio
„„$ 1
.
„„1 2
Actor
„„2 7
.
„„7 8
Detalle_maestro
„„8 G
)
„„G H
.
‰‰ 
Include
‰‰ 
(
‰‰ 
t
‰‰ 
=>
‰‰ !
t
‰‰" #
.
‰‰# $
Actor_negocio1
‰‰$ 2
)
‰‰2 3
.
ÂÂ 
Include
ÂÂ 
(
ÂÂ 
t
ÂÂ 
=>
ÂÂ !
t
ÂÂ" #
.
ÂÂ# $
Actor_negocio2
ÂÂ$ 2
)
ÂÂ2 3
.
ÊÊ 
Include
ÊÊ 
(
ÊÊ 
t
ÊÊ 
=>
ÊÊ !
t
ÊÊ" #
.
ÊÊ# $
Actor_negocio1
ÊÊ$ 2
.
ÊÊ2 3
Actor
ÊÊ3 8
.
ÊÊ8 9
Detalle_maestro
ÊÊ9 H
)
ÊÊH I
.
ÁÁ 
Include
ÁÁ 
(
ÁÁ 
t
ÁÁ 
=>
ÁÁ !
t
ÁÁ" #
.
ÁÁ# $
Actor_negocio2
ÁÁ$ 2
.
ÁÁ2 3
Actor
ÁÁ3 8
.
ÁÁ8 9
Detalle_maestro
ÁÁ9 H
)
ÁÁH I
.
ËË 
Include
ËË 
(
ËË 
t
ËË 
=>
ËË !
t
ËË" #
.
ËË# $
Detalle_maestro1
ËË$ 4
)
ËË4 5
.
ÈÈ 
Include
ÈÈ 
(
ÈÈ 
t
ÈÈ 
=>
ÈÈ !
t
ÈÈ" #
.
ÈÈ# $ 
Estado_transaccion
ÈÈ$ 6
)
ÈÈ6 7
.
ÍÍ 
Include
ÍÍ 
(
ÍÍ 
t
ÍÍ 
=>
ÍÍ !
t
ÍÍ" #
.
ÍÍ# $ 
Estado_transaccion
ÍÍ$ 6
.
ÍÍ6 7
Select
ÍÍ7 =
(
ÍÍ= >
et
ÍÍ> @
=>
ÍÍA C
et
ÍÍD F
.
ÍÍF G
Detalle_maestro
ÍÍG V
)
ÍÍV W
)
ÍÍW X
.
ÎÎ 
Include
ÎÎ 
(
ÎÎ 
t
ÎÎ 
=>
ÎÎ !
t
ÎÎ" #
.
ÎÎ# $
Comprobante
ÎÎ$ /
)
ÎÎ/ 0
.
ÏÏ 
Include
ÏÏ 
(
ÏÏ 
t
ÏÏ 
=>
ÏÏ !
t
ÏÏ" #
.
ÏÏ# $
Comprobante
ÏÏ$ /
.
ÏÏ/ 0
Detalle_maestro
ÏÏ0 ?
)
ÏÏ? @
.
ÌÌ 
Where
ÌÌ 
(
ÌÌ 
t
ÌÌ 
=>
ÌÌ 
t
ÌÌ 
.
ÌÌ  
fecha_inicio
ÌÌ  ,
>=
ÌÌ- /

fechaDesde
ÌÌ0 :
&&
ÌÌ; =
t
ÌÌ> ?
.
ÌÌ? @
fecha_inicio
ÌÌ@ L
<=
ÌÌM O

fechaHasta
ÌÌP Z
&&
ÌÌ[ ]
t
ÌÌ^ _
.
ÌÌ_ `!
id_tipo_transaccion
ÌÌ` s
==
ÌÌt v 
idTipoTransaccionÌÌw à
&&ÌÌâ ã
tÌÌå ç
.ÌÌç é
ComprobanteÌÌé ô
.ÌÌô ö$
id_serie_comprobanteÌÌö Æ
==ÌÌØ ±
idSerieÌÌ≤ π
&&ÌÌ∫ º
tÌÌΩ æ
.ÌÌæ ø 
id_estado_actualÌÌø œ
==ÌÌ– “
idUltimoEstadoÌÌ” ·
)ÌÌ· ‚
;ÌÌ‚ „
}
ÓÓ 
catch
ÔÔ 
(
ÔÔ 
	Exception
ÔÔ 
e
ÔÔ 
)
ÔÔ 
{
 
throw
ÒÒ 
e
ÒÒ 
;
ÒÒ 
}
ÚÚ 
}
ÛÛ 	
public
ˆˆ 
IEnumerable
ˆˆ 
<
ˆˆ 
Transaccion
ˆˆ &
>
ˆˆ& 'H
:ObtenerTransaccionesInclusiveActoresYDetalleMaestroYEstado
ˆˆ( b
(
ˆˆb c
int
ˆˆc f
[
ˆˆf g
]
ˆˆg h!
idsTiposTransaccion
ˆˆi |
,
ˆˆ| }
intˆˆ~ Å
[ˆˆÅ Ç
]ˆˆÇ É$
idsTiposComprobantesˆˆÑ ò
,ˆˆò ô
DateTimeˆˆö ¢

fechaDesdeˆˆ£ ≠
,ˆˆ≠ Æ
DateTimeˆˆØ ∑

fechaHastaˆˆ∏ ¬
,ˆˆ¬ √
intˆˆƒ «
idUltimoEstadoˆˆ» ÷
)ˆˆ÷ ◊
{
˜˜ 	
try
¯¯ 
{
˘˘ 
return
˙˙ 
_db
˙˙ 
.
˙˙ 
Transaccion
˙˙ &
.
˙˙& '
Include
˙˙' .
(
˙˙. /
t
˙˙/ 0
=>
˙˙1 3
t
˙˙4 5
.
˙˙5 6
Actor_negocio
˙˙6 C
)
˙˙C D
.
˙˙D E
Include
˙˙E L
(
˙˙L M
t
˙˙M N
=>
˙˙O Q
t
˙˙R S
.
˙˙S T
Actor_negocio1
˙˙T b
)
˙˙b c
.
˙˙c d
Include
˙˙d k
(
˙˙k l
t
˙˙l m
=>
˙˙n p
t
˙˙q r
.
˙˙r s
Actor_negocio2˙˙s Å
)˙˙Å Ç
.
˚˚ 
Include
˚˚ 
(
˚˚ 
t
˚˚ 
=>
˚˚ !
t
˚˚" #
.
˚˚# $
Actor_negocio
˚˚$ 1
.
˚˚1 2
Actor
˚˚2 7
.
˚˚7 8
Detalle_maestro
˚˚8 G
)
˚˚G H
.
¸¸ 
Include
¸¸ 
(
¸¸ 
t
¸¸ 
=>
¸¸ !
t
¸¸" #
.
¸¸# $
Actor_negocio1
¸¸$ 2
.
¸¸2 3
Actor
¸¸3 8
.
¸¸8 9
Detalle_maestro
¸¸9 H
)
¸¸H I
.
˝˝ 
Include
˝˝ 
(
˝˝ 
t
˝˝ 
=>
˝˝ !
t
˝˝" #
.
˝˝# $
Actor_negocio2
˝˝$ 2
.
˝˝2 3
Actor
˝˝3 8
.
˝˝8 9
Detalle_maestro
˝˝9 H
)
˝˝H I
.
˛˛ 
Include
˛˛ 
(
˛˛ 
t
˛˛ 
=>
˛˛ !
t
˛˛" #
.
˛˛# $
Detalle_maestro1
˛˛$ 4
)
˛˛4 5
.
˛˛5 6
Include
˛˛6 =
(
˛˛= >
t
˛˛> ?
=>
˛˛@ B
t
˛˛C D
.
˛˛D E 
Estado_transaccion
˛˛E W
.
˛˛W X
Select
˛˛X ^
(
˛˛^ _
et
˛˛_ a
=>
˛˛b d
et
˛˛e g
.
˛˛g h
Detalle_maestro
˛˛h w
)
˛˛w x
)
˛˛x y
.
ˇˇ 
Include
ˇˇ 
(
ˇˇ 
t
ˇˇ 
=>
ˇˇ !
t
ˇˇ" #
.
ˇˇ# $
Comprobante
ˇˇ$ /
)
ˇˇ/ 0
.
ˇˇ0 1
Include
ˇˇ1 8
(
ˇˇ8 9
t
ˇˇ9 :
=>
ˇˇ; =
t
ˇˇ> ?
.
ˇˇ? @
Comprobante
ˇˇ@ K
.
ˇˇK L
Detalle_maestro
ˇˇL [
)
ˇˇ[ \
.
ÄÄ 
Where
ÄÄ 
(
ÄÄ 
t
ÄÄ 
=>
ÄÄ !
idsTiposTransaccion
ÄÄ  3
.
ÄÄ3 4
Contains
ÄÄ4 <
(
ÄÄ< =
t
ÄÄ= >
.
ÄÄ> ?!
id_tipo_transaccion
ÄÄ? R
)
ÄÄR S
&&
ÅÅ 
t
ÅÅ 
.
ÅÅ 
fecha_inicio
ÅÅ %
>=
ÅÅ& (

fechaDesde
ÅÅ) 3
&&
ÅÅ4 6
t
ÅÅ7 8
.
ÅÅ8 9
fecha_inicio
ÅÅ9 E
<=
ÅÅF H

fechaHasta
ÅÅI S
&&
ÇÇ "
idsTiposComprobantes
ÇÇ +
.
ÇÇ+ ,
Contains
ÇÇ, 4
(
ÇÇ4 5
t
ÇÇ5 6
.
ÇÇ6 7
Comprobante
ÇÇ7 B
.
ÇÇB C!
id_tipo_comprobante
ÇÇC V
)
ÇÇV W
&&
ÉÉ 
t
ÉÉ 
.
ÉÉ 
id_estado_actual
ÉÉ )
==
ÉÉ* ,
idUltimoEstado
ÉÉ- ;
)
ÉÉ; <
;
ÉÉ< =
}
ÑÑ 
catch
ÖÖ 
(
ÖÖ 
	Exception
ÖÖ 
e
ÖÖ 
)
ÖÖ 
{
ÜÜ 
throw
áá 
new
áá 
DatosException
áá (
(
áá( )
$str
áá) I
,
ááI J
e
ááK L
)
ááL M
;
ááM N
}
àà 
}
ââ 	
public
ãã 
IEnumerable
ãã 
<
ãã 
Transaccion
ãã &
>
ãã& 'H
:ObtenerTransaccionesInclusiveActoresYDetalleMaestroYEstado
ãã( b
(
ããb c
int
ããc f
[
ããf g
]
ããg h!
idsTiposTransaccion
ããi |
,
ãã| }
intãã~ Å
[ããÅ Ç
]ããÇ É$
idsTiposComprobantesããÑ ò
,ããò ô
intããö ù'
idEstadoQueDebeContenerããû µ
,ããµ ∂
DateTimeãã∑ ø

fechaDesdeãã¿  
,ãã  À
DateTimeããÃ ‘

fechaHastaãã’ ﬂ
)ããﬂ ‡
{
åå 	
try
çç 
{
éé 
return
èè 
_db
èè 
.
èè 
Transaccion
èè &
.
èè& '
Include
èè' .
(
èè. /
t
èè/ 0
=>
èè1 3
t
èè4 5
.
èè5 6
Actor_negocio
èè6 C
)
èèC D
.
èèD E
Include
èèE L
(
èèL M
t
èèM N
=>
èèO Q
t
èèR S
.
èèS T
Actor_negocio1
èèT b
)
èèb c
.
èèc d
Include
èèd k
(
èèk l
t
èèl m
=>
èèn p
t
èèq r
.
èèr s
Actor_negocio2èès Å
)èèÅ Ç
.
êê 
Include
êê 
(
êê 
t
êê 
=>
êê !
t
êê" #
.
êê# $
Actor_negocio
êê$ 1
.
êê1 2
Actor
êê2 7
.
êê7 8
Detalle_maestro
êê8 G
)
êêG H
.
ëë 
Include
ëë 
(
ëë 
t
ëë 
=>
ëë !
t
ëë" #
.
ëë# $
Actor_negocio1
ëë$ 2
.
ëë2 3
Actor
ëë3 8
.
ëë8 9
Detalle_maestro
ëë9 H
)
ëëH I
.
íí 
Include
íí 
(
íí 
t
íí 
=>
íí !
t
íí" #
.
íí# $
Actor_negocio2
íí$ 2
.
íí2 3
Actor
íí3 8
.
íí8 9
Detalle_maestro
íí9 H
)
ííH I
.
ìì 
Include
ìì 
(
ìì 
t
ìì 
=>
ìì !
t
ìì" #
.
ìì# $
Detalle_maestro1
ìì$ 4
)
ìì4 5
.
ìì5 6
Include
ìì6 =
(
ìì= >
t
ìì> ?
=>
ìì@ B
t
ììC D
.
ììD E 
Estado_transaccion
ììE W
.
ììW X
Select
ììX ^
(
ìì^ _
et
ìì_ a
=>
ììb d
et
ììe g
.
ììg h
Detalle_maestro
ììh w
)
ììw x
)
ììx y
.
îî 
Include
îî 
(
îî 
t
îî 
=>
îî !
t
îî" #
.
îî# $
Comprobante
îî$ /
)
îî/ 0
.
îî0 1
Include
îî1 8
(
îî8 9
t
îî9 :
=>
îî; =
t
îî> ?
.
îî? @
Comprobante
îî@ K
.
îîK L
Detalle_maestro
îîL [
)
îî[ \
.
ïï 
Where
ïï 
(
ïï 
t
ïï 
=>
ïï !
idsTiposTransaccion
ïï  3
.
ïï3 4
Contains
ïï4 <
(
ïï< =
t
ïï= >
.
ïï> ?!
id_tipo_transaccion
ïï? R
)
ïïR S
&&
ññ 
t
ññ 
.
ññ 
fecha_inicio
ññ %
>=
ññ& (

fechaDesde
ññ) 3
&&
ññ4 6
t
ññ7 8
.
ññ8 9
fecha_inicio
ññ9 E
<=
ññF H

fechaHasta
ññI S
&&
óó "
idsTiposComprobantes
óó +
.
óó+ ,
Contains
óó, 4
(
óó4 5
t
óó5 6
.
óó6 7
Comprobante
óó7 B
.
óóB C!
id_tipo_comprobante
óóC V
)
óóV W
&&
òò 
t
òò 
.
òò  
Estado_transaccion
òò +
.
òò+ ,
Select
òò, 2
(
òò2 3
et
òò3 5
=>
òò6 8
et
òò9 ;
.
òò; <
	id_estado
òò< E
)
òòE F
.
òòF G
Contains
òòG O
(
òòO P%
idEstadoQueDebeContener
òòP g
)
òòg h
)
òòh i
;
òòi j
}
ôô 
catch
öö 
(
öö 
	Exception
öö 
e
öö 
)
öö 
{
õõ 
throw
úú 
new
úú 
DatosException
úú (
(
úú( )
$str
úú) I
,
úúI J
e
úúK L
)
úúL M
;
úúM N
}
ùù 
}
ûû 	
public
†† 
IEnumerable
†† 
<
†† 
Transaccion
†† &
>
††& 'H
:ObtenerTransaccionesInclusiveActoresYDetalleMaestroYEstado
††( b
(
††b c
int
††c f
[
††f g
]
††g h!
idsTiposTransaccion
††i |
,
††| }
int††~ Å
[††Å Ç
]††Ç É$
idsTiposComprobantes††Ñ ò
,††ò ô
int††ö ù
[††ù û
]††û ü

idsEstados††† ™
,††™ ´
DateTime††¨ ¥

fechaDesde††µ ø
,††ø ¿
DateTime††¡ …

fechaHasta††  ‘
)††‘ ’
{
°° 	
try
¢¢ 
{
££ 
return
§§ 
_db
§§ 
.
§§ 
Transaccion
§§ &
.
¶¶ 
Include
¶¶ 
(
¶¶ 
t
¶¶ 
=>
¶¶ !
t
¶¶" #
.
¶¶# $
Actor_negocio1
¶¶$ 2
)
¶¶2 3
.
ßß 
Include
ßß 
(
ßß 
t
ßß 
=>
ßß !
t
ßß" #
.
ßß# $
Actor_negocio1
ßß$ 2
.
ßß2 3
Actor
ßß3 8
)
ßß8 9
.
™™ 
Include
™™ 
(
™™ 
t
™™ 
=>
™™ !
t
™™" #
.
™™# $
Actor_negocio1
™™$ 2
.
™™2 3
Actor
™™3 8
.
™™8 9
Detalle_maestro
™™9 H
)
™™H I
.
¨¨ 
Include
¨¨ 
(
¨¨ 
t
¨¨ 
=>
¨¨ !
t
¨¨" #
.
¨¨# $
Detalle_maestro1
¨¨$ 4
)
¨¨4 5
.
≠≠ 
Include
≠≠ 
(
≠≠ 
t
≠≠ 
=>
≠≠ !
t
≠≠" #
.
≠≠# $ 
Estado_transaccion
≠≠$ 6
.
≠≠6 7
Select
≠≠7 =
(
≠≠= >
et
≠≠> @
=>
≠≠A C
et
≠≠D F
.
≠≠F G
Detalle_maestro
≠≠G V
)
≠≠V W
)
≠≠W X
.
ÆÆ 
Include
ÆÆ 
(
ÆÆ 
t
ÆÆ 
=>
ÆÆ !
t
ÆÆ" #
.
ÆÆ# $
Comprobante
ÆÆ$ /
)
ÆÆ/ 0
.
ØØ 
Include
ØØ 
(
ØØ 
t
ØØ 
=>
ØØ !
t
ØØ" #
.
ØØ# $
Comprobante
ØØ$ /
.
ØØ/ 0
Detalle_maestro
ØØ0 ?
)
ØØ? @
.
∞∞ 
Where
∞∞ 
(
∞∞ 
t
∞∞ 
=>
∞∞ 
t
∞∞  !
.
∞∞! "
fecha_inicio
∞∞" .
>=
∞∞/ 1

fechaDesde
∞∞2 <
&&
∞∞= ?
t
∞∞@ A
.
∞∞A B
fecha_inicio
∞∞B N
<=
∞∞O Q

fechaHasta
∞∞R \
&&
±± !
idsTiposTransaccion
±± *
.
±±* +
Contains
±±+ 3
(
±±3 4
t
±±4 5
.
±±5 6!
id_tipo_transaccion
±±6 I
)
±±I J
&&
≤≤ "
idsTiposComprobantes
≤≤ +
.
≤≤+ ,
Contains
≤≤, 4
(
≤≤4 5
t
≤≤5 6
.
≤≤6 7
Comprobante
≤≤7 B
.
≤≤B C!
id_tipo_comprobante
≤≤C V
)
≤≤V W
&&
≥≥ 
t
≥≥ 
.
≥≥  
Evento_transaccion
≥≥ +
.
≥≥+ ,
Where
≥≥, 1
(
≥≥1 2
et
≥≥2 4
=>
≥≥5 7

idsEstados
≥≥8 B
.
≥≥B C
Contains
≥≥C K
(
≥≥K L
et
≥≥L N
.
≥≥N O
	id_evento
≥≥O X
)
≥≥X Y
)
≥≥Y Z
.
≥≥Z [
Count
≥≥[ `
(
≥≥` a
)
≥≥a b
>
≥≥c d
$num
≥≥e f
)
¥¥ 
;
¥¥ 
}
∂∂ 
catch
∑∑ 
(
∑∑ 
	Exception
∑∑ 
e
∑∑ 
)
∑∑ 
{
∏∏ 
throw
ππ 
e
ππ 
;
ππ 
}
∫∫ 
}
ªª 	
public
ΩΩ 
IEnumerable
ΩΩ 
<
ΩΩ 
Transaccion
ΩΩ &
>
ΩΩ& 'S
EObtenerTransaccionesInclusiveActoresYDetalleMaestroYEstadoSinConcepto
ΩΩ( m
(
ΩΩm n
int
ΩΩn q
[
ΩΩq r
]
ΩΩr s"
idsTiposTransaccionΩΩt á
,ΩΩá à
intΩΩâ å
[ΩΩå ç
]ΩΩç é$
idsTiposComprobantesΩΩè £
,ΩΩ£ §
intΩΩ• ®
[ΩΩ® ©
]ΩΩ© ™

idsEstadosΩΩ´ µ
,ΩΩµ ∂
DateTimeΩΩ∑ ø

fechaDesdeΩΩ¿  
,ΩΩ  À
DateTimeΩΩÃ ‘

fechaHastaΩΩ’ ﬂ
)ΩΩﬂ ‡
{
ææ 	
try
øø 
{
¿¿ 
return
¡¡ 
_db
¡¡ 
.
¡¡ 
Transaccion
¡¡ &
.
√√ 
Include
√√ 
(
√√ 
t
√√ 
=>
√√ !
t
√√" #
.
√√# $
Actor_negocio1
√√$ 2
)
√√2 3
.
ƒƒ 
Include
ƒƒ 
(
ƒƒ 
t
ƒƒ 
=>
ƒƒ !
t
ƒƒ" #
.
ƒƒ# $
Actor_negocio1
ƒƒ$ 2
.
ƒƒ2 3
Actor
ƒƒ3 8
)
ƒƒ8 9
.
«« 
Include
«« 
(
«« 
t
«« 
=>
«« !
t
««" #
.
««# $
Actor_negocio1
««$ 2
.
««2 3
Actor
««3 8
.
««8 9
Detalle_maestro
««9 H
)
««H I
.
…… 
Include
…… 
(
…… 
t
…… 
=>
…… !
t
……" #
.
……# $
Detalle_maestro1
……$ 4
)
……4 5
.
   
Include
   
(
   
t
   
=>
   !
t
  " #
.
  # $!
Detalle_transaccion
  $ 7
.
  7 8
Select
  8 >
(
  > ?
dt
  ? A
=>
  B D
dt
  E G
.
  G H
Concepto_negocio
  H X
)
  X Y
)
  Y Z
.
ÃÃ 
Include
ÃÃ 
(
ÃÃ 
t
ÃÃ 
=>
ÃÃ !
t
ÃÃ" #
.
ÃÃ# $ 
Estado_transaccion
ÃÃ$ 6
.
ÃÃ6 7
Select
ÃÃ7 =
(
ÃÃ= >
et
ÃÃ> @
=>
ÃÃA C
et
ÃÃD F
.
ÃÃF G
Detalle_maestro
ÃÃG V
)
ÃÃV W
)
ÃÃW X
.
ÕÕ 
Include
ÕÕ 
(
ÕÕ 
t
ÕÕ 
=>
ÕÕ !
t
ÕÕ" #
.
ÕÕ# $
Comprobante
ÕÕ$ /
)
ÕÕ/ 0
.
ŒŒ 
Include
ŒŒ 
(
ŒŒ 
t
ŒŒ 
=>
ŒŒ !
t
ŒŒ" #
.
ŒŒ# $
Comprobante
ŒŒ$ /
.
ŒŒ/ 0
Detalle_maestro
ŒŒ0 ?
)
ŒŒ? @
.
–– 
Include
–– 
(
–– 
t
–– 
=>
–– !
t
––" #
.
––# $
Transaccion3
––$ 0
.
––0 1
Comprobante
––1 <
)
––< =
.
—— 
Include
—— 
(
—— 
t
—— 
=>
—— !
t
——" #
.
——# $
Transaccion3
——$ 0
.
——0 1
Comprobante
——1 <
.
——< =
Detalle_maestro
——= L
)
——L M
.
““ 
Where
““ 
(
““ 
t
““ 
=>
““ 
t
““  !
.
““! "
fecha_inicio
““" .
>=
““/ 1

fechaDesde
““2 <
&&
““= ?
t
““@ A
.
““A B
fecha_inicio
““B N
<=
““O Q

fechaHasta
““R \
&&
““] _!
idsTiposTransaccion
““` s
.
““s t
Contains
““t |
(
““| }
t
““} ~
.
““~ "
id_tipo_transaccion““ í
)““í ì
&&““î ñ$
idsTiposComprobantes““ó ´
.““´ ¨
Contains““¨ ¥
(““¥ µ
t““µ ∂
.““∂ ∑
Comprobante““∑ ¬
.““¬ √#
id_tipo_comprobante““√ ÷
)““÷ ◊
&&
””  "

idsEstados
””# -
.
””- .
Contains
””. 6
(
””6 7
t
””7 8
.
””8 9 
Evento_transaccion
””9 K
.
””K L
OrderByDescending
””L ]
(
””] ^
est
””^ a
=>
””b d
est
””e h
.
””h i
id
””i k
)
””k l
.
””l m
FirstOrDefault
””m {
(
””{ |
)
””| }
.
””} ~
	id_evento””~ á
)””á à
)””à â
;””â ä
}
‘‘ 
catch
’’ 
(
’’ 
	Exception
’’ 
e
’’ 
)
’’ 
{
÷÷ 
throw
◊◊ 
e
◊◊ 
;
◊◊ 
}
ÿÿ 
}
ŸŸ 	
public
€€ 
IEnumerable
€€ 
<
€€ .
 ReporteVentaDetalladoSinConcepto
€€ ;
>
€€; <5
'ObtenerReporteVentaDetalladoSinConcepto
€€= d
(
€€d e
int
€€e h
[
€€h i
]
€€i j!
idsTiposTransaccion
€€k ~
,
€€~ 
int€€Ä É
[€€É Ñ
]€€Ñ Ö$
idsTiposComprobantes€€Ü ö
,€€ö õ
int€€ú ü
[€€ü †
]€€† °

idsEstados€€¢ ¨
,€€¨ ≠
DateTime€€Æ ∂

fechaDesde€€∑ ¡
,€€¡ ¬
DateTime€€√ À

fechaHasta€€Ã ÷
)€€÷ ◊
{
‹‹ 	
try
›› 
{
ﬁﬁ 
return
ﬂﬂ 
_db
ﬂﬂ 
.
ﬂﬂ 
Transaccion
ﬂﬂ &
.
ﬂﬂ& '
Where
ﬂﬂ' ,
(
ﬂﬂ, -
t
ﬂﬂ- .
=>
ﬂﬂ/ 1
t
ﬂﬂ2 3
.
ﬂﬂ3 4
fecha_inicio
ﬂﬂ4 @
>=
ﬂﬂA C

fechaDesde
ﬂﬂD N
&&
ﬂﬂO Q
t
ﬂﬂR S
.
ﬂﬂS T
fecha_inicio
ﬂﬂT `
<=
ﬂﬂa c

fechaHasta
ﬂﬂd n
&&
ﬂﬂo q"
idsTiposTransaccionﬂﬂr Ö
.ﬂﬂÖ Ü
ContainsﬂﬂÜ é
(ﬂﬂé è
tﬂﬂè ê
.ﬂﬂê ë#
id_tipo_transaccionﬂﬂë §
)ﬂﬂ§ •
&&ﬂﬂ¶ ®$
idsTiposComprobantesﬂﬂ© Ω
.ﬂﬂΩ æ
Containsﬂﬂæ ∆
(ﬂﬂ∆ «
tﬂﬂ« »
.ﬂﬂ» …
Comprobanteﬂﬂ… ‘
.ﬂﬂ‘ ’#
id_tipo_comprobanteﬂﬂ’ Ë
)ﬂﬂË È
&&ﬂﬂÍ Ï

idsEstadosﬂﬂÌ ˜
.ﬂﬂ˜ ¯
Containsﬂﬂ¯ Ä
(ﬂﬂÄ Å
tﬂﬂÅ Ç
.ﬂﬂÇ É"
Evento_transaccionﬂﬂÉ ï
.ﬂﬂï ñ!
OrderByDescendingﬂﬂñ ß
(ﬂﬂß ®
estﬂﬂ® ´
=>ﬂﬂ¨ Æ
estﬂﬂØ ≤
.ﬂﬂ≤ ≥
idﬂﬂ≥ µ
)ﬂﬂµ ∂
.ﬂﬂ∂ ∑
FirstOrDefaultﬂﬂ∑ ≈
(ﬂﬂ≈ ∆
)ﬂﬂ∆ «
.ﬂﬂ« »
	id_eventoﬂﬂ» —
)ﬂﬂ— “
)ﬂﬂ“ ”
.
‡‡ 
Select
‡‡ 
(
‡‡ 
t
‡‡ 
=>
‡‡  
new
‡‡! $.
 ReporteVentaDetalladoSinConcepto
‡‡% E
(
‡‡E F
)
‡‡F G
{
·· %
FechaEmisionComprobante
‚‚ /
=
‚‚0 1
t
‚‚2 3
.
‚‚3 4
fecha_inicio
‚‚4 @
,
‚‚@ A)
FechaVencimientoComprobante
„„ 3
=
„„4 5
t
„„6 7
.
„„7 8
	fecha_fin
„„8 A
,
„„A B
IdTipoComprobante
‰‰ )
=
‰‰* +
t
‰‰, -
.
‰‰- .
Comprobante
‰‰. 9
.
‰‰9 :
Detalle_maestro
‰‰: I
.
‰‰I J
id
‰‰J L
,
‰‰L M
TipoComprobante
ÂÂ '
=
ÂÂ( )
t
ÂÂ* +
.
ÂÂ+ ,
Comprobante
ÂÂ, 7
.
ÂÂ7 8
Detalle_maestro
ÂÂ8 G
.
ÂÂG H
codigo
ÂÂH N
,
ÂÂN O
SerieComprobante
ÊÊ (
=
ÊÊ) *
t
ÊÊ+ ,
.
ÊÊ, -
Comprobante
ÊÊ- 8
.
ÊÊ8 9
numero_serie
ÊÊ9 E
,
ÊÊE F
NumeroComprobante
ÁÁ )
=
ÁÁ* +
t
ÁÁ, -
.
ÁÁ- .
Comprobante
ÁÁ. 9
.
ÁÁ9 :
numero
ÁÁ: @
,
ÁÁ@ A+
TipoDocumentoIdentidadCliente
ËË 5
=
ËË6 7
(
ËË8 9
t
ËË9 :
.
ËË: ;
Actor_negocio1
ËË; I
.
ËËI J
id
ËËJ L
==
ËËM O
ActorSettings
ËËP ]
.
ËË] ^
Default
ËË^ e
.
ËËe f
IdClienteGenerico
ËËf w
)
ËËw x
?
ËËy z
$str
ËË{ }
:
ËË~ 
tËËÄ Å
.ËËÅ Ç
Actor_negocio1ËËÇ ê
.ËËê ë
ActorËËë ñ
.ËËñ ó
Detalle_maestroËËó ¶
.ËË¶ ß
codigoËËß ≠
,ËË≠ Æ-
NumeroDocumentoIdentidadCliente
ÈÈ 7
=
ÈÈ8 9
(
ÈÈ: ;
t
ÈÈ; <
.
ÈÈ< =
Actor_negocio1
ÈÈ= K
.
ÈÈK L
id
ÈÈL N
==
ÈÈO Q
ActorSettings
ÈÈR _
.
ÈÈ_ `
Default
ÈÈ` g
.
ÈÈg h
IdClienteGenerico
ÈÈh y
)
ÈÈy z
?
ÈÈ{ |
$strÈÈ} Ä
:ÈÈÅ Ç
tÈÈÉ Ñ
.ÈÈÑ Ö
Actor_negocio1ÈÈÖ ì
.ÈÈì î
ActorÈÈî ô
.ÈÈô ö*
numero_documento_identidadÈÈö ¥
,ÈÈ¥ µ 
RazonSocialCliente
ÍÍ *
=
ÍÍ+ ,
(
ÍÍ- .
t
ÍÍ. /
.
ÍÍ/ 0
Actor_negocio1
ÍÍ0 >
.
ÍÍ> ?
id
ÍÍ? A
==
ÍÍB D
ActorSettings
ÍÍE R
.
ÍÍR S
Default
ÍÍS Z
.
ÍÍZ [
IdClienteGenerico
ÍÍ[ l
)
ÍÍl m
?
ÍÍn o
$strÍÍp Å
:ÍÍÇ É
tÍÍÑ Ö
.ÍÍÖ Ü
Actor_negocio1ÍÍÜ î
.ÍÍî ï
ActorÍÍï ö
.ÍÍö õ
primer_nombreÍÍõ ®
.ÍÍ® ©
ReplaceÍÍ© ∞
(ÍÍ∞ ±
$strÍÍ± ¥
,ÍÍ¥ µ
$strÍÍ∂ π
)ÍÍπ ∫
,ÍÍ∫ ª
IdEstado
ÎÎ  
=
ÎÎ! "
(
ÎÎ# $
int
ÎÎ$ '
)
ÎÎ' (
t
ÎÎ( )
.
ÎÎ) *
id_estado_actual
ÎÎ* :
,
ÎÎ: ;

ValorTotal
ÏÏ "
=
ÏÏ# $
t
ÏÏ% &
.
ÏÏ& '
importe_total
ÏÏ' 4
,
ÏÏ4 5
ValorIsc
ÌÌ  
=
ÌÌ! "
(
ÌÌ# $
decimal
ÌÌ$ +
)
ÌÌ+ ,
t
ÌÌ, -
.
ÌÌ- .!
Detalle_transaccion
ÌÌ. A
.
ÌÌA B
Sum
ÌÌB E
(
ÌÌE F
dt
ÌÌF H
=>
ÌÌI K
dt
ÌÌL N
.
ÌÌN O
isc
ÌÌO R
)
ÌÌR S
,
ÌÌS T
ValorIgv
ÓÓ  
=
ÓÓ! "
(
ÓÓ# $
decimal
ÓÓ$ +
)
ÓÓ+ ,
t
ÓÓ, -
.
ÓÓ- .!
Detalle_transaccion
ÓÓ. A
.
ÓÓA B
Sum
ÓÓB E
(
ÓÓE F
dt
ÓÓF H
=>
ÓÓI K
dt
ÓÓL N
.
ÓÓN O
igv
ÓÓO R
)
ÓÓR S
,
ÓÓS T
Icbpers
ÔÔ 
=
ÔÔ  !
t
ÔÔ" #
.
ÔÔ# $#
Parametro_transaccion
ÔÔ$ 9
.
ÔÔ9 :
Where
ÔÔ: ?
(
ÔÔ? @
pt
ÔÔ@ B
=>
ÔÔC E
pt
ÔÔF H
.
ÔÔH I
id_parametro
ÔÔI U
==
ÔÔV X
MaestroSettings
ÔÔY h
.
ÔÔh i
Default
ÔÔi p
.
ÔÔp q.
IdDetalleMaestroParametroIcbperÔÔq ê
)ÔÔê ë
.ÔÔë í
SelectÔÔí ò
(ÔÔò ô
ptÔÔô õ
=>ÔÔú û
ptÔÔü °
.ÔÔ° ¢
valorÔÔ¢ ß
)ÔÔß ®
,ÔÔ® ©
ValorTipoCambio
 '
=
( )
t
* +
.
+ ,
tipo_cambio
, 7
,
7 8(
FechaComprobanteReferencia
ÒÒ 2
=
ÒÒ3 4
t
ÒÒ5 6
.
ÒÒ6 7
Transaccion3
ÒÒ7 C
!=
ÒÒD F
null
ÒÒG K
?
ÒÒL M
(
ÒÒN O
DateTime
ÒÒO W
?
ÒÒW X
)
ÒÒX Y
t
ÒÒY Z
.
ÒÒZ [
Transaccion3
ÒÒ[ g
.
ÒÒg h
fecha_inicio
ÒÒh t
:
ÒÒu v
null
ÒÒw {
,
ÒÒ{ |'
TipoComprobanteReferencia
ÚÚ 1
=
ÚÚ2 3
t
ÚÚ4 5
.
ÚÚ5 6
Transaccion3
ÚÚ6 B
!=
ÚÚC E
null
ÚÚF J
?
ÚÚK L
t
ÚÚM N
.
ÚÚN O
Transaccion3
ÚÚO [
.
ÚÚ[ \
Comprobante
ÚÚ\ g
.
ÚÚg h
Detalle_maestro
ÚÚh w
.
ÚÚw x
codigo
ÚÚx ~
:ÚÚ Ä
nullÚÚÅ Ö
,ÚÚÖ Ü(
SerieComprobanteReferencia
ÛÛ 2
=
ÛÛ3 4
t
ÛÛ5 6
.
ÛÛ6 7
Transaccion3
ÛÛ7 C
!=
ÛÛD F
null
ÛÛG K
?
ÛÛL M
t
ÛÛN O
.
ÛÛO P
Transaccion3
ÛÛP \
.
ÛÛ\ ]
Comprobante
ÛÛ] h
.
ÛÛh i
numero_serie
ÛÛi u
:
ÛÛv w
null
ÛÛx |
,
ÛÛ| })
NumeroComprobanteReferencia
ÙÙ 3
=
ÙÙ4 5
t
ÙÙ6 7
.
ÙÙ7 8
Transaccion3
ÙÙ8 D
!=
ÙÙE G
null
ÙÙH L
?
ÙÙM N
t
ÙÙO P
.
ÙÙP Q
Transaccion3
ÙÙQ ]
.
ÙÙ] ^
Comprobante
ÙÙ^ i
.
ÙÙi j
numero
ÙÙj p
:
ÙÙq r
$num
ÙÙs t
,
ÙÙt u
}
ıı 
)
ıı 
;
ıı 
}
ˆˆ 
catch
˜˜ 
(
˜˜ 
	Exception
˜˜ 
e
˜˜ 
)
˜˜ 
{
¯¯ 
throw
˘˘ 
e
˘˘ 
;
˘˘ 
}
˙˙ 
}
˚˚ 	
public
˝˝ 
IEnumerable
˝˝ 
<
˝˝ 
Transaccion
˝˝ &
>
˝˝& 'X
JObtenerTransaccionesInclusiveActoresYDetalleMaestroYEstadoYConceptoNegocio
˝˝( r
(
˝˝r s
int
˝˝s v
[
˝˝v w
]
˝˝w x"
idsTiposTransaccion˝˝y å
,˝˝å ç
int˝˝é ë
[˝˝ë í
]˝˝í ì$
idsTiposComprobantes˝˝î ®
,˝˝® ©
int˝˝™ ≠
[˝˝≠ Æ
]˝˝Æ Ø

idsEstados˝˝∞ ∫
,˝˝∫ ª
DateTime˝˝º ƒ

fechaDesde˝˝≈ œ
,˝˝œ –
DateTime˝˝— Ÿ

fechaHasta˝˝⁄ ‰
)˝˝‰ Â
{
˛˛ 	
try
ˇˇ 
{
ÄÄ 
return
ÅÅ 
_db
ÅÅ 
.
ÅÅ 
Transaccion
ÅÅ &
.
ÉÉ 
Include
ÉÉ 
(
ÉÉ 
t
ÉÉ 
=>
ÉÉ !
t
ÉÉ" #
.
ÉÉ# $
Actor_negocio1
ÉÉ$ 2
)
ÉÉ2 3
.
ÑÑ 
Include
ÑÑ 
(
ÑÑ 
t
ÑÑ 
=>
ÑÑ !
t
ÑÑ" #
.
ÑÑ# $
Actor_negocio1
ÑÑ$ 2
.
ÑÑ2 3
Actor
ÑÑ3 8
)
ÑÑ8 9
.
áá 
Include
áá 
(
áá 
t
áá 
=>
áá !
t
áá" #
.
áá# $
Actor_negocio1
áá$ 2
.
áá2 3
Actor
áá3 8
.
áá8 9
Detalle_maestro
áá9 H
)
ááH I
.
ââ 
Include
ââ 
(
ââ 
t
ââ 
=>
ââ !
t
ââ" #
.
ââ# $
Detalle_maestro1
ââ$ 4
)
ââ4 5
.
ää 
Include
ää 
(
ää 
t
ää 
=>
ää !
t
ää" #
.
ää# $!
Detalle_transaccion
ää$ 7
.
ää7 8
Select
ää8 >
(
ää> ?
dt
ää? A
=>
ääB D
dt
ääE G
.
ääG H
Concepto_negocio
ääH X
)
ääX Y
)
ääY Z
.
åå 
Include
åå 
(
åå 
t
åå 
=>
åå !
t
åå" #
.
åå# $ 
Estado_transaccion
åå$ 6
.
åå6 7
Select
åå7 =
(
åå= >
et
åå> @
=>
ååA C
et
ååD F
.
ååF G
Detalle_maestro
ååG V
)
ååV W
)
ååW X
.
çç 
Include
çç 
(
çç 
t
çç 
=>
çç !
t
çç" #
.
çç# $
Comprobante
çç$ /
)
çç/ 0
.
éé 
Include
éé 
(
éé 
t
éé 
=>
éé !
t
éé" #
.
éé# $
Comprobante
éé$ /
.
éé/ 0
Detalle_maestro
éé0 ?
)
éé? @
.
êê 
Include
êê 
(
êê 
t
êê 
=>
êê !
t
êê" #
.
êê# $
Transaccion3
êê$ 0
.
êê0 1
Comprobante
êê1 <
)
êê< =
.
ëë 
Include
ëë 
(
ëë 
t
ëë 
=>
ëë !
t
ëë" #
.
ëë# $
Transaccion3
ëë$ 0
.
ëë0 1
Comprobante
ëë1 <
.
ëë< =
Detalle_maestro
ëë= L
)
ëëL M
.
íí 
Where
íí 
(
íí 
t
íí 
=>
íí 
t
íí  !
.
íí! "
fecha_inicio
íí" .
>=
íí/ 1

fechaDesde
íí2 <
&&
íí= ?
t
íí@ A
.
ííA B
fecha_inicio
ííB N
<=
ííO Q

fechaHasta
ííR \
&&
íí] _!
idsTiposTransaccion
íí` s
.
íís t
Contains
íít |
(
íí| }
t
íí} ~
.
íí~ "
id_tipo_transaccioníí í
)ííí ì
&&ííî ñ$
idsTiposComprobantesííó ´
.íí´ ¨
Containsíí¨ ¥
(íí¥ µ
tííµ ∂
.íí∂ ∑
Comprobanteíí∑ ¬
.íí¬ √#
id_tipo_comprobanteíí√ ÷
)íí÷ ◊
&&
ìì! #

idsEstados
ìì$ .
.
ìì. /
Contains
ìì/ 7
(
ìì7 8
t
ìì8 9
.
ìì9 : 
Evento_transaccion
ìì: L
.
ììL M
OrderByDescending
ììM ^
(
ìì^ _
est
ìì_ b
=>
ììc e
est
ììf i
.
ììi j
id
ììj l
)
ììl m
.
ììm n
FirstOrDefault
ììn |
(
ìì| }
)
ìì} ~
.
ìì~ 
	id_eventoìì à
)ììà â
)ììâ ä
;ììä ã
}
îî 
catch
ïï 
(
ïï 
	Exception
ïï 
e
ïï 
)
ïï 
{
ññ 
throw
óó 
e
óó 
;
óó 
}
òò 
}
ôô 	
public
õõ 
long
õõ "
ObtenerIdTransaccion
õõ (
(
õõ( )
int
õõ) ,#
idActorNegocioInterno
õõ- B
,
õõB C
int
õõD G
idTipoTransaccion
õõH Y
,
õõY Z
int
õõ[ ^
idUltimoEstado
õõ_ m
)
õõm n
{
úú 	
try
ùù 
{
ûû 
return
üü 
_db
üü 
.
üü 
Transaccion
üü &
.
üü& '
SingleOrDefault
üü' 6
(
üü6 7
t
üü7 8
=>
üü9 ;
t
üü< =
.
üü= >!
id_tipo_transaccion
üü> Q
==
üüR T
idTipoTransaccion
üüU f
&&
üüg i
t
üüj k
.
üük l'
id_actor_negocio_internoüül Ñ
==üüÖ á%
idActorNegocioInternoüüà ù
&&üüû †
tüü° ¢
.üü¢ £ 
id_estado_actualüü£ ≥
==üü¥ ∂
idUltimoEstadoüü∑ ≈
)üü≈ ∆
.üü∆ «
idüü« …
;üü…  
}
†† 
catch
°° 
(
°° 
	Exception
°° 
e
°° 
)
°° 
{
¢¢ 
throw
££ 
new
££ 
DatosException
££ (
(
££( )
$str
££) L
,
££L M
e
££N O
)
££O P
;
££P Q
}
§§ 
}
¶¶ 	
public
®® 
long
®® "
ObtenerIdTransaccion
®® (
(
®®( )
int
®®) ,#
idActorNegocioInterno
®®- B
,
®®B C
int
®®D G
idTipoTransaccion
®®H Y
)
®®Y Z
{
©© 	
try
™™ 
{
´´ 
return
¨¨ 
_db
¨¨ 
.
¨¨ 
Transaccion
¨¨ &
.
¨¨& '
SingleOrDefault
¨¨' 6
(
¨¨6 7
t
¨¨7 8
=>
¨¨9 ;
t
¨¨< =
.
¨¨= >!
id_tipo_transaccion
¨¨> Q
==
¨¨R T
idTipoTransaccion
¨¨U f
&&
¨¨g i
t
¨¨j k
.
¨¨k l'
id_actor_negocio_interno¨¨l Ñ
==¨¨Ö á%
idActorNegocioInterno¨¨à ù
)¨¨ù û
.¨¨û ü
id¨¨ü °
;¨¨° ¢
}
≠≠ 
catch
ÆÆ 
(
ÆÆ 
	Exception
ÆÆ 
e
ÆÆ 
)
ÆÆ 
{
ØØ 
throw
∞∞ 
new
∞∞ 
DatosException
∞∞ (
(
∞∞( )
$str
∞∞) L
,
∞∞L M
e
∞∞N O
)
∞∞O P
;
∞∞P Q
}
±± 
}
≥≥ 	
public
∂∂ 
IEnumerable
∂∂ 
<
∂∂ 
long
∂∂ 
>
∂∂  $
ObtenerIdTransacciones
∂∂! 7
(
∂∂7 8
int
∂∂8 ;
idTipoTransaccion
∂∂< M
,
∂∂M N
int
∂∂O R
idTipoComprobante
∂∂S d
,
∂∂d e
int
∂∂f i
idEstado
∂∂j r
)
∂∂r s
{
∑∑ 	
try
∏∏ 
{
ππ 
return
∫∫ 
_db
∫∫ 
.
∫∫ 
Transaccion
∫∫ &
.
∫∫& '
Include
∫∫' .
(
∫∫. /
t
∫∫/ 0
=>
∫∫1 3
t
∫∫4 5
.
∫∫5 6
Comprobante
∫∫6 A
)
∫∫A B
.
ªª 
Where
ªª 
(
ªª 
t
ªª 
=>
ªª 
t
ªª  !
.
ªª! "!
id_tipo_transaccion
ªª" 5
==
ªª6 8
idTipoTransaccion
ªª9 J
&&
ªªK M
t
ªªN O
.
ªªO P
Comprobante
ªªP [
.
ªª[ \!
id_tipo_comprobante
ªª\ o
==
ªªp r 
idTipoComprobanteªªs Ñ
&&ªªÖ á
tªªà â
.ªªâ ä 
id_estado_actualªªä ö
==ªªõ ù
idEstadoªªû ¶
)ªª¶ ß
.ªªß ®
Selectªª® Æ
(ªªÆ Ø
tªªØ ∞
=>ªª± ≥
tªª¥ µ
.ªªµ ∂
idªª∂ ∏
)ªª∏ π
;ªªπ ∫
}
ºº 
catch
ΩΩ 
(
ΩΩ 
	Exception
ΩΩ 
e
ΩΩ 
)
ΩΩ 
{
ææ 
throw
øø 
e
øø 
;
øø 
}
¿¿ 
}
¡¡ 	
public
√√ 
IEnumerable
√√ 
<
√√ 
long
√√ 
>
√√  $
ObtenerIdTransacciones
√√! 7
(
√√7 8
int
√√8 ;
idTipoTransaccion
√√< M
,
√√M N
int
√√O R
[
√√R S
]
√√S T"
idsTiposComprobantes
√√U i
,
√√i j
int
√√k n
[
√√n o
]
√√o p

idsEstados
√√q {
)
√√{ |
{
ƒƒ 	
try
≈≈ 
{
∆∆ 
return
«« 
_db
«« 
.
«« 
Transaccion
«« &
.
««& '
Include
««' .
(
««. /
t
««/ 0
=>
««1 3
t
««4 5
.
««5 6
Comprobante
««6 A
)
««A B
.
»» 
Where
»» 
(
»» 
t
»» 
=>
»» 
t
»»  !
.
»»! "!
id_tipo_transaccion
»»" 5
==
»»6 8
idTipoTransaccion
»»9 J
&&
»»K M"
idsTiposComprobantes
»»N b
.
»»b c
Contains
»»c k
(
»»k l
t
»»l m
.
»»m n
Comprobante
»»n y
.
»»y z"
id_tipo_comprobante»»z ç
)»»ç é
&&»»è ë

idsEstados»»í ú
.»»ú ù
Contains»»ù •
(»»• ¶
(»»¶ ß
int»»ß ™
)»»™ ´
t»»´ ¨
.»»¨ ≠ 
id_estado_actual»»≠ Ω
)»»Ω æ
)»»æ ø
.»»ø ¿
Select»»¿ ∆
(»»∆ «
t»»« »
=>»»… À
t»»Ã Õ
.»»Õ Œ
id»»Œ –
)»»– —
;»»— “
}
…… 
catch
   
(
   
	Exception
   
e
   
)
   
{
ÀÀ 
throw
ÃÃ 
e
ÃÃ 
;
ÃÃ 
}
ÕÕ 
}
ŒŒ 	
public
““ 
IEnumerable
““ 
<
““ 
Transaccion
““ &
>
““& '"
ObtenerTransacciones
““( <
(
““< =
int
““= @
idTipoTransaccion
““A R
,
““R S
int
““T W
idTipoComprobante
““X i
,
““i j
int
““k n
idEventoAEvitar
““o ~
,
““~ 
DateTime““Ä à

fechaHasta““â ì
,““ì î
int““ï ò 
cantidadAObtener““ô ©
)““© ™
{
”” 	
try
‘‘ 
{
’’ 
return
÷÷ 
_db
÷÷ 
.
÷÷ 
Transaccion
÷÷ &
.
÷÷& '
Include
◊◊ 
(
◊◊ 
sbt
◊◊ 
=>
◊◊  "
sbt
◊◊# &
.
◊◊& '!
Detalle_transaccion
◊◊' :
)
◊◊: ;
.
◊◊; <
Include
ÿÿ 
(
ÿÿ 
sbt
ÿÿ 
=>
ÿÿ  "
sbt
ÿÿ# &
.
ÿÿ& '!
Detalle_transaccion
ÿÿ' :
.
ÿÿ: ;
Select
ÿÿ; A
(
ÿÿA B
dt
ÿÿB D
=>
ÿÿE G
dt
ÿÿH J
.
ÿÿJ K
Concepto_negocio
ÿÿK [
)
ÿÿ[ \
)
ÿÿ\ ]
.
ÿÿ] ^
Include
ŸŸ 
(
ŸŸ 
sbt
ŸŸ 
=>
ŸŸ  "
sbt
ŸŸ# &
.
ŸŸ& '
Detalle_maestro1
ŸŸ' 7
)
ŸŸ7 8
.
ŸŸ8 9
Include
⁄⁄ 
(
⁄⁄ 
sbt
⁄⁄ 
=>
⁄⁄  "
sbt
⁄⁄# &
.
⁄⁄& '
Comprobante
⁄⁄' 2
)
⁄⁄2 3
.
⁄⁄3 4
Include
€€ 
(
€€ 
sbt
€€ 
=>
€€  "
sbt
€€# &
.
€€& '#
Parametro_transaccion
€€' <
)
€€< =
.
€€= >
Include
‹‹ 
(
‹‹ 
sbt
‹‹ 
=>
‹‹  "
sbt
‹‹# &
.
‹‹& '
Actor_negocio
‹‹' 4
)
‹‹4 5
.
‹‹5 6
Include
›› 
(
›› 
sbt
›› 
=>
››  "
sbt
››# &
.
››& '
Actor_negocio1
››' 5
)
››5 6
.
››6 7
Include
ﬁﬁ 
(
ﬁﬁ 
sbt
ﬁﬁ 
=>
ﬁﬁ  "
sbt
ﬁﬁ# &
.
ﬁﬁ& '
Actor_negocio1
ﬁﬁ' 5
.
ﬁﬁ5 6
Actor
ﬁﬁ6 ;
)
ﬁﬁ; <
.
ﬁﬁ< =
Include
ﬂﬂ 
(
ﬂﬂ 
sbt
ﬂﬂ 
=>
ﬂﬂ  "
sbt
ﬂﬂ# &
.
ﬂﬂ& '
Actor_negocio1
ﬂﬂ' 5
.
ﬂﬂ5 6
Actor
ﬂﬂ6 ;
.
ﬂﬂ; <
	Direccion
ﬂﬂ< E
)
ﬂﬂE F
.
ﬂﬂF G
Include
‡‡ 
(
‡‡ 
sbt
‡‡ 
=>
‡‡  "
sbt
‡‡# &
.
‡‡& '
Actor_negocio2
‡‡' 5
)
‡‡5 6
.
‡‡6 7
Include
·· 
(
·· 
sbt
·· 
=>
··  "
sbt
··# &
.
··& ' 
Estado_transaccion
··' 9
)
··9 :
.
‚‚ 
Where
‚‚ 
(
‚‚ 
t
‚‚ 
=>
‚‚ 
t
‚‚  !
.
‚‚! "!
id_tipo_transaccion
‚‚" 5
==
‚‚6 8
idTipoTransaccion
‚‚9 J
&&
‚‚K M
t
‚‚N O
.
‚‚O P
Comprobante
‚‚P [
.
‚‚[ \!
id_tipo_comprobante
‚‚\ o
==
‚‚p r 
idTipoComprobante‚‚s Ñ
&&‚‚Ö á
(‚‚à â
!‚‚â ä
t‚‚ä ã
.‚‚ã å"
Evento_transaccion‚‚å û
.‚‚û ü
Any‚‚ü ¢
(‚‚¢ £
et‚‚£ •
=>‚‚¶ ®
et‚‚© ´
.‚‚´ ¨
	id_evento‚‚¨ µ
==‚‚∂ ∏
idEventoAEvitar‚‚π »
)‚‚» …
)‚‚…  
&&‚‚À Õ
t‚‚Œ œ
.‚‚œ –
fecha_inicio‚‚– ‹
<‚‚› ﬁ

fechaHasta‚‚ﬂ È
)‚‚È Í
.‚‚Í Î
Take‚‚Î Ô
(‚‚Ô  
cantidadAObtener‚‚ Ä
)‚‚Ä Å
;‚‚Å Ç
}
„„ 
catch
‰‰ 
(
‰‰ 
	Exception
‰‰ 
e
‰‰ 
)
‰‰ 
{
ÂÂ 
throw
ÊÊ 
e
ÊÊ 
;
ÊÊ 
}
ÁÁ 
}
ËË 	
public
ÍÍ 
IEnumerable
ÍÍ 
<
ÍÍ 
Transaccion
ÍÍ &
>
ÍÍ& '"
ObtenerTransacciones
ÍÍ( <
(
ÍÍ< =
int
ÍÍ= @
idTipoTransaccion
ÍÍA R
,
ÍÍR S
int
ÍÍT W
idTipoComprobante
ÍÍX i
,
ÍÍi j
int
ÍÍk n
idEventoAEvitar
ÍÍo ~
,
ÍÍ~ 
DateTimeÍÍÄ à

fechaHastaÍÍâ ì
)ÍÍì î
{
ÎÎ 	
try
ÏÏ 
{
ÌÌ 
return
ÓÓ 
_db
ÓÓ 
.
ÓÓ 
Transaccion
ÓÓ &
.
ÓÓ& '
Include
ÔÔ 
(
ÔÔ 
sbt
ÔÔ 
=>
ÔÔ !
sbt
ÔÔ" %
.
ÔÔ% &!
Detalle_transaccion
ÔÔ& 9
)
ÔÔ9 :
.
ÔÔ: ;
Include
 
(
 
sbt
 
=>
  "
sbt
# &
.
& '!
Detalle_transaccion
' :
.
: ;
Select
; A
(
A B
dt
B D
=>
E G
dt
H J
.
J K
Concepto_negocio
K [
)
[ \
)
\ ]
.
] ^
Include
ÒÒ 
(
ÒÒ 
sbt
ÒÒ 
=>
ÒÒ  "
sbt
ÒÒ# &
.
ÒÒ& '
Detalle_maestro1
ÒÒ' 7
)
ÒÒ7 8
.
ÒÒ8 9
Include
ÚÚ 
(
ÚÚ 
sbt
ÚÚ 
=>
ÚÚ  "
sbt
ÚÚ# &
.
ÚÚ& '
Comprobante
ÚÚ' 2
)
ÚÚ2 3
.
ÚÚ3 4
Include
ÛÛ 
(
ÛÛ 
sbt
ÛÛ 
=>
ÛÛ  "
sbt
ÛÛ# &
.
ÛÛ& '#
Parametro_transaccion
ÛÛ' <
)
ÛÛ< =
.
ÛÛ= >
Include
ÙÙ 
(
ÙÙ 
sbt
ÙÙ 
=>
ÙÙ  "
sbt
ÙÙ# &
.
ÙÙ& '
Actor_negocio
ÙÙ' 4
)
ÙÙ4 5
.
ÙÙ5 6
Include
ıı 
(
ıı 
sbt
ıı 
=>
ıı  "
sbt
ıı# &
.
ıı& '
Actor_negocio1
ıı' 5
)
ıı5 6
.
ıı6 7
Include
ˆˆ 
(
ˆˆ 
sbt
ˆˆ 
=>
ˆˆ  "
sbt
ˆˆ# &
.
ˆˆ& '
Actor_negocio1
ˆˆ' 5
.
ˆˆ5 6
Actor
ˆˆ6 ;
)
ˆˆ; <
.
ˆˆ< =
Include
˜˜ 
(
˜˜ 
sbt
˜˜ 
=>
˜˜  "
sbt
˜˜# &
.
˜˜& '
Actor_negocio1
˜˜' 5
.
˜˜5 6
Actor
˜˜6 ;
.
˜˜; <
	Direccion
˜˜< E
)
˜˜E F
.
˜˜F G
Include
¯¯ 
(
¯¯ 
sbt
¯¯ 
=>
¯¯  "
sbt
¯¯# &
.
¯¯& '
Actor_negocio2
¯¯' 5
)
¯¯5 6
.
¯¯6 7
Include
˘˘ 
(
˘˘ 
sbt
˘˘ 
=>
˘˘  "
sbt
˘˘# &
.
˘˘& ' 
Estado_transaccion
˘˘' 9
)
˘˘9 :
.
˙˙ 
Where
˙˙ 
(
˙˙ 
t
˙˙ 
=>
˙˙ 
t
˙˙  !
.
˙˙! "!
id_tipo_transaccion
˙˙" 5
==
˙˙6 8
idTipoTransaccion
˙˙9 J
&&
˙˙K M
t
˙˙N O
.
˙˙O P
Comprobante
˙˙P [
.
˙˙[ \!
id_tipo_comprobante
˙˙\ o
==
˙˙p r 
idTipoComprobante˙˙s Ñ
&&˙˙Ö á
(˙˙à â
!˙˙â ä
t˙˙ä ã
.˙˙ã å"
Evento_transaccion˙˙å û
.˙˙û ü
Any˙˙ü ¢
(˙˙¢ £
et˙˙£ •
=>˙˙¶ ®
et˙˙© ´
.˙˙´ ¨
	id_evento˙˙¨ µ
==˙˙∂ ∏
idEventoAEvitar˙˙π »
)˙˙» …
)˙˙…  
&&˙˙À Õ
t˙˙Œ œ
.˙˙œ –
fecha_inicio˙˙– ‹
<˙˙› ﬁ

fechaHasta˙˙ﬂ È
)˙˙È Í
;˙˙Í Î
}
˚˚ 
catch
¸¸ 
(
¸¸ 
	Exception
¸¸ 
e
¸¸ 
)
¸¸ 
{
˝˝ 
throw
˛˛ 
e
˛˛ 
;
˛˛ 
}
ˇˇ 
}
Ä	Ä	 	
public
Ç	Ç	 
IEnumerable
Ç	Ç	 
<
Ç	Ç	 
Transaccion
Ç	Ç	 &
>
Ç	Ç	& '"
ObtenerTransacciones
Ç	Ç	( <
(
Ç	Ç	< =
int
Ç	Ç	= @
[
Ç	Ç	@ A
]
Ç	Ç	A B#
idsTiposTransacciones
Ç	Ç	C X
,
Ç	Ç	X Y
int
Ç	Ç	Z ]
idTipoComprobante
Ç	Ç	^ o
,
Ç	Ç	o p
int
Ç	Ç	q t
idEventoAEvitarÇ	Ç	u Ñ
,Ç	Ç	Ñ Ö
DateTimeÇ	Ç	Ü é

fechaHastaÇ	Ç	è ô
)Ç	Ç	ô ö
{
É	É	 	
try
Ñ	Ñ	 
{
Ö	Ö	 
return
Ü	Ü	 
_db
Ü	Ü	 
.
Ü	Ü	 
Transaccion
Ü	Ü	 &
.
Ü	Ü	& '
Include
á	á	 
(
á	á	 
sbt
á	á	 
=>
á	á	  "
sbt
á	á	# &
.
á	á	& '!
Detalle_transaccion
á	á	' :
)
á	á	: ;
.
á	á	; <
Include
à	à	 
(
à	à	 
sbt
à	à	 
=>
à	à	  "
sbt
à	à	# &
.
à	à	& '!
Detalle_transaccion
à	à	' :
.
à	à	: ;
Select
à	à	; A
(
à	à	A B
dt
à	à	B D
=>
à	à	E G
dt
à	à	H J
.
à	à	J K
Concepto_negocio
à	à	K [
)
à	à	[ \
)
à	à	\ ]
.
à	à	] ^
Include
â	â	 
(
â	â	 
sbt
â	â	 
=>
â	â	  "
sbt
â	â	# &
.
â	â	& '
Detalle_maestro1
â	â	' 7
)
â	â	7 8
.
â	â	8 9
Include
ä	ä	 
(
ä	ä	 
sbt
ä	ä	 
=>
ä	ä	  "
sbt
ä	ä	# &
.
ä	ä	& '
Comprobante
ä	ä	' 2
)
ä	ä	2 3
.
ä	ä	3 4
Include
ã	ã	 
(
ã	ã	 
sbt
ã	ã	 
=>
ã	ã	  "
sbt
ã	ã	# &
.
ã	ã	& '#
Parametro_transaccion
ã	ã	' <
)
ã	ã	< =
.
ã	ã	= >
Include
å	å	 
(
å	å	 
sbt
å	å	 
=>
å	å	  "
sbt
å	å	# &
.
å	å	& '
Actor_negocio
å	å	' 4
)
å	å	4 5
.
å	å	5 6
Include
ç	ç	 
(
ç	ç	 
sbt
ç	ç	 
=>
ç	ç	  "
sbt
ç	ç	# &
.
ç	ç	& '
Actor_negocio1
ç	ç	' 5
)
ç	ç	5 6
.
ç	ç	6 7
Include
é	é	 
(
é	é	 
sbt
é	é	 
=>
é	é	  "
sbt
é	é	# &
.
é	é	& '
Actor_negocio1
é	é	' 5
.
é	é	5 6
Actor
é	é	6 ;
)
é	é	; <
.
é	é	< =
Include
è	è	 
(
è	è	 
sbt
è	è	 
=>
è	è	  "
sbt
è	è	# &
.
è	è	& '
Actor_negocio1
è	è	' 5
.
è	è	5 6
Actor
è	è	6 ;
.
è	è	; <
	Direccion
è	è	< E
)
è	è	E F
.
è	è	F G
Include
ê	ê	 
(
ê	ê	 
sbt
ê	ê	 
=>
ê	ê	  "
sbt
ê	ê	# &
.
ê	ê	& '
Actor_negocio2
ê	ê	' 5
)
ê	ê	5 6
.
ê	ê	6 7
Include
ë	ë	 
(
ë	ë	 
sbt
ë	ë	 
=>
ë	ë	  "
sbt
ë	ë	# &
.
ë	ë	& ' 
Estado_transaccion
ë	ë	' 9
)
ë	ë	9 :
.
í	í	 
Where
í	í	 
(
í	í	 
t
í	í	 
=>
í	í	 #
idsTiposTransacciones
í	í	  5
.
í	í	5 6
Contains
í	í	6 >
(
í	í	> ?
t
í	í	? @
.
í	í	@ A!
id_tipo_transaccion
í	í	A T
)
í	í	T U
&&
í	í	V X
t
í	í	Y Z
.
í	í	Z [
Comprobante
í	í	[ f
.
í	í	f g!
id_tipo_comprobante
í	í	g z
==
í	í	{ } 
idTipoComprobanteí	í	~ è
&&í	í	ê í
(í	í	ì î
!í	í	î ï
tí	í	ï ñ
.í	í	ñ ó"
Evento_transaccioní	í	ó ©
.í	í	© ™
Anyí	í	™ ≠
(í	í	≠ Æ
etí	í	Æ ∞
=>í	í	± ≥
etí	í	¥ ∂
.í	í	∂ ∑
	id_eventoí	í	∑ ¿
==í	í	¡ √
idEventoAEvitarí	í	ƒ ”
)í	í	” ‘
)í	í	‘ ’
&&í	í	÷ ÿ
tí	í	Ÿ ⁄
.í	í	⁄ €
fecha_inicioí	í	€ Á
<í	í	Ë È

fechaHastaí	í	Í Ù
)í	í	Ù ı
;í	í	ı ˆ
}
ì	ì	 
catch
î	î	 
(
î	î	 
	Exception
î	î	 
e
î	î	 
)
î	î	 
{
ï	ï	 
throw
ñ	ñ	 
e
ñ	ñ	 
;
ñ	ñ	 
}
ó	ó	 
}
ò	ò	 	
public
ú	ú	 
IEnumerable
ú	ú	 
<
ú	ú	 
Transaccion
ú	ú	 &
>
ú	ú	& 'i
ZObtenerTransaccionesInclusiveActoresYDetalleMaestroYEstadoFiltradoPorEmpleadoYActorInternoú	ú	( Ç
(ú	ú	Ç É
intú	ú	É Ü
[ú	ú	Ü á
]ú	ú	á à#
idsTiposTransaccionú	ú	â ú
,ú	ú	ú ù
intú	ú	û °
[ú	ú	° ¢
]ú	ú	¢ £$
idsTiposComprobantesú	ú	§ ∏
,ú	ú	∏ π
intú	ú	∫ Ω

idEmpleadoú	ú	æ »
,ú	ú	» …
intú	ú	  Õ%
idActorNegocioInternoú	ú	Œ „
,ú	ú	„ ‰
DateTimeú	ú	Â Ì

fechaDesdeú	ú	Ó ¯
,ú	ú	¯ ˘
DateTimeú	ú	˙ Ç

fechaHastaú	ú	É ç
)ú	ú	ç é
{
ù	ù	 	
try
û	û	 
{
ü	ü	 
return
†	†	 
_db
†	†	 
.
†	†	 
Transaccion
†	†	 &
.
†	†	& '
Include
†	†	' .
(
†	†	. /
t
†	†	/ 0
=>
†	†	1 3
t
†	†	4 5
.
†	†	5 6
Actor_negocio
†	†	6 C
)
†	†	C D
.
†	†	D E
Include
†	†	E L
(
†	†	L M
t
†	†	M N
=>
†	†	O Q
t
†	†	R S
.
†	†	S T
Actor_negocio1
†	†	T b
)
†	†	b c
.
†	†	c d
Include
†	†	d k
(
†	†	k l
t
†	†	l m
=>
†	†	n p
t
†	†	q r
.
†	†	r s
Actor_negocio2†	†	s Å
)†	†	Å Ç
.
°	°	 
Include
°	°	 
(
°	°	 
t
°	°	 
=>
°	°	 !
t
°	°	" #
.
°	°	# $
Actor_negocio
°	°	$ 1
.
°	°	1 2
Actor
°	°	2 7
.
°	°	7 8
Detalle_maestro
°	°	8 G
)
°	°	G H
.
¢	¢	 
Include
¢	¢	 
(
¢	¢	 
t
¢	¢	 
=>
¢	¢	 !
t
¢	¢	" #
.
¢	¢	# $
Actor_negocio1
¢	¢	$ 2
.
¢	¢	2 3
Actor
¢	¢	3 8
.
¢	¢	8 9
Detalle_maestro
¢	¢	9 H
)
¢	¢	H I
.
£	£	 
Include
£	£	 
(
£	£	 
t
£	£	 
=>
£	£	 !
t
£	£	" #
.
£	£	# $
Actor_negocio2
£	£	$ 2
.
£	£	2 3
Actor
£	£	3 8
.
£	£	8 9
Detalle_maestro
£	£	9 H
)
£	£	H I
.
§	§	 
Include
§	§	 
(
§	§	 
t
§	§	 
=>
§	§	 !
t
§	§	" #
.
§	§	# $
Detalle_maestro1
§	§	$ 4
)
§	§	4 5
.
§	§	5 6
Include
§	§	6 =
(
§	§	= >
t
§	§	> ?
=>
§	§	@ B
t
§	§	C D
.
§	§	D E 
Estado_transaccion
§	§	E W
.
§	§	W X
Select
§	§	X ^
(
§	§	^ _
et
§	§	_ a
=>
§	§	b d
et
§	§	e g
.
§	§	g h
Detalle_maestro
§	§	h w
)
§	§	w x
)
§	§	x y
.
•	•	 
Include
•	•	 
(
•	•	 
t
•	•	 
=>
•	•	 !
t
•	•	" #
.
•	•	# $
Comprobante
•	•	$ /
)
•	•	/ 0
.
•	•	0 1
Include
•	•	1 8
(
•	•	8 9
t
•	•	9 :
=>
•	•	; =
t
•	•	> ?
.
•	•	? @
Comprobante
•	•	@ K
.
•	•	K L
Detalle_maestro
•	•	L [
)
•	•	[ \
.
¶	¶	 
Include
¶	¶	 
(
¶	¶	 
t
¶	¶	 
=>
¶	¶	 !
t
¶	¶	" #
.
¶	¶	# $#
Parametro_transaccion
¶	¶	$ 9
)
¶	¶	9 :
.
ß	ß	 
Where
ß	ß	 
(
ß	ß	 
t
ß	ß	 
=>
ß	ß	 
t
ß	ß	  !
.
ß	ß	! "
id_empleado
ß	ß	" -
==
ß	ß	. 0

idEmpleado
ß	ß	1 ;
&&
ß	ß	< >
t
ß	ß	? @
.
ß	ß	@ A&
id_actor_negocio_interno
ß	ß	A Y
==
ß	ß	Z \#
idActorNegocioInterno
ß	ß	] r
&&
ß	ß	s u"
idsTiposTransaccionß	ß	v â
.ß	ß	â ä
Containsß	ß	ä í
(ß	ß	í ì
tß	ß	ì î
.ß	ß	î ï#
id_tipo_transaccionß	ß	ï ®
)ß	ß	® ©
&&ß	ß	™ ¨$
idsTiposComprobantesß	ß	≠ ¡
.ß	ß	¡ ¬
Containsß	ß	¬  
(ß	ß	  À
tß	ß	À Ã
.ß	ß	Ã Õ
Comprobanteß	ß	Õ ÿ
.ß	ß	ÿ Ÿ#
id_tipo_comprobanteß	ß	Ÿ Ï
)ß	ß	Ï Ì
&&ß	ß	Ó 
tß	ß	Ò Ú
.ß	ß	Ú Û
fecha_inicioß	ß	Û ˇ
>=ß	ß	Ä Ç

fechaDesdeß	ß	É ç
&&ß	ß	é ê
tß	ß	ë í
.ß	ß	í ì
fecha_inicioß	ß	ì ü
<=ß	ß	† ¢

fechaHastaß	ß	£ ≠
)ß	ß	≠ Æ
;ß	ß	Æ Ø
}
®	®	 
catch
©	©	 
(
©	©	 
	Exception
©	©	 
e
©	©	 
)
©	©	 
{
™	™	 
throw
´	´	 
new
´	´	 
DatosException
´	´	 (
(
´	´	( )
$str
´	´	) I
,
´	´	I J
e
´	´	K L
)
´	´	L M
;
´	´	M N
}
¨	¨	 
}
≠	≠	 	
public
∞	∞	 
IEnumerable
∞	∞	 
<
∞	∞	 
Resumen_Venta
∞	∞	 (
>
∞	∞	( )$
ObtenerResumenesVentas
∞	∞	* @
(
∞	∞	@ A
int
∞	∞	A D
[
∞	∞	D E
]
∞	∞	E F!
idsTiposTransaccion
∞	∞	G Z
,
∞	∞	Z [
int
∞	∞	\ _
[
∞	∞	_ `
]
∞	∞	` a"
idsTiposComprobantes
∞	∞	b v
,
∞	∞	v w
DateTime∞	∞	x Ä

fechaDesde∞	∞	Å ã
,∞	∞	ã å
DateTime∞	∞	ç ï

fechaHasta∞	∞	ñ †
)∞	∞	† °
{
±	±	 	
try
≤	≤	 
{
≥	≥	 
return
µ	µ	 
_db
µ	µ	 
.
µ	µ	 
Transaccion
µ	µ	 &
.
∂	∂	 
Where
∂	∂	 
(
∂	∂	 
t
∂	∂	  
=>
∂	∂	! #
t
∂	∂	$ %
.
∂	∂	% &
fecha_inicio
∂	∂	& 2
>=
∂	∂	3 5

fechaDesde
∂	∂	6 @
&&
∂	∂	A C
t
∂	∂	D E
.
∂	∂	E F
fecha_inicio
∂	∂	F R
<=
∂	∂	S U

fechaHasta
∂	∂	V `
&&
∑	∑	 "
idsTiposComprobantes
∑	∑	 .
.
∑	∑	. /
Contains
∑	∑	/ 7
(
∑	∑	7 8
t
∑	∑	8 9
.
∑	∑	9 :
Comprobante
∑	∑	: E
.
∑	∑	E F!
id_tipo_comprobante
∑	∑	F Y
)
∑	∑	Y Z
&&
∑	∑	[ ]!
idsTiposTransaccion
∑	∑	^ q
.
∑	∑	q r
Contains
∑	∑	r z
(
∑	∑	z {
t
∑	∑	{ |
.
∑	∑	| }"
id_tipo_transaccion∑	∑	} ê
)∑	∑	ê ë
)∑	∑	ë í
.
∏	∏	 
Select
∏	∏	 
(
∏	∏	  
t
π	π	 
=>
π	π	  
new
π	π	! $
Resumen_Venta
π	π	% 2
(
π	π	2 3
)
π	π	3 4
{
∫	∫	 
Id
ª	ª	  "
=
ª	ª	# $
t
ª	ª	% &
.
ª	ª	& '
id
ª	ª	' )
,
ª	ª	) *
FechaEmision
º	º	  ,
=
º	º	- .
t
º	º	/ 0
.
º	º	0 1
fecha_inicio
º	º	1 =
,
º	º	= >
IdTipoComprobante
Ω	Ω	  1
=
Ω	Ω	2 3
t
Ω	Ω	4 5
.
Ω	Ω	5 6
Comprobante
Ω	Ω	6 A
.
Ω	Ω	A B
Detalle_maestro
Ω	Ω	B Q
.
Ω	Ω	Q R
id
Ω	Ω	R T
,
Ω	Ω	T U
TipoComprobante
æ	æ	  /
=
æ	æ	0 1
t
æ	æ	2 3
.
æ	æ	3 4
Comprobante
æ	æ	4 ?
.
æ	æ	? @
Detalle_maestro
æ	æ	@ O
.
æ	æ	O P
nombre
æ	æ	P V
,
æ	æ	V W
CodigoComprobante
ø	ø	  1
=
ø	ø	2 3
t
ø	ø	4 5
.
ø	ø	5 6
Comprobante
ø	ø	6 A
.
ø	ø	A B
Detalle_maestro
ø	ø	B Q
.
ø	ø	Q R
valor
ø	ø	R W
,
ø	ø	W X
SerieComprobante
¿	¿	  0
=
¿	¿	1 2
t
¿	¿	3 4
.
¿	¿	4 5
Comprobante
¿	¿	5 @
.
¿	¿	@ A
numero_serie
¿	¿	A M
,
¿	¿	M N
NumeroComprobante
¡	¡	  1
=
¡	¡	2 3
t
¡	¡	4 5
.
¡	¡	5 6
Comprobante
¡	¡	6 A
.
¡	¡	A B
numero
¡	¡	B H
,
¡	¡	H I
	IdCliente
¬	¬	  )
=
¬	¬	* +
t
¬	¬	, -
.
¬	¬	- .&
id_actor_negocio_externo
¬	¬	. F
,
¬	¬	F G$
IdTipoDocumentoCliente
√	√	  6
=
√	√	7 8
t
√	√	9 :
.
√	√	: ;
Actor_negocio1
√	√	; I
.
√	√	I J
Actor
√	√	J O
.
√	√	O P$
id_documento_identidad
√	√	P f
,
√	√	f g
DocumentoCliente
ƒ	ƒ	  0
=
ƒ	ƒ	1 2
t
ƒ	ƒ	3 4
.
ƒ	ƒ	4 5
Actor_negocio1
ƒ	ƒ	5 C
.
ƒ	ƒ	C D
Actor
ƒ	ƒ	D I
.
ƒ	ƒ	I J(
numero_documento_identidad
ƒ	ƒ	J d
,
ƒ	ƒ	d e
NombreCliente
≈	≈	  -
=
≈	≈	. /
t
≈	≈	0 1
.
≈	≈	1 2
Actor_negocio1
≈	≈	2 @
.
≈	≈	@ A
Actor
≈	≈	A F
.
≈	≈	F G
primer_nombre
≈	≈	G T
,
≈	≈	T U 
PrimerNombreCajero
∆	∆	  2
=
∆	∆	3 4
t
∆	∆	5 6
.
∆	∆	6 7
Actor_negocio
∆	∆	7 D
.
∆	∆	D E
Actor
∆	∆	E J
.
∆	∆	J K
primer_nombre
∆	∆	K X
,
∆	∆	X Y!
SegundoNombreCajero
«	«	  3
=
«	«	4 5
t
«	«	6 7
.
«	«	7 8
Actor_negocio
«	«	8 E
.
«	«	E F
Actor
«	«	F K
.
«	«	K L
segundo_nombre
«	«	L Z
,
«	«	Z [ 
TercerNombreCajero
»	»	  2
=
»	»	3 4
t
»	»	5 6
.
»	»	6 7
Actor_negocio
»	»	7 D
.
»	»	D E
Actor
»	»	E J
.
»	»	J K
tercer_nombre
»	»	K X
,
»	»	X Y
ImporteTotal
…	…	  ,
=
…	…	- .
t
…	…	/ 0
.
…	…	0 1
importe_total
…	…	1 >
,
…	…	> ?'
ValorParametroTipoDeVenta
 	 	  9
=
 	 	: ;
t
 	 	< =
.
 	 	= >#
Parametro_transaccion
 	 	> S
.
 	 	S T
FirstOrDefault
 	 	T b
(
 	 	b c
pcn
 	 	c f
=>
 	 	g i
pcn
 	 	j m
.
 	 	m n
id_parametro
 	 	n z
==
 	 	{ }
MaestroSettings 	 	~ ç
. 	 	ç é
Default 	 	é ï
. 	 	ï ñ2
"IdDetalleMaestroParametroTipoVenta 	 	ñ ∏
) 	 	∏ π
!= 	 	∫ º
null 	 	Ω ¡
? 	 	¬ √
t 	 	ƒ ≈
. 	 	≈ ∆%
Parametro_transaccion 	 	∆ €
. 	 	€ ‹
FirstOrDefault 	 	‹ Í
( 	 	Í Î
pcn 	 	Î Ó
=> 	 	Ô Ò
pcn 	 	Ú ı
. 	 	ı ˆ
id_parametro 	 	ˆ Ç
== 	 	É Ö
MaestroSettings 	 	Ü ï
. 	 	ï ñ
Default 	 	ñ ù
. 	 	ù û2
"IdDetalleMaestroParametroTipoVenta 	 	û ¿
) 	 	¿ ¡
. 	 	¡ ¬
valor 	 	¬ «
: 	 	» …
null 	 	  Œ
, 	 	Œ œ&
ValorParametroModoDePago
À	À	  8
=
À	À	9 :
t
À	À	; <
.
À	À	< =#
Parametro_transaccion
À	À	= R
.
À	À	R S
FirstOrDefault
À	À	S a
(
À	À	a b
pcn
À	À	b e
=>
À	À	f h
pcn
À	À	i l
.
À	À	l m
id_parametro
À	À	m y
==
À	À	z |
MaestroSettingsÀ	À	} å
.À	À	å ç
DefaultÀ	À	ç î
.À	À	î ï3
#IdDetalleMaestroParametroModoDePagoÀ	À	ï ∏
)À	À	∏ π
!=À	À	∫ º
nullÀ	À	Ω ¡
?À	À	¬ √
tÀ	À	ƒ ≈
.À	À	≈ ∆%
Parametro_transaccionÀ	À	∆ €
.À	À	€ ‹
FirstOrDefaultÀ	À	‹ Í
(À	À	Í Î
pcnÀ	À	Î Ó
=>À	À	Ô Ò
pcnÀ	À	Ú ı
.À	À	ı ˆ
id_parametroÀ	À	ˆ Ç
==À	À	É Ö
MaestroSettingsÀ	À	Ü ï
.À	À	ï ñ
DefaultÀ	À	ñ ù
.À	À	ù û3
#IdDetalleMaestroParametroModoDePagoÀ	À	û ¡
)À	À	¡ ¬
.À	À	¬ √
valorÀ	À	√ »
:À	À	…  
nullÀ	À	À œ
,À	À	œ –*
ValorParametroAliasDeCliente
Ã	Ã	  <
=
Ã	Ã	= >
t
Ã	Ã	? @
.
Ã	Ã	@ A#
Parametro_transaccion
Ã	Ã	A V
.
Ã	Ã	V W
FirstOrDefault
Ã	Ã	W e
(
Ã	Ã	e f
pcn
Ã	Ã	f i
=>
Ã	Ã	j l
pcn
Ã	Ã	m p
.
Ã	Ã	p q
id_parametro
Ã	Ã	q }
==Ã	Ã	~ Ä
MaestroSettingsÃ	Ã	Å ê
.Ã	Ã	ê ë
DefaultÃ	Ã	ë ò
.Ã	Ã	ò ô5
%IdDetalleMaestroParametroAliasClienteÃ	Ã	ô æ
)Ã	Ã	æ ø
!=Ã	Ã	¿ ¬
nullÃ	Ã	√ «
?Ã	Ã	» …
tÃ	Ã	  À
.Ã	Ã	À Ã%
Parametro_transaccionÃ	Ã	Ã ·
.Ã	Ã	· ‚
FirstOrDefaultÃ	Ã	‚ 
(Ã	Ã	 Ò
pcnÃ	Ã	Ò Ù
=>Ã	Ã	ı ˜
pcnÃ	Ã	¯ ˚
.Ã	Ã	˚ ¸
id_parametroÃ	Ã	¸ à
==Ã	Ã	â ã
MaestroSettingsÃ	Ã	å õ
.Ã	Ã	õ ú
DefaultÃ	Ã	ú £
.Ã	Ã	£ §5
%IdDetalleMaestroParametroAliasClienteÃ	Ã	§ …
)Ã	Ã	…  
.Ã	Ã	  À
valorÃ	Ã	À –
:Ã	Ã	— “
nullÃ	Ã	” ◊
,Ã	Ã	◊ ÿ
IdEstado
Õ	Õ	  (
=
Õ	Õ	) *
t
Õ	Õ	+ ,
.
Õ	Õ	, -
id_estado_actual
Õ	Õ	- =
,
Õ	Õ	= >
Estado
Œ	Œ	  &
=
Œ	Œ	' (
t
Œ	Œ	) *
.
Œ	Œ	* +
Detalle_maestro
Œ	Œ	+ :
.
Œ	Œ	: ;
nombre
Œ	Œ	; A
,
Œ	Œ	A B
Transmitido
œ	œ	  +
=
œ	œ	, -
t
œ	œ	. /
.
œ	œ	/ 0 
Evento_transaccion
œ	œ	0 B
.
œ	œ	B C
Select
œ	œ	C I
(
œ	œ	I J
ev
œ	œ	J L
=>
œ	œ	M O
ev
œ	œ	P R
.
œ	œ	R S
	id_evento
œ	œ	S \
)
œ	œ	\ ]
.
œ	œ	] ^
Contains
œ	œ	^ f
(
œ	œ	f g
MaestroSettings
œ	œ	g v
.
œ	œ	v w
Default
œ	œ	w ~
.
œ	œ	~ 0
!IdDetalleMaestroEstadoTransmitidoœ	œ	 †
)œ	œ	† °
}
—	—	 
)
“	“	 
.
“	“	 
OrderByDescending
“	“	 '
(
“	“	' (
t
“	“	( )
=>
“	“	* ,
t
“	“	- .
.
“	“	. /
FechaEmision
“	“	/ ;
)
“	“	; <
;
“	“	< =
}
‘	‘	 
catch
’	’	 
(
’	’	 
	Exception
’	’	 
e
’	’	 
)
’	’	 
{
÷	÷	 
throw
◊	◊	 
new
◊	◊	 
DatosException
◊	◊	 (
(
◊	◊	( )
$str
◊	◊	) I
,
◊	◊	I J
e
◊	◊	K L
)
◊	◊	L M
;
◊	◊	M N
}
ÿ	ÿ	 
}
Ÿ	Ÿ	 	
public
⁄	⁄	 
IEnumerable
⁄	⁄	 
<
⁄	⁄	 
Resumen_Venta
⁄	⁄	 (
>
⁄	⁄	( )$
ObtenerResumenesVentas
⁄	⁄	* @
(
⁄	⁄	@ A
int
⁄	⁄	A D
[
⁄	⁄	D E
]
⁄	⁄	E F!
idsTiposTransaccion
⁄	⁄	G Z
,
⁄	⁄	Z [
int
⁄	⁄	\ _
[
⁄	⁄	_ `
]
⁄	⁄	` a"
idsTiposComprobantes
⁄	⁄	b v
,
⁄	⁄	v w
DateTime⁄	⁄	x Ä

fechaDesde⁄	⁄	Å ã
,⁄	⁄	ã å
DateTime⁄	⁄	ç ï

fechaHasta⁄	⁄	ñ †
,⁄	⁄	† °
int⁄	⁄	¢ •
	idCliente⁄	⁄	¶ Ø
)⁄	⁄	Ø ∞
{
€	€	 	
try
‹	‹	 
{
›	›	 
return
ﬂ	ﬂ	 
_db
ﬂ	ﬂ	 
.
ﬂ	ﬂ	 
Transaccion
ﬂ	ﬂ	 &
.
‡	‡	 
Where
‡	‡	 
(
‡	‡	 
t
‡	‡	  
=>
‡	‡	! #
t
‡	‡	$ %
.
‡	‡	% &&
id_actor_negocio_externo
‡	‡	& >
==
‡	‡	? A
	idCliente
‡	‡	B K
&&
‡	‡	L N
t
‡	‡	O P
.
‡	‡	P Q
fecha_inicio
‡	‡	Q ]
>=
‡	‡	^ `

fechaDesde
‡	‡	a k
&&
‡	‡	l n
t
‡	‡	o p
.
‡	‡	p q
fecha_inicio
‡	‡	q }
<=‡	‡	~ Ä

fechaHasta‡	‡	Å ã
&&
·	·	 "
idsTiposComprobantes
·	·	 .
.
·	·	. /
Contains
·	·	/ 7
(
·	·	7 8
t
·	·	8 9
.
·	·	9 :
Comprobante
·	·	: E
.
·	·	E F!
id_tipo_comprobante
·	·	F Y
)
·	·	Y Z
&&
·	·	[ ]!
idsTiposTransaccion
·	·	^ q
.
·	·	q r
Contains
·	·	r z
(
·	·	z {
t
·	·	{ |
.
·	·	| }"
id_tipo_transaccion·	·	} ê
)·	·	ê ë
)·	·	ë í
.
‚	‚	 
Select
‚	‚	 
(
‚	‚	  
t
„	„	 
=>
„	„	  
new
„	„	! $
Resumen_Venta
„	„	% 2
(
„	„	2 3
)
„	„	3 4
{
‰	‰	 
Id
Â	Â	  "
=
Â	Â	# $
t
Â	Â	% &
.
Â	Â	& '
id
Â	Â	' )
,
Â	Â	) *
FechaEmision
Ê	Ê	  ,
=
Ê	Ê	- .
t
Ê	Ê	/ 0
.
Ê	Ê	0 1
fecha_inicio
Ê	Ê	1 =
,
Ê	Ê	= >
IdTipoComprobante
Á	Á	  1
=
Á	Á	2 3
t
Á	Á	4 5
.
Á	Á	5 6
Comprobante
Á	Á	6 A
.
Á	Á	A B
Detalle_maestro
Á	Á	B Q
.
Á	Á	Q R
id
Á	Á	R T
,
Á	Á	T U
TipoComprobante
Ë	Ë	  /
=
Ë	Ë	0 1
t
Ë	Ë	2 3
.
Ë	Ë	3 4
Comprobante
Ë	Ë	4 ?
.
Ë	Ë	? @
Detalle_maestro
Ë	Ë	@ O
.
Ë	Ë	O P
nombre
Ë	Ë	P V
,
Ë	Ë	V W
CodigoComprobante
È	È	  1
=
È	È	2 3
t
È	È	4 5
.
È	È	5 6
Comprobante
È	È	6 A
.
È	È	A B
Detalle_maestro
È	È	B Q
.
È	È	Q R
valor
È	È	R W
,
È	È	W X
SerieComprobante
Í	Í	  0
=
Í	Í	1 2
t
Í	Í	3 4
.
Í	Í	4 5
Comprobante
Í	Í	5 @
.
Í	Í	@ A
numero_serie
Í	Í	A M
,
Í	Í	M N
NumeroComprobante
Î	Î	  1
=
Î	Î	2 3
t
Î	Î	4 5
.
Î	Î	5 6
Comprobante
Î	Î	6 A
.
Î	Î	A B
numero
Î	Î	B H
,
Î	Î	H I
	IdCliente
Ï	Ï	  )
=
Ï	Ï	* +
t
Ï	Ï	, -
.
Ï	Ï	- .&
id_actor_negocio_externo
Ï	Ï	. F
,
Ï	Ï	F G$
IdTipoDocumentoCliente
Ì	Ì	  6
=
Ì	Ì	7 8
t
Ì	Ì	9 :
.
Ì	Ì	: ;
Actor_negocio1
Ì	Ì	; I
.
Ì	Ì	I J
Actor
Ì	Ì	J O
.
Ì	Ì	O P$
id_documento_identidad
Ì	Ì	P f
,
Ì	Ì	f g
DocumentoCliente
Ó	Ó	  0
=
Ó	Ó	1 2
t
Ó	Ó	3 4
.
Ó	Ó	4 5
Actor_negocio1
Ó	Ó	5 C
.
Ó	Ó	C D
Actor
Ó	Ó	D I
.
Ó	Ó	I J(
numero_documento_identidad
Ó	Ó	J d
,
Ó	Ó	d e
NombreCliente
Ô	Ô	  -
=
Ô	Ô	. /
t
Ô	Ô	0 1
.
Ô	Ô	1 2
Actor_negocio1
Ô	Ô	2 @
.
Ô	Ô	@ A
Actor
Ô	Ô	A F
.
Ô	Ô	F G
primer_nombre
Ô	Ô	G T
,
Ô	Ô	T U 
PrimerNombreCajero
		  2
=
		3 4
t
		5 6
.
		6 7
Actor_negocio
		7 D
.
		D E
Actor
		E J
.
		J K
primer_nombre
		K X
,
		X Y!
SegundoNombreCajero
Ò	Ò	  3
=
Ò	Ò	4 5
t
Ò	Ò	6 7
.
Ò	Ò	7 8
Actor_negocio
Ò	Ò	8 E
.
Ò	Ò	E F
Actor
Ò	Ò	F K
.
Ò	Ò	K L
segundo_nombre
Ò	Ò	L Z
,
Ò	Ò	Z [ 
TercerNombreCajero
Ú	Ú	  2
=
Ú	Ú	3 4
t
Ú	Ú	5 6
.
Ú	Ú	6 7
Actor_negocio
Ú	Ú	7 D
.
Ú	Ú	D E
Actor
Ú	Ú	E J
.
Ú	Ú	J K
tercer_nombre
Ú	Ú	K X
,
Ú	Ú	X Y
ImporteTotal
Û	Û	  ,
=
Û	Û	- .
t
Û	Û	/ 0
.
Û	Û	0 1
importe_total
Û	Û	1 >
,
Û	Û	> ?'
ValorParametroTipoDeVenta
Ù	Ù	  9
=
Ù	Ù	: ;
t
Ù	Ù	< =
.
Ù	Ù	= >#
Parametro_transaccion
Ù	Ù	> S
.
Ù	Ù	S T
FirstOrDefault
Ù	Ù	T b
(
Ù	Ù	b c
pcn
Ù	Ù	c f
=>
Ù	Ù	g i
pcn
Ù	Ù	j m
.
Ù	Ù	m n
id_parametro
Ù	Ù	n z
==
Ù	Ù	{ }
MaestroSettingsÙ	Ù	~ ç
.Ù	Ù	ç é
DefaultÙ	Ù	é ï
.Ù	Ù	ï ñ2
"IdDetalleMaestroParametroTipoVentaÙ	Ù	ñ ∏
)Ù	Ù	∏ π
!=Ù	Ù	∫ º
nullÙ	Ù	Ω ¡
?Ù	Ù	¬ √
tÙ	Ù	ƒ ≈
.Ù	Ù	≈ ∆%
Parametro_transaccionÙ	Ù	∆ €
.Ù	Ù	€ ‹
FirstOrDefaultÙ	Ù	‹ Í
(Ù	Ù	Í Î
pcnÙ	Ù	Î Ó
=>Ù	Ù	Ô Ò
pcnÙ	Ù	Ú ı
.Ù	Ù	ı ˆ
id_parametroÙ	Ù	ˆ Ç
==Ù	Ù	É Ö
MaestroSettingsÙ	Ù	Ü ï
.Ù	Ù	ï ñ
DefaultÙ	Ù	ñ ù
.Ù	Ù	ù û2
"IdDetalleMaestroParametroTipoVentaÙ	Ù	û ¿
)Ù	Ù	¿ ¡
.Ù	Ù	¡ ¬
valorÙ	Ù	¬ «
:Ù	Ù	» …
nullÙ	Ù	  Œ
,Ù	Ù	Œ œ&
ValorParametroModoDePago
ı	ı	  8
=
ı	ı	9 :
t
ı	ı	; <
.
ı	ı	< =#
Parametro_transaccion
ı	ı	= R
.
ı	ı	R S
FirstOrDefault
ı	ı	S a
(
ı	ı	a b
pcn
ı	ı	b e
=>
ı	ı	f h
pcn
ı	ı	i l
.
ı	ı	l m
id_parametro
ı	ı	m y
==
ı	ı	z |
MaestroSettingsı	ı	} å
.ı	ı	å ç
Defaultı	ı	ç î
.ı	ı	î ï3
#IdDetalleMaestroParametroModoDePagoı	ı	ï ∏
)ı	ı	∏ π
!=ı	ı	∫ º
nullı	ı	Ω ¡
?ı	ı	¬ √
tı	ı	ƒ ≈
.ı	ı	≈ ∆%
Parametro_transaccionı	ı	∆ €
.ı	ı	€ ‹
FirstOrDefaultı	ı	‹ Í
(ı	ı	Í Î
pcnı	ı	Î Ó
=>ı	ı	Ô Ò
pcnı	ı	Ú ı
.ı	ı	ı ˆ
id_parametroı	ı	ˆ Ç
==ı	ı	É Ö
MaestroSettingsı	ı	Ü ï
.ı	ı	ï ñ
Defaultı	ı	ñ ù
.ı	ı	ù û3
#IdDetalleMaestroParametroModoDePagoı	ı	û ¡
)ı	ı	¡ ¬
.ı	ı	¬ √
valorı	ı	√ »
:ı	ı	…  
nullı	ı	À œ
,ı	ı	œ –*
ValorParametroAliasDeCliente
ˆ	ˆ	  <
=
ˆ	ˆ	= >
t
ˆ	ˆ	? @
.
ˆ	ˆ	@ A#
Parametro_transaccion
ˆ	ˆ	A V
.
ˆ	ˆ	V W
FirstOrDefault
ˆ	ˆ	W e
(
ˆ	ˆ	e f
pcn
ˆ	ˆ	f i
=>
ˆ	ˆ	j l
pcn
ˆ	ˆ	m p
.
ˆ	ˆ	p q
id_parametro
ˆ	ˆ	q }
==ˆ	ˆ	~ Ä
MaestroSettingsˆ	ˆ	Å ê
.ˆ	ˆ	ê ë
Defaultˆ	ˆ	ë ò
.ˆ	ˆ	ò ô5
%IdDetalleMaestroParametroAliasClienteˆ	ˆ	ô æ
)ˆ	ˆ	æ ø
!=ˆ	ˆ	¿ ¬
nullˆ	ˆ	√ «
?ˆ	ˆ	» …
tˆ	ˆ	  À
.ˆ	ˆ	À Ã%
Parametro_transaccionˆ	ˆ	Ã ·
.ˆ	ˆ	· ‚
FirstOrDefaultˆ	ˆ	‚ 
(ˆ	ˆ	 Ò
pcnˆ	ˆ	Ò Ù
=>ˆ	ˆ	ı ˜
pcnˆ	ˆ	¯ ˚
.ˆ	ˆ	˚ ¸
id_parametroˆ	ˆ	¸ à
==ˆ	ˆ	â ã
MaestroSettingsˆ	ˆ	å õ
.ˆ	ˆ	õ ú
Defaultˆ	ˆ	ú £
.ˆ	ˆ	£ §5
%IdDetalleMaestroParametroAliasClienteˆ	ˆ	§ …
)ˆ	ˆ	…  
.ˆ	ˆ	  À
valorˆ	ˆ	À –
:ˆ	ˆ	— “
nullˆ	ˆ	” ◊
,ˆ	ˆ	◊ ÿ
IdEstado
˜	˜	  (
=
˜	˜	) *
t
˜	˜	+ ,
.
˜	˜	, -
id_estado_actual
˜	˜	- =
,
˜	˜	= >
Estado
¯	¯	  &
=
¯	¯	' (
t
¯	¯	) *
.
¯	¯	* +
Detalle_maestro
¯	¯	+ :
.
¯	¯	: ;
nombre
¯	¯	; A
,
¯	¯	A B
Transmitido
˘	˘	  +
=
˘	˘	, -
t
˘	˘	. /
.
˘	˘	/ 0 
Evento_transaccion
˘	˘	0 B
.
˘	˘	B C
Select
˘	˘	C I
(
˘	˘	I J
ev
˘	˘	J L
=>
˘	˘	M O
ev
˘	˘	P R
.
˘	˘	R S
	id_evento
˘	˘	S \
)
˘	˘	\ ]
.
˘	˘	] ^
Contains
˘	˘	^ f
(
˘	˘	f g
MaestroSettings
˘	˘	g v
.
˘	˘	v w
Default
˘	˘	w ~
.
˘	˘	~ 0
!IdDetalleMaestroEstadoTransmitido˘	˘	 †
)˘	˘	† °
}
˚	˚	 
)
¸	¸	 
.
¸	¸	 
OrderByDescending
¸	¸	 '
(
¸	¸	' (
t
¸	¸	( )
=>
¸	¸	* ,
t
¸	¸	- .
.
¸	¸	. /
FechaEmision
¸	¸	/ ;
)
¸	¸	; <
;
¸	¸	< =
}
˛	˛	 
catch
ˇ	ˇ	 
(
ˇ	ˇ	 
	Exception
ˇ	ˇ	 
e
ˇ	ˇ	 
)
ˇ	ˇ	 
{
Ä
Ä
 
throw
Å
Å
 
new
Å
Å
 
DatosException
Å
Å
 (
(
Å
Å
( )
$str
Å
Å
) I
,
Å
Å
I J
e
Å
Å
K L
)
Å
Å
L M
;
Å
Å
M N
}
Ç
Ç
 
}
É
É
 	
public
Ñ
Ñ
 
IEnumerable
Ñ
Ñ
 
<
Ñ
Ñ
 
Resumen_Venta
Ñ
Ñ
 (
>
Ñ
Ñ
( )$
ObtenerResumenesVentas
Ñ
Ñ
* @
(
Ñ
Ñ
@ A
int
Ñ
Ñ
A D
[
Ñ
Ñ
D E
]
Ñ
Ñ
E F!
idsTiposTransaccion
Ñ
Ñ
G Z
,
Ñ
Ñ
Z [
int
Ñ
Ñ
\ _
[
Ñ
Ñ
_ `
]
Ñ
Ñ
` a"
idsTiposComprobantes
Ñ
Ñ
b v
,
Ñ
Ñ
v w
int
Ñ
Ñ
x {

idEmpleadoÑ
Ñ
| Ü
,Ñ
Ñ
Ü á
intÑ
Ñ
à ã%
idActorNegocioInternoÑ
Ñ
å °
,Ñ
Ñ
° ¢
DateTimeÑ
Ñ
£ ´

fechaDesdeÑ
Ñ
¨ ∂
,Ñ
Ñ
∂ ∑
DateTimeÑ
Ñ
∏ ¿

fechaHastaÑ
Ñ
¡ À
)Ñ
Ñ
À Ã
{
Ö
Ö
 	
try
Ü
Ü
 
{
á
á
 
return
â
â
 
_db
â
â
 
.
â
â
 
Transaccion
â
â
 &
.
ä
ä
 
Where
ä
ä
 
(
ä
ä
 
t
ä
ä
  
=>
ä
ä
! #
t
ä
ä
$ %
.
ä
ä
% &
fecha_inicio
ä
ä
& 2
>=
ä
ä
3 5

fechaDesde
ä
ä
6 @
&&
ä
ä
A C
t
ä
ä
D E
.
ä
ä
E F
fecha_inicio
ä
ä
F R
<=
ä
ä
S U

fechaHasta
ä
ä
V `
&&
ä
ä
a c

idEmpleado
ä
ä
d n
==
ä
ä
o q
t
ä
ä
r s
.
ä
ä
s t
id_empleado
ä
ä
t 
&&ä
ä
Ä Ç%
idActorNegocioInternoä
ä
É ò
==ä
ä
ô õ
tä
ä
ú ù
.ä
ä
ù û(
id_actor_negocio_internoä
ä
û ∂
&&
ã
ã
 "
idsTiposComprobantes
ã
ã
 .
.
ã
ã
. /
Contains
ã
ã
/ 7
(
ã
ã
7 8
t
ã
ã
8 9
.
ã
ã
9 :
Comprobante
ã
ã
: E
.
ã
ã
E F!
id_tipo_comprobante
ã
ã
F Y
)
ã
ã
Y Z
&&
ã
ã
[ ]!
idsTiposTransaccion
ã
ã
^ q
.
ã
ã
q r
Contains
ã
ã
r z
(
ã
ã
z {
t
ã
ã
{ |
.
ã
ã
| }"
id_tipo_transaccionã
ã
} ê
)ã
ã
ê ë
)ã
ã
ë í
.
å
å
 
Select
å
å
 
(
å
å
  
t
é
é
 
=>
é
é
  
new
é
é
! $
Resumen_Venta
é
é
% 2
(
é
é
2 3
)
é
é
3 4
{
è
è
 
Id
ê
ê
  "
=
ê
ê
# $
t
ê
ê
% &
.
ê
ê
& '
id
ê
ê
' )
,
ê
ê
) *
FechaEmision
ë
ë
  ,
=
ë
ë
- .
t
ë
ë
/ 0
.
ë
ë
0 1
fecha_inicio
ë
ë
1 =
,
ë
ë
= >
IdTipoComprobante
í
í
  1
=
í
í
2 3
t
í
í
4 5
.
í
í
5 6
Comprobante
í
í
6 A
.
í
í
A B
Detalle_maestro
í
í
B Q
.
í
í
Q R
id
í
í
R T
,
í
í
T U
TipoComprobante
ì
ì
  /
=
ì
ì
0 1
t
ì
ì
2 3
.
ì
ì
3 4
Comprobante
ì
ì
4 ?
.
ì
ì
? @
Detalle_maestro
ì
ì
@ O
.
ì
ì
O P
nombre
ì
ì
P V
,
ì
ì
V W
CodigoComprobante
î
î
  1
=
î
î
2 3
t
î
î
4 5
.
î
î
5 6
Comprobante
î
î
6 A
.
î
î
A B
Detalle_maestro
î
î
B Q
.
î
î
Q R
valor
î
î
R W
,
î
î
W X
SerieComprobante
ï
ï
  0
=
ï
ï
1 2
t
ï
ï
3 4
.
ï
ï
4 5
Comprobante
ï
ï
5 @
.
ï
ï
@ A
numero_serie
ï
ï
A M
,
ï
ï
M N
NumeroComprobante
ñ
ñ
  1
=
ñ
ñ
2 3
t
ñ
ñ
4 5
.
ñ
ñ
5 6
Comprobante
ñ
ñ
6 A
.
ñ
ñ
A B
numero
ñ
ñ
B H
,
ñ
ñ
H I
	IdCliente
ó
ó
  )
=
ó
ó
* +
t
ó
ó
, -
.
ó
ó
- .&
id_actor_negocio_externo
ó
ó
. F
,
ó
ó
F G$
IdTipoDocumentoCliente
ò
ò
  6
=
ò
ò
7 8
t
ò
ò
9 :
.
ò
ò
: ;
Actor_negocio1
ò
ò
; I
.
ò
ò
I J
Actor
ò
ò
J O
.
ò
ò
O P$
id_documento_identidad
ò
ò
P f
,
ò
ò
f g
DocumentoCliente
ô
ô
  0
=
ô
ô
1 2
t
ô
ô
3 4
.
ô
ô
4 5
Actor_negocio1
ô
ô
5 C
.
ô
ô
C D
Actor
ô
ô
D I
.
ô
ô
I J(
numero_documento_identidad
ô
ô
J d
,
ô
ô
d e
NombreCliente
ö
ö
  -
=
ö
ö
. /
t
ö
ö
0 1
.
ö
ö
1 2
Actor_negocio1
ö
ö
2 @
.
ö
ö
@ A
Actor
ö
ö
A F
.
ö
ö
F G
primer_nombre
ö
ö
G T
,
ö
ö
T U 
PrimerNombreCajero
õ
õ
  2
=
õ
õ
3 4
t
õ
õ
5 6
.
õ
õ
6 7
Actor_negocio
õ
õ
7 D
.
õ
õ
D E
Actor
õ
õ
E J
.
õ
õ
J K
primer_nombre
õ
õ
K X
,
õ
õ
X Y!
SegundoNombreCajero
ú
ú
  3
=
ú
ú
4 5
t
ú
ú
6 7
.
ú
ú
7 8
Actor_negocio
ú
ú
8 E
.
ú
ú
E F
Actor
ú
ú
F K
.
ú
ú
K L
segundo_nombre
ú
ú
L Z
,
ú
ú
Z [ 
TercerNombreCajero
ù
ù
  2
=
ù
ù
3 4
t
ù
ù
5 6
.
ù
ù
6 7
Actor_negocio
ù
ù
7 D
.
ù
ù
D E
Actor
ù
ù
E J
.
ù
ù
J K
tercer_nombre
ù
ù
K X
,
ù
ù
X Y
ImporteTotal
û
û
  ,
=
û
û
- .
t
û
û
/ 0
.
û
û
0 1
importe_total
û
û
1 >
,
û
û
> ?'
ValorParametroTipoDeVenta
ü
ü
  9
=
ü
ü
: ;
t
ü
ü
< =
.
ü
ü
= >#
Parametro_transaccion
ü
ü
> S
.
ü
ü
S T
FirstOrDefault
ü
ü
T b
(
ü
ü
b c
pcn
ü
ü
c f
=>
ü
ü
g i
pcn
ü
ü
j m
.
ü
ü
m n
id_parametro
ü
ü
n z
==
ü
ü
{ }
MaestroSettingsü
ü
~ ç
.ü
ü
ç é
Defaultü
ü
é ï
.ü
ü
ï ñ2
"IdDetalleMaestroParametroTipoVentaü
ü
ñ ∏
)ü
ü
∏ π
!=ü
ü
∫ º
nullü
ü
Ω ¡
?ü
ü
¬ √
tü
ü
ƒ ≈
.ü
ü
≈ ∆%
Parametro_transaccionü
ü
∆ €
.ü
ü
€ ‹
FirstOrDefaultü
ü
‹ Í
(ü
ü
Í Î
pcnü
ü
Î Ó
=>ü
ü
Ô Ò
pcnü
ü
Ú ı
.ü
ü
ı ˆ
id_parametroü
ü
ˆ Ç
==ü
ü
É Ö
MaestroSettingsü
ü
Ü ï
.ü
ü
ï ñ
Defaultü
ü
ñ ù
.ü
ü
ù û2
"IdDetalleMaestroParametroTipoVentaü
ü
û ¿
)ü
ü
¿ ¡
.ü
ü
¡ ¬
valorü
ü
¬ «
:ü
ü
» …
nullü
ü
  Œ
,ü
ü
Œ œ&
ValorParametroModoDePago
†
†
  8
=
†
†
9 :
t
†
†
; <
.
†
†
< =#
Parametro_transaccion
†
†
= R
.
†
†
R S
FirstOrDefault
†
†
S a
(
†
†
a b
pcn
†
†
b e
=>
†
†
f h
pcn
†
†
i l
.
†
†
l m
id_parametro
†
†
m y
==
†
†
z |
MaestroSettings†
†
} å
.†
†
å ç
Default†
†
ç î
.†
†
î ï3
#IdDetalleMaestroParametroModoDePago†
†
ï ∏
)†
†
∏ π
!=†
†
∫ º
null†
†
Ω ¡
?†
†
¬ √
t†
†
ƒ ≈
.†
†
≈ ∆%
Parametro_transaccion†
†
∆ €
.†
†
€ ‹
FirstOrDefault†
†
‹ Í
(†
†
Í Î
pcn†
†
Î Ó
=>†
†
Ô Ò
pcn†
†
Ú ı
.†
†
ı ˆ
id_parametro†
†
ˆ Ç
==†
†
É Ö
MaestroSettings†
†
Ü ï
.†
†
ï ñ
Default†
†
ñ ù
.†
†
ù û3
#IdDetalleMaestroParametroModoDePago†
†
û ¡
)†
†
¡ ¬
.†
†
¬ √
valor†
†
√ »
:†
†
…  
null†
†
À œ
,†
†
œ –*
ValorParametroAliasDeCliente
°
°
  <
=
°
°
= >
t
°
°
? @
.
°
°
@ A#
Parametro_transaccion
°
°
A V
.
°
°
V W
FirstOrDefault
°
°
W e
(
°
°
e f
pcn
°
°
f i
=>
°
°
j l
pcn
°
°
m p
.
°
°
p q
id_parametro
°
°
q }
==°
°
~ Ä
MaestroSettings°
°
Å ê
.°
°
ê ë
Default°
°
ë ò
.°
°
ò ô5
%IdDetalleMaestroParametroAliasCliente°
°
ô æ
)°
°
æ ø
!=°
°
¿ ¬
null°
°
√ «
?°
°
» …
t°
°
  À
.°
°
À Ã%
Parametro_transaccion°
°
Ã ·
.°
°
· ‚
FirstOrDefault°
°
‚ 
(°
°
 Ò
pcn°
°
Ò Ù
=>°
°
ı ˜
pcn°
°
¯ ˚
.°
°
˚ ¸
id_parametro°
°
¸ à
==°
°
â ã
MaestroSettings°
°
å õ
.°
°
õ ú
Default°
°
ú £
.°
°
£ §5
%IdDetalleMaestroParametroAliasCliente°
°
§ …
)°
°
…  
.°
°
  À
valor°
°
À –
:°
°
— “
null°
°
” ◊
,°
°
◊ ÿ
IdEstado
¢
¢
  (
=
¢
¢
) *
t
¢
¢
+ ,
.
¢
¢
, -
id_estado_actual
¢
¢
- =
,
¢
¢
= >
Estado
£
£
  &
=
£
£
' (
t
£
£
) *
.
£
£
* +
Detalle_maestro
£
£
+ :
.
£
£
: ;
nombre
£
£
; A
,
£
£
A B
Transmitido
§
§
  +
=
§
§
, -
t
§
§
. /
.
§
§
/ 0 
Evento_transaccion
§
§
0 B
.
§
§
B C
Select
§
§
C I
(
§
§
I J
ev
§
§
J L
=>
§
§
M O
ev
§
§
P R
.
§
§
R S
	id_evento
§
§
S \
)
§
§
\ ]
.
§
§
] ^
Contains
§
§
^ f
(
§
§
f g
MaestroSettings
§
§
g v
.
§
§
v w
Default
§
§
w ~
.
§
§
~ 0
!IdDetalleMaestroEstadoTransmitido§
§
 †
)§
§
† °
}
•
•
 
)
¶
¶
 
.
¶
¶
 
OrderByDescending
¶
¶
 '
(
¶
¶
' (
t
¶
¶
( )
=>
¶
¶
* ,
t
¶
¶
- .
.
¶
¶
. /
FechaEmision
¶
¶
/ ;
)
¶
¶
; <
;
¶
¶
< =
}
®
®
 
catch
©
©
 
(
©
©
 
	Exception
©
©
 
e
©
©
 
)
©
©
 
{
™
™
 
throw
´
´
 
new
´
´
 
DatosException
´
´
 (
(
´
´
( )
$str
´
´
) I
,
´
´
I J
e
´
´
K L
)
´
´
L M
;
´
´
M N
}
¨
¨
 
}
≠
≠
 	
public
Æ
Æ
 
IEnumerable
Æ
Æ
 
<
Æ
Æ
 
Resumen_Venta
Æ
Æ
 (
>
Æ
Æ
( )$
ObtenerResumenesVentas
Æ
Æ
* @
(
Æ
Æ
@ A
int
Æ
Æ
A D
[
Æ
Æ
D E
]
Æ
Æ
E F!
idsTiposTransaccion
Æ
Æ
G Z
,
Æ
Æ
Z [
int
Æ
Æ
\ _
[
Æ
Æ
_ `
]
Æ
Æ
` a"
idsTiposComprobantes
Æ
Æ
b v
,
Æ
Æ
v w
int
Æ
Æ
x {

idEmpleadoÆ
Æ
| Ü
,Æ
Æ
Ü á
intÆ
Æ
à ã%
idActorNegocioInternoÆ
Æ
å °
,Æ
Æ
° ¢
DateTimeÆ
Æ
£ ´

fechaDesdeÆ
Æ
¨ ∂
,Æ
Æ
∂ ∑
DateTimeÆ
Æ
∏ ¿

fechaHastaÆ
Æ
¡ À
,Æ
Æ
À Ã
intÆ
Æ
Õ –
	idClienteÆ
Æ
— ⁄
)Æ
Æ
⁄ €
{
Ø
Ø
 	
try
∞
∞
 
{
±
±
 
return
≥
≥
 
_db
≥
≥
 
.
≥
≥
 
Transaccion
≥
≥
 &
.
¥
¥
 
Where
¥
¥
 
(
¥
¥
 
t
¥
¥
  
=>
¥
¥
! #
t
¥
¥
$ %
.
¥
¥
% &&
id_actor_negocio_externo
¥
¥
& >
==
¥
¥
? A
	idCliente
¥
¥
B K
&&
¥
¥
L N
t
¥
¥
O P
.
¥
¥
P Q
fecha_inicio
¥
¥
Q ]
>=
¥
¥
^ `

fechaDesde
¥
¥
a k
&&
¥
¥
l n
t
¥
¥
o p
.
¥
¥
p q
fecha_inicio
¥
¥
q }
<=¥
¥
~ Ä

fechaHasta¥
¥
Å ã
&&¥
¥
å é

idEmpleado¥
¥
è ô
==¥
¥
ö ú
t¥
¥
ù û
.¥
¥
û ü
id_empleado¥
¥
ü ™
&&¥
¥
´ ≠%
idActorNegocioInterno¥
¥
Æ √
==¥
¥
ƒ ∆
t¥
¥
« »
.¥
¥
» …(
id_actor_negocio_interno¥
¥
… ·
&&
µ
µ
 "
idsTiposComprobantes
µ
µ
 .
.
µ
µ
. /
Contains
µ
µ
/ 7
(
µ
µ
7 8
t
µ
µ
8 9
.
µ
µ
9 :
Comprobante
µ
µ
: E
.
µ
µ
E F!
id_tipo_comprobante
µ
µ
F Y
)
µ
µ
Y Z
&&
µ
µ
[ ]!
idsTiposTransaccion
µ
µ
^ q
.
µ
µ
q r
Contains
µ
µ
r z
(
µ
µ
z {
t
µ
µ
{ |
.
µ
µ
| }"
id_tipo_transaccionµ
µ
} ê
)µ
µ
ê ë
)µ
µ
ë í
.
∂
∂
 
Select
∂
∂
 
(
∂
∂
  
t
∏
∏
 
=>
∏
∏
  
new
∏
∏
! $
Resumen_Venta
∏
∏
% 2
(
∏
∏
2 3
)
∏
∏
3 4
{
π
π
 
Id
∫
∫
  "
=
∫
∫
# $
t
∫
∫
% &
.
∫
∫
& '
id
∫
∫
' )
,
∫
∫
) *
FechaEmision
ª
ª
  ,
=
ª
ª
- .
t
ª
ª
/ 0
.
ª
ª
0 1
fecha_inicio
ª
ª
1 =
,
ª
ª
= >
IdTipoComprobante
º
º
  1
=
º
º
2 3
t
º
º
4 5
.
º
º
5 6
Comprobante
º
º
6 A
.
º
º
A B
Detalle_maestro
º
º
B Q
.
º
º
Q R
id
º
º
R T
,
º
º
T U
TipoComprobante
Ω
Ω
  /
=
Ω
Ω
0 1
t
Ω
Ω
2 3
.
Ω
Ω
3 4
Comprobante
Ω
Ω
4 ?
.
Ω
Ω
? @
Detalle_maestro
Ω
Ω
@ O
.
Ω
Ω
O P
nombre
Ω
Ω
P V
,
Ω
Ω
V W
CodigoComprobante
æ
æ
  1
=
æ
æ
2 3
t
æ
æ
4 5
.
æ
æ
5 6
Comprobante
æ
æ
6 A
.
æ
æ
A B
Detalle_maestro
æ
æ
B Q
.
æ
æ
Q R
valor
æ
æ
R W
,
æ
æ
W X
SerieComprobante
ø
ø
  0
=
ø
ø
1 2
t
ø
ø
3 4
.
ø
ø
4 5
Comprobante
ø
ø
5 @
.
ø
ø
@ A
numero_serie
ø
ø
A M
,
ø
ø
M N
NumeroComprobante
¿
¿
  1
=
¿
¿
2 3
t
¿
¿
4 5
.
¿
¿
5 6
Comprobante
¿
¿
6 A
.
¿
¿
A B
numero
¿
¿
B H
,
¿
¿
H I
	IdCliente
¡
¡
  )
=
¡
¡
* +
t
¡
¡
, -
.
¡
¡
- .&
id_actor_negocio_externo
¡
¡
. F
,
¡
¡
F G$
IdTipoDocumentoCliente
¬
¬
  6
=
¬
¬
7 8
t
¬
¬
9 :
.
¬
¬
: ;
Actor_negocio1
¬
¬
; I
.
¬
¬
I J
Actor
¬
¬
J O
.
¬
¬
O P$
id_documento_identidad
¬
¬
P f
,
¬
¬
f g
DocumentoCliente
√
√
  0
=
√
√
1 2
t
√
√
3 4
.
√
√
4 5
Actor_negocio1
√
√
5 C
.
√
√
C D
Actor
√
√
D I
.
√
√
I J(
numero_documento_identidad
√
√
J d
,
√
√
d e
NombreCliente
ƒ
ƒ
  -
=
ƒ
ƒ
. /
t
ƒ
ƒ
0 1
.
ƒ
ƒ
1 2
Actor_negocio1
ƒ
ƒ
2 @
.
ƒ
ƒ
@ A
Actor
ƒ
ƒ
A F
.
ƒ
ƒ
F G
primer_nombre
ƒ
ƒ
G T
,
ƒ
ƒ
T U 
PrimerNombreCajero
≈
≈
  2
=
≈
≈
3 4
t
≈
≈
5 6
.
≈
≈
6 7
Actor_negocio
≈
≈
7 D
.
≈
≈
D E
Actor
≈
≈
E J
.
≈
≈
J K
primer_nombre
≈
≈
K X
,
≈
≈
X Y!
SegundoNombreCajero
∆
∆
  3
=
∆
∆
4 5
t
∆
∆
6 7
.
∆
∆
7 8
Actor_negocio
∆
∆
8 E
.
∆
∆
E F
Actor
∆
∆
F K
.
∆
∆
K L
segundo_nombre
∆
∆
L Z
,
∆
∆
Z [ 
TercerNombreCajero
«
«
  2
=
«
«
3 4
t
«
«
5 6
.
«
«
6 7
Actor_negocio
«
«
7 D
.
«
«
D E
Actor
«
«
E J
.
«
«
J K
tercer_nombre
«
«
K X
,
«
«
X Y
ImporteTotal
»
»
  ,
=
»
»
- .
t
»
»
/ 0
.
»
»
0 1
importe_total
»
»
1 >
,
»
»
> ?'
ValorParametroTipoDeVenta
…
…
  9
=
…
…
: ;
t
…
…
< =
.
…
…
= >#
Parametro_transaccion
…
…
> S
.
…
…
S T
FirstOrDefault
…
…
T b
(
…
…
b c
pcn
…
…
c f
=>
…
…
g i
pcn
…
…
j m
.
…
…
m n
id_parametro
…
…
n z
==
…
…
{ }
MaestroSettings…
…
~ ç
.…
…
ç é
Default…
…
é ï
.…
…
ï ñ2
"IdDetalleMaestroParametroTipoVenta…
…
ñ ∏
)…
…
∏ π
!=…
…
∫ º
null…
…
Ω ¡
?…
…
¬ √
t…
…
ƒ ≈
.…
…
≈ ∆%
Parametro_transaccion…
…
∆ €
.…
…
€ ‹
FirstOrDefault…
…
‹ Í
(…
…
Í Î
pcn…
…
Î Ó
=>…
…
Ô Ò
pcn…
…
Ú ı
.…
…
ı ˆ
id_parametro…
…
ˆ Ç
==…
…
É Ö
MaestroSettings…
…
Ü ï
.…
…
ï ñ
Default…
…
ñ ù
.…
…
ù û2
"IdDetalleMaestroParametroTipoVenta…
…
û ¿
)…
…
¿ ¡
.…
…
¡ ¬
valor…
…
¬ «
:…
…
» …
null…
…
  Œ
,…
…
Œ œ&
ValorParametroModoDePago
 
 
  8
=
 
 
9 :
t
 
 
; <
.
 
 
< =#
Parametro_transaccion
 
 
= R
.
 
 
R S
FirstOrDefault
 
 
S a
(
 
 
a b
pcn
 
 
b e
=>
 
 
f h
pcn
 
 
i l
.
 
 
l m
id_parametro
 
 
m y
==
 
 
z |
MaestroSettings 
 
} å
. 
 
å ç
Default 
 
ç î
. 
 
î ï3
#IdDetalleMaestroParametroModoDePago 
 
ï ∏
) 
 
∏ π
!= 
 
∫ º
null 
 
Ω ¡
? 
 
¬ √
t 
 
ƒ ≈
. 
 
≈ ∆%
Parametro_transaccion 
 
∆ €
. 
 
€ ‹
FirstOrDefault 
 
‹ Í
( 
 
Í Î
pcn 
 
Î Ó
=> 
 
Ô Ò
pcn 
 
Ú ı
. 
 
ı ˆ
id_parametro 
 
ˆ Ç
== 
 
É Ö
MaestroSettings 
 
Ü ï
. 
 
ï ñ
Default 
 
ñ ù
. 
 
ù û3
#IdDetalleMaestroParametroModoDePago 
 
û ¡
) 
 
¡ ¬
. 
 
¬ √
valor 
 
√ »
: 
 
…  
null 
 
À œ
, 
 
œ –*
ValorParametroAliasDeCliente
À
À
  <
=
À
À
= >
t
À
À
? @
.
À
À
@ A#
Parametro_transaccion
À
À
A V
.
À
À
V W
FirstOrDefault
À
À
W e
(
À
À
e f
pcn
À
À
f i
=>
À
À
j l
pcn
À
À
m p
.
À
À
p q
id_parametro
À
À
q }
==À
À
~ Ä
MaestroSettingsÀ
À
Å ê
.À
À
ê ë
DefaultÀ
À
ë ò
.À
À
ò ô5
%IdDetalleMaestroParametroAliasClienteÀ
À
ô æ
)À
À
æ ø
!=À
À
¿ ¬
nullÀ
À
√ «
?À
À
» …
tÀ
À
  À
.À
À
À Ã%
Parametro_transaccionÀ
À
Ã ·
.À
À
· ‚
FirstOrDefaultÀ
À
‚ 
(À
À
 Ò
pcnÀ
À
Ò Ù
=>À
À
ı ˜
pcnÀ
À
¯ ˚
.À
À
˚ ¸
id_parametroÀ
À
¸ à
==À
À
â ã
MaestroSettingsÀ
À
å õ
.À
À
õ ú
DefaultÀ
À
ú £
.À
À
£ §5
%IdDetalleMaestroParametroAliasClienteÀ
À
§ …
)À
À
…  
.À
À
  À
valorÀ
À
À –
:À
À
— “
nullÀ
À
” ◊
,À
À
◊ ÿ
IdEstado
Ã
Ã
  (
=
Ã
Ã
) *
t
Ã
Ã
+ ,
.
Ã
Ã
, -
id_estado_actual
Ã
Ã
- =
,
Ã
Ã
= >
Estado
Õ
Õ
  &
=
Õ
Õ
' (
t
Õ
Õ
) *
.
Õ
Õ
* +
Detalle_maestro
Õ
Õ
+ :
.
Õ
Õ
: ;
nombre
Õ
Õ
; A
,
Õ
Õ
A B
Transmitido
Œ
Œ
  +
=
Œ
Œ
, -
t
Œ
Œ
. /
.
Œ
Œ
/ 0 
Evento_transaccion
Œ
Œ
0 B
.
Œ
Œ
B C
Select
Œ
Œ
C I
(
Œ
Œ
I J
ev
Œ
Œ
J L
=>
Œ
Œ
M O
ev
Œ
Œ
P R
.
Œ
Œ
R S
	id_evento
Œ
Œ
S \
)
Œ
Œ
\ ]
.
Œ
Œ
] ^
Contains
Œ
Œ
^ f
(
Œ
Œ
f g
MaestroSettings
Œ
Œ
g v
.
Œ
Œ
v w
Default
Œ
Œ
w ~
.
Œ
Œ
~ 0
!IdDetalleMaestroEstadoTransmitidoŒ
Œ
 †
)Œ
Œ
† °
}
œ
œ
 
)
–
–
 
.
–
–
 
OrderByDescending
–
–
 '
(
–
–
' (
t
–
–
( )
=>
–
–
* ,
t
–
–
- .
.
–
–
. /
FechaEmision
–
–
/ ;
)
–
–
; <
;
–
–
< =
}
“
“
 
catch
”
”
 
(
”
”
 
	Exception
”
”
 
e
”
”
 
)
”
”
 
{
‘
‘
 
throw
’
’
 
new
’
’
 
DatosException
’
’
 (
(
’
’
( )
$str
’
’
) I
,
’
’
I J
e
’
’
K L
)
’
’
L M
;
’
’
M N
}
÷
÷
 
}
◊
◊
 	
public
Ÿ
Ÿ
 
IEnumerable
Ÿ
Ÿ
 
<
Ÿ
Ÿ
 
Resumen_Venta
Ÿ
Ÿ
 (
>
Ÿ
Ÿ
( )$
ObtenerResumenesVentas
Ÿ
Ÿ
* @
(
Ÿ
Ÿ
@ A
int
Ÿ
Ÿ
A D
[
Ÿ
Ÿ
D E
]
Ÿ
Ÿ
E F!
idsTiposTransaccion
Ÿ
Ÿ
G Z
,
Ÿ
Ÿ
Z [
int
Ÿ
Ÿ
\ _
[
Ÿ
Ÿ
_ `
]
Ÿ
Ÿ
` a"
idsTiposComprobantes
Ÿ
Ÿ
b v
,
Ÿ
Ÿ
v w
string
Ÿ
Ÿ
x ~
comprobanteŸ
Ÿ
 ä
)Ÿ
Ÿ
ä ã
{
⁄
⁄
 	
try
€
€
 
{
‹
‹
 
return
ﬁ
ﬁ
 
_db
ﬁ
ﬁ
 
.
ﬁ
ﬁ
 
Transaccion
ﬁ
ﬁ
 &
.
ﬂ
ﬂ
 
Where
ﬂ
ﬂ
 
(
ﬂ
ﬂ
 
t
ﬂ
ﬂ
  
=>
ﬂ
ﬂ
! #
comprobante
ﬂ
ﬂ
$ /
.
ﬂ
ﬂ
/ 0
Equals
ﬂ
ﬂ
0 6
(
ﬂ
ﬂ
6 7
t
ﬂ
ﬂ
7 8
.
ﬂ
ﬂ
8 9
Comprobante
ﬂ
ﬂ
9 D
.
ﬂ
ﬂ
D E
numero_serie
ﬂ
ﬂ
E Q
+
ﬂ
ﬂ
R S
$str
ﬂ
ﬂ
T W
+
ﬂ
ﬂ
X Y
t
ﬂ
ﬂ
Z [
.
ﬂ
ﬂ
[ \
Comprobante
ﬂ
ﬂ
\ g
.
ﬂ
ﬂ
g h
numero
ﬂ
ﬂ
h n
)
ﬂ
ﬂ
n o
&&
ﬂ
ﬂ
p r#
idsTiposComprobantesﬂ
ﬂ
s á
.ﬂ
ﬂ
á à
Containsﬂ
ﬂ
à ê
(ﬂ
ﬂ
ê ë
tﬂ
ﬂ
ë í
.ﬂ
ﬂ
í ì
Comprobanteﬂ
ﬂ
ì û
.ﬂ
ﬂ
û ü#
id_tipo_comprobanteﬂ
ﬂ
ü ≤
)ﬂ
ﬂ
≤ ≥
&&ﬂ
ﬂ
¥ ∂#
idsTiposTransaccionﬂ
ﬂ
∑  
.ﬂ
ﬂ
  À
Containsﬂ
ﬂ
À ”
(ﬂ
ﬂ
” ‘
tﬂ
ﬂ
‘ ’
.ﬂ
ﬂ
’ ÷#
id_tipo_transaccionﬂ
ﬂ
÷ È
)ﬂ
ﬂ
È Í
)ﬂ
ﬂ
Í Î
.
‡
‡
 
Select
‡
‡
 
(
‡
‡
  
t
·
·
 
=>
·
·
  
new
·
·
! $
Resumen_Venta
·
·
% 2
(
·
·
2 3
)
·
·
3 4
{
‚
‚
 
Id
„
„
  "
=
„
„
# $
t
„
„
% &
.
„
„
& '
id
„
„
' )
,
„
„
) *
FechaEmision
‰
‰
  ,
=
‰
‰
- .
t
‰
‰
/ 0
.
‰
‰
0 1
fecha_inicio
‰
‰
1 =
,
‰
‰
= >
IdTipoComprobante
Â
Â
  1
=
Â
Â
2 3
t
Â
Â
4 5
.
Â
Â
5 6
Comprobante
Â
Â
6 A
.
Â
Â
A B
Detalle_maestro
Â
Â
B Q
.
Â
Â
Q R
id
Â
Â
R T
,
Â
Â
T U
TipoComprobante
Ê
Ê
  /
=
Ê
Ê
0 1
t
Ê
Ê
2 3
.
Ê
Ê
3 4
Comprobante
Ê
Ê
4 ?
.
Ê
Ê
? @
Detalle_maestro
Ê
Ê
@ O
.
Ê
Ê
O P
nombre
Ê
Ê
P V
,
Ê
Ê
V W
CodigoComprobante
Á
Á
  1
=
Á
Á
2 3
t
Á
Á
4 5
.
Á
Á
5 6
Comprobante
Á
Á
6 A
.
Á
Á
A B
Detalle_maestro
Á
Á
B Q
.
Á
Á
Q R
valor
Á
Á
R W
,
Á
Á
W X
SerieComprobante
Ë
Ë
  0
=
Ë
Ë
1 2
t
Ë
Ë
3 4
.
Ë
Ë
4 5
Comprobante
Ë
Ë
5 @
.
Ë
Ë
@ A
numero_serie
Ë
Ë
A M
,
Ë
Ë
M N
NumeroComprobante
È
È
  1
=
È
È
2 3
t
È
È
4 5
.
È
È
5 6
Comprobante
È
È
6 A
.
È
È
A B
numero
È
È
B H
,
È
È
H I
	IdCliente
Í
Í
  )
=
Í
Í
* +
t
Í
Í
, -
.
Í
Í
- .&
id_actor_negocio_externo
Í
Í
. F
,
Í
Í
F G$
IdTipoDocumentoCliente
Î
Î
  6
=
Î
Î
7 8
t
Î
Î
9 :
.
Î
Î
: ;
Actor_negocio1
Î
Î
; I
.
Î
Î
I J
Actor
Î
Î
J O
.
Î
Î
O P$
id_documento_identidad
Î
Î
P f
,
Î
Î
f g
DocumentoCliente
Ï
Ï
  0
=
Ï
Ï
1 2
t
Ï
Ï
3 4
.
Ï
Ï
4 5
Actor_negocio1
Ï
Ï
5 C
.
Ï
Ï
C D
Actor
Ï
Ï
D I
.
Ï
Ï
I J(
numero_documento_identidad
Ï
Ï
J d
,
Ï
Ï
d e
NombreCliente
Ì
Ì
  -
=
Ì
Ì
. /
t
Ì
Ì
0 1
.
Ì
Ì
1 2
Actor_negocio1
Ì
Ì
2 @
.
Ì
Ì
@ A
Actor
Ì
Ì
A F
.
Ì
Ì
F G
primer_nombre
Ì
Ì
G T
,
Ì
Ì
T U 
PrimerNombreCajero
Ó
Ó
  2
=
Ó
Ó
3 4
t
Ó
Ó
5 6
.
Ó
Ó
6 7
Actor_negocio
Ó
Ó
7 D
.
Ó
Ó
D E
Actor
Ó
Ó
E J
.
Ó
Ó
J K
primer_nombre
Ó
Ó
K X
,
Ó
Ó
X Y!
SegundoNombreCajero
Ô
Ô
  3
=
Ô
Ô
4 5
t
Ô
Ô
6 7
.
Ô
Ô
7 8
Actor_negocio
Ô
Ô
8 E
.
Ô
Ô
E F
Actor
Ô
Ô
F K
.
Ô
Ô
K L
segundo_nombre
Ô
Ô
L Z
,
Ô
Ô
Z [ 
TercerNombreCajero


  2
=


3 4
t


5 6
.


6 7
Actor_negocio


7 D
.


D E
Actor


E J
.


J K
tercer_nombre


K X
,


X Y
ImporteTotal
Ò
Ò
  ,
=
Ò
Ò
- .
t
Ò
Ò
/ 0
.
Ò
Ò
0 1
importe_total
Ò
Ò
1 >
,
Ò
Ò
> ?'
ValorParametroTipoDeVenta
Ú
Ú
  9
=
Ú
Ú
: ;
t
Ú
Ú
< =
.
Ú
Ú
= >#
Parametro_transaccion
Ú
Ú
> S
.
Ú
Ú
S T
FirstOrDefault
Ú
Ú
T b
(
Ú
Ú
b c
pcn
Ú
Ú
c f
=>
Ú
Ú
g i
pcn
Ú
Ú
j m
.
Ú
Ú
m n
id_parametro
Ú
Ú
n z
==
Ú
Ú
{ }
MaestroSettingsÚ
Ú
~ ç
.Ú
Ú
ç é
DefaultÚ
Ú
é ï
.Ú
Ú
ï ñ2
"IdDetalleMaestroParametroTipoVentaÚ
Ú
ñ ∏
)Ú
Ú
∏ π
!=Ú
Ú
∫ º
nullÚ
Ú
Ω ¡
?Ú
Ú
¬ √
tÚ
Ú
ƒ ≈
.Ú
Ú
≈ ∆%
Parametro_transaccionÚ
Ú
∆ €
.Ú
Ú
€ ‹
FirstOrDefaultÚ
Ú
‹ Í
(Ú
Ú
Í Î
pcnÚ
Ú
Î Ó
=>Ú
Ú
Ô Ò
pcnÚ
Ú
Ú ı
.Ú
Ú
ı ˆ
id_parametroÚ
Ú
ˆ Ç
==Ú
Ú
É Ö
MaestroSettingsÚ
Ú
Ü ï
.Ú
Ú
ï ñ
DefaultÚ
Ú
ñ ù
.Ú
Ú
ù û2
"IdDetalleMaestroParametroTipoVentaÚ
Ú
û ¿
)Ú
Ú
¿ ¡
.Ú
Ú
¡ ¬
valorÚ
Ú
¬ «
:Ú
Ú
» …
nullÚ
Ú
  Œ
,Ú
Ú
Œ œ&
ValorParametroModoDePago
Û
Û
  8
=
Û
Û
9 :
t
Û
Û
; <
.
Û
Û
< =#
Parametro_transaccion
Û
Û
= R
.
Û
Û
R S
FirstOrDefault
Û
Û
S a
(
Û
Û
a b
pcn
Û
Û
b e
=>
Û
Û
f h
pcn
Û
Û
i l
.
Û
Û
l m
id_parametro
Û
Û
m y
==
Û
Û
z |
MaestroSettingsÛ
Û
} å
.Û
Û
å ç
DefaultÛ
Û
ç î
.Û
Û
î ï3
#IdDetalleMaestroParametroModoDePagoÛ
Û
ï ∏
)Û
Û
∏ π
!=Û
Û
∫ º
nullÛ
Û
Ω ¡
?Û
Û
¬ √
tÛ
Û
ƒ ≈
.Û
Û
≈ ∆%
Parametro_transaccionÛ
Û
∆ €
.Û
Û
€ ‹
FirstOrDefaultÛ
Û
‹ Í
(Û
Û
Í Î
pcnÛ
Û
Î Ó
=>Û
Û
Ô Ò
pcnÛ
Û
Ú ı
.Û
Û
ı ˆ
id_parametroÛ
Û
ˆ Ç
==Û
Û
É Ö
MaestroSettingsÛ
Û
Ü ï
.Û
Û
ï ñ
DefaultÛ
Û
ñ ù
.Û
Û
ù û3
#IdDetalleMaestroParametroModoDePagoÛ
Û
û ¡
)Û
Û
¡ ¬
.Û
Û
¬ √
valorÛ
Û
√ »
:Û
Û
…  
nullÛ
Û
À œ
,Û
Û
œ –*
ValorParametroAliasDeCliente
Ù
Ù
  <
=
Ù
Ù
= >
t
Ù
Ù
? @
.
Ù
Ù
@ A#
Parametro_transaccion
Ù
Ù
A V
.
Ù
Ù
V W
FirstOrDefault
Ù
Ù
W e
(
Ù
Ù
e f
pcn
Ù
Ù
f i
=>
Ù
Ù
j l
pcn
Ù
Ù
m p
.
Ù
Ù
p q
id_parametro
Ù
Ù
q }
==Ù
Ù
~ Ä
MaestroSettingsÙ
Ù
Å ê
.Ù
Ù
ê ë
DefaultÙ
Ù
ë ò
.Ù
Ù
ò ô5
%IdDetalleMaestroParametroAliasClienteÙ
Ù
ô æ
)Ù
Ù
æ ø
!=Ù
Ù
¿ ¬
nullÙ
Ù
√ «
?Ù
Ù
» …
tÙ
Ù
  À
.Ù
Ù
À Ã%
Parametro_transaccionÙ
Ù
Ã ·
.Ù
Ù
· ‚
FirstOrDefaultÙ
Ù
‚ 
(Ù
Ù
 Ò
pcnÙ
Ù
Ò Ù
=>Ù
Ù
ı ˜
pcnÙ
Ù
¯ ˚
.Ù
Ù
˚ ¸
id_parametroÙ
Ù
¸ à
==Ù
Ù
â ã
MaestroSettingsÙ
Ù
å õ
.Ù
Ù
õ ú
DefaultÙ
Ù
ú £
.Ù
Ù
£ §5
%IdDetalleMaestroParametroAliasClienteÙ
Ù
§ …
)Ù
Ù
…  
.Ù
Ù
  À
valorÙ
Ù
À –
:Ù
Ù
— “
nullÙ
Ù
” ◊
,Ù
Ù
◊ ÿ
IdEstado
ı
ı
  (
=
ı
ı
) *
t
ı
ı
+ ,
.
ı
ı
, -
id_estado_actual
ı
ı
- =
,
ı
ı
= >
Estado
ˆ
ˆ
  &
=
ˆ
ˆ
' (
t
ˆ
ˆ
) *
.
ˆ
ˆ
* +
Detalle_maestro
ˆ
ˆ
+ :
.
ˆ
ˆ
: ;
nombre
ˆ
ˆ
; A
,
ˆ
ˆ
A B
Transmitido
˜
˜
  +
=
˜
˜
, -
t
˜
˜
. /
.
˜
˜
/ 0 
Evento_transaccion
˜
˜
0 B
.
˜
˜
B C
Select
˜
˜
C I
(
˜
˜
I J
ev
˜
˜
J L
=>
˜
˜
M O
ev
˜
˜
P R
.
˜
˜
R S
	id_evento
˜
˜
S \
)
˜
˜
\ ]
.
˜
˜
] ^
Contains
˜
˜
^ f
(
˜
˜
f g
MaestroSettings
˜
˜
g v
.
˜
˜
v w
Default
˜
˜
w ~
.
˜
˜
~ 0
!IdDetalleMaestroEstadoTransmitido˜
˜
 †
)˜
˜
† °
}
¯
¯
 
)
˘
˘
 
.
˘
˘
 
OrderByDescending
˘
˘
 '
(
˘
˘
' (
t
˘
˘
( )
=>
˘
˘
* ,
t
˘
˘
- .
.
˘
˘
. /
FechaEmision
˘
˘
/ ;
)
˘
˘
; <
;
˘
˘
< =
}
˚
˚
 
catch
¸
¸
 
(
¸
¸
 
	Exception
¸
¸
 
e
¸
¸
 
)
¸
¸
 
{
˝
˝
 
throw
˛
˛
 
new
˛
˛
 
DatosException
˛
˛
 (
(
˛
˛
( )
$str
˛
˛
) I
,
˛
˛
I J
e
˛
˛
K L
)
˛
˛
L M
;
˛
˛
M N
}
ˇ
ˇ
 
}
ÄÄ 	
public
ÇÇ 
IEnumerable
ÇÇ 
<
ÇÇ 
Resumen_Venta
ÇÇ (
>
ÇÇ( )%
ObtenerResumenesVentas_
ÇÇ* A
(
ÇÇA B
int
ÇÇB E
[
ÇÇE F
]
ÇÇF G!
idsTiposTransaccion
ÇÇH [
,
ÇÇ[ \
int
ÇÇ] `
[
ÇÇ` a
]
ÇÇa b"
idsTiposComprobantes
ÇÇc w
,
ÇÇw x
DateTimeÇÇy Å

fechaDesdeÇÇÇ å
,ÇÇå ç
DateTimeÇÇé ñ

fechaHastaÇÇó °
)ÇÇ° ¢
{
ÉÉ 	
try
ÑÑ 
{
ÖÖ 
_db
ÜÜ 
.
ÜÜ 
Configuration
ÜÜ !
.
ÜÜ! " 
LazyLoadingEnabled
ÜÜ" 4
=
ÜÜ5 6
false
ÜÜ7 <
;
ÜÜ< =
var
áá 
transacciones
áá !
=
áá" #
_db
áá$ '
.
áá' (
Transaccion
áá( 3
.
áá3 4
Where
áá4 9
(
áá9 :
t
áá: ;
=>
áá< >
t
áá? @
.
áá@ A
fecha_inicio
ááA M
>=
ááN P

fechaDesde
ááQ [
&&
áá\ ^
t
áá_ `
.
áá` a
fecha_inicio
ááa m
<=
áán p

fechaHasta
ááq {
&&
áá| ~#
idsTiposComprobantesáá ì
.ááì î
Containsááî ú
(ááú ù
tááù û
.ááû ü
Comprobanteááü ™
.áá™ ´#
id_tipo_comprobanteáá´ æ
)ááæ ø
&&áá¿ ¬#
idsTiposTransaccionáá√ ÷
.áá÷ ◊
Containsáá◊ ﬂ
(ááﬂ ‡
táá‡ ·
.áá· ‚#
id_tipo_transaccionáá‚ ı
)ááı ˆ
)ááˆ ˜
.áá˜ ¯
ToArrayáá¯ ˇ
(ááˇ Ä
)ááÄ Å
;ááÅ Ç
var
àà 
idsTransacciones
àà $
=
àà% &
transacciones
àà' 4
.
àà4 5
Select
àà5 ;
(
àà; <
t
àà< =
=>
àà> @
t
ààA B
.
ààB C
id
ààC E
)
ààE F
.
ààF G
ToArray
ààG N
(
ààN O
)
ààO P
;
ààP Q
var
ââ 
idsComprobantes
ââ #
=
ââ$ %
transacciones
ââ& 3
.
ââ3 4
Select
ââ4 :
(
ââ: ;
t
ââ; <
=>
ââ= ?
t
ââ@ A
.
ââA B
id_comprobante
ââB P
)
ââP Q
.
ââQ R
ToArray
ââR Y
(
ââY Z
)
ââZ [
;
ââ[ \
var
ää 
comprobantes
ää  
=
ää! "
_db
ää# &
.
ää& '
Comprobante
ää' 2
.
ää2 3
Where
ää3 8
(
ää8 9
c
ää9 :
=>
ää; =
idsComprobantes
ää> M
.
ääM N
Contains
ääN V
(
ääV W
c
ääW X
.
ääX Y
id
ääY [
)
ää[ \
)
ää\ ]
.
ää] ^
ToArray
ää^ e
(
ääe f
)
ääf g
;
ääg h
var
ãã 
tiposComprobantes
ãã %
=
ãã& '
_db
ãã( +
.
ãã+ ,
Detalle_maestro
ãã, ;
.
ãã; <
Where
ãã< A
(
ããA B
c
ããB C
=>
ããD F"
idsTiposComprobantes
ããG [
.
ãã[ \
Contains
ãã\ d
(
ããd e
c
ããe f
.
ããf g
id
ããg i
)
ããi j
)
ããj k
.
ããk l
ToArray
ããl s
(
ããs t
)
ããt u
;
ããu v
var
çç 
idsEmpleados
çç  
=
çç! "
transacciones
çç# 0
.
çç0 1
Select
çç1 7
(
çç7 8
c
çç8 9
=>
çç: <
c
çç= >
.
çç> ?
id_empleado
çç? J
)
ççJ K
.
ççK L
Distinct
ççL T
(
ççT U
)
ççU V
.
ççV W
ToArray
ççW ^
(
çç^ _
)
çç_ `
;
çç` a
var
éé '
idsActoresNegocioExternos
éé -
=
éé. /
transacciones
éé0 =
.
éé= >
Select
éé> D
(
ééD E
c
ééE F
=>
ééG I
c
ééJ K
.
ééK L&
id_actor_negocio_externo
ééL d
)
ééd e
.
éée f
Distinct
ééf n
(
één o
)
ééo p
.
éép q
ToArray
ééq x
(
ééx y
)
ééy z
;
ééz {
var
èè 
idsActoresNegocio
èè %
=
èè& '
idsEmpleados
èè( 4
.
èè4 5
Union
èè5 :
(
èè: ;'
idsActoresNegocioExternos
èè; T
)
èèT U
.
èèU V
ToArray
èèV ]
(
èè] ^
)
èè^ _
;
èè_ `
var
êê 
actoresNegocio
êê "
=
êê# $
_db
êê% (
.
êê( )
Actor_negocio
êê) 6
.
êê6 7
Where
êê7 <
(
êê< =
an
êê= ?
=>
êê@ B
idsActoresNegocio
êêC T
.
êêT U
Contains
êêU ]
(
êê] ^
an
êê^ `
.
êê` a
id
êêa c
)
êêc d
)
êêd e
.
êêe f
Include
êêf m
(
êêm n
an
êên p
=>
êêq s
an
êêt v
.
êêv w
Actor
êêw |
)
êê| }
.
êê} ~
ToArrayêê~ Ö
(êêÖ Ü
)êêÜ á
;êêá à
var
ëë %
parametrosTransacciones
ëë +
=
ëë, -
_db
ëë. 1
.
ëë1 2#
Parametro_transaccion
ëë2 G
.
ëëG H
Where
ëëH M
(
ëëM N
pt
ëëN P
=>
ëëQ S
idsTransacciones
ëëT d
.
ëëd e
Contains
ëëe m
(
ëëm n
pt
ëën p
.
ëëp q
id_transaccion
ëëq 
)ëë Ä
)ëëÄ Å
.ëëÅ Ç
ToArrayëëÇ â
(ëëâ ä
)ëëä ã
;ëëã å
var
íí %
idsEstadosTransacciones
íí +
=
íí, -
transacciones
íí. ;
.
íí; <
Select
íí< B
(
ííB C
t
ííC D
=>
ííE G
t
ííH I
.
ííI J
id_estado_actual
ííJ Z
)
ííZ [
.
íí[ \
Distinct
íí\ d
(
ííd e
)
ííe f
.
ííf g
ToArray
ííg n
(
íín o
)
íío p
;
ííp q
var
ìì "
EstadosTransacciones
ìì (
=
ìì) *
_db
ìì+ .
.
ìì. /
Detalle_maestro
ìì/ >
.
ìì> ?
Where
ìì? D
(
ììD E
dm
ììE G
=>
ììH J%
idsEstadosTransacciones
ììK b
.
ììb c
Contains
ììc k
(
ììk l
dm
ììl n
.
ììn o
id
ììo q
)
ììq r
)
ììr s
.
ììs t
ToArray
ììt {
(
ìì{ |
)
ìì| }
;
ìì} ~
var
îî "
EventosTransacciones
îî (
=
îî) *
_db
îî+ .
.
îî. / 
Evento_transaccion
îî/ A
.
îîA B
Where
îîB G
(
îîG H
et
îîH J
=>
îîK M
idsTransacciones
îîN ^
.
îî^ _
Contains
îî_ g
(
îîg h
et
îîh j
.
îîj k
id_transaccion
îîk y
)
îîy z
)
îîz {
.
îî{ |
ToArrayîî| É
(îîÉ Ñ
)îîÑ Ö
;îîÖ Ü
List
ññ 
<
ññ 
Resumen_Venta
ññ "
>
ññ" #
resumenes_Ventas
ññ$ 4
=
ññ5 6
new
ññ7 :
List
ññ; ?
<
ññ? @
Resumen_Venta
ññ@ M
>
ññM N
(
ññN O
)
ññO P
;
ññP Q
foreach
óó 
(
óó 
var
óó 
transaccion
óó (
in
óó) +
transacciones
óó, 9
)
óó9 :
{
òò 
resumenes_Ventas
ôô $
.
ôô$ %
Add
ôô% (
(
ôô( )
new
ôô) ,
Resumen_Venta
ôô- :
(
ôô: ;
)
ôô; <
{
öö 
Id
õõ 
=
õõ 
transaccion
õõ (
.
õõ( )
id
õõ) +
,
õõ+ ,
FechaEmision
úú $
=
úú% &
transaccion
úú' 2
.
úú2 3
fecha_inicio
úú3 ?
,
úú? @
IdTipoComprobante
ùù )
=
ùù* +
tiposComprobantes
ùù, =
.
ùù= >
Single
ùù> D
(
ùùD E
tc
ùùE G
=>
ùùH J
tc
ùùK M
.
ùùM N
id
ùùN P
==
ùùQ S
comprobantes
ùùT `
.
ùù` a
Single
ùùa g
(
ùùg h
c
ùùh i
=>
ùùj l
c
ùùm n
.
ùùn o
id
ùùo q
==
ùùr t
transaccionùùu Ä
.ùùÄ Å
id_comprobanteùùÅ è
)ùùè ê
.ùùê ë#
id_tipo_comprobanteùùë §
)ùù§ •
.ùù• ¶
idùù¶ ®
,ùù® ©
TipoComprobante
ûû '
=
ûû( )
tiposComprobantes
ûû* ;
.
ûû; <
Single
ûû< B
(
ûûB C
tc
ûûC E
=>
ûûF H
tc
ûûI K
.
ûûK L
id
ûûL N
==
ûûO Q
comprobantes
ûûR ^
.
ûû^ _
Single
ûû_ e
(
ûûe f
c
ûûf g
=>
ûûh j
c
ûûk l
.
ûûl m
id
ûûm o
==
ûûp r
transaccion
ûûs ~
.
ûû~ 
id_comprobanteûû ç
)ûûç é
.ûûé è#
id_tipo_comprobanteûûè ¢
)ûû¢ £
.ûû£ §
nombreûû§ ™
,ûû™ ´
CodigoComprobante
üü )
=
üü* +
tiposComprobantes
üü, =
.
üü= >
Single
üü> D
(
üüD E
tc
üüE G
=>
üüH J
tc
üüK M
.
üüM N
id
üüN P
==
üüQ S
comprobantes
üüT `
.
üü` a
Single
üüa g
(
üüg h
c
üüh i
=>
üüj l
c
üüm n
.
üün o
id
üüo q
==
üür t
transaccionüüu Ä
.üüÄ Å
id_comprobanteüüÅ è
)üüè ê
.üüê ë#
id_tipo_comprobanteüüë §
)üü§ •
.üü• ¶
valorüü¶ ´
,üü´ ¨
SerieComprobante
†† (
=
††) *
comprobantes
††+ 7
.
††7 8
Single
††8 >
(
††> ?
c
††? @
=>
††A C
c
††D E
.
††E F
id
††F H
==
††I K
transaccion
††L W
.
††W X
id_comprobante
††X f
)
††f g
.
††g h
numero_serie
††h t
,
††t u
NumeroComprobante
°° )
=
°°* +
comprobantes
°°, 8
.
°°8 9
Single
°°9 ?
(
°°? @
c
°°@ A
=>
°°B D
c
°°E F
.
°°F G
id
°°G I
==
°°J L
transaccion
°°M X
.
°°X Y
id_comprobante
°°Y g
)
°°g h
.
°°h i
numero
°°i o
,
°°o p
	IdCliente
¢¢ !
=
¢¢" #
transaccion
¢¢$ /
.
¢¢/ 0&
id_actor_negocio_externo
¢¢0 H
,
¢¢H I$
IdTipoDocumentoCliente
££ .
=
££/ 0
actoresNegocio
££1 ?
.
££? @
Single
££@ F
(
££F G
an
££G I
=>
££J L
an
££M O
.
££O P
id
££P R
==
££S U
transaccion
££V a
.
££a b&
id_actor_negocio_externo
££b z
)
££z {
.
££{ |
Actor££| Å
.££Å Ç&
id_documento_identidad££Ç ò
,££ò ô
DocumentoCliente
§§ (
=
§§) *
actoresNegocio
§§+ 9
.
§§9 :
Single
§§: @
(
§§@ A
an
§§A C
=>
§§D F
an
§§G I
.
§§I J
id
§§J L
==
§§M O
transaccion
§§P [
.
§§[ \&
id_actor_negocio_externo
§§\ t
)
§§t u
.
§§u v
Actor
§§v {
.
§§{ |)
numero_documento_identidad§§| ñ
,§§ñ ó
NombreCliente
•• %
=
••& '
actoresNegocio
••( 6
.
••6 7
Single
••7 =
(
••= >
an
••> @
=>
••A C
an
••D F
.
••F G
id
••G I
==
••J L
transaccion
••M X
.
••X Y&
id_actor_negocio_externo
••Y q
)
••q r
.
••r s
Actor
••s x
.
••x y
primer_nombre••y Ü
,••Ü á 
PrimerNombreCajero
¶¶ *
=
¶¶+ ,
actoresNegocio
¶¶- ;
.
¶¶; <
Single
¶¶< B
(
¶¶B C
an
¶¶C E
=>
¶¶F H
an
¶¶I K
.
¶¶K L
id
¶¶L N
==
¶¶O Q
transaccion
¶¶R ]
.
¶¶] ^
id_empleado
¶¶^ i
)
¶¶i j
.
¶¶j k
Actor
¶¶k p
.
¶¶p q
primer_nombre
¶¶q ~
,
¶¶~ !
SegundoNombreCajero
ßß +
=
ßß, -
actoresNegocio
ßß. <
.
ßß< =
Single
ßß= C
(
ßßC D
an
ßßD F
=>
ßßG I
an
ßßJ L
.
ßßL M
id
ßßM O
==
ßßP R
transaccion
ßßS ^
.
ßß^ _
id_empleado
ßß_ j
)
ßßj k
.
ßßk l
Actor
ßßl q
.
ßßq r
segundo_nombreßßr Ä
,ßßÄ Å 
TercerNombreCajero
®® *
=
®®+ ,
actoresNegocio
®®- ;
.
®®; <
Single
®®< B
(
®®B C
an
®®C E
=>
®®F H
an
®®I K
.
®®K L
id
®®L N
==
®®O Q
transaccion
®®R ]
.
®®] ^
id_empleado
®®^ i
)
®®i j
.
®®j k
Actor
®®k p
.
®®p q
tercer_nombre
®®q ~
,
®®~ 
ImporteTotal
©© $
=
©©% &
transaccion
©©' 2
.
©©2 3
importe_total
©©3 @
,
©©@ A'
ValorParametroTipoDeVenta
™™ 1
=
™™2 3%
parametrosTransacciones
™™4 K
.
™™K L
SingleOrDefault
™™L [
(
™™[ \
pt
™™\ ^
=>
™™_ a
pt
™™b d
.
™™d e
id_transaccion
™™e s
==
™™t v
transaccion™™w Ç
.™™Ç É
id™™É Ö
&&™™Ü à
pt™™â ã
.™™ã å
id_parametro™™å ò
==™™ô õ
MaestroSettings™™ú ´
.™™´ ¨
Default™™¨ ≥
.™™≥ ¥2
"IdDetalleMaestroParametroTipoVenta™™¥ ÷
)™™÷ ◊
?™™◊ ÿ
.™™ÿ Ÿ
valor™™Ÿ ﬁ
,™™ﬁ ﬂ&
ValorParametroModoDePago
´´ 0
=
´´1 2%
parametrosTransacciones
´´3 J
.
´´J K
SingleOrDefault
´´K Z
(
´´Z [
pt
´´[ ]
=>
´´^ `
pt
´´a c
.
´´c d
id_transaccion
´´d r
==
´´s u
transaccion´´v Å
.´´Å Ç
id´´Ç Ñ
&&´´Ö á
pt´´à ä
.´´ä ã
id_parametro´´ã ó
==´´ò ö
MaestroSettings´´õ ™
.´´™ ´
Default´´´ ≤
.´´≤ ≥3
#IdDetalleMaestroParametroModoDePago´´≥ ÷
)´´÷ ◊
?´´◊ ÿ
.´´ÿ Ÿ
valor´´Ÿ ﬁ
,´´ﬁ ﬂ*
ValorParametroAliasDeCliente
¨¨ 4
=
¨¨5 6%
parametrosTransacciones
¨¨7 N
.
¨¨N O
SingleOrDefault
¨¨O ^
(
¨¨^ _
pt
¨¨_ a
=>
¨¨b d
pt
¨¨e g
.
¨¨g h
id_transaccion
¨¨h v
==
¨¨w y
transaccion¨¨z Ö
.¨¨Ö Ü
id¨¨Ü à
&&¨¨â ã
pt¨¨å é
.¨¨é è
id_parametro¨¨è õ
==¨¨ú û
MaestroSettings¨¨ü Æ
.¨¨Æ Ø
Default¨¨Ø ∂
.¨¨∂ ∑5
%IdDetalleMaestroParametroAliasCliente¨¨∑ ‹
)¨¨‹ ›
?¨¨› ﬁ
.¨¨ﬁ ﬂ
valor¨¨ﬂ ‰
,¨¨‰ Â
IdEstado
≠≠  
=
≠≠! ""
EstadosTransacciones
≠≠# 7
.
≠≠7 8
Single
≠≠8 >
(
≠≠> ?
et
≠≠? A
=>
≠≠B D
et
≠≠E G
.
≠≠G H
id
≠≠H J
==
≠≠K M
transaccion
≠≠N Y
.
≠≠Y Z
id_estado_actual
≠≠Z j
)
≠≠j k
.
≠≠k l
id
≠≠l n
,
≠≠n o
Estado
ÆÆ 
=
ÆÆ  "
EstadosTransacciones
ÆÆ! 5
.
ÆÆ5 6
Single
ÆÆ6 <
(
ÆÆ< =
et
ÆÆ= ?
=>
ÆÆ@ B
et
ÆÆC E
.
ÆÆE F
id
ÆÆF H
==
ÆÆI K
transaccion
ÆÆL W
.
ÆÆW X
id_estado_actual
ÆÆX h
)
ÆÆh i
.
ÆÆi j
nombre
ÆÆj p
,
ÆÆp q
Transmitido
ØØ #
=
ØØ$ %"
EventosTransacciones
ØØ& :
.
ØØ: ;
SingleOrDefault
ØØ; J
(
ØØJ K
et
ØØK M
=>
ØØN P
et
ØØQ S
.
ØØS T
id_transaccion
ØØT b
==
ØØc e
transaccion
ØØf q
.
ØØq r
id
ØØr t
&&
ØØu w
et
ØØx z
.
ØØz {
	id_eventoØØ{ Ñ
==ØØÖ á
MaestroSettingsØØà ó
.ØØó ò
DefaultØØò ü
.ØØü †1
!IdDetalleMaestroEstadoTransmitidoØØ† ¡
)ØØ¡ ¬
!=ØØ√ ≈
nullØØ∆  
}
∞∞ 
)
∞∞ 
;
∞∞ 
}
±± 
return
≤≤ 
resumenes_Ventas
≤≤ '
;
≤≤' (
}
≥≥ 
catch
¥¥ 
(
¥¥ 
	Exception
¥¥ 
e
¥¥ 
)
¥¥ 
{
µµ 
throw
∂∂ 
new
∂∂ 
DatosException
∂∂ (
(
∂∂( )
$str
∂∂) I
,
∂∂I J
e
∂∂K L
)
∂∂L M
;
∂∂M N
}
∑∑ 
finally
∏∏ 
{
ππ 
_db
∫∫ 
.
∫∫ 
Configuration
∫∫ !
.
∫∫! " 
LazyLoadingEnabled
∫∫" 4
=
∫∫5 6
true
∫∫7 ;
;
∫∫; <
}
ªª 
}
ºº 	
public
ææ 
IEnumerable
ææ 
<
ææ 
Transaccion
ææ &
>
ææ& 'H
:ObtenerTransaccionesInclusiveActoresYDetalleMaestroYEstado
ææ( b
(
ææb c
int
ææc f
[
ææf g
]
ææg h!
idsTiposTransaccion
ææi |
,
ææ| }
intææ~ Å
[ææÅ Ç
]ææÇ É$
idsTiposComprobantesææÑ ò
,ææò ô
DateTimeææö ¢

fechaDesdeææ£ ≠
,ææ≠ Æ
DateTimeææØ ∑

fechaHastaææ∏ ¬
)ææ¬ √
{
øø 	
try
¿¿ 
{
¡¡ 
return
ƒƒ 
_db
ƒƒ 
.
ƒƒ 
Transaccion
ƒƒ &
.
≈≈ 
Include
≈≈ 
(
≈≈ 
t
≈≈ 
=>
≈≈ !
t
≈≈" #
.
≈≈# $
Actor_negocio
≈≈$ 1
)
≈≈1 2
.
≈≈2 3
Include
≈≈3 :
(
≈≈: ;
t
≈≈; <
=>
≈≈= ?
t
≈≈@ A
.
≈≈A B
Actor_negocio1
≈≈B P
)
≈≈P Q
.
∆∆ 
Include
∆∆ 
(
∆∆ 
t
∆∆ 
=>
∆∆ !
t
∆∆" #
.
∆∆# $
Actor_negocio2
∆∆$ 2
)
∆∆2 3
.
«« 
Include
«« 
(
«« 
t
«« 
=>
«« !
t
««" #
.
««# $
Actor_negocio
««$ 1
.
««1 2
Actor
««2 7
.
««7 8
Detalle_maestro
««8 G
)
««G H
.
»» 
Include
»» 
(
»» 
t
»» 
=>
»» !
t
»»" #
.
»»# $
Actor_negocio1
»»$ 2
.
»»2 3
Actor
»»3 8
.
»»8 9
Detalle_maestro
»»9 H
)
»»H I
.
…… 
Include
…… 
(
…… 
t
…… 
=>
…… !
t
……" #
.
……# $
Actor_negocio2
……$ 2
.
……2 3
Actor
……3 8
.
……8 9
Detalle_maestro
……9 H
)
……H I
.
   
Include
   
(
   
t
   
=>
   !
t
  " #
.
  # $
Detalle_maestro1
  $ 4
)
  4 5
.
  5 6
Include
  6 =
(
  = >
t
  > ?
=>
  @ B
t
  C D
.
  D E 
Estado_transaccion
  E W
.
  W X
Select
  X ^
(
  ^ _
et
  _ a
=>
  b d
et
  e g
.
  g h
Detalle_maestro
  h w
)
  w x
)
  x y
.
ÀÀ 
Include
ÀÀ 
(
ÀÀ 
t
ÀÀ 
=>
ÀÀ !
t
ÀÀ" #
.
ÀÀ# $
Comprobante
ÀÀ$ /
)
ÀÀ/ 0
.
ÀÀ0 1
Include
ÀÀ1 8
(
ÀÀ8 9
t
ÀÀ9 :
=>
ÀÀ; =
t
ÀÀ> ?
.
ÀÀ? @
Comprobante
ÀÀ@ K
.
ÀÀK L
Detalle_maestro
ÀÀL [
)
ÀÀ[ \
.
ÃÃ 
Include
ÃÃ 
(
ÃÃ 
t
ÃÃ 
=>
ÃÃ !
t
ÃÃ" #
.
ÃÃ# $#
Parametro_transaccion
ÃÃ$ 9
)
ÃÃ9 :
.
ÕÕ 
Where
ÕÕ 
(
ÕÕ 
t
ÕÕ 
=>
ÕÕ 
t
ÕÕ  !
.
ÕÕ! "
fecha_inicio
ÕÕ" .
>=
ÕÕ/ 1

fechaDesde
ÕÕ2 <
&&
ÕÕ= ?
t
ÕÕ@ A
.
ÕÕA B
fecha_inicio
ÕÕB N
<=
ÕÕO Q

fechaHasta
ÕÕR \
&&
ÕÕ] _"
idsTiposComprobantes
ÕÕ` t
.
ÕÕt u
Contains
ÕÕu }
(
ÕÕ} ~
t
ÕÕ~ 
.ÕÕ Ä
ComprobanteÕÕÄ ã
.ÕÕã å#
id_tipo_comprobanteÕÕå ü
)ÕÕü †
&&ÕÕ° £#
idsTiposTransaccionÕÕ§ ∑
.ÕÕ∑ ∏
ContainsÕÕ∏ ¿
(ÕÕ¿ ¡
tÕÕ¡ ¬
.ÕÕ¬ √#
id_tipo_transaccionÕÕ√ ÷
)ÕÕ÷ ◊
)ÕÕ◊ ÿ
;ÕÕÿ Ÿ
}
ŒŒ 
catch
œœ 
(
œœ 
	Exception
œœ 
e
œœ 
)
œœ 
{
–– 
throw
—— 
new
—— 
DatosException
—— (
(
——( )
$str
——) I
,
——I J
e
——K L
)
——L M
;
——M N
}
““ 
}
”” 	
public
‹‹ 
IEnumerable
‹‹ 
<
‹‹ 
Transaccion
‹‹ &
>
‹‹& 'H
:ObtenerTransaccionesInclusiveActoresYDetalleMaestroYEstado
‹‹( b
(
‹‹b c
int
‹‹c f
idTipoTransaccion
‹‹g x
,
‹‹x y
DateTime‹‹z Ç

fechaDesde‹‹É ç
,‹‹ç é
DateTime‹‹è ó

fechaHasta‹‹ò ¢
)‹‹¢ £
{
›› 	
try
ﬁﬁ 
{
ﬂﬂ 
return
‡‡ 
_db
‡‡ 
.
‡‡ 
Transaccion
‡‡ &
.
‡‡& '
Include
·· 
(
·· 
t
·· 
=>
··  
t
··! "
.
··" #
Actor_negocio
··# 0
)
··0 1
.
··1 2
Include
‚‚ 
(
‚‚ 
t
‚‚ 
=>
‚‚  
t
‚‚! "
.
‚‚" #
Actor_negocio1
‚‚# 1
)
‚‚1 2
.
‚‚2 3
Include
„„ 
(
„„ 
t
„„ 
=>
„„  
t
„„! "
.
„„" #
Actor_negocio2
„„# 1
)
„„1 2
.
„„2 3
Include
‰‰ 
(
‰‰ 
t
‰‰ 
=>
‰‰  
t
‰‰! "
.
‰‰" #
Actor_negocio
‰‰# 0
.
‰‰0 1
Actor
‰‰1 6
)
‰‰6 7
.
‰‰7 8
Include
ÂÂ 
(
ÂÂ 
t
ÂÂ 
=>
ÂÂ  
t
ÂÂ! "
.
ÂÂ" #
Actor_negocio1
ÂÂ# 1
.
ÂÂ1 2
Actor
ÂÂ2 7
)
ÂÂ7 8
.
ÂÂ8 9
Include
ÊÊ 
(
ÊÊ 
t
ÊÊ 
=>
ÊÊ  
t
ÊÊ! "
.
ÊÊ" #
Actor_negocio2
ÊÊ# 1
.
ÊÊ1 2
Actor
ÊÊ2 7
)
ÊÊ7 8
.
ÊÊ8 9
Include
ÁÁ 
(
ÁÁ 
t
ÁÁ 
=>
ÁÁ  
t
ÁÁ! "
.
ÁÁ" #
Actor_negocio
ÁÁ# 0
.
ÁÁ0 1
Actor
ÁÁ1 6
.
ÁÁ6 7
Detalle_maestro
ÁÁ7 F
)
ÁÁF G
.
ÁÁG H
Include
ËË 
(
ËË 
t
ËË 
=>
ËË  
t
ËË! "
.
ËË" #
Actor_negocio1
ËË# 1
.
ËË1 2
Actor
ËË2 7
.
ËË7 8
Detalle_maestro
ËË8 G
)
ËËG H
.
ËËH I
Include
ÈÈ 
(
ÈÈ 
t
ÈÈ 
=>
ÈÈ  
t
ÈÈ! "
.
ÈÈ" #
Actor_negocio2
ÈÈ# 1
.
ÈÈ1 2
Actor
ÈÈ2 7
.
ÈÈ7 8
Detalle_maestro
ÈÈ8 G
)
ÈÈG H
.
ÈÈH I
Include
ÍÍ 
(
ÍÍ 
t
ÍÍ 
=>
ÍÍ  
t
ÍÍ! "
.
ÍÍ" #
Detalle_maestro1
ÍÍ# 3
)
ÍÍ3 4
.
ÍÍ4 5
Include
ÎÎ 
(
ÎÎ 
t
ÎÎ 
=>
ÎÎ  
t
ÎÎ! "
.
ÎÎ" # 
Estado_transaccion
ÎÎ# 5
.
ÎÎ5 6
Select
ÎÎ6 <
(
ÎÎ< =
et
ÎÎ= ?
=>
ÎÎ@ B
et
ÎÎC E
.
ÎÎE F
Detalle_maestro
ÎÎF U
)
ÎÎU V
)
ÎÎV W
.
ÎÎW X
Include
ÏÏ 
(
ÏÏ 
t
ÏÏ 
=>
ÏÏ  
t
ÏÏ! "
.
ÏÏ" #
Comprobante
ÏÏ# .
)
ÏÏ. /
.
ÏÏ/ 0
Include
ÌÌ 
(
ÌÌ 
t
ÌÌ 
=>
ÌÌ  
t
ÌÌ! "
.
ÌÌ" #
Comprobante
ÌÌ# .
.
ÌÌ. /
Detalle_maestro
ÌÌ/ >
)
ÌÌ> ?
.
ÌÌ? @
Include
ÓÓ 
(
ÓÓ 
t
ÓÓ 
=>
ÓÓ  
t
ÓÓ! "
.
ÓÓ" ##
Parametro_transaccion
ÓÓ# 8
)
ÓÓ8 9
.
ÓÓ9 :
Where
ÔÔ 
(
ÔÔ 
t
ÔÔ 
=>
ÔÔ 
t
ÔÔ  
.
ÔÔ  !!
id_tipo_transaccion
ÔÔ! 4
==
ÔÔ5 7
idTipoTransaccion
ÔÔ8 I
&&
ÔÔJ L
t
ÔÔM N
.
ÔÔN O
fecha_inicio
ÔÔO [
>=
ÔÔ\ ^

fechaDesde
ÔÔ_ i
&&
ÔÔj l
t
ÔÔm n
.
ÔÔn o
fecha_inicio
ÔÔo {
<=
ÔÔ| ~

fechaHastaÔÔ â
)ÔÔâ ä
;ÔÔä ã
}
 
catch
ÒÒ 
(
ÒÒ 
	Exception
ÒÒ 
e
ÒÒ 
)
ÒÒ 
{
ÚÚ 
throw
ÛÛ 
new
ÛÛ 
DatosException
ÛÛ (
(
ÛÛ( )
$str
ÛÛ) I
,
ÛÛI J
e
ÛÛK L
)
ÛÛL M
;
ÛÛM N
}
ÙÙ 
}
ıı 	
public
˜˜ 
IEnumerable
˜˜ 
<
˜˜ 
Transaccion
˜˜ &
>
˜˜& 'H
:ObtenerTransaccionesInclusiveActoresYDetalleMaestroYEstado
˜˜( b
(
˜˜b c
int
˜˜c f
[
˜˜f g
]
˜˜g h 
idsTipoTransaccion
˜˜i {
,
˜˜{ |
int˜˜} Ä
idUltimoEstado˜˜Å è
,˜˜è ê
DateTime˜˜ë ô

fechaDesde˜˜ö §
,˜˜§ •
DateTime˜˜¶ Æ

fechaHasta˜˜Ø π
)˜˜π ∫
{
¯¯ 	
try
˘˘ 
{
˙˙ 
return
˚˚ 
_db
˚˚ 
.
˚˚ 
Transaccion
˚˚ &
.
¸¸ 
Include
¸¸ 
(
¸¸ 
t
¸¸ 
=>
¸¸ !
t
¸¸" #
.
¸¸# $!
Detalle_transaccion
¸¸$ 7
)
¸¸7 8
.
˝˝ 
Include
˝˝ 
(
˝˝ 
t
˝˝ 
=>
˝˝ !
t
˝˝" #
.
˝˝# $!
Detalle_transaccion
˝˝$ 7
.
˝˝7 8
Select
˝˝8 >
(
˝˝> ?
dt
˝˝? A
=>
˝˝B D
dt
˝˝E G
.
˝˝G H
Concepto_negocio
˝˝H X
.
˝˝X Y
Detalle_maestro4
˝˝Y i
)
˝˝i j
)
˝˝j k
.
˛˛ 
Include
˛˛ 
(
˛˛ 
t
˛˛ 
=>
˛˛ !
t
˛˛" #
.
˛˛# $
Actor_negocio
˛˛$ 1
)
˛˛1 2
.
ˇˇ 
Include
ˇˇ 
(
ˇˇ 
t
ˇˇ 
=>
ˇˇ !
t
ˇˇ" #
.
ˇˇ# $
Actor_negocio1
ˇˇ$ 2
)
ˇˇ2 3
.
ÄÄ 
Include
ÄÄ 
(
ÄÄ 
t
ÄÄ 
=>
ÄÄ !
t
ÄÄ" #
.
ÄÄ# $
Actor_negocio2
ÄÄ$ 2
)
ÄÄ2 3
.
ÅÅ 
Include
ÅÅ 
(
ÅÅ 
t
ÅÅ 
=>
ÅÅ !
t
ÅÅ" #
.
ÅÅ# $
Actor_negocio
ÅÅ$ 1
.
ÅÅ1 2
Actor
ÅÅ2 7
.
ÅÅ7 8
Detalle_maestro
ÅÅ8 G
)
ÅÅG H
.
ÇÇ 
Include
ÇÇ 
(
ÇÇ 
t
ÇÇ 
=>
ÇÇ !
t
ÇÇ" #
.
ÇÇ# $
Actor_negocio1
ÇÇ$ 2
.
ÇÇ2 3
Actor
ÇÇ3 8
.
ÇÇ8 9
Detalle_maestro
ÇÇ9 H
)
ÇÇH I
.
ÉÉ 
Include
ÉÉ 
(
ÉÉ 
t
ÉÉ 
=>
ÉÉ !
t
ÉÉ" #
.
ÉÉ# $
Actor_negocio2
ÉÉ$ 2
.
ÉÉ2 3
Actor
ÉÉ3 8
.
ÉÉ8 9
Detalle_maestro
ÉÉ9 H
)
ÉÉH I
.
ÑÑ 
Include
ÑÑ 
(
ÑÑ 
t
ÑÑ 
=>
ÑÑ !
t
ÑÑ" #
.
ÑÑ# $
Detalle_maestro1
ÑÑ$ 4
)
ÑÑ4 5
.
ÖÖ 
Include
ÖÖ 
(
ÖÖ 
t
ÖÖ 
=>
ÖÖ !
t
ÖÖ" #
.
ÖÖ# $ 
Estado_transaccion
ÖÖ$ 6
.
ÖÖ6 7
Select
ÖÖ7 =
(
ÖÖ= >
et
ÖÖ> @
=>
ÖÖA C
et
ÖÖD F
.
ÖÖF G
Detalle_maestro
ÖÖG V
)
ÖÖV W
)
ÖÖW X
.
ÜÜ 
Include
ÜÜ 
(
ÜÜ 
t
ÜÜ 
=>
ÜÜ !
t
ÜÜ" #
.
ÜÜ# $
Comprobante
ÜÜ$ /
)
ÜÜ/ 0
.
áá 
Include
áá 
(
áá 
t
áá 
=>
áá !
t
áá" #
.
áá# $
Comprobante
áá$ /
.
áá/ 0
Detalle_maestro
áá0 ?
)
áá? @
.
àà 
Include
àà 
(
àà 
t
àà 
=>
àà  "
t
àà# $
.
àà$ %#
Parametro_transaccion
àà% :
)
àà: ;
.
ââ 
Where
ââ 
(
ââ 
t
ââ 
=>
ââ 
t
ââ 
.
ââ  
fecha_inicio
ââ  ,
>=
ââ- /

fechaDesde
ââ0 :
&&
ää  
t
ää! "
.
ää" #
fecha_inicio
ää# /
<=
ää0 2

fechaHasta
ää3 =
&&
ãã   
idsTipoTransaccion
ãã! 3
.
ãã3 4
Contains
ãã4 <
(
ãã< =
t
ãã= >
.
ãã> ?!
id_tipo_transaccion
ãã? R
)
ããR S
&&
åå  
t
åå! "
.
åå" #
id_estado_actual
åå# 3
==
åå4 6
idUltimoEstado
åå7 E
)
çç 
;
çç 
}
éé 
catch
èè 
(
èè 
	Exception
èè 
e
èè 
)
èè 
{
êê 
throw
ëë 
new
ëë 
DatosException
ëë (
(
ëë( )
$str
ëë) I
,
ëëI J
e
ëëK L
)
ëëL M
;
ëëM N
}
íí 
}
ìì 	
public
ïï 
IEnumerable
ïï 
<
ïï 
Transaccion
ïï &
>
ïï& 'I
;ObtenerTransaccionesInclusiveActoresYDetalleMaestroYEstado_
ïï( c
(
ïïc d
int
ïïd g
idTipoTransaccion
ïïh y
,
ïïy z
int
ïï{ ~
idEntidadInternaïï è
,ïïè ê
DateTimeïïë ô

fechaDesdeïïö §
,ïï§ •
DateTimeïï¶ Æ

fechaHastaïïØ π
)ïïπ ∫
{
ññ 	
try
óó 
{
òò 
return
ôô 
_db
ôô 
.
ôô 
Transaccion
ôô &
.
ôô& '
Include
ôô' .
(
ôô. /
t
ôô/ 0
=>
ôô1 3
t
ôô4 5
.
ôô5 6
Actor_negocio
ôô6 C
)
ôôC D
.
ôôD E
Include
ôôE L
(
ôôL M
t
ôôM N
=>
ôôO Q
t
ôôR S
.
ôôS T
Actor_negocio1
ôôT b
)
ôôb c
.
ôôc d
Include
ôôd k
(
ôôk l
t
ôôl m
=>
ôôn p
t
ôôq r
.
ôôr s
Actor_negocio2ôôs Å
)ôôÅ Ç
.
öö 
Include
öö 
(
öö 
t
öö 
=>
öö !
t
öö" #
.
öö# $
Actor_negocio
öö$ 1
.
öö1 2
Actor
öö2 7
.
öö7 8
Detalle_maestro
öö8 G
)
ööG H
.
õõ 
Include
õõ 
(
õõ 
t
õõ 
=>
õõ !
t
õõ" #
.
õõ# $
Actor_negocio1
õõ$ 2
.
õõ2 3
Actor
õõ3 8
.
õõ8 9
Detalle_maestro
õõ9 H
)
õõH I
.
úú 
Include
úú 
(
úú 
t
úú 
=>
úú !
t
úú" #
.
úú# $
Actor_negocio2
úú$ 2
.
úú2 3
Actor
úú3 8
.
úú8 9
Detalle_maestro
úú9 H
)
úúH I
.
ùù 
Include
ùù 
(
ùù 
t
ùù 
=>
ùù !
t
ùù" #
.
ùù# $
Detalle_maestro1
ùù$ 4
)
ùù4 5
.
ùù5 6
Include
ùù6 =
(
ùù= >
t
ùù> ?
=>
ùù@ B
t
ùùC D
.
ùùD E 
Estado_transaccion
ùùE W
.
ùùW X
Select
ùùX ^
(
ùù^ _
et
ùù_ a
=>
ùùb d
et
ùùe g
.
ùùg h
Detalle_maestro
ùùh w
)
ùùw x
)
ùùx y
.
ûû 
Include
ûû 
(
ûû 
t
ûû 
=>
ûû !
t
ûû" #
.
ûû# $
Comprobante
ûû$ /
)
ûû/ 0
.
ûû0 1
Include
ûû1 8
(
ûû8 9
t
ûû9 :
=>
ûû; =
t
ûû> ?
.
ûû? @
Comprobante
ûû@ K
.
ûûK L
Detalle_maestro
ûûL [
)
ûû[ \
.
üü 
Where
üü 
(
üü 
t
üü 
=>
üü 
t
üü  !
.
üü! "&
id_actor_negocio_interno
üü" :
==
üü; =
idEntidadInterna
üü> N
&&
üüO Q
t
üüR S
.
üüS T!
id_tipo_transaccion
üüT g
==
üüh j
idTipoTransaccion
üük |
&&
üü} 
tüüÄ Å
.üüÅ Ç
fecha_inicioüüÇ é
>=üüè ë

fechaDesdeüüí ú
&&üüù ü
tüü† °
.üü° ¢
fecha_inicioüü¢ Æ
<=üüØ ±

fechaHastaüü≤ º
)üüº Ω
;üüΩ æ
}
†† 
catch
°° 
(
°° 
	Exception
°° 
e
°° 
)
°° 
{
¢¢ 
throw
££ 
new
££ 
DatosException
££ (
(
££( )
$str
££) I
,
££I J
e
££K L
)
££L M
;
££M N
}
§§ 
}
•• 	
public
ßß 
IEnumerable
ßß 
<
ßß 
Transaccion
ßß &
>
ßß& 'I
;ObtenerTransaccionesInclusiveActoresYDetalleMaestroYEstado_
ßß( c
(
ßßc d
int
ßßd g
[
ßßg h
]
ßßh i 
idsTipoTransaccion
ßßj |
,
ßß| }
intßß~ Å 
idEntidadInternaßßÇ í
,ßßí ì
DateTimeßßî ú

fechaDesdeßßù ß
,ßßß ®
DateTimeßß© ±

fechaHastaßß≤ º
)ßßº Ω
{
®® 	
try
©© 
{
™™ 
return
´´ 
_db
´´ 
.
´´ 
Transaccion
´´ &
.
´´& '
Include
´´' .
(
´´. /
t
´´/ 0
=>
´´1 3
t
´´4 5
.
´´5 6
Actor_negocio
´´6 C
)
´´C D
.
´´D E
Include
´´E L
(
´´L M
t
´´M N
=>
´´O Q
t
´´R S
.
´´S T
Actor_negocio1
´´T b
)
´´b c
.
´´c d
Include
´´d k
(
´´k l
t
´´l m
=>
´´n p
t
´´q r
.
´´r s
Actor_negocio2´´s Å
)´´Å Ç
.
¨¨ 
Include
¨¨ 
(
¨¨ 
t
¨¨ 
=>
¨¨ !
t
¨¨" #
.
¨¨# $
Actor_negocio
¨¨$ 1
.
¨¨1 2
Actor
¨¨2 7
.
¨¨7 8
Detalle_maestro
¨¨8 G
)
¨¨G H
.
≠≠ 
Include
≠≠ 
(
≠≠ 
t
≠≠ 
=>
≠≠ !
t
≠≠" #
.
≠≠# $
Actor_negocio1
≠≠$ 2
.
≠≠2 3
Actor
≠≠3 8
.
≠≠8 9
Detalle_maestro
≠≠9 H
)
≠≠H I
.
ÆÆ 
Include
ÆÆ 
(
ÆÆ 
t
ÆÆ 
=>
ÆÆ !
t
ÆÆ" #
.
ÆÆ# $
Actor_negocio2
ÆÆ$ 2
.
ÆÆ2 3
Actor
ÆÆ3 8
.
ÆÆ8 9
Detalle_maestro
ÆÆ9 H
)
ÆÆH I
.
ØØ 
Include
ØØ 
(
ØØ 
t
ØØ 
=>
ØØ !
t
ØØ" #
.
ØØ# $
Detalle_maestro1
ØØ$ 4
)
ØØ4 5
.
ØØ5 6
Include
ØØ6 =
(
ØØ= >
t
ØØ> ?
=>
ØØ@ B
t
ØØC D
.
ØØD E 
Estado_transaccion
ØØE W
.
ØØW X
Select
ØØX ^
(
ØØ^ _
et
ØØ_ a
=>
ØØb d
et
ØØe g
.
ØØg h
Detalle_maestro
ØØh w
)
ØØw x
)
ØØx y
.
∞∞ 
Include
∞∞ 
(
∞∞ 
t
∞∞ 
=>
∞∞ !
t
∞∞" #
.
∞∞# $
Comprobante
∞∞$ /
)
∞∞/ 0
.
∞∞0 1
Include
∞∞1 8
(
∞∞8 9
t
∞∞9 :
=>
∞∞; =
t
∞∞> ?
.
∞∞? @
Comprobante
∞∞@ K
.
∞∞K L
Detalle_maestro
∞∞L [
)
∞∞[ \
.
±± 
Where
±± 
(
±± 
t
±± 
=>
±± 
t
±±  !
.
±±! "&
id_actor_negocio_interno
±±" :
==
±±; =
idEntidadInterna
±±> N
&&
±±O Q 
idsTipoTransaccion
±±R d
.
±±d e
Contains
±±e m
(
±±m n
t
±±n o
.
±±o p"
id_tipo_transaccion±±p É
)±±É Ñ
&&±±Ö á
t±±à â
.±±â ä
fecha_inicio±±ä ñ
>=±±ó ô

fechaDesde±±ö §
&&±±• ß
t±±® ©
.±±© ™
fecha_inicio±±™ ∂
<=±±∑ π

fechaHasta±±∫ ƒ
)±±ƒ ≈
;±±≈ ∆
}
≤≤ 
catch
≥≥ 
(
≥≥ 
	Exception
≥≥ 
e
≥≥ 
)
≥≥ 
{
¥¥ 
throw
µµ 
new
µµ 
DatosException
µµ (
(
µµ( )
$str
µµ) I
,
µµI J
e
µµK L
)
µµL M
;
µµM N
}
∂∂ 
}
∑∑ 	
public
ππ 
IEnumerable
ππ 
<
ππ 
Transaccion
ππ &
>
ππ& 'I
;ObtenerTransaccionesInclusiveActoresYDetalleMaestroYEstado_
ππ( c
(
ππc d
int
ππd g
[
ππg h
]
ππh i 
idsTipoTransaccion
ππj |
,
ππ| }
intππ~ Å
idUltimoEstadoππÇ ê
,ππê ë
intππí ï 
idEntidadInternaππñ ¶
,ππ¶ ß
DateTimeππ® ∞

fechaDesdeππ± ª
,ππª º
DateTimeππΩ ≈

fechaHastaππ∆ –
)ππ– —
{
∫∫ 	
try
ªª 
{
ºº 
var
ΩΩ 
transacciones
ΩΩ !
=
ΩΩ" #
_db
ΩΩ$ '
.
ΩΩ' (
Transaccion
ΩΩ( 3
.
ææ 
Include
ææ 
(
ææ 
t
ææ 
=>
ææ !
t
ææ" #
.
ææ# $
Tipo_transaccion
ææ$ 4
)
ææ4 5
.
øø 
Include
øø 
(
øø 
t
øø 
=>
øø !
t
øø" #
.
øø# $
Transaccion2
øø$ 0
.
øø0 1
Tipo_transaccion
øø1 A
)
øøA B
.
¿¿ 
Include
¿¿ 
(
¿¿ 
t
¿¿ 
=>
¿¿ !
t
¿¿" #
.
¿¿# $
Actor_negocio1
¿¿$ 2
)
¿¿2 3
.
¡¡ 
Include
¡¡ 
(
¡¡ 
t
¡¡ 
=>
¡¡ !
t
¡¡" #
.
¡¡# $
Actor_negocio1
¡¡$ 2
.
¡¡2 3
Actor
¡¡3 8
)
¡¡8 9
.
¬¬ 
Include
¬¬ 
(
¬¬ 
t
¬¬ 
=>
¬¬ !
t
¬¬" #
.
¬¬# $
Comprobante
¬¬$ /
)
¬¬/ 0
.
√√ 
Include
√√ 
(
√√ 
t
√√ 
=>
√√ !
t
√√" #
.
√√# $
Comprobante
√√$ /
.
√√/ 0
Detalle_maestro
√√0 ?
)
√√? @
.
ƒƒ 
Include
ƒƒ 
(
ƒƒ 
t
ƒƒ 
=>
ƒƒ !
t
ƒƒ" #
.
ƒƒ# $
Comprobante
ƒƒ$ /
.
ƒƒ/ 0
Detalle_maestro
ƒƒ0 ?
.
ƒƒ? @/
!Tipo_transaccion_tipo_comprobante
ƒƒ@ a
)
ƒƒa b
.
≈≈ 
Include
≈≈ 
(
≈≈ 
t
≈≈ 
=>
≈≈ !
t
≈≈" #
.
≈≈# $ 
Estado_transaccion
≈≈$ 6
)
≈≈6 7
.
∆∆ 
Where
∆∆ 
(
∆∆ 
t
∆∆ 
=>
∆∆ 
t
∆∆  !
.
∆∆! "&
id_actor_negocio_interno
∆∆" :
==
∆∆; =
idEntidadInterna
∆∆> N
&&
««  
idsTipoTransaccion
«« )
.
««) *
Contains
««* 2
(
««2 3
t
««3 4
.
««4 5!
id_tipo_transaccion
««5 H
)
««H I
&&
»» 
t
»» 
.
»» 
fecha_inicio
»» %
>=
»»& (

fechaDesde
»») 3
&&
»»4 6
t
»»7 8
.
»»8 9
fecha_inicio
»»9 E
<=
»»F H

fechaHasta
»»I S
&&
…… 
t
…… 
.
…… 
id_estado_actual
…… )
==
……* ,
idUltimoEstado
……- ;
)
   
;
   
return
ÃÃ 
transacciones
ÃÃ $
;
ÃÃ$ %
}
ÕÕ 
catch
ŒŒ 
(
ŒŒ 
	Exception
ŒŒ 
e
ŒŒ 
)
ŒŒ 
{
œœ 
throw
–– 
new
–– 
DatosException
–– (
(
––( )
$str
––) I
,
––I J
e
––K L
)
––L M
;
––M N
}
—— 
}
““ 	
public
”” 
IEnumerable
”” 
<
”” 
Transaccion
”” &
>
””& 'I
;ObtenerTransaccionesInclusiveActoresYDetalleMaestroYEstado_
””( c
(
””c d
int
””d g
[
””g h
]
””h i 
idsTipoTransaccion
””j |
,
””| }
int””~ Å
[””Å Ç
]””Ç É!
idsEntidadInterna””Ñ ï
,””ï ñ
int””ó ö!
idTipoComprobante””õ ¨
,””¨ ≠
DateTime””Æ ∂

fechaDesde””∑ ¡
,””¡ ¬
DateTime””√ À

fechaHasta””Ã ÷
)””÷ ◊
{
‘‘ 	
try
’’ 
{
÷÷ 
return
◊◊ 
_db
◊◊ 
.
◊◊ 
Transaccion
◊◊ &
.
◊◊& '
Include
◊◊' .
(
◊◊. /
t
◊◊/ 0
=>
◊◊1 3
t
◊◊4 5
.
◊◊5 6
Actor_negocio
◊◊6 C
)
◊◊C D
.
◊◊D E
Include
◊◊E L
(
◊◊L M
t
◊◊M N
=>
◊◊O Q
t
◊◊R S
.
◊◊S T
Actor_negocio1
◊◊T b
)
◊◊b c
.
◊◊c d
Include
◊◊d k
(
◊◊k l
t
◊◊l m
=>
◊◊n p
t
◊◊q r
.
◊◊r s
Actor_negocio2◊◊s Å
)◊◊Å Ç
.
ÿÿ 
Include
ÿÿ 
(
ÿÿ 
t
ÿÿ 
=>
ÿÿ !
t
ÿÿ" #
.
ÿÿ# $
Actor_negocio
ÿÿ$ 1
.
ÿÿ1 2
Actor
ÿÿ2 7
.
ÿÿ7 8
Detalle_maestro
ÿÿ8 G
)
ÿÿG H
.
ŸŸ 
Include
ŸŸ 
(
ŸŸ 
t
ŸŸ 
=>
ŸŸ !
t
ŸŸ" #
.
ŸŸ# $
Actor_negocio1
ŸŸ$ 2
.
ŸŸ2 3
Actor
ŸŸ3 8
.
ŸŸ8 9
Detalle_maestro
ŸŸ9 H
)
ŸŸH I
.
⁄⁄ 
Include
⁄⁄ 
(
⁄⁄ 
t
⁄⁄ 
=>
⁄⁄ !
t
⁄⁄" #
.
⁄⁄# $
Actor_negocio2
⁄⁄$ 2
.
⁄⁄2 3
Actor
⁄⁄3 8
.
⁄⁄8 9
Detalle_maestro
⁄⁄9 H
)
⁄⁄H I
.
€€ 
Include
€€ 
(
€€ 
t
€€ 
=>
€€ !
t
€€" #
.
€€# $
Detalle_maestro1
€€$ 4
)
€€4 5
.
€€5 6
Include
€€6 =
(
€€= >
t
€€> ?
=>
€€@ B
t
€€C D
.
€€D E 
Estado_transaccion
€€E W
.
€€W X
Select
€€X ^
(
€€^ _
et
€€_ a
=>
€€b d
et
€€e g
.
€€g h
Detalle_maestro
€€h w
)
€€w x
)
€€x y
.
‹‹ 
Include
‹‹ 
(
‹‹ 
t
‹‹ 
=>
‹‹ !
t
‹‹" #
.
‹‹# $
Comprobante
‹‹$ /
)
‹‹/ 0
.
‹‹0 1
Include
‹‹1 8
(
‹‹8 9
t
‹‹9 :
=>
‹‹; =
t
‹‹> ?
.
‹‹? @
Comprobante
‹‹@ K
.
‹‹K L
Detalle_maestro
‹‹L [
)
‹‹[ \
.
›› 
Where
›› 
(
›› 
t
›› 
=>
›› 
idsEntidadInterna
››  1
.
››1 2
Contains
››2 :
(
››: ;
t
››; <
.
››< =&
id_actor_negocio_interno
››= U
)
››U V
&&
››W Y 
idsTipoTransaccion
››Z l
.
››l m
Contains
››m u
(
››u v
t
››v w
.
››w x"
id_tipo_transaccion››x ã
)››ã å
&&››ç è
t››ê ë
.››ë í
Comprobante››í ù
.››ù û#
id_tipo_comprobante››û ±
==››≤ ¥!
idTipoComprobante››µ ∆
&&››« …
t››  À
.››À Ã
fecha_inicio››Ã ÿ
>=››Ÿ €

fechaDesde››‹ Ê
&&››Á È
t››Í Î
.››Î Ï
fecha_inicio››Ï ¯
<=››˘ ˚

fechaHasta››¸ Ü
)››Ü á
;››á à
}
ﬁﬁ 
catch
ﬂﬂ 
(
ﬂﬂ 
	Exception
ﬂﬂ 
e
ﬂﬂ 
)
ﬂﬂ 
{
‡‡ 
throw
·· 
new
·· 
DatosException
·· (
(
··( )
$str
··) I
,
··I J
e
··K L
)
··L M
;
··M N
}
‚‚ 
}
„„ 	
public
‰‰ 
IEnumerable
‰‰ 
<
‰‰ 
Transaccion
‰‰ &
>
‰‰& 'I
;ObtenerTransaccionesInclusiveActoresYDetalleMaestroYEstado_
‰‰( c
(
‰‰c d
int
‰‰d g
[
‰‰g h
]
‰‰h i 
idsTipoTransaccion
‰‰j |
,
‰‰| }
int‰‰~ Å
[‰‰Å Ç
]‰‰Ç É!
idsEntidadInterna‰‰Ñ ï
,‰‰ï ñ
DateTime‰‰ó ü

fechaDesde‰‰† ™
,‰‰™ ´
DateTime‰‰¨ ¥

fechaHasta‰‰µ ø
)‰‰ø ¿
{
ÂÂ 	
try
ÊÊ 
{
ÁÁ 
return
ËË 
_db
ËË 
.
ËË 
Transaccion
ËË &
.
ËË& '
Include
ËË' .
(
ËË. /
t
ËË/ 0
=>
ËË1 3
t
ËË4 5
.
ËË5 6
Actor_negocio
ËË6 C
)
ËËC D
.
ËËD E
Include
ËËE L
(
ËËL M
t
ËËM N
=>
ËËO Q
t
ËËR S
.
ËËS T
Actor_negocio1
ËËT b
)
ËËb c
.
ËËc d
Include
ËËd k
(
ËËk l
t
ËËl m
=>
ËËn p
t
ËËq r
.
ËËr s
Actor_negocio2ËËs Å
)ËËÅ Ç
.
ÈÈ 
Include
ÈÈ 
(
ÈÈ 
t
ÈÈ 
=>
ÈÈ !
t
ÈÈ" #
.
ÈÈ# $
Actor_negocio
ÈÈ$ 1
.
ÈÈ1 2
Actor
ÈÈ2 7
.
ÈÈ7 8
Detalle_maestro
ÈÈ8 G
)
ÈÈG H
.
ÍÍ 
Include
ÍÍ 
(
ÍÍ 
t
ÍÍ 
=>
ÍÍ !
t
ÍÍ" #
.
ÍÍ# $
Actor_negocio1
ÍÍ$ 2
.
ÍÍ2 3
Actor
ÍÍ3 8
.
ÍÍ8 9
Detalle_maestro
ÍÍ9 H
)
ÍÍH I
.
ÎÎ 
Include
ÎÎ 
(
ÎÎ 
t
ÎÎ 
=>
ÎÎ !
t
ÎÎ" #
.
ÎÎ# $
Actor_negocio2
ÎÎ$ 2
.
ÎÎ2 3
Actor
ÎÎ3 8
.
ÎÎ8 9
Detalle_maestro
ÎÎ9 H
)
ÎÎH I
.
ÏÏ 
Include
ÏÏ 
(
ÏÏ 
t
ÏÏ 
=>
ÏÏ !
t
ÏÏ" #
.
ÏÏ# $
Detalle_maestro1
ÏÏ$ 4
)
ÏÏ4 5
.
ÏÏ5 6
Include
ÏÏ6 =
(
ÏÏ= >
t
ÏÏ> ?
=>
ÏÏ@ B
t
ÏÏC D
.
ÏÏD E 
Estado_transaccion
ÏÏE W
.
ÏÏW X
Select
ÏÏX ^
(
ÏÏ^ _
et
ÏÏ_ a
=>
ÏÏb d
et
ÏÏe g
.
ÏÏg h
Detalle_maestro
ÏÏh w
)
ÏÏw x
)
ÏÏx y
.
ÌÌ 
Include
ÌÌ 
(
ÌÌ 
t
ÌÌ 
=>
ÌÌ !
t
ÌÌ" #
.
ÌÌ# $
Comprobante
ÌÌ$ /
)
ÌÌ/ 0
.
ÌÌ0 1
Include
ÌÌ1 8
(
ÌÌ8 9
t
ÌÌ9 :
=>
ÌÌ; =
t
ÌÌ> ?
.
ÌÌ? @
Comprobante
ÌÌ@ K
.
ÌÌK L
Detalle_maestro
ÌÌL [
)
ÌÌ[ \
.
ÓÓ 
Where
ÓÓ 
(
ÓÓ 
t
ÓÓ 
=>
ÓÓ 
idsEntidadInterna
ÓÓ  1
.
ÓÓ1 2
Contains
ÓÓ2 :
(
ÓÓ: ;
t
ÓÓ; <
.
ÓÓ< =&
id_actor_negocio_interno
ÓÓ= U
)
ÓÓU V
&&
ÓÓW Y 
idsTipoTransaccion
ÓÓZ l
.
ÓÓl m
Contains
ÓÓm u
(
ÓÓu v
t
ÓÓv w
.
ÓÓw x"
id_tipo_transaccionÓÓx ã
)ÓÓã å
&&ÓÓç è
tÓÓê ë
.ÓÓë í
fecha_inicioÓÓí û
>=ÓÓü °

fechaDesdeÓÓ¢ ¨
&&ÓÓ≠ Ø
tÓÓ∞ ±
.ÓÓ± ≤
fecha_inicioÓÓ≤ æ
<=ÓÓø ¡

fechaHastaÓÓ¬ Ã
)ÓÓÃ Õ
;ÓÓÕ Œ
}
ÔÔ 
catch
 
(
 
	Exception
 
e
 
)
 
{
ÒÒ 
throw
ÚÚ 
new
ÚÚ 
DatosException
ÚÚ (
(
ÚÚ( )
$str
ÚÚ) I
,
ÚÚI J
e
ÚÚK L
)
ÚÚL M
;
ÚÚM N
}
ÛÛ 
}
ÙÙ 	
public
ıı 
IEnumerable
ıı 
<
ıı $
Entrada_Salida_Almacen
ıı 1
>
ıı1 2.
 ObtenerEntradasOSalidasDeAlmacen
ıı3 S
(
ııS T
bool
ııT X
	esEntrada
ııY b
,
ııb c
List
ııd h
<
ııh i
int
ııi l
>
ııl m!
idsCentrosAtencionıın Ä
,ııÄ Å
DateTimeııÇ ä

fechaDesdeııã ï
,ııï ñ
DateTimeııó ü

fechaHastaıı† ™
)ıı™ ´
{
ˆˆ 	
try
˜˜ 
{
¯¯ 
var
˘˘ 
movimientos
˘˘ 
=
˘˘  !
_db
˘˘" %
.
˘˘% &
Transaccion
˘˘& 1
.
˘˘1 2
Where
˙˙ 
(
˙˙ 
t
˙˙ 
=>
˙˙ 
t
˙˙  
.
˙˙  !
fecha_inicio
˙˙! -
>=
˙˙. 0

fechaDesde
˙˙1 ;
&&
˙˙< >
t
˙˙? @
.
˙˙@ A
fecha_inicio
˙˙A M
<=
˙˙N P

fechaHasta
˙˙Q [
&&
˙˙\ ^ 
idsCentrosAtencion
˙˙_ q
.
˙˙q r
Contains
˙˙r z
(
˙˙z {
t
˙˙{ |
.
˙˙| }'
id_actor_negocio_interno˙˙} ï
)˙˙ï ñ
&&˙˙ó ô
t˙˙ö õ
.˙˙õ ú 
Tipo_transaccion˙˙ú ¨
.˙˙¨ ≠6
&Accion_de_negocio_por_tipo_transaccion˙˙≠ ”
.˙˙” ‘
Any˙˙‘ ◊
(˙˙◊ ÿ
antt˙˙ÿ ‹
=>˙˙› ﬂ
antt˙˙‡ ‰
.˙˙‰ Â$
id_accion_de_negocio˙˙Â ˘
==˙˙˙ ¸#
TransaccionSettings˙˙˝ ê
.˙˙ê ë
Default˙˙ë ò
.˙˙ò ô4
$IdAccionDeNegocioMovimientoEnAlmacen˙˙ô Ω
&&˙˙æ ¿
antt˙˙¡ ≈
.˙˙≈ ∆
valor˙˙∆ À
==˙˙Ã Œ
	esEntrada˙˙œ ÿ
)˙˙ÿ Ÿ
&&˙˙⁄ ‹
t˙˙› ﬁ
.˙˙ﬁ ﬂ 
id_estado_actual˙˙ﬂ Ô
==˙˙ Ú
MaestroSettings˙˙Û Ç
.˙˙Ç É
Default˙˙É ä
.˙˙ä ã0
 IdDetalleMaestroEstadoConfirmado˙˙ã ´
)˙˙´ ¨
.˙˙¨ ≠
Select
˚˚ 
(
˚˚ 
t
˚˚ 
=>
˚˚ 
new
˚˚  #$
Entrada_Salida_Almacen
˚˚$ :
(
˚˚: ;
)
˚˚; <
{
¸¸ 
Id
˝˝ 
=
˝˝ 
t
˝˝ 
.
˝˝ 
id
˝˝ !
,
˝˝! "
FechaInicio
˛˛ #
=
˛˛$ %
t
˛˛& '
.
˛˛' (
fecha_inicio
˛˛( 4
,
˛˛4 5#
CodigoTipoComprobante
ˇˇ -
=
ˇˇ. /
t
ˇˇ0 1
.
ˇˇ1 2
Comprobante
ˇˇ2 =
.
ˇˇ= >
Detalle_maestro
ˇˇ> M
.
ˇˇM N
valor
ˇˇN S
,
ˇˇS T
TipoComprobante
ÄÄ '
=
ÄÄ( )
t
ÄÄ* +
.
ÄÄ+ ,
Comprobante
ÄÄ, 7
.
ÄÄ7 8
Detalle_maestro
ÄÄ8 G
.
ÄÄG H
nombre
ÄÄH N
,
ÄÄN O
SerieComprobante
ÅÅ (
=
ÅÅ) *
t
ÅÅ+ ,
.
ÅÅ, -
Comprobante
ÅÅ- 8
.
ÅÅ8 9
numero_serie
ÅÅ9 E
,
ÅÅE F
NumeroComprobante
ÇÇ )
=
ÇÇ* +
t
ÇÇ, -
.
ÇÇ- .
Comprobante
ÇÇ. 9
.
ÇÇ9 :
numero
ÇÇ: @
,
ÇÇ@ A
TipoDeOperacion
ÉÉ '
=
ÉÉ( )
t
ÉÉ* +
.
ÉÉ+ ,
Transaccion2
ÉÉ, 8
.
ÉÉ8 9
Tipo_transaccion
ÉÉ9 I
.
ÉÉI J
nombre
ÉÉJ P
,
ÉÉP Q)
CodigoTipoDocumentoEmpleado
ÑÑ 3
=
ÑÑ4 5
t
ÑÑ6 7
.
ÑÑ7 8
Actor_negocio
ÑÑ8 E
.
ÑÑE F
Actor
ÑÑF K
.
ÑÑK L
Detalle_maestro
ÑÑL [
.
ÑÑ[ \
valor
ÑÑ\ a
,
ÑÑa b%
NumeroDocumentoEmpleado
ÖÖ /
=
ÖÖ0 1
t
ÖÖ2 3
.
ÖÖ3 4
Actor_negocio
ÖÖ4 A
.
ÖÖA B
Actor
ÖÖB G
.
ÖÖG H(
numero_documento_identidad
ÖÖH b
,
ÖÖb c
Empleado
ÜÜ  
=
ÜÜ! "
t
ÜÜ# $
.
ÜÜ$ %
Actor_negocio
ÜÜ% 2
.
ÜÜ2 3
Actor
ÜÜ3 8
.
ÜÜ8 9
primer_nombre
ÜÜ9 F
.
ÜÜF G
Replace
ÜÜG N
(
ÜÜN O
$str
ÜÜO R
,
ÜÜR S
$str
ÜÜT W
)
ÜÜW X
,
ÜÜX Y/
!CodigoTipoDocumentoActorComercial
áá 9
=
áá: ;
t
áá< =
.
áá= >
Actor_negocio1
áá> L
.
ááL M
Actor
ááM R
.
ááR S
Detalle_maestro
ááS b
.
ááb c
valor
áác h
,
ááh i+
NumeroDocumentoActorComercial
àà 5
=
àà6 7
t
àà8 9
.
àà9 :
Actor_negocio1
àà: H
.
ààH I
Actor
ààI N
.
ààN O(
numero_documento_identidad
ààO i
,
àài j
ActorComercial
ââ &
=
ââ' (
t
ââ) *
.
ââ* +
Actor_negocio1
ââ+ 9
.
ââ9 :
Actor
ââ: ?
.
ââ? @
primer_nombre
ââ@ M
.
ââM N
Replace
ââN U
(
ââU V
$str
ââV Y
,
ââY Z
$str
ââ[ ^
)
ââ^ _
,
ââ_ `
	EsEntrada
ää !
=
ää" #
	esEntrada
ää$ -
,
ää- .
CentroDeAtencion
ãã (
=
ãã) *
t
ãã+ ,
.
ãã, -
Actor_negocio2
ãã- ;
.
ãã; <
Actor
ãã< A
.
ããA B
primer_nombre
ããB O
,
ããO P
Establecimiento
åå '
=
åå( )
t
åå* +
.
åå+ ,
Actor_negocio2
åå, :
.
åå: ;
Actor_negocio2
åå; I
.
ååI J
Actor
ååJ O
.
ååO P
tercer_nombre
ååP ]
}
çç 
)
çç 
.
çç 
OrderByDescending
çç (
(
çç( )
c
çç) *
=>
çç+ -
c
çç. /
.
çç/ 0
Id
çç0 2
)
çç2 3
;
çç3 4
return
éé 
movimientos
éé "
;
éé" #
}
èè 
catch
êê 
(
êê 
	Exception
êê 
e
êê 
)
êê 
{
ëë 
throw
íí 
new
íí 
DatosException
íí (
(
íí( )
$str
íí) Y
,
ííY Z
e
íí[ \
)
íí\ ]
;
íí] ^
}
ìì 
}
îî 	
public
ññ 
IEnumerable
ññ 
<
ññ $
Orden_Recibir_Entregar
ññ 1
>
ññ1 2;
-ObtenerOrdenesPorRecibirOPorEntregarDeAlmacen
ññ3 `
(
ññ` a
bool
ñña e

porRecibir
ññf p
,
ññp q
List
ññr v
<
ññv w
int
ññw z
>
ññz {!
idsCentrosAtencionññ| é
,ññé è
DateTimeññê ò

fechaDesdeññô £
,ññ£ §
DateTimeññ• ≠

fechaHastaññÆ ∏
)ññ∏ π
{
óó 	
try
òò 
{
ôô 
var
öö 
movimientos
öö 
=
öö  !
_db
öö" %
.
öö% &
Transaccion
öö& 1
.
öö1 2
Where
õõ 
(
õõ 
t
õõ 
=>
õõ 
t
õõ  
.
õõ  !
fecha_inicio
õõ! -
>=
õõ. 0

fechaDesde
õõ1 ;
&&
õõ< >
t
õõ? @
.
õõ@ A
fecha_inicio
õõA M
<=
õõN P

fechaHasta
õõQ [
&&
õõ\ ^ 
idsCentrosAtencion
õõ_ q
.
õõq r
Contains
õõr z
(
õõz {
t
õõ{ |
.
õõ| }'
id_actor_negocio_internoõõ} ï
)õõï ñ
&&õõó ô
tõõö õ
.õõõ ú
Transaccion2õõú ®
.õõ® © 
Tipo_transaccionõõ© π
.õõπ ∫6
&Accion_de_negocio_por_tipo_transaccionõõ∫ ‡
.õõ‡ ·
Anyõõ· ‰
(õõ‰ Â
anttõõÂ È
=>õõÍ Ï
anttõõÌ Ò
.õõÒ Ú$
id_accion_de_negocioõõÚ Ü
==õõá â#
TransaccionSettingsõõä ù
.õõù û
Defaultõõû •
.õõ• ¶4
$IdAccionDeNegocioCompromisoDeAlmacenõõ¶  
&&õõÀ Õ
anttõõŒ “
.õõ“ ”
valorõõ” ÿ
==õõŸ €

porRecibirõõ‹ Ê
)õõÊ Á
&&õõË Í
tõõÎ Ï
.õõÏ Ì
ComprobanteõõÌ ¯
.õõ¯ ˘#
id_tipo_comprobanteõõ˘ å
==õõç è
MaestroSettingsõõê ü
.õõü †
Defaultõõ† ß
.õõß ®9
)IdDetalleMaestroComprobanteOrdenDeAlmacenõõ® —
&&õõ“ ‘
(õõ’ ÷
tõõ÷ ◊
.õõ◊ ÿ%
Parametro_transaccionõõÿ Ì
.õõÌ Ó
FirstOrDefaultõõÓ ¸
(õõ¸ ˝
ttõõ˝ ˇ
=>õõÄ Ç
ttõõÉ Ö
.õõÖ Ü
id_parametroõõÜ í
==õõì ï
MaestroSettingsõõñ •
.õõ• ¶
Defaultõõ¶ ≠
.õõ≠ Æ@
0IdDetalleMaestroParametroEstadoEntregaMercaderiaõõÆ ﬁ
)õõﬁ ﬂ
.õõﬂ ‡
valorõõ‡ Â
==õõÊ Ë
(õõÈ Í
(õõÍ Î
intõõÎ Ó
)õõÓ Ô
IngresoTotalõõÔ ˚
.õõ˚ ¸
Noõõ¸ ˛
)õõ˛ ˇ
.õõˇ Ä
ToStringõõÄ à
(õõà â
)õõâ ä
)õõä ã
)õõã å
.õõå ç
Select
úú 
(
úú 
t
úú 
=>
úú 
new
úú  #$
Orden_Recibir_Entregar
úú$ :
(
úú: ;
)
úú; <
{
ùù 
Id
ûû 
=
ûû 
t
ûû 
.
ûû 
id
ûû !
,
ûû! "
FechaInicio
üü #
=
üü$ %
t
üü& '
.
üü' (
fecha_inicio
üü( 4
,
üü4 5#
CodigoTipoComprobante
†† -
=
††. /
t
††0 1
.
††1 2
Transaccion3
††2 >
.
††> ?
Comprobante
††? J
.
††J K
Detalle_maestro
††K Z
.
††Z [
valor
††[ `
,
††` a
TipoComprobante
°° '
=
°°( )
t
°°* +
.
°°+ ,
Transaccion3
°°, 8
.
°°8 9
Comprobante
°°9 D
.
°°D E
Detalle_maestro
°°E T
.
°°T U
nombre
°°U [
,
°°[ \
SerieComprobante
¢¢ (
=
¢¢) *
t
¢¢+ ,
.
¢¢, -
Transaccion3
¢¢- 9
.
¢¢9 :
Comprobante
¢¢: E
.
¢¢E F
numero_serie
¢¢F R
,
¢¢R S
NumeroComprobante
££ )
=
££* +
t
££, -
.
££- .
Transaccion3
££. :
.
££: ;
Comprobante
££; F
.
££F G
numero
££G M
,
££M N
TipoDeOperacion
§§ '
=
§§( )
t
§§* +
.
§§+ ,
Transaccion2
§§, 8
.
§§8 9
Tipo_transaccion
§§9 I
.
§§I J
nombre
§§J P
,
§§P Q#
SerieComprobanteOrden
•• -
=
••. /
t
••0 1
.
••1 2
Comprobante
••2 =
.
••= >
numero_serie
••> J
,
••J K$
NumeroComprobanteOrden
¶¶ .
=
¶¶/ 0
t
¶¶1 2
.
¶¶2 3
Comprobante
¶¶3 >
.
¶¶> ?
numero
¶¶? E
,
¶¶E F/
!CodigoTipoDocumentoActorComercial
ßß 9
=
ßß: ;
t
ßß< =
.
ßß= >
Actor_negocio1
ßß> L
.
ßßL M
Actor
ßßM R
.
ßßR S
Detalle_maestro
ßßS b
.
ßßb c
valor
ßßc h
,
ßßh i+
NumeroDocumentoActorComercial
®® 5
=
®®6 7
t
®®8 9
.
®®9 :
Actor_negocio1
®®: H
.
®®H I
Actor
®®I N
.
®®N O(
numero_documento_identidad
®®O i
,
®®i j
ActorComercial
©© &
=
©©' (
t
©©) *
.
©©* +
Actor_negocio1
©©+ 9
.
©©9 :
Actor
©©: ?
.
©©? @
primer_nombre
©©@ M
,
©©M N

PorRecibir
™™ "
=
™™# $

porRecibir
™™% /
,
™™/ 0
CentroDeAtencion
´´ (
=
´´) *
t
´´+ ,
.
´´, -
Actor_negocio2
´´- ;
.
´´; <
Actor
´´< A
.
´´A B
primer_nombre
´´B O
,
´´O P
Establecimiento
¨¨ '
=
¨¨( )
t
¨¨* +
.
¨¨+ ,
Actor_negocio2
¨¨, :
.
¨¨: ;
Actor_negocio2
¨¨; I
.
¨¨I J
Actor
¨¨J O
.
¨¨O P
primer_nombre
¨¨P ]
}
≠≠ 
)
≠≠ 
.
≠≠ 
OrderByDescending
≠≠ (
(
≠≠( )
c
≠≠) *
=>
≠≠+ -
c
≠≠. /
.
≠≠/ 0
Id
≠≠0 2
)
≠≠2 3
;
≠≠3 4
return
ÆÆ 
movimientos
ÆÆ "
;
ÆÆ" #
}
ØØ 
catch
∞∞ 
(
∞∞ 
	Exception
∞∞ 
e
∞∞ 
)
∞∞ 
{
±± 
throw
≤≤ 
new
≤≤ 
DatosException
≤≤ (
(
≤≤( )
$str
≤≤) i
,
≤≤i j
e
≤≤k l
)
≤≤l m
;
≤≤m n
}
≥≥ 
}
¥¥ 	
public
∂∂ 
IEnumerable
∂∂ 
<
∂∂ 
Transaccion
∂∂ &
>
∂∂& 'H
:ObtenerTransaccionesInclusiveActoresYDetalleMaestroYEstado
∂∂( b
(
∂∂b c
int
∂∂c f
idTipoTransaccion
∂∂g x
,
∂∂x y
int
∂∂z }
idUltimoEstado∂∂~ å
,∂∂å ç
int∂∂é ë
[∂∂ë í
]∂∂í ì!
idsEntidadInterna∂∂î •
,∂∂• ¶
DateTime∂∂ß Ø

fechaDesde∂∂∞ ∫
,∂∂∫ ª
DateTime∂∂º ƒ

fechaHasta∂∂≈ œ
)∂∂œ –
{
∑∑ 	
try
∏∏ 
{
ππ 
return
∫∫ 
_db
∫∫ 
.
∫∫ 
Transaccion
∫∫ &
.
∫∫& '
Include
∫∫' .
(
∫∫. /
t
∫∫/ 0
=>
∫∫1 3
t
∫∫4 5
.
∫∫5 6
Actor_negocio
∫∫6 C
)
∫∫C D
.
∫∫D E
Include
∫∫E L
(
∫∫L M
t
∫∫M N
=>
∫∫O Q
t
∫∫R S
.
∫∫S T
Actor_negocio1
∫∫T b
)
∫∫b c
.
∫∫c d
Include
∫∫d k
(
∫∫k l
t
∫∫l m
=>
∫∫n p
t
∫∫q r
.
∫∫r s
Actor_negocio2∫∫s Å
)∫∫Å Ç
.
ªª 
Include
ªª 
(
ªª 
t
ªª 
=>
ªª !
t
ªª" #
.
ªª# $
Actor_negocio
ªª$ 1
.
ªª1 2
Actor
ªª2 7
.
ªª7 8
Detalle_maestro
ªª8 G
)
ªªG H
.
ºº 
Include
ºº 
(
ºº 
t
ºº 
=>
ºº !
t
ºº" #
.
ºº# $
Actor_negocio1
ºº$ 2
.
ºº2 3
Actor
ºº3 8
.
ºº8 9
Detalle_maestro
ºº9 H
)
ººH I
.
ΩΩ 
Include
ΩΩ 
(
ΩΩ 
t
ΩΩ 
=>
ΩΩ !
t
ΩΩ" #
.
ΩΩ# $
Actor_negocio2
ΩΩ$ 2
.
ΩΩ2 3
Actor
ΩΩ3 8
.
ΩΩ8 9
Detalle_maestro
ΩΩ9 H
)
ΩΩH I
.
ææ 
Include
ææ 
(
ææ 
t
ææ 
=>
ææ !
t
ææ" #
.
ææ# $
Detalle_maestro1
ææ$ 4
)
ææ4 5
.
ææ5 6
Include
ææ6 =
(
ææ= >
t
ææ> ?
=>
ææ@ B
t
ææC D
.
ææD E 
Estado_transaccion
ææE W
.
ææW X
Select
ææX ^
(
ææ^ _
et
ææ_ a
=>
ææb d
et
ææe g
.
ææg h
Detalle_maestro
ææh w
)
ææw x
)
ææx y
.
øø 
Include
øø 
(
øø 
t
øø 
=>
øø !
t
øø" #
.
øø# $
Comprobante
øø$ /
)
øø/ 0
.
øø0 1
Include
øø1 8
(
øø8 9
t
øø9 :
=>
øø; =
t
øø> ?
.
øø? @
Comprobante
øø@ K
.
øøK L
Detalle_maestro
øøL [
)
øø[ \
.
¿¿ 
Where
¿¿ 
(
¿¿ 
t
¿¿ 
=>
¿¿ 
t
¿¿  !
.
¿¿! "
fecha_inicio
¿¿" .
>=
¿¿/ 1

fechaDesde
¿¿2 <
&&
¿¿= ?
t
¿¿@ A
.
¿¿A B
fecha_inicio
¿¿B N
<=
¿¿O Q

fechaHasta
¿¿R \
&&
¿¿] _
idsEntidadInterna
¿¿` q
.
¿¿q r
Contains
¿¿r z
(
¿¿z {
t
¿¿{ |
.
¿¿| }'
id_actor_negocio_interno¿¿} ï
)¿¿ï ñ
&&¿¿ó ô
t¿¿ö õ
.¿¿õ ú#
id_tipo_transaccion¿¿ú Ø
==¿¿∞ ≤!
idTipoTransaccion¿¿≥ ƒ
&&¿¿≈ «
t¿¿» …
.¿¿…   
id_estado_actual¿¿  ⁄
==¿¿€ ›
idUltimoEstado¿¿ﬁ Ï
)¿¿Ï Ì
;¿¿Ì Ó
}
¡¡ 
catch
¬¬ 
(
¬¬ 
	Exception
¬¬ 
e
¬¬ 
)
¬¬ 
{
√√ 
throw
ƒƒ 
new
ƒƒ 
DatosException
ƒƒ (
(
ƒƒ( )
$str
ƒƒ) I
,
ƒƒI J
e
ƒƒK L
)
ƒƒL M
;
ƒƒM N
}
≈≈ 
}
∆∆ 	
public
»» 
IEnumerable
»» 
<
»» 
Transaccion
»» &
>
»»& 'H
:ObtenerTransaccionesInclusiveActoresYDetalleMaestroYEstado
»»( b
(
»»b c
int
»»c f
idTipoTransaccion
»»g x
,
»»x y
int
»»z }
[
»»} ~
]
»»~ !
idsEntidadInterna»»Ä ë
,»»ë í
DateTime»»ì õ

fechaDesde»»ú ¶
,»»¶ ß
int»»® ´
idUltimoEstado»»¨ ∫
,»»∫ ª
DateTime»»º ƒ

fechaHasta»»≈ œ
)»»œ –
{
…… 	
try
   
{
ÀÀ 
return
ÃÃ 
_db
ÃÃ 
.
ÃÃ 
Transaccion
ÃÃ &
.
ÕÕ 
Include
ÕÕ 
(
ÕÕ 
t
ÕÕ 
=>
ÕÕ !
t
ÕÕ" #
.
ÕÕ# $
Actor_negocio
ÕÕ$ 1
)
ÕÕ1 2
.
ŒŒ 
Include
ŒŒ 
(
ŒŒ 
t
ŒŒ 
=>
ŒŒ !
t
ŒŒ" #
.
ŒŒ# $
Actor_negocio1
ŒŒ$ 2
)
ŒŒ2 3
.
œœ 
Include
œœ 
(
œœ 
t
œœ 
=>
œœ !
t
œœ" #
.
œœ# $
Actor_negocio2
œœ$ 2
)
œœ2 3
.
““ 
Include
““ 
(
““ 
t
““ 
=>
““ !
t
““" #
.
““# $
Actor_negocio2
““$ 2
.
““2 3
Actor
““3 8
)
““8 9
.
’’ 
Include
’’ 
(
’’ 
t
’’ 
=>
’’ !
t
’’" #
.
’’# $!
Detalle_transaccion
’’$ 7
)
’’7 8
.
÷÷ 
Include
÷÷ 
(
÷÷ 
t
÷÷ 
=>
÷÷ !
t
÷÷" #
.
÷÷# $!
Detalle_transaccion
÷÷$ 7
.
÷÷7 8
Select
÷÷8 >
(
÷÷> ?
dt
÷÷? A
=>
÷÷B D
dt
÷÷E G
.
÷÷G H
Concepto_negocio
÷÷H X
)
÷÷X Y
)
÷÷Y Z
.
◊◊ 
Include
◊◊ 
(
◊◊ 
t
◊◊ 
=>
◊◊ !
t
◊◊" #
.
◊◊# $!
Detalle_transaccion
◊◊$ 7
.
◊◊7 8
Select
◊◊8 >
(
◊◊> ?
dt
◊◊? A
=>
◊◊B D
dt
◊◊E G
.
◊◊G H
Concepto_negocio
◊◊H X
.
◊◊X Y
Detalle_maestro4
◊◊Y i
)
◊◊i j
)
◊◊j k
.
ÿÿ 
Include
ÿÿ 
(
ÿÿ 
t
ÿÿ 
=>
ÿÿ !
t
ÿÿ" #
.
ÿÿ# $
Detalle_maestro1
ÿÿ$ 4
)
ÿÿ4 5
.
ŸŸ 
Include
ŸŸ 
(
ŸŸ 
t
ŸŸ 
=>
ŸŸ !
t
ŸŸ" #
.
ŸŸ# $ 
Estado_transaccion
ŸŸ$ 6
)
ŸŸ6 7
.
⁄⁄ 
Include
⁄⁄ 
(
⁄⁄ 
t
⁄⁄ 
=>
⁄⁄ !
t
⁄⁄" #
.
⁄⁄# $ 
Estado_transaccion
⁄⁄$ 6
.
⁄⁄6 7
Select
⁄⁄7 =
(
⁄⁄= >
et
⁄⁄> @
=>
⁄⁄A C
et
⁄⁄D F
.
⁄⁄F G
Detalle_maestro
⁄⁄G V
)
⁄⁄V W
)
⁄⁄W X
.
€€ 
Include
€€ 
(
€€ 
t
€€ 
=>
€€ !
t
€€" #
.
€€# $
Comprobante
€€$ /
)
€€/ 0
.
€€0 1
Include
€€1 8
(
€€8 9
t
€€9 :
=>
€€; =
t
€€> ?
.
€€? @
Comprobante
€€@ K
.
€€K L
Detalle_maestro
€€L [
)
€€[ \
.
‹‹ 
Where
‹‹ 
(
‹‹ 
t
‹‹ 
=>
‹‹ 
t
‹‹  !
.
‹‹! "
fecha_inicio
‹‹" .
>=
‹‹/ 1

fechaDesde
‹‹2 <
&&
‹‹= ?
t
‹‹@ A
.
‹‹A B
fecha_inicio
‹‹B N
<=
‹‹O Q

fechaHasta
‹‹R \
&&
‹‹] _
idsEntidadInterna
‹‹` q
.
‹‹q r
Contains
‹‹r z
(
‹‹z {
t
‹‹{ |
.
‹‹| }'
id_actor_negocio_interno‹‹} ï
)‹‹ï ñ
&&‹‹ó ô
t‹‹ö õ
.‹‹õ ú#
id_tipo_transaccion‹‹ú Ø
==‹‹∞ ≤!
idTipoTransaccion‹‹≥ ƒ
&&‹‹≈ «
t‹‹» …
.‹‹…   
id_estado_actual‹‹  ⁄
==‹‹€ ›
idUltimoEstado‹‹ﬁ Ï
)‹‹Ï Ì
;‹‹Ì Ó
}
›› 
catch
ﬂﬂ 
(
ﬂﬂ 
	Exception
ﬂﬂ 
e
ﬂﬂ 
)
ﬂﬂ 
{
‡‡ 
throw
·· 
new
·· 
DatosException
·· (
(
··( )
$str
··) I
,
··I J
e
··K L
)
··L M
;
··M N
}
‚‚ 
}
„„ 	
public
ÊÊ 
IEnumerable
ÊÊ 
<
ÊÊ 
Transaccion
ÊÊ &
>
ÊÊ& 'H
:ObtenerTransaccionesInclusiveActoresYDetalleMaestroYEstado
ÊÊ( b
(
ÊÊb c
int
ÊÊc f
idTipoTransaccion
ÊÊg x
,
ÊÊx y
int
ÊÊz }
idUltimoEstadoÊÊ~ å
,ÊÊå ç
intÊÊé ë 
idEntidadInternaÊÊí ¢
,ÊÊ¢ £
DateTimeÊÊ§ ¨

fechaDesdeÊÊ≠ ∑
,ÊÊ∑ ∏
DateTimeÊÊπ ¡

fechaHastaÊÊ¬ Ã
)ÊÊÃ Õ
{
ÁÁ 	
try
ËË 
{
ÈÈ 
return
ÍÍ 
_db
ÍÍ 
.
ÍÍ 
Transaccion
ÍÍ &
.
ÍÍ& '
Include
ÍÍ' .
(
ÍÍ. /
t
ÍÍ/ 0
=>
ÍÍ1 3
t
ÍÍ4 5
.
ÍÍ5 6
Actor_negocio
ÍÍ6 C
)
ÍÍC D
.
ÍÍD E
Include
ÍÍE L
(
ÍÍL M
t
ÍÍM N
=>
ÍÍO Q
t
ÍÍR S
.
ÍÍS T
Actor_negocio1
ÍÍT b
)
ÍÍb c
.
ÍÍc d
Include
ÍÍd k
(
ÍÍk l
t
ÍÍl m
=>
ÍÍn p
t
ÍÍq r
.
ÍÍr s
Actor_negocio2ÍÍs Å
)ÍÍÅ Ç
.
ÎÎ 
Include
ÎÎ 
(
ÎÎ 
t
ÎÎ 
=>
ÎÎ !
t
ÎÎ" #
.
ÎÎ# $
Actor_negocio
ÎÎ$ 1
.
ÎÎ1 2
Actor
ÎÎ2 7
.
ÎÎ7 8
Detalle_maestro
ÎÎ8 G
)
ÎÎG H
.
ÏÏ 
Include
ÏÏ 
(
ÏÏ 
t
ÏÏ 
=>
ÏÏ !
t
ÏÏ" #
.
ÏÏ# $
Actor_negocio1
ÏÏ$ 2
.
ÏÏ2 3
Actor
ÏÏ3 8
.
ÏÏ8 9
Detalle_maestro
ÏÏ9 H
)
ÏÏH I
.
ÌÌ 
Include
ÌÌ 
(
ÌÌ 
t
ÌÌ 
=>
ÌÌ !
t
ÌÌ" #
.
ÌÌ# $
Actor_negocio2
ÌÌ$ 2
.
ÌÌ2 3
Actor
ÌÌ3 8
.
ÌÌ8 9
Detalle_maestro
ÌÌ9 H
)
ÌÌH I
.
ÓÓ 
Include
ÓÓ 
(
ÓÓ 
t
ÓÓ 
=>
ÓÓ !
t
ÓÓ" #
.
ÓÓ# $
Detalle_maestro1
ÓÓ$ 4
)
ÓÓ4 5
.
ÓÓ5 6
Include
ÓÓ6 =
(
ÓÓ= >
t
ÓÓ> ?
=>
ÓÓ@ B
t
ÓÓC D
.
ÓÓD E 
Estado_transaccion
ÓÓE W
.
ÓÓW X
Select
ÓÓX ^
(
ÓÓ^ _
et
ÓÓ_ a
=>
ÓÓb d
et
ÓÓe g
.
ÓÓg h
Detalle_maestro
ÓÓh w
)
ÓÓw x
)
ÓÓx y
.
ÔÔ 
Include
ÔÔ 
(
ÔÔ 
t
ÔÔ 
=>
ÔÔ !
t
ÔÔ" #
.
ÔÔ# $
Comprobante
ÔÔ$ /
)
ÔÔ/ 0
.
ÔÔ0 1
Include
ÔÔ1 8
(
ÔÔ8 9
t
ÔÔ9 :
=>
ÔÔ; =
t
ÔÔ> ?
.
ÔÔ? @
Comprobante
ÔÔ@ K
.
ÔÔK L
Detalle_maestro
ÔÔL [
)
ÔÔ[ \
.
 
Where
 
(
 
t
 
=>
 
t
  !
.
! "
fecha_inicio
" .
>=
/ 1

fechaDesde
2 <
&&
= ?
t
@ A
.
A B
fecha_inicio
B N
<=
O Q

fechaHasta
R \
&&
] _
t
` a
.
a b&
id_actor_negocio_interno
b z
==
{ }
idEntidadInterna~ é
&&è ë
tí ì
.ì î#
id_tipo_transaccionî ß
==® ™!
idTipoTransaccion´ º
&&Ω ø
t¿ ¡
.¡ ¬ 
id_estado_actual¬ “
==” ’
idUltimoEstado÷ ‰
)‰ Â
;Â Ê
}
ÒÒ 
catch
ÚÚ 
(
ÚÚ 
	Exception
ÚÚ 
e
ÚÚ 
)
ÚÚ 
{
ÛÛ 
throw
ÙÙ 
e
ÙÙ 
;
ÙÙ 
throw
ÙÙ 
new
ÙÙ "
DatosException
ÙÙ# 1
(
ÙÙ1 2
$str
ÙÙ2 R
,
ÙÙR S
e
ÙÙT U
)
ÙÙU V
;
ÙÙV W
}
ıı 
}
ˆˆ 	
public
¯¯ 
IEnumerable
¯¯ 
<
¯¯ 
Transaccion
¯¯ &
>
¯¯& 'H
:ObtenerTransaccionesInclusiveActoresYDetalleMaestroYEstado
¯¯( b
(
¯¯b c
int
¯¯c f
idTipoTransaccion
¯¯g x
,
¯¯x y
int
¯¯z }
[
¯¯} ~
]
¯¯~ 

idsEstados¯¯Ä ä
,¯¯ä ã
int¯¯å è 
idEntidadInterna¯¯ê †
,¯¯† °
DateTime¯¯¢ ™

fechaDesde¯¯´ µ
,¯¯µ ∂
DateTime¯¯∑ ø

fechaHasta¯¯¿  
)¯¯  À
{
˘˘ 	
try
˙˙ 
{
˚˚ 
return
¸¸ 
_db
¸¸ 
.
¸¸ 
Transaccion
¸¸ &
.
¸¸& '
Include
¸¸' .
(
¸¸. /
t
¸¸/ 0
=>
¸¸1 3
t
¸¸4 5
.
¸¸5 6
Actor_negocio
¸¸6 C
)
¸¸C D
.
¸¸D E
Include
¸¸E L
(
¸¸L M
t
¸¸M N
=>
¸¸O Q
t
¸¸R S
.
¸¸S T
Actor_negocio1
¸¸T b
)
¸¸b c
.
¸¸c d
Include
¸¸d k
(
¸¸k l
t
¸¸l m
=>
¸¸n p
t
¸¸q r
.
¸¸r s
Actor_negocio2¸¸s Å
)¸¸Å Ç
.
˝˝ 
Include
˝˝ 
(
˝˝ 
t
˝˝ 
=>
˝˝ !
t
˝˝" #
.
˝˝# $
Actor_negocio
˝˝$ 1
.
˝˝1 2
Actor
˝˝2 7
.
˝˝7 8
Detalle_maestro
˝˝8 G
)
˝˝G H
.
˛˛ 
Include
˛˛ 
(
˛˛ 
t
˛˛ 
=>
˛˛ !
t
˛˛" #
.
˛˛# $
Actor_negocio1
˛˛$ 2
.
˛˛2 3
Actor
˛˛3 8
.
˛˛8 9
Detalle_maestro
˛˛9 H
)
˛˛H I
.
ˇˇ 
Include
ˇˇ 
(
ˇˇ 
t
ˇˇ 
=>
ˇˇ !
t
ˇˇ" #
.
ˇˇ# $
Actor_negocio2
ˇˇ$ 2
.
ˇˇ2 3
Actor
ˇˇ3 8
.
ˇˇ8 9
Detalle_maestro
ˇˇ9 H
)
ˇˇH I
.
ÄÄ 
Include
ÄÄ 
(
ÄÄ 
t
ÄÄ 
=>
ÄÄ !
t
ÄÄ" #
.
ÄÄ# $
Detalle_maestro1
ÄÄ$ 4
)
ÄÄ4 5
.
ÄÄ5 6
Include
ÄÄ6 =
(
ÄÄ= >
t
ÄÄ> ?
=>
ÄÄ@ B
t
ÄÄC D
.
ÄÄD E 
Estado_transaccion
ÄÄE W
.
ÄÄW X
Select
ÄÄX ^
(
ÄÄ^ _
et
ÄÄ_ a
=>
ÄÄb d
et
ÄÄe g
.
ÄÄg h
Detalle_maestro
ÄÄh w
)
ÄÄw x
)
ÄÄx y
.
ÅÅ 
Include
ÅÅ 
(
ÅÅ 
t
ÅÅ 
=>
ÅÅ !
t
ÅÅ" #
.
ÅÅ# $
Comprobante
ÅÅ$ /
)
ÅÅ/ 0
.
ÅÅ0 1
Include
ÅÅ1 8
(
ÅÅ8 9
t
ÅÅ9 :
=>
ÅÅ; =
t
ÅÅ> ?
.
ÅÅ? @
Comprobante
ÅÅ@ K
.
ÅÅK L
Detalle_maestro
ÅÅL [
)
ÅÅ[ \
.
ÇÇ 
Where
ÇÇ 
(
ÇÇ 
t
ÇÇ 
=>
ÇÇ 
t
ÇÇ  !
.
ÇÇ! "
fecha_inicio
ÇÇ" .
>=
ÇÇ/ 1

fechaDesde
ÇÇ2 <
&&
ÇÇ= ?
t
ÇÇ@ A
.
ÇÇA B
fecha_inicio
ÇÇB N
<=
ÇÇO Q

fechaHasta
ÇÇR \
&&
ÇÇ] _
t
ÇÇ` a
.
ÇÇa b&
id_actor_negocio_interno
ÇÇb z
==
ÇÇ{ }
idEntidadInternaÇÇ~ é
&&ÇÇè ë
tÇÇí ì
.ÇÇì î#
id_tipo_transaccionÇÇî ß
==ÇÇ® ™!
idTipoTransaccionÇÇ´ º
&&ÇÇΩ ø

idsEstadosÇÇ¿  
.ÇÇ  À
ContainsÇÇÀ ”
(ÇÇ” ‘
(ÇÇ‘ ’
intÇÇ’ ÿ
)ÇÇÿ Ÿ
tÇÇŸ ⁄
.ÇÇ⁄ € 
id_estado_actualÇÇ€ Î
)ÇÇÎ Ï
)ÇÇÏ Ì
;ÇÇÌ Ó
}
ÉÉ 
catch
ÑÑ 
(
ÑÑ 
	Exception
ÑÑ 
e
ÑÑ 
)
ÑÑ 
{
ÖÖ 
throw
ÜÜ 
new
ÜÜ 
DatosException
ÜÜ (
(
ÜÜ( )
$str
ÜÜ) I
,
ÜÜI J
e
ÜÜK L
)
ÜÜL M
;
ÜÜM N
}
áá 
}
àà 	
public
ãã 
Transaccion
ãã F
8ObtenerTransaccionInclusiveActoresYDetalleMaestroYEstado
ãã S
(
ããS T
long
ããT X
id
ããY [
)
ãã[ \
{
åå 	
try
çç 
{
éé 
return
èè 
_db
èè 
.
èè 
Transaccion
èè &
.
èè& '
Include
êê 
(
êê 
sbt
êê 
=>
êê  "
sbt
êê# &
.
êê& '!
Detalle_transaccion
êê' :
)
êê: ;
.
êê; <
Include
ëë 
(
ëë 
sbt
ëë 
=>
ëë  "
sbt
ëë# &
.
ëë& '
Comprobante
ëë' 2
)
ëë2 3
.
ëë3 4
Include
íí 
(
íí 
sbt
íí 
=>
íí  "
sbt
íí# &
.
íí& '
Comprobante
íí' 2
.
íí2 3
Detalle_maestro
íí3 B
)
ííB C
.
ííC D
Include
ìì 
(
ìì 
sbt
ìì 
=>
ìì  "
sbt
ìì# &
.
ìì& '#
Parametro_transaccion
ìì' <
)
ìì< =
.
ìì= >
Include
îî 
(
îî 
sbt
îî 
=>
îî  "
sbt
îî# &
.
îî& '
Actor_negocio
îî' 4
)
îî4 5
.
îî5 6
Include
ïï 
(
ïï 
sbt
ïï 
=>
ïï  "
sbt
ïï# &
.
ïï& '
Actor_negocio1
ïï' 5
)
ïï5 6
.
ïï6 7
Include
ññ 
(
ññ 
sbt
ññ 
=>
ññ  "
sbt
ññ# &
.
ññ& '
Actor_negocio2
ññ' 5
)
ññ5 6
.
ññ6 7
SingleOrDefault
óó #
(
óó# $
t
óó$ %
=>
óó& (
t
óó) *
.
óó* +
id
óó+ -
==
óó. 0
id
óó1 3
)
óó3 4
;
óó4 5
}
òò 
catch
ôô 
(
ôô 
	Exception
ôô 
e
ôô 
)
ôô 
{
öö 
throw
õõ 
new
õõ 
DatosException
õõ (
(
õõ( )
$str
õõ) I
,
õõI J
e
õõK L
)
õõL M
;
õõM N
}
úú 
}
ùù 	
public
££ 
Transaccion
££ L
>ObtenerTransaccionConCuotasInclusiveTransaccion2ConComprobante
££ Y
(
££Y Z
long
££Z ^
id
££_ a
)
££a b
{
§§ 	
try
•• 
{
¶¶ 
return
ßß 
_db
ßß 
.
ßß 
Transaccion
ßß &
.
ßß& '
Include
®® 
(
®® 
sbt
®® 
=>
®®  "
sbt
®®# &
.
®®& '
Cuota
®®' ,
)
®®, -
.
®®- .
Include
©© 
(
©© 
sbt
©© 
=>
©©  "
sbt
©©# &
.
©©& '
Transaccion2
©©' 3
)
©©3 4
.
©©4 5
Include
™™ 
(
™™ 
sbt
™™ 
=>
™™  "
sbt
™™# &
.
™™& '
Transaccion2
™™' 3
.
™™3 4
Comprobante
™™4 ?
)
™™? @
.
™™@ A
SingleOrDefault
´´ #
(
´´# $
t
´´$ %
=>
´´& (
t
´´) *
.
´´* +
id
´´+ -
==
´´. 0
id
´´1 3
)
´´3 4
;
´´4 5
}
¨¨ 
catch
≠≠ 
(
≠≠ 
	Exception
≠≠ 
e
≠≠ 
)
≠≠ 
{
ÆÆ 
throw
ØØ 
new
ØØ 
DatosException
ØØ (
(
ØØ( )
$str
ØØ) I
,
ØØI J
e
ØØK L
)
ØØL M
;
ØØM N
}
∞∞ 
}
±± 	
public
∏∏ 
Transaccion
∏∏ E
7ObtenerTransaccionInclusiveActorDeNegocio1Transaccion11
∏∏ R
(
∏∏R S
long
∏∏S W
idTransaccion
∏∏X e
)
∏∏e f
{
ππ 	
try
∫∫ 
{
ªª 
return
ºº 
_db
ºº 
.
ºº 
Transaccion
ºº &
.
ºº& '
Include
ΩΩ 
(
ΩΩ 
t
ΩΩ 
=>
ΩΩ  
t
ΩΩ! "
.
ΩΩ" #
Actor_negocio1
ΩΩ# 1
)
ΩΩ1 2
.
ΩΩ2 3
Include
ææ 
(
ææ 
t
ææ 
=>
ææ  
t
ææ! "
.
ææ" #
Actor_negocio1
ææ# 1
.
ææ1 2
Actor
ææ2 7
)
ææ7 8
.
ææ8 9
Include
øø 
(
øø 
t
øø 
=>
øø  
t
øø! "
.
øø" #
Actor_negocio1
øø# 1
.
øø1 2
Actor
øø2 7
.
øø7 8
Detalle_maestro
øø8 G
)
øøG H
.
øøH I
Include
¿¿ 
(
¿¿ 
t
¿¿ 
=>
¿¿  
t
¿¿! "
.
¿¿" #
Actor_negocio1
¿¿# 1
.
¿¿1 2
Actor
¿¿2 7
.
¿¿7 8
	Direccion
¿¿8 A
)
¿¿A B
.
¿¿B C
Include
¡¡ 
(
¡¡ 
t
¡¡ 
=>
¡¡  
t
¡¡! "
.
¡¡" #
Actor_negocio1
¡¡# 1
.
¡¡1 2
Rol
¡¡2 5
)
¡¡5 6
.
¡¡6 7
Include
¬¬ 
(
¬¬ 
t
¬¬ 
=>
¬¬  
t
¬¬! "
.
¬¬" #
Transaccion11
¬¬# 0
)
¬¬0 1
.
¬¬1 2
Include
√√ 
(
√√ 
t
√√ 
=>
√√  
t
√√! "
.
√√" #
Transaccion11
√√# 0
.
√√0 1
Select
√√1 7
(
√√7 8
t11
√√8 ;
=>
√√< >
t11
√√? B
.
√√B C!
Detalle_transaccion
√√C V
)
√√V W
)
√√W X
.
√√X Y
SingleOrDefault
ƒƒ #
(
ƒƒ# $
t
ƒƒ$ %
=>
ƒƒ& (
t
ƒƒ) *
.
ƒƒ* +
id
ƒƒ+ -
==
ƒƒ. 0
idTransaccion
ƒƒ1 >
)
ƒƒ> ?
;
ƒƒ? @
}
≈≈ 
catch
∆∆ 
(
∆∆ 
	Exception
∆∆ 
e
∆∆ 
)
∆∆ 
{
«« 
throw
»» 
new
»» 
DatosException
»» (
(
»»( )
$str
»») I
,
»»I J
e
»»K L
)
»»L M
;
»»M N
}
…… 
}
   	
public
““ 
Transaccion
““ Y
KObtenerTransaccionInclusiveActoresYDetalleMaestroYEstadoYDetalleTransaccion
““ f
(
““f g
long
““g k 
idTransaccionPadre
““l ~
,
““~ 
long““Ä Ñ!
idTipoTransaccion““Ö ñ
)““ñ ó
{
”” 	
try
‘‘ 
{
’’ 
return
÷÷ 
_db
÷÷ 
.
÷÷ 
Transaccion
÷÷ &
.
÷÷& '
Include
◊◊ 
(
◊◊ 
sbt
◊◊ 
=>
◊◊  "
sbt
◊◊# &
.
◊◊& '!
Detalle_transaccion
◊◊' :
)
◊◊: ;
.
◊◊; <
Include
ÿÿ 
(
ÿÿ 
sbt
ÿÿ 
=>
ÿÿ  "
sbt
ÿÿ# &
.
ÿÿ& '
Detalle_maestro1
ÿÿ' 7
)
ÿÿ7 8
.
ÿÿ8 9
Include
ŸŸ 
(
ŸŸ 
sbt
ŸŸ 
=>
ŸŸ  "
sbt
ŸŸ# &
.
ŸŸ& '
Comprobante
ŸŸ' 2
)
ŸŸ2 3
.
ŸŸ3 4
Include
⁄⁄ 
(
⁄⁄ 
sbt
⁄⁄ 
=>
⁄⁄  "
sbt
⁄⁄# &
.
⁄⁄& '#
Parametro_transaccion
⁄⁄' <
)
⁄⁄< =
.
⁄⁄= >
Include
€€ 
(
€€ 
sbt
€€ 
=>
€€  "
sbt
€€# &
.
€€& '
Actor_negocio
€€' 4
)
€€4 5
.
€€5 6
Include
‹‹ 
(
‹‹ 
sbt
‹‹ 
=>
‹‹  "
sbt
‹‹# &
.
‹‹& '
Actor_negocio1
‹‹' 5
)
‹‹5 6
.
‹‹6 7
Include
›› 
(
›› 
sbt
›› 
=>
››  "
sbt
››# &
.
››& '
Actor_negocio1
››' 5
.
››5 6
Actor
››6 ;
.
››; <
	Direccion
››< E
)
››E F
.
››F G
Include
ﬁﬁ 
(
ﬁﬁ 
sbt
ﬁﬁ 
=>
ﬁﬁ  "
sbt
ﬁﬁ# &
.
ﬁﬁ& '
Actor_negocio2
ﬁﬁ' 5
)
ﬁﬁ5 6
.
ﬁﬁ6 7
SingleOrDefault
ﬂﬂ #
(
ﬂﬂ# $
t
ﬂﬂ$ %
=>
ﬂﬂ& (
t
ﬂﬂ) *
.
ﬂﬂ* +"
id_transaccion_padre
ﬂﬂ+ ?
==
ﬂﬂ@ B 
idTransaccionPadre
ﬂﬂC U
&&
ﬂﬂV X
t
ﬂﬂY Z
.
ﬂﬂZ [!
id_tipo_transaccion
ﬂﬂ[ n
==
ﬂﬂo q 
idTipoTransaccionﬂﬂr É
)ﬂﬂÉ Ñ
;ﬂﬂÑ Ö
}
‡‡ 
catch
·· 
(
·· 
	Exception
·· 
e
·· 
)
·· 
{
‚‚ 
throw
„„ 
new
„„ 
DatosException
„„ (
(
„„( )
$str
„„) I
,
„„I J
e
„„K L
)
„„L M
;
„„M N
}
‰‰ 
}
ÂÂ 	
public
ÁÁ 
Transaccion
ÁÁ Y
KObtenerTransaccionInclusiveActoresYDetalleMaestroYEstadoYDetalleTransaccion
ÁÁ f
(
ÁÁf g
long
ÁÁg k
idTransaccion
ÁÁl y
)
ÁÁy z
{
ËË 	
try
ÈÈ 
{
ÍÍ 
var
ÎÎ 
transaccion
ÎÎ 
=
ÎÎ  !
_db
ÏÏ 
.
ÏÏ 
Transaccion
ÏÏ 
.
ÏÏ  
Include
ÌÌ 
(
ÌÌ 
sbt
ÌÌ 
=>
ÌÌ  "
sbt
ÌÌ# &
.
ÌÌ& '!
Detalle_transaccion
ÌÌ' :
)
ÌÌ: ;
.
ÌÌ; <
Include
ÓÓ 
(
ÓÓ 
sbt
ÓÓ 
=>
ÓÓ  "
sbt
ÓÓ# &
.
ÓÓ& '!
Detalle_transaccion
ÓÓ' :
.
ÓÓ: ;
Select
ÓÓ; A
(
ÓÓA B
dt
ÓÓB D
=>
ÓÓE G
dt
ÓÓH J
.
ÓÓJ K
Concepto_negocio
ÓÓK [
)
ÓÓ[ \
)
ÓÓ\ ]
.
ÓÓ] ^
Include
ÔÔ 
(
ÔÔ 
sbt
ÔÔ 
=>
ÔÔ  "
sbt
ÔÔ# &
.
ÔÔ& '!
Detalle_transaccion
ÔÔ' :
.
ÔÔ: ;
Select
ÔÔ; A
(
ÔÔA B
dt
ÔÔB D
=>
ÔÔE G
dt
ÔÔH J
.
ÔÔJ K
Concepto_negocio
ÔÔK [
.
ÔÔ[ \
Detalle_maestro4
ÔÔ\ l
)
ÔÔl m
)
ÔÔm n
.
ÔÔn o
Include
 
(
 
sbt
 
=>
  "
sbt
# &
.
& '!
Detalle_transaccion
' :
.
: ;
Select
; A
(
A B
dt
B D
=>
E G
dt
H J
.
J K
Concepto_negocio
K [
.
[ \4
%Valor_caracteristica_concepto_negocio\ Å
.Å Ç
SelectÇ à
(à â
vccnâ ç
=>é ê
vccnë ï
.ï ñ$
Valor_caracteristicañ ™
.™ ´
Detalle_maestro´ ∫
)∫ ª
)ª º
)º Ω
.Ω æ
Include
ÒÒ 
(
ÒÒ 
sbt
ÒÒ 
=>
ÒÒ  "
sbt
ÒÒ# &
.
ÒÒ& '
Detalle_maestro1
ÒÒ' 7
)
ÒÒ7 8
.
ÒÒ8 9
Include
ÚÚ 
(
ÚÚ 
sbt
ÚÚ 
=>
ÚÚ  "
sbt
ÚÚ# &
.
ÚÚ& '
Comprobante
ÚÚ' 2
)
ÚÚ2 3
.
ÚÚ3 4
Include
ÛÛ 
(
ÛÛ 
sbt
ÛÛ 
=>
ÛÛ  "
sbt
ÛÛ# &
.
ÛÛ& '
Comprobante
ÛÛ' 2
.
ÛÛ2 3
Detalle_maestro
ÛÛ3 B
)
ÛÛB C
.
ÛÛC D
Include
ÙÙ 
(
ÙÙ 
sbt
ÙÙ 
=>
ÙÙ  "
sbt
ÙÙ# &
.
ÙÙ& '#
Parametro_transaccion
ÙÙ' <
)
ÙÙ< =
.
ÙÙ= >
Include
ıı 
(
ıı 
sbt
ıı 
=>
ıı  "
sbt
ıı# &
.
ıı& '
Actor_negocio
ıı' 4
)
ıı4 5
.
ıı5 6
Include
ˆˆ 
(
ˆˆ 
sbt
ˆˆ 
=>
ˆˆ  "
sbt
ˆˆ# &
.
ˆˆ& '
Actor_negocio
ˆˆ' 4
.
ˆˆ4 5
Actor
ˆˆ5 :
)
ˆˆ: ;
.
ˆˆ; <
Include
˜˜ 
(
˜˜ 
sbt
˜˜ 
=>
˜˜  "
sbt
˜˜# &
.
˜˜& '
Actor_negocio1
˜˜' 5
)
˜˜5 6
.
˜˜6 7
Include
¯¯ 
(
¯¯ 
sbt
¯¯ 
=>
¯¯  "
sbt
¯¯# &
.
¯¯& '
Actor_negocio1
¯¯' 5
.
¯¯5 6
Actor
¯¯6 ;
)
¯¯; <
.
¯¯< =
Include
˘˘ 
(
˘˘ 
sbt
˘˘ 
=>
˘˘  "
sbt
˘˘# &
.
˘˘& '
Actor_negocio1
˘˘' 5
.
˘˘5 6
Actor
˘˘6 ;
.
˘˘; <
	Direccion
˘˘< E
)
˘˘E F
.
˘˘F G
Include
˙˙ 
(
˙˙ 
sbt
˙˙ 
=>
˙˙  "
sbt
˙˙# &
.
˙˙& '
Actor_negocio1
˙˙' 5
.
˙˙5 6
Actor
˙˙6 ;
.
˙˙; <
Detalle_maestro
˙˙< K
)
˙˙K L
.
˙˙L M
Include
˚˚ 
(
˚˚ 
sbt
˚˚ 
=>
˚˚  "
sbt
˚˚# &
.
˚˚& '
Actor_negocio1
˚˚' 5
.
˚˚5 6
Actor
˚˚6 ;
.
˚˚; <
	Direccion
˚˚< E
.
˚˚E F
Select
˚˚F L
(
˚˚L M
d
˚˚M N
=>
˚˚O Q
d
˚˚R S
.
˚˚S T
Ubigeo
˚˚T Z
)
˚˚Z [
)
˚˚[ \
.
˚˚\ ]
Include
¸¸ 
(
¸¸ 
sbt
¸¸ 
=>
¸¸  "
sbt
¸¸# &
.
¸¸& '
Actor_negocio2
¸¸' 5
)
¸¸5 6
.
¸¸6 7
Include
˝˝ 
(
˝˝ 
sbt
˝˝ 
=>
˝˝  "
sbt
˝˝# &
.
˝˝& '
Actor_negocio2
˝˝' 5
.
˝˝5 6
Actor
˝˝6 ;
)
˝˝; <
.
˝˝< =
Include
˛˛ 
(
˛˛ 
sbt
˛˛ 
=>
˛˛  "
sbt
˛˛# &
.
˛˛& '
Actor_negocio2
˛˛' 5
.
˛˛5 6
Actor_negocio2
˛˛6 D
)
˛˛D E
.
˛˛E F
Include
ˇˇ 
(
ˇˇ 
sbt
ˇˇ 
=>
ˇˇ  "
sbt
ˇˇ# &
.
ˇˇ& '
Actor_negocio2
ˇˇ' 5
.
ˇˇ5 6
Actor_negocio2
ˇˇ6 D
.
ˇˇD E
Actor
ˇˇE J
)
ˇˇJ K
.
ˇˇK L
Include
ÄÄ 
(
ÄÄ 
sbt
ÄÄ 
=>
ÄÄ  "
sbt
ÄÄ# &
.
ÄÄ& '
Actor_negocio2
ÄÄ' 5
.
ÄÄ5 6
Actor_negocio2
ÄÄ6 D
.
ÄÄD E
Actor
ÄÄE J
.
ÄÄJ K
	Direccion
ÄÄK T
)
ÄÄT U
.
ÄÄU V
Include
ÅÅ 
(
ÅÅ 
sbt
ÅÅ 
=>
ÅÅ  "
sbt
ÅÅ# &
.
ÅÅ& '
Actor_negocio2
ÅÅ' 5
.
ÅÅ5 6
Actor_negocio2
ÅÅ6 D
.
ÅÅD E
Actor
ÅÅE J
.
ÅÅJ K
	Direccion
ÅÅK T
.
ÅÅT U
Select
ÅÅU [
(
ÅÅ[ \
d
ÅÅ\ ]
=>
ÅÅ^ `
d
ÅÅa b
.
ÅÅb c
Ubigeo
ÅÅc i
)
ÅÅi j
)
ÅÅj k
.
ÅÅk l
Include
ÇÇ 
(
ÇÇ 
sbt
ÇÇ 
=>
ÇÇ  "
sbt
ÇÇ# &
.
ÇÇ& ' 
Estado_transaccion
ÇÇ' 9
)
ÇÇ9 :
.
ÇÇ: ;
Include
ÉÉ 
(
ÉÉ 
sbt
ÉÉ 
=>
ÉÉ  "
sbt
ÉÉ# &
.
ÉÉ& ' 
Estado_transaccion
ÉÉ' 9
.
ÉÉ9 :
Select
ÉÉ: @
(
ÉÉ@ A
et
ÉÉA C
=>
ÉÉD F
et
ÉÉG I
.
ÉÉI J
Detalle_maestro
ÉÉJ Y
)
ÉÉY Z
)
ÉÉZ [
.
ÉÉ[ \
SingleOrDefault
ÑÑ #
(
ÑÑ# $
t
ÑÑ$ %
=>
ÑÑ& (
t
ÑÑ) *
.
ÑÑ* +
id
ÑÑ+ -
==
ÑÑ. 0
idTransaccion
ÑÑ1 >
)
ÑÑ> ?
;
ÑÑ? @
return
ÖÖ 
transaccion
ÖÖ "
;
ÖÖ" #
}
ÜÜ 
catch
áá 
(
áá 
	Exception
áá 
e
áá 
)
áá 
{
àà 
throw
ââ 
new
ââ 
DatosException
ââ (
(
ââ( )
$str
ââ) I
,
ââI J
e
ââK L
)
ââL M
;
ââM N
}
ää 
}
ãã 	
public
çç 
Transaccion
çç l
^ObtenerTransaccionInclusiveActoresYDetalleMaestroYEstadoYDetalleTransaccionConsultaComprobante
çç y
(
ççy z+
ConsultaComprobanteParameterççz ñ#
consultaComprobanteççó ™
)çç™ ´
{
éé 	
try
èè 
{
êê 
var
ëë  
IdsTipoTransaccion
ëë &
=
ëë' (
Diccionario
ëë) 4
.
ëë4 5<
.TiposDeTransaccionOrdenesDeOperacionesDeVentas
ëë5 c
;
ëëc d
var
íí 
numeroComprobante
íí %
=
íí& '
int
íí( +
.
íí+ ,
Parse
íí, 1
(
íí1 2!
consultaComprobante
íí2 E
.
ííE F
Numero
ííF L
)
ííL M
;
ííM N
var
ìì 
transaccion
ìì 
=
ìì  !
_db
îî 
.
îî 
Transaccion
îî 
.
îî  
Include
ïï 
(
ïï 
sbt
ïï 
=>
ïï 
sbt
ïï "
.
ïï" #!
Detalle_transaccion
ïï# 6
)
ïï6 7
.
ïï7 8
Include
ññ 
(
ññ 
sbt
ññ 
=>
ññ 
sbt
ññ "
.
ññ" #!
Detalle_transaccion
ññ# 6
.
ññ6 7
Select
ññ7 =
(
ññ= >
dt
ññ> @
=>
ññA C
dt
ññD F
.
ññF G
Concepto_negocio
ññG W
)
ññW X
)
ññX Y
.
ññY Z
Include
óó 
(
óó 
sbt
óó 
=>
óó 
sbt
óó "
.
óó" #!
Detalle_transaccion
óó# 6
.
óó6 7
Select
óó7 =
(
óó= >
dt
óó> @
=>
óóA C
dt
óóD F
.
óóF G
Concepto_negocio
óóG W
.
óóW X
Detalle_maestro4
óóX h
)
óóh i
)
óói j
.
óój k
Include
òò 
(
òò 
sbt
òò 
=>
òò 
sbt
òò "
.
òò" #!
Detalle_transaccion
òò# 6
.
òò6 7
Select
òò7 =
(
òò= >
dt
òò> @
=>
òòA C
dt
òòD F
.
òòF G
Concepto_negocio
òòG W
.
òòW X3
%Valor_caracteristica_concepto_negocio
òòX }
.
òò} ~
Selectòò~ Ñ
(òòÑ Ö
vccnòòÖ â
=>òòä å
vccnòòç ë
.òòë í$
Valor_caracteristicaòòí ¶
.òò¶ ß
Detalle_maestroòòß ∂
)òò∂ ∑
)òò∑ ∏
)òò∏ π
.òòπ ∫
Include
ôô 
(
ôô 
sbt
ôô 
=>
ôô 
sbt
ôô "
.
ôô" #
Detalle_maestro1
ôô# 3
)
ôô3 4
.
ôô4 5
Include
öö 
(
öö 
sbt
öö 
=>
öö 
sbt
öö "
.
öö" #
Comprobante
öö# .
)
öö. /
.
öö/ 0
Include
õõ 
(
õõ 
sbt
õõ 
=>
õõ 
sbt
õõ "
.
õõ" #
Comprobante
õõ# .
.
õõ. /
Detalle_maestro
õõ/ >
)
õõ> ?
.
õõ? @
Include
úú 
(
úú 
sbt
úú 
=>
úú 
sbt
úú "
.
úú" ##
Parametro_transaccion
úú# 8
)
úú8 9
.
úú9 :
Include
ùù 
(
ùù 
sbt
ùù 
=>
ùù 
sbt
ùù "
.
ùù" #
Actor_negocio
ùù# 0
)
ùù0 1
.
ùù1 2
Include
ûû 
(
ûû 
sbt
ûû 
=>
ûû 
sbt
ûû "
.
ûû" #
Actor_negocio
ûû# 0
.
ûû0 1
Actor
ûû1 6
)
ûû6 7
.
ûû7 8
Include
üü 
(
üü 
sbt
üü 
=>
üü 
sbt
üü "
.
üü" #
Actor_negocio1
üü# 1
)
üü1 2
.
üü2 3
Include
†† 
(
†† 
sbt
†† 
=>
†† 
sbt
†† "
.
††" #
Actor_negocio1
††# 1
.
††1 2
Actor
††2 7
)
††7 8
.
††8 9
Include
°° 
(
°° 
sbt
°° 
=>
°° 
sbt
°° "
.
°°" #
Actor_negocio1
°°# 1
.
°°1 2
Actor
°°2 7
.
°°7 8
	Direccion
°°8 A
)
°°A B
.
°°B C
Include
¢¢ 
(
¢¢ 
sbt
¢¢ 
=>
¢¢ 
sbt
¢¢ "
.
¢¢" #
Actor_negocio1
¢¢# 1
.
¢¢1 2
Actor
¢¢2 7
.
¢¢7 8
Detalle_maestro
¢¢8 G
)
¢¢G H
.
¢¢H I
Include
££ 
(
££ 
sbt
££ 
=>
££ 
sbt
££ "
.
££" #
Actor_negocio1
££# 1
.
££1 2
Actor
££2 7
.
££7 8
	Direccion
££8 A
.
££A B
Select
££B H
(
££H I
d
££I J
=>
££K M
d
££N O
.
££O P
Ubigeo
££P V
)
££V W
)
££W X
.
££X Y
Include
§§ 
(
§§ 
sbt
§§ 
=>
§§ 
sbt
§§ "
.
§§" #
Actor_negocio2
§§# 1
)
§§1 2
.
§§2 3
Include
•• 
(
•• 
sbt
•• 
=>
•• 
sbt
•• "
.
••" #
Actor_negocio2
••# 1
.
••1 2
Actor
••2 7
)
••7 8
.
••8 9
Include
¶¶ 
(
¶¶ 
sbt
¶¶ 
=>
¶¶ 
sbt
¶¶ "
.
¶¶" #
Actor_negocio2
¶¶# 1
.
¶¶1 2
Actor_negocio2
¶¶2 @
)
¶¶@ A
.
¶¶A B
Include
ßß 
(
ßß 
sbt
ßß 
=>
ßß 
sbt
ßß "
.
ßß" #
Actor_negocio2
ßß# 1
.
ßß1 2
Actor_negocio2
ßß2 @
.
ßß@ A
Actor
ßßA F
)
ßßF G
.
ßßG H
Include
®® 
(
®® 
sbt
®® 
=>
®® 
sbt
®® "
.
®®" #
Actor_negocio2
®®# 1
.
®®1 2
Actor_negocio2
®®2 @
.
®®@ A
Actor
®®A F
.
®®F G
	Direccion
®®G P
)
®®P Q
.
®®Q R
Include
©© 
(
©© 
sbt
©© 
=>
©© 
sbt
©© "
.
©©" #
Actor_negocio2
©©# 1
.
©©1 2
Actor_negocio2
©©2 @
.
©©@ A
Actor
©©A F
.
©©F G
	Direccion
©©G P
.
©©P Q
Select
©©Q W
(
©©W X
d
©©X Y
=>
©©Z \
d
©©] ^
.
©©^ _
Ubigeo
©©_ e
)
©©e f
)
©©f g
.
©©g h
Include
™™ 
(
™™ 
sbt
™™ 
=>
™™ 
sbt
™™ "
.
™™" # 
Estado_transaccion
™™# 5
)
™™5 6
.
™™6 7
Include
´´ 
(
´´ 
sbt
´´ 
=>
´´ 
sbt
´´ "
.
´´" # 
Estado_transaccion
´´# 5
.
´´5 6
Select
´´6 <
(
´´< =
et
´´= ?
=>
´´@ B
et
´´C E
.
´´E F
Detalle_maestro
´´F U
)
´´U V
)
´´V W
.
´´W X
SingleOrDefault
¨¨ 
(
¨¨  
t
¨¨  !
=>
¨¨" $ 
IdsTipoTransaccion
¨¨% 7
.
¨¨7 8
Contains
¨¨8 @
(
¨¨@ A
t
¨¨A B
.
¨¨B C!
id_tipo_transaccion
¨¨C V
)
¨¨V W
&&
¨¨X Z
t
¨¨[ \
.
¨¨\ ]
id_estado_actual
¨¨] m
==
¨¨n p
MaestroSettings¨¨q Ä
.¨¨Ä Å
Default¨¨Å à
.¨¨à â0
 IdDetalleMaestroEstadoConfirmado¨¨â ©
&&¨¨™ ¨
t¨¨≠ Æ
.¨¨Æ Ø
Comprobante¨¨Ø ∫
.¨¨∫ ª
Detalle_maestro¨¨ª  
.¨¨  À
codigo¨¨À —
==¨¨“ ‘#
consultaComprobante¨¨’ Ë
.¨¨Ë È
Comprobante¨¨È Ù
&&¨¨ı ˜
t
≠≠ 
.
≠≠ 
Comprobante
≠≠ 
.
≠≠ 
Serie_comprobante
≠≠ /
.
≠≠/ 0
numero
≠≠0 6
==
≠≠7 9!
consultaComprobante
≠≠: M
.
≠≠M N
Serie
≠≠N S
&&
≠≠T V
t
≠≠W X
.
≠≠X Y
Comprobante
≠≠Y d
.
≠≠d e
numero
≠≠e k
==
≠≠l n 
numeroComprobante≠≠o Ä
&&≠≠Å É
(
ÆÆ 
t
ÆÆ 
.
ÆÆ 
fecha_inicio
ÆÆ 
.
ÆÆ  
Year
ÆÆ  $
==
ÆÆ% '!
consultaComprobante
ÆÆ( ;
.
ÆÆ; <
FechaEmision
ÆÆ< H
.
ÆÆH I
Year
ÆÆI M
&&
ÆÆN P
t
ØØ 
.
ØØ 
fecha_inicio
ØØ 
.
ØØ 
Month
ØØ $
==
ØØ% '!
consultaComprobante
ØØ( ;
.
ØØ; <
FechaEmision
ØØ< H
.
ØØH I
Month
ØØI N
&&
ØØO Q
t
∞∞ 
.
∞∞ 
fecha_inicio
∞∞ 
.
∞∞ 
Day
∞∞ "
==
∞∞# %!
consultaComprobante
∞∞& 9
.
∞∞9 :
FechaEmision
∞∞: F
.
∞∞F G
Day
∞∞G J
)
∞∞J K
&&
∞∞L N
Math
±± 
.
±± 
Round
±± 
(
±± 
t
±± 
.
±± 
importe_total
±± *
,
±±* +
$num
±±, -
)
±±- .
==
±±/ 1!
consultaComprobante
±±2 E
.
±±E F
Importe
±±F M
)
≤≤ 
;
≤≤ 
return
≥≥ 
transaccion
≥≥ "
;
≥≥" #
}
¥¥ 
catch
µµ 
(
µµ 
	Exception
µµ 
e
µµ 
)
µµ 
{
∂∂ 
throw
∑∑ 
new
∑∑ 
DatosException
∑∑ (
(
∑∑( )
$str
∑∑) I
,
∑∑I J
e
∑∑K L
)
∑∑L M
;
∑∑M N
}
∏∏ 
}
ππ 	
public
ªª 
List
ªª 
<
ªª 
Transaccion
ªª 
>
ªª  g
YObtenerTransaccionesSegunOrigen_InclusiveActoresYDetalleMaestroYEstadoYDetalleTransaccion
ªª! z
(
ªªz {
long
ªª{ #
idTransaccionOrigenªªÄ ì
,ªªì î
intªªï ò!
idTipoTransaccionªªô ™
)ªª™ ´
{
ºº 	
try
ΩΩ 
{
ææ 
var
øø 
transacciones
øø !
=
øø" #
_db
¿¿ 
.
¿¿ 
Transaccion
¿¿ 
.
¿¿  
Include
¡¡ 
(
¡¡ 
sbt
¡¡ 
=>
¡¡  "
sbt
¡¡# &
.
¡¡& '!
Detalle_transaccion
¡¡' :
)
¡¡: ;
.
¡¡; <
Include
¬¬ 
(
¬¬ 
sbt
¬¬ 
=>
¬¬  "
sbt
¬¬# &
.
¬¬& '!
Detalle_transaccion
¬¬' :
.
¬¬: ;
Select
¬¬; A
(
¬¬A B
dt
¬¬B D
=>
¬¬E G
dt
¬¬H J
.
¬¬J K
Concepto_negocio
¬¬K [
)
¬¬[ \
)
¬¬\ ]
.
¬¬] ^
Include
√√ 
(
√√ 
sbt
√√ 
=>
√√  "
sbt
√√# &
.
√√& '!
Detalle_transaccion
√√' :
.
√√: ;
Select
√√; A
(
√√A B
dt
√√B D
=>
√√E G
dt
√√H J
.
√√J K
Concepto_negocio
√√K [
.
√√[ \
Detalle_maestro4
√√\ l
)
√√l m
)
√√m n
.
√√n o
Include
ƒƒ 
(
ƒƒ 
sbt
ƒƒ 
=>
ƒƒ  "
sbt
ƒƒ# &
.
ƒƒ& '!
Detalle_transaccion
ƒƒ' :
.
ƒƒ: ;
Select
ƒƒ; A
(
ƒƒA B
dt
ƒƒB D
=>
ƒƒE G
dt
ƒƒH J
.
ƒƒJ K
Concepto_negocio
ƒƒK [
.
ƒƒ[ \4
%Valor_caracteristica_concepto_negocioƒƒ\ Å
.ƒƒÅ Ç
SelectƒƒÇ à
(ƒƒà â
vccnƒƒâ ç
=>ƒƒé ê
vccnƒƒë ï
.ƒƒï ñ$
Valor_caracteristicaƒƒñ ™
.ƒƒ™ ´
Detalle_maestroƒƒ´ ∫
)ƒƒ∫ ª
)ƒƒª º
)ƒƒº Ω
.ƒƒΩ æ
Include
≈≈ 
(
≈≈ 
sbt
≈≈ 
=>
≈≈  "
sbt
≈≈# &
.
≈≈& '
Detalle_maestro1
≈≈' 7
)
≈≈7 8
.
≈≈8 9
Include
∆∆ 
(
∆∆ 
sbt
∆∆ 
=>
∆∆  "
sbt
∆∆# &
.
∆∆& '
Comprobante
∆∆' 2
)
∆∆2 3
.
∆∆3 4
Include
«« 
(
«« 
sbt
«« 
=>
««  "
sbt
««# &
.
««& '
Comprobante
««' 2
.
««2 3
Detalle_maestro
««3 B
)
««B C
.
««C D
Include
»» 
(
»» 
sbt
»» 
=>
»»  "
sbt
»»# &
.
»»& '#
Parametro_transaccion
»»' <
)
»»< =
.
»»= >
Include
…… 
(
…… 
sbt
…… 
=>
……  "
sbt
……# &
.
……& '
Actor_negocio
……' 4
)
……4 5
.
……5 6
Include
   
(
   
sbt
   
=>
    "
sbt
  # &
.
  & '
Actor_negocio
  ' 4
.
  4 5
Actor
  5 :
)
  : ;
.
  ; <
Include
ÀÀ 
(
ÀÀ 
sbt
ÀÀ 
=>
ÀÀ  "
sbt
ÀÀ# &
.
ÀÀ& '
Actor_negocio1
ÀÀ' 5
)
ÀÀ5 6
.
ÀÀ6 7
Include
ÃÃ 
(
ÃÃ 
sbt
ÃÃ 
=>
ÃÃ  "
sbt
ÃÃ# &
.
ÃÃ& '
Actor_negocio1
ÃÃ' 5
.
ÃÃ5 6
Actor
ÃÃ6 ;
)
ÃÃ; <
.
ÃÃ< =
Include
ÕÕ 
(
ÕÕ 
sbt
ÕÕ 
=>
ÕÕ  "
sbt
ÕÕ# &
.
ÕÕ& '
Actor_negocio1
ÕÕ' 5
.
ÕÕ5 6
Actor
ÕÕ6 ;
.
ÕÕ; <
	Direccion
ÕÕ< E
)
ÕÕE F
.
ÕÕF G
Include
ŒŒ 
(
ŒŒ 
sbt
ŒŒ 
=>
ŒŒ  "
sbt
ŒŒ# &
.
ŒŒ& '
Actor_negocio1
ŒŒ' 5
.
ŒŒ5 6
Actor
ŒŒ6 ;
.
ŒŒ; <
Detalle_maestro
ŒŒ< K
)
ŒŒK L
.
ŒŒL M
Include
œœ 
(
œœ 
sbt
œœ 
=>
œœ  "
sbt
œœ# &
.
œœ& '
Actor_negocio1
œœ' 5
.
œœ5 6
Actor
œœ6 ;
.
œœ; <
	Direccion
œœ< E
.
œœE F
Select
œœF L
(
œœL M
d
œœM N
=>
œœO Q
d
œœR S
.
œœS T
Ubigeo
œœT Z
)
œœZ [
)
œœ[ \
.
œœ\ ]
Include
–– 
(
–– 
sbt
–– 
=>
––  "
sbt
––# &
.
––& '
Actor_negocio2
––' 5
)
––5 6
.
––6 7
Include
—— 
(
—— 
sbt
—— 
=>
——  "
sbt
——# &
.
——& '
Actor_negocio2
——' 5
.
——5 6
Actor
——6 ;
)
——; <
.
——< =
Include
““ 
(
““ 
sbt
““ 
=>
““  "
sbt
““# &
.
““& '
Actor_negocio2
““' 5
.
““5 6
Actor_negocio2
““6 D
)
““D E
.
““E F
Include
”” 
(
”” 
sbt
”” 
=>
””  "
sbt
””# &
.
””& '
Actor_negocio2
””' 5
.
””5 6
Actor_negocio2
””6 D
.
””D E
Actor
””E J
)
””J K
.
””K L
Include
‘‘ 
(
‘‘ 
sbt
‘‘ 
=>
‘‘  "
sbt
‘‘# &
.
‘‘& '
Actor_negocio2
‘‘' 5
.
‘‘5 6
Actor_negocio2
‘‘6 D
.
‘‘D E
Actor
‘‘E J
.
‘‘J K
	Direccion
‘‘K T
)
‘‘T U
.
‘‘U V
Include
’’ 
(
’’ 
sbt
’’ 
=>
’’  "
sbt
’’# &
.
’’& '
Actor_negocio2
’’' 5
.
’’5 6
Actor_negocio2
’’6 D
.
’’D E
Actor
’’E J
.
’’J K
	Direccion
’’K T
.
’’T U
Select
’’U [
(
’’[ \
d
’’\ ]
=>
’’^ `
d
’’a b
.
’’b c
Ubigeo
’’c i
)
’’i j
)
’’j k
.
’’k l
Include
÷÷ 
(
÷÷ 
sbt
÷÷ 
=>
÷÷  "
sbt
÷÷# &
.
÷÷& ' 
Estado_transaccion
÷÷' 9
)
÷÷9 :
.
÷÷: ;
Include
◊◊ 
(
◊◊ 
sbt
◊◊ 
=>
◊◊  "
sbt
◊◊# &
.
◊◊& ' 
Estado_transaccion
◊◊' 9
.
◊◊9 :
Select
◊◊: @
(
◊◊@ A
et
◊◊A C
=>
◊◊D F
et
◊◊G I
.
◊◊I J
Detalle_maestro
◊◊J Y
)
◊◊Y Z
)
◊◊Z [
.
◊◊[ \
Where
ÿÿ 
(
ÿÿ 
t
ÿÿ 
=>
ÿÿ 
t
ÿÿ  
.
ÿÿ  !'
id_transaccion_referencia
ÿÿ! :
==
ÿÿ; =!
idTransaccionOrigen
ÿÿ> Q
&&
ÿÿR T
t
ÿÿU V
.
ÿÿV W!
id_tipo_transaccion
ÿÿW j
==
ÿÿk m
idTipoTransaccion
ÿÿn 
)ÿÿ Ä
;ÿÿÄ Å
return
ŸŸ 
transacciones
ŸŸ $
.
ŸŸ$ %
ToList
ŸŸ% +
(
ŸŸ+ ,
)
ŸŸ, -
;
ŸŸ- .
}
⁄⁄ 
catch
€€ 
(
€€ 
	Exception
€€ 
e
€€ 
)
€€ 
{
‹‹ 
throw
›› 
new
›› 
DatosException
›› (
(
››( )
$str
››) I
,
››I J
e
››K L
)
››L M
;
››M N
}
ﬁﬁ 
}
ﬂﬂ 	
public
‡‡ 
IEnumerable
‡‡ 
<
‡‡ 
Transaccion
‡‡ &
>
‡‡& '[
MObtenerTransaccionesInclusiveActoresYDetalleMaestroYEstadoYDetalleTransaccion
‡‡( u
(
‡‡u v
long
‡‡v z!
idTransaccionPadre‡‡{ ç
,‡‡ç é
int‡‡è í!
idTipoTransaccion‡‡ì §
)‡‡§ •
{
·· 	
try
‚‚ 
{
„„ 
return
‰‰ 
_db
‰‰ 
.
‰‰ 
Transaccion
‰‰ &
.
‰‰& '
Include
ÂÂ 
(
ÂÂ 
sbt
ÂÂ 
=>
ÂÂ  "
sbt
ÂÂ# &
.
ÂÂ& '!
Detalle_transaccion
ÂÂ' :
)
ÂÂ: ;
.
ÂÂ; <
Include
ÊÊ 
(
ÊÊ 
sbt
ÊÊ 
=>
ÊÊ  "
sbt
ÊÊ# &
.
ÊÊ& '!
Detalle_transaccion
ÊÊ' :
.
ÊÊ: ;
Select
ÊÊ; A
(
ÊÊA B
dt
ÊÊB D
=>
ÊÊE G
dt
ÊÊH J
.
ÊÊJ K
Concepto_negocio
ÊÊK [
)
ÊÊ[ \
)
ÊÊ\ ]
.
ÊÊ] ^
Include
ÁÁ 
(
ÁÁ 
sbt
ÁÁ 
=>
ÁÁ  "
sbt
ÁÁ# &
.
ÁÁ& '!
Detalle_transaccion
ÁÁ' :
.
ÁÁ: ;
Select
ÁÁ; A
(
ÁÁA B
dt
ÁÁB D
=>
ÁÁE G
dt
ÁÁH J
.
ÁÁJ K
Concepto_negocio
ÁÁK [
.
ÁÁ[ \
Detalle_maestro4
ÁÁ\ l
)
ÁÁl m
)
ÁÁm n
.
ÁÁn o
Include
ËË 
(
ËË 
sbt
ËË 
=>
ËË  "
sbt
ËË# &
.
ËË& '!
Detalle_transaccion
ËË' :
.
ËË: ;
Select
ËË; A
(
ËËA B
dt
ËËB D
=>
ËËE G
dt
ËËH J
.
ËËJ K
Concepto_negocio
ËËK [
.
ËË[ \4
%Valor_caracteristica_concepto_negocioËË\ Å
.ËËÅ Ç
SelectËËÇ à
(ËËà â
vccnËËâ ç
=>ËËé ê
vccnËËë ï
.ËËï ñ$
Valor_caracteristicaËËñ ™
.ËË™ ´
Detalle_maestroËË´ ∫
)ËË∫ ª
)ËËª º
)ËËº Ω
.ËËΩ æ
Include
ÈÈ 
(
ÈÈ 
sbt
ÈÈ 
=>
ÈÈ  "
sbt
ÈÈ# &
.
ÈÈ& '
Detalle_maestro1
ÈÈ' 7
)
ÈÈ7 8
.
ÈÈ8 9
Include
ÍÍ 
(
ÍÍ 
sbt
ÍÍ 
=>
ÍÍ  "
sbt
ÍÍ# &
.
ÍÍ& '
Comprobante
ÍÍ' 2
)
ÍÍ2 3
.
ÍÍ3 4
Include
ÎÎ 
(
ÎÎ 
sbt
ÎÎ 
=>
ÎÎ  "
sbt
ÎÎ# &
.
ÎÎ& '
Comprobante
ÎÎ' 2
.
ÎÎ2 3
Detalle_maestro
ÎÎ3 B
)
ÎÎB C
.
ÎÎC D
Include
ÏÏ 
(
ÏÏ 
sbt
ÏÏ 
=>
ÏÏ  "
sbt
ÏÏ# &
.
ÏÏ& '#
Parametro_transaccion
ÏÏ' <
)
ÏÏ< =
.
ÏÏ= >
Include
ÌÌ 
(
ÌÌ 
sbt
ÌÌ 
=>
ÌÌ  "
sbt
ÌÌ# &
.
ÌÌ& '
Actor_negocio
ÌÌ' 4
)
ÌÌ4 5
.
ÌÌ5 6
Include
ÓÓ 
(
ÓÓ 
sbt
ÓÓ 
=>
ÓÓ  "
sbt
ÓÓ# &
.
ÓÓ& '
Actor_negocio1
ÓÓ' 5
)
ÓÓ5 6
.
ÓÓ6 7
Include
ÔÔ 
(
ÔÔ 
sbt
ÔÔ 
=>
ÔÔ  "
sbt
ÔÔ# &
.
ÔÔ& '
Actor_negocio1
ÔÔ' 5
.
ÔÔ5 6
Actor
ÔÔ6 ;
.
ÔÔ; <
	Direccion
ÔÔ< E
)
ÔÔE F
.
ÔÔF G
Include
 
(
 
sbt
 
=>
  "
sbt
# &
.
& '
Actor_negocio1
' 5
.
5 6
Actor
6 ;
.
; <
Detalle_maestro
< K
)
K L
.
L M
Include
ÒÒ 
(
ÒÒ 
sbt
ÒÒ 
=>
ÒÒ  "
sbt
ÒÒ# &
.
ÒÒ& '
Actor_negocio1
ÒÒ' 5
.
ÒÒ5 6
Actor
ÒÒ6 ;
.
ÒÒ; <
	Direccion
ÒÒ< E
.
ÒÒE F
Select
ÒÒF L
(
ÒÒL M
d
ÒÒM N
=>
ÒÒO Q
d
ÒÒR S
.
ÒÒS T
Ubigeo
ÒÒT Z
)
ÒÒZ [
)
ÒÒ[ \
.
ÒÒ\ ]
Include
ÚÚ 
(
ÚÚ 
sbt
ÚÚ 
=>
ÚÚ  "
sbt
ÚÚ# &
.
ÚÚ& '
Actor_negocio2
ÚÚ' 5
)
ÚÚ5 6
.
ÚÚ6 7
Include
ÛÛ 
(
ÛÛ 
sbt
ÛÛ 
=>
ÛÛ  "
sbt
ÛÛ# &
.
ÛÛ& ' 
Estado_transaccion
ÛÛ' 9
)
ÛÛ9 :
.
ÛÛ: ;
Include
ÙÙ 
(
ÙÙ 
sbt
ÙÙ 
=>
ÙÙ  "
sbt
ÙÙ# &
.
ÙÙ& ' 
Estado_transaccion
ÙÙ' 9
.
ÙÙ9 :
Select
ÙÙ: @
(
ÙÙ@ A
et
ÙÙA C
=>
ÙÙD F
et
ÙÙG I
.
ÙÙI J
Detalle_maestro
ÙÙJ Y
)
ÙÙY Z
)
ÙÙZ [
.
ÙÙ[ \
Where
ıı 
(
ıı 
t
ıı 
=>
ıı 
t
ıı  
.
ıı  !!
id_tipo_transaccion
ıı! 4
==
ıı5 7
idTipoTransaccion
ıı8 I
&&
ııJ L
t
ııM N
.
ııN O
Transaccion2
ııO [
.
ıı[ \
id
ıı\ ^
==
ıı_ a 
idTransaccionPadre
ııb t
)
ııt u
;
ııu v
}
ˆˆ 
catch
˜˜ 
(
˜˜ 
	Exception
˜˜ 
e
˜˜ 
)
˜˜ 
{
¯¯ 
throw
˘˘ 
new
˘˘ 
DatosException
˘˘ (
(
˘˘( )
$str
˘˘) I
,
˘˘I J
e
˘˘K L
)
˘˘L M
;
˘˘M N
}
˙˙ 
}
˚˚ 	
public
˝˝ 
int
˝˝ &
ObtenerMaximoCodigoCuota
˝˝ +
(
˝˝+ ,
string
˝˝, 2
	empiezaEn
˝˝3 <
)
˝˝< =
{
˛˛ 	
int
ˇˇ 
longitud
ˇˇ 
=
ˇˇ 
	empiezaEn
ˇˇ $
.
ˇˇ$ %
Length
ˇˇ% +
;
ˇˇ+ ,
try
ÄÄ 
{
ÅÅ 
var
ÇÇ 
ultimoCuota
ÇÇ 
=
ÇÇ  !
_db
ÇÇ" %
.
ÇÇ% &
Cuota
ÇÇ& +
.
ÇÇ+ ,
Where
ÉÉ 
(
ÉÉ 
c
ÉÉ 
=>
ÉÉ 
c
ÉÉ  
.
ÉÉ  !
codigo
ÉÉ! '
.
ÉÉ' (

StartsWith
ÉÉ( 2
(
ÉÉ2 3
	empiezaEn
ÉÉ3 <
)
ÉÉ< =
&&
ÉÉ> @
c
ÉÉA B
.
ÉÉB C
codigo
ÉÉC I
.
ÉÉI J
EndsWith
ÉÉJ R
(
ÉÉR S
$str
ÉÉS W
)
ÉÉW X
)
ÉÉX Y
.
ÉÉY Z
OrderByDescending
ÉÉZ k
(
ÉÉk l
c
ÉÉl m
=>
ÉÉn p
c
ÉÉq r
.
ÉÉr s
id
ÉÉs u
)
ÉÉu v
.
ÉÉv w
FirstOrDefaultÉÉw Ö
(ÉÉÖ Ü
)ÉÉÜ á
;ÉÉá à
return
ÑÑ 
ultimoCuota
ÑÑ "
!=
ÑÑ# %
null
ÑÑ& *
?
ÑÑ+ ,
Convert
ÑÑ- 4
.
ÑÑ4 5
ToInt32
ÑÑ5 <
(
ÑÑ< =
ultimoCuota
ÑÑ= H
.
ÑÑH I
codigo
ÑÑI O
.
ÑÑO P
	Substring
ÑÑP Y
(
ÑÑY Z
longitud
ÑÑZ b
,
ÑÑb c
ultimoCuota
ÑÑd o
.
ÑÑo p
codigo
ÑÑp v
.
ÑÑv w
IndexOf
ÑÑw ~
(
ÑÑ~ 
$strÑÑ Ç
)ÑÑÇ É
-ÑÑÑ Ö
longitudÑÑÜ é
)ÑÑé è
)ÑÑè ê
:ÑÑë í
$numÑÑì î
;ÑÑî ï
}
ÖÖ 
catch
ÜÜ 
(
ÜÜ 
	Exception
ÜÜ 
e
ÜÜ 
)
ÜÜ 
{
áá 
throw
àà 
new
àà 
DatosException
àà (
(
àà( )
$str
àà) R
,
ààR S
e
ààT U
)
ààU V
;
ààV W
}
ââ 
}
ää 	
public
åå 
OperationResult
åå 
CrearTransaccion
åå /
(
åå/ 0
Transaccion
åå0 ;
transaccion
åå< G
)
ååG H
{
çç 	
try
éé 
{
èè 
_db
êê 
.
êê 
Transaccion
êê 
.
êê  
Add
êê  #
(
êê# $
transaccion
êê$ /
)
êê/ 0
;
êê0 1
var
ëë 
result
ëë 
=
ëë 
Save
ëë !
(
ëë! "
)
ëë" #
;
ëë# $
result
íí 
.
íí 
data
íí 
=
íí 
transaccion
íí )
.
íí) *
id
íí* ,
;
íí, -
result
ìì 
.
ìì 
information
ìì "
=
ìì# $
transaccion
ìì% 0
;
ìì0 1
return
îî 
result
îî 
;
îî 
}
ïï 
catch
ññ 
(
ññ 
	Exception
ññ 
e
ññ 
)
ññ 
{
óó 
throw
òò 
new
òò 
DatosException
òò (
(
òò( )
$str
òò) E
,
òòE F
e
òòG H
)
òòH I
;
òòI J
}
öö 
}
õõ 	
public
°° 
OperationResult
°° #
ActualizarTransaccion
°° 4
(
°°4 5
Transaccion
°°5 @
transaccion
°°A L
)
°°L M
{
¢¢ 	
try
££ 
{
§§ 
Transaccion
•• 
dbTransaccion
•• )
=
••* +
_db
••, /
.
••/ 0
Transaccion
••0 ;
.
••; <
Single
••< B
(
••B C
m
••C D
=>
••E G
m
••H I
.
••I J
id
••J L
==
••M O
transaccion
••P [
.
••[ \
id
••\ ^
)
••^ _
;
••_ `
_db
¶¶ 
.
¶¶ 
Entry
¶¶ 
(
¶¶ 
dbTransaccion
¶¶ '
)
¶¶' (
.
¶¶( )
CurrentValues
¶¶) 6
.
¶¶6 7
	SetValues
¶¶7 @
(
¶¶@ A
transaccion
¶¶A L
)
¶¶L M
;
¶¶M N
var
ßß 
result
ßß 
=
ßß 
Save
ßß !
(
ßß! "
)
ßß" #
;
ßß# $
result
®® 
.
®® 
data
®® 
=
®® 
transaccion
®® )
.
®®) *
id
®®* ,
;
®®, -
return
©© 
result
©© 
;
©© 
}
™™ 
catch
´´ 
(
´´ 
	Exception
´´ 
e
´´ 
)
´´ 
{
¨¨ 
throw
≠≠ 
new
≠≠ 
DatosException
≠≠ (
(
≠≠( )
$str
≠≠) J
,
≠≠J K
e
≠≠L M
)
≠≠M N
;
≠≠N O
}
ÆÆ 
}
ØØ 	
public
±± 
OperationResult
±± %
ActualizarTransacciones
±± 6
(
±±6 7
List
±±7 ;
<
±±; <
Transaccion
±±< G
>
±±G H
transacciones
±±I V
)
±±V W
{
≤≤ 	
try
≥≥ 
{
¥¥ 
foreach
µµ 
(
µµ 
var
µµ 
transaccion
µµ (
in
µµ) +
transacciones
µµ, 9
)
µµ9 :
{
∂∂ 
Transaccion
∑∑ 
dbTransaccion1
∑∑  .
=
∑∑/ 0
_db
∑∑1 4
.
∑∑4 5
Transaccion
∑∑5 @
.
∑∑@ A
Single
∑∑A G
(
∑∑G H
m
∑∑H I
=>
∑∑J L
m
∑∑M N
.
∑∑N O
id
∑∑O Q
==
∑∑R T
transaccion
∑∑U `
.
∑∑` a
id
∑∑a c
)
∑∑c d
;
∑∑d e
_db
∏∏ 
.
∏∏ 
Entry
∏∏ 
(
∏∏ 
dbTransaccion1
∏∏ ,
)
∏∏, -
.
∏∏- .
CurrentValues
∏∏. ;
.
∏∏; <
	SetValues
∏∏< E
(
∏∏E F
transaccion
∏∏F Q
)
∏∏Q R
;
∏∏R S
}
ππ 
var
∫∫ 
result
∫∫ 
=
∫∫ 
Save
∫∫ !
(
∫∫! "
)
∫∫" #
;
∫∫# $
return
ªª 
result
ªª 
;
ªª 
}
ºº 
catch
ΩΩ 
(
ΩΩ 
	Exception
ΩΩ 
e
ΩΩ 
)
ΩΩ 
{
ææ 
throw
øø 
new
øø 
DatosException
øø (
(
øø( )
$str
øø) L
,
øøL M
e
øøN O
)
øøO P
;
øøP Q
}
¿¿ 
}
¡¡ 	
public
√√ 
PuntosDeCliente
√√ $
ObtenerPuntosDeCliente
√√ 5
(
√√5 6
DateTime
√√6 >+
fechaDesdeParaObtencionPuntos
√√? \
,
√√\ ]
int
√√^ a
	idCliente
√√b k
)
√√k l
{
ƒƒ 	
try
≈≈ 
{
∆∆ 
var
«« -
transaccionesDePuntosPendientes
«« 3
=
««4 5
_db
««6 9
.
««9 :
Transaccion
««: E
.
««E F
Where
««F K
(
««K L
t
««L M
=>
««N P
t
««Q R
.
««R S&
id_actor_negocio_externo
««S k
==
««l n
	idCliente
««o x
&&
»» 
t
»» 
.
»» !
id_tipo_transaccion
»» ,
==
»»- /!
TransaccionSettings
»»0 C
.
»»C D
Default
»»D K
.
»»K L+
IdTipoTransaccionOrdenDeVenta
»»L i
&&
…… 
t
…… 
.
…… 
id_estado_actual
…… )
==
……* ,
MaestroSettings
……- <
.
……< =
Default
……= D
.
……D E.
 IdDetalleMaestroEstadoConfirmado
……E e
&&
   
t
   
.
   
fecha_inicio
   %
>=
  & (+
fechaDesdeParaObtencionPuntos
  ) F
&&
ÀÀ 
t
ÀÀ 
.
ÀÀ 
	cantidad3
ÀÀ "
>
ÀÀ# $
$num
ÀÀ% &
)
ÀÀ& '
.
ÀÀ' (
ToList
ÀÀ( .
(
ÀÀ. /
)
ÀÀ/ 0
;
ÀÀ0 1
PuntosDeCliente
ÃÃ 
puntosDeCliente
ÃÃ  /
=
ÃÃ0 1
new
ÃÃ2 5
PuntosDeCliente
ÃÃ6 E
{
ÕÕ 
PuntosPorCanjear
ŒŒ $
=
ŒŒ% &-
transaccionesDePuntosPendientes
ŒŒ' F
==
ŒŒG I
null
ŒŒJ N
?
ŒŒO P
$num
ŒŒQ R
:
ŒŒS T
(
ŒŒU V
int
ŒŒV Y
)
ŒŒY Z-
transaccionesDePuntosPendientes
ŒŒZ y
.
ŒŒy z
Sum
ŒŒz }
(
ŒŒ} ~
t
ŒŒ~ 
=>ŒŒÄ Ç
tŒŒÉ Ñ
.ŒŒÑ Ö
	cantidad3ŒŒÖ é
)ŒŒé è
}
œœ 
;
œœ 
return
–– 
puntosDeCliente
–– &
;
––& '
}
—— 
catch
““ 
(
““ 
	Exception
““ 
e
““ 
)
““ 
{
”” 
throw
‘‘ 
new
‘‘ 
DatosException
‘‘ (
(
‘‘( )
$str
‘‘) R
,
‘‘R S
e
‘‘T U
)
‘‘U V
;
‘‘V W
}
’’ 
}
÷÷ 	
public
ÿÿ 
IEnumerable
ÿÿ 
<
ÿÿ 
Transaccion
ÿÿ &
>
ÿÿ& '1
#ObtenerTransaccionesParaCanjePuntos
ÿÿ( K
(
ÿÿK L
DateTime
ÿÿL T+
fechaDesdeParaObtencionPuntos
ÿÿU r
,
ÿÿr s
int
ÿÿt w
	idClienteÿÿx Å
)ÿÿÅ Ç
{
ŸŸ 	
try
⁄⁄ 
{
€€ 
return
‹‹ 
_db
‹‹ 
.
‹‹ 
Transaccion
‹‹ &
.
‹‹& '
Where
‹‹' ,
(
‹‹, -
t
‹‹- .
=>
‹‹/ 1
t
‹‹2 3
.
‹‹3 4&
id_actor_negocio_externo
‹‹4 L
==
‹‹M O
	idCliente
‹‹P Y
&&
›› 
t
›› 
.
›› !
id_tipo_transaccion
›› ,
==
››- /!
TransaccionSettings
››0 C
.
››C D
Default
››D K
.
››K L+
IdTipoTransaccionOrdenDeVenta
››L i
&&
ﬁﬁ 
t
ﬁﬁ 
.
ﬁﬁ 
id_estado_actual
ﬁﬁ )
==
ﬁﬁ* ,
MaestroSettings
ﬁﬁ- <
.
ﬁﬁ< =
Default
ﬁﬁ= D
.
ﬁﬁD E.
 IdDetalleMaestroEstadoConfirmado
ﬁﬁE e
&&
ﬂﬂ 
t
ﬂﬂ 
.
ﬂﬂ 
fecha_inicio
ﬂﬂ %
>=
ﬂﬂ& (+
fechaDesdeParaObtencionPuntos
ﬂﬂ) F
&&
‡‡ 
t
‡‡ 
.
‡‡ 
	cantidad3
‡‡ "
>
‡‡# $
$num
‡‡% &
)
‡‡& '
.
‡‡' (
OrderBy
‡‡( /
(
‡‡/ 0
t
‡‡0 1
=>
‡‡2 4
t
‡‡5 6
.
‡‡6 7
fecha_inicio
‡‡7 C
)
‡‡C D
;
‡‡D E
}
·· 
catch
‚‚ 
(
‚‚ 
	Exception
‚‚ 
e
‚‚ 
)
‚‚ 
{
„„ 
throw
‰‰ 
new
‰‰ 
DatosException
‰‰ (
(
‰‰( )
$str
‰‰) e
,
‰‰e f
e
‰‰g h
)
‰‰h i
;
‰‰i j
}
ÂÂ 
}
ÊÊ 	
public
ËË 
IEnumerable
ËË 
<
ËË &
Reporte_Puntos_Canjeados
ËË 3
>
ËË3 4+
ObtenerReportePuntosCanjeados
ËË5 R
(
ËËR S
int
ËËS V/
!idAccionDeNegocioMovimientoEnCaja
ËËW x
,
ËËx y
DateTimeËËz Ç

fechaDesdeËËÉ ç
,ËËç é
DateTimeËËè ó

fechaHastaËËò ¢
,ËË¢ £
intËË§ ß
[ËËß ®
]ËË® ©"
idsCentrosAtencionËË™ º
)ËËº Ω
{
ÈÈ 	
try
ÍÍ 
{
ÎÎ 
var
ÏÏ 
Resumen
ÏÏ 
=
ÏÏ 
_db
ÏÏ !
.
ÏÏ! "4
&Accion_de_negocio_por_tipo_transaccion
ÏÏ" H
.
ÌÌ  !
Where
ÌÌ! &
(
ÌÌ& '
antt
ÌÌ' +
=>
ÌÌ, .
antt
ÌÌ/ 3
.
ÌÌ3 4"
id_accion_de_negocio
ÌÌ4 H
==
ÌÌI K/
!idAccionDeNegocioMovimientoEnCaja
ÌÌL m
)
ÌÌm n
.
ÓÓ  !

SelectMany
ÓÓ! +
(
ÓÓ+ ,
antt
ÓÓ, 0
=>
ÓÓ1 3
antt
ÓÓ4 8
.
ÓÓ8 9
Tipo_transaccion
ÓÓ9 I
.
ÓÓI J
Transaccion
ÓÓJ U
)
ÓÓU V
.
ÓÓV W
Where
ÓÓW \
(
ÓÓ\ ]
t
ÓÓ] ^
=>
ÓÓ_ a
t
ÓÓb c
.
ÓÓc d
fecha_inicio
ÓÓd p
>=
ÓÓq s

fechaDesde
ÓÓt ~
&&ÓÓ Å
tÓÓÇ É
.ÓÓÉ Ñ
fecha_inicioÓÓÑ ê
<=ÓÓë ì

fechaHastaÓÓî û
&&ÓÓü °"
idsCentrosAtencionÓÓ¢ ¥
.ÓÓ¥ µ
ContainsÓÓµ Ω
(ÓÓΩ æ
tÓÓæ ø
.ÓÓø ¿(
id_actor_negocio_internoÓÓ¿ ÿ
)ÓÓÿ Ÿ
&&ÓÓ⁄ ‹
tÓÓ› ﬁ
.ÓÓﬁ ﬂ 
id_estado_actualÓÓﬂ Ô
==ÓÓ Ú
MaestroSettingsÓÓÛ Ç
.ÓÓÇ É
DefaultÓÓÉ ä
.ÓÓä ã0
 IdDetalleMaestroEstadoConfirmadoÓÓã ´
&&ÓÓ¨ Æ
tÓÓØ ∞
.ÓÓ∞ ±
	cantidad1ÓÓ± ∫
>ÓÓª º
$numÓÓΩ æ
)ÓÓæ ø
.
ÔÔ 
Select
ÔÔ 
(
ÔÔ 
t
ÔÔ 
=>
ÔÔ  
new
ÔÔ! $&
Reporte_Puntos_Canjeados
ÔÔ% =
(
ÔÔ= >
)
ÔÔ> ?
{
 
	FechaPago
ÒÒ !
=
ÒÒ" #
t
ÒÒ$ %
.
ÒÒ% &
fecha_inicio
ÒÒ& 2
,
ÒÒ2 3
IdCaja
ÚÚ 
=
ÚÚ  
t
ÚÚ! "
.
ÚÚ" #&
id_actor_negocio_interno
ÚÚ# ;
,
ÚÚ; <

NombreCaja
ÛÛ "
=
ÛÛ# $
t
ÛÛ% &
.
ÛÛ& '
Actor_negocio2
ÛÛ' 5
.
ÛÛ5 6
Actor
ÛÛ6 ;
.
ÛÛ; <
primer_nombre
ÛÛ< I
,
ÛÛI J#
CodigoTipoComprobante
ÙÙ -
=
ÙÙ. /
t
ÙÙ0 1
.
ÙÙ1 2
Transaccion2
ÙÙ2 >
.
ÙÙ> ?
Comprobante
ÙÙ? J
.
ÙÙJ K
Detalle_maestro
ÙÙK Z
.
ÙÙZ [
valor
ÙÙ[ `
,
ÙÙ` a
TipoComprobante
ıı '
=
ıı( )
t
ıı* +
.
ıı+ ,
Transaccion2
ıı, 8
.
ıı8 9
Comprobante
ıı9 D
.
ııD E
Detalle_maestro
ııE T
.
ııT U
nombre
ııU [
,
ıı[ \
SerieComprobante
ˆˆ (
=
ˆˆ) *
t
ˆˆ+ ,
.
ˆˆ, -
Transaccion2
ˆˆ- 9
.
ˆˆ9 :
Comprobante
ˆˆ: E
.
ˆˆE F
numero_serie
ˆˆF R
,
ˆˆR S
NumeroComprobante
˜˜ )
=
˜˜* +
t
˜˜, -
.
˜˜- .
Transaccion2
˜˜. :
.
˜˜: ;
Comprobante
˜˜; F
.
˜˜F G
numero
˜˜G M
,
˜˜M N(
CodigoTipoDocumentoCliente
¯¯ 2
=
¯¯3 4
t
¯¯5 6
.
¯¯6 7
Actor_negocio1
¯¯7 E
.
¯¯E F
Actor
¯¯F K
.
¯¯K L
Detalle_maestro
¯¯L [
.
¯¯[ \
valor
¯¯\ a
,
¯¯a b$
NumeroDocumentoCliente
˘˘ .
=
˘˘/ 0
t
˘˘1 2
.
˘˘2 3
Actor_negocio1
˘˘3 A
.
˘˘A B
Actor
˘˘B G
.
˘˘G H(
numero_documento_identidad
˘˘H b
,
˘˘b c
Cliente
˙˙ 
=
˙˙  !
t
˙˙" #
.
˙˙# $
Actor_negocio1
˙˙$ 2
.
˙˙2 3
Actor
˙˙3 8
.
˙˙8 9
primer_nombre
˙˙9 F
.
˙˙F G
Replace
˙˙G N
(
˙˙N O
$str
˙˙O R
,
˙˙R S
$str
˙˙T W
)
˙˙W X
,
˙˙X Y
Puntos
˚˚ 
=
˚˚  
t
˚˚! "
.
˚˚" #
	cantidad1
˚˚# ,
,
˚˚, -
Monto
¸¸ 
=
¸¸ 
t
¸¸  !
.
¸¸! "
importe_total
¸¸" /
,
¸¸/ 0
	EsIngreso
˝˝ !
=
˝˝" #
t
˝˝$ %
.
˝˝% &
Tipo_transaccion
˝˝& 6
.
˝˝6 74
&Accion_de_negocio_por_tipo_transaccion
˝˝7 ]
.
˝˝] ^
FirstOrDefault
˝˝^ l
(
˝˝l m
anpt
˝˝m q
=>
˝˝r t
anpt
˝˝u y
.
˝˝y z#
id_accion_de_negocio˝˝z é
==˝˝è ë1
!idAccionDeNegocioMovimientoEnCaja˝˝í ≥
)˝˝≥ ¥
.˝˝¥ µ
valor˝˝µ ∫
}
˛˛ 
)
˛˛ 
;
˛˛ 
return
ˇˇ 
Resumen
ˇˇ 
;
ˇˇ 
}
ÄÄ 
catch
ÅÅ 
(
ÅÅ 
	Exception
ÅÅ 
e
ÅÅ 
)
ÅÅ 
{
ÇÇ 
throw
ÉÉ 
new
ÉÉ 
DatosException
ÉÉ (
(
ÉÉ( )
$str
ÉÉ) O
,
ÉÉO P
e
ÉÉQ R
)
ÉÉR S
;
ÉÉS T
}
ÑÑ 
}
ÖÖ 	
public
áá 
IEnumerable
áá 
<
áá '
Reporte_Puntos_Pendientes
áá 4
>
áá4 5,
ObtenerReportePuntosPendientes
áá6 T
(
ááT U
DateTime
ááU ]+
fechaDesdeParaObtencionPuntos
áá^ {
)
áá{ |
{
àà 	
try
ââ 
{
ää 
return
ãã 
_db
ãã 
.
ãã 
Transaccion
ãã &
.
ãã& '
Where
ãã' ,
(
ãã, -
t
ãã- .
=>
ãã/ 1
t
ãã2 3
.
ãã3 4!
id_tipo_transaccion
ãã4 G
==
ããH J!
TransaccionSettings
ããK ^
.
ãã^ _
Default
ãã_ f
.
ããf g,
IdTipoTransaccionOrdenDeVentaããg Ñ
&&
åå 
t
åå 
.
åå 
id_estado_actual
åå )
==
åå* ,
MaestroSettings
åå- <
.
åå< =
Default
åå= D
.
ååD E.
 IdDetalleMaestroEstadoConfirmado
ååE e
&&
çç 
t
çç 
.
çç 
fecha_inicio
çç %
>=
çç& (+
fechaDesdeParaObtencionPuntos
çç) F
&&
éé 
t
éé 
.
éé 
	cantidad3
éé "
>
éé# $
$num
éé% &
)
éé& '
.
èè 
GroupBy
èè 
(
èè 
t
èè 
=>
èè 
new
èè !
{
êê 
	idCliente
ëë 
=
ëë 
t
ëë  !
.
ëë! "&
id_actor_negocio_externo
ëë" :
,
ëë: ;
cliente
íí 
=
íí 
t
íí 
.
íí  
Actor_negocio1
íí  .
.
íí. /
Actor
íí/ 4
.
íí4 5
primer_nombre
íí5 B
,
ííB C
numeroDocumento
ìì #
=
ìì$ %
t
ìì& '
.
ìì' (
Actor_negocio1
ìì( 6
.
ìì6 7
Actor
ìì7 <
.
ìì< =(
numero_documento_identidad
ìì= W
}
îî 
)
îî 
.
îî 
Select
îî 
(
îî 
t
îî 
=>
îî 
new
îî "'
Reporte_Puntos_Pendientes
îî# <
(
îî< =
)
îî= >
{
ïï $
NumeroDocumentoCliente
ññ *
=
ññ+ ,
t
ññ- .
.
ññ. /
Key
ññ/ 2
.
ññ2 3
numeroDocumento
ññ3 B
,
ññB C
Cliente
óó 
=
óó 
t
óó 
.
óó  
Key
óó  #
.
óó# $
cliente
óó$ +
.
óó+ ,
Replace
óó, 3
(
óó3 4
$str
óó4 7
,
óó7 8
$str
óó9 <
)
óó< =
,
óó= >
PuntosPendientes
òò $
=
òò% &
(
òò' (
int
òò( +
)
òò+ ,
t
òò, -
.
òò- .
Sum
òò. 1
(
òò1 2
tt
òò2 4
=>
òò5 7
tt
òò8 :
.
òò: ;
	cantidad3
òò; D
)
òòD E
}
ôô 
)
ôô 
;
ôô 
}
öö 
catch
õõ 
(
õõ 
	Exception
õõ 
e
õõ 
)
õõ 
{
úú 
throw
ùù 
new
ùù 
DatosException
ùù (
(
ùù( )
$str
ùù) e
,
ùùe f
e
ùùg h
)
ùùh i
;
ùùi j
}
ûû 
}
üü 	
public
†† 
OperationResult
†† @
2ActualizarTransaccionTransaccion1DetallesParametro
†† Q
(
††Q R
Transaccion
††R ]
transaccion
††^ i
)
††i j
{
°° 	
try
¢¢ 
{
££ 
Transaccion
§§ 
dbTransaccion
§§ )
=
§§* +
_db
§§, /
.
§§/ 0
Transaccion
§§0 ;
.
§§; <
Single
§§< B
(
§§B C
m
§§C D
=>
§§E G
m
§§H I
.
§§I J
id
§§J L
==
§§M O
transaccion
§§P [
.
§§[ \
id
§§\ ^
)
§§^ _
;
§§_ `
_db
•• 
.
•• 
Entry
•• 
(
•• 
dbTransaccion
•• '
)
••' (
.
••( )
CurrentValues
••) 6
.
••6 7
	SetValues
••7 @
(
••@ A
transaccion
••A L
)
••L M
;
••M N
List
ßß 
<
ßß 
Transaccion
ßß  
>
ßß  !
transacciones1
ßß" 0
=
ßß1 2
transaccion
ßß3 >
.
ßß> ?
Transaccion1
ßß? K
.
ßßK L
ToList
ßßL R
(
ßßR S
)
ßßS T
;
ßßT U
foreach
®® 
(
®® 
var
®® 
transaccion1
®® )
in
®®* ,
transacciones1
®®- ;
)
®®; <
{
©© 
Transaccion
™™ 
dbTransaccion1
™™  .
=
™™/ 0
dbTransaccion
™™1 >
.
™™> ?
Transaccion1
™™? K
.
™™K L
Single
™™L R
(
™™R S
m
™™S T
=>
™™U W
m
™™X Y
.
™™Y Z
id
™™Z \
==
™™] _
transaccion1
™™` l
.
™™l m
id
™™m o
)
™™o p
;
™™p q
_db
´´ 
.
´´ 
Entry
´´ 
(
´´ 
dbTransaccion1
´´ ,
)
´´, -
.
´´- .
CurrentValues
´´. ;
.
´´; <
	SetValues
´´< E
(
´´E F
transaccion1
´´F R
)
´´R S
;
´´S T
List
≠≠ 
<
≠≠ !
Detalle_transaccion
≠≠ ,
>
≠≠, -

dbDetalles
≠≠. 8
=
≠≠9 :
dbTransaccion1
≠≠; I
.
≠≠I J!
Detalle_transaccion
≠≠J ]
.
≠≠] ^
ToList
≠≠^ d
(
≠≠d e
)
≠≠e f
;
≠≠f g
List
ÆÆ 
<
ÆÆ !
Detalle_transaccion
ÆÆ ,
>
ÆÆ, -
updDetalles
ÆÆ. 9
=
ÆÆ: ;
transaccion1
ÆÆ< H
.
ÆÆH I!
Detalle_transaccion
ÆÆI \
.
ÆÆ\ ]
ToList
ÆÆ] c
(
ÆÆc d
)
ÆÆd e
;
ÆÆe f
updDetalles
ØØ 
.
ØØ  
ForEach
ØØ  '
(
ØØ' (
d
ØØ( )
=>
ØØ* ,
d
ØØ- .
.
ØØ. /
Transaccion
ØØ/ :
=
ØØ; <
dbTransaccion1
ØØ= K
)
ØØK L
;
ØØL M
foreach
±± 
(
±± 
var
±±  
	dbDetalle
±±! *
in
±±+ -

dbDetalles
±±. 8
)
±±8 9
{
≤≤ 
if
≥≥ 
(
≥≥ 
!
≥≥ 
updDetalles
≥≥ (
.
≥≥( )
Any
≥≥) ,
(
≥≥, -
dt
≥≥- /
=>
≥≥0 2
dt
≥≥3 5
.
≥≥5 6
id
≥≥6 8
==
≥≥9 ;
	dbDetalle
≥≥< E
.
≥≥E F
id
≥≥F H
)
≥≥H I
)
≥≥I J
{
¥¥ 
_db
µµ 
.
µµ  !
Detalle_transaccion
µµ  3
.
µµ3 4
Remove
µµ4 :
(
µµ: ;
	dbDetalle
µµ; D
)
µµD E
;
µµE F
}
∂∂ 
}
∑∑ 
foreach
∏∏ 
(
∏∏ 
var
∏∏  

updDetalle
∏∏! +
in
∏∏, .
updDetalles
∏∏/ :
)
∏∏: ;
{
ππ 
if
∫∫ 
(
∫∫ 

dbDetalles
∫∫ &
.
∫∫& '
Any
∫∫' *
(
∫∫* +
dt
∫∫+ -
=>
∫∫. 0
dt
∫∫1 3
.
∫∫3 4
id
∫∫4 6
==
∫∫7 9

updDetalle
∫∫: D
.
∫∫D E
id
∫∫E G
)
∫∫G H
)
∫∫H I
{
ªª !
Detalle_transaccion
ºº /
detalle
ºº0 7
=
ºº8 9

dbDetalles
ºº: D
.
ººD E
Single
ººE K
(
ººK L
m
ººL M
=>
ººN P
m
ººQ R
.
ººR S
id
ººS U
==
ººV X

updDetalle
ººY c
.
ººc d
id
ººd f
)
ººf g
;
ººg h
_db
ΩΩ 
.
ΩΩ  
Entry
ΩΩ  %
(
ΩΩ% &
detalle
ΩΩ& -
)
ΩΩ- .
.
ΩΩ. /
CurrentValues
ΩΩ/ <
.
ΩΩ< =
	SetValues
ΩΩ= F
(
ΩΩF G

updDetalle
ΩΩG Q
)
ΩΩQ R
;
ΩΩR S
}
ææ 
else
øø 
{
¿¿ 
_db
¡¡ 
.
¡¡  !
Detalle_transaccion
¡¡  3
.
¡¡3 4
Add
¡¡4 7
(
¡¡7 8

updDetalle
¡¡8 B
)
¡¡B C
;
¡¡C D
}
¬¬ 
}
√√ 
List
≈≈ 
<
≈≈ #
Parametro_transaccion
≈≈ .
>
≈≈. /
dbParametros
≈≈0 <
=
≈≈= >
dbTransaccion1
≈≈? M
.
≈≈M N#
Parametro_transaccion
≈≈N c
.
≈≈c d
ToList
≈≈d j
(
≈≈j k
)
≈≈k l
;
≈≈l m
List
∆∆ 
<
∆∆ #
Parametro_transaccion
∆∆ .
>
∆∆. /
updParametros
∆∆0 =
=
∆∆> ?
transaccion1
∆∆@ L
.
∆∆L M#
Parametro_transaccion
∆∆M b
.
∆∆b c
ToList
∆∆c i
(
∆∆i j
)
∆∆j k
;
∆∆k l
updParametros
«« !
.
««! "
ForEach
««" )
(
««) *
d
««* +
=>
««, .
d
««/ 0
.
««0 1
Transaccion
««1 <
=
««= >
dbTransaccion1
««? M
)
««M N
;
««N O
foreach
…… 
(
…… 
var
……  
dbParametro
……! ,
in
……- /
dbParametros
……0 <
)
……< =
{
   
if
ÀÀ 
(
ÀÀ 
!
ÀÀ 
updParametros
ÀÀ *
.
ÀÀ* +
Any
ÀÀ+ .
(
ÀÀ. /
dt
ÀÀ/ 1
=>
ÀÀ2 4
dt
ÀÀ5 7
.
ÀÀ7 8
id_parametro
ÀÀ8 D
==
ÀÀE G
dbParametro
ÀÀH S
.
ÀÀS T
id_parametro
ÀÀT `
)
ÀÀ` a
)
ÀÀa b
{
ÃÃ 
_db
ÕÕ 
.
ÕÕ  #
Parametro_transaccion
ÕÕ  5
.
ÕÕ5 6
Remove
ÕÕ6 <
(
ÕÕ< =
dbParametro
ÕÕ= H
)
ÕÕH I
;
ÕÕI J
}
ŒŒ 
}
œœ 
foreach
–– 
(
–– 
var
––  
updParametro
––! -
in
––. 0
updParametros
––1 >
)
––> ?
{
—— 
if
““ 
(
““ 
dbParametros
““ (
.
““( )
Any
““) ,
(
““, -
dt
““- /
=>
““0 2
dt
““3 5
.
““5 6
id_parametro
““6 B
==
““C E
updParametro
““F R
.
““R S
id_parametro
““S _
)
““_ `
)
““` a
{
”” #
Parametro_transaccion
‘‘ 1
	parametro
‘‘2 ;
=
‘‘< =
dbParametros
‘‘> J
.
‘‘J K
Single
‘‘K Q
(
‘‘Q R
m
‘‘R S
=>
‘‘T V
m
‘‘W X
.
‘‘X Y
id
‘‘Y [
==
‘‘\ ^
updParametro
‘‘_ k
.
‘‘k l
id
‘‘l n
)
‘‘n o
;
‘‘o p
_db
’’ 
.
’’  
Entry
’’  %
(
’’% &
	parametro
’’& /
)
’’/ 0
.
’’0 1
CurrentValues
’’1 >
.
’’> ?
	SetValues
’’? H
(
’’H I
updParametro
’’I U
)
’’U V
;
’’V W
}
÷÷ 
else
◊◊ 
{
ÿÿ 
_db
ŸŸ 
.
ŸŸ  #
Parametro_transaccion
ŸŸ  5
.
ŸŸ5 6
Add
ŸŸ6 9
(
ŸŸ9 :
updParametro
ŸŸ: F
)
ŸŸF G
;
ŸŸG H
}
⁄⁄ 
}
€€ 
}
‹‹ 
var
ﬁﬁ 
result
ﬁﬁ 
=
ﬁﬁ 
Save
ﬁﬁ !
(
ﬁﬁ! "
)
ﬁﬁ" #
;
ﬁﬁ# $
result
ﬂﬂ 
.
ﬂﬂ 
data
ﬂﬂ 
=
ﬂﬂ 
transaccion
ﬂﬂ )
.
ﬂﬂ) *
id
ﬂﬂ* ,
;
ﬂﬂ, -
return
‡‡ 
result
‡‡ 
;
‡‡ 
}
·· 
catch
‚‚ 
(
‚‚ 
	Exception
‚‚ 
e
‚‚ 
)
‚‚ 
{
„„ 
throw
‰‰ 
new
‰‰ 
DatosException
‰‰ (
(
‰‰( )
$str
‰‰) K
,
‰‰K L
e
‰‰M N
)
‰‰N O
;
‰‰O P
}
ÂÂ 
}
ÊÊ 	
public
ËË 
OperationResult
ËË =
/CrearTransaccionYActualizarParametroTransaccion
ËË N
(
ËËN O
Transaccion
ËËO Z
transaccion
ËË[ f
,
ËËf g#
Parametro_transaccion
ËËh }#
parametroTransaccionËË~ í
)ËËí ì
{
ÈÈ 	
try
ÍÍ 
{
ÎÎ 
_db
ÏÏ 
.
ÏÏ 
Transaccion
ÏÏ 
.
ÏÏ  
Add
ÏÏ  #
(
ÏÏ# $
transaccion
ÏÏ$ /
)
ÏÏ/ 0
;
ÏÏ0 1
if
ÌÌ 
(
ÌÌ "
parametroTransaccion
ÌÌ (
!=
ÌÌ) +
null
ÌÌ, 0
)
ÌÌ0 1
{
ÓÓ #
Parametro_transaccion
ÔÔ )$
dbParametroTransaccion
ÔÔ* @
=
ÔÔA B
_db
ÔÔC F
.
ÔÔF G#
Parametro_transaccion
ÔÔG \
.
ÔÔ\ ]
Single
ÔÔ] c
(
ÔÔc d
m
ÔÔd e
=>
ÔÔf h
m
ÔÔi j
.
ÔÔj k
id
ÔÔk m
==
ÔÔn p#
parametroTransaccionÔÔq Ö
.ÔÔÖ Ü
idÔÔÜ à
)ÔÔà â
;ÔÔâ ä
_db
 
.
 
Entry
 
(
 $
dbParametroTransaccion
 4
)
4 5
.
5 6
CurrentValues
6 C
.
C D
	SetValues
D M
(
M N"
parametroTransaccion
N b
)
b c
;
c d
}
ÒÒ 
var
ÚÚ 
result
ÚÚ 
=
ÚÚ 
Save
ÚÚ !
(
ÚÚ! "
)
ÚÚ" #
;
ÚÚ# $
result
ÛÛ 
.
ÛÛ 
data
ÛÛ 
=
ÛÛ 
transaccion
ÛÛ )
.
ÛÛ) *
id
ÛÛ* ,
;
ÛÛ, -
return
ÙÙ 
result
ÙÙ 
;
ÙÙ 
}
ıı 
catch
ˆˆ 
(
ˆˆ 
	Exception
ˆˆ 
e
ˆˆ 
)
ˆˆ 
{
˜˜ 
throw
¯¯ 
new
¯¯ 
DatosException
¯¯ (
(
¯¯( )
$str
¯¯) E
,
¯¯E F
e
¯¯G H
)
¯¯H I
;
¯¯I J
}
˘˘ 
}
˙˙ 	
public
¸¸ 
OperationResult
¸¸ ,
ActualizarParametroTransaccion
¸¸ =
(
¸¸= >#
Parametro_transaccion
¸¸> S"
parametroTransaccion
¸¸T h
)
¸¸h i
{
˝˝ 	
try
˛˛ 
{
ˇˇ #
Parametro_transaccion
ÄÄ %$
dbParametroTransaccion
ÄÄ& <
=
ÄÄ= >
_db
ÄÄ? B
.
ÄÄB C#
Parametro_transaccion
ÄÄC X
.
ÄÄX Y
Single
ÄÄY _
(
ÄÄ_ `
m
ÄÄ` a
=>
ÄÄb d
m
ÄÄe f
.
ÄÄf g
id
ÄÄg i
==
ÄÄj l#
parametroTransaccionÄÄm Å
.ÄÄÅ Ç
idÄÄÇ Ñ
)ÄÄÑ Ö
;ÄÄÖ Ü
_db
ÅÅ 
.
ÅÅ 
Entry
ÅÅ 
(
ÅÅ $
dbParametroTransaccion
ÅÅ 0
)
ÅÅ0 1
.
ÅÅ1 2
CurrentValues
ÅÅ2 ?
.
ÅÅ? @
	SetValues
ÅÅ@ I
(
ÅÅI J"
parametroTransaccion
ÅÅJ ^
)
ÅÅ^ _
;
ÅÅ_ `
var
ÇÇ 
result
ÇÇ 
=
ÇÇ 
Save
ÇÇ !
(
ÇÇ! "
)
ÇÇ" #
;
ÇÇ# $
return
ÉÉ 
result
ÉÉ 
;
ÉÉ 
}
ÑÑ 
catch
ÖÖ 
(
ÖÖ 
	Exception
ÖÖ 
e
ÖÖ 
)
ÖÖ 
{
ÜÜ 
throw
áá 
new
áá 
DatosException
áá (
(
áá( )
$str
áá) Z
,
ááZ [
e
áá\ ]
)
áá] ^
;
áá^ _
}
àà 
}
ââ 	
public
ãã 
OperationResult
ãã 
ActualizarCoutas
ãã /
(
ãã/ 0
List
ãã0 4
<
ãã4 5
Cuota
ãã5 :
>
ãã: ;
cuotas
ãã< B
)
ããB C
{
åå 	
try
çç 
{
éé !
SetActualizarCuotas
èè #
(
èè# $
cuotas
èè$ *
)
èè* +
;
èè+ ,
OperationResult
êê 
result
êê  &
=
êê' (
new
êê) ,
OperationResult
êê- <
(
êê< =
)
êê= >
;
êê> ?
result
ëë 
=
ëë 
Save
ëë 
(
ëë 
)
ëë 
;
ëë  
return
íí 
result
íí 
;
íí 
}
ìì 
catch
îî 
(
îî 
	Exception
îî 
e
îî 
)
îî 
{
ïï 
throw
ññ 
new
ññ 
DatosException
ññ (
(
ññ( )
$str
ññ) E
,
ññE F
e
ññG H
)
ññH I
;
ññI J
}
óó 
}
òò 	
public
öö 
void
öö !
SetActualizarCuotas
öö '
(
öö' (
IEnumerable
öö( 3
<
öö3 4
Cuota
öö4 9
>
öö9 :
cuotas
öö; A
)
ööA B
{
õõ 	
foreach
úú 
(
úú 
var
úú 
item
úú 
in
úú  
cuotas
úú! '
)
úú' (
{
ùù 
Cuota
ûû 
dbCuota
ûû 
=
ûû 
_db
ûû  #
.
ûû# $
Cuota
ûû$ )
.
ûû) *
Single
ûû* 0
(
ûû0 1
m
ûû1 2
=>
ûû3 5
m
ûû6 7
.
ûû7 8
id
ûû8 :
==
ûû; =
item
ûû> B
.
ûûB C
id
ûûC E
)
ûûE F
;
ûûF G
_db
üü 
.
üü 
Entry
üü 
(
üü 
dbCuota
üü !
)
üü! "
.
üü" #
CurrentValues
üü# 0
.
üü0 1
	SetValues
üü1 :
(
üü: ;
item
üü; ?
)
üü? @
;
üü@ A
}
†† 
}
°° 	
public
££ 
OperationResult
££ 4
&CrearTransaccionYActualizarExistencias
££ E
(
££E F
Transaccion
££F Q
transaccion
££R ]
,
££] ^
List
££_ c
<
££c d

Existencia
££d n
>
££n o
existencias
££p {
)
££{ |
{
§§ 	
try
•• 
{
¶¶ 
_db
ßß 
.
ßß 
Transaccion
ßß 
.
ßß  
Add
ßß  #
(
ßß# $
transaccion
ßß$ /
)
ßß/ 0
;
ßß0 1&
SetActualizarExistencias
®® (
(
®®( )
existencias
®®) 4
)
®®4 5
;
®®5 6
var
©© 
result
©© 
=
©© 
Save
©© !
(
©©! "
)
©©" #
;
©©# $
result
™™ 
.
™™ 
data
™™ 
=
™™ 
transaccion
™™ )
.
™™) *
id
™™* ,
;
™™, -
return
´´ 
result
´´ 
;
´´ 
}
¨¨ 
catch
≠≠ 
(
≠≠ *
DbUpdateConcurrencyException
≠≠ /
ex
≠≠0 2
)
≠≠2 3
{
ÆÆ 
var
ØØ 
entries
ØØ 
=
ØØ 
ex
ØØ  
.
ØØ  !
Entries
ØØ! (
.
ØØ( )
Single
ØØ) /
(
ØØ/ 0
)
ØØ0 1
;
ØØ1 2
return
∞∞ 
new
∞∞ 
OperationResult
∞∞ *
(
∞∞* +
new
∞∞+ .!
ExistenciaException
∞∞/ B
(
∞∞B C
ex
∞∞C E
,
∞∞E F
(
∞∞G H

Existencia
∞∞H R
)
∞∞R S
entries
∞∞S Z
.
∞∞Z [
Entity
∞∞[ a
,
∞∞a b
transaccion
∞∞c n
)
∞∞n o
)
∞∞o p
;
∞∞p q
}
±± 
catch
≤≤ 
(
≤≤ 
	Exception
≤≤ 
e
≤≤ 
)
≤≤ 
{
≥≥ 
throw
¥¥ 
new
¥¥ 
DatosException
¥¥ (
(
¥¥( )
$str
¥¥) E
,
¥¥E F
e
¥¥G H
)
¥¥H I
;
¥¥I J
}
µµ 
}
∂∂ 	
public
∏∏ 
OperationResult
∏∏ =
/CrearTransaccionesYActualizarExistenciasYCuotas
∏∏ N
(
∏∏N O
Transaccion
∏∏O Z
transaccion
∏∏[ f
,
∏∏f g
List
∏∏h l
<
∏∏l m

Existencia
∏∏m w
>
∏∏w x
existencias∏∏y Ñ
,∏∏Ñ Ö
List∏∏Ü ä
<∏∏ä ã
Cuota∏∏ã ê
>∏∏ê ë
cuotas∏∏í ò
)∏∏ò ô
{
ππ 	
try
∫∫ 
{
ªª 
_db
ºº 
.
ºº 
Transaccion
ºº 
.
ºº  
Add
ºº  #
(
ºº# $
transaccion
ºº$ /
)
ºº/ 0
;
ºº0 1&
SetActualizarExistencias
ΩΩ (
(
ΩΩ( )
existencias
ΩΩ) 4
)
ΩΩ4 5
;
ΩΩ5 6!
SetActualizarCuotas
ææ #
(
ææ# $
cuotas
ææ$ *
)
ææ* +
;
ææ+ ,
var
øø 
result
øø 
=
øø 
Save
øø !
(
øø! "
)
øø" #
;
øø# $
result
¿¿ 
.
¿¿ 
data
¿¿ 
=
¿¿ 
$num
¿¿ 
;
¿¿  
return
¡¡ 
result
¡¡ 
;
¡¡ 
}
¬¬ 
catch
√√ 
(
√√ *
DbUpdateConcurrencyException
√√ /
ex
√√0 2
)
√√2 3
{
ƒƒ 
var
≈≈ 
entries
≈≈ 
=
≈≈ 
ex
≈≈  
.
≈≈  !
Entries
≈≈! (
.
≈≈( )
Single
≈≈) /
(
≈≈/ 0
)
≈≈0 1
;
≈≈1 2
return
∆∆ 
new
∆∆ 
OperationResult
∆∆ *
(
∆∆* +
new
∆∆+ .!
ExistenciaException
∆∆/ B
(
∆∆B C
ex
∆∆C E
,
∆∆E F
(
∆∆G H

Existencia
∆∆H R
)
∆∆R S
entries
∆∆S Z
.
∆∆Z [
Entity
∆∆[ a
,
∆∆a b
null
∆∆c g
)
∆∆g h
)
∆∆h i
;
∆∆i j
}
»» 
catch
…… 
(
…… 
	Exception
…… 
e
…… 
)
…… 
{
   
throw
ÀÀ 
new
ÀÀ 
DatosException
ÀÀ (
(
ÀÀ( )
$str
ÀÀ) G
,
ÀÀG H
e
ÀÀI J
)
ÀÀJ K
;
ÀÀK L
}
ÃÃ 
}
ÕÕ 	
public
œœ 
OperationResult
œœ 4
&CrearEstadoTransaccionActualizarCuotas
œœ E
(
œœE F 
Estado_transaccion
œœF X
estadoTransaccion
œœY j
,
œœj k
List
œœl p
<
œœp q
Cuota
œœq v
>
œœv w
cuotas
œœx ~
)
œœ~ 
{
–– 	
try
—— 
{
““ 
_db
”” 
.
””  
Estado_transaccion
”” &
.
””& '
Add
””' *
(
””* +
estadoTransaccion
””+ <
)
””< =
;
””= >
foreach
‘‘ 
(
‘‘ 
var
‘‘ 
item
‘‘ !
in
‘‘" $
cuotas
‘‘% +
)
‘‘+ ,
{
’’ 
Cuota
÷÷ 
dbCuota
÷÷ !
=
÷÷" #
_db
÷÷$ '
.
÷÷' (
Cuota
÷÷( -
.
÷÷- .
Single
÷÷. 4
(
÷÷4 5
m
÷÷5 6
=>
÷÷7 9
m
÷÷: ;
.
÷÷; <
id
÷÷< >
==
÷÷? A
item
÷÷B F
.
÷÷F G
id
÷÷G I
)
÷÷I J
;
÷÷J K
_db
◊◊ 
.
◊◊ 
Entry
◊◊ 
(
◊◊ 
dbCuota
◊◊ %
)
◊◊% &
.
◊◊& '
CurrentValues
◊◊' 4
.
◊◊4 5
	SetValues
◊◊5 >
(
◊◊> ?
item
◊◊? C
)
◊◊C D
;
◊◊D E
}
ÿÿ 
var
ŸŸ 
result
ŸŸ 
=
ŸŸ 
Save
ŸŸ !
(
ŸŸ! "
)
ŸŸ" #
;
ŸŸ# $
result
⁄⁄ 
.
⁄⁄ 
data
⁄⁄ 
=
⁄⁄ 
estadoTransaccion
⁄⁄ /
.
⁄⁄/ 0
id_transaccion
⁄⁄0 >
;
⁄⁄> ?
return
€€ 
result
€€ 
;
€€ 
}
‹‹ 
catch
›› 
(
›› 
	Exception
›› 
e
›› 
)
›› 
{
ﬁﬁ 
return
ﬂﬂ 
new
ﬂﬂ 
OperationResult
ﬂﬂ *
(
ﬂﬂ* +
e
ﬂﬂ+ ,
)
ﬂﬂ, -
;
ﬂﬂ- .
}
‡‡ 
}
·· 	
public
„„ 
OperationResult
„„ 6
(CrearTransaccionesYActualizarExistencias
„„ G
(
„„G H
List
„„H L
<
„„L M
Transaccion
„„M X
>
„„X Y
transacciones
„„Z g
,
„„g h
List
„„i m
<
„„m n

Existencia
„„n x
>
„„x y
existencias„„z Ö
)„„Ö Ü
{
‰‰ 	
try
ÂÂ 
{
ÊÊ 
_db
ÁÁ 
.
ÁÁ 
Transaccion
ÁÁ 
.
ÁÁ  
AddRange
ÁÁ  (
(
ÁÁ( )
transacciones
ÁÁ) 6
)
ÁÁ6 7
;
ÁÁ7 8&
SetActualizarExistencias
ËË (
(
ËË( )
existencias
ËË) 4
)
ËË4 5
;
ËË5 6
var
ÈÈ 
result
ÈÈ 
=
ÈÈ 
Save
ÈÈ !
(
ÈÈ! "
)
ÈÈ" #
;
ÈÈ# $
result
ÍÍ 
.
ÍÍ 
data
ÍÍ 
=
ÍÍ 
$num
ÍÍ 
;
ÍÍ  
return
ÎÎ 
result
ÎÎ 
;
ÎÎ 
}
ÏÏ 
catch
ÌÌ 
(
ÌÌ *
DbUpdateConcurrencyException
ÌÌ /
ex
ÌÌ0 2
)
ÌÌ2 3
{
ÓÓ 
var
ÔÔ 
entries
ÔÔ 
=
ÔÔ 
ex
ÔÔ  
.
ÔÔ  !
Entries
ÔÔ! (
.
ÔÔ( )
Single
ÔÔ) /
(
ÔÔ/ 0
)
ÔÔ0 1
;
ÔÔ1 2
return
 
new
 
OperationResult
 *
(
* +
new
+ .!
ExistenciaException
/ B
(
B C
ex
C E
,
E F
(
G H

Existencia
H R
)
R S
entries
S Z
.
Z [
Entity
[ a
,
a b
null
c g
)
g h
)
h i
;
i j
}
ÚÚ 
catch
ÛÛ 
(
ÛÛ 
	Exception
ÛÛ 
e
ÛÛ 
)
ÛÛ 
{
ÙÙ 
throw
ıı 
e
ıı 
;
ıı 
}
ˆˆ 
}
˜˜ 	
public
˘˘ 
OperationResult
˘˘ A
3CrearTransaccionAgregarEstadoYActualizarExistencias
˘˘ R
(
˘˘R S
Transaccion
˘˘S ^
transaccion
˘˘_ j
,
˘˘j k
List
˘˘l p
<
˘˘p q

Existencia
˘˘q {
>
˘˘{ |
existencias˘˘} à
,˘˘à â"
Estado_transaccion˘˘ä ú
estado˘˘ù £
)˘˘£ §
{
˙˙ 	
try
˚˚ 
{
¸¸ 
_db
˝˝ 
.
˝˝ 
Transaccion
˝˝ 
.
˝˝  
Add
˝˝  #
(
˝˝# $
transaccion
˝˝$ /
)
˝˝/ 0
;
˝˝0 1
_db
˛˛ 
.
˛˛  
Estado_transaccion
˛˛ &
.
˛˛& '
Add
˛˛' *
(
˛˛* +
estado
˛˛+ 1
)
˛˛1 2
;
˛˛2 3&
SetActualizarExistencias
ˇˇ (
(
ˇˇ( )
existencias
ˇˇ) 4
)
ˇˇ4 5
;
ˇˇ5 6
var
ÄÄ 
result
ÄÄ 
=
ÄÄ 
Save
ÄÄ !
(
ÄÄ! "
)
ÄÄ" #
;
ÄÄ# $
result
ÅÅ 
.
ÅÅ 
data
ÅÅ 
=
ÅÅ 
transaccion
ÅÅ )
.
ÅÅ) *
id
ÅÅ* ,
;
ÅÅ, -
return
ÇÇ 
result
ÇÇ 
;
ÇÇ 
}
ÉÉ 
catch
ÑÑ 
(
ÑÑ *
DbUpdateConcurrencyException
ÑÑ /
ex
ÑÑ0 2
)
ÑÑ2 3
{
ÖÖ 
var
ÜÜ 
entries
ÜÜ 
=
ÜÜ 
ex
ÜÜ  
.
ÜÜ  !
Entries
ÜÜ! (
.
ÜÜ( )
Single
ÜÜ) /
(
ÜÜ/ 0
)
ÜÜ0 1
;
ÜÜ1 2
return
áá 
new
áá 
OperationResult
áá *
(
áá* +
new
áá+ .!
ExistenciaException
áá/ B
(
ááB C
ex
ááC E
,
ááE F
(
ááG H

Existencia
ááH R
)
ááR S
entries
ááS Z
.
ááZ [
Entity
áá[ a
,
ááa b
transaccion
áác n
)
áán o
)
ááo p
;
ááp q
}
ââ 
catch
ää 
(
ää 
	Exception
ää 
e
ää 
)
ää 
{
ãã 
throw
åå 
e
åå 
;
åå 
}
çç 
}
éé 	
public
êê 
OperationResult
êê A
3CrearTransaccionAgregarEstadoYActualizarExistencias
êê R
(
êêR S
Transaccion
êêS ^
transaccion
êê_ j
,
êêj k
List
êêl p
<
êêp q

Existencia
êêq {
>
êê{ |
existenciasêê} à
,êêà â"
Estado_transaccionêêä ú!
estadoTransaccionêêù Æ
,êêÆ Ø
Listêê∞ ¥
<êê¥ µ
Estado_cuotaêêµ ¡
>êê¡ ¬
estadosCuotasêê√ –
)êê– —
{
ëë 	
try
íí 
{
ìì 
_db
îî 
.
îî 
Transaccion
îî 
.
îî  
Add
îî  #
(
îî# $
transaccion
îî$ /
)
îî/ 0
;
îî0 1
_db
ïï 
.
ïï  
Estado_transaccion
ïï &
.
ïï& '
Add
ïï' *
(
ïï* +
estadoTransaccion
ïï+ <
)
ïï< =
;
ïï= >
foreach
ññ 
(
ññ 
var
ññ 
estadosCuota
ññ )
in
ññ* ,
estadosCuotas
ññ- :
)
ññ: ;
{
óó 
_db
òò 
.
òò 
Estado_cuota
òò $
.
òò$ %
Add
òò% (
(
òò( )
estadosCuota
òò) 5
)
òò5 6
;
òò6 7
}
ôô &
SetActualizarExistencias
öö (
(
öö( )
existencias
öö) 4
)
öö4 5
;
öö5 6
var
õõ 
result
õõ 
=
õõ 
Save
õõ !
(
õõ! "
)
õõ" #
;
õõ# $
result
úú 
.
úú 
data
úú 
=
úú 
transaccion
úú )
.
úú) *
id
úú* ,
;
úú, -
return
ùù 
result
ùù 
;
ùù 
}
ûû 
catch
üü 
(
üü *
DbUpdateConcurrencyException
üü /
ex
üü0 2
)
üü2 3
{
†† 
var
°° 
entries
°° 
=
°° 
ex
°°  
.
°°  !
Entries
°°! (
.
°°( )
Single
°°) /
(
°°/ 0
)
°°0 1
;
°°1 2
return
¢¢ 
new
¢¢ 
OperationResult
¢¢ *
(
¢¢* +
new
¢¢+ .!
ExistenciaException
¢¢/ B
(
¢¢B C
ex
¢¢C E
,
¢¢E F
(
¢¢G H

Existencia
¢¢H R
)
¢¢R S
entries
¢¢S Z
.
¢¢Z [
Entity
¢¢[ a
,
¢¢a b
transaccion
¢¢c n
)
¢¢n o
)
¢¢o p
;
¢¢p q
}
££ 
catch
§§ 
(
§§ 
	Exception
§§ 
e
§§ 
)
§§ 
{
•• 
throw
¶¶ 
e
¶¶ 
;
¶¶ 
}
ßß 
}
®® 	
public
™™ 
OperationResult
™™ 9
+ActualizarTransaccionYActualizarExistencias
™™ J
(
™™J K
Transaccion
™™K V
transaccion
™™W b
,
™™b c
List
™™d h
<
™™h i

Existencia
™™i s
>
™™s t
existencias™™u Ä
)™™Ä Å
{
´´ 	
try
¨¨ 
{
≠≠ 
Transaccion
ÆÆ 
dbTransaccion
ÆÆ )
=
ÆÆ* +
_db
ÆÆ, /
.
ÆÆ/ 0
Transaccion
ÆÆ0 ;
.
ÆÆ; <
Single
ÆÆ< B
(
ÆÆB C
m
ÆÆC D
=>
ÆÆE G
m
ÆÆH I
.
ÆÆI J
id
ÆÆJ L
==
ÆÆM O
transaccion
ÆÆP [
.
ÆÆ[ \
id
ÆÆ\ ^
)
ÆÆ^ _
;
ÆÆ_ `
_db
ØØ 
.
ØØ 
Entry
ØØ 
(
ØØ 
dbTransaccion
ØØ '
)
ØØ' (
.
ØØ( )
CurrentValues
ØØ) 6
.
ØØ6 7
	SetValues
ØØ7 @
(
ØØ@ A
transaccion
ØØA L
)
ØØL M
;
ØØM N&
SetActualizarExistencias
∞∞ (
(
∞∞( )
existencias
∞∞) 4
)
∞∞4 5
;
∞∞5 6
var
±± 
result
±± 
=
±± 
Save
±± !
(
±±! "
)
±±" #
;
±±# $
result
≤≤ 
.
≤≤ 
data
≤≤ 
=
≤≤ 
transaccion
≤≤ )
.
≤≤) *
id
≤≤* ,
;
≤≤, -
return
≥≥ 
result
≥≥ 
;
≥≥ 
}
¥¥ 
catch
µµ 
(
µµ *
DbUpdateConcurrencyException
µµ /
ex
µµ0 2
)
µµ2 3
{
∂∂ 
var
∑∑ 
entries
∑∑ 
=
∑∑ 
ex
∑∑  
.
∑∑  !
Entries
∑∑! (
.
∑∑( )
Single
∑∑) /
(
∑∑/ 0
)
∑∑0 1
;
∑∑1 2
return
∏∏ 
new
∏∏ 
OperationResult
∏∏ *
(
∏∏* +
new
∏∏+ .!
ExistenciaException
∏∏/ B
(
∏∏B C
ex
∏∏C E
,
∏∏E F
(
∏∏G H

Existencia
∏∏H R
)
∏∏R S
entries
∏∏S Z
.
∏∏Z [
Entity
∏∏[ a
,
∏∏a b
transaccion
∏∏c n
)
∏∏n o
)
∏∏o p
;
∏∏p q
}
ππ 
catch
∫∫ 
(
∫∫ 
	Exception
∫∫ 
e
∫∫ 
)
∫∫ 
{
ªª 
throw
ºº 
e
ºº 
;
ºº 
}
ΩΩ 
}
ææ 	
public
…… 
OperationResult
…… 5
'CrearTransaccionYCrearEstadoTransaccion
…… F
(
……F G
Transaccion
……G R
transaccion
……S ^
,
……^ _ 
Estado_transaccion
……` r 
estadoTransaccion……s Ñ
)……Ñ Ö
{
   	
try
ÀÀ 
{
ÃÃ 
if
ÕÕ 
(
ÕÕ 
transaccion
ÕÕ 
!=
ÕÕ  "
null
ÕÕ# '
)
ÕÕ' (
{
ŒŒ 
_db
œœ 
.
œœ 
Transaccion
œœ #
.
œœ# $
Add
œœ$ '
(
œœ' (
transaccion
œœ( 3
)
œœ3 4
;
œœ4 5
}
–– 
if
—— 
(
—— 
estadoTransaccion
—— %
!=
——& (
null
——) -
)
——- .
{
““ 
_db
”” 
.
””  
Estado_transaccion
”” *
.
””* +
Add
””+ .
(
””. /
estadoTransaccion
””/ @
)
””@ A
;
””A B
}
‘‘ 
return
’’ 
Save
’’ 
(
’’ 
)
’’ 
;
’’ 
}
÷÷ 
catch
◊◊ 
(
◊◊ 
	Exception
◊◊ 
e
◊◊ 
)
◊◊ 
{
ÿÿ 
throw
ŸŸ 
e
ŸŸ 
;
ŸŸ 
}
⁄⁄ 
}
€€ 	
public
ÂÂ 
OperationResult
ÂÂ 
ActualizarYCrear
ÂÂ /
(
ÂÂ/ 0
Transaccion
ÂÂ0 ;$
transaccionAActualizar
ÂÂ< R
,
ÂÂR S
Transaccion
ÂÂT _
transaccionACrear
ÂÂ` q
,
ÂÂq r
List
ÂÂs w
<
ÂÂw x!
Estado_transaccionÂÂx ä
>ÂÂä ã*
estadosTransaccionesACrearÂÂå ¶
,ÂÂ¶ ß
ListÂÂ® ¨
<ÂÂ¨ ≠
Estado_cuotaÂÂ≠ π
>ÂÂπ ∫#
estadosCuotasACrearÂÂª Œ
)ÂÂŒ œ
{
ÊÊ 	
try
ÁÁ 
{
ËË 
if
ÈÈ 
(
ÈÈ $
transaccionAActualizar
ÈÈ *
!=
ÈÈ+ -
null
ÈÈ. 2
)
ÈÈ2 3
{
ÍÍ 
Transaccion
ÎÎ 
dbTransaccion
ÎÎ  -
=
ÎÎ. /
_db
ÎÎ0 3
.
ÎÎ3 4
Transaccion
ÎÎ4 ?
.
ÎÎ? @
Single
ÎÎ@ F
(
ÎÎF G
m
ÎÎG H
=>
ÎÎI K
m
ÎÎL M
.
ÎÎM N
id
ÎÎN P
==
ÎÎQ S$
transaccionAActualizar
ÎÎT j
.
ÎÎj k
id
ÎÎk m
)
ÎÎm n
;
ÎÎn o
_db
ÏÏ 
.
ÏÏ 
Entry
ÏÏ 
(
ÏÏ 
dbTransaccion
ÏÏ +
)
ÏÏ+ ,
.
ÏÏ, -
CurrentValues
ÏÏ- :
.
ÏÏ: ;
	SetValues
ÏÏ; D
(
ÏÏD E$
transaccionAActualizar
ÏÏE [
)
ÏÏ[ \
;
ÏÏ\ ]
}
ÌÌ 
if
ÓÓ 
(
ÓÓ 
transaccionACrear
ÓÓ %
!=
ÓÓ& (
null
ÓÓ) -
)
ÓÓ- .
{
ÔÔ 
_db
 
.
 
Transaccion
 #
.
# $
Add
$ '
(
' (
transaccionACrear
( 9
)
9 :
;
: ;
}
ÒÒ 
if
ÚÚ 
(
ÚÚ (
estadosTransaccionesACrear
ÚÚ .
!=
ÚÚ/ 1
null
ÚÚ2 6
)
ÚÚ6 7
{
ÛÛ 
foreach
ÙÙ 
(
ÙÙ 
var
ÙÙ  
estadoTransaccion
ÙÙ! 2
in
ÙÙ3 5(
estadosTransaccionesACrear
ÙÙ6 P
)
ÙÙP Q
{
ıı 
_db
ˆˆ 
.
ˆˆ  
Estado_transaccion
ˆˆ .
.
ˆˆ. /
Add
ˆˆ/ 2
(
ˆˆ2 3
estadoTransaccion
ˆˆ3 D
)
ˆˆD E
;
ˆˆE F
}
˜˜ 
}
¯¯ 
if
˘˘ 
(
˘˘ !
estadosCuotasACrear
˘˘ '
!=
˘˘( *
null
˘˘+ /
)
˘˘/ 0
{
˙˙ 
foreach
˚˚ 
(
˚˚ 
var
˚˚  
estadoCuota
˚˚! ,
in
˚˚- /!
estadosCuotasACrear
˚˚0 C
)
˚˚C D
{
¸¸ 
_db
˝˝ 
.
˝˝ 
Estado_cuota
˝˝ (
.
˝˝( )
Add
˝˝) ,
(
˝˝, -
estadoCuota
˝˝- 8
)
˝˝8 9
;
˝˝9 :
}
˛˛ 
}
ˇˇ 
return
ÄÄ 
Save
ÄÄ 
(
ÄÄ 
)
ÄÄ 
;
ÄÄ 
}
ÅÅ 
catch
ÇÇ 
(
ÇÇ 
	Exception
ÇÇ 
e
ÇÇ 
)
ÇÇ 
{
ÉÉ 
throw
ÑÑ 
e
ÑÑ 
;
ÑÑ 
}
ÖÖ 
}
ÜÜ 	
public
èè 
OperationResult
èè '
CrearTransacionesYEstados
èè 8
(
èè8 9
List
èè9 =
<
èè= >
Transaccion
èè> I
>
èèI J!
transaccionesACrear
èèK ^
,
èè^ _
List
èè` d
<
èèd e 
Estado_transaccion
èèe w
>
èèw x)
estadosTransaccionesACrearèèy ì
,èèì î
Listèèï ô
<èèô ö
Estado_cuotaèèö ¶
>èè¶ ß#
estadosCuotasACrearèè® ª
)èèª º
{
êê 	
try
ëë 
{
íí 
if
ìì 
(
ìì !
transaccionesACrear
ìì '
!=
ìì( *
null
ìì+ /
)
ìì/ 0
{
îî 
foreach
ïï 
(
ïï 
var
ïï  
transaccion
ïï! ,
in
ïï- /!
transaccionesACrear
ïï0 C
)
ïïC D
{
ññ 
_db
óó 
.
óó 
Transaccion
óó '
.
óó' (
Add
óó( +
(
óó+ ,
transaccion
óó, 7
)
óó7 8
;
óó8 9
}
òò 
}
ôô 
if
öö 
(
öö (
estadosTransaccionesACrear
öö .
!=
öö/ 1
null
öö2 6
)
öö6 7
{
õõ 
foreach
úú 
(
úú 
var
úú  
estadoTransaccion
úú! 2
in
úú3 5(
estadosTransaccionesACrear
úú6 P
)
úúP Q
{
ùù 
_db
ûû 
.
ûû  
Estado_transaccion
ûû .
.
ûû. /
Add
ûû/ 2
(
ûû2 3
estadoTransaccion
ûû3 D
)
ûûD E
;
ûûE F
}
üü 
}
†† 
if
°° 
(
°° !
estadosCuotasACrear
°° '
!=
°°( *
null
°°+ /
)
°°/ 0
{
¢¢ 
foreach
££ 
(
££ 
var
££  
estadoCuota
££! ,
in
££- /!
estadosCuotasACrear
££0 C
)
££C D
{
§§ 
_db
•• 
.
•• 
Estado_cuota
•• (
.
••( )
Add
••) ,
(
••, -
estadoCuota
••- 8
)
••8 9
;
••9 :
}
¶¶ 
}
ßß 
return
®® 
Save
®® 
(
®® 
)
®® 
;
®® 
}
©© 
catch
™™ 
(
™™ 
	Exception
™™ 
e
™™ 
)
™™ 
{
´´ 
throw
¨¨ 
e
¨¨ 
;
¨¨ 
}
≠≠ 
}
ÆÆ 	
public
∞∞ 
OperationResult
∞∞ '
CrearTransacionesYEstados
∞∞ 8
(
∞∞8 9
List
∞∞9 =
<
∞∞= >
Transaccion
∞∞> I
>
∞∞I J!
transaccionesACrear
∞∞K ^
,
∞∞^ _
List
∞∞` d
<
∞∞d e 
Estado_transaccion
∞∞e w
>
∞∞w x)
estadosTransaccionesACrear∞∞y ì
,∞∞ì î
List∞∞ï ô
<∞∞ô ö
Estado_cuota∞∞ö ¶
>∞∞¶ ß#
estadosCuotasACrear∞∞® ª
,∞∞ª º
List∞∞Ω ¡
<∞∞¡ ¬#
Detalle_transaccion∞∞¬ ’
>∞∞’ ÷&
updDetallesTransaccion∞∞◊ Ì
,∞∞Ì Ó
int∞∞Ô Ú9
)idActorNegocioInternoTransaccionExistente∞∞Û ú
,∞∞ú ù
int∞∞û °*
idTipoTransaccionExistente∞∞¢ º
,∞∞º Ω
int∞∞æ ¡2
"idUltimoEstadoTransaccionExsitente∞∞¬ ‰
,∞∞‰ Â
bool∞∞Ê Í$
debeAumentarCantidad∞∞Î ˇ
)∞∞ˇ Ä
{
±± 	
try
≤≤ 
{
≥≥ 
if
¥¥ 
(
¥¥ !
transaccionesACrear
¥¥ '
!=
¥¥( *
null
¥¥+ /
)
¥¥/ 0
{
µµ 
foreach
∂∂ 
(
∂∂ 
var
∂∂  
transaccion
∂∂! ,
in
∂∂- /!
transaccionesACrear
∂∂0 C
)
∂∂C D
{
∑∑ 
_db
∏∏ 
.
∏∏ 
Transaccion
∏∏ '
.
∏∏' (
Add
∏∏( +
(
∏∏+ ,
transaccion
∏∏, 7
)
∏∏7 8
;
∏∏8 9
}
ππ 
}
∫∫ 
if
ªª 
(
ªª (
estadosTransaccionesACrear
ªª .
!=
ªª/ 1
null
ªª2 6
)
ªª6 7
{
ºº 
foreach
ΩΩ 
(
ΩΩ 
var
ΩΩ  
estadoTransaccion
ΩΩ! 2
in
ΩΩ3 5(
estadosTransaccionesACrear
ΩΩ6 P
)
ΩΩP Q
{
ææ 
_db
øø 
.
øø  
Estado_transaccion
øø .
.
øø. /
Add
øø/ 2
(
øø2 3
estadoTransaccion
øø3 D
)
øøD E
;
øøE F
}
¿¿ 
}
¡¡ 
if
¬¬ 
(
¬¬ !
estadosCuotasACrear
¬¬ '
!=
¬¬( *
null
¬¬+ /
)
¬¬/ 0
{
√√ 
foreach
ƒƒ 
(
ƒƒ 
var
ƒƒ  
estadoCuota
ƒƒ! ,
in
ƒƒ- /!
estadosCuotasACrear
ƒƒ0 C
)
ƒƒC D
{
≈≈ 
_db
∆∆ 
.
∆∆ 
Estado_cuota
∆∆ (
.
∆∆( )
Add
∆∆) ,
(
∆∆, -
estadoCuota
∆∆- 8
)
∆∆8 9
;
∆∆9 :
}
«« 
}
»» 
var
ÃÃ #
idsConceptoNegocioUpd
ÃÃ )
=
ÃÃ* +$
updDetallesTransaccion
ÃÃ, B
.
ÃÃB C
Select
ÃÃC I
(
ÃÃI J
vdu
ÃÃJ M
=>
ÃÃN P
vdu
ÃÃQ T
.
ÃÃT U!
id_concepto_negocio
ÃÃU h
)
ÃÃh i
;
ÃÃi j
Transaccion
œœ $
dbTransaccionExistente
œœ 2
=
œœ3 4
_db
œœ5 8
.
œœ8 9
Transaccion
œœ9 D
.
œœD E
Include
œœE L
(
œœL M
t
œœM N
=>
œœO Q
t
œœR S
.
œœS T!
Detalle_transaccion
œœT g
)
œœg h
.
œœh i
SingleOrDefault
œœi x
(
œœx y
t
œœy z
=>
œœ{ }
t
œœ~ 
.œœ Ä(
id_actor_negocio_internoœœÄ ò
==œœô õ9
)idActorNegocioInternoTransaccionExistenteœœú ≈
&&
––8 :
t
––; <
.
––< =!
id_tipo_transaccion
––= P
==
––Q S(
idTipoTransaccionExistente
––T n
&&
——8 :
t
——; <
.
——< =
id_estado_actual
——= M
==
——N P0
"idUltimoEstadoTransaccionExsitente
——Q s
)
——s t
;
——t u
List
‘‘ 
<
‘‘ !
Detalle_transaccion
‘‘ (
>
‘‘( )*
dbDetallesTransaccionDestino
‘‘* F
=
‘‘G H$
dbTransaccionExistente
‘‘I _
.
‘‘_ `!
Detalle_transaccion
‘‘` s
.
‘‘s t
Where
‘‘t y
(
‘‘y z
dt
‘‘z |
=>
‘‘} %
idsConceptoNegocioUpd‘‘Ä ï
.‘‘ï ñ
Contains‘‘ñ û
(‘‘û ü
dt‘‘ü °
.‘‘° ¢#
id_concepto_negocio‘‘¢ µ
)‘‘µ ∂
)‘‘∂ ∑
.‘‘∑ ∏
ToList‘‘∏ æ
(‘‘æ ø
)‘‘ø ¿
;‘‘¿ ¡
foreach
◊◊ 
(
◊◊ 
var
◊◊ #
updDetalleTransaccion
◊◊ 2
in
◊◊3 5$
updDetallesTransaccion
◊◊6 L
)
◊◊L M
{
ÿÿ 
bool
⁄⁄ 
	tieneLote
⁄⁄ "
=
⁄⁄# $
!
⁄⁄% &
String
⁄⁄& ,
.
⁄⁄, -
IsNullOrEmpty
⁄⁄- :
(
⁄⁄: ;#
updDetalleTransaccion
⁄⁄; P
.
⁄⁄P Q
lote
⁄⁄Q U
)
⁄⁄U V
;
⁄⁄V W
var
›› +
dbDetalleTransaccionExistente
›› 5
=
››6 7*
dbDetallesTransaccionDestino
››8 T
.
››T U
SingleOrDefault
››U d
(
››d e
dbdt
››e i
=>
››j l
dbdt
››m q
.
››q r"
id_concepto_negocio››r Ö
==››Ü à%
updDetalleTransaccion››â û
.››û ü#
id_concepto_negocio››ü ≤
&&››≥ µ
(››∂ ∑
(››∑ ∏
!››∏ π
	tieneLote››π ¬
&&››√ ≈
String››∆ Ã
.››Ã Õ
IsNullOrEmpty››Õ ⁄
(››⁄ €
dbdt››€ ﬂ
.››ﬂ ‡
lote››‡ ‰
)››‰ Â
)››Â Ê
||››Á È
(››Í Î
	tieneLote››Î Ù
&&››ı ˜
dbdt››¯ ¸
.››¸ ˝
lote››˝ Å
==››Ç Ñ%
updDetalleTransaccion››Ö ö
.››ö õ
lote››õ ü
)››ü †
)››† °
)››° ¢
;››¢ £
if
‡‡ 
(
‡‡ +
dbDetalleTransaccionExistente
‡‡ 5
!=
‡‡6 8
null
‡‡9 =
)
‡‡= >
{
·· +
dbDetalleTransaccionExistente
„„ 5
.
„„5 6
cantidad
„„6 >
+=
„„? A"
debeAumentarCantidad
„„B V
?
„„W X#
updDetalleTransaccion
„„Y n
.
„„n o
cantidad
„„o w
:
„„x y
(
„„z {$
updDetalleTransaccion„„{ ê
.„„ê ë
cantidad„„ë ô
*„„ö õ
-„„ú ù
$num„„ù û
)„„û ü
;„„ü †
}
‰‰ 
else
ÂÂ 
{
ÊÊ $
dbTransaccionExistente
ËË .
.
ËË. /!
Detalle_transaccion
ËË/ B
.
ËËB C
Add
ËËC F
(
ËËF G#
updDetalleTransaccion
ËËG \
)
ËË\ ]
;
ËË] ^
}
ÈÈ 
if
ÏÏ 
(
ÏÏ #
updDetalleTransaccion
ÏÏ -
.
ÏÏ- .7
)Valor_detalle_maestro_detalle_transaccion
ÏÏ. W
!=
ÏÏX Z
null
ÏÏ[ _
)
ÏÏ_ `
{
ÌÌ 
var
ÔÔ 
updValorDetalles
ÔÔ ,
=
ÔÔ- .#
updDetalleTransaccion
ÔÔ/ D
.
ÔÔD E7
)Valor_detalle_maestro_detalle_transaccion
ÔÔE n
.
ÔÔn o
ToList
ÔÔo u
(
ÔÔu v
)
ÔÔv w
;
ÔÔw x
var
ÒÒ 
dbValoresDetalles
ÒÒ -
=
ÒÒ. /+
dbDetalleTransaccionExistente
ÒÒ0 M
.
ÒÒM N7
)Valor_detalle_maestro_detalle_transaccion
ÒÒN w
;
ÒÒw x
foreach
ÛÛ 
(
ÛÛ  !
var
ÛÛ! $
valorDetalleUpd
ÛÛ% 4
in
ÛÛ5 7
updValorDetalles
ÛÛ8 H
)
ÛÛH I
{
ÙÙ 
if
ıı 
(
ıı  "
debeAumentarCantidad
ıı  4
)
ıı4 5
{
ˆˆ +
dbDetalleTransaccionExistente
˜˜  =
.
˜˜= >7
)Valor_detalle_maestro_detalle_transaccion
˜˜> g
.
˜˜g h
Add
˜˜h k
(
˜˜k l
valorDetalleUpd
˜˜l {
.
˜˜{ |
Clone˜˜| Å
(˜˜Å Ç
)˜˜Ç É
)˜˜É Ñ
;˜˜Ñ Ö
}
¯¯ 
else
˘˘  
{
˙˙ 
dbValoresDetalles
˚˚  1
.
˚˚1 2
SingleOrDefault
˚˚2 A
(
˚˚A B
dbvd
˚˚B F
=>
˚˚G I
dbvd
˚˚J N
.
˚˚N O
id
˚˚O Q
==
˚˚R T
valorDetalleUpd
˚˚U d
.
˚˚d e
id
˚˚e g
)
˚˚g h
.
˚˚h i!
Detalle_transaccion
˚˚i |
=
˚˚} ~$
updDetalleTransaccion˚˚ î
;˚˚î ï
}
¸¸ 
}
˛˛ 
}
ˇˇ 
}
ÄÄ 
OperationResult
ÅÅ 
result
ÅÅ  &
=
ÅÅ' (
Save
ÅÅ) -
(
ÅÅ- .
)
ÅÅ. /
;
ÅÅ/ 0
return
ÇÇ 
result
ÇÇ 
;
ÇÇ 
}
ÉÉ 
catch
ÑÑ 
(
ÑÑ 
	Exception
ÑÑ 
e
ÑÑ 
)
ÑÑ 
{
ÖÖ 
throw
ÜÜ 
e
ÜÜ 
;
ÜÜ 
}
áá 
}
àà 	
public
ìì 
OperationResult
ìì <
.CrearTransacionYEstadoTransaccionYEstadosCuota
ìì M
(
ììM N
Transaccion
ììN Y
transaccionACrear
ììZ k
,
ììk l 
Estado_transaccion
ììm '
estadoTransaccionACrearììÄ ó
,ììó ò
Listììô ù
<ììù û
Estado_cuotaììû ™
>ìì™ ´#
estadosCuotasACrearìì¨ ø
)ììø ¿
{
îî 	
try
ïï 
{
ññ 
_db
óó 
.
óó 
Transaccion
óó 
.
óó  
Add
óó  #
(
óó# $
transaccionACrear
óó$ 5
)
óó5 6
;
óó6 7
_db
òò 
.
òò  
Estado_transaccion
òò &
.
òò& '
Add
òò' *
(
òò* +%
estadoTransaccionACrear
òò+ B
)
òòB C
;
òòC D
if
ôô 
(
ôô !
estadosCuotasACrear
ôô '
!=
ôô( *
null
ôô+ /
)
ôô/ 0
{
öö 
foreach
õõ 
(
õõ 
var
õõ  
estadoCuota
õõ! ,
in
õõ- /!
estadosCuotasACrear
õõ0 C
)
õõC D
{
úú 
_db
ùù 
.
ùù 
Estado_cuota
ùù (
.
ùù( )
Add
ùù) ,
(
ùù, -
estadoCuota
ùù- 8
)
ùù8 9
;
ùù9 :
}
ûû 
}
üü 
return
†† 
Save
†† 
(
†† 
)
†† 
;
†† 
}
°° 
catch
¢¢ 
(
¢¢ 
	Exception
¢¢ 
e
¢¢ 
)
¢¢ 
{
££ 
throw
§§ 
e
§§ 
;
§§ 
}
•• 
}
¶¶ 	
public
®® 
OperationResult
®® 5
'CrearEstadoTransaccionYCrearEstadoCuota
®® F
(
®®F G
List
®®G K
<
®®K L 
Estado_transaccion
®®L ^
>
®®^ _!
estadoTransacciones
®®` s
,
®®s t
List
®®u y
<
®®y z
Estado_cuota®®z Ü
>®®Ü á
estadoCuotas®®à î
)®®î ï
{
©© 	
try
™™ 
{
´´ 
foreach
¨¨ 
(
¨¨ 
var
¨¨ 
estadoTransaccion
¨¨ .
in
¨¨/ 1!
estadoTransacciones
¨¨2 E
)
¨¨E F
{
≠≠ 
_db
ÆÆ 
.
ÆÆ  
Estado_transaccion
ÆÆ *
.
ÆÆ* +
Add
ÆÆ+ .
(
ÆÆ. /
estadoTransaccion
ÆÆ/ @
)
ÆÆ@ A
;
ÆÆA B
}
ØØ 
foreach
∞∞ 
(
∞∞ 
var
∞∞ 
estadoCuota
∞∞ (
in
∞∞) +
estadoCuotas
∞∞, 8
)
∞∞8 9
{
±± 
_db
≤≤ 
.
≤≤ 
Estado_cuota
≤≤ $
.
≤≤$ %
Add
≤≤% (
(
≤≤( )
estadoCuota
≤≤) 4
)
≤≤4 5
;
≤≤5 6
}
≥≥ 
return
¥¥ 
Save
¥¥ 
(
¥¥ 
)
¥¥ 
;
¥¥ 
}
µµ 
catch
∂∂ 
(
∂∂ 
	Exception
∂∂ 
e
∂∂ 
)
∂∂ 
{
∑∑ 
throw
∏∏ 
e
∏∏ 
;
∏∏ 
}
ππ 
}
∫∫ 	
public
ΩΩ 
OperationResult
ΩΩ #
ActualizarExistencias
ΩΩ 4
(
ΩΩ4 5
List
ΩΩ5 9
<
ΩΩ9 :

Existencia
ΩΩ: D
>
ΩΩD E
existencias
ΩΩF Q
)
ΩΩQ R
{
ææ 	
try
øø 
{
¿¿ &
SetActualizarExistencias
¡¡ (
(
¡¡( )
existencias
¡¡) 4
)
¡¡4 5
;
¡¡5 6
var
¬¬ 
result
¬¬ 
=
¬¬ 
Save
¬¬ !
(
¬¬! "
)
¬¬" #
;
¬¬# $
result
√√ 
.
√√ 
data
√√ 
=
√√ 
existencias
√√ )
.
√√) *
FirstOrDefault
√√* 8
(
√√8 9
)
√√9 :
.
√√: ;
id
√√; =
;
√√= >
return
ƒƒ 
result
ƒƒ 
;
ƒƒ 
}
≈≈ 
catch
∆∆ 
(
∆∆ 
	Exception
∆∆ 
e
∆∆ 
)
∆∆ 
{
«« 
throw
»» 
e
»» 
;
»» 
}
…… 
}
   	
private
ŒŒ 
void
ŒŒ &
SetActualizarExistencias
ŒŒ -
(
ŒŒ- .
List
ŒŒ. 2
<
ŒŒ2 3

Existencia
ŒŒ3 =
>
ŒŒ= >
existencias
ŒŒ? J
)
ŒŒJ K
{
œœ 	
int
–– 
[
–– 
]
–– 
idsConcepto
–– 
=
–– 
existencias
––  +
.
––+ ,
Select
––, 2
(
––2 3
e
––3 4
=>
––5 7
e
––8 9
.
––9 :!
id_concepto_negocio
––: M
)
––M N
.
––N O
ToArray
––O V
(
––V W
)
––W X
;
––X Y
foreach
““ 
(
““ 
var
““ 

existencia
““ #
in
““$ &
existencias
““' 2
)
““2 3
{
”” 
_db
‘‘ 
.
‘‘ 

Existencia
‘‘ 
.
‘‘ 
Attach
‘‘ %
(
‘‘% &

existencia
‘‘& 0
)
‘‘0 1
;
‘‘1 2
_db
’’ 
.
’’ 
Entry
’’ 
(
’’ 

existencia
’’ $
)
’’$ %
.
’’% &
State
’’& +
=
’’, -
EntityState
’’. 9
.
’’9 :
Modified
’’: B
;
’’B C
}
◊◊ 
}
ÿÿ 	
public
ŸŸ 
Transaccion
ŸŸ 0
"ObtenerTransaccionInclusiveEstados
ŸŸ =
(
ŸŸ= >
long
ŸŸ> B
id
ŸŸC E
)
ŸŸE F
{
⁄⁄ 	
try
€€ 
{
‹‹ 
return
›› 
_db
›› 
.
›› 
Transaccion
›› &
.
››& '
Include
››' .
(
››. /
st
››/ 1
=>
››2 4
st
››5 7
.
››7 8 
Estado_transaccion
››8 J
)
››J K
.
››K L
SingleOrDefault
››L [
(
››[ \
st
››\ ^
=>
››_ a
st
››b d
.
››d e
id
››e g
==
››h j
id
››k m
)
››m n
;
››n o
}
ﬁﬁ 
catch
ﬂﬂ 
(
ﬂﬂ 
	Exception
ﬂﬂ 
e
ﬂﬂ 
)
ﬂﬂ 
{
‡‡ 
throw
·· 
e
·· 
;
·· 
}
‚‚ 
}
„„ 	
public
ÂÂ 
Transaccion
ÂÂ M
?ObtenerTransaccionInclusiveEstadoTransaccionYDetalleTransaccion
ÂÂ Z
(
ÂÂZ [
long
ÂÂ[ _
id
ÂÂ` b
)
ÂÂb c
{
ÊÊ 	
try
ÁÁ 
{
ËË 
return
ÈÈ 
_db
ÈÈ 
.
ÈÈ 
Transaccion
ÈÈ &
.
ÈÈ& '
Include
ÈÈ' .
(
ÈÈ. /
st
ÈÈ/ 1
=>
ÈÈ2 4
st
ÈÈ5 7
.
ÈÈ7 8 
Estado_transaccion
ÈÈ8 J
)
ÈÈJ K
.
ÈÈK L
Include
ÈÈL S
(
ÈÈS T
st
ÈÈT V
=>
ÈÈW Y
st
ÈÈZ \
.
ÈÈ\ ]!
Detalle_transaccion
ÈÈ] p
)
ÈÈp q
.
ÈÈq r
SingleOrDefaultÈÈr Å
(ÈÈÅ Ç
stÈÈÇ Ñ
=>ÈÈÖ á
stÈÈà ä
.ÈÈä ã
idÈÈã ç
==ÈÈé ê
idÈÈë ì
)ÈÈì î
;ÈÈî ï
}
ÍÍ 
catch
ÎÎ 
(
ÎÎ 
	Exception
ÎÎ 
e
ÎÎ 
)
ÎÎ 
{
ÏÏ 
throw
ÌÌ 
e
ÌÌ 
;
ÌÌ 
}
ÓÓ 
}
ÔÔ 	
public
ÒÒ 
Transaccion
ÒÒ  
ObtenerTransaccion
ÒÒ -
(
ÒÒ- .
long
ÒÒ. 2
id
ÒÒ3 5
)
ÒÒ5 6
{
ÚÚ 	
try
ÛÛ 
{
ÙÙ 
return
ıı 
_db
ıı 
.
ıı 
Transaccion
ıı &
.
ıı& '
SingleOrDefault
ıı' 6
(
ıı6 7
st
ıı7 9
=>
ıı: <
st
ıı= ?
.
ıı? @
id
ıı@ B
==
ııC E
id
ııF H
)
ııH I
;
ııI J
}
ˆˆ 
catch
˜˜ 
(
˜˜ 
	Exception
˜˜ 
e
˜˜ 
)
˜˜ 
{
¯¯ 
throw
˘˘ 
e
˘˘ 
;
˘˘ 
}
˙˙ 
}
˚˚ 	
public
¸¸ !
Detalle_transaccion
¸¸ "'
ObtenerDetalleTransaccion
¸¸# <
(
¸¸< =
long
¸¸= A
id
¸¸B D
)
¸¸D E
{
˝˝ 	
try
˛˛ 
{
ˇˇ 
return
ÄÄ 
_db
ÄÄ 
.
ÄÄ !
Detalle_transaccion
ÄÄ .
.
ÄÄ. /
SingleOrDefault
ÄÄ/ >
(
ÄÄ> ?
st
ÄÄ? A
=>
ÄÄB D
st
ÄÄE G
.
ÄÄG H
id
ÄÄH J
==
ÄÄK M
id
ÄÄN P
)
ÄÄP Q
;
ÄÄQ R
}
ÅÅ 
catch
ÇÇ 
(
ÇÇ 
	Exception
ÇÇ 
e
ÇÇ 
)
ÇÇ 
{
ÉÉ 
throw
ÑÑ 
e
ÑÑ 
;
ÑÑ 
}
ÖÖ 
}
ÜÜ 	
public
àà 
Transaccion
àà H
:ObtenerTransaccionInclusiveEstadoTransaccionDetalleMaestro
àà U
(
ààU V
long
ààV Z
id
àà[ ]
)
àà] ^
{
ââ 	
try
ää 
{
ãã 
return
åå 
_db
åå 
.
åå 
Transaccion
åå &
.
åå& '
Include
åå' .
(
åå. /
t
åå/ 0
=>
åå1 3
t
åå4 5
.
åå5 6 
Estado_transaccion
åå6 H
)
ååH I
.
ååI J
Include
ååJ Q
(
ååQ R
t
ååR S
=>
ååT V
t
ååW X
.
ååX Y
Detalle_maestro
ååY h
)
ååh i
.
ååi j
Single
ååj p
(
ååp q
t
ååq r
=>
åås u
t
ååv w
.
ååw x
id
ååx z
==
åå{ }
idåå~ Ä
)ååÄ Å
;ååÅ Ç
}
çç 
catch
éé 
(
éé 
	Exception
éé 
e
éé 
)
éé 
{
èè 
throw
êê 
new
êê 
DatosException
êê (
(
êê( )
$str
êê) J
,
êêJ K
e
êêL M
)
êêM N
;
êêN O
}
ëë 
}
íí 	
public
ìì 
IEnumerable
ìì 
<
ìì 
Transaccion
ìì &
>
ìì& 'X
JObtenerTransacciones1DeTransaccionInclusiveEstadoTransaccionDetalleMaestro
ìì( r
(
ììr s
long
ììs w
id
ììx z
)
ììz {
{
îî 	
try
ïï 
{
ññ 
return
óó 
_db
óó 
.
óó 
Transaccion
óó &
.
óó& '
Include
óó' .
(
óó. /
t
óó/ 0
=>
óó1 3
t
óó4 5
.
óó5 6
Transaccion1
óó6 B
)
óóB C
.
óóC D
Include
óóD K
(
óóK L
t
óóL M
=>
óóN P
t
óóQ R
.
óóR S 
Estado_transaccion
óóS e
)
óóe f
.
óóf g
Include
óóg n
(
óón o
t
óóo p
=>
óóq s
t
óót u
.
óóu v
Detalle_maestroóóv Ö
)óóÖ Ü
.óóÜ á
Whereóóá å
(óóå ç
tóóç é
=>óóè ë
tóóí ì
.óóì î
idóóî ñ
==óóó ô
idóóö ú
)óóú ù
.óóù û

SelectManyóóû ®
(óó® ©
tóó© ™
=>óó´ ≠
tóóÆ Ø
.óóØ ∞
Transaccion1óó∞ º
)óóº Ω
;óóΩ æ
}
òò 
catch
ôô 
(
ôô 
	Exception
ôô 
e
ôô 
)
ôô 
{
öö 
throw
õõ 
new
õõ 
DatosException
õõ (
(
õõ( )
$str
õõ) Z
,
õõZ [
e
õõ\ ]
)
õõ] ^
;
õõ^ _
}
úú 
}
ùù 	
public
ûû 
IEnumerable
ûû 
<
ûû 
Transaccion
ûû &
>
ûû& '1
#ObtenerTransacciones11DeTransaccion
ûû( K
(
ûûK L
long
ûûL P
id
ûûQ S
)
ûûS T
{
üü 	
try
†† 
{
°° 
return
¢¢ 
_db
¢¢ 
.
¢¢ 
Transaccion
¢¢ &
.
¢¢& '
Where
¢¢' ,
(
¢¢, -
t
¢¢- .
=>
¢¢/ 1
t
¢¢2 3
.
¢¢3 4
id
¢¢4 6
==
¢¢7 9
id
¢¢: <
)
¢¢< =
.
¢¢= >

SelectMany
¢¢> H
(
¢¢H I
t
¢¢I J
=>
¢¢K M
t
¢¢N O
.
¢¢O P
Transaccion11
¢¢P ]
)
¢¢] ^
;
¢¢^ _
}
££ 
catch
§§ 
(
§§ 
	Exception
§§ 
e
§§ 
)
§§ 
{
•• 
throw
¶¶ 
new
¶¶ 
DatosException
¶¶ (
(
¶¶( )
$str
¶¶) Z
,
¶¶Z [
e
¶¶\ ]
)
¶¶] ^
;
¶¶^ _
}
ßß 
}
®® 	
public
©© 
IEnumerable
©© 
<
©© 
Transaccion
©© &
>
©©& '?
1ObtenerTransacciones11DeTransaccion3DeTransaccion
©©( Y
(
©©Y Z
long
©©Z ^
id
©©_ a
)
©©a b
{
™™ 	
try
´´ 
{
¨¨ 
return
≠≠ 
_db
≠≠ 
.
≠≠ 
Transaccion
≠≠ &
.
≠≠& '
Where
≠≠' ,
(
≠≠, -
t
≠≠- .
=>
≠≠/ 1
t
≠≠2 3
.
≠≠3 4
id
≠≠4 6
==
≠≠7 9
id
≠≠: <
)
≠≠< =
.
≠≠= >
Select
≠≠> D
(
≠≠D E
t
≠≠E F
=>
≠≠G I
t
≠≠J K
.
≠≠K L
Transaccion3
≠≠L X
)
≠≠X Y
.
≠≠Y Z

SelectMany
≠≠Z d
(
≠≠d e
t
≠≠e f
=>
≠≠g i
t
≠≠j k
.
≠≠k l
Transaccion11
≠≠l y
)
≠≠y z
;
≠≠z {
}
ÆÆ 
catch
ØØ 
(
ØØ 
	Exception
ØØ 
e
ØØ 
)
ØØ 
{
∞∞ 
throw
±± 
new
±± 
DatosException
±± (
(
±±( )
$str
±±) Z
,
±±Z [
e
±±\ ]
)
±±] ^
;
±±^ _
}
≤≤ 
}
≥≥ 	
public
¥¥ 
IEnumerable
¥¥ 
<
¥¥ 
Transaccion
¥¥ &
>
¥¥& '3
%ObtenerTransacciones11DeTransacciones
¥¥( M
(
¥¥M N
long
¥¥N R
[
¥¥R S
]
¥¥S T
ids
¥¥U X
)
¥¥X Y
{
µµ 	
try
∂∂ 
{
∑∑ 
return
∏∏ 
_db
∏∏ 
.
∏∏ 
Transaccion
∏∏ &
.
∏∏& '
Where
∏∏' ,
(
∏∏, -
t
∏∏- .
=>
∏∏/ 1
ids
∏∏2 5
.
∏∏5 6
Contains
∏∏6 >
(
∏∏> ?
t
∏∏? @
.
∏∏@ A
id
∏∏A C
)
∏∏C D
)
∏∏D E
.
∏∏E F

SelectMany
∏∏F P
(
∏∏P Q
t
∏∏Q R
=>
∏∏S U
t
∏∏V W
.
∏∏W X
Transaccion11
∏∏X e
)
∏∏e f
;
∏∏f g
}
ππ 
catch
∫∫ 
(
∫∫ 
	Exception
∫∫ 
e
∫∫ 
)
∫∫ 
{
ªª 
throw
ºº 
new
ºº 
DatosException
ºº (
(
ºº( )
$str
ºº) Z
,
ººZ [
e
ºº\ ]
)
ºº] ^
;
ºº^ _
}
ΩΩ 
}
ææ 	
public
øø 
Transaccion
øø %
ObtenerTransaccionPadre
øø 2
(
øø2 3
long
øø3 7
id
øø8 :
)
øø: ;
{
¿¿ 	
try
¡¡ 
{
¬¬ 
return
√√ 
_db
√√ 
.
√√ 
Transaccion
√√ &
.
√√& '
Single
√√' -
(
√√- .
t
√√. /
=>
√√0 2
t
√√3 4
.
√√4 5
id
√√5 7
==
√√8 :
id
√√; =
)
√√= >
.
√√> ?
Transaccion2
√√? K
;
√√K L
}
ƒƒ 
catch
≈≈ 
(
≈≈ 
	Exception
≈≈ 
e
≈≈ 
)
≈≈ 
{
∆∆ 
throw
«« 
new
«« 
DatosException
«« (
(
««( )
$str
««) P
,
««P Q
e
««R S
)
««S T
;
««T U
}
»» 
}
…… 	
public
ÀÀ 
bool
ÀÀ 
ExisteTransaccion
ÀÀ %
(
ÀÀ% &
int
ÀÀ& )
idTipoTransaccion
ÀÀ* ;
,
ÀÀ; <
int
ÀÀ= @#
idActorNegocioInterno
ÀÀA V
,
ÀÀV W
int
ÀÀX [$
idActorNegocioExterno1
ÀÀ\ r
,
ÀÀr s
int
ÀÀt w
idEstadoActualÀÀx Ü
)ÀÀÜ á
{
ÃÃ 	
return
ÕÕ 
_db
ÕÕ 
.
ÕÕ 
Transaccion
ÕÕ "
.
ÕÕ" #
Any
ÕÕ# &
(
ÕÕ& '
t
ÕÕ' (
=>
ÕÕ) +
t
ÕÕ, -
.
ÕÕ- .!
id_tipo_transaccion
ÕÕ. A
==
ÕÕB D
idTipoTransaccion
ÕÕE V
&&
ÕÕW Y
t
ÕÕZ [
.
ÕÕ[ \&
id_actor_negocio_interno
ÕÕ\ t
==
ÕÕu w$
idActorNegocioInternoÕÕx ç
&&ÕÕé ê
tÕÕë í
.ÕÕí ì)
id_actor_negocio_externo1ÕÕì ¨
==ÕÕ≠ Ø&
idActorNegocioExterno1ÕÕ∞ ∆
&&ÕÕ« …
tÕÕ  À
.ÕÕÀ Ã 
id_estado_actualÕÕÃ ‹
==ÕÕ› ﬂ
idEstadoActualÕÕ‡ Ó
)ÕÕÓ Ô
;ÕÕÔ 
}
ŒŒ 	
public
–– 
OperationResult
–– +
CrearEstadoDeTransaccionAhora
–– <
(
––< = 
Estado_transaccion
––= O
estadoTransaccion
––P a
)
––a b
{
—— 	
try
““ 
{
”” 
_db
‘‘ 
.
‘‘  
Estado_transaccion
‘‘ &
.
‘‘& '
Add
‘‘' *
(
‘‘* +
estadoTransaccion
‘‘+ <
)
‘‘< =
;
‘‘= >
var
’’ 
result
’’ 
=
’’ 
Save
’’ !
(
’’! "
)
’’" #
;
’’# $
result
÷÷ 
.
÷÷ 
data
÷÷ 
=
÷÷ 
estadoTransaccion
÷÷ /
.
÷÷/ 0
id_transaccion
÷÷0 >
;
÷÷> ?
return
◊◊ 
result
◊◊ 
;
◊◊ 
}
ÿÿ 
catch
ŸŸ 
(
ŸŸ 
	Exception
ŸŸ 
e
ŸŸ 
)
ŸŸ 
{
⁄⁄ 
return
€€ 
new
€€ 
OperationResult
€€ *
(
€€* +
e
€€+ ,
)
€€, -
;
€€- .
}
‹‹ 
}
›› 	
public
ﬂﬂ 
OperationResult
ﬂﬂ @
2CrearEstadoDeTransaccionAhoraActualizarTransaccion
ﬂﬂ Q
(
ﬂﬂQ R 
Estado_transaccion
ﬂﬂR d
estadoTransaccion
ﬂﬂe v
,
ﬂﬂv w
Transaccionﬂﬂx É
transaccionﬂﬂÑ è
)ﬂﬂè ê
{
‡‡ 	
try
·· 
{
‚‚ 
_db
„„ 
.
„„  
Estado_transaccion
„„ &
.
„„& '
Add
„„' *
(
„„* +
estadoTransaccion
„„+ <
)
„„< =
;
„„= >
Transaccion
‰‰ 
dbTransaccion
‰‰ )
=
‰‰* +
_db
‰‰, /
.
‰‰/ 0
Transaccion
‰‰0 ;
.
‰‰; <
Single
‰‰< B
(
‰‰B C
m
‰‰C D
=>
‰‰E G
m
‰‰H I
.
‰‰I J
id
‰‰J L
==
‰‰M O
transaccion
‰‰P [
.
‰‰[ \
id
‰‰\ ^
)
‰‰^ _
;
‰‰_ `
_db
ÂÂ 
.
ÂÂ 
Entry
ÂÂ 
(
ÂÂ 
dbTransaccion
ÂÂ '
)
ÂÂ' (
.
ÂÂ( )
CurrentValues
ÂÂ) 6
.
ÂÂ6 7
	SetValues
ÂÂ7 @
(
ÂÂ@ A
transaccion
ÂÂA L
)
ÂÂL M
;
ÂÂM N
var
ÊÊ 
result
ÊÊ 
=
ÊÊ 
Save
ÊÊ !
(
ÊÊ! "
)
ÊÊ" #
;
ÊÊ# $
result
ÁÁ 
.
ÁÁ 
data
ÁÁ 
=
ÁÁ 
estadoTransaccion
ÁÁ /
.
ÁÁ/ 0
id_transaccion
ÁÁ0 >
;
ÁÁ> ?
return
ËË 
result
ËË 
;
ËË 
}
ÈÈ 
catch
ÍÍ 
(
ÍÍ 
	Exception
ÍÍ 
e
ÍÍ 
)
ÍÍ 
{
ÎÎ 
return
ÏÏ 
new
ÏÏ 
OperationResult
ÏÏ *
(
ÏÏ* +
e
ÏÏ+ ,
)
ÏÏ, -
;
ÏÏ- .
}
ÌÌ 
}
ÓÓ 	
public
ÔÔ 
OperationResult
ÔÔ :
,CrearEstadoTransaccionActualizarActorNegocio
ÔÔ K
(
ÔÔK L 
Estado_transaccion
ÔÔL ^
estadoTransaccion
ÔÔ_ p
,
ÔÔp q
Actor_negocio
ÔÔr 
actorNegocioÔÔÄ å
)ÔÔå ç
{
 	
try
ÒÒ 
{
ÚÚ 
if
ÛÛ 
(
ÛÛ 
estadoTransaccion
ÛÛ %
!=
ÛÛ& (
null
ÛÛ) -
)
ÛÛ- .
{
ÙÙ 
_db
ıı 
.
ıı  
Estado_transaccion
ıı *
.
ıı* +
Add
ıı+ .
(
ıı. /
estadoTransaccion
ıı/ @
)
ıı@ A
;
ııA B
}
ˆˆ 
if
˜˜ 
(
˜˜ 
actorNegocio
˜˜  
!=
˜˜! #
null
˜˜$ (
)
˜˜( )
{
¯¯ 
Actor_negocio
˘˘ !
dbActorNegocio
˘˘" 0
=
˘˘1 2
_db
˘˘3 6
.
˘˘6 7
Actor_negocio
˘˘7 D
.
˘˘D E
Single
˘˘E K
(
˘˘K L
m
˘˘L M
=>
˘˘N P
m
˘˘Q R
.
˘˘R S
id
˘˘S U
==
˘˘V X
actorNegocio
˘˘Y e
.
˘˘e f
id
˘˘f h
)
˘˘h i
;
˘˘i j
_db
˙˙ 
.
˙˙ 
Entry
˙˙ 
(
˙˙ 
dbActorNegocio
˙˙ ,
)
˙˙, -
.
˙˙- .
CurrentValues
˙˙. ;
.
˙˙; <
	SetValues
˙˙< E
(
˙˙E F
actorNegocio
˙˙F R
)
˙˙R S
;
˙˙S T
}
˚˚ 
var
¸¸ 
result
¸¸ 
=
¸¸ 
Save
¸¸ !
(
¸¸! "
)
¸¸" #
;
¸¸# $
return
˝˝ 
result
˝˝ 
;
˝˝ 
}
˛˛ 
catch
ˇˇ 
(
ˇˇ 
	Exception
ˇˇ 
e
ˇˇ 
)
ˇˇ 
{
ÄÄ 
throw
ÅÅ 
e
ÅÅ 
;
ÅÅ 
}
ÇÇ 
}
ÉÉ 	
public
ÑÑ 
OperationResult
ÑÑ .
 CrearEstadosDeTransaccionesAhora
ÑÑ ?
(
ÑÑ? @
List
ÑÑ@ D
<
ÑÑD E 
Estado_transaccion
ÑÑE W
>
ÑÑW X$
estadosDeTransacciones
ÑÑY o
)
ÑÑo p
{
ÖÖ 	
try
ÜÜ 
{
áá 
foreach
àà 
(
àà 
var
àà 
estados
àà $
in
àà% '$
estadosDeTransacciones
àà( >
)
àà> ?
{
ââ 
_db
ää 
.
ää  
Estado_transaccion
ää *
.
ää* +
Add
ää+ .
(
ää. /
estados
ää/ 6
)
ää6 7
;
ää7 8
}
ãã 
return
åå 
Save
åå 
(
åå 
)
åå 
;
åå 
}
çç 
catch
éé 
(
éé 
	Exception
éé 
e
éé 
)
éé 
{
èè 
return
êê 
new
êê 
OperationResult
êê *
(
êê* +
e
êê+ ,
)
êê, -
;
êê- .
}
ëë 
}
íí 	
public
îî 
OperationResult
îî C
5CrearEstadosDeTransaccionesAhoraActualizarTransaccion
îî T
(
îîT U
List
îîU Y
<
îîY Z 
Estado_transaccion
îîZ l
>
îîl m%
estadosDeTransaccionesîîn Ñ
,îîÑ Ö
TransaccionîîÜ ë
transaccionîîí ù
)îîù û
{
ïï 	
try
ññ 
{
óó 
foreach
òò 
(
òò 
var
òò 
estados
òò $
in
òò% '$
estadosDeTransacciones
òò( >
)
òò> ?
{
ôô 
_db
öö 
.
öö  
Estado_transaccion
öö *
.
öö* +
Add
öö+ .
(
öö. /
estados
öö/ 6
)
öö6 7
;
öö7 8
}
õõ 
Transaccion
úú 
dbTransaccion
úú )
=
úú* +
_db
úú, /
.
úú/ 0
Transaccion
úú0 ;
.
úú; <
Single
úú< B
(
úúB C
m
úúC D
=>
úúE G
m
úúH I
.
úúI J
id
úúJ L
==
úúM O
transaccion
úúP [
.
úú[ \
id
úú\ ^
)
úú^ _
;
úú_ `
_db
ùù 
.
ùù 
Entry
ùù 
(
ùù 
dbTransaccion
ùù '
)
ùù' (
.
ùù( )
CurrentValues
ùù) 6
.
ùù6 7
	SetValues
ùù7 @
(
ùù@ A
transaccion
ùùA L
)
ùùL M
;
ùùM N
return
ûû 
Save
ûû 
(
ûû 
)
ûû 
;
ûû 
}
üü 
catch
†† 
(
†† 
	Exception
†† 
e
†† 
)
†† 
{
°° 
return
¢¢ 
new
¢¢ 
OperationResult
¢¢ *
(
¢¢* +
e
¢¢+ ,
)
¢¢, -
;
¢¢- .
}
££ 
}
§§ 	
public
¶¶ 
OperationResult
¶¶ 0
"CrearEstadosMasivosDeTransacciones
¶¶ A
(
¶¶A B
List
¶¶B F
<
¶¶F G 
Estado_transaccion
¶¶G Y
>
¶¶Y Z$
estadosDeTransacciones
¶¶[ q
)
¶¶q r
{
ßß 	
try
®® 
{
©© 
string
™™ 
commandInsert
™™ $
=
™™% &
$str
™™' O
;
™™O P
List
¨¨ 
<
¨¨ 
string
¨¨ 
>
¨¨ 
commands
¨¨ %
=
¨¨& '
new
¨¨( +
List
¨¨, 0
<
¨¨0 1
string
¨¨1 7
>
¨¨7 8
(
¨¨8 9
)
¨¨9 :
;
¨¨: ;
foreach
∞∞ 
(
∞∞ 
var
∞∞ 
estado
∞∞ #
in
∞∞$ &$
estadosDeTransacciones
∞∞' =
)
∞∞= >
{
±± 
commands
≤≤ 
.
≤≤ 
Add
≤≤  
(
≤≤  !
Environment
≤≤! ,
.
≤≤, -
NewLine
≤≤- 4
+
≤≤5 6
$str
≤≤7 :
+
≤≤; <
estado
≤≤= C
.
≤≤C D
id_transaccion
≤≤D R
+
≤≤S T
$str
≤≤U X
+
≤≤Y Z
estado
≤≤[ a
.
≤≤a b
id_empleado
≤≤b m
+
≤≤n o
$str
≤≤p s
+
≤≤t u
estado
≤≤v |
.
≤≤| }
	id_estado≤≤} Ü
+≤≤á à
$str≤≤â ç
+≤≤é è
estado≤≤ê ñ
.≤≤ñ ó
fecha≤≤ó ú
.≤≤ú ù
ToString≤≤ù •
(≤≤• ¶
$str≤≤¶ ª
)≤≤ª º
+≤≤Ω æ
$str≤≤ø ƒ
+≤≤≈ ∆
estado≤≤« Õ
.≤≤Õ Œ

comentario≤≤Œ ÿ
.≤≤ÿ Ÿ
Replace≤≤Ÿ ‡
(≤≤‡ ·
$str≤≤· ‰
,≤≤‰ Â
$str≤≤Ê Í
)≤≤Í Î
+≤≤Ï Ì
$str≤≤Ó Û
)≤≤Û Ù
;≤≤Ù ı
}
≥≥ 
var
∂∂ 
rondas
∂∂ 
=
∂∂ 
Math
∂∂ !
.
∂∂! "
Ceiling
∂∂" )
(
∂∂) *
(
∂∂* +
double
∂∂+ 1
)
∂∂1 2
commands
∂∂2 :
.
∂∂: ;
Count
∂∂; @
/
∂∂A B
$num
∂∂C G
)
∂∂G H
;
∂∂H I
for
∑∑ 
(
∑∑ 
int
∑∑ 
a
∑∑ 
=
∑∑ 
$num
∑∑ 
;
∑∑ 
a
∑∑  !
<
∑∑" #
rondas
∑∑$ *
;
∑∑* +
a
∑∑, -
++
∑∑- /
)
∑∑/ 0
{
∏∏ 
var
ππ 
subList
ππ 
=
ππ  !
commands
ππ" *
.
ππ* +
Skip
ππ+ /
(
ππ/ 0
a
ππ0 1
*
ππ2 3
$num
ππ4 8
)
ππ8 9
.
ππ9 :
Take
ππ: >
(
ππ> ?
$num
ππ? C
)
ππC D
;
ππD E
string
ªª 
com
ªª 
=
ªª  
$str
ªª! #
;
ªª# $
foreach
ºº 
(
ºº 
var
ºº  
item
ºº! %
in
ºº& (
subList
ºº) 0
)
ºº0 1
{
ΩΩ 
com
ææ 
+=
ææ 
item
ææ #
;
ææ# $
}
øø 
com
¿¿ 
=
¿¿ 
com
¿¿ 
.
¿¿ 
	Substring
¿¿ '
(
¿¿' (
$num
¿¿( )
,
¿¿) *
com
¿¿+ .
.
¿¿. /
Length
¿¿/ 5
-
¿¿6 7
$num
¿¿8 9
)
¿¿9 :
;
¿¿: ;
_db
¡¡ 
.
¡¡ 
Database
¡¡  
.
¡¡  !
ExecuteSqlCommand
¡¡! 2
(
¡¡2 3
commandInsert
¡¡3 @
+
¡¡A B
com
¡¡C F
)
¡¡F G
;
¡¡G H
}
√√ 
var
∆∆ 
resultadoDetails
∆∆ $
=
∆∆% &
new
∆∆' *
OperationResult
∆∆+ :
(
∆∆: ;!
OperationResultEnum
∆∆; N
.
∆∆N O
Success
∆∆O V
)
∆∆V W
;
∆∆W X
return
«« 
resultadoDetails
«« '
;
««' (
}
…… 
catch
   
(
   
	Exception
   
e
   
)
   
{
ÀÀ 
throw
ÃÃ 
new
ÃÃ 
DatosException
ÃÃ (
(
ÃÃ( )
$str
ÃÃ) `
,
ÃÃ` a
e
ÃÃb c
)
ÃÃc d
;
ÃÃd e
}
ÕÕ 
}
ŒŒ 	
public
œœ 
OperationResult
œœ $
CrearEventoTransaccion
œœ 5
(
œœ5 6 
Evento_transaccion
œœ6 H
eventoTransaccion
œœI Z
)
œœZ [
{
–– 	
try
—— 
{
““ 
_db
”” 
.
””  
Evento_transaccion
”” &
.
””& '
Add
””' *
(
””* +
eventoTransaccion
””+ <
)
””< =
;
””= >
var
‘‘ 
result
‘‘ 
=
‘‘ 
Save
‘‘ !
(
‘‘! "
)
‘‘" #
;
‘‘# $
result
’’ 
.
’’ 
data
’’ 
=
’’ 
eventoTransaccion
’’ /
.
’’/ 0
id_transaccion
’’0 >
;
’’> ?
result
÷÷ 
.
÷÷ 
information
÷÷ "
=
÷÷# $
eventoTransaccion
÷÷% 6
.
÷÷6 7
id
÷÷7 9
;
÷÷9 :
return
◊◊ 
result
◊◊ 
;
◊◊ 
}
ÿÿ 
catch
ŸŸ 
(
ŸŸ 
	Exception
ŸŸ 
e
ŸŸ 
)
ŸŸ 
{
⁄⁄ 
return
€€ 
new
€€ 
OperationResult
€€ *
(
€€* +
e
€€+ ,
)
€€, -
;
€€- .
}
‹‹ 
}
›› 	
public
ﬁﬁ 
OperationResult
ﬁﬁ :
,CrearEventoTransaccionInformacionTransaccion
ﬁﬁ K
(
ﬁﬁK L 
Evento_transaccion
ﬁﬁL ^
eventoTransaccion
ﬁﬁ_ p
,
ﬁﬁp q
string
ﬁﬁr x%
informacionTransaccionﬁﬁy è
)ﬁﬁè ê
{
ﬂﬂ 	
try
‡‡ 
{
·· 
_db
‚‚ 
.
‚‚  
Evento_transaccion
‚‚ &
.
‚‚& '
Add
‚‚' *
(
‚‚* +
eventoTransaccion
‚‚+ <
)
‚‚< =
;
‚‚= >
Transaccion
„„ 
dbTransaccion
„„ )
=
„„* +
_db
„„, /
.
„„/ 0
Transaccion
„„0 ;
.
„„; <
Single
„„< B
(
„„B C
m
„„C D
=>
„„E G
m
„„H I
.
„„I J
id
„„J L
==
„„M O
eventoTransaccion
„„P a
.
„„a b
id_transaccion
„„b p
)
„„p q
;
„„q r
dbTransaccion
‰‰ 
.
‰‰ 
informacion
‰‰ )
=
‰‰* +$
informacionTransaccion
‰‰, B
;
‰‰B C
var
ÂÂ 
result
ÂÂ 
=
ÂÂ 
Save
ÂÂ !
(
ÂÂ! "
)
ÂÂ" #
;
ÂÂ# $
result
ÊÊ 
.
ÊÊ 
data
ÊÊ 
=
ÊÊ 
eventoTransaccion
ÊÊ /
.
ÊÊ/ 0
id_transaccion
ÊÊ0 >
;
ÊÊ> ?
result
ÁÁ 
.
ÁÁ 
information
ÁÁ "
=
ÁÁ# $
eventoTransaccion
ÁÁ% 6
.
ÁÁ6 7
id
ÁÁ7 9
;
ÁÁ9 :
return
ËË 
result
ËË 
;
ËË 
}
ÈÈ 
catch
ÍÍ 
(
ÍÍ 
	Exception
ÍÍ 
e
ÍÍ 
)
ÍÍ 
{
ÎÎ 
return
ÏÏ 
new
ÏÏ 
OperationResult
ÏÏ *
(
ÏÏ* +
e
ÏÏ+ ,
)
ÏÏ, -
;
ÏÏ- .
}
ÌÌ 
}
ÓÓ 	
public
ÔÔ 
OperationResult
ÔÔ '
CrearEventosTransacciones
ÔÔ 8
(
ÔÔ8 9
List
ÔÔ9 =
<
ÔÔ= > 
Evento_transaccion
ÔÔ> P
>
ÔÔP Q"
eventosTransacciones
ÔÔR f
)
ÔÔf g
{
 	
try
ÒÒ 
{
ÚÚ 
foreach
ÛÛ 
(
ÛÛ 
var
ÛÛ 
eventoTransaccion
ÛÛ .
in
ÛÛ/ 1"
eventosTransacciones
ÛÛ2 F
)
ÛÛF G
{
ÙÙ 
_db
ıı 
.
ıı  
Evento_transaccion
ıı *
.
ıı* +
Add
ıı+ .
(
ıı. /
eventoTransaccion
ıı/ @
)
ıı@ A
;
ııA B
}
ˆˆ 
var
˜˜ 
result
˜˜ 
=
˜˜ 
Save
˜˜ !
(
˜˜! "
)
˜˜" #
;
˜˜# $
return
¯¯ 
result
¯¯ 
;
¯¯ 
}
˘˘ 
catch
˙˙ 
(
˙˙ 
	Exception
˙˙ 
e
˙˙ 
)
˙˙ 
{
˚˚ 
return
¸¸ 
new
¸¸ 
OperationResult
¸¸ *
(
¸¸* +
e
¸¸+ ,
)
¸¸, -
;
¸¸- .
}
˝˝ 
}
˛˛ 	
public
ˇˇ 
OperationResult
ˇˇ 0
"CrearEventosMasivosDeTransacciones
ˇˇ A
(
ˇˇA B
List
ˇˇB F
<
ˇˇF G 
Evento_transaccion
ˇˇG Y
>
ˇˇY Z$
eventosDeTransacciones
ˇˇ[ q
)
ˇˇq r
{
ÄÄ 	
try
ÅÅ 
{
ÇÇ 
string
ÉÉ 
commandInsert
ÉÉ $
=
ÉÉ% &
$str
ÉÉ' O
;
ÉÉO P
List
ÖÖ 
<
ÖÖ 
string
ÖÖ 
>
ÖÖ 
commands
ÖÖ %
=
ÖÖ& '
new
ÖÖ( +
List
ÖÖ, 0
<
ÖÖ0 1
string
ÖÖ1 7
>
ÖÖ7 8
(
ÖÖ8 9
)
ÖÖ9 :
;
ÖÖ: ;
foreach
ââ 
(
ââ 
var
ââ 
evento
ââ #
in
ââ$ &$
eventosDeTransacciones
ââ' =
)
ââ= >
{
ää 
commands
ãã 
.
ãã 
Add
ãã  
(
ãã  !
Environment
ãã! ,
.
ãã, -
NewLine
ãã- 4
+
ãã5 6
$str
ãã7 :
+
ãã; <
evento
ãã= C
.
ããC D
id_transaccion
ããD R
+
ããS T
$str
ããU X
+
ããY Z
evento
ãã[ a
.
ããa b
id_empleado
ããb m
+
ããn o
$str
ããp s
+
ããt u
evento
ããv |
.
ãã| }
	id_eventoãã} Ü
+ããá à
$strããâ ç
+ããé è
eventoããê ñ
.ããñ ó
fechaããó ú
.ããú ù
ToStringããù •
(ãã• ¶
$strãã¶ ª
)ããª º
+ããΩ æ
$strããø ƒ
+ãã≈ ∆
eventoãã« Õ
.ããÕ Œ

comentarioããŒ ÿ
.ããÿ Ÿ
ReplaceããŸ ‡
(ãã‡ ·
$strãã· ‰
,ãã‰ Â
$strããÊ Í
)ããÍ Î
+ããÏ Ì
$strããÓ Û
)ããÛ Ù
;ããÙ ı
}
åå 
var
èè 
rondas
èè 
=
èè 
Math
èè !
.
èè! "
Ceiling
èè" )
(
èè) *
(
èè* +
double
èè+ 1
)
èè1 2
commands
èè2 :
.
èè: ;
Count
èè; @
/
èèA B
$num
èèC G
)
èèG H
;
èèH I
for
êê 
(
êê 
int
êê 
a
êê 
=
êê 
$num
êê 
;
êê 
a
êê  !
<
êê" #
rondas
êê$ *
;
êê* +
a
êê, -
++
êê- /
)
êê/ 0
{
ëë 
var
íí 
subList
íí 
=
íí  !
commands
íí" *
.
íí* +
Skip
íí+ /
(
íí/ 0
a
íí0 1
*
íí2 3
$num
íí4 8
)
íí8 9
.
íí9 :
Take
íí: >
(
íí> ?
$num
íí? C
)
ííC D
;
ííD E
string
îî 
com
îî 
=
îî  
$str
îî! #
;
îî# $
foreach
ïï 
(
ïï 
var
ïï  
item
ïï! %
in
ïï& (
subList
ïï) 0
)
ïï0 1
{
ññ 
com
óó 
+=
óó 
item
óó #
;
óó# $
}
òò 
com
ôô 
=
ôô 
com
ôô 
.
ôô 
	Substring
ôô '
(
ôô' (
$num
ôô( )
,
ôô) *
com
ôô+ .
.
ôô. /
Length
ôô/ 5
-
ôô6 7
$num
ôô8 9
)
ôô9 :
;
ôô: ;
_db
öö 
.
öö 
Database
öö  
.
öö  !
ExecuteSqlCommand
öö! 2
(
öö2 3
commandInsert
öö3 @
+
ööA B
com
ööC F
)
ööF G
;
ööG H
}
úú 
var
üü 
resultadoDetails
üü $
=
üü% &
new
üü' *
OperationResult
üü+ :
(
üü: ;!
OperationResultEnum
üü; N
.
üüN O
Success
üüO V
)
üüV W
;
üüW X
return
†† 
resultadoDetails
†† '
;
††' (
}
¢¢ 
catch
££ 
(
££ 
	Exception
££ 
e
££ 
)
££ 
{
§§ 
throw
•• 
new
•• 
DatosException
•• (
(
••( )
$str
••) `
,
••` a
e
••b c
)
••c d
;
••d e
}
¶¶ 
}
ßß 	
public
©© 
OperationResult
©©  
CrearTransacciones
©© 1
(
©©1 2
Transaccion
©©2 =
transaccion
©©> I
,
©©I J
List
©©K O
<
©©O P
Transaccion
©©P [
>
©©[ \
transacciones1
©©] k
,
©©k l
List
©©m q
<
©©q r
Transaccion
©©r }
>
©©} ~
transacciones2©© ç
)©©ç é
{
™™ 	
try
´´ 
{
¨¨ 
_db
≠≠ 
.
≠≠ 
Transaccion
≠≠ 
.
≠≠  
Add
≠≠  #
(
≠≠# $
transaccion
≠≠$ /
)
≠≠/ 0
;
≠≠0 1
foreach
ÆÆ 
(
ÆÆ 
var
ÆÆ 
item
ÆÆ !
in
ÆÆ" $
transacciones1
ÆÆ% 3
)
ÆÆ3 4
{
ØØ 
_db
∞∞ 
.
∞∞ 
Transaccion
∞∞ #
.
∞∞# $
Add
∞∞$ '
(
∞∞' (
item
∞∞( ,
)
∞∞, -
;
∞∞- .
}
±± 
foreach
≤≤ 
(
≤≤ 
var
≤≤ 
item
≤≤ !
in
≤≤" $
transacciones2
≤≤% 3
)
≤≤3 4
{
≥≥ 
_db
¥¥ 
.
¥¥ 
Transaccion
¥¥ #
.
¥¥# $
Add
¥¥$ '
(
¥¥' (
item
¥¥( ,
)
¥¥, -
;
¥¥- .
}
µµ 
var
∑∑ 
result
∑∑ 
=
∑∑ 
Save
∑∑ !
(
∑∑! "
)
∑∑" #
;
∑∑# $
result
∏∏ 
.
∏∏ 
data
∏∏ 
=
∏∏ 
transaccion
∏∏ )
.
∏∏) *
id
∏∏* ,
;
∏∏, -
return
ππ 
result
ππ 
;
ππ 
}
∫∫ 
catch
ªª 
(
ªª 
	Exception
ªª 
e
ªª 
)
ªª 
{
ºº 
return
ΩΩ 
new
ΩΩ 
OperationResult
ΩΩ *
(
ΩΩ* +
e
ΩΩ+ ,
)
ΩΩ, -
;
ΩΩ- .
}
ææ 
}
øø 	
public
¿¿ 
OperationResult
¿¿  
CrearTransacciones
¿¿ 1
(
¿¿1 2
Transaccion
¿¿2 =
transaccion
¿¿> I
,
¿¿I J
List
¿¿K O
<
¿¿O P
Transaccion
¿¿P [
>
¿¿[ \
transacciones1
¿¿] k
)
¿¿k l
{
¡¡ 	
try
¬¬ 
{
√√ 
var
∆∆ 
result
∆∆ 
=
∆∆ 
Save
∆∆ !
(
∆∆! "
)
∆∆" #
;
∆∆# $
result
«« 
.
«« 
data
«« 
=
«« 
transaccion
«« )
.
««) *
id
««* ,
;
««, -
return
»» 
result
»» 
;
»» 
}
…… 
catch
   
(
   
	Exception
   
e
   
)
   
{
ÀÀ 
return
ÃÃ 
new
ÃÃ 
OperationResult
ÃÃ *
(
ÃÃ* +
e
ÃÃ+ ,
)
ÃÃ, -
;
ÃÃ- .
}
ÕÕ 
}
ŒŒ 	
public
–– 
Comprobante
–– -
ObtenerComprobanteDeTransaccion
–– :
(
––: ;
long
––; ?
idTransaccion
––@ M
)
––M N
{
—— 	
try
““ 
{
”” 
return
‘‘ 
_db
‘‘ 
.
‘‘ 
Transaccion
‘‘ &
.
‘‘& '
SingleOrDefault
‘‘' 6
(
‘‘6 7
t
‘‘7 8
=>
‘‘9 ;
t
‘‘< =
.
‘‘= >
id
‘‘> @
==
‘‘A C
idTransaccion
‘‘D Q
)
‘‘Q R
.
‘‘R S
Comprobante
‘‘S ^
;
‘‘^ _
}
’’ 
catch
÷÷ 
(
÷÷ 
	Exception
÷÷ 
e
÷÷ 
)
÷÷ 
{
◊◊ 
throw
ÿÿ 
e
ÿÿ 
;
ÿÿ 
}
ŸŸ 
}
⁄⁄ 	
public
€€ 
Comprobante
€€ $
ObtenerComprobanteCero
€€ 1
(
€€1 2
int
€€2 5 
idSerieComprobante
€€6 H
)
€€H I
{
‹‹ 	
try
›› 
{
ﬁﬁ 
return
ﬂﬂ 
_db
ﬂﬂ 
.
ﬂﬂ 
Comprobante
ﬂﬂ &
.
ﬂﬂ& '
SingleOrDefault
ﬂﬂ' 6
(
ﬂﬂ6 7
c
ﬂﬂ7 8
=>
ﬂﬂ9 ;
c
ﬂﬂ< =
.
ﬂﬂ= >"
id_serie_comprobante
ﬂﬂ> R
==
ﬂﬂS U 
idSerieComprobante
ﬂﬂV h
&&
ﬂﬂi k
c
ﬂﬂl m
.
ﬂﬂm n
numero
ﬂﬂn t
==
ﬂﬂu w
$num
ﬂﬂx y
)
ﬂﬂy z
;
ﬂﬂz {
}
‡‡ 
catch
·· 
(
·· 
	Exception
·· 
e
·· 
)
·· 
{
‚‚ 
throw
„„ 
e
„„ 
;
„„ 
}
‰‰ 
}
ÂÂ 	
public
ÁÁ 
async
ÁÁ 
Task
ÁÁ 
<
ÁÁ 
IEnumerable
ÁÁ %
<
ÁÁ% &/
!Tipo_transaccion_tipo_comprobante
ÁÁ& G
>
ÁÁG H
>
ÁÁH I8
*ObtenerTipoComprobantePorTipoDeTransaccion
ÁÁJ t
(
ÁÁt u
int
ÁÁu x 
idTipoTransaccionÁÁy ä
)ÁÁä ã
{
ËË 	
try
ÈÈ 
{
ÍÍ 
var
ÎÎ 
_asyncDb
ÎÎ 
=
ÎÎ 
new
ÎÎ "
SigescomEntities
ÎÎ# 3
(
ÎÎ3 4
)
ÎÎ4 5
;
ÎÎ5 6
return
ÌÌ 
await
ÌÌ 
_asyncDb
ÌÌ %
.
ÌÌ% &/
!Tipo_transaccion_tipo_comprobante
ÌÌ& G
.
ÌÌG H
Where
ÌÌH M
(
ÌÌM N
tc
ÌÌN P
=>
ÌÌQ S
tc
ÌÌT V
.
ÌÌV W!
id_tipo_transaccion
ÌÌW j
==
ÌÌk m
idTipoTransaccion
ÌÌn 
)ÌÌ Ä
.ÌÌÄ Å
Include
ÓÓ, 3
(
ÓÓ3 4
tttc
ÓÓ4 8
=>
ÓÓ9 ;
tttc
ÓÓ< @
.
ÓÓ@ A
Detalle_maestro
ÓÓA P
)
ÓÓP Q
.
ÓÓQ R
Include
ÔÔ, 3
(
ÔÔ3 4
tttc
ÔÔ4 8
=>
ÔÔ9 ;
tttc
ÔÔ< @
.
ÔÔ@ A
Detalle_maestro
ÔÔA P
.
ÔÔP Q
Serie_comprobante
ÔÔQ b
)
ÔÔb c
.
ÔÔc d
ToListAsync
ÔÔd o
(
ÔÔo p
)
ÔÔp q
;
ÔÔq r
}
 
catch
ÒÒ 
(
ÒÒ 
	Exception
ÒÒ 
e
ÒÒ 
)
ÒÒ 
{
ÚÚ 
throw
ÛÛ 
new
ÛÛ 
DatosException
ÛÛ (
(
ÛÛ( )
$str
ÛÛ) O
,
ÛÛO P
e
ÛÛQ R
)
ÛÛR S
;
ÛÛS T
}
ÙÙ 
}
ıı 	
public
˜˜ 
async
˜˜ 
Task
˜˜ 
<
˜˜ 
IEnumerable
˜˜ %
<
˜˜% &/
!Tipo_transaccion_tipo_comprobante
˜˜& G
>
˜˜G H
>
˜˜H I8
*ObtenerTipoComprobantePorTipoDeTransaccion
˜˜J t
(
˜˜t u
int
˜˜u x
[
˜˜x y
]
˜˜y z!
idsTipoTransaccion˜˜{ ç
)˜˜ç é
{
¯¯ 	
try
˘˘ 
{
˙˙ 
return
˚˚ 
await
˚˚ 
_db
˚˚  
.
˚˚  !/
!Tipo_transaccion_tipo_comprobante
˚˚! B
.
˚˚B C
Where
˚˚C H
(
˚˚H I
tc
˚˚I K
=>
˚˚L N 
idsTipoTransaccion
˚˚O a
.
˚˚a b
Contains
˚˚b j
(
˚˚j k
tc
˚˚k m
.
˚˚m n"
id_tipo_transaccion˚˚n Å
)˚˚Å Ç
)˚˚Ç É
.˚˚É Ñ
Include
¸¸, 3
(
¸¸3 4
tttc
¸¸4 8
=>
¸¸9 ;
tttc
¸¸< @
.
¸¸@ A
Detalle_maestro
¸¸A P
)
¸¸P Q
.
¸¸Q R
Include
˝˝, 3
(
˝˝3 4
tttc
˝˝4 8
=>
˝˝9 ;
tttc
˝˝< @
.
˝˝@ A
Detalle_maestro
˝˝A P
.
˝˝P Q
Serie_comprobante
˝˝Q b
)
˝˝b c
.
˝˝c d
ToListAsync
˝˝d o
(
˝˝o p
)
˝˝p q
;
˝˝q r
}
˛˛ 
catch
ˇˇ 
(
ˇˇ 
	Exception
ˇˇ 
e
ˇˇ 
)
ˇˇ 
{
ÄÄ 
throw
ÅÅ 
new
ÅÅ 
DatosException
ÅÅ (
(
ÅÅ( )
$str
ÅÅ) O
,
ÅÅO P
e
ÅÅQ R
)
ÅÅR S
;
ÅÅS T
}
ÇÇ 
}
ÉÉ 	
public
ââ 
IEnumerable
ââ 
<
ââ /
!Tipo_transaccion_tipo_comprobante
ââ <
>
ââ< =8
*ObtenerTipoComprobantePorTipoDeComprobante
ââ> h
(
ââh i
int
ââi l
idTipoComprobante
ââm ~
)
ââ~ 
{
ää 	
try
ãã 
{
åå 
return
çç 
_db
çç 
.
çç /
!Tipo_transaccion_tipo_comprobante
çç <
.
çç< =
Where
çç= B
(
ççB C
tc
ççC E
=>
ççF H
tc
ççI K
.
ççK L!
id_tipo_comprobante
ççL _
==
çç` b
idTipoComprobante
ççc t
)
ççt u
.
ççu v
Include
éé 
(
éé 
tttc
éé 
=>
éé 
tttc
éé  $
.
éé$ %
Detalle_maestro
éé% 4
)
éé4 5
.
éé5 6
Include
èè 
(
èè 
tttc
èè 
=>
èè 
tttc
èè  $
.
èè$ %
Detalle_maestro
èè% 4
.
èè4 5
Serie_comprobante
èè5 F
)
èèF G
.
èèG H
ToList
èèH N
(
èèN O
)
èèO P
;
èèP Q
}
êê 
catch
ëë 
(
ëë 
	Exception
ëë 
e
ëë 
)
ëë 
{
íí 
throw
ìì 
new
ìì 
DatosException
ìì (
(
ìì( )
$str
ìì) O
,
ììO P
e
ììQ R
)
ììR S
;
ììS T
}
îî 
}
ïï 	
public
óó 
IEnumerable
óó 
<
óó /
!Tipo_transaccion_tipo_comprobante
óó <
>
óó< =8
*ObtenerTipoComprobantePorTipoDeComprobante
óó> h
(
óóh i
int
óói l
[
óól m
]
óóm n!
idsTipoComprobanteóóo Å
)óóÅ Ç
{
òò 	
try
ôô 
{
öö 
return
õõ 
_db
õõ 
.
õõ /
!Tipo_transaccion_tipo_comprobante
õõ <
.
õõ< =
Where
õõ= B
(
õõB C
tc
õõC E
=>
õõF H 
idsTipoComprobante
õõI [
.
õõ[ \
Contains
õõ\ d
(
õõd e
tc
õõe g
.
õõg h!
id_tipo_comprobante
õõh {
)
õõ{ |
)
õõ| }
.
õõ} ~
Include
úú 
(
úú 
tttc
úú 
=>
úú 
tttc
úú  $
.
úú$ %
Detalle_maestro
úú% 4
)
úú4 5
.
úú5 6
Include
ùù 
(
ùù 
tttc
ùù 
=>
ùù 
tttc
ùù  $
.
ùù$ %
Detalle_maestro
ùù% 4
.
ùù4 5
Serie_comprobante
ùù5 F
)
ùùF G
.
ùùG H
ToList
ùùH N
(
ùùN O
)
ùùO P
;
ùùP Q
}
ûû 
catch
üü 
(
üü 
	Exception
üü 
e
üü 
)
üü 
{
†† 
throw
°° 
new
°° 
DatosException
°° (
(
°°( )
$str
°°) O
,
°°O P
e
°°Q R
)
°°R S
;
°°S T
}
¢¢ 
}
££ 	
public
•• 
bool
•• 
ExisteComprobante
•• %
(
••% &
int
••& )
idActorNegocio
••* 8
,
••8 9
int
••: =
idTipoComprobante
••> O
,
••O P
string
••Q W
numeroDeSerie
••X e
,
••e f
int
••g j
numeroComprobante
••k |
,
••| }
int••~ Å!
idTipoTransaccion••Ç ì
,••ì î
int••ï ò
idEstadoActual••ô ß
)••ß ®
{
¶¶ 	
try
ßß 
{
®® 
return
©© 
_db
©© 
.
©© 
Comprobante
©© &
.
©©& '
Any
©©' *
(
©©* +
c
©©+ ,
=>
©©- /
c
©©0 1
.
©©1 2!
id_tipo_comprobante
©©2 E
==
©©F H
idTipoComprobante
©©I Z
&&
©©[ ]
c
©©^ _
.
©©_ `
numero_serie
©©` l
==
©©m o
numeroDeSerie
©©p }
&&©©~ Ä
c©©Å Ç
.©©Ç É
numero©©É â
==©©ä å!
numeroComprobante©©ç û
&&
™™ 
c
™™ 
.
™™ 
Transaccion
™™  
.
™™  !
Any
™™! $
(
™™$ %
t
™™% &
=>
™™' )
t
™™* +
.
™™+ ,&
id_actor_negocio_externo
™™, D
==
™™E G
idActorNegocio
™™H V
&&
™™W Y
t
™™Z [
.
™™[ \!
id_tipo_transaccion
™™\ o
==
™™p r 
idTipoTransaccion™™s Ñ
&&™™Ö á
t™™à â
.™™â ä 
id_estado_actual™™ä ö
==™™õ ù
idEstadoActual™™û ¨
)™™¨ ≠
)™™≠ Æ
;™™Æ Ø
}
´´ 
catch
¨¨ 
(
¨¨ 
	Exception
¨¨ 
e
¨¨ 
)
¨¨ 
{
≠≠ 
throw
ÆÆ 
new
ÆÆ 
DatosException
ÆÆ (
(
ÆÆ( )
$str
ÆÆ) T
,
ÆÆT U
e
ÆÆV W
)
ÆÆW X
;
ÆÆX Y
}
ØØ 
}
∞∞ 	
public
≤≤ 
Cuota
≤≤ 
ObtenerCuota
≤≤ !
(
≤≤! "
int
≤≤" %
idCuota
≤≤& -
)
≤≤- .
{
≥≥ 	
try
¥¥ 
{
µµ 
return
∂∂ 
_db
∂∂ 
.
∂∂ 
Cuota
∂∂  
.
∂∂  !
Single
∂∂! '
(
∂∂' (
c
∂∂( )
=>
∂∂* ,
c
∂∂- .
.
∂∂. /
id
∂∂/ 1
==
∂∂2 4
idCuota
∂∂5 <
)
∂∂< =
;
∂∂= >
}
∑∑ 
catch
∏∏ 
(
∏∏ 
	Exception
∏∏ 
e
∏∏ 
)
∏∏ 
{
ππ 
throw
∫∫ 
new
∫∫ 
DatosException
∫∫ (
(
∫∫( )
$str
∫∫) A
,
∫∫A B
e
∫∫C D
)
∫∫D E
;
∫∫E F
}
ªª 
}
ºº 	
public
ææ 
Cuota
ææ 
ObtenerCuota
ææ !
(
ææ! "
long
ææ" &
idCuota
ææ' .
)
ææ. /
{
øø 	
try
¿¿ 
{
¡¡ 
return
¬¬ 
_db
¬¬ 
.
¬¬ 
Cuota
¬¬  
.
¬¬  !
Single
¬¬! '
(
¬¬' (
c
¬¬( )
=>
¬¬* ,
c
¬¬- .
.
¬¬. /
id
¬¬/ 1
==
¬¬2 4
idCuota
¬¬5 <
)
¬¬< =
;
¬¬= >
}
√√ 
catch
ƒƒ 
(
ƒƒ 
	Exception
ƒƒ 
e
ƒƒ 
)
ƒƒ 
{
≈≈ 
throw
∆∆ 
new
∆∆ 
DatosException
∆∆ (
(
∆∆( )
$str
∆∆) A
,
∆∆A B
e
∆∆C D
)
∆∆D E
;
∆∆E F
}
«« 
}
»» 	
public
ÃÃ 
Cuota
ÃÃ +
ObtenerCuotaIncluidoOperacion
ÃÃ 2
(
ÃÃ2 3
long
ÃÃ3 7
idCuota
ÃÃ8 ?
)
ÃÃ? @
{
ÕÕ 	
try
ŒŒ 
{
œœ 
return
–– 
_db
–– 
.
–– 
Cuota
––  
.
––  !
Include
––! (
(
––( )
c
––) *
=>
––+ -
c
––. /
.
––/ 0
Transaccion
––0 ;
)
––; <
.
—— 
Include
—— 
(
—— 
c
—— 
=>
—— !
c
——" #
.
——# $
Transaccion
——$ /
.
——/ 0
Actor_negocio1
——0 >
)
——> ?
.
““ 
Include
““ 
(
““ 
c
““ 
=>
““ !
c
““" #
.
““# $
Transaccion
““$ /
.
““/ 0
Actor_negocio1
““0 >
.
““> ?
Actor
““? D
.
““D E
Detalle_maestro
““E T
)
““T U
.
”” 
Include
”” 
(
”” 
c
”” 
=>
”” !
c
””" #
.
””# $
Transaccion
””$ /
.
””/ 0
Actor_negocio1
””0 >
.
””> ?
Rol
””? B
)
””B C
.
‘‘ 
Include
‘‘ 
(
‘‘ 
c
‘‘ 
=>
‘‘ !
c
‘‘" #
.
‘‘# $
Transaccion
‘‘$ /
.
‘‘/ 0
Comprobante
‘‘0 ;
)
‘‘; <
.
’’ 
Include
’’ 
(
’’ 
c
’’ 
=>
’’ !
c
’’" #
.
’’# $
Transaccion
’’$ /
.
’’/ 0!
Detalle_transaccion
’’0 C
)
’’C D
.
÷÷ 
Include
÷÷ 
(
÷÷ 
c
÷÷ 
=>
÷÷ !
c
÷÷" #
.
÷÷# $
Transaccion
÷÷$ /
.
÷÷/ 0
Actor_negocio2
÷÷0 >
)
÷÷> ?
.
◊◊ 
Single
◊◊ 
(
◊◊ 
c
◊◊ 
=>
◊◊  
c
◊◊! "
.
◊◊" #
id
◊◊# %
==
◊◊& (
idCuota
◊◊) 0
)
◊◊0 1
;
◊◊1 2
}
ÿÿ 
catch
ŸŸ 
(
ŸŸ 
	Exception
ŸŸ 
e
ŸŸ 
)
ŸŸ 
{
⁄⁄ 
throw
€€ 
new
€€ 
DatosException
€€ (
(
€€( )
$str
€€) A
,
€€A B
e
€€C D
)
€€D E
;
€€E F
}
‹‹ 
}
›› 	
public
ÈÈ 
IEnumerable
ÈÈ 
<
ÈÈ 
Cuota
ÈÈ  
>
ÈÈ  !#
ObtenerCuotasConSaldo
ÈÈ" 7
(
ÈÈ7 8
bool
ÈÈ8 <
	porCobrar
ÈÈ= F
,
ÈÈF G
int
ÈÈH K
idEstado
ÈÈL T
,
ÈÈT U
int
ÈÈV Y
[
ÈÈY Z
]
ÈÈZ [)
idsActoresDeNegocioExternos
ÈÈ\ w
,
ÈÈw x
int
ÈÈy |"
idTipoDeTransaccionÈÈ} ê
)ÈÈê ë
{
ÍÍ 	
try
ÎÎ 
{
ÏÏ 
return
ÌÌ 
_db
ÌÌ 
.
ÌÌ 
Cuota
ÌÌ  
.
ÌÌ  !
Include
ÌÌ! (
(
ÌÌ( )
c
ÌÌ) *
=>
ÌÌ+ -
c
ÌÌ. /
.
ÌÌ/ 0
Transaccion
ÌÌ0 ;
)
ÌÌ; <
.
ÌÌ< =
Include
ÌÌ= D
(
ÌÌD E
c
ÌÌE F
=>
ÌÌG I
c
ÌÌJ K
.
ÌÌK L

Pago_cuota
ÌÌL V
)
ÌÌV W
.
ÌÌW X
Where
ÌÌX ]
(
ÌÌ] ^
c
ÌÌ^ _
=>
ÌÌ` b
c
ÌÌc d
.
ÌÌd e

por_cobrar
ÌÌe o
==
ÌÌp r
	porCobrar
ÌÌs |
&&
ÌÌ} +
idsActoresDeNegocioExternosÌÌÄ õ
.ÌÌõ ú
ContainsÌÌú §
(ÌÌ§ •
cÌÌ• ¶
.ÌÌ¶ ß
TransaccionÌÌß ≤
.ÌÌ≤ ≥(
id_actor_negocio_externoÌÌ≥ À
)ÌÌÀ Ã
&&ÌÌÕ œ
cÌÌ– —
.ÌÌ— “
saldoÌÌ“ ◊
>ÌÌÿ Ÿ
$numÌÌ⁄ €
&&ÌÌ‹ ﬁ
cÌÌﬂ ‡
.ÌÌ‡ ·
TransaccionÌÌ· Ï
.ÌÌÏ Ì#
id_tipo_transaccionÌÌÌ Ä
==ÌÌÅ É#
idTipoDeTransaccionÌÌÑ ó
)ÌÌó ò
;ÌÌò ô
}
ÓÓ 
catch
ÔÔ 
(
ÔÔ 
	Exception
ÔÔ 
e
ÔÔ 
)
ÔÔ 
{
 
throw
ÒÒ 
new
ÒÒ 
DatosException
ÒÒ (
(
ÒÒ( )
$str
ÒÒ) B
,
ÒÒB C
e
ÒÒD E
)
ÒÒE F
;
ÒÒF G
}
ÚÚ 
}
ÛÛ 	
public
˚˚ 
IEnumerable
˚˚ 
<
˚˚ 
Cuota
˚˚  
>
˚˚  !#
ObtenerCuotasConSaldo
˚˚" 7
(
˚˚7 8
bool
˚˚8 <
	porCobrar
˚˚= F
,
˚˚F G
int
˚˚H K
[
˚˚K L
]
˚˚L M!
idsTiposTransaccion
˚˚N a
)
˚˚a b
{
¸¸ 	
try
˝˝ 
{
˛˛ 
var
ˇˇ 
	resultado
ˇˇ 
=
ˇˇ 
_db
ˇˇ  #
.
ˇˇ# $
Cuota
ˇˇ$ )
.
ˇˇ) *
Include
ˇˇ* 1
(
ˇˇ1 2
c
ˇˇ2 3
=>
ˇˇ4 6
c
ˇˇ7 8
.
ˇˇ8 9
Transaccion
ˇˇ9 D
)
ˇˇD E
.
ÄÄ) *
Include
ÄÄ* 1
(
ÄÄ1 2
c
ÄÄ2 3
=>
ÄÄ4 6
c
ÄÄ7 8
.
ÄÄ8 9
Transaccion
ÄÄ9 D
.
ÄÄD E
Actor_negocio1
ÄÄE S
)
ÄÄS T
.
ÅÅ) *
Include
ÅÅ* 1
(
ÅÅ1 2
c
ÅÅ2 3
=>
ÅÅ4 6
c
ÅÅ7 8
.
ÅÅ8 9
Transaccion
ÅÅ9 D
.
ÅÅD E
Actor_negocio1
ÅÅE S
.
ÅÅS T
Actor
ÅÅT Y
)
ÅÅY Z
.
ÇÇ) *
Include
ÇÇ* 1
(
ÇÇ1 2
c
ÇÇ2 3
=>
ÇÇ4 6
c
ÇÇ7 8
.
ÇÇ8 9
Transaccion
ÇÇ9 D
.
ÇÇD E
Detalle_maestro1
ÇÇE U
)
ÇÇU V
.
ÉÉ) *
Include
ÉÉ* 1
(
ÉÉ1 2
c
ÉÉ2 3
=>
ÉÉ4 6
c
ÉÉ7 8
.
ÉÉ8 9
Comprobante
ÉÉ9 D
)
ÉÉD E
.
ÑÑ) *
Where
ÑÑ* /
(
ÑÑ/ 0
c
ÑÑ0 1
=>
ÑÑ2 4
c
ÑÑ5 6
.
ÑÑ6 7

por_cobrar
ÑÑ7 A
==
ÑÑB D
	porCobrar
ÑÑE N
&&
ÖÖ) +
c
ÖÖ, -
.
ÖÖ- .
saldo
ÖÖ. 3
>
ÖÖ4 5
$num
ÖÖ6 7
&&
ÜÜ) +!
idsTiposTransaccion
ÜÜ, ?
.
ÜÜ? @
Contains
ÜÜ@ H
(
ÜÜH I
c
ÜÜI J
.
ÜÜJ K
Transaccion
ÜÜK V
.
ÜÜV W!
id_tipo_transaccion
ÜÜW j
)
ÜÜj k
)
ÜÜk l
;
ÜÜl m
return
àà 
	resultado
àà  
;
àà  !
}
ââ 
catch
ää 
(
ää 
	Exception
ää 
e
ää 
)
ää 
{
ãã 
throw
åå 
new
åå 
DatosException
åå (
(
åå( )
$str
åå) L
,
ååL M
e
ååN O
)
ååO P
;
ååP Q
}
çç 
}
éé 	
public
êê 
IEnumerable
êê 
<
êê 
Cuota
êê  
>
êê  !#
ObtenerCuotasConSaldo
êê" 7
(
êê7 8
bool
êê8 <
	porCobrar
êê= F
,
êêF G
int
êêH K
idActorNegocio
êêL Z
,
êêZ [
int
êê\ _
idTipoTransaccion
êê` q
)
êêq r
{
ëë 	
try
íí 
{
ìì 
var
îî 
	Resultado
îî 
=
îî 
_db
îî  #
.
îî# $
Cuota
îî$ )
.
îî) *
Where
îî* /
(
îî/ 0
c
îî0 1
=>
îî2 4
c
îî5 6
.
îî6 7
Transaccion
îî7 B
.
îîB C!
id_tipo_transaccion
îîC V
==
îîW Y
idTipoTransaccion
îîZ k
&&
îîl n
c
îîo p
.
îîp q

por_cobrar
îîq {
==
îî| ~
	porCobrarîî à
&&îîâ ã
cîîå ç
.îîç é
saldoîîé ì
>îîî ï
$numîîñ ó
)îîó ò
;îîò ô
return
ïï 
	Resultado
ïï  
;
ïï  !
}
ññ 
catch
óó 
(
óó 
	Exception
óó 
e
óó 
)
óó 
{
òò 
throw
ôô 
new
ôô 
DatosException
ôô (
(
ôô( )
$str
ôô) L
,
ôôL M
e
ôôN O
)
ôôO P
;
ôôP Q
}
õõ 
}
úú 	
public
ûû 
List
ûû 
<
ûû 
Cuota
ûû 
>
ûû 
ObtenerCuotas
ûû (
(
ûû( )
int
ûû) ,
[
ûû, -
]
ûû- .
	idsCuotas
ûû/ 8
)
ûû8 9
{
üü 	
try
†† 
{
°° 
return
¢¢ 
_db
¢¢ 
.
¢¢ 
Cuota
¢¢  
.
¢¢  !
Include
¢¢! (
(
¢¢( )
c
¢¢) *
=>
¢¢+ -
c
¢¢. /
.
¢¢/ 0
Transaccion
¢¢0 ;
)
¢¢; <
.
¢¢< =
Include
¢¢= D
(
¢¢D E
c
¢¢E F
=>
¢¢G I
c
¢¢J K
.
¢¢K L
Transaccion
¢¢L W
.
¢¢W X
Transaccion2
¢¢X d
)
¢¢d e
.
¢¢e f
Where
¢¢f k
(
¢¢k l
c
¢¢l m
=>
¢¢n p
	idsCuotas
¢¢q z
.
¢¢z {
Contains¢¢{ É
(¢¢É Ñ
c¢¢Ñ Ö
.¢¢Ö Ü
id¢¢Ü à
)¢¢à â
)¢¢â ä
.¢¢ä ã
ToList¢¢ã ë
(¢¢ë í
)¢¢í ì
;¢¢ì î
}
££ 
catch
§§ 
(
§§ 
	Exception
§§ 
e
§§ 
)
§§ 
{
•• 
throw
¶¶ 
new
¶¶ 
DatosException
¶¶ (
(
¶¶( )
$str
¶¶) B
,
¶¶B C
e
¶¶D E
)
¶¶E F
;
¶¶F G
}
ßß 
}
®® 	
public
©© 
OperationResult
©©  
CrearTransacciones
©© 1
(
©©1 2
List
©©2 6
<
©©6 7
Transaccion
©©7 B
>
©©B C
transacciones
©©D Q
)
©©Q R
{
™™ 	
foreach
´´ 
(
´´ 
var
´´ 
transaccion
´´ $
in
´´% '
transacciones
´´( 5
)
´´5 6
{
¨¨ 
_db
≠≠ 
.
≠≠ 
Transaccion
≠≠ 
.
≠≠  
Add
≠≠  #
(
≠≠# $
transaccion
≠≠$ /
)
≠≠/ 0
;
≠≠0 1
}
ÆÆ 
return
ØØ 
Save
ØØ 
(
ØØ 
)
ØØ 
;
ØØ 
}
∞∞ 	
public
≤≤ 
IEnumerable
≤≤ 
<
≤≤ 
int
≤≤ 
>
≤≤ *
ObtenerIdsSeriesComprobantes
≤≤  <
(
≤≤< =
int
≤≤= @
[
≤≤@ A
]
≤≤A B 
idsTipoComprobante
≤≤C U
,
≤≤U V
bool
≤≤W [
estado
≤≤\ b
)
≤≤b c
{
≥≥ 	
return
¥¥ 
_db
¥¥ 
.
¥¥ 
Serie_comprobante
¥¥ (
.
¥¥( )
Where
¥¥) .
(
¥¥. /
sc
¥¥/ 1
=>
¥¥2 4
sc
¥¥5 7
.
¥¥7 8

es_vigente
¥¥8 B
==
¥¥C E
estado
¥¥F L
&&
¥¥M O 
idsTipoComprobante
¥¥P b
.
¥¥b c
Contains
¥¥c k
(
¥¥k l
sc
¥¥l n
.
¥¥n o"
id_tipo_comprobante¥¥o Ç
)¥¥Ç É
)¥¥É Ñ
.¥¥Ñ Ö
Select¥¥Ö ã
(¥¥ã å
sc¥¥å é
=>¥¥è ë
sc¥¥í î
.¥¥î ï
id¥¥ï ó
)¥¥ó ò
;¥¥ò ô
}
µµ 	
public
∑∑ 
IEnumerable
∑∑ 
<
∑∑ 
int
∑∑ 
>
∑∑ *
ObtenerIdsSeriesComprobantes
∑∑  <
(
∑∑< =
int
∑∑= @
[
∑∑@ A
]
∑∑A B 
idsTipoComprobante
∑∑C U
)
∑∑U V
{
∏∏ 	
return
ππ 
_db
ππ 
.
ππ 
Serie_comprobante
ππ (
.
ππ( )
Where
ππ) .
(
ππ. /
sc
ππ/ 1
=>
ππ2 4 
idsTipoComprobante
ππ5 G
.
ππG H
Contains
ππH P
(
ππP Q
sc
ππQ S
.
ππS T!
id_tipo_comprobante
ππT g
)
ππg h
)
ππh i
.
ππi j
Select
ππj p
(
ππp q
sc
ππq s
=>
ππt v
sc
ππw y
.
ππy z
id
ππz |
)
ππ| }
;
ππ} ~
}
∫∫ 	
public
ºº 
OperationResult
ºº 
CrearTipoDeCambio
ºº 0
(
ºº0 1
DateTime
ºº1 9
fecha
ºº: ?
,
ºº? @
int
ººA D
idMoneda
ººE M
,
ººM N
decimal
ººO V
compra
ººW ]
,
ºº] ^
decimal
ºº_ f
venta
ººg l
)
ººl m
{
ΩΩ 	
throw
ææ 
new
ææ %
NotImplementedException
ææ -
(
ææ- .
)
ææ. /
;
ææ/ 0
}
øø 	
public
¡¡ 
OperationResult
¡¡ $
ActualizarTipoDeCambio
¡¡ 5
(
¡¡5 6
Tipo_cambio
¡¡6 A
tipo_cambio
¡¡B M
)
¡¡M N
{
¬¬ 	
throw
√√ 
new
√√ %
NotImplementedException
√√ -
(
√√- .
)
√√. /
;
√√/ 0
}
ƒƒ 	
public
∆∆ 
List
∆∆ 
<
∆∆ 
Detalle_maestro
∆∆ #
>
∆∆# $$
ObtenerTipoComprobante
∆∆% ;
(
∆∆; <
int
∆∆< ?
	idMaestro
∆∆@ I
)
∆∆I J
{
«« 	
throw
»» 
new
»» %
NotImplementedException
»» -
(
»»- .
)
»». /
;
»»/ 0
}
…… 	
public
ÀÀ 
List
ÀÀ 
<
ÀÀ /
!Tipo_transaccion_tipo_comprobante
ÀÀ 5
>
ÀÀ5 68
*obtenerTipoComprobantePorTipoDeTransaccion
ÀÀ7 a
(
ÀÀa b
int
ÀÀb e
idTipoTransaccion
ÀÀf w
,
ÀÀw x
int
ÀÀy | 
idTipoComprobanteÀÀ} é
)ÀÀé è
{
ÃÃ 	
throw
ÕÕ 
new
ÕÕ %
NotImplementedException
ÕÕ -
(
ÕÕ- .
)
ÕÕ. /
;
ÕÕ/ 0
}
ŒŒ 	
public
–– 
List
–– 
<
–– 
Cuenta_contable
–– #
>
––# $$
ObtenerCuentasContable
––% ;
(
––; <
string
––< B)
codigoInicialCuentaContable
––C ^
,
––^ _
int
––` c+
longitudCodigoCuentaContable––d Ä
)––Ä Å
{
—— 	
throw
““ 
new
““ %
NotImplementedException
““ -
(
““- .
)
““. /
;
““/ 0
}
”” 	
public
’’ 
List
’’ 
<
’’ 
Tipo_cambio
’’ 
>
’’  !
ObtenerTipoDeCambio
’’! 4
(
’’4 5
DateTime
’’5 =
desde
’’> C
,
’’C D
DateTime
’’E M
hasta
’’N S
)
’’S T
{
÷÷ 	
throw
◊◊ 
new
◊◊ %
NotImplementedException
◊◊ -
(
◊◊- .
)
◊◊. /
;
◊◊/ 0
}
ÿÿ 	
public
⁄⁄ 
long
⁄⁄ '
ObtenerUnicoIdTransaccion
⁄⁄ -
(
⁄⁄- .
long
⁄⁄. 2 
idTransaccionPadre
⁄⁄3 E
,
⁄⁄E F
int
⁄⁄G J(
idTipoTransaccionADevolver
⁄⁄K e
)
⁄⁄e f
{
€€ 	
return
‹‹ 
_db
‹‹ 
.
‹‹ 
Transaccion
‹‹ "
.
‹‹" #
SingleOrDefault
‹‹# 2
(
‹‹2 3
t
‹‹3 4
=>
‹‹5 7
t
‹‹8 9
.
‹‹9 :"
id_transaccion_padre
‹‹: N
==
‹‹O Q 
idTransaccionPadre
‹‹R d
&&
‹‹e g
t
‹‹h i
.
‹‹i j!
id_tipo_transaccion
‹‹j }
==‹‹~ Ä*
idTipoTransaccionADevolver‹‹Å õ
)‹‹õ ú
.‹‹ú ù
id‹‹ù ü
;‹‹ü †
}
›› 	
public
ﬂﬂ 
long
ﬂﬂ '
ObtenerUnicoIdTransaccion
ﬂﬂ -
(
ﬂﬂ- .
long
ﬂﬂ. 2 
idTransaccionPadre
ﬂﬂ3 E
,
ﬂﬂE F
int
ﬂﬂG J(
idTipoTransaccionADevolver
ﬂﬂK e
,
ﬂﬂe f
int
ﬂﬂg j
idUltimoEstado
ﬂﬂk y
)
ﬂﬂy z
{
‡‡ 	
return
·· 
_db
·· 
.
·· 
Transaccion
·· "
.
··" #
SingleOrDefault
··# 2
(
··2 3
t
··3 4
=>
··5 7
t
··8 9
.
··9 :"
id_transaccion_padre
··: N
==
··O Q 
idTransaccionPadre
··R d
&&
‚‚ 
t
‚‚ 
.
‚‚ !
id_tipo_transaccion
‚‚ $
==
‚‚% '(
idTipoTransaccionADevolver
‚‚( B
&&
„„ 
t
„„ 
.
„„ 
id_estado_actual
„„ !
==
„„" $
idUltimoEstado
„„% 3
)
‰‰ 
.
‰‰ 
id
‰‰ 
;
‰‰ 
}
ÂÂ 	
public
ÁÁ 
long
ÁÁ &
ObtenerIdTipoTransaccion
ÁÁ ,
(
ÁÁ, -
long
ÁÁ- 1
idTransaccion
ÁÁ2 ?
)
ÁÁ? @
{
ËË 	
return
ÈÈ 
_db
ÈÈ 
.
ÈÈ 
Transaccion
ÈÈ "
.
ÈÈ" #
SingleOrDefault
ÈÈ# 2
(
ÈÈ2 3
t
ÈÈ3 4
=>
ÈÈ5 7
t
ÈÈ8 9
.
ÈÈ9 :
id
ÈÈ: <
==
ÈÈ= ?
idTransaccion
ÈÈ@ M
)
ÈÈM N
.
ÈÈN O!
id_tipo_transaccion
ÈÈO b
;
ÈÈb c
}
ÍÍ 	
public
ÏÏ 
Tipo_cambio
ÏÏ )
ObtenerTipoDeCambioPorFecha
ÏÏ 6
(
ÏÏ6 7
DateTime
ÏÏ7 ?
fecha
ÏÏ@ E
)
ÏÏE F
{
ÌÌ 	
throw
ÓÓ 
new
ÓÓ %
NotImplementedException
ÓÓ -
(
ÓÓ- .
)
ÓÓ. /
;
ÓÓ/ 0
}
ÔÔ 	
public
ÒÒ 
Tipo_cambio
ÒÒ !
ObtenerTipoDeCambio
ÒÒ .
(
ÒÒ. /
)
ÒÒ/ 0
{
ÚÚ 	
throw
ÛÛ 
new
ÛÛ %
NotImplementedException
ÛÛ -
(
ÛÛ- .
)
ÛÛ. /
;
ÛÛ/ 0
}
ÙÙ 	
public
ˆˆ 
List
ˆˆ 
<
ˆˆ 

Existencia
ˆˆ 
>
ˆˆ  
ObtenerExistencias
ˆˆ  2
(
ˆˆ2 3
int
ˆˆ3 6
[
ˆˆ6 7
]
ˆˆ7 8!
idsConceptosNegocio
ˆˆ9 L
,
ˆˆL M
int
ˆˆN Q
idActorNegocio
ˆˆR `
)
ˆˆ` a
{
˜˜ 	
return
˘˘ 
_db
˘˘ 
.
˘˘ 

Existencia
˘˘ !
.
˘˘! "
Where
˘˘" '
(
˘˘' (
e
˘˘( )
=>
˘˘* ,
e
˘˘- .
.
˘˘. /
id_punto_atencion
˘˘/ @
==
˘˘A C
idActorNegocio
˘˘D R
&&
˘˘S U!
idsConceptosNegocio
˘˘V i
.
˘˘i j
Contains
˘˘j r
(
˘˘r s
e
˘˘s t
.
˘˘t u"
id_concepto_negocio˘˘u à
)˘˘à â
)˘˘â ä
.˘˘ä ã
ToList˘˘ã ë
(˘˘ë í
)˘˘í ì
;˘˘ì î
}
˙˙ 	
public
¸¸ 

Existencia
¸¸ 
ObtenerExistencia
¸¸ +
(
¸¸+ ,
int
¸¸, /
idConceptoNegocio
¸¸0 A
,
¸¸A B
int
¸¸C F
idPuntoAtencion
¸¸G V
)
¸¸V W
{
˝˝ 	
try
ˇˇ 
{
ÄÄ 
return
ÅÅ 
_db
ÅÅ 
.
ÅÅ 

Existencia
ÅÅ %
.
ÅÅ% &
Single
ÅÅ& ,
(
ÅÅ, -
e
ÅÅ- .
=>
ÅÅ/ 1
e
ÅÅ2 3
.
ÅÅ3 4
id_punto_atencion
ÅÅ4 E
==
ÅÅF H
idPuntoAtencion
ÅÅI X
&&
ÅÅY [
e
ÅÅ\ ]
.
ÅÅ] ^!
id_concepto_negocio
ÅÅ^ q
==
ÅÅr t 
idConceptoNegocioÅÅu Ü
)ÅÅÜ á
;ÅÅá à
}
ÇÇ 
catch
ÉÉ 
(
ÉÉ 
	Exception
ÉÉ 
e
ÉÉ 
)
ÉÉ 
{
ÑÑ 
throw
ÜÜ 
new
ÜÜ 
DatosException
ÜÜ (
(
ÜÜ( )
$str
ÜÜ) I
,
ÜÜI J
e
ÜÜK L
)
ÜÜL M
;
ÜÜM N
}
áá 
}
ââ 	
public
ãã !
Detalle_transaccion
ãã "'
ObtenerDetalleTransaccion
ãã# <
(
ãã< =
int
ãã= @#
idActorNegocioInterno
ããA V
,
ããV W
int
ããX [
idTipoTransaccion
ãã\ m
,
ããm n
int
ãão r"
idEstadoTransaccionããs Ü
,ããÜ á
intããà ã!
idConceptoNegocioããå ù
,ããù û
stringããü •#
loteConceptoNegocioãã¶ π
)ããπ ∫
{
åå 	
try
çç 
{
éé 
try
èè 
{
êê 
return
ëë 
_db
ëë 
.
ëë 
Transaccion
ëë *
.
ëë* +
SingleOrDefault
ëë+ :
(
ëë: ;
t
ëë; <
=>
ëë= ?
t
ëë@ A
.
ëëA B&
id_actor_negocio_interno
ëëB Z
==
ëë[ ]#
idActorNegocioInterno
ëë^ s
&&
íí< >
t
íí? @
.
íí@ A!
id_tipo_transaccion
ííA T
==
ííU W
idTipoTransaccion
ííX i
&&
ìì< >
t
ìì? @
.
ìì@ A
id_estado_actual
ììA Q
==
ììR T!
idEstadoTransaccion
ììU h
)
ììh i
.
îî< =!
Detalle_transaccion
îî= P
.
îîP Q
SingleOrDefault
îîQ `
(
îî` a
dt
îîa c
=>
îîd f
dt
îîg i
.
îîi j!
id_concepto_negocio
îîj }
==îî~ Ä!
idConceptoNegocioîîÅ í
&&
ïïd f
dt
ïïg i
.
ïïi j
lote
ïïj n
==
ïïo q"
loteConceptoNegocioïïr Ö
)ïïÖ Ü
;ïïÜ á
}
òò 
catch
ôô 
(
ôô 
	Exception
ôô  
e
ôô! "
)
ôô" #
{
öö 
throw
õõ 
new
õõ 
DatosException
õõ ,
(
õõ, -
$str
õõ- Y
,
õõY Z
e
õõ[ \
)
õõ\ ]
;
õõ] ^
}
úú 
}
ùù 
catch
ûû 
(
ûû 
	Exception
ûû 
e
ûû 
)
ûû 
{
üü 
throw
°° 
new
°° 
DatosException
°° (
(
°°( )
$str
°°) I
,
°°I J
e
°°K L
)
°°L M
;
°°M N
}
¢¢ 
}
§§ 	
public
ßß 
OperationResult
ßß #
CrearSerieComprobante
ßß 4
(
ßß4 5
Serie_comprobante
ßß5 F
serie
ßßG L
)
ßßL M
{
®® 	
try
©© 
{
™™ 
_db
´´ 
.
´´ 
Serie_comprobante
´´ %
.
´´% &
Add
´´& )
(
´´) *
serie
´´* /
)
´´/ 0
;
´´0 1
var
¨¨ 
result
¨¨ 
=
¨¨ 
Save
¨¨ !
(
¨¨! "
)
¨¨" #
;
¨¨# $
result
≠≠ 
.
≠≠ 
data
≠≠ 
=
≠≠ 
serie
≠≠ #
.
≠≠# $
id
≠≠$ &
;
≠≠& '
return
ÆÆ 
result
ÆÆ 
;
ÆÆ 
}
ØØ 
catch
∞∞ 
(
∞∞ 
	Exception
∞∞ 
e
∞∞ 
)
∞∞ 
{
±± 
throw
≤≤ 
new
≤≤ 
DatosException
≤≤ (
(
≤≤( )
$str
≤≤) N
,
≤≤N O
e
≤≤P Q
)
≤≤Q R
;
≤≤R S
}
¥¥ 
}
µµ 	
public
∂∂ 
OperationResult
∂∂ (
ActualizarSerieComprobante
∂∂ 9
(
∂∂9 :
Serie_comprobante
∂∂: K
updSerie
∂∂L T
)
∂∂T U
{
∑∑ 	
try
∏∏ 
{
ππ 
Serie_comprobante
∫∫ ! 
dbSerieComprobante
∫∫" 4
=
∫∫5 6
_db
∫∫7 :
.
∫∫: ;
Serie_comprobante
∫∫; L
.
∫∫L M
Single
∫∫M S
(
∫∫S T
m
∫∫T U
=>
∫∫V X
m
∫∫Y Z
.
∫∫Z [
id
∫∫[ ]
==
∫∫^ `
updSerie
∫∫a i
.
∫∫i j
id
∫∫j l
)
∫∫l m
;
∫∫m n
_db
ªª 
.
ªª 
Entry
ªª 
(
ªª  
dbSerieComprobante
ªª ,
)
ªª, -
.
ªª- .
CurrentValues
ªª. ;
.
ªª; <
	SetValues
ªª< E
(
ªªE F
updSerie
ªªF N
)
ªªN O
;
ªªO P
var
ºº 
result
ºº 
=
ºº 
Save
ºº !
(
ºº! "
)
ºº" #
;
ºº# $
result
ΩΩ 
.
ΩΩ 
data
ΩΩ 
=
ΩΩ  
dbSerieComprobante
ΩΩ 0
.
ΩΩ0 1
id
ΩΩ1 3
;
ΩΩ3 4
return
ææ 
result
ææ 
;
ææ 
}
øø 
catch
¿¿ 
(
¿¿ 
	Exception
¿¿ 
e
¿¿ 
)
¿¿ 
{
¡¡ 
throw
¬¬ 
new
¬¬ 
DatosException
¬¬ (
(
¬¬( )
$str
¬¬) S
,
¬¬S T
e
¬¬U V
)
¬¬V W
;
¬¬W X
}
√√ 
}
≈≈ 	
public
∆∆ 
IEnumerable
∆∆ 
<
∆∆ 
Serie_comprobante
∆∆ ,
>
∆∆, -&
ObtenerSeriesComprobante
∆∆. F
(
∆∆F G
)
∆∆G H
{
«« 	
try
»» 
{
…… 
return
   
_db
   
.
   
Serie_comprobante
   ,
.
  , -
ToList
  - 3
(
  3 4
)
  4 5
;
  5 6
}
ÀÀ 
catch
ÃÃ 
(
ÃÃ 
	Exception
ÃÃ 
e
ÃÃ 
)
ÃÃ 
{
ÕÕ 
throw
ŒŒ 
new
ŒŒ 
DatosException
ŒŒ (
(
ŒŒ( )
String
ŒŒ) /
.
ŒŒ/ 0
Format
ŒŒ0 6
(
ŒŒ6 7
$str
ŒŒ7 i
)
ŒŒi j
,
ŒŒj k
e
ŒŒl m
)
ŒŒm n
;
ŒŒn o
}
œœ 
}
–– 	
public
—— 
Serie_comprobante
——  '
ObtenerSerieDeComprobante
——! :
(
——: ;
int
——; >"
idSerieDeComprobante
——? S
)
——S T
{
““ 	
try
”” 
{
‘‘ 
var
’’ 
serie
’’ 
=
’’ 
_db
’’ 
.
’’  
Serie_comprobante
’’  1
.
’’1 2
SingleOrDefault
’’2 A
(
’’A B
sc
’’B D
=>
’’E G
sc
’’H J
.
’’J K
id
’’K M
==
’’N P"
idSerieDeComprobante
’’Q e
)
’’e f
;
’’f g
_db
÷÷ 
.
÷÷ 
Entry
÷÷ 
<
÷÷ 
Serie_comprobante
÷÷ +
>
÷÷+ ,
(
÷÷, -
serie
÷÷- 2
)
÷÷2 3
.
÷÷3 4
Reload
÷÷4 :
(
÷÷: ;
)
÷÷; <
;
÷÷< =
return
◊◊ 
serie
◊◊ 
;
◊◊ 
}
ÿÿ 
catch
ŸŸ 
(
ŸŸ 
	Exception
ŸŸ 
e
ŸŸ 
)
ŸŸ 
{
⁄⁄ 
throw
€€ 
new
€€ 
DatosException
€€ (
(
€€( )
String
€€) /
.
€€/ 0
Format
€€0 6
(
€€6 7
$str
€€7 d
,
€€d e"
idSerieDeComprobante
€€f z
)
€€z {
,
€€{ |
e
€€} ~
)
€€~ 
;€€ Ä
}
‹‹ 
}
›› 	
public
ﬁﬁ 
Serie_comprobante
ﬁﬁ  M
?ObtenerPrimeraSerieDeComprobantePorCentroDeAtencionYComprobante
ﬁﬁ! `
(
ﬁﬁ` a
int
ﬁﬁa d
idTipoComprobante
ﬁﬁe v
,
ﬁﬁv w
int
ﬁﬁx {
idCentroAtencionﬁﬁ| å
)ﬁﬁå ç
{
ﬂﬂ 	
try
‡‡ 
{
·· 
return
‚‚ 
_db
‚‚ 
.
‚‚ 
Serie_comprobante
‚‚ ,
.
‚‚, -
FirstOrDefault
‚‚- ;
(
‚‚; <
sc
‚‚< >
=>
‚‚? A
sc
‚‚B D
.
‚‚D E!
id_tipo_comprobante
‚‚E X
==
‚‚Y [
idTipoComprobante
‚‚\ m
&&
‚‚n p
sc
‚‚q s
.
‚‚s t
id_propietario‚‚t Ç
==‚‚É Ö 
idCentroAtencion‚‚Ü ñ
)‚‚ñ ó
;‚‚ó ò
}
„„ 
catch
‰‰ 
(
‰‰ 
	Exception
‰‰ 
e
‰‰ 
)
‰‰ 
{
ÂÂ 
throw
ÊÊ 
new
ÊÊ 
DatosException
ÊÊ (
(
ÊÊ( )
String
ÊÊ) /
.
ÊÊ/ 0
Format
ÊÊ0 6
(
ÊÊ6 7
$strÊÊ7 ¶
,ÊÊ¶ ß!
idTipoComprobanteÊÊ® π
,ÊÊπ ∫ 
idCentroAtencionÊÊª À
)ÊÊÀ Ã
,ÊÊÃ Õ
eÊÊŒ œ
)ÊÊœ –
;ÊÊ– —
}
ËË 
}
ÈÈ 	
public
ÍÍ 
Serie_comprobante
ÍÍ  Z
LObtenerPrimeraSerieDeComprobantePorCentroDeAtencionYComprobanteYPrefijoSerie
ÍÍ! m
(
ÍÍm n
int
ÍÍn q 
idTipoComprobanteÍÍr É
,ÍÍÉ Ñ
intÍÍÖ à 
idCentroAtencionÍÍâ ô
,ÍÍô ö
stringÍÍõ °
prefijoSerieÍÍ¢ Æ
)ÍÍÆ Ø
{
ÎÎ 	
try
ÏÏ 
{
ÌÌ 
return
ÓÓ 
_db
ÓÓ 
.
ÓÓ 
Serie_comprobante
ÓÓ ,
.
ÓÓ, -
FirstOrDefault
ÓÓ- ;
(
ÓÓ; <
sc
ÓÓ< >
=>
ÓÓ? A
sc
ÓÓB D
.
ÓÓD E!
id_tipo_comprobante
ÓÓE X
==
ÓÓY [
idTipoComprobante
ÓÓ\ m
&&
ÓÓn p
sc
ÓÓq s
.
ÓÓs t
id_propietarioÓÓt Ç
==ÓÓÉ Ö 
idCentroAtencionÓÓÜ ñ
&&ÓÓó ô
scÓÓö ú
.ÓÓú ù
numeroÓÓù £
.ÓÓ£ §

StartsWithÓÓ§ Æ
(ÓÓÆ Ø
prefijoSerieÓÓØ ª
)ÓÓª º
)ÓÓº Ω
;ÓÓΩ æ
}
ÔÔ 
catch
 
(
 
	Exception
 
e
 
)
 
{
ÒÒ 
throw
ÚÚ 
new
ÚÚ 
DatosException
ÚÚ (
(
ÚÚ( )
String
ÚÚ) /
.
ÚÚ/ 0
Format
ÚÚ0 6
(
ÚÚ6 7
$strÚÚ7 ¶
,ÚÚ¶ ß!
idTipoComprobanteÚÚ® π
,ÚÚπ ∫ 
idCentroAtencionÚÚª À
)ÚÚÀ Ã
,ÚÚÃ Õ
eÚÚŒ œ
)ÚÚœ –
;ÚÚ– —
}
ÙÙ 
}
ıı 	
public
ˆˆ 
Serie_comprobante
ˆˆ  ;
-ObtenerPrimeraSerieDeComprobanteAutonumerable
ˆˆ! N
(
ˆˆN O
int
ˆˆO R
idTipoComprobante
ˆˆS d
,
ˆˆd e
int
ˆˆf i
idCentroAtencion
ˆˆj z
)
ˆˆz {
{
˜˜ 	
try
¯¯ 
{
˘˘ 
return
˙˙ 
_db
˙˙ 
.
˙˙ 
Serie_comprobante
˙˙ ,
.
˙˙, -
FirstOrDefault
˙˙- ;
(
˙˙; <
sc
˙˙< >
=>
˙˙? A
sc
˙˙B D
.
˙˙D E!
id_tipo_comprobante
˙˙E X
==
˙˙Y [
idTipoComprobante
˙˙\ m
&&
˙˙n p
sc
˙˙q s
.
˙˙s t
id_propietario˙˙t Ç
==˙˙É Ö 
idCentroAtencion˙˙Ü ñ
&&˙˙ó ô
sc˙˙ö ú
.˙˙ú ù 
es_autonumerable˙˙ù ≠
==˙˙Æ ∞
true˙˙± µ
)˙˙µ ∂
;˙˙∂ ∑
}
˚˚ 
catch
¸¸ 
(
¸¸ 
	Exception
¸¸ 
e
¸¸ 
)
¸¸ 
{
˝˝ 
throw
˛˛ 
new
˛˛ 
DatosException
˛˛ (
(
˛˛( )
String
˛˛) /
.
˛˛/ 0
Format
˛˛0 6
(
˛˛6 7
$str˛˛7 ≥
,˛˛≥ ¥!
idTipoComprobante˛˛µ ∆
,˛˛∆ « 
idCentroAtencion˛˛» ÿ
)˛˛ÿ Ÿ
,˛˛Ÿ ⁄
e˛˛€ ‹
)˛˛‹ ›
;˛˛› ﬁ
}
ˇˇ 
}
ÄÄ 	
public
ÇÇ 
bool
ÇÇ <
.ExisteSerieDeComprobanteSegunTipoDeComprobante
ÇÇ B
(
ÇÇB C
int
ÇÇC F
idTipoComprobante
ÇÇG X
,
ÇÇX Y
string
ÇÇZ `
numeroDeSerie
ÇÇa n
)
ÇÇn o
{
ÉÉ 	
return
ÑÑ 
_db
ÑÑ 
.
ÑÑ 
Serie_comprobante
ÑÑ (
.
ÑÑ( )
Any
ÑÑ) ,
(
ÑÑ, -
sc
ÑÑ- /
=>
ÑÑ0 2
sc
ÑÑ3 5
.
ÑÑ5 6!
id_tipo_comprobante
ÑÑ6 I
==
ÑÑJ L
idTipoComprobante
ÑÑM ^
&&
ÑÑ_ a
sc
ÑÑb d
.
ÑÑd e
numero
ÑÑe k
==
ÑÑl n
numeroDeSerie
ÑÑo |
)
ÑÑ| }
;
ÑÑ} ~
}
ÖÖ 	
public
ãã 
OperationResult
ãã "
CrearTipoTransaccion
ãã 3
(
ãã3 4
Tipo_transaccion
ãã4 D
tipoDeTransaccion
ããE V
)
ããV W
{
åå 	
try
çç 
{
èè 
_db
êê 
.
êê 
Tipo_transaccion
êê $
.
êê$ %
Add
êê% (
(
êê( )
tipoDeTransaccion
êê) :
)
êê: ;
;
êê; <
var
ëë 
result
ëë 
=
ëë 
Save
ëë !
(
ëë! "
)
ëë" #
;
ëë# $
result
íí 
.
íí 
data
íí 
=
íí 
tipoDeTransaccion
íí /
.
íí/ 0
id
íí0 2
;
íí2 3
return
ìì 
result
ìì 
;
ìì 
}
îî 
catch
ïï 
(
ïï 
	Exception
ïï 
e
ïï 
)
ïï 
{
ññ 
throw
óó 
e
óó 
;
óó 
}
òò 
}
ôô 	
public
öö 
OperationResult
öö 7
)ActualizarTipoTransaccionConAccionNegocio
öö H
(
ööH I
Tipo_transaccion
ööI Y
tipoTransaccion
ööZ i
)
ööi j
{
õõ 	
try
úú 
{
ùù 
Tipo_transaccion
ûû  
dbTipoTransaccion
ûû! 2
=
ûû3 4
_db
ûû5 8
.
ûû8 9
Tipo_transaccion
ûû9 I
.
ûûI J
Single
ûûJ P
(
ûûP Q
tt
ûûQ S
=>
ûûT V
tt
ûûW Y
.
ûûY Z
id
ûûZ \
==
ûû] _
tipoTransaccion
ûû` o
.
ûûo p
id
ûûp r
)
ûûr s
;
ûûs t
tipoTransaccion
üü 
.
üü  
nombre_corto
üü  ,
=
üü- .
dbTipoTransaccion
üü/ @
.
üü@ A
nombre_corto
üüA M
;
üüM N
_db
†† 
.
†† 
Entry
†† 
(
†† 
dbTipoTransaccion
†† +
)
††+ ,
.
††, -
CurrentValues
††- :
.
††: ;
	SetValues
††; D
(
††D E
tipoTransaccion
††E T
)
††T U
;
††U V
List
¢¢ 
<
¢¢ 4
&Accion_de_negocio_por_tipo_transaccion
¢¢ ;
>
¢¢; <9
+updAcciones_de_negocio_por_tipo_transaccion
¢¢= h
=
¢¢i j
tipoTransaccion
¢¢k z
.
¢¢z {5
&Accion_de_negocio_por_tipo_transaccion¢¢{ °
.¢¢° ¢
ToList¢¢¢ ®
(¢¢® ©
)¢¢© ™
;¢¢™ ´
List
££ 
<
££ 4
&Accion_de_negocio_por_tipo_transaccion
££ ;
>
££; <8
*dbAcciones_de_negocio_por_tipo_transaccion
££= g
=
££h i
dbTipoTransaccion
££j {
.
££{ |5
&Accion_de_negocio_por_tipo_transaccion££| ¢
.££¢ £
ToList£££ ©
(££© ™
)££™ ´
;££´ ¨
foreach
•• 
(
•• 
var
•• 
dbadnptt
•• %
in
••& (8
*dbAcciones_de_negocio_por_tipo_transaccion
••) S
)
••S T
{
¶¶ 
if
ßß 
(
ßß 9
+updAcciones_de_negocio_por_tipo_transaccion
ßß C
.
ßßC D
Any
ßßD G
(
ßßG H
	updadnptt
ßßH Q
=>
ßßR T
	updadnptt
ßßU ^
.
ßß^ _
id
ßß_ a
==
ßßb d
dbadnptt
ßße m
.
ßßm n
id
ßßn p
)
ßßp q
)
ßßq r
{
®® 
var
©© 
tttc
©©  
=
©©! "9
+updAcciones_de_negocio_por_tipo_transaccion
©©# N
.
©©N O
Single
©©O U
(
©©U V
	updadnptt
©©V _
=>
©©` b
	updadnptt
©©c l
.
©©l m
id
©©m o
==
©©p r
dbadnptt
©©s {
.
©©{ |
id
©©| ~
)
©©~ 
;©© Ä
_db
™™ 
.
™™ 
Entry
™™ !
(
™™! "
dbadnptt
™™" *
)
™™* +
.
™™+ ,
CurrentValues
™™, 9
.
™™9 :
	SetValues
™™: C
(
™™C D
tttc
™™D H
)
™™H I
;
™™I J
}
´´ 
else
¨¨ 
{
≠≠ 
_db
ÆÆ 
.
ÆÆ 4
&Accion_de_negocio_por_tipo_transaccion
ÆÆ B
.
ÆÆB C
Remove
ÆÆC I
(
ÆÆI J
dbadnptt
ÆÆJ R
)
ÆÆR S
;
ÆÆS T
}
ØØ 
}
∞∞ 
foreach
±± 
(
±± 
var
±± 
	updadnptt
±± &
in
±±' )9
+updAcciones_de_negocio_por_tipo_transaccion
±±* U
)
±±U V
{
≤≤ 
if
≥≥ 
(
≥≥ 
!
≥≥ 8
*dbAcciones_de_negocio_por_tipo_transaccion
≥≥ C
.
≥≥C D
Any
≥≥D G
(
≥≥G H
d
≥≥H I
=>
≥≥J L
d
≥≥M N
.
≥≥N O
id
≥≥O Q
==
≥≥R T
	updadnptt
≥≥U ^
.
≥≥^ _
id
≥≥_ a
)
≥≥a b
)
≥≥b c
{
¥¥ 
_db
µµ 
.
µµ 4
&Accion_de_negocio_por_tipo_transaccion
µµ B
.
µµB C
Add
µµC F
(
µµF G
	updadnptt
µµG P
)
µµP Q
;
µµQ R
}
∂∂ 
}
∑∑ 
var
ππ 
result
ππ 
=
ππ 
Save
ππ !
(
ππ! "
)
ππ" #
;
ππ# $
result
∫∫ 
.
∫∫ 
data
∫∫ 
=
∫∫ 
tipoTransaccion
∫∫ -
.
∫∫- .
id
∫∫. 0
;
∫∫0 1
return
ªª 
result
ªª 
;
ªª 
}
ºº 
catch
ΩΩ 
(
ΩΩ 
	Exception
ΩΩ 
e
ΩΩ 
)
ΩΩ 
{
ææ 
return
øø 
new
øø 
OperationResult
øø *
(
øø* +
e
øø+ ,
)
øø, -
;
øø- .
}
¿¿ 
}
¡¡ 	
public
¬¬ 
IEnumerable
¬¬ 
<
¬¬ 
Tipo_transaccion
¬¬ +
>
¬¬+ ,>
0ObtenerTiposDeTransaccionIncluidoAccionDeNegocio
¬¬- ]
(
¬¬] ^
)
¬¬^ _
{
√√ 	
try
ƒƒ 
{
≈≈ 
return
∆∆ 
_db
∆∆ 
.
∆∆ 
Tipo_transaccion
∆∆ +
.
∆∆+ ,
Include
∆∆, 3
(
∆∆3 4
tt
∆∆4 6
=>
∆∆7 9
tt
∆∆: <
.
∆∆< =4
&Accion_de_negocio_por_tipo_transaccion
∆∆= c
)
∆∆c d
.
««+ ,
Include
««, 3
(
««3 4
tt
««4 6
=>
««7 9
tt
««: <
.
««< =4
&Accion_de_negocio_por_tipo_transaccion
««= c
.
««c d
Select
««d j
(
««j k
an
««k m
=>
««n p
an
««q s
.
««s t 
Accion_de_negocio««t Ö
)««Ö Ü
)««Ü á
.
»»+ ,
OrderBy
»», 3
(
»»3 4
tp
»»4 6
=>
»»7 9
tp
»»: <
.
»»< =
nombre
»»= C
)
»»C D
;
»»D E
}
…… 
catch
   
(
   
	Exception
   
e
   
)
   
{
ÀÀ 
throw
ÃÃ 
e
ÃÃ 
;
ÃÃ 
}
ÕÕ 
}
ŒŒ 	
public
œœ 
Tipo_transaccion
œœ =
/ObtenerTipoDeTransaccionIncluidoAccionDeNegocio
œœ  O
(
œœO P
int
œœP S!
idTipoDeTransaccion
œœT g
)
œœg h
{
–– 	
try
—— 
{
““ 
return
”” 
_db
”” 
.
”” 
Tipo_transaccion
”” +
.
””+ ,
Include
””, 3
(
””3 4
tt
””4 6
=>
””7 9
tt
””: <
.
””< =4
&Accion_de_negocio_por_tipo_transaccion
””= c
)
””c d
.
‘‘+ ,
Include
‘‘, 3
(
‘‘3 4
tt
‘‘4 6
=>
‘‘7 9
tt
‘‘: <
.
‘‘< =4
&Accion_de_negocio_por_tipo_transaccion
‘‘= c
.
‘‘c d
Select
‘‘d j
(
‘‘j k
an
‘‘k m
=>
‘‘n p
an
‘‘q s
.
‘‘s t 
Accion_de_negocio‘‘t Ö
)‘‘Ö Ü
)‘‘Ü á
.
’’+ ,
SingleOrDefault
’’, ;
(
’’; <
tdt
’’< ?
=>
’’@ B
tdt
’’C F
.
’’F G
id
’’G I
==
’’J L!
idTipoDeTransaccion
’’M `
)
’’` a
;
’’a b
}
÷÷ 
catch
◊◊ 
(
◊◊ 
	Exception
◊◊ 
e
◊◊ 
)
◊◊ 
{
ÿÿ 
throw
ŸŸ 
e
ŸŸ 
;
ŸŸ 
}
⁄⁄ 
}
€€ 	
public
›› 
IEnumerable
›› 
<
›› 
ItemGenerico
›› '
>
››' (8
*ObtenerTipoDeTransaccionPorAccionDeNegocio
››) S
(
››S T
int
››T W
idAccionNegocio
››X g
,
››g h
bool
››i m
valor
››n s
)
››s t
{
ﬁﬁ 	
try
ﬂﬂ 
{
‡‡ 
return
·· 
_db
·· 
.
·· 4
&Accion_de_negocio_por_tipo_transaccion
·· A
.
··A B
Where
··B G
(
··G H
antt
··H L
=>
··M O
antt
··P T
.
··T U"
id_accion_de_negocio
··U i
==
··j l
idAccionNegocio
··m |
&&
··} 
antt··Ä Ñ
.··Ñ Ö
valor··Ö ä
==··ã ç
valor··é ì
)··ì î
.··î ï
Select··ï õ
(··õ ú
an··ú û
=>··ü °
an··¢ §
.··§ • 
Tipo_transaccion··• µ
)··µ ∂
.··∂ ∑
Select··∑ Ω
(··Ω æ
an··æ ¿
=>··¡ √
new
‚‚ 
ItemGenerico
‚‚ #
{
„„ 
Id
‰‰ 
=
‰‰ 
an
‰‰ 
.
‰‰ 
id
‰‰ !
,
‰‰! "
Nombre
ÂÂ 
=
ÂÂ 
an
ÂÂ  "
.
ÂÂ" #
nombre
ÂÂ# )
}
ÊÊ 
)
ÊÊ 
;
ÊÊ 
}
ÁÁ 
catch
ËË 
(
ËË 
	Exception
ËË 
e
ËË 
)
ËË 
{
ÈÈ 
throw
ÍÍ 
e
ÍÍ 
;
ÍÍ 
}
ÎÎ 
}
ÏÏ 	
public
ÛÛ 
IEnumerable
ÛÛ 
<
ÛÛ 
Accion_de_negocio
ÛÛ ,
>
ÛÛ, -&
ObtenerAccionesDeNegocio
ÛÛ. F
(
ÛÛF G
)
ÛÛG H
{
ÙÙ 	
try
ıı 
{
ˆˆ 
return
˜˜ 
_db
˜˜ 
.
˜˜ 
Accion_de_negocio
˜˜ ,
.
˜˜, -
OrderBy
˜˜- 4
(
˜˜4 5
an
˜˜5 7
=>
˜˜8 :
an
˜˜; =
.
˜˜= >
nombre
˜˜> D
)
˜˜D E
;
˜˜E F
}
¯¯ 
catch
˘˘ 
(
˘˘ 
	Exception
˘˘ 
e
˘˘ 
)
˘˘ 
{
˙˙ 
throw
˚˚ 
e
˚˚ 
;
˚˚ 
}
¸¸ 
}
˝˝ 	
public
ˇˇ 
IEnumerable
ˇˇ 
<
ˇˇ 
long
ˇˇ 
>
ˇˇ  H
:ObtenerTransaccionesInclusiveActoresYDetalleMaestroYEstado
ˇˇ! [
(
ˇˇ[ \
int
ˇˇ\ _
[
ˇˇ_ `
]
ˇˇ` a!
idsTiposTransaccion
ˇˇb u
,
ˇˇu v
int
ˇˇw z
[
ˇˇz {
]
ˇˇ{ |#
idsTiposComprobantesˇˇ} ë
,ˇˇë í
intˇˇì ñ
idEstadoˇˇó ü
)ˇˇü †
{
ÄÄ 	
throw
ÅÅ 
new
ÅÅ %
NotImplementedException
ÅÅ -
(
ÅÅ- .
)
ÅÅ. /
;
ÅÅ/ 0
}
ÇÇ 	
public
ÜÜ 
IEnumerable
ÜÜ 
<
ÜÜ !
Deuda_Actor_Negocio
ÜÜ .
>
ÜÜ. /=
/ObtenerDeudasActorNegocioPorVinculoActorNegocio
ÜÜ0 _
(
ÜÜ_ `
int
ÜÜ` c!
idTipoDeTransaccion
ÜÜd w
,
ÜÜw x
int
ÜÜy |&
idActorNegocioPrincipalÜÜ} î
,ÜÜî ï
intÜÜñ ô
tipoDeVinculoÜÜö ß
,ÜÜß ®
DateTimeÜÜ© ±
fechaÜÜ≤ ∑
,ÜÜ∑ ∏
intÜÜπ º4
$idParametroComprobantePredeterminadoÜÜΩ ·
)ÜÜ· ‚
{
áá 	
try
àà 
{
ââ 
var
ää 
deudas
ää 
=
ää 
_db
ää  
.
ää  !#
Vinculo_Actor_Negocio
ää! 6
.
ää6 7
Where
ää7 <
(
ää< =
van
ää= @
=>
ääA C
van
ääD G
.
ääG H(
id_actor_negocio_principal
ääH b
==
ääc e%
idActorNegocioPrincipal
ääf }
&&ää~ Ä
vanääÅ Ñ
.ääÑ Ö
tipo_vinculoääÖ ë
==ääí î
tipoDeVinculoääï ¢
&&ää£ •
vanää¶ ©
.ää© ™

es_vigenteää™ ¥
==ääµ ∑
trueää∏ º
)ääº Ω
.
ãã( )
Select
ãã) /
(
ãã/ 0
van
ãã0 3
=>
ãã4 6
van
ãã7 :
.
ãã: ;
Actor_negocio1
ãã; I
)
ããI J
.
çç( )
Select
çç) /
(
çç/ 0
an
çç0 2
=>
çç3 5
new
çç6 9!
Deuda_Actor_Negocio
çç: M
(
ççM N
)
ççN O
{
éé( )
Actor
èè, 1
=
èè2 3
an
èè4 6
.
èè6 7
Actor
èè7 <
,
èè< =
ActorNegocio
êê, 8
=
êê9 :
an
êê; =
,
êê= >

TotalOrden
ëë, 6
=
ëë7 8
an
ëë9 ;
.
ëë; <
Transaccion1
ëë< H
.
ëëH I
Where
ëëI N
(
ëëN O
t
ëëO P
=>
ëëQ S
t
ëëT U
.
ëëU V
fecha_inicio
ëëV b
<=
ëëc e
fecha
ëëf k
)
ëëk l
.
ëël m

SelectMany
ëëm w
(
ëëw x
t
ëëx y
=>
ëëz |
t
ëë} ~
.
ëë~ 
Cuotaëë Ñ
)ëëÑ Ö
.ëëÖ Ü
WhereëëÜ ã
(ëëã å
cëëå ç
=>ëëé ê
cëëë í
.ëëí ì

por_cobrarëëì ù
==ëëû †
trueëë° •
)ëë• ¶
.
ííH I
Sum
ííI L
(
ííL M
c
ííM N
=>
ííO Q
c
ííR S
.
ííS T
total
ííT Y
)
ííY Z
,
ííZ [
TotalPagoCuota
ìì, :
=
ìì; <
an
ìì= ?
.
ìì? @
Transaccion1
ìì@ L
.
ììL M

SelectMany
ììM W
(
ììW X
t
ììX Y
=>
ììZ \
t
ìì] ^
.
ìì^ _
Cuota
ìì_ d
)
ììd e
.
ììe f
Where
ììf k
(
ììk l
c
ììl m
=>
ììn p
c
ììq r
.
ììr s

por_cobrar
ììs }
==ìì~ Ä
trueììÅ Ö
)ììÖ Ü
.ììÜ á

SelectManyììá ë
(ììë í
cììí ì
=>ììî ñ
cììó ò
.ììò ô

Pago_cuotaììô £
)ìì£ §
.ìì§ •
Whereìì• ™
(ìì™ ´
pgìì´ ≠
=>ììÆ ∞
pgìì± ≥
.ìì≥ ¥
Transaccionìì¥ ø
.ììø ¿
fecha_inicioìì¿ Ã
<=ììÕ œ
fechaìì– ’
)ìì’ ÷
.ìì÷ ◊
Sumìì◊ ⁄
(ìì⁄ €
pcìì€ ›
=>ììﬁ ‡
pcìì· „
.ìì„ ‰
importeìì‰ Î
)ììÎ Ï
,ììÏ Ì-
IdTipoComprobantePredeterminado
îî, K
=
îîL M
an
îîN P
.
îîP Q%
Parametro_actor_negocio
îîQ h
.
îîh i
FirstOrDefault
îîi w
(
îîw x
pan
îîx {
=>
îî| ~
panîî Ç
.îîÇ É
id_parametroîîÉ è
==îîê í4
$idParametroComprobantePredeterminadoîîì ∑
)îî∑ ∏
==îîπ ª
nullîîº ¿
?îî¡ ¬
$strîî√ ∆
:îî« »
anîî… À
.îîÀ Ã'
Parametro_actor_negocioîîÃ „
.îî„ ‰
FirstOrDefaultîî‰ Ú
(îîÚ Û
panîîÛ ˆ
=>îî˜ ˘
panîî˙ ˝
.îî˝ ˛
id_parametroîî˛ ä
==îîã ç4
$idParametroComprobantePredeterminadoîîé ≤
)îî≤ ≥
.îî≥ ¥
valorîî¥ π
}
ïï( )
)
ïï) *
;
ïï* +
return
ññ 
deudas
ññ 
;
ññ 
}
óó 
catch
òò 
(
òò 
	Exception
òò 
e
òò 
)
òò 
{
ôô 
throw
öö 
new
öö 
DatosException
öö (
(
öö( )
$str
öö) K
,
ööK L
e
ööM N
)
ööN O
;
ööO P
}
õõ 
}
úú 	
public
®® 
DateTime
®® 
?
®® ,
ObtenerFechaPrimeraTransaccion
®® 7
(
®®7 8
int
®®8 ;#
idActorNegocioInterno
®®< Q
)
®®Q R
{
©© 	
var
™™ 
result
™™ 
=
™™ 
_db
™™ 
.
™™ 
Transaccion
™™ (
.
™™( )
OrderBy
™™) 0
(
™™0 1
t
™™1 2
=>
™™3 5
t
™™6 7
.
™™7 8
fecha_inicio
™™8 D
)
™™D E
.
™™E F
FirstOrDefault
™™F T
(
™™T U
t
™™U V
=>
™™W Y
t
™™Z [
.
™™[ \&
id_actor_negocio_interno
™™\ t
==
™™u w$
idActorNegocioInterno™™x ç
)™™ç é
;™™é è
return
´´ 
result
´´ 
!=
´´ 
null
´´ !
?
´´" #
(
´´$ %
DateTime
´´% -
?
´´- .
)
´´. /
result
´´/ 5
.
´´5 6
fecha_inicio
´´6 B
:
´´C D
null
´´E I
;
´´I J
}
¨¨ 	
public
ÆÆ 
DateTime
ÆÆ 
?
ÆÆ ,
ObtenerFechaPrimeraTransaccion
ÆÆ 7
(
ÆÆ7 8
)
ÆÆ8 9
{
ØØ 	
var
∞∞ 
result
∞∞ 
=
∞∞ 
_db
∞∞ 
.
∞∞ 
Transaccion
∞∞ (
.
∞∞( )
OrderBy
∞∞) 0
(
∞∞0 1
t
∞∞1 2
=>
∞∞3 5
t
∞∞6 7
.
∞∞7 8
fecha_inicio
∞∞8 D
)
∞∞D E
.
∞∞E F
FirstOrDefault
∞∞F T
(
∞∞T U
)
∞∞U V
;
∞∞V W
return
±± 
result
±± 
!=
±± 
null
±± !
?
±±" #
(
±±$ %
DateTime
±±% -
?
±±- .
)
±±. /
result
±±/ 5
.
±±5 6
fecha_inicio
±±6 B
:
±±C D
null
±±E I
;
±±I J
}
≤≤ 	
public
¥¥ 
DateTime
¥¥ 
?
¥¥ 4
&ObtenerFechaPrimeraTransaccionGenerica
¥¥ ?
(
¥¥? @
int
¥¥@ C'
idTipoTransaccionGenerica
¥¥D ]
)
¥¥] ^
{
µµ 	
var
∂∂ 
result
∂∂ 
=
∂∂ 
_db
∂∂ 
.
∂∂ 
Transaccion
∂∂ (
.
∂∂( )
Where
∂∂) .
(
∂∂. /
t
∂∂/ 0
=>
∂∂1 3
t
∂∂4 5
.
∂∂5 6!
id_tipo_transaccion
∂∂6 I
==
∂∂J L'
idTipoTransaccionGenerica
∂∂M f
)
∂∂f g
.
∂∂g h
OrderByDescending
∂∂h y
(
∂∂y z
t
∂∂z {
=>
∂∂| ~
t∂∂ Ä
.∂∂Ä Å
id∂∂Å É
)∂∂É Ñ
.∂∂Ñ Ö
FirstOrDefault∂∂Ö ì
(∂∂ì î
)∂∂î ï
;∂∂ï ñ
return
∑∑ 
result
∑∑ 
!=
∑∑ 
null
∑∑ !
?
∑∑" #
(
∑∑$ %
DateTime
∑∑% -
?
∑∑- .
)
∑∑. /
result
∑∑/ 5
.
∑∑5 6
fecha_inicio
∑∑6 B
:
∑∑C D
null
∑∑E I
;
∑∑I J
}
∏∏ 	
public
∫∫ 
DateTime
∫∫ 
?
∫∫ Z
LObtenerFechaUltimaTransaccionDeAlgunoDeLosActoresVinculadosSegunTransaccion1
∫∫ e
(
∫∫e f
int
∫∫f i&
idActorNegocioPrincipal∫∫j Å
,∫∫Å Ç
int∫∫É Ü9
)idTipoTransaccionCobranzaFacturasClientes∫∫á ∞
,∫∫∞ ±
DateTime∫∫≤ ∫
fechaMaxima∫∫ª ∆
)∫∫∆ «
{
ªª 	
DateTime
ºº 
?
ºº 
fecha
ºº 
=
ºº 
null
ºº "
;
ºº" #
try
ΩΩ 
{
ææ 
var
¿¿ 
ultimaTransaccion
¿¿ %
=
¿¿& '
_db
¿¿( +
.
¿¿+ ,#
Vinculo_Actor_Negocio
¿¿, A
.
¿¿A B
Where
¿¿B G
(
¿¿G H
van
¿¿H K
=>
¿¿L N
van
¿¿O R
.
¿¿R S(
id_actor_negocio_principal
¿¿S m
==
¿¿n p&
idActorNegocioPrincipal¿¿q à
)¿¿à â
.
¡¡ 
Select
¡¡ 
(
¡¡ 
van
¡¡ 
=>
¡¡  "
van
¡¡# &
.
¡¡& '
Actor_negocio1
¡¡' 5
)
¡¡5 6
.
¡¡6 7

SelectMany
¡¡7 A
(
¡¡A B
an
¡¡B D
=>
¡¡E G
an
¡¡H J
.
¡¡J K
Transaccion1
¡¡K W
)
¡¡W X
.
¬¬ 
Where
¬¬ 
(
¬¬ 
t
¬¬ 
=>
¬¬ 
t
¬¬  !
.
¬¬! "!
id_tipo_transaccion
¬¬" 5
==
¬¬6 87
)idTipoTransaccionCobranzaFacturasClientes
¬¬9 b
&&
¬¬c e
t
¬¬f g
.
¬¬g h
fecha_inicio
¬¬h t
<=
¬¬u w
fechaMaxima¬¬x É
)¬¬É Ñ
.
√√ 
OrderByDescending
√√ &
(
√√& '
t
√√' (
=>
√√) +
t
√√, -
.
√√- .
fecha_inicio
√√. :
)
√√: ;
.
√√; <
FirstOrDefault
√√< J
(
√√J K
)
√√K L
;
√√L M
fecha
∆∆ 
=
∆∆ 
ultimaTransaccion
∆∆ )
!=
∆∆* ,
null
∆∆- 1
?
∆∆2 3
(
∆∆4 5
DateTime
∆∆5 =
?
∆∆= >
)
∆∆> ?
ultimaTransaccion
∆∆? P
.
∆∆P Q
fecha_inicio
∆∆Q ]
:
∆∆^ _
null
∆∆` d
;
∆∆d e
return
«« 
fecha
«« 
;
«« 
}
…… 
catch
   
(
   
	Exception
   
e
   
)
   
{
ÀÀ 
throw
ÕÕ 
new
ÕÕ 
DatosException
ÕÕ (
(
ÕÕ( )
$str
ÕÕ) p
,
ÕÕp q
e
ÕÕr s
)
ÕÕs t
;
ÕÕt u
}
ŒŒ 
}
œœ 	
public
—— 
DateTime
—— 
?
—— >
0ObtenerFechaUltimaTransaccionActorNegocioExterno
—— I
(
——I J
int
——J M#
idActorNegocioExterno
——N c
,
——c d
int
——e h8
)idTipoTransaccionCobranzaFacturasClientes——i í
,——í ì
DateTime——î ú
fechaMaxima——ù ®
)——® ©
{
““ 	
DateTime
”” 
?
”” 
fecha
”” 
=
”” 
null
”” "
;
””" #
try
‘‘ 
{
’’ 
var
◊◊ 
ultimaTransaccion
◊◊ %
=
◊◊& '
_db
◊◊( +
.
◊◊+ ,
Actor_negocio
◊◊, 9
.
◊◊9 :
Where
◊◊: ?
(
◊◊? @
an
◊◊@ B
=>
◊◊C E
an
◊◊F H
.
◊◊H I
id
◊◊I K
==
◊◊L N#
idActorNegocioExterno
◊◊O d
)
◊◊d e
.
◊◊e f

SelectMany
◊◊f p
(
◊◊p q
an
◊◊q s
=>
◊◊t v
an
◊◊w y
.
◊◊y z
Transaccion1◊◊z Ü
)◊◊Ü á
.
ÿÿ 
Where
ÿÿ 
(
ÿÿ 
t
ÿÿ 
=>
ÿÿ 
t
ÿÿ  !
.
ÿÿ! "!
id_tipo_transaccion
ÿÿ" 5
==
ÿÿ6 87
)idTipoTransaccionCobranzaFacturasClientes
ÿÿ9 b
&&
ÿÿc e
t
ÿÿf g
.
ÿÿg h
fecha_inicio
ÿÿh t
<=
ÿÿu w
fechaMaximaÿÿx É
)ÿÿÉ Ñ
.
ŸŸ 
OrderByDescending
ŸŸ &
(
ŸŸ& '
t
ŸŸ' (
=>
ŸŸ) +
t
ŸŸ, -
.
ŸŸ- .
fecha_inicio
ŸŸ. :
)
ŸŸ: ;
.
ŸŸ; <
FirstOrDefault
ŸŸ< J
(
ŸŸJ K
)
ŸŸK L
;
ŸŸL M
fecha
⁄⁄ 
=
⁄⁄ 
ultimaTransaccion
⁄⁄ )
!=
⁄⁄* ,
null
⁄⁄- 1
?
⁄⁄2 3
(
⁄⁄4 5
DateTime
⁄⁄5 =
?
⁄⁄= >
)
⁄⁄> ?
ultimaTransaccion
⁄⁄? P
.
⁄⁄P Q
fecha_inicio
⁄⁄Q ]
:
⁄⁄^ _
null
⁄⁄` d
;
⁄⁄d e
return
€€ 
fecha
€€ 
;
€€ 
}
›› 
catch
ﬁﬁ 
(
ﬁﬁ 
	Exception
ﬁﬁ 
e
ﬁﬁ 
)
ﬁﬁ 
{
ﬂﬂ 
throw
·· 
new
·· 
DatosException
·· (
(
··( )
$str
··) p
,
··p q
e
··r s
)
··s t
;
··t u
}
‚‚ 
}
„„ 	
public
ÂÂ 
DateTime
ÂÂ 
?
ÂÂ 1
#ObtenerFechaInicioUltimaTransaccion
ÂÂ <
(
ÂÂ< =
int
ÂÂ= @#
idActorNegocioInterno
ÂÂA V
,
ÂÂV W
int
ÂÂX [!
idTipoDeTransaccion
ÂÂ\ o
,
ÂÂo p
int
ÂÂq t
idUltimoEstadoÂÂu É
,ÂÂÉ Ñ
DateTimeÂÂÖ ç
fechaMaximaÂÂé ô
,ÂÂô ö
intÂÂõ û4
$idDetalleMaestroParametroTransaccionÂÂü √
,ÂÂ√ ƒ
stringÂÂ≈ À)
valorParametroTransaccionÂÂÃ Â
)ÂÂÂ Ê
{
ÊÊ 	
DateTime
ÁÁ 
?
ÁÁ 
fecha
ÁÁ 
=
ÁÁ 
null
ÁÁ "
;
ÁÁ" #
try
ËË 
{
ÈÈ 
var
ÍÍ 
ultimaTransaccion
ÍÍ %
=
ÍÍ& '
_db
ÍÍ( +
.
ÍÍ+ ,
Transaccion
ÍÍ, 7
.
ÍÍ7 8
Where
ÍÍ8 =
(
ÍÍ= >
t
ÍÍ> ?
=>
ÍÍ@ B
t
ÍÍC D
.
ÍÍD E&
id_actor_negocio_interno
ÍÍE ]
==
ÍÍ^ `#
idActorNegocioInterno
ÍÍa v
&&
ÎÎ 
t
ÎÎ 
.
ÎÎ !
id_tipo_transaccion
ÎÎ (
==
ÎÎ) +!
idTipoDeTransaccion
ÎÎ, ?
&&
ÏÏ 
t
ÏÏ 
.
ÏÏ 
fecha_inicio
ÏÏ !
<=
ÏÏ" $
fechaMaxima
ÏÏ% 0
&&
ÌÌ 
t
ÌÌ 
.
ÌÌ #
Parametro_transaccion
ÌÌ *
.
ÌÌ* +
Any
ÌÌ+ .
(
ÌÌ. /
pt
ÌÌ/ 1
=>
ÌÌ2 4
pt
ÌÌ5 7
.
ÌÌ7 8
id_parametro
ÌÌ8 D
==
ÌÌE G2
$idDetalleMaestroParametroTransaccion
ÌÌH l
)
ÌÌl m
&&
ÓÓ 
t
ÓÓ 
.
ÓÓ #
Parametro_transaccion
ÓÓ *
.
ÓÓ* +
FirstOrDefault
ÓÓ+ 9
(
ÓÓ9 :
pt
ÓÓ: <
=>
ÓÓ= ?
pt
ÓÓ@ B
.
ÓÓB C
id_parametro
ÓÓC O
==
ÓÓP R2
$idDetalleMaestroParametroTransaccion
ÓÓS w
)
ÓÓw x
.
ÓÓx y
valor
ÓÓy ~
==ÓÓ Å)
valorParametroTransaccionÓÓÇ õ
&&
ÔÔ 
t
ÔÔ 
.
ÔÔ 
id_estado_actual
ÔÔ %
==
ÔÔ& (
idUltimoEstado
ÔÔ) 7
)
 
.
 
OrderByDescending
 #
(
# $
t
$ %
=>
& (
t
) *
.
* +
fecha_inicio
+ 7
)
7 8
.
8 9
FirstOrDefault
9 G
(
G H
)
H I
;
I J
fecha
ÒÒ 
=
ÒÒ 
ultimaTransaccion
ÒÒ )
!=
ÒÒ* ,
null
ÒÒ- 1
?
ÒÒ2 3
(
ÒÒ4 5
DateTime
ÒÒ5 =
?
ÒÒ= >
)
ÒÒ> ?
ultimaTransaccion
ÒÒ? P
.
ÒÒP Q
fecha_inicio
ÒÒQ ]
:
ÒÒ^ _
null
ÒÒ` d
;
ÒÒd e
return
ÚÚ 
fecha
ÚÚ 
;
ÚÚ 
}
ÛÛ 
catch
ÙÙ 
(
ÙÙ 
	Exception
ÙÙ 
e
ÙÙ 
)
ÙÙ 
{
ıı 
throw
ˆˆ 
new
ˆˆ 
DatosException
ˆˆ (
(
ˆˆ( )
$str
ˆˆ) p
,
ˆˆp q
e
ˆˆr s
)
ˆˆs t
;
ˆˆt u
}
˜˜ 
}
˘˘ 	
public
˚˚ 
DateTime
˚˚ 
?
˚˚ 1
#ObtenerFechaInicioUltimaTransaccion
˚˚ <
(
˚˚< =
int
˚˚= @#
idActorNegocioExterno
˚˚A V
,
˚˚V W
int
˚˚X [!
idTipoDeTransaccion
˚˚\ o
,
˚˚o p
int
˚˚q t
idUltimoEstado˚˚u É
,˚˚É Ñ
DateTime˚˚Ö ç
fechaMaxima˚˚é ô
)˚˚ô ö
{
¸¸ 	
DateTime
˝˝ 
?
˝˝ 
fecha
˝˝ 
=
˝˝ 
null
˝˝ "
;
˝˝" #
try
˛˛ 
{
ˇˇ 
var
ÅÅ 
ultimaTransaccion
ÅÅ %
=
ÅÅ& '
_db
ÅÅ( +
.
ÅÅ+ ,
Transaccion
ÅÅ, 7
.
ÅÅ7 8
Where
ÅÅ8 =
(
ÅÅ= >
t
ÅÅ> ?
=>
ÅÅ@ B
t
ÅÅC D
.
ÅÅD E&
id_actor_negocio_externo
ÅÅE ]
==
ÅÅ^ `#
idActorNegocioExterno
ÅÅa v
&&
ÇÇ 
t
ÇÇ 
.
ÇÇ !
id_tipo_transaccion
ÇÇ (
==
ÇÇ) +!
idTipoDeTransaccion
ÇÇ, ?
&&
ÉÉ 
t
ÉÉ 
.
ÉÉ 
fecha_inicio
ÉÉ !
<=
ÉÉ" $
fechaMaxima
ÉÉ% 0
&&
ÑÑ 
t
ÑÑ 
.
ÑÑ 
id_estado_actual
ÑÑ %
==
ÑÑ& (
idUltimoEstado
ÑÑ) 7
)
ÖÖ 
.
ÜÜ 
OrderByDescending
ÜÜ "
(
ÜÜ" #
t
ÜÜ# $
=>
ÜÜ% '
t
ÜÜ( )
.
ÜÜ) *
fecha_inicio
ÜÜ* 6
)
ÜÜ6 7
.
ÜÜ7 8
FirstOrDefault
ÜÜ8 F
(
ÜÜF G
)
ÜÜG H
;
ÜÜH I
fecha
áá 
=
áá 
ultimaTransaccion
áá )
!=
áá* ,
null
áá- 1
?
áá2 3
(
áá4 5
DateTime
áá5 =
?
áá= >
)
áá> ?
ultimaTransaccion
áá? P
.
ááP Q
fecha_inicio
ááQ ]
:
áá^ _
null
áá` d
;
áád e
return
àà 
fecha
àà 
;
àà 
}
ââ 
catch
ää 
(
ää 
	Exception
ää 
e
ää 
)
ää 
{
ãã 
throw
çç 
new
çç 
DatosException
çç (
(
çç( )
$str
çç) p
,
ççp q
e
ççr s
)
ççs t
;
ççt u
}
éé 
}
èè 	
public
îî 
IEnumerable
îî 
<
îî 
Transaccion
îî &
>
îî& 'W
IObtenerTransaccionesInclusiveDetalleTransaccionComprobanteYActoresNegocio
îî( q
(
îîq r
int
îîr u"
idTipoDeTransaccionîîv â
,îîâ ä
intîîã é
[îîé è
]îîè ê&
idsEstadoDeTransaccionîîë ß
,îîß ®
intîî© ¨(
idParametroDeTransaccionîî≠ ≈
,îî≈ ∆
stringîî« Õ+
valorParametroDeTransaccionîîŒ È
,îîÈ Í
DateTimeîîÎ Û

fechaDesdeîîÙ ˛
,îî˛ ˇ
DateTimeîîÄ à

fechaHastaîîâ ì
)îîì î
{
ïï 	
try
ññ 
{
óó 
var
òò 
transacciones
òò !
=
òò" #
_db
òò$ '
.
òò' (
Transaccion
òò( 3
.
òò3 4
Include
ôô. 5
(
ôô5 6
t
ôô6 7
=>
ôô8 :
t
ôô; <
.
ôô< =!
Detalle_transaccion
ôô= P
)
ôôP Q
.
ôôQ R
Include
öö. 5
(
öö5 6
t
öö6 7
=>
öö8 :
t
öö; <
.
öö< =
Comprobante
öö= H
)
ööH I
.
ööI J
Include
õõ. 5
(
õõ5 6
t
õõ6 7
=>
õõ8 :
t
õõ; <
.
õõ< =
Comprobante
õõ= H
.
õõH I
Detalle_maestro
õõI X
)
õõX Y
.
õõY Z
Include
úú. 5
(
úú5 6
t
úú6 7
=>
úú8 :
t
úú; <
.
úú< =
Detalle_maestro1
úú= M
)
úúM N
.
úúN O
Include
ùù. 5
(
ùù5 6
t
ùù6 7
=>
ùù8 :
t
ùù; <
.
ùù< =
Actor_negocio1
ùù= K
)
ùùK L
.
ùùL M
Include
ûû. 5
(
ûû5 6
t
ûû6 7
=>
ûû8 :
t
ûû; <
.
ûû< =
Actor_negocio
ûû= J
)
ûûJ K
.
ûûK L
Include
üü. 5
(
üü5 6
t
üü6 7
=>
üü8 :
t
üü; <
.
üü< =
Actor_negocio2
üü= K
)
üüK L
.
üüL M
Where
††. 3
(
††3 4
t
††4 5
=>
††6 8
t
††9 :
.
††: ;!
id_tipo_transaccion
††; N
==
††O Q!
idTipoDeTransaccion
††R e
&&
††f h$
idsEstadoDeTransaccion
††i 
.†† Ä
Contains††Ä à
(††à â
(††â ä
int††ä ç
)††ç é
t††é è
.††è ê 
id_estado_actual††ê †
)††† °
&&††¢ §
t
°°. /
.
°°/ 0#
Parametro_transaccion
°°0 E
.
°°E F
Count
°°F K
(
°°K L
pt
°°L N
=>
°°O Q
pt
°°R T
.
°°T U
id_parametro
°°U a
==
°°b d&
idParametroDeTransaccion
°°e }
)
°°} ~
==°° Å
$num°°Ç É
&&°°Ñ Ü
t°°á à
.°°à â%
Parametro_transaccion°°â û
.°°û ü
FirstOrDefault°°ü ≠
(°°≠ Æ
pt°°Æ ∞
=>°°± ≥
pt°°¥ ∂
.°°∂ ∑
id_parametro°°∑ √
==°°ƒ ∆(
idParametroDeTransaccion°°« ﬂ
)°°ﬂ ‡
.°°‡ ·
valor°°· Ê
==°°Á È+
valorParametroDeTransaccion°°Í Ö
&&°°Ü à
t
¢¢. /
.
¢¢/ 0
fecha_inicio
¢¢0 <
>=
¢¢= ?

fechaDesde
¢¢@ J
&&
¢¢K M
t
¢¢N O
.
¢¢O P
fecha_inicio
¢¢P \
<=
¢¢] _

fechaHasta
¢¢` j
)
¢¢j k
;
¢¢k l
return
££ 
transacciones
££ $
;
££$ %
}
§§ 
catch
•• 
(
•• 
	Exception
•• 
e
•• 
)
•• 
{
¶¶ 
throw
ßß 
new
ßß 
DatosException
ßß (
(
ßß( )
$strßß) à
,ßßà â
eßßä ã
)ßßã å
;ßßå ç
}
®® 
}
©© 	
public
´´ 
IEnumerable
´´ 
<
´´ 
Transaccion
´´ &
>
´´& 'C
5ObtenerTransaccionesInclusiveActoresNegocioYPagoCuota
´´( ]
(
´´] ^
int
´´^ a!
idTipoDeTransaccion
´´b u
,
´´u v
int
´´w z
[
´´z {
]
´´{ |%
idsEstadoDeTransaccion´´} ì
,´´ì î
int´´ï ò(
idParametroDeTransaccion´´ô ±
,´´± ≤
string´´≥ π+
valorParametroDeTransaccion´´∫ ’
,´´’ ÷
DateTime´´◊ ﬂ

fechaDesde´´‡ Í
,´´Í Î
DateTime´´Ï Ù

fechaHasta´´ı ˇ
)´´ˇ Ä
{
¨¨ 	
try
≠≠ 
{
ÆÆ 
return
ØØ 
_db
ØØ 
.
ØØ 
Transaccion
ØØ &
.
ØØ& '
Include
∞∞( /
(
∞∞/ 0
t
∞∞0 1
=>
∞∞2 4
t
∞∞5 6
.
∞∞6 7
Actor_negocio2
∞∞7 E
)
∞∞E F
.
∞∞F G
Include
±±( /
(
±±/ 0
t
±±0 1
=>
±±2 4
t
±±5 6
.
±±6 7
Actor_negocio
±±7 D
)
±±D E
.
±±E F
Include
≤≤( /
(
≤≤/ 0
t
≤≤0 1
=>
≤≤2 4
t
≤≤5 6
.
≤≤6 7
Actor_negocio1
≤≤7 E
)
≤≤E F
.
≤≤F G
Include
≥≥( /
(
≥≥/ 0
t
≥≥0 1
=>
≥≥2 4
t
≥≥5 6
.
≥≥6 7

Pago_cuota
≥≥7 A
)
≥≥A B
.
≥≥B C
Include
¥¥( /
(
¥¥/ 0
t
¥¥0 1
=>
¥¥2 4
t
¥¥5 6
.
¥¥6 7

Pago_cuota
¥¥7 A
.
¥¥A B
Select
¥¥B H
(
¥¥H I
c
¥¥I J
=>
¥¥K M
c
¥¥N O
.
¥¥O P
Cuota
¥¥P U
)
¥¥U V
)
¥¥V W
.
¥¥W X
Include
µµ( /
(
µµ/ 0
t
µµ0 1
=>
µµ2 4
t
µµ5 6
.
µµ6 7

Pago_cuota
µµ7 A
.
µµA B
Select
µµB H
(
µµH I
c
µµI J
=>
µµK M
c
µµN O
.
µµO P
Cuota
µµP U
)
µµU V
.
µµV W
Select
µµW ]
(
µµ] ^
tr
µµ^ `
=>
µµa c
tr
µµd f
.
µµf g
Transaccion
µµg r
)
µµr s
.
µµs t
Select
µµt z
(
µµz {
com
µµ{ ~
=>µµ Å
comµµÇ Ö
.µµÖ Ü
ComprobanteµµÜ ë
)µµë í
)µµí ì
.µµì î
Where
∂∂( -
(
∂∂- .
t
∂∂. /
=>
∂∂0 2
t
∂∂3 4
.
∂∂4 5!
id_tipo_transaccion
∂∂5 H
==
∂∂I K!
idTipoDeTransaccion
∂∂L _
&&
∂∂` b$
idsEstadoDeTransaccion
∂∂c y
.
∂∂y z
Contains∂∂z Ç
(∂∂Ç É
t∂∂É Ñ
.∂∂Ñ Ö"
Estado_transaccion∂∂Ö ó
.∂∂ó ò
OrderByDescending
∑∑( 9
(
∑∑9 :
est
∑∑: =
=>
∑∑> @
est
∑∑A D
.
∑∑D E
id
∑∑E G
)
∑∑G H
.
∑∑H I
FirstOrDefault
∑∑I W
(
∑∑W X
)
∑∑X Y
.
∑∑Y Z
	id_estado
∑∑Z c
)
∑∑c d
&&
∑∑e g
t
∏∏( )
.
∏∏) *#
Parametro_transaccion
∏∏* ?
.
∏∏? @
Count
∏∏@ E
(
∏∏E F
pt
∏∏F H
=>
∏∏I K
pt
∏∏L N
.
∏∏N O
id_parametro
∏∏O [
==
∏∏\ ^&
idParametroDeTransaccion
∏∏_ w
)
∏∏w x
==
∏∏y {
$num
∏∏| }
&&∏∏~ Ä
t∏∏Å Ç
.∏∏Ç É%
Parametro_transaccion∏∏É ò
.∏∏ò ô
FirstOrDefault
ππ( 6
(
ππ6 7
pt
ππ7 9
=>
ππ: <
pt
ππ= ?
.
ππ? @
id_parametro
ππ@ L
==
ππM O&
idParametroDeTransaccion
ππP h
)
ππh i
.
ππi j
valor
ππj o
==
ππp r*
valorParametroDeTransaccionππs é
&&ππè ë
t
∫∫( )
.
∫∫) *
fecha_inicio
∫∫* 6
>=
∫∫7 9

fechaDesde
∫∫: D
&&
∫∫E G
t
∫∫H I
.
∫∫I J
fecha_inicio
∫∫J V
<=
∫∫W Y

fechaHasta
∫∫Z d
)
∫∫d e
;
∫∫e f
}
ªª 
catch
ºº 
(
ºº 
	Exception
ºº 
e
ºº 
)
ºº 
{
ΩΩ 
throw
ææ 
new
ææ 
DatosException
ææ (
(
ææ( )
$strææ) Ñ
,ææÑ Ö
eææÜ á
)ææá à
;ææà â
}
øø 
}
¿¿ 	
public
¬¬ 
IEnumerable
¬¬ 
<
¬¬ 
Transaccion
¬¬ &
>
¬¬& 'W
IObtenerTransaccionesInclusiveDetalleTransaccionComprobanteYActoresNegocio
¬¬( q
(
¬¬q r
int
¬¬r u"
idTipoDeTransaccion¬¬v â
,¬¬â ä
int¬¬ã é
[¬¬é è
]¬¬è ê&
idsEstadoDeTransaccion¬¬ë ß
,¬¬ß ®
int¬¬© ¨(
idParametroDeTransaccion¬¬≠ ≈
,¬¬≈ ∆
string¬¬« Õ+
valorParametroDeTransaccion¬¬Œ È
,¬¬È Í
DateTime¬¬Î Û
fecha¬¬Ù ˘
)¬¬˘ ˙
{
√√ 	
try
ƒƒ 
{
≈≈ 
return
∆∆ 
_db
∆∆ 
.
∆∆ 
Transaccion
∆∆ &
.
∆∆& '
Include
««$ +
(
««+ ,
t
««, -
=>
««. 0
t
««1 2
.
««2 3!
Detalle_transaccion
««3 F
)
««F G
.
««G H
Include
»»$ +
(
»»+ ,
t
»», -
=>
»». 0
t
»»1 2
.
»»2 3
Comprobante
»»3 >
)
»»> ?
.
»»? @
Include
……$ +
(
……+ ,
t
……, -
=>
……. 0
t
……1 2
.
……2 3
Comprobante
……3 >
.
……> ?
Detalle_maestro
……? N
)
……N O
.
……O P
Include
  $ +
(
  + ,
t
  , -
=>
  . 0
t
  1 2
.
  2 3
Detalle_maestro1
  3 C
)
  C D
.
  D E
Include
ÀÀ% ,
(
ÀÀ, -
t
ÀÀ- .
=>
ÀÀ/ 1
t
ÀÀ2 3
.
ÀÀ3 4
Actor_negocio1
ÀÀ4 B
)
ÀÀB C
.
ÀÀC D
Include
ÃÃ$ +
(
ÃÃ+ ,
t
ÃÃ, -
=>
ÃÃ. 0
t
ÃÃ1 2
.
ÃÃ2 3
Actor_negocio
ÃÃ3 @
)
ÃÃ@ A
.
ÃÃA B
Include
ÕÕ$ +
(
ÕÕ+ ,
t
ÕÕ, -
=>
ÕÕ. 0
t
ÕÕ1 2
.
ÕÕ2 3
Actor_negocio2
ÕÕ3 A
)
ÕÕA B
.
ÕÕB C
Where
ŒŒ$ )
(
ŒŒ) *
t
ŒŒ* +
=>
ŒŒ, .
t
ŒŒ/ 0
.
ŒŒ0 1!
id_tipo_transaccion
ŒŒ1 D
==
ŒŒE G!
idTipoDeTransaccion
ŒŒH [
&&
œœ0 2$
idsEstadoDeTransaccion
œœ3 I
.
œœI J
Contains
œœJ R
(
œœR S
(
œœS T
int
œœT W
)
œœW X
t
œœX Y
.
œœY Z
id_estado_actual
œœZ j
)
œœj k
&&
––0 2
t
––3 4
.
––4 5#
Parametro_transaccion
––5 J
.
––J K
Count
––K P
(
––P Q
pt
––Q S
=>
––T V
pt
––W Y
.
––Y Z
id_parametro
––Z f
==
––g i'
idParametroDeTransaccion––j Ç
)––Ç É
==––Ñ Ü
$num––á à
&&
——0 2
t
——3 4
.
——4 5#
Parametro_transaccion
——5 J
.
——J K
FirstOrDefault
——K Y
(
——Y Z
pt
——Z \
=>
——] _
pt
——` b
.
——b c
id_parametro
——c o
==
——p r'
idParametroDeTransaccion——s ã
)——ã å
.——å ç
valor——ç í
==——ì ï+
valorParametroDeTransaccion——ñ ±
&&
““0 2
t
““3 4
.
““4 5$
fecha_registro_sistema
““5 K
==
““L N
fecha
““O T
)
””$ %
;
””% &
}
‘‘ 
catch
’’ 
(
’’ 
	Exception
’’ 
e
’’ 
)
’’ 
{
÷÷ 
throw
◊◊ 
new
◊◊ 
DatosException
◊◊ (
(
◊◊( )
$str◊◊) Ñ
,◊◊Ñ Ö
e◊◊Ü á
)◊◊á à
;◊◊à â
}
ÿÿ 
}
⁄⁄ 	
public
‹‹ 
IEnumerable
‹‹ 
<
‹‹ 
Transaccion
‹‹ &
>
‹‹& 'W
IObtenerTransaccionesInclusiveDetalleTransaccionComprobanteYActoresNegocio
‹‹( q
(
‹‹q r
int
‹‹r u"
idTipoDeTransaccion‹‹v â
,‹‹â ä
int‹‹ã é
[‹‹é è
]‹‹è ê&
idsEstadoDeTransaccion‹‹ë ß
,‹‹ß ®
int‹‹© ¨(
idParametroDeTransaccion‹‹≠ ≈
,‹‹≈ ∆
string‹‹« Õ+
valorParametroDeTransaccion‹‹Œ È
,‹‹È Í
int‹‹Î Ó
idTransaccion‹‹Ô ¸
)‹‹¸ ˝
{
›› 	
try
ﬁﬁ 
{
ﬂﬂ 
return
‡‡ 
_db
‡‡ 
.
‡‡ 
Transaccion
‡‡ &
.
··  !
Where
··! &
(
··& '
t
··' (
=>
··) +
t
··, -
.
··- .
id
··. 0
==
··1 3
idTransaccion
··4 A
)
··A B
.
‚‚  

SelectMany
‚‚  *
(
‚‚* +
t1
‚‚+ -
=>
‚‚. 0
t1
‚‚1 3
.
‚‚3 4
Transaccion1
‚‚4 @
)
‚‚@ A
.
„„  

SelectMany
„„  *
(
„„* +
t1
„„+ -
=>
„„. 0
t1
„„1 3
.
„„3 4
Transaccion1
„„4 @
)
„„@ A
.
‰‰  
Where
‰‰  %
(
‰‰% &
t1
‰‰& (
=>
‰‰) +
t1
‰‰, .
.
‰‰. /!
id_tipo_transaccion
‰‰/ B
==
‰‰C E!
idTipoDeTransaccion
‰‰F Y
&&
ÂÂ' )$
idsEstadoDeTransaccion
ÂÂ* @
.
ÂÂ@ A
Contains
ÂÂA I
(
ÂÂI J
t1
ÂÂJ L
.
ÂÂL M 
Estado_transaccion
ÂÂM _
.
ÂÂ_ `
OrderByDescending
ÂÂ` q
(
ÂÂq r
est
ÂÂr u
=>
ÂÂv x
est
ÂÂy |
.
ÂÂ| }
id
ÂÂ} 
)ÂÂ Ä
.ÂÂÄ Å
FirstOrDefaultÂÂÅ è
(ÂÂè ê
)ÂÂê ë
.ÂÂë í
	id_estadoÂÂí õ
)ÂÂõ ú
&&
ÊÊ' )
t1
ÊÊ* ,
.
ÊÊ, -#
Parametro_transaccion
ÊÊ- B
.
ÊÊB C
Count
ÊÊC H
(
ÊÊH I
pt
ÊÊI K
=>
ÊÊL N
pt
ÊÊO Q
.
ÊÊQ R
id_parametro
ÊÊR ^
==
ÊÊ_ a&
idParametroDeTransaccion
ÊÊb z
)
ÊÊz {
==
ÊÊ| ~
$numÊÊ Ä
&&
ÁÁ' )
t1
ÁÁ* ,
.
ÁÁ, -#
Parametro_transaccion
ÁÁ- B
.
ÁÁB C
FirstOrDefault
ÁÁC Q
(
ÁÁQ R
pt
ÁÁR T
=>
ÁÁU W
pt
ÁÁX Z
.
ÁÁZ [
id_parametro
ÁÁ[ g
==
ÁÁh j'
idParametroDeTransaccionÁÁk É
)ÁÁÉ Ñ
.ÁÁÑ Ö
valorÁÁÖ ä
==ÁÁã ç+
valorParametroDeTransaccionÁÁé ©
)
ËË  
.
ËË  !
Include
ÈÈ$ +
(
ÈÈ+ ,
t1
ÈÈ, .
=>
ÈÈ/ 1
t1
ÈÈ2 4
.
ÈÈ4 5!
Detalle_transaccion
ÈÈ5 H
)
ÈÈH I
.
ÈÈI J
Include
ÍÍ$ +
(
ÍÍ+ ,
t1
ÍÍ, .
=>
ÍÍ/ 1
t1
ÍÍ2 4
.
ÍÍ4 5
Comprobante
ÍÍ5 @
)
ÍÍ@ A
.
ÍÍA B
Include
ÎÎ$ +
(
ÎÎ+ ,
t1
ÎÎ, .
=>
ÎÎ/ 1
t1
ÎÎ2 4
.
ÎÎ4 5
Comprobante
ÎÎ5 @
.
ÎÎ@ A
Detalle_maestro
ÎÎA P
)
ÎÎP Q
.
ÎÎQ R
Include
ÏÏ$ +
(
ÏÏ+ ,
t1
ÏÏ, .
=>
ÏÏ/ 1
t1
ÏÏ2 4
.
ÏÏ4 5
Detalle_maestro1
ÏÏ5 E
)
ÏÏE F
.
ÏÏF G
Include
ÌÌ% ,
(
ÌÌ, -
t1
ÌÌ- /
=>
ÌÌ0 2
t1
ÌÌ3 5
.
ÌÌ5 6
Actor_negocio1
ÌÌ6 D
)
ÌÌD E
.
ÌÌE F
Include
ÓÓ$ +
(
ÓÓ+ ,
t1
ÓÓ, .
=>
ÓÓ/ 1
t1
ÓÓ2 4
.
ÓÓ4 5
Actor_negocio
ÓÓ5 B
)
ÓÓB C
.
ÓÓC D
Include
ÔÔ$ +
(
ÔÔ+ ,
t1
ÔÔ, .
=>
ÔÔ/ 1
t1
ÔÔ2 4
.
ÔÔ4 5
Actor_negocio2
ÔÔ5 C
)
ÔÔC D
;
  
}
ÚÚ 
catch
ÛÛ 
(
ÛÛ 
	Exception
ÛÛ 
e
ÛÛ 
)
ÛÛ 
{
ÙÙ 
throw
ıı 
new
ıı 
DatosException
ıı (
(
ıı( )
$strıı) Ñ
,ııÑ Ö
eııÜ á
)ııá à
;ııà â
}
ˆˆ 
}
˜˜ 	
public
˘˘ 
IEnumerable
˘˘ 
<
˘˘ 
Transaccion
˘˘ &
>
˘˘& 'C
5ObtenerTransaccionesInclusiveActoresNegocioYPagoCuota
˘˘( ]
(
˘˘] ^
int
˘˘^ a!
idTipoDeTransaccion
˘˘b u
,
˘˘u v
int
˘˘w z'
idParametroDeTransaccion˘˘{ ì
,˘˘ì î
string˘˘ï õ+
valorParametroDeTransaccion˘˘ú ∑
,˘˘∑ ∏
DateTime˘˘π ¡
fecha˘˘¬ «
)˘˘« »
{
˙˙ 	
try
˚˚ 
{
¸¸ 
return
˝˝ 
_db
˝˝ 
.
˝˝ 
Transaccion
˝˝ &
.
˝˝& '
Include
˛˛$ +
(
˛˛+ ,
t
˛˛, -
=>
˛˛. 0
t
˛˛1 2
.
˛˛2 3
Actor_negocio2
˛˛3 A
)
˛˛A B
.
˛˛B C
Include
ˇˇ$ +
(
ˇˇ+ ,
t
ˇˇ, -
=>
ˇˇ. 0
t
ˇˇ1 2
.
ˇˇ2 3
Actor_negocio
ˇˇ3 @
)
ˇˇ@ A
.
ˇˇA B
Include
ÄÄ$ +
(
ÄÄ+ ,
t
ÄÄ, -
=>
ÄÄ. 0
t
ÄÄ1 2
.
ÄÄ2 3
Actor_negocio1
ÄÄ3 A
)
ÄÄA B
.
ÄÄB C
Include
ÅÅ$ +
(
ÅÅ+ ,
t
ÅÅ, -
=>
ÅÅ. 0
t
ÅÅ1 2
.
ÅÅ2 3

Pago_cuota
ÅÅ3 =
)
ÅÅ= >
.
ÅÅ> ?
Include
ÇÇ$ +
(
ÇÇ+ ,
t
ÇÇ, -
=>
ÇÇ. 0
t
ÇÇ1 2
.
ÇÇ2 3

Pago_cuota
ÇÇ3 =
.
ÇÇ= >
Select
ÇÇ> D
(
ÇÇD E
c
ÇÇE F
=>
ÇÇG I
c
ÇÇJ K
.
ÇÇK L
Cuota
ÇÇL Q
)
ÇÇQ R
)
ÇÇR S
.
ÇÇS T
Include
ÉÉ$ +
(
ÉÉ+ ,
t
ÉÉ, -
=>
ÉÉ. 0
t
ÉÉ1 2
.
ÉÉ2 3

Pago_cuota
ÉÉ3 =
.
ÉÉ= >
Select
ÉÉ> D
(
ÉÉD E
c
ÉÉE F
=>
ÉÉG I
c
ÉÉJ K
.
ÉÉK L
Cuota
ÉÉL Q
)
ÉÉQ R
.
ÉÉR S
Select
ÉÉS Y
(
ÉÉY Z
tr
ÉÉZ \
=>
ÉÉ] _
tr
ÉÉ` b
.
ÉÉb c
Transaccion
ÉÉc n
)
ÉÉn o
.
ÉÉo p
Select
ÉÉp v
(
ÉÉv w
com
ÉÉw z
=>
ÉÉ{ }
comÉÉ~ Å
.ÉÉÅ Ç
ComprobanteÉÉÇ ç
)ÉÉç é
)ÉÉé è
.ÉÉè ê
Where
ÑÑ$ )
(
ÑÑ) *
t
ÑÑ* +
=>
ÑÑ, .
t
ÑÑ/ 0
.
ÑÑ0 1!
id_tipo_transaccion
ÑÑ1 D
==
ÑÑE G!
idTipoDeTransaccion
ÑÑH [
&&
ÖÖ$ &
t
ÖÖ' (
.
ÖÖ( )#
Parametro_transaccion
ÖÖ) >
.
ÖÖ> ?
Count
ÖÖ? D
(
ÖÖD E
pt
ÖÖE G
=>
ÖÖH J
pt
ÖÖK M
.
ÖÖM N
id_parametro
ÖÖN Z
==
ÖÖ[ ]&
idParametroDeTransaccion
ÖÖ^ v
)
ÖÖv w
==
ÖÖx z
$num
ÖÖ{ |
&&
ÜÜ$ &
t
ÜÜ' (
.
ÜÜ( )#
Parametro_transaccion
ÜÜ) >
.
ÜÜ> ?
FirstOrDefault
ÜÜ? M
(
ÜÜM N
pt
ÜÜN P
=>
ÜÜQ S
pt
ÜÜT V
.
ÜÜV W
id_parametro
ÜÜW c
==
ÜÜd f&
idParametroDeTransaccion
ÜÜg 
)ÜÜ Ä
.ÜÜÄ Å
valorÜÜÅ Ü
==ÜÜá â+
valorParametroDeTransaccionÜÜä •
&&
áá$ &
DateTime
áá' /
.
áá/ 0
Compare
áá0 7
(
áá7 8
t
áá8 9
.
áá9 :$
fecha_registro_sistema
áá: P
,
ááP Q
fecha
ááR W
)
ááW X
==
ááY [
$num
áá\ ]
)
áá] ^
;
áá^ _
}
ââ 
catch
ää 
(
ää 
	Exception
ää 
e
ää 
)
ää 
{
ãã 
throw
åå 
new
åå 
DatosException
åå (
(
åå( )
$stråå) Ñ
,ååÑ Ö
eååÜ á
)ååá à
;ååà â
}
çç 
}
èè 	
public
ëë 
IEnumerable
ëë 
<
ëë 
Transaccion
ëë &
>
ëë& 'C
5ObtenerTransaccionesInclusiveActoresNegocioYPagoCuota
ëë( ]
(
ëë] ^
int
ëë^ a!
idTipoDeTransaccion
ëëb u
,
ëëu v
int
ëëw z
[
ëëz {
]
ëë{ |%
idsEstadoDeTransaccionëë} ì
,ëëì î
intëëï ò(
idParametroDeTransaccionëëô ±
,ëë± ≤
stringëë≥ π+
valorParametroDeTransaccionëë∫ ’
,ëë’ ÷
intëë◊ ⁄
idTransaccionëë€ Ë
)ëëË È
{
íí 	
try
ìì 
{
îî 
return
ïï 
_db
ïï 
.
ïï 
Transaccion
ïï &
.
ññ# $
Where
ññ$ )
(
ññ) *
t
ññ* +
=>
ññ, .
t
ññ/ 0
.
ññ0 1
id
ññ1 3
==
ññ4 6
idTransaccion
ññ7 D
)
ññD E
.
óó# $

SelectMany
óó$ .
(
óó. /
t1
óó/ 1
=>
óó2 4
t1
óó5 7
.
óó7 8
Transaccion1
óó8 D
)
óóD E
.
òò$ %
Where
òò% *
(
òò* +
t
òò+ ,
=>
òò- /
t
òò0 1
.
òò1 2!
id_tipo_transaccion
òò2 E
==
òòF H!
idTipoDeTransaccion
òòI \
&&
ôô$ &
t
ôô' (
.
ôô( )#
Parametro_transaccion
ôô) >
.
ôô> ?
Count
ôô? D
(
ôôD E
pt
ôôE G
=>
ôôH J
pt
ôôK M
.
ôôM N
id_parametro
ôôN Z
==
ôô[ ]&
idParametroDeTransaccion
ôô^ v
)
ôôv w
==
ôôx z
$num
ôô{ |
&&
öö$ &
t
öö' (
.
öö( )#
Parametro_transaccion
öö) >
.
öö> ?
FirstOrDefault
öö? M
(
ööM N
pt
ööN P
=>
ööQ S
pt
ööT V
.
ööV W
id_parametro
ööW c
==
ööd f&
idParametroDeTransaccion
öög 
)öö Ä
.ööÄ Å
valorööÅ Ü
==ööá â+
valorParametroDeTransaccionööä •
)
õõ# $
.
õõ$ %
Include
úú$ +
(
úú+ ,
t
úú, -
=>
úú. 0
t
úú1 2
.
úú2 3
Actor_negocio2
úú3 A
)
úúA B
.
úúB C
Include
ùù$ +
(
ùù+ ,
t
ùù, -
=>
ùù. 0
t
ùù1 2
.
ùù2 3
Actor_negocio
ùù3 @
)
ùù@ A
.
ùùA B
Include
ûû$ +
(
ûû+ ,
t
ûû, -
=>
ûû. 0
t
ûû1 2
.
ûû2 3
Actor_negocio1
ûû3 A
)
ûûA B
.
ûûB C
Include
üü$ +
(
üü+ ,
t
üü, -
=>
üü. 0
t
üü1 2
.
üü2 3

Pago_cuota
üü3 =
)
üü= >
.
üü> ?
Include
††$ +
(
††+ ,
t
††, -
=>
††. 0
t
††1 2
.
††2 3

Pago_cuota
††3 =
.
††= >
Select
††> D
(
††D E
c
††E F
=>
††G I
c
††J K
.
††K L
Cuota
††L Q
)
††Q R
)
††R S
.
††S T
Include
°°$ +
(
°°+ ,
t
°°, -
=>
°°. 0
t
°°1 2
.
°°2 3

Pago_cuota
°°3 =
.
°°= >
Select
°°> D
(
°°D E
c
°°E F
=>
°°G I
c
°°J K
.
°°K L
Cuota
°°L Q
)
°°Q R
.
°°R S
Select
°°S Y
(
°°Y Z
tr
°°Z \
=>
°°] _
tr
°°` b
.
°°b c
Transaccion
°°c n
)
°°n o
.
°°o p
Select
°°p v
(
°°v w
com
°°w z
=>
°°{ }
com°°~ Å
.°°Å Ç
Comprobante°°Ç ç
)°°ç é
)°°é è
;°°è ê
}
¢¢ 
catch
££ 
(
££ 
	Exception
££ 
e
££ 
)
££ 
{
§§ 
throw
•• 
new
•• 
DatosException
•• (
(
••( )
$str••) Ñ
,••Ñ Ö
e••Ü á
)••á à
;••à â
}
¶¶ 
}
ßß 	
public
©© 
IEnumerable
©© 
<
©© 
Transaccion
©© &
>
©©& 'C
5ObtenerTransaccionesInclusiveActoresNegocioYPagoCuota
©©( ]
(
©©] ^
int
©©^ a!
idTipoDeTransaccion
©©b u
,
©©u v
int
©©w z'
idParametroDeTransaccion©©{ ì
,©©ì î
string©©ï õ+
valorParametroDeTransaccion©©ú ∑
,©©∑ ∏
int©©π º
idTransaccion©©Ω  
)©©  À
{
™™ 	
try
´´ 
{
¨¨ 
return
≠≠ 
_db
≠≠ 
.
≠≠ 
Transaccion
≠≠ &
.
ÆÆ# $
Where
ÆÆ$ )
(
ÆÆ) *
t
ÆÆ* +
=>
ÆÆ, .
t
ÆÆ/ 0
.
ÆÆ0 1
id
ÆÆ1 3
==
ÆÆ4 6
idTransaccion
ÆÆ7 D
)
ÆÆD E
.
ØØ# $

SelectMany
ØØ$ .
(
ØØ. /
t1
ØØ/ 1
=>
ØØ2 4
t1
ØØ5 7
.
ØØ7 8
Transaccion1
ØØ8 D
)
ØØD E
.
∞∞$ %
Where
∞∞% *
(
∞∞* +
t
∞∞+ ,
=>
∞∞- /
t
∞∞0 1
.
∞∞1 2!
id_tipo_transaccion
∞∞2 E
==
∞∞F H!
idTipoDeTransaccion
∞∞I \
&&
±±$ &
t
±±' (
.
±±( )#
Parametro_transaccion
±±) >
.
±±> ?
Count
±±? D
(
±±D E
pt
±±E G
=>
±±H J
pt
±±K M
.
±±M N
id_parametro
±±N Z
==
±±[ ]&
idParametroDeTransaccion
±±^ v
)
±±v w
==
±±x z
$num
±±{ |
&&
≤≤$ &
t
≤≤' (
.
≤≤( )#
Parametro_transaccion
≤≤) >
.
≤≤> ?
FirstOrDefault
≤≤? M
(
≤≤M N
pt
≤≤N P
=>
≤≤Q S
pt
≤≤T V
.
≤≤V W
id_parametro
≤≤W c
==
≤≤d f&
idParametroDeTransaccion
≤≤g 
)≤≤ Ä
.≤≤Ä Å
valor≤≤Å Ü
==≤≤á â+
valorParametroDeTransaccion≤≤ä •
)
≥≥# $
.
≥≥$ %
Include
¥¥$ +
(
¥¥+ ,
t
¥¥, -
=>
¥¥. 0
t
¥¥1 2
.
¥¥2 3
Actor_negocio2
¥¥3 A
)
¥¥A B
.
¥¥B C
Include
µµ$ +
(
µµ+ ,
t
µµ, -
=>
µµ. 0
t
µµ1 2
.
µµ2 3
Actor_negocio
µµ3 @
)
µµ@ A
.
µµA B
Include
∂∂$ +
(
∂∂+ ,
t
∂∂, -
=>
∂∂. 0
t
∂∂1 2
.
∂∂2 3
Actor_negocio1
∂∂3 A
)
∂∂A B
.
∂∂B C
Include
∑∑$ +
(
∑∑+ ,
t
∑∑, -
=>
∑∑. 0
t
∑∑1 2
.
∑∑2 3

Pago_cuota
∑∑3 =
)
∑∑= >
.
∑∑> ?
Include
∏∏$ +
(
∏∏+ ,
t
∏∏, -
=>
∏∏. 0
t
∏∏1 2
.
∏∏2 3

Pago_cuota
∏∏3 =
.
∏∏= >
Select
∏∏> D
(
∏∏D E
c
∏∏E F
=>
∏∏G I
c
∏∏J K
.
∏∏K L
Cuota
∏∏L Q
)
∏∏Q R
)
∏∏R S
.
∏∏S T
Include
ππ$ +
(
ππ+ ,
t
ππ, -
=>
ππ. 0
t
ππ1 2
.
ππ2 3

Pago_cuota
ππ3 =
.
ππ= >
Select
ππ> D
(
ππD E
c
ππE F
=>
ππG I
c
ππJ K
.
ππK L
Cuota
ππL Q
)
ππQ R
.
ππR S
Select
ππS Y
(
ππY Z
tr
ππZ \
=>
ππ] _
tr
ππ` b
.
ππb c
Transaccion
ππc n
)
ππn o
.
ππo p
Select
ππp v
(
ππv w
com
ππw z
=>
ππ{ }
comππ~ Å
.ππÅ Ç
ComprobanteππÇ ç
)ππç é
)ππé è
;ππè ê
}
ªª 
catch
ºº 
(
ºº 
	Exception
ºº 
e
ºº 
)
ºº 
{
ΩΩ 
throw
ææ 
new
ææ 
DatosException
ææ (
(
ææ( )
$strææ) Ñ
,ææÑ Ö
eææÜ á
)ææá à
;ææà â
}
øø 
}
¡¡ 	
public
√√ 
IEnumerable
√√ 
<
√√ 
Transaccion
√√ &
>
√√& 'C
5ObtenerTransaccionesInclusiveActoresNegocioYPagoCuota
√√( ]
(
√√] ^
int
√√^ a!
idTipoDeTransaccion
√√b u
,
√√u v
int
√√w z'
idParametroDeTransaccion√√{ ì
,√√ì î
string√√ï õ+
valorParametroDeTransaccion√√ú ∑
,√√∑ ∏
DateTime√√π ¡

fechaDesde√√¬ Ã
,√√Ã Õ
DateTime√√Œ ÷

fechaHasta√√◊ ·
)√√· ‚
{
ƒƒ 	
try
≈≈ 
{
∆∆ 
return
«« 
_db
«« 
.
«« 
Transaccion
«« &
.
««& '
Include
»»( /
(
»»/ 0
t
»»0 1
=>
»»2 4
t
»»5 6
.
»»6 7
Actor_negocio2
»»7 E
)
»»E F
.
»»F G
Include
……( /
(
……/ 0
t
……0 1
=>
……2 4
t
……5 6
.
……6 7
Actor_negocio
……7 D
)
……D E
.
……E F
Include
  ( /
(
  / 0
t
  0 1
=>
  2 4
t
  5 6
.
  6 7
Actor_negocio1
  7 E
)
  E F
.
  F G
Include
ÀÀ( /
(
ÀÀ/ 0
t
ÀÀ0 1
=>
ÀÀ2 4
t
ÀÀ5 6
.
ÀÀ6 7

Pago_cuota
ÀÀ7 A
)
ÀÀA B
.
ÀÀB C
Include
ÃÃ( /
(
ÃÃ/ 0
t
ÃÃ0 1
=>
ÃÃ2 4
t
ÃÃ5 6
.
ÃÃ6 7

Pago_cuota
ÃÃ7 A
.
ÃÃA B
Select
ÃÃB H
(
ÃÃH I
c
ÃÃI J
=>
ÃÃK M
c
ÃÃN O
.
ÃÃO P
Cuota
ÃÃP U
)
ÃÃU V
)
ÃÃV W
.
ÃÃW X
Include
ÕÕ( /
(
ÕÕ/ 0
t
ÕÕ0 1
=>
ÕÕ2 4
t
ÕÕ5 6
.
ÕÕ6 7

Pago_cuota
ÕÕ7 A
.
ÕÕA B
Select
ÕÕB H
(
ÕÕH I
c
ÕÕI J
=>
ÕÕK M
c
ÕÕN O
.
ÕÕO P
Cuota
ÕÕP U
)
ÕÕU V
.
ŒŒ6 7
Select
ŒŒ7 =
(
ŒŒ= >
tr
ŒŒ> @
=>
ŒŒA C
tr
ŒŒD F
.
ŒŒF G
Transaccion
ŒŒG R
)
ŒŒR S
.
œœ6 7
Select
œœ7 =
(
œœ= >
com
œœ> A
=>
œœB D
com
œœE H
.
œœH I
Comprobante
œœI T
)
œœT U
)
––0 1
.
——' (
Where
——( -
(
——- .
t
——. /
=>
——0 2
t
——3 4
.
——4 5!
id_tipo_transaccion
——5 H
==
——I K!
idTipoDeTransaccion
——L _
&&
““2 4
t
““5 6
.
““6 7#
Parametro_transaccion
““7 L
.
““L M
Count
““M R
(
““R S
pt
““S U
=>
““V X
pt
““Y [
.
““[ \
id_parametro
““\ h
==
““i k'
idParametroDeTransaccion““l Ñ
)““Ñ Ö
==““Ü à
$num““â ä
&&
””2 4
t
””5 6
.
””6 7#
Parametro_transaccion
””7 L
.
””L M
FirstOrDefault
””M [
(
””[ \
pt
””\ ^
=>
””_ a
pt
””b d
.
””d e
id_parametro
””e q
==
””r t'
idParametroDeTransaccion””u ç
)””ç é
.””é è
valor””è î
==””ï ó+
valorParametroDeTransaccion””ò ≥
&&
‘‘2 4
t
‘‘5 6
.
‘‘6 7
fecha_inicio
‘‘7 C
>=
‘‘D F

fechaDesde
‘‘G Q
&&
’’2 4
t
’’5 6
.
’’6 7
fecha_inicio
’’7 C
<=
’’D F

fechaHasta
’’G Q
)
÷÷- .
;
÷÷. /
}
◊◊ 
catch
ÿÿ 
(
ÿÿ 
	Exception
ÿÿ 
e
ÿÿ 
)
ÿÿ 
{
ŸŸ 
throw
⁄⁄ 
new
⁄⁄ 
DatosException
⁄⁄ (
(
⁄⁄( )
$str⁄⁄) Ñ
,⁄⁄Ñ Ö
e⁄⁄Ü á
)⁄⁄á à
;⁄⁄à â
}
€€ 
}
›› 	
public
„„ 
IEnumerable
„„ 
<
„„ 
Venta_Cliente
„„ (
>
„„( )S
EObtenerVentasClienteConOperacionDeReferenciaSegunElEstadoQueDebeTener
„„* o
(
„„o p
int
„„p s
[
„„s t
]
„„t u#
idsTiposComprobantes„„v ä
,„„ä ã
int„„å è
[„„è ê
]„„ê ë#
idsTiposTransaccion„„í •
,„„• ¶
DateTime„„ß Ø

fechaDesde„„∞ ∫
,„„∫ ª
DateTime„„º ƒ

fechaHasta„„≈ œ
)„„œ –
{
‰‰ 	
try
ÂÂ 
{
ÊÊ 
return
ÁÁ 
_db
ÁÁ 
.
ÁÁ 
Transaccion
ÁÁ &
.
ËË 
Where
ËË !
(
ËË! "
t
ËË" #
=>
ËË$ &
t
ËË' (
.
ËË( )
fecha_inicio
ËË) 5
>=
ËË6 8

fechaDesde
ËË9 C
&&
ËËD F
t
ËËG H
.
ËËH I
fecha_inicio
ËËI U
<=
ËËV X

fechaHasta
ËËY c
&&
ÈÈ !
idsTiposTransaccion
ÈÈ 2
.
ÈÈ2 3
Contains
ÈÈ3 ;
(
ÈÈ; <
t
ÈÈ< =
.
ÈÈ= >!
id_tipo_transaccion
ÈÈ> Q
)
ÈÈQ R
&&
ÍÍ "
idsTiposComprobantes
ÍÍ 3
.
ÍÍ3 4
Contains
ÍÍ4 <
(
ÍÍ< =
t
ÍÍ= >
.
ÍÍ> ?
Comprobante
ÍÍ? J
.
ÍÍJ K!
id_tipo_comprobante
ÍÍK ^
)
ÍÍ^ _
)
ÍÍ_ `
.
ÏÏ 
Select
ÏÏ #
(
ÏÏ# $
t
ÏÏ$ %
=>
ÏÏ& (
new
ÏÏ) ,
Venta_Cliente
ÏÏ- :
(
ÏÏ: ;
)
ÏÏ; <
{
ÌÌ 
Id
ÓÓ  "
=
ÓÓ# $
t
ÓÓ% &
.
ÓÓ& '
id
ÓÓ' )
,
ÓÓ) *
Anyo
ÔÔ  $
=
ÔÔ% &
t
ÔÔ' (
.
ÔÔ( )
fecha_inicio
ÔÔ) 5
.
ÔÔ5 6
Year
ÔÔ6 :
,
ÔÔ: ;
Mes
  #
=
$ %
t
& '
.
' (
fecha_inicio
( 4
.
4 5
Month
5 :
,
: ;
Dia
ÒÒ  #
=
ÒÒ$ %
t
ÒÒ& '
.
ÒÒ' (
fecha_inicio
ÒÒ( 4
.
ÒÒ4 5
Day
ÒÒ5 8
,
ÒÒ8 9
FechaEmision
ÚÚ  ,
=
ÚÚ- .
t
ÚÚ/ 0
.
ÚÚ0 1
fecha_inicio
ÚÚ1 =
,
ÚÚ= >
IdTipoComprobante
ÛÛ  1
=
ÛÛ2 3
t
ÛÛ4 5
.
ÛÛ5 6
Comprobante
ÛÛ6 A
.
ÛÛA B!
id_tipo_comprobante
ÛÛB U
,
ÛÛU V
CodigoComprobante
ÙÙ  1
=
ÙÙ2 3
t
ÙÙ4 5
.
ÙÙ5 6
Comprobante
ÙÙ6 A
.
ÙÙA B
Detalle_maestro
ÙÙB Q
.
ÙÙQ R
codigo
ÙÙR X
,
ÙÙX Y
IdSerie
ıı  '
=
ıı( )
t
ıı* +
.
ıı+ ,
Comprobante
ıı, 7
.
ıı7 8"
id_serie_comprobante
ıı8 L
,
ııL M
NumeroSerie
ˆˆ  +
=
ˆˆ, -
t
ˆˆ. /
.
ˆˆ/ 0
Comprobante
ˆˆ0 ;
.
ˆˆ; <
numero_serie
ˆˆ< H
,
ˆˆH I
IdTipoDocumento
˜˜  /
=
˜˜0 1
t
˜˜2 3
.
˜˜3 4
Actor_negocio1
˜˜4 B
.
˜˜B C
Actor
˜˜C H
.
˜˜H I$
id_documento_identidad
˜˜I _
,
˜˜_ `
NumeroComprobante
¯¯  1
=
¯¯2 3
t
¯¯4 5
.
¯¯5 6
Comprobante
¯¯6 A
.
¯¯A B
numero
¯¯B H
,
¯¯H I#
IdActorNegocioExterno
˘˘  5
=
˘˘6 7
t
˘˘8 9
.
˘˘9 :&
id_actor_negocio_externo
˘˘: R
,
˘˘R S
CodigoDocumento
˙˙  /
=
˙˙0 1
t
˙˙2 3
.
˙˙3 4
Actor_negocio1
˙˙4 B
.
˙˙B C
Actor
˙˙C H
.
˙˙H I
Detalle_maestro
˙˙I X
.
˙˙X Y
codigo
˙˙Y _
,
˙˙_ `
NumeroDocumento
˚˚  /
=
˚˚0 1
t
˚˚2 3
.
˚˚3 4
Actor_negocio1
˚˚4 B
.
˚˚B C
Actor
˚˚C H
.
˚˚H I(
numero_documento_identidad
˚˚I c
,
˚˚c d
PrimerNombre
¸¸  ,
=
¸¸- .
t
¸¸/ 0
.
¸¸0 1
Actor_negocio1
¸¸1 ?
.
¸¸? @
Actor
¸¸@ E
.
¸¸E F
primer_nombre
¸¸F S
,
¸¸S T
Igv
˝˝  #
=
˝˝$ %
t
˝˝& '
.
˝˝' (
importe8
˝˝( 0
,
˝˝0 1
ValorIcbper
˛˛  +
=
˛˛, -
t
˛˛. /
.
˛˛/ 0
	importe10
˛˛0 9
,
˛˛9 :
ValorDeVenta
ˇˇ  ,
=
ˇˇ- .
t
ˇˇ/ 0
.
ˇˇ0 1
importe_total
ˇˇ1 >
-
ˇˇ? @
t
ˇˇA B
.
ˇˇB C
importe8
ˇˇC K
-
ˇˇL M
t
ˇˇN O
.
ˇˇO P
	importe10
ˇˇP Y
,
ˇˇY Z
ImporteTotal
Ä Ä   ,
=
Ä Ä - .
t
Ä Ä / 0
.
Ä Ä 0 1
importe_total
Ä Ä 1 >
,
Ä Ä > ?
IdEstadoActual
Å Å   .
=
Å Å / 0
(
Å Å 1 2
int
Å Å 2 5
)
Å Å 5 6
t
Å Å 6 7
.
Å Å 7 8
id_estado_actual
Å Å 8 H
,
Å Å H I&
IdEstadoAnteriorAlActual
Ç Ç   8
=
Ç Ç 9 :
t
Ç Ç ; <
.
Ç Ç < = 
Estado_transaccion
Ç Ç = O
.
Ç Ç O P
OrderByDescending
Ç Ç P a
(
Ç Ç a b
est
Ç Ç b e
=>
Ç Ç f h
est
Ç Ç i l
.
Ç Ç l m
id
Ç Ç m o
)
Ç Ç o p
.
Ç Ç p q
Skip
Ç Ç q u
(
Ç Ç u v
$num
Ç Ç v w
)
Ç Ç w x
.
Ç Ç x y
Take
Ç Ç y }
(
Ç Ç } ~
$num
Ç Ç ~ 
)Ç Ç  Ä
.Ç Ç Ä Å
FirstOrDefaultÇ Ç Å è
(Ç Ç è ê
)Ç Ç ê ë
.Ç Ç ë í
	id_estadoÇ Ç í õ
,Ç Ç õ ú
CodigoMoneda
É É   ,
=
É É - .
t
É É / 0
.
É É 0 1
Detalle_maestro1
É É 1 A
.
É É A B
codigo
É É B H
,
É É H I#
NumeroSerieReferencia
Ñ Ñ   5
=
Ñ Ñ 6 7
t
Ñ Ñ 8 9
.
Ñ Ñ 9 :
Transaccion3
Ñ Ñ : F
.
Ñ Ñ F G
Comprobante
Ñ Ñ G R
.
Ñ Ñ R S
numero_serie
Ñ Ñ S _
,
Ñ Ñ _ `)
NumeroComprobanteReferencia
Ö Ö   ;
=
Ö Ö < =
t
Ö Ö > ?
.
Ö Ö ? @
Transaccion3
Ö Ö @ L
.
Ö Ö L M
Comprobante
Ö Ö M X
.
Ö Ö X Y
numero
Ö Ö Y _
,
Ö Ö _ `$
FechaEmisionReferencia
Ü Ü   6
=
Ü Ü 7 8
t
Ü Ü 9 :
.
Ü Ü : ;
Transaccion3
Ü Ü ; G
.
Ü Ü G H
fecha_inicio
Ü Ü H T
,
Ü Ü T U)
CodigoComprobanteReferencia
á á   ;
=
á á < =
t
á á > ?
.
á á ? @
Transaccion3
á á @ L
.
á á L M
Comprobante
á á M X
.
á á X Y
Detalle_maestro
á á Y h
.
á á h i
codigo
á á i o
}
à à  
)
â â  
;
â â  
}
ä ä  
catch
ã ã  
(
ã ã  
	Exception
ã ã  
e
ã ã  
)
ã ã  
{
å å  
throw
ç ç  
new
ç ç  
DatosException
ç ç  (
(
ç ç ( )
$str
ç ç ) N
,
ç ç N O
e
ç ç P Q
)
ç ç Q R
;
ç ç R S
}
é é  
}
è è  	
public
ë ë  
IEnumerable
ë ë  
<
ë ë  
Venta_Cliente
ë ë  (
>
ë ë ( )M
?ObtenerVentasClienteConOperacionDeReferenciaSegunElUltimoEstado
ë ë * i
(
ë ë i j
int
ë ë j m
[
ë ë m n
]
ë ë n o#
idsTiposComprobantesë ë p Ñ
,ë ë Ñ Ö
intë ë Ü â
[ë ë â ä
]ë ë ä ã#
idsTiposTransaccionë ë å ü
,ë ë ü †
intë ë ° §
idUltimoEstadoë ë • ≥
,ë ë ≥ ¥
DateTimeë ë µ Ω

fechaDesdeë ë æ »
,ë ë » …
DateTimeë ë   “

fechaHastaë ë ” ›
)ë ë › ﬁ
{
í í  	
try
ì ì  
{
î î  
return
ï ï  
_db
ï ï  
.
ï ï  
Transaccion
ï ï  &
.
ñ ñ  
Where
ñ ñ  !
(
ñ ñ ! "
t
ñ ñ " #
=>
ñ ñ $ &
t
ñ ñ ' (
.
ñ ñ ( )
fecha_inicio
ñ ñ ) 5
>=
ñ ñ 6 8

fechaDesde
ñ ñ 9 C
&&
ñ ñ D F
t
ñ ñ G H
.
ñ ñ H I
fecha_inicio
ñ ñ I U
<=
ñ ñ V X

fechaHasta
ñ ñ Y c
&&
ó ó  !
idsTiposTransaccion
ó ó  2
.
ó ó 2 3
Contains
ó ó 3 ;
(
ó ó ; <
t
ó ó < =
.
ó ó = >!
id_tipo_transaccion
ó ó > Q
)
ó ó Q R
&&
ò ò  "
idsTiposComprobantes
ò ò  3
.
ò ò 3 4
Contains
ò ò 4 <
(
ò ò < =
t
ò ò = >
.
ò ò > ?
Comprobante
ò ò ? J
.
ò ò J K!
id_tipo_comprobante
ò ò K ^
)
ò ò ^ _
&&
ô ô  
t
ô ô   
.
ô ô   !
id_estado_actual
ô ô ! 1
==
ô ô 2 4
idUltimoEstado
ô ô 5 C
)
ö ö  
.
õ õ  
Select
õ õ  #
(
õ õ # $
t
õ õ $ %
=>
õ õ & (
new
õ õ ) ,
Venta_Cliente
õ õ - :
(
õ õ : ;
)
õ õ ; <
{
ú ú  
Id
ù ù   "
=
ù ù # $
t
ù ù % &
.
ù ù & '
id
ù ù ' )
,
ù ù ) *
Anyo
ü ü   $
=
ü ü % &
t
ü ü ' (
.
ü ü ( )
fecha_inicio
ü ü ) 5
.
ü ü 5 6
Year
ü ü 6 :
,
ü ü : ;
Mes
† †   #
=
† † $ %
t
† † & '
.
† † ' (
fecha_inicio
† † ( 4
.
† † 4 5
Month
† † 5 :
,
† † : ;
Dia
° °   #
=
° ° $ %
t
° ° & '
.
° ° ' (
fecha_inicio
° ° ( 4
.
° ° 4 5
Day
° ° 5 8
,
° ° 8 9
IdTipoComprobante
¢ ¢   1
=
¢ ¢ 2 3
t
¢ ¢ 4 5
.
¢ ¢ 5 6
Comprobante
¢ ¢ 6 A
.
¢ ¢ A B!
id_tipo_comprobante
¢ ¢ B U
,
¢ ¢ U V
CodigoComprobante
£ £   1
=
£ £ 2 3
t
£ £ 4 5
.
£ £ 5 6
Comprobante
£ £ 6 A
.
£ £ A B
Detalle_maestro
£ £ B Q
.
£ £ Q R
codigo
£ £ R X
,
£ £ X Y$
NombreCortoComprobante
§ §   6
=
§ § 7 8
t
§ § 9 :
.
§ § : ;
Comprobante
§ § ; F
.
§ § F G
Detalle_maestro
§ § G V
.
§ § V W
valor
§ § W \
,
§ § \ ]
IdSerie
• •   '
=
• • ( )
t
• • * +
.
• • + ,
Comprobante
• • , 7
.
• • 7 8"
id_serie_comprobante
• • 8 L
,
• • L M
NumeroSerie
¶ ¶   +
=
¶ ¶ , -
t
¶ ¶ . /
.
¶ ¶ / 0
Comprobante
¶ ¶ 0 ;
.
¶ ¶ ; <
numero_serie
¶ ¶ < H
,
¶ ¶ H I
IdTipoDocumento
ß ß   /
=
ß ß 0 1
t
ß ß 2 3
.
ß ß 3 4
Actor_negocio1
ß ß 4 B
.
ß ß B C
Actor
ß ß C H
.
ß ß H I$
id_documento_identidad
ß ß I _
,
ß ß _ `
NumeroComprobante
® ®   1
=
® ® 2 3
t
® ® 4 5
.
® ® 5 6
Comprobante
® ® 6 A
.
® ® A B
numero
® ® B H
,
® ® H I#
IdActorNegocioExterno
© ©   5
=
© © 6 7
t
© © 8 9
.
© © 9 :&
id_actor_negocio_externo
© © : R
,
© © R S
CodigoDocumento
™ ™   /
=
™ ™ 0 1
t
™ ™ 2 3
.
™ ™ 3 4
Actor_negocio1
™ ™ 4 B
.
™ ™ B C
Actor
™ ™ C H
.
™ ™ H I
Detalle_maestro
™ ™ I X
.
™ ™ X Y
codigo
™ ™ Y _
,
™ ™ _ `
NumeroDocumento
´ ´   /
=
´ ´ 0 1
t
´ ´ 2 3
.
´ ´ 3 4
Actor_negocio1
´ ´ 4 B
.
´ ´ B C
Actor
´ ´ C H
.
´ ´ H I(
numero_documento_identidad
´ ´ I c
,
´ ´ c d
PrimerNombre
¨ ¨   ,
=
¨ ¨ - .
t
¨ ¨ / 0
.
¨ ¨ 0 1
Actor_negocio1
¨ ¨ 1 ?
.
¨ ¨ ? @
Actor
¨ ¨ @ E
.
¨ ¨ E F
primer_nombre
¨ ¨ F S
,
¨ ¨ S T
Igv
≠ ≠   #
=
≠ ≠ $ %
t
≠ ≠ & '
.
≠ ≠ ' (
importe8
≠ ≠ ( 0
,
≠ ≠ 0 1
ValorIcbper
Æ Æ   +
=
Æ Æ , -
t
Æ Æ . /
.
Æ Æ / 0
	importe10
Æ Æ 0 9
,
Æ Æ 9 :
ValorDeVenta
Ø Ø   ,
=
Ø Ø - .
t
Ø Ø / 0
.
Ø Ø 0 1
importe_total
Ø Ø 1 >
-
Ø Ø ? @
t
Ø Ø A B
.
Ø Ø B C
importe8
Ø Ø C K
-
Ø Ø L M
t
Ø Ø N O
.
Ø Ø O P
	importe10
Ø Ø P Y
,
Ø Ø Y Z
ImporteTotal
∞ ∞   ,
=
∞ ∞ - .
t
∞ ∞ / 0
.
∞ ∞ 0 1
importe_total
∞ ∞ 1 >
,
∞ ∞ > ?
IdEstadoActual
± ±   .
=
± ± / 0
(
± ± 1 2
int
± ± 2 5
)
± ± 5 6
t
± ± 6 7
.
± ± 7 8
id_estado_actual
± ± 8 H
,
± ± H I&
IdEstadoAnteriorAlActual
≤ ≤   8
=
≤ ≤ 9 :
t
≤ ≤ ; <
.
≤ ≤ < = 
Estado_transaccion
≤ ≤ = O
.
≤ ≤ O P
OrderByDescending
≤ ≤ P a
(
≤ ≤ a b
est
≤ ≤ b e
=>
≤ ≤ f h
est
≤ ≤ i l
.
≤ ≤ l m
id
≤ ≤ m o
)
≤ ≤ o p
.
≤ ≤ p q
Skip
≤ ≤ q u
(
≤ ≤ u v
$num
≤ ≤ v w
)
≤ ≤ w x
.
≤ ≤ x y
Take
≤ ≤ y }
(
≤ ≤ } ~
$num
≤ ≤ ~ 
)≤ ≤  Ä
.≤ ≤ Ä Å
FirstOrDefault≤ ≤ Å è
(≤ ≤ è ê
)≤ ≤ ê ë
.≤ ≤ ë í
	id_estado≤ ≤ í õ
,≤ ≤ õ ú
CodigoMoneda
≥ ≥   ,
=
≥ ≥ - .
t
≥ ≥ / 0
.
≥ ≥ 0 1
Detalle_maestro1
≥ ≥ 1 A
.
≥ ≥ A B
codigo
≥ ≥ B H
,
≥ ≥ H I#
NumeroSerieReferencia
¥ ¥   5
=
¥ ¥ 6 7
t
¥ ¥ 8 9
.
¥ ¥ 9 :
Transaccion3
¥ ¥ : F
==
¥ ¥ G I
null
¥ ¥ J N
?
¥ ¥ O P
null
¥ ¥ Q U
:
¥ ¥ V W
t
¥ ¥ X Y
.
¥ ¥ Y Z
Transaccion3
¥ ¥ Z f
.
¥ ¥ f g
Comprobante
¥ ¥ g r
.
¥ ¥ r s
numero_serie
¥ ¥ s 
,¥ ¥  Ä)
NumeroComprobanteReferencia
µ µ   ;
=
µ µ < =
t
µ µ > ?
.
µ µ ? @
Transaccion3
µ µ @ L
==
µ µ M O
null
µ µ P T
?
µ µ U V
$num
µ µ W X
:
µ µ Y Z
t
µ µ [ \
.
µ µ \ ]
Transaccion3
µ µ ] i
.
µ µ i j
Comprobante
µ µ j u
.
µ µ u v
numero
µ µ v |
,
µ µ | }$
FechaEmisionReferencia
∂ ∂   6
=
∂ ∂ 7 8
t
∂ ∂ 9 :
.
∂ ∂ : ;
Transaccion3
∂ ∂ ; G
==
∂ ∂ H J
null
∂ ∂ K O
?
∂ ∂ P Q
new
∂ ∂ R U
DateTime
∂ ∂ V ^
(
∂ ∂ ^ _
)
∂ ∂ _ `
:
∂ ∂ a b
t
∂ ∂ c d
.
∂ ∂ d e
Transaccion3
∂ ∂ e q
.
∂ ∂ q r
fecha_inicio
∂ ∂ r ~
,
∂ ∂ ~ )
CodigoComprobanteReferencia
∑ ∑   ;
=
∑ ∑ < =
t
∑ ∑ > ?
.
∑ ∑ ? @
Transaccion3
∑ ∑ @ L
==
∑ ∑ M O
null
∑ ∑ P T
?
∑ ∑ U V
null
∑ ∑ W [
:
∑ ∑ \ ]
t
∑ ∑ ^ _
.
∑ ∑ _ `
Transaccion3
∑ ∑ ` l
.
∑ ∑ l m
Comprobante
∑ ∑ m x
.
∑ ∑ x y
Detalle_maestro∑ ∑ y à
.∑ ∑ à â
codigo∑ ∑ â è
,∑ ∑ è ê
}
∏ ∏  
)
π π  
;
π π  
}
∫ ∫  
catch
ª ª  
(
ª ª  
	Exception
ª ª  
e
ª ª  
)
ª ª  
{
º º  
throw
Ω Ω  
new
Ω Ω  
DatosException
Ω Ω  (
(
Ω Ω ( )
$str
Ω Ω ) N
,
Ω Ω N O
e
Ω Ω P Q
)
Ω Ω Q R
;
Ω Ω R S
}
æ æ  
}
ø ø  	
public
¡ ¡  
IEnumerable
¡ ¡  
<
¡ ¡  
Venta_Cliente
¡ ¡  (
>
¡ ¡ ( )"
ObtenerVentasCliente
¡ ¡ * >
(
¡ ¡ > ?
int
¡ ¡ ? B
[
¡ ¡ B C
]
¡ ¡ C D"
idsTiposComprobantes
¡ ¡ E Y
,
¡ ¡ Y Z
int
¡ ¡ [ ^
[
¡ ¡ ^ _
]
¡ ¡ _ `!
idsTiposTransaccion
¡ ¡ a t
,
¡ ¡ t u
DateTime
¡ ¡ v ~

fechaDesde¡ ¡  â
,¡ ¡ â ä
DateTime¡ ¡ ã ì

fechaHasta¡ ¡ î û
)¡ ¡ û ü
{
¬ ¬  	
try
√ √  
{
ƒ ƒ  
return
∆ ∆  
_db
∆ ∆  
.
∆ ∆  
Transaccion
∆ ∆  &
.
« «  
Where
« «  !
(
« « ! "
t
« « " #
=>
« « $ &
t
« « ' (
.
« « ( )
fecha_inicio
« « ) 5
>=
« « 6 8

fechaDesde
« « 9 C
&&
« « D F
t
« « G H
.
« « H I
fecha_inicio
« « I U
<=
« « V X

fechaHasta
« « Y c
&&
» »  !
idsTiposTransaccion
» »  2
.
» » 2 3
Contains
» » 3 ;
(
» » ; <
t
» » < =
.
» » = >!
id_tipo_transaccion
» » > Q
)
» » Q R
&&
… …  "
idsTiposComprobantes
… …  3
.
… … 3 4
Contains
… … 4 <
(
… … < =
t
… … = >
.
… … > ?
Comprobante
… … ? J
.
… … J K!
id_tipo_comprobante
… … K ^
)
… … ^ _
)
À À  
.
Ã Ã  
Select
Ã Ã  #
(
Ã Ã # $
t
Ã Ã $ %
=>
Ã Ã & (
new
Ã Ã ) ,
Venta_Cliente
Ã Ã - :
(
Ã Ã : ;
)
Ã Ã ; <
{
Õ Õ  
Id
Œ Œ   "
=
Œ Œ # $
t
Œ Œ % &
.
Œ Œ & '
id
Œ Œ ' )
,
Œ Œ ) *
Anyo
œ œ   $
=
œ œ % &
t
œ œ ' (
.
œ œ ( )
fecha_inicio
œ œ ) 5
.
œ œ 5 6
Year
œ œ 6 :
,
œ œ : ;
Mes
– –   #
=
– – $ %
t
– – & '
.
– – ' (
fecha_inicio
– – ( 4
.
– – 4 5
Month
– – 5 :
,
– – : ;
Dia
— —   #
=
— — $ %
t
— — & '
.
— — ' (
fecha_inicio
— — ( 4
.
— — 4 5
Day
— — 5 8
,
— — 8 9
IdTipoTransaccion
“ “   1
=
“ “ 2 3
t
“ “ 4 5
.
“ “ 5 6!
id_tipo_transaccion
“ “ 6 I
,
“ “ I J
IdTipoComprobante
” ”   1
=
” ” 2 3
t
” ” 4 5
.
” ” 5 6
Comprobante
” ” 6 A
.
” ” A B!
id_tipo_comprobante
” ” B U
,
” ” U V
CodigoComprobante
‘ ‘   1
=
‘ ‘ 2 3
t
‘ ‘ 4 5
.
‘ ‘ 5 6
Comprobante
‘ ‘ 6 A
.
‘ ‘ A B
Detalle_maestro
‘ ‘ B Q
.
‘ ‘ Q R
codigo
‘ ‘ R X
,
‘ ‘ X Y
IdSerie
’ ’   '
=
’ ’ ( )
t
’ ’ * +
.
’ ’ + ,
Comprobante
’ ’ , 7
.
’ ’ 7 8"
id_serie_comprobante
’ ’ 8 L
,
’ ’ L M
NumeroSerie
÷ ÷   +
=
÷ ÷ , -
t
÷ ÷ . /
.
÷ ÷ / 0
Comprobante
÷ ÷ 0 ;
.
÷ ÷ ; <
numero_serie
÷ ÷ < H
,
÷ ÷ H I
IdTipoDocumento
◊ ◊   /
=
◊ ◊ 0 1
t
◊ ◊ 2 3
.
◊ ◊ 3 4
Actor_negocio1
◊ ◊ 4 B
.
◊ ◊ B C
Actor
◊ ◊ C H
.
◊ ◊ H I$
id_documento_identidad
◊ ◊ I _
,
◊ ◊ _ `
NumeroComprobante
ÿ ÿ   1
=
ÿ ÿ 2 3
t
ÿ ÿ 4 5
.
ÿ ÿ 5 6
Comprobante
ÿ ÿ 6 A
.
ÿ ÿ A B
numero
ÿ ÿ B H
,
ÿ ÿ H I#
IdActorNegocioExterno
Ÿ Ÿ   5
=
Ÿ Ÿ 6 7
t
Ÿ Ÿ 8 9
.
Ÿ Ÿ 9 :&
id_actor_negocio_externo
Ÿ Ÿ : R
,
Ÿ Ÿ R S
CodigoDocumento
⁄ ⁄   /
=
⁄ ⁄ 0 1
t
⁄ ⁄ 2 3
.
⁄ ⁄ 3 4
Actor_negocio1
⁄ ⁄ 4 B
.
⁄ ⁄ B C
Actor
⁄ ⁄ C H
.
⁄ ⁄ H I
Detalle_maestro
⁄ ⁄ I X
.
⁄ ⁄ X Y
codigo
⁄ ⁄ Y _
,
⁄ ⁄ _ `
NumeroDocumento
€ €   /
=
€ € 0 1
t
€ € 2 3
.
€ € 3 4
Actor_negocio1
€ € 4 B
.
€ € B C
Actor
€ € C H
.
€ € H I(
numero_documento_identidad
€ € I c
,
€ € c d
PrimerNombre
‹ ‹   ,
=
‹ ‹ - .
t
‹ ‹ / 0
.
‹ ‹ 0 1
Actor_negocio1
‹ ‹ 1 ?
.
‹ ‹ ? @
Actor
‹ ‹ @ E
.
‹ ‹ E F
primer_nombre
‹ ‹ F S
,
‹ ‹ S T
Igv
› ›   #
=
› › $ %
t
› › & '
.
› › ' (
importe8
› › ( 0
,
› › 0 1
ValorIcbper
ﬁ ﬁ   +
=
ﬁ ﬁ , -
t
ﬁ ﬁ . /
.
ﬁ ﬁ / 0
	importe10
ﬁ ﬁ 0 9
,
ﬁ ﬁ 9 :
ValorDeVenta
ﬂ ﬂ   ,
=
ﬂ ﬂ - .
t
ﬂ ﬂ / 0
.
ﬂ ﬂ 0 1
importe_total
ﬂ ﬂ 1 >
-
ﬂ ﬂ ? @
t
ﬂ ﬂ A B
.
ﬂ ﬂ B C
importe8
ﬂ ﬂ C K
-
ﬂ ﬂ L M
t
ﬂ ﬂ N O
.
ﬂ ﬂ O P
	importe10
ﬂ ﬂ P Y
,
ﬂ ﬂ Y Z
ImporteTotal
‡ ‡   ,
=
‡ ‡ - .
t
‡ ‡ / 0
.
‡ ‡ 0 1
importe_total
‡ ‡ 1 >
,
‡ ‡ > ?
IdEstadoActual
· ·   .
=
· · / 0
(
· · 1 2
int
· · 2 5
)
· · 5 6
t
· · 6 7
.
· · 7 8
id_estado_actual
· · 8 H
,
· · H I&
IdEstadoAnteriorAlActual
‚ ‚   8
=
‚ ‚ 9 :
t
‚ ‚ ; <
.
‚ ‚ < = 
Estado_transaccion
‚ ‚ = O
.
‚ ‚ O P
OrderByDescending
‚ ‚ P a
(
‚ ‚ a b
est
‚ ‚ b e
=>
‚ ‚ f h
est
‚ ‚ i l
.
‚ ‚ l m
id
‚ ‚ m o
)
‚ ‚ o p
.
‚ ‚ p q
Skip
‚ ‚ q u
(
‚ ‚ u v
$num
‚ ‚ v w
)
‚ ‚ w x
.
‚ ‚ x y
Take
‚ ‚ y }
(
‚ ‚ } ~
$num
‚ ‚ ~ 
)‚ ‚  Ä
.‚ ‚ Ä Å
FirstOrDefault‚ ‚ Å è
(‚ ‚ è ê
)‚ ‚ ê ë
.‚ ‚ ë í
	id_estado‚ ‚ í õ
,‚ ‚ õ ú
CodigoMoneda
„ „   ,
=
„ „ - .
t
„ „ / 0
.
„ „ 0 1
Detalle_maestro1
„ „ 1 A
.
„ „ A B
codigo
„ „ B H
}
Â Â  
)
Ê Ê  
;
Ê Ê  
}
Á Á  
catch
Ë Ë  
(
Ë Ë  
	Exception
Ë Ë  
e
Ë Ë  
)
Ë Ë  
{
È È  
throw
Í Í  
new
Í Í  
DatosException
Í Í  (
(
Í Í ( )
$str
Í Í ) N
,
Í Í N O
e
Í Í P Q
)
Í Í Q R
;
Í Í R S
}
Î Î  
}
Ï Ï  	
public
Ó Ó  
IEnumerable
Ó Ó  
<
Ó Ó  
Venta_Cliente
Ó Ó  (
>
Ó Ó ( );
-ObtenerVentasClienteSegunElEstadoQueDebeTener
Ó Ó * W
(
Ó Ó W X
int
Ó Ó X [
[
Ó Ó [ \
]
Ó Ó \ ]"
idsTiposComprobantes
Ó Ó ^ r
,
Ó Ó r s
int
Ó Ó t w
[
Ó Ó w x
]
Ó Ó x y"
idsTiposTransaccionÓ Ó z ç
,Ó Ó ç é
intÓ Ó è í
idUltimoEstadoÓ Ó ì °
,Ó Ó ° ¢
DateTimeÓ Ó £ ´

fechaDesdeÓ Ó ¨ ∂
,Ó Ó ∂ ∑
DateTimeÓ Ó ∏ ¿

fechaHastaÓ Ó ¡ À
)Ó Ó À Ã
{
Ô Ô  	
try
   
{
Ò Ò  
return
Ú Ú  
_db
Ú Ú  
.
Ú Ú  
Transaccion
Ú Ú  &
.
Û Û  
Where
Û Û  !
(
Û Û ! "
t
Û Û " #
=>
Û Û $ &
t
Û Û ' (
.
Û Û ( )
fecha_inicio
Û Û ) 5
>=
Û Û 6 8

fechaDesde
Û Û 9 C
&&
Û Û D F
t
Û Û G H
.
Û Û H I
fecha_inicio
Û Û I U
<=
Û Û V X

fechaHasta
Û Û Y c
&&
Ù Ù  !
idsTiposTransaccion
Ù Ù  2
.
Ù Ù 2 3
Contains
Ù Ù 3 ;
(
Ù Ù ; <
t
Ù Ù < =
.
Ù Ù = >!
id_tipo_transaccion
Ù Ù > Q
)
Ù Ù Q R
&&
ı ı  "
idsTiposComprobantes
ı ı  3
.
ı ı 3 4
Contains
ı ı 4 <
(
ı ı < =
t
ı ı = >
.
ı ı > ?
Comprobante
ı ı ? J
.
ı ı J K!
id_tipo_comprobante
ı ı K ^
)
ı ı ^ _
&&
ˆ ˆ  
t
ˆ ˆ   
.
ˆ ˆ   !
id_estado_actual
ˆ ˆ ! 1
==
ˆ ˆ 2 4
idUltimoEstado
ˆ ˆ 5 C
)
ˆ ˆ C D
.
˜ ˜  
Select
˜ ˜  #
(
˜ ˜ # $
t
˜ ˜ $ %
=>
˜ ˜ & (
new
˜ ˜ ) ,
Venta_Cliente
˜ ˜ - :
(
˜ ˜ : ;
)
˜ ˜ ; <
{
¯ ¯  
Id
˘ ˘   "
=
˘ ˘ # $
t
˘ ˘ % &
.
˘ ˘ & '
id
˘ ˘ ' )
,
˘ ˘ ) *
Anyo
˙ ˙   $
=
˙ ˙ % &
t
˙ ˙ ' (
.
˙ ˙ ( )
fecha_inicio
˙ ˙ ) 5
.
˙ ˙ 5 6
Year
˙ ˙ 6 :
,
˙ ˙ : ;
Mes
˚ ˚   #
=
˚ ˚ $ %
t
˚ ˚ & '
.
˚ ˚ ' (
fecha_inicio
˚ ˚ ( 4
.
˚ ˚ 4 5
Month
˚ ˚ 5 :
,
˚ ˚ : ;
Dia
¸ ¸   #
=
¸ ¸ $ %
t
¸ ¸ & '
.
¸ ¸ ' (
fecha_inicio
¸ ¸ ( 4
.
¸ ¸ 4 5
Day
¸ ¸ 5 8
,
¸ ¸ 8 9
FechaEmision
˝ ˝   ,
=
˝ ˝ - .
t
˝ ˝ / 0
.
˝ ˝ 0 1
fecha_inicio
˝ ˝ 1 =
,
˝ ˝ = >
IdTipoComprobante
˛ ˛   1
=
˛ ˛ 2 3
t
˛ ˛ 4 5
.
˛ ˛ 5 6
Comprobante
˛ ˛ 6 A
.
˛ ˛ A B!
id_tipo_comprobante
˛ ˛ B U
,
˛ ˛ U V
CodigoComprobante
ˇ ˇ   1
=
ˇ ˇ 2 3
t
ˇ ˇ 4 5
.
ˇ ˇ 5 6
Comprobante
ˇ ˇ 6 A
.
ˇ ˇ A B
Detalle_maestro
ˇ ˇ B Q
.
ˇ ˇ Q R
codigo
ˇ ˇ R X
,
ˇ ˇ X Y$
NombreCortoComprobante
Ä!Ä!  6
=
Ä!Ä!7 8
t
Ä!Ä!9 :
.
Ä!Ä!: ;
Comprobante
Ä!Ä!; F
.
Ä!Ä!F G
Detalle_maestro
Ä!Ä!G V
.
Ä!Ä!V W
valor
Ä!Ä!W \
,
Ä!Ä!\ ]
IdSerie
Å!Å!  '
=
Å!Å!( )
t
Å!Å!* +
.
Å!Å!+ ,
Comprobante
Å!Å!, 7
.
Å!Å!7 8"
id_serie_comprobante
Å!Å!8 L
,
Å!Å!L M
NumeroSerie
Ç!Ç!  +
=
Ç!Ç!, -
t
Ç!Ç!. /
.
Ç!Ç!/ 0
Comprobante
Ç!Ç!0 ;
.
Ç!Ç!; <
numero_serie
Ç!Ç!< H
,
Ç!Ç!H I
IdTipoDocumento
É!É!  /
=
É!É!0 1
t
É!É!2 3
.
É!É!3 4
Actor_negocio1
É!É!4 B
.
É!É!B C
Actor
É!É!C H
.
É!É!H I$
id_documento_identidad
É!É!I _
,
É!É!_ `
NumeroComprobante
Ñ!Ñ!  1
=
Ñ!Ñ!2 3
t
Ñ!Ñ!4 5
.
Ñ!Ñ!5 6
Comprobante
Ñ!Ñ!6 A
.
Ñ!Ñ!A B
numero
Ñ!Ñ!B H
,
Ñ!Ñ!H I#
IdActorNegocioExterno
Ö!Ö!  5
=
Ö!Ö!6 7
t
Ö!Ö!8 9
.
Ö!Ö!9 :&
id_actor_negocio_externo
Ö!Ö!: R
,
Ö!Ö!R S
CodigoDocumento
Ü!Ü!  /
=
Ü!Ü!0 1
t
Ü!Ü!2 3
.
Ü!Ü!3 4
Actor_negocio1
Ü!Ü!4 B
.
Ü!Ü!B C
Actor
Ü!Ü!C H
.
Ü!Ü!H I
Detalle_maestro
Ü!Ü!I X
.
Ü!Ü!X Y
codigo
Ü!Ü!Y _
,
Ü!Ü!_ `
NumeroDocumento
á!á!  /
=
á!á!0 1
t
á!á!2 3
.
á!á!3 4
Actor_negocio1
á!á!4 B
.
á!á!B C
Actor
á!á!C H
.
á!á!H I(
numero_documento_identidad
á!á!I c
,
á!á!c d
PrimerNombre
à!à!  ,
=
à!à!- .
t
à!à!/ 0
.
à!à!0 1
Actor_negocio1
à!à!1 ?
.
à!à!? @
Actor
à!à!@ E
.
à!à!E F
primer_nombre
à!à!F S
,
à!à!S T
Igv
â!â!  #
=
â!â!$ %
t
â!â!& '
.
â!â!' (
importe8
â!â!( 0
,
â!â!0 1
ValorIcbper
ä!ä!  +
=
ä!ä!, -
t
ä!ä!. /
.
ä!ä!/ 0
	importe10
ä!ä!0 9
,
ä!ä!9 :
ValorDeVenta
ã!ã!  ,
=
ã!ã!- .
t
ã!ã!/ 0
.
ã!ã!0 1
importe_total
ã!ã!1 >
-
ã!ã!? @
t
ã!ã!A B
.
ã!ã!B C
importe8
ã!ã!C K
-
ã!ã!L M
t
ã!ã!N O
.
ã!ã!O P
	importe10
ã!ã!P Y
,
ã!ã!Y Z
ImporteTotal
å!å!  ,
=
å!å!- .
t
å!å!/ 0
.
å!å!0 1
importe_total
å!å!1 >
,
å!å!> ?
IdEstadoActual
ç!ç!  .
=
ç!ç!/ 0
(
ç!ç!1 2
int
ç!ç!2 5
)
ç!ç!5 6
t
ç!ç!6 7
.
ç!ç!7 8
id_estado_actual
ç!ç!8 H
,
ç!ç!H I&
IdEstadoAnteriorAlActual
é!é!  8
=
é!é!9 :
t
é!é!; <
.
é!é!< = 
Estado_transaccion
é!é!= O
.
é!é!O P
OrderByDescending
é!é!P a
(
é!é!a b
est
é!é!b e
=>
é!é!f h
est
é!é!i l
.
é!é!l m
id
é!é!m o
)
é!é!o p
.
é!é!p q
Skip
é!é!q u
(
é!é!u v
$num
é!é!v w
)
é!é!w x
.
é!é!x y
Take
é!é!y }
(
é!é!} ~
$num
é!é!~ 
)é!é! Ä
.é!é!Ä Å
FirstOrDefaulté!é!Å è
(é!é!è ê
)é!é!ê ë
.é!é!ë í
	id_estadoé!é!í õ
,é!é!õ ú
CodigoMoneda
è!è!  ,
=
è!è!- .
t
è!è!/ 0
.
è!è!0 1
Detalle_maestro1
è!è!1 A
.
è!è!A B
codigo
è!è!B H
,
è!è!H I
}
ê!ê! 
)
ë!ë! 
;
ë!ë! 
}
í!í! 
catch
ì!ì! 
(
ì!ì! 
	Exception
ì!ì! 
e
ì!ì! 
)
ì!ì! 
{
î!î! 
throw
ï!ï! 
new
ï!ï! 
DatosException
ï!ï! (
(
ï!ï!( )
$str
ï!ï!) N
,
ï!ï!N O
e
ï!ï!P Q
)
ï!ï!Q R
;
ï!ï!R S
}
ñ!ñ! 
}
ó!ó! 	
public
û!û! 
OperationResult
û!û! +
ActualizarDetallesTransaccion
û!û! <
(
û!û!< =
List
û!û!= A
<
û!û!A B!
Detalle_transaccion
û!û!B U
>
û!û!U V!
detallesTransaccion
û!û!W j
)
û!û!j k
{
ü!ü! 	
try
†!†! 
{
°!°! .
 SetActualizarDetallesTransaccion
¢!¢! 0
(
¢!¢!0 1!
detallesTransaccion
¢!¢!1 D
)
¢!¢!D E
;
¢!¢!E F
OperationResult
£!£! 
result
£!£!  &
=
£!£!' (
new
£!£!) ,
OperationResult
£!£!- <
(
£!£!< =
)
£!£!= >
;
£!£!> ?
result
§!§! 
=
§!§! 
Save
§!§! 
(
§!§! 
)
§!§! 
;
§!§!  
return
•!•! 
result
•!•! 
;
•!•! 
}
¶!¶! 
catch
ß!ß! 
(
ß!ß! 
	Exception
ß!ß! 
e
ß!ß! 
)
ß!ß! 
{
®!®! 
throw
©!©! 
new
©!©! 
DatosException
©!©! (
(
©!©!( )
$str
©!©!) V
,
©!©!V W
e
©!©!X Y
)
©!©!Y Z
;
©!©!Z [
}
™!™! 
}
´!´! 	
public
¨!¨! 
OperationResult
¨!¨! 0
"CrearActualizarDetallesTransaccion
¨!¨! A
(
¨!¨!A B
List
¨!¨!B F
<
¨!¨!F G!
Detalle_transaccion
¨!¨!G Z
>
¨!¨!Z [*
detallesTransaccionParaCrear
¨!¨!\ x
,
¨!¨!x y
List
¨!¨!z ~
<
¨!¨!~ "
Detalle_transaccion¨!¨! í
>¨!¨!í ì1
!detallesTransaccionParaActualizar¨!¨!î µ
)¨!¨!µ ∂
{
≠!≠! 	
try
Æ!Æ! 
{
Ø!Ø! 
OperationResult
∞!∞! 
result
∞!∞!  &
=
∞!∞!' (
new
∞!∞!) ,
OperationResult
∞!∞!- <
(
∞!∞!< =
)
∞!∞!= >
;
∞!∞!> ?
_db
±!±! 
.
±!±! !
Detalle_transaccion
±!±! '
.
±!±!' (
AddRange
±!±!( 0
(
±!±!0 1*
detallesTransaccionParaCrear
±!±!1 M
)
±!±!M N
;
±!±!N O
if
≤!≤! 
(
≤!≤! /
!detallesTransaccionParaActualizar
≤!≤! 5
!=
≤!≤!6 8
null
≤!≤!9 =
)
≤!≤!= >
{
≥!≥! .
 SetActualizarDetallesTransaccion
¥!¥! 4
(
¥!¥!4 5/
!detallesTransaccionParaActualizar
¥!¥!5 V
)
¥!¥!V W
;
¥!¥!W X
}
µ!µ! 
result
∂!∂! 
=
∂!∂! 
Save
∂!∂! 
(
∂!∂! 
)
∂!∂! 
;
∂!∂!  
return
∑!∑! 
result
∑!∑! 
;
∑!∑! 
}
∏!∏! 
catch
π!π! 
(
π!π! 
	Exception
π!π! 
e
π!π! 
)
π!π! 
{
∫!∫! 
throw
ª!ª! 
new
ª!ª! 
DatosException
ª!ª! (
(
ª!ª!( )
$str
ª!ª!) _
,
ª!ª!_ `
e
ª!ª!a b
)
ª!ª!b c
;
ª!ª!c d
}
º!º! 
}
Ω!Ω! 	
public
ø!ø! 
void
ø!ø! .
 SetActualizarDetallesTransaccion
ø!ø! 4
(
ø!ø!4 5
IEnumerable
ø!ø!5 @
<
ø!ø!@ A!
Detalle_transaccion
ø!ø!A T
>
ø!ø!T U!
detallesTransaccion
ø!ø!V i
)
ø!ø!i j
{
¿!¿! 	
var
¡!¡! 
ids_updDetalles
¡!¡! 
=
¡!¡!  !!
detallesTransaccion
¡!¡!" 5
.
¡!¡!5 6
Select
¡!¡!6 <
(
¡!¡!< =
d
¡!¡!= >
=>
¡!¡!? A
d
¡!¡!B C
.
¡!¡!C D
id
¡!¡!D F
)
¡!¡!F G
.
¡!¡!G H
ToArray
¡!¡!H O
(
¡!¡!O P
)
¡!¡!P Q
;
¡!¡!Q R
var
¬!¬! 
db_detalles
¬!¬! 
=
¬!¬! 
_db
¬!¬! !
.
¬!¬!! "!
Detalle_transaccion
¬!¬!" 5
.
¬!¬!5 6
Where
¬!¬!6 ;
(
¬!¬!; <
dt
¬!¬!< >
=>
¬!¬!? A
ids_updDetalles
¬!¬!B Q
.
¬!¬!Q R
Contains
¬!¬!R Z
(
¬!¬!Z [
dt
¬!¬![ ]
.
¬!¬!] ^
id
¬!¬!^ `
)
¬!¬!` a
)
¬!¬!a b
.
¬!¬!b c
ToArray
¬!¬!c j
(
¬!¬!j k
)
¬!¬!k l
;
¬!¬!l m
foreach
√!√! 
(
√!√! 
var
√!√! 
item
√!√! 
in
√!√!  !
detallesTransaccion
√!√!! 4
)
√!√!4 5
{
ƒ!ƒ! !
Detalle_transaccion
∆!∆! ##
dbDetalle_Transaccion
∆!∆!$ 9
=
∆!∆!: ;
db_detalles
∆!∆!< G
.
∆!∆!G H
Single
∆!∆!H N
(
∆!∆!N O
dt
∆!∆!O Q
=>
∆!∆!R T
dt
∆!∆!U W
.
∆!∆!W X
id
∆!∆!X Z
==
∆!∆![ ]
item
∆!∆!^ b
.
∆!∆!b c
id
∆!∆!c e
)
∆!∆!e f
;
∆!∆!f g
_db
«!«! 
.
«!«! 
Entry
«!«! 
(
«!«! #
dbDetalle_Transaccion
«!«! /
)
«!«!/ 0
.
«!«!0 1
CurrentValues
«!«!1 >
.
«!«!> ?
	SetValues
«!«!? H
(
«!«!H I
item
«!«!I M
)
«!«!M N
;
«!«!N O
}
»!»! 
}
…!…! 	
public
œ!œ! 
IEnumerable
œ!œ! 
<
œ!œ! 3
%ValorDetalleMaestroDetalleTransaccion
œ!œ! @
>
œ!œ!@ A?
1ObtenerValoresDetallesMaestroDetallesTransaccionn
œ!œ!B s
(
œ!œ!s t
int
œ!œ!t w$
idActorNegocioInternoœ!œ!x ç
,œ!œ!ç é
intœ!œ!è í!
idTipoTransaccionœ!œ!ì §
,œ!œ!§ •
intœ!œ!¶ ©!
idConceptoNegocioœ!œ!™ ª
)œ!œ!ª º
{
–!–! 	
try
—!—! 
{
“!“! 
return
‘!‘! 
_db
‘!‘! 
.
‘!‘! 
Transaccion
‘!‘! &
.
‘!‘!& '
Where
‘!‘!' ,
(
‘!‘!, -
t
‘!‘!- .
=>
‘!‘!/ 1
t
‘!‘!2 3
.
‘!‘!3 4&
id_actor_negocio_interno
‘!‘!4 L
==
‘!‘!M O#
idActorNegocioInterno
‘!‘!P e
&&
‘!‘!f h
t
‘!‘!i j
.
‘!‘!j k!
id_tipo_transaccion
‘!‘!k ~
==‘!‘! Å!
idTipoTransaccion‘!‘!Ç ì
)‘!‘!ì î
.
’!’!& '

SelectMany
’!’!' 1
(
’!’!1 2
t
’!’!2 3
=>
’!’!4 6
t
’!’!7 8
.
’!’!8 9!
Detalle_transaccion
’!’!9 L
)
’!’!L M
.
÷!÷!& '
Where
÷!÷!' ,
(
÷!÷!, -
dt
÷!÷!- /
=>
÷!÷!0 2
dt
÷!÷!3 5
.
÷!÷!5 6!
id_concepto_negocio
÷!÷!6 I
==
÷!÷!J L
idConceptoNegocio
÷!÷!M ^
)
÷!÷!^ _
.
◊!◊!& '

SelectMany
◊!◊!' 1
(
◊!◊!1 2
dt
◊!◊!2 4
=>
◊!◊!5 7
dt
◊!◊!8 :
.
◊!◊!: ;7
)Valor_detalle_maestro_detalle_transaccion
◊!◊!; d
)
◊!◊!d e
.
ÿ!ÿ!& '
Select
ÿ!ÿ!' -
(
ÿ!ÿ!- .
vdmdt
ÿ!ÿ!. 3
=>
ÿ!ÿ!4 6
new
ÿ!ÿ!7 :3
%ValorDetalleMaestroDetalleTransaccion
ÿ!ÿ!; `
(
ÿ!ÿ!` a
)
ÿ!ÿ!a b
{
Ÿ!Ÿ!& '
Id
⁄!⁄!* ,
=
⁄!⁄!- .
vdmdt
⁄!⁄!/ 4
.
⁄!⁄!4 5
id
⁄!⁄!5 7
,
⁄!⁄!7 8
Numero
€!€!* 0
=
€!€!1 2
vdmdt
€!€!3 8
.
€!€!8 9
numero
€!€!9 ?
,
€!€!? @
Valor
‹!‹!* /
=
‹!‹!0 1
vdmdt
‹!‹!2 7
.
‹!‹!7 8
valor
‹!‹!8 =
,
‹!‹!= >
IdDetalleMaestro
›!›!* :
=
›!›!; <
vdmdt
›!›!= B
.
›!›!B C 
id_detalle_maestro
›!›!C U
,
›!›!U V"
IdDetalleTransaccion
ﬁ!ﬁ!* >
=
ﬁ!ﬁ!? @
vdmdt
ﬁ!ﬁ!A F
.
ﬁ!ﬁ!F G$
id_detalle_transaccion
ﬁ!ﬁ!G ]
,
ﬁ!ﬁ!] ^
}
ﬂ!ﬂ!& '
)
ﬂ!ﬂ!' (
;
ﬂ!ﬂ!( )
}
‡!‡! 
catch
·!·! 
(
·!·! 
	Exception
·!·! 
e
·!·! 
)
·!·! 
{
‚!‚! 
throw
„!„! 
new
„!„! 
DatosException
„!„! (
(
„!„!( )
$str
„!„!) o
,
„!„!o p
e
„!„!q r
)
„!„!r s
;
„!„!s t
}
‰!‰! 
}
Â!Â! 	
public
Ò!Ò! 
int
Ò!Ò! 4
&ObtenerNumeroDeTransaccionesExistentes
Ò!Ò! 9
(
Ò!Ò!9 :
int
Ò!Ò!: =#
idActorNegocioInterno
Ò!Ò!> S
,
Ò!Ò!S T
int
Ò!Ò!U X
idTipoTransaccion
Ò!Ò!Y j
,
Ò!Ò!j k
int
Ò!Ò!l o
idUltimoEstado
Ò!Ò!p ~
)
Ò!Ò!~ 
{
Ú!Ú! 	
try
Û!Û! 
{
Ù!Ù! 
return
ı!ı! 
_db
ı!ı! 
.
ı!ı! 
Transaccion
ı!ı! &
.
ı!ı!& '
Count
ı!ı!' ,
(
ı!ı!, -
t
ı!ı!- .
=>
ı!ı!/ 1
t
ı!ı!2 3
.
ı!ı!3 4&
id_actor_negocio_interno
ı!ı!4 L
==
ı!ı!M O#
idActorNegocioInterno
ı!ı!P e
&&
ˆ!ˆ!0 2
t
ˆ!ˆ!3 4
.
ˆ!ˆ!4 5!
id_tipo_transaccion
ˆ!ˆ!5 H
==
ˆ!ˆ!I K
idTipoTransaccion
ˆ!ˆ!L ]
&&
˜!˜!0 2
t
˜!˜!3 4
.
˜!˜!4 5
id_estado_actual
˜!˜!5 E
==
˜!˜!F H
idUltimoEstado
˜!˜!I W
)
˜!˜!W X
;
˜!˜!X Y
}
¯!¯! 
catch
˘!˘! 
(
˘!˘! 
	Exception
˘!˘! 
e
˘!˘! 
)
˘!˘! 
{
˙!˙! 
throw
˚!˚! 
new
˚!˚! 
DatosException
˚!˚! (
(
˚!˚!( )
$str
˚!˚!) r
,
˚!˚!r s
e
˚!˚!t u
)
˚!˚!u v
;
˚!˚!v w
}
¸!¸! 
}
˝!˝! 	
public
Å"Å" 
void
Å"Å" '
MarcarSerieComoModificada
Å"Å" -
(
Å"Å"- .
Serie_comprobante
Å"Å". ?
serie
Å"Å"@ E
)
Å"Å"E F
{
Ç"Ç" 	
_db
É"É" 
.
É"É" 
Entry
É"É" 
(
É"É" 
serie
É"É" 
)
É"É" 
.
É"É" 
State
É"É" "
=
É"É"# $
EntityState
É"É"% 0
.
É"É"0 1
Modified
É"É"1 9
;
É"É"9 :
}
Ñ"Ñ" 	
public
â"â" 
OperationResult
â"â" @
2CrearTransaccionCrearActualizarDetallesTransaccion
â"â" Q
(
â"â"Q R
Transaccion
â"â"R ]
transaccion
â"â"^ i
,
â"â"i j
List
â"â"k o
<
â"â"o p"
Detalle_transaccionâ"â"p É
>â"â"É Ñ,
detallesTransaccionParaCrearâ"â"Ö °
,â"â"° ¢
Listâ"â"£ ß
<â"â"ß ®#
Detalle_transaccionâ"â"® ª
>â"â"ª º1
!detallesTransaccionParaActualizarâ"â"Ω ﬁ
,â"â"ﬁ ﬂ
Transaccionâ"â"‡ Î%
transaccionActualizarâ"â"Ï Å
)â"â"Å Ç
{
ä"ä" 	
try
ã"ã" 
{
å"å" 
_db
é"é" 
.
é"é" 
Transaccion
é"é" 
.
é"é"  
Add
é"é"  #
(
é"é"# $
transaccion
é"é"$ /
)
é"é"/ 0
;
é"é"0 1
if
è"è" 
(
è"è" *
detallesTransaccionParaCrear
è"è" 0
!=
è"è"1 3
null
è"è"4 8
)
è"è"8 9
{
ê"ê" 
_db
ë"ë" 
.
ë"ë" !
Detalle_transaccion
ë"ë" +
.
ë"ë"+ ,
AddRange
ë"ë", 4
(
ë"ë"4 5*
detallesTransaccionParaCrear
ë"ë"5 Q
)
ë"ë"Q R
;
ë"ë"R S
}
í"í" 
if
ì"ì" 
(
ì"ì" /
!detallesTransaccionParaActualizar
ì"ì" 5
!=
ì"ì"6 8
null
ì"ì"9 =
)
ì"ì"= >
{
î"î" .
 SetActualizarDetallesTransaccion
ï"ï" 4
(
ï"ï"4 5/
!detallesTransaccionParaActualizar
ï"ï"5 V
)
ï"ï"V W
;
ï"ï"W X
}
ñ"ñ" 
if
ò"ò" 
(
ò"ò" #
transaccionActualizar
ò"ò" )
!=
ò"ò"* ,
null
ò"ò"- 1
)
ò"ò"1 2
{
ô"ô" 
_db
ö"ö" 
.
ö"ö" 
Entry
ö"ö" 
(
ö"ö" #
transaccionActualizar
ö"ö" 3
)
ö"ö"3 4
.
ö"ö"4 5
State
ö"ö"5 :
=
ö"ö"; <
EntityState
ö"ö"= H
.
ö"ö"H I
Modified
ö"ö"I Q
;
ö"ö"Q R
}
õ"õ" 
OperationResult
ú"ú" 
result
ú"ú"  &
=
ú"ú"' (
Save
ú"ú") -
(
ú"ú"- .
)
ú"ú". /
;
ú"ú"/ 0
return
û"û" 
result
û"û" 
;
û"û" 
}
ü"ü" 
catch
°"°" 
(
°"°" *
DbUpdateConcurrencyException
°"°" /
ex
°"°"0 2
)
°"°"2 3
{
¢"¢" 
var
£"£" 
entry
£"£" 
=
£"£" 
ex
£"£" 
.
£"£" 
Entries
£"£" &
.
£"£"& '
Single
£"£"' -
(
£"£"- .
)
£"£". /
;
£"£"/ 0
var
•"•" 
	typeModel
•"•" 
=
•"•" 
ObjectContext
•"•"  -
.
•"•"- .
GetObjectType
•"•". ;
(
•"•"; <
entry
•"•"< A
.
•"•"A B
Entity
•"•"B H
.
•"•"H I
GetType
•"•"I P
(
•"•"P Q
)
•"•"Q R
)
•"•"R S
;
•"•"S T
if
ß"ß" 
(
ß"ß" 
	typeModel
ß"ß" 
.
ß"ß" 
Name
ß"ß" "
==
ß"ß"# %
typeof
ß"ß"& ,
(
ß"ß", -!
Detalle_transaccion
ß"ß"- @
)
ß"ß"@ A
.
ß"ß"A B
Name
ß"ß"B F
)
ß"ß"F G
{
®"®" 
return
©"©" 
new
©"©" 
OperationResult
©"©" .
(
©"©". /
new
©"©"/ 2)
DetalleTransaccionException
©"©"3 N
(
©"©"N O
ex
©"©"O Q
,
©"©"Q R
(
©"©"S T!
Detalle_transaccion
©"©"T g
)
©"©"g h
entry
©"©"h m
.
©"©"m n
Entity
©"©"n t
,
©"©"t u
transaccion©"©"v Å
)©"©"Å Ç
)©"©"Ç É
;©"©"É Ñ
}
™"™" 
else
´"´" 
{
¨"¨" 
return
≠"≠" 
new
≠"≠" 
OperationResult
≠"≠" .
(
≠"≠". /
new
≠"≠"/ 2'
SerieComprobanteException
≠"≠"3 L
(
≠"≠"L M
ex
≠"≠"M O
,
≠"≠"O P
(
≠"≠"Q R
Serie_comprobante
≠"≠"R c
)
≠"≠"c d
entry
≠"≠"d i
.
≠"≠"i j
Entity
≠"≠"j p
)
≠"≠"p q
)
≠"≠"q r
;
≠"≠"r s
}
Æ"Æ" 
}
Ø"Ø" 
catch
∞"∞" 
(
∞"∞" 
	Exception
∞"∞" 
e
∞"∞" 
)
∞"∞" 
{
±"±" 
throw
≤"≤" 
new
≤"≤" 
DatosException
≤"≤" (
(
≤"≤"( )
$str
≤"≤") P
,
≤"≤"P Q
e
≤"≤"R S
)
≤"≤"S T
;
≤"≤"T U
}
≥"≥" 
finally
¥"¥" 
{
µ"µ" 
}
∏"∏" 
}
π"π" 	
public
∫"∫" 
OperationResult
∫"∫" I
;CrearTransaccionActualizarTransaccionCrearEstadoTransaccion
∫"∫" Z
(
∫"∫"Z [
Transaccion
∫"∫"[ f
transaccionCrear
∫"∫"g w
,
∫"∫"w x
Transaccion∫"∫"y Ñ%
transaccionActualizar∫"∫"Ö ö
,∫"∫"ö õ"
Estado_transaccion∫"∫"ú Æ&
estadoTransaccionCrear∫"∫"Ø ≈
)∫"∫"≈ ∆
{
ª"ª" 	
try
º"º" 
{
Ω"Ω" 
_db
ø"ø" 
.
ø"ø" 
Transaccion
ø"ø" 
.
ø"ø"  
Add
ø"ø"  #
(
ø"ø"# $
transaccionCrear
ø"ø"$ 4
)
ø"ø"4 5
;
ø"ø"5 6
_db
¿"¿" 
.
¿"¿"  
Estado_transaccion
¿"¿" &
.
¿"¿"& '
Add
¿"¿"' *
(
¿"¿"* +$
estadoTransaccionCrear
¿"¿"+ A
)
¿"¿"A B
;
¿"¿"B C
_db
√"√" 
.
√"√" 
Entry
√"√" 
(
√"√" #
transaccionActualizar
√"√" /
)
√"√"/ 0
.
√"√"0 1
State
√"√"1 6
=
√"√"7 8
EntityState
√"√"9 D
.
√"√"D E
Modified
√"√"E M
;
√"√"M N
OperationResult
ƒ"ƒ" 
result
ƒ"ƒ"  &
=
ƒ"ƒ"' (
Save
ƒ"ƒ") -
(
ƒ"ƒ"- .
)
ƒ"ƒ". /
;
ƒ"ƒ"/ 0
return
≈"≈" 
result
≈"≈" 
;
≈"≈" 
}
∆"∆" 
catch
«"«" 
(
«"«" 
	Exception
«"«" 
e
«"«" 
)
«"«" 
{
»"»" 
throw
…"…" 
new
…"…" 
DatosException
…"…" (
(
…"…"( )
$str
…"…") E
,
…"…"E F
e
…"…"G H
)
…"…"H I
;
…"…"I J
}
 " " 
}
À"À" 	
public
Ã"Ã" 
OperationResult
Ã"Ã" j
\CrearTransaccionesCrearEstadosTransaccionCrearEstadosCuotaCrearActualizarDetallesTransaccion
Ã"Ã" {
(
Ã"Ã"{ |
ListÃ"Ã"| Ä
<Ã"Ã"Ä Å
TransaccionÃ"Ã"Å å
>Ã"Ã"å ç&
transaccionesParaCrearÃ"Ã"é §
,Ã"Ã"§ •
ListÃ"Ã"¶ ™
<Ã"Ã"™ ´"
Estado_transaccionÃ"Ã"´ Ω
>Ã"Ã"Ω æ-
estadosDeTransaccionParaCrearÃ"Ã"ø ‹
,Ã"Ã"‹ ›
ListÃ"Ã"ﬁ ‚
<Ã"Ã"‚ „
Estado_cuotaÃ"Ã"„ Ô
>Ã"Ã"Ô '
estadosDeCuotaParaCrearÃ"Ã"Ò à
,Ã"Ã"à â
ListÃ"Ã"ä é
<Ã"Ã"é è#
Detalle_transaccionÃ"Ã"è ¢
>Ã"Ã"¢ £,
detallesTransaccionParaCrearÃ"Ã"§ ¿
,Ã"Ã"¿ ¡
ListÃ"Ã"¬ ∆
<Ã"Ã"∆ «#
Detalle_transaccionÃ"Ã"« ⁄
>Ã"Ã"⁄ €1
!detallesTransaccionParaActualizarÃ"Ã"‹ ˝
,Ã"Ã"˝ ˛
ListÃ"Ã"ˇ É
<Ã"Ã"É Ñ
Actor_negocioÃ"Ã"Ñ ë
>Ã"Ã"ë í,
actoresNegocioParaActualizarÃ"Ã"ì Ø
)Ã"Ã"Ø ∞
{
Õ"Õ" 	
try
Œ"Œ" 
{
œ"œ" 
if
–"–" 
(
–"–" $
transaccionesParaCrear
–"–" *
!=
–"–"+ -
null
–"–". 2
)
–"–"2 3
{
—"—" 
_db
“"“" 
.
“"“" 
Transaccion
“"“" #
.
“"“"# $
AddRange
“"“"$ ,
(
“"“", -$
transaccionesParaCrear
“"“"- C
)
“"“"C D
;
“"“"D E
}
”"”" 
if
‘"‘" 
(
‘"‘" +
estadosDeTransaccionParaCrear
‘"‘" 1
!=
‘"‘"2 4
null
‘"‘"5 9
)
‘"‘"9 :
{
’"’" 
_db
÷"÷" 
.
÷"÷"  
Estado_transaccion
÷"÷" *
.
÷"÷"* +
AddRange
÷"÷"+ 3
(
÷"÷"3 4+
estadosDeTransaccionParaCrear
÷"÷"4 Q
)
÷"÷"Q R
;
÷"÷"R S
}
◊"◊" 
if
ÿ"ÿ" 
(
ÿ"ÿ" %
estadosDeCuotaParaCrear
ÿ"ÿ" +
!=
ÿ"ÿ", .
null
ÿ"ÿ"/ 3
)
ÿ"ÿ"3 4
{
Ÿ"Ÿ" 
_db
⁄"⁄" 
.
⁄"⁄" 
Estado_cuota
⁄"⁄" $
.
⁄"⁄"$ %
AddRange
⁄"⁄"% -
(
⁄"⁄"- .%
estadosDeCuotaParaCrear
⁄"⁄". E
)
⁄"⁄"E F
;
⁄"⁄"F G
}
€"€" 
_db
‹"‹" 
.
‹"‹" !
Detalle_transaccion
‹"‹" '
.
‹"‹"' (
AddRange
‹"‹"( 0
(
‹"‹"0 1*
detallesTransaccionParaCrear
‹"‹"1 M
)
‹"‹"M N
;
‹"‹"N O.
 SetActualizarDetallesTransaccion
›"›" 0
(
›"›"0 1/
!detallesTransaccionParaActualizar
›"›"1 R
)
›"›"R S
;
›"›"S T
if
ﬂ"ﬂ" 
(
ﬂ"ﬂ" *
actoresNegocioParaActualizar
ﬂ"ﬂ" 0
!=
ﬂ"ﬂ"1 3
null
ﬂ"ﬂ"4 8
&&
ﬂ"ﬂ"9 ;*
actoresNegocioParaActualizar
ﬂ"ﬂ"< X
.
ﬂ"ﬂ"X Y
Count
ﬂ"ﬂ"Y ^
>
ﬂ"ﬂ"_ `
$num
ﬂ"ﬂ"a b
)
ﬂ"ﬂ"b c+
actoresNegocioParaActualizarﬂ"ﬂ"d Ä
.ﬂ"ﬂ"Ä Å
ForEachﬂ"ﬂ"Å à
(ﬂ"ﬂ"à â
tﬂ"ﬂ"â ä
=>ﬂ"ﬂ"ã ç
_dbﬂ"ﬂ"é ë
.ﬂ"ﬂ"ë í
Entryﬂ"ﬂ"í ó
(ﬂ"ﬂ"ó ò
tﬂ"ﬂ"ò ô
)ﬂ"ﬂ"ô ö
.ﬂ"ﬂ"ö õ
Stateﬂ"ﬂ"õ †
=ﬂ"ﬂ"° ¢
EntityStateﬂ"ﬂ"£ Æ
.ﬂ"ﬂ"Æ Ø
Modifiedﬂ"ﬂ"Ø ∑
)ﬂ"ﬂ"∑ ∏
;ﬂ"ﬂ"∏ π
OperationResult
·"·" 
result
·"·"  &
=
·"·"' (
Save
·"·") -
(
·"·"- .
)
·"·". /
;
·"·"/ 0
return
‚"‚" 
result
‚"‚" 
;
‚"‚" 
}
„"„" 
catch
‰"‰" 
(
‰"‰" *
DbUpdateConcurrencyException
‰"‰" /
ex
‰"‰"0 2
)
‰"‰"2 3
{
Â"Â" 
var
Ê"Ê" 
entry
Ê"Ê" 
=
Ê"Ê" 
ex
Ê"Ê" 
.
Ê"Ê" 
Entries
Ê"Ê" &
.
Ê"Ê"& '
Single
Ê"Ê"' -
(
Ê"Ê"- .
)
Ê"Ê". /
;
Ê"Ê"/ 0
var
Ë"Ë" 
	typeModel
Ë"Ë" 
=
Ë"Ë" 
ObjectContext
Ë"Ë"  -
.
Ë"Ë"- .
GetObjectType
Ë"Ë". ;
(
Ë"Ë"; <
entry
Ë"Ë"< A
.
Ë"Ë"A B
Entity
Ë"Ë"B H
.
Ë"Ë"H I
GetType
Ë"Ë"I P
(
Ë"Ë"P Q
)
Ë"Ë"Q R
)
Ë"Ë"R S
;
Ë"Ë"S T
if
Í"Í" 
(
Í"Í" 
	typeModel
Í"Í" 
.
Í"Í" 
Name
Í"Í" "
==
Í"Í"# %
typeof
Í"Í"& ,
(
Í"Í", -!
Detalle_transaccion
Í"Í"- @
)
Í"Í"@ A
.
Í"Í"A B
Name
Í"Í"B F
)
Í"Í"F G
{
Î"Î" 
return
Ï"Ï" 
new
Ï"Ï" 
OperationResult
Ï"Ï" .
(
Ï"Ï". /
new
Ï"Ï"/ 2)
DetalleTransaccionException
Ï"Ï"3 N
(
Ï"Ï"N O
ex
Ï"Ï"O Q
,
Ï"Ï"Q R
(
Ï"Ï"S T!
Detalle_transaccion
Ï"Ï"T g
)
Ï"Ï"g h
entry
Ï"Ï"h m
.
Ï"Ï"m n
Entity
Ï"Ï"n t
,
Ï"Ï"t u%
transaccionesParaCrearÏ"Ï"v å
.Ï"Ï"å ç
FirstÏ"Ï"ç í
(Ï"Ï"í ì
)Ï"Ï"ì î
)Ï"Ï"î ï
)Ï"Ï"ï ñ
;Ï"Ï"ñ ó
}
Ì"Ì" 
else
Ó"Ó" 
{
Ô"Ô" 
return
"" 
new
"" 
OperationResult
"" .
(
"". /
new
""/ 2'
SerieComprobanteException
""3 L
(
""L M
ex
""M O
,
""O P
(
""Q R
Serie_comprobante
""R c
)
""c d
entry
""d i
.
""i j
Entity
""j p
)
""p q
)
""q r
;
""r s
}
Ò"Ò" 
}
Ú"Ú" 
catch
Û"Û" 
(
Û"Û" 
	Exception
Û"Û" 
e
Û"Û" 
)
Û"Û" 
{
Ù"Ù" 
throw
ı"ı" 
new
ı"ı" 
DatosException
ı"ı" (
(
ı"ı"( )
$str
ı"ı") P
,
ı"ı"P Q
e
ı"ı"R S
)
ı"ı"S T
;
ı"ı"T U
}
ˆ"ˆ" 
}
˜"˜" 	
public
˘"˘" 
OperationResult
˘"˘" g
YCrearTransaccionCrearActualizarDetallesTransaccionCrearEstadoTransaccionCrearEstadosCuota
˘"˘" x
(
˘"˘"x y
Transaccion˘"˘"y Ñ
transaccion˘"˘"Ö ê
,˘"˘"ê ë
List˘"˘"í ñ
<˘"˘"ñ ó#
Detalle_transaccion˘"˘"ó ™
>˘"˘"™ ´,
detallesTransaccionParaCrear˘"˘"¨ »
,˘"˘"» …
List˘"˘"  Œ
<˘"˘"Œ œ#
Detalle_transaccion˘"˘"œ ‚
>˘"˘"‚ „1
!detallesTransaccionParaActualizar˘"˘"‰ Ö
,˘"˘"Ö Ü"
Estado_transaccion˘"˘"á ô#
estadoDeTransaccion˘"˘"ö ≠
,˘"˘"≠ Æ
List˘"˘"Ø ≥
<˘"˘"≥ ¥
Estado_cuota˘"˘"¥ ¿
>˘"˘"¿ ¡
estadosDeCuota˘"˘"¬ –
)˘"˘"– —
{
˙"˙" 	
try
˚"˚" 
{
¸"¸" 
_db
˛"˛" 
.
˛"˛" 
Transaccion
˛"˛" 
.
˛"˛"  
Add
˛"˛"  #
(
˛"˛"# $
transaccion
˛"˛"$ /
)
˛"˛"/ 0
;
˛"˛"0 1
_db
ˇ"ˇ" 
.
ˇ"ˇ" !
Detalle_transaccion
ˇ"ˇ" '
.
ˇ"ˇ"' (
AddRange
ˇ"ˇ"( 0
(
ˇ"ˇ"0 1*
detallesTransaccionParaCrear
ˇ"ˇ"1 M
)
ˇ"ˇ"M N
;
ˇ"ˇ"N O.
 SetActualizarDetallesTransaccion
Ä#Ä# 0
(
Ä#Ä#0 1/
!detallesTransaccionParaActualizar
Ä#Ä#1 R
)
Ä#Ä#R S
;
Ä#Ä#S T
_db
Å#Å# 
.
Å#Å#  
Estado_transaccion
Å#Å# &
.
Å#Å#& '
Add
Å#Å#' *
(
Å#Å#* +!
estadoDeTransaccion
Å#Å#+ >
)
Å#Å#> ?
;
Å#Å#? @
_db
Ç#Ç# 
.
Ç#Ç# 
Estado_cuota
Ç#Ç#  
.
Ç#Ç#  !
AddRange
Ç#Ç#! )
(
Ç#Ç#) *
estadosDeCuota
Ç#Ç#* 8
)
Ç#Ç#8 9
;
Ç#Ç#9 :
OperationResult
Ñ#Ñ# 
result
Ñ#Ñ#  &
=
Ñ#Ñ#' (
Save
Ñ#Ñ#) -
(
Ñ#Ñ#- .
)
Ñ#Ñ#. /
;
Ñ#Ñ#/ 0
return
Ö#Ö# 
result
Ö#Ö# 
;
Ö#Ö# 
}
Ü#Ü# 
catch
á#á# 
(
á#á# *
DbUpdateConcurrencyException
á#á# /
ex
á#á#0 2
)
á#á#2 3
{
à#à# 
var
â#â# 
entry
â#â# 
=
â#â# 
ex
â#â# 
.
â#â# 
Entries
â#â# &
.
â#â#& '
Single
â#â#' -
(
â#â#- .
)
â#â#. /
;
â#â#/ 0
var
ã#ã# 
	typeModel
ã#ã# 
=
ã#ã# 
ObjectContext
ã#ã#  -
.
ã#ã#- .
GetObjectType
ã#ã#. ;
(
ã#ã#; <
entry
ã#ã#< A
.
ã#ã#A B
Entity
ã#ã#B H
.
ã#ã#H I
GetType
ã#ã#I P
(
ã#ã#P Q
)
ã#ã#Q R
)
ã#ã#R S
;
ã#ã#S T
if
ç#ç# 
(
ç#ç# 
	typeModel
ç#ç# 
.
ç#ç# 
Name
ç#ç# "
==
ç#ç## %
typeof
ç#ç#& ,
(
ç#ç#, -!
Detalle_transaccion
ç#ç#- @
)
ç#ç#@ A
.
ç#ç#A B
Name
ç#ç#B F
)
ç#ç#F G
{
é#é# 
return
è#è# 
new
è#è# 
OperationResult
è#è# .
(
è#è#. /
new
è#è#/ 2)
DetalleTransaccionException
è#è#3 N
(
è#è#N O
ex
è#è#O Q
,
è#è#Q R
(
è#è#S T!
Detalle_transaccion
è#è#T g
)
è#è#g h
entry
è#è#h m
.
è#è#m n
Entity
è#è#n t
,
è#è#t u
transaccionè#è#v Å
)è#è#Å Ç
)è#è#Ç É
;è#è#É Ñ
}
ê#ê# 
else
ë#ë# 
{
í#í# 
return
ì#ì# 
new
ì#ì# 
OperationResult
ì#ì# .
(
ì#ì#. /
new
ì#ì#/ 2'
SerieComprobanteException
ì#ì#3 L
(
ì#ì#L M
ex
ì#ì#M O
,
ì#ì#O P
(
ì#ì#Q R
Serie_comprobante
ì#ì#R c
)
ì#ì#c d
entry
ì#ì#d i
.
ì#ì#i j
Entity
ì#ì#j p
)
ì#ì#p q
)
ì#ì#q r
;
ì#ì#r s
}
î#î# 
}
ï#ï# 
catch
ñ#ñ# 
(
ñ#ñ# 
	Exception
ñ#ñ# 
e
ñ#ñ# 
)
ñ#ñ# 
{
ó#ó# 
throw
ò#ò# 
new
ò#ò# 
DatosException
ò#ò# (
(
ò#ò#( )
$str
ò#ò#) P
,
ò#ò#P Q
e
ò#ò#R S
)
ò#ò#S T
;
ò#ò#T U
}
ô#ô# 
}
ö#ö# 	
public
¢#¢# 
OperationResult
¢#¢# $
RegistrarTransacciones
¢#¢# 5
(
¢#¢#5 6#
RegistroTransacciones
¢#¢#6 K
registro
¢#¢#L T
)
¢#¢#T U
{
£#£# 	
try
§#§# 
{
•#•# 
if
¶#¶# 
(
¶#¶# 
registro
¶#¶# 
.
¶#¶# !
Transacciones_Crear
¶#¶# 0
!=
¶#¶#1 3
null
¶#¶#4 8
)
¶#¶#8 9
_db
¶#¶#: =
.
¶#¶#= >
Transaccion
¶#¶#> I
.
¶#¶#I J
AddRange
¶#¶#J R
(
¶#¶#R S
registro
¶#¶#S [
.
¶#¶#[ \!
Transacciones_Crear
¶#¶#\ o
)
¶#¶#o p
;
¶#¶#p q
if
ß#ß# 
(
ß#ß# 
registro
ß#ß# 
.
ß#ß# '
DetallesTransaccion_Crear
ß#ß# 6
!=
ß#ß#7 9
null
ß#ß#: >
)
ß#ß#> ?
_db
ß#ß#@ C
.
ß#ß#C D!
Detalle_transaccion
ß#ß#D W
.
ß#ß#W X
AddRange
ß#ß#X `
(
ß#ß#` a
registro
ß#ß#a i
.
ß#ß#i j(
DetallesTransaccion_Crearß#ß#j É
)ß#ß#É Ñ
;ß#ß#Ñ Ö
if
®#®# 
(
®#®# 
registro
®#®# 
.
®#®# &
EstadosTransaccion_Crear
®#®# 5
!=
®#®#6 8
null
®#®#9 =
)
®#®#= >
_db
®#®#? B
.
®#®#B C 
Estado_transaccion
®#®#C U
.
®#®#U V
AddRange
®#®#V ^
(
®#®#^ _
registro
®#®#_ g
.
®#®#g h'
EstadosTransaccion_Crear®#®#h Ä
)®#®#Ä Å
;®#®#Å Ç
if
©#©# 
(
©#©# 
registro
©#©# 
.
©#©#  
EstadosCuota_Crear
©#©# /
!=
©#©#0 2
null
©#©#3 7
)
©#©#7 8
_db
©#©#9 <
.
©#©#< =
Estado_cuota
©#©#= I
.
©#©#I J
AddRange
©#©#J R
(
©#©#R S
registro
©#©#S [
.
©#©#[ \ 
EstadosCuota_Crear
©#©#\ n
)
©#©#n o
;
©#©#o p
if
´#´# 
(
´#´# 
registro
´#´# 
.
´#´# %
Transacciones_Modificar
´#´# 4
!=
´#´#5 7
null
´#´#8 <
&&
´#´#= ?
registro
´#´#@ H
.
´#´#H I%
Transacciones_Modificar
´#´#I `
.
´#´#` a
Count
´#´#a f
>
´#´#g h
$num
´#´#i j
)
´#´#j k
registro
´#´#l t
.
´#´#t u&
Transacciones_Modificar´#´#u å
.´#´#å ç
ForEach´#´#ç î
(´#´#î ï
t´#´#ï ñ
=>´#´#ó ô
_db´#´#ö ù
.´#´#ù û
Entry´#´#û £
(´#´#£ §
t´#´#§ •
)´#´#• ¶
.´#´#¶ ß
State´#´#ß ¨
=´#´#≠ Æ
EntityState´#´#Ø ∫
.´#´#∫ ª
Modified´#´#ª √
)´#´#√ ƒ
;´#´#ƒ ≈
if
≠#≠# 
(
≠#≠# 
registro
≠#≠# 
.
≠#≠# +
DetallesTransaccion_Modificar
≠#≠# :
!=
≠#≠#; =
null
≠#≠#> B
&&
≠#≠#C E
registro
≠#≠#F N
.
≠#≠#N O+
DetallesTransaccion_Modificar
≠#≠#O l
.
≠#≠#l m
Count
≠#≠#m r
>
≠#≠#s t
$num
≠#≠#u v
)
≠#≠#v w
registro≠#≠#x Ä
.≠#≠#Ä Å-
DetallesTransaccion_Modificar≠#≠#Å û
.≠#≠#û ü
ForEach≠#≠#ü ¶
(≠#≠#¶ ß
t≠#≠#ß ®
=>≠#≠#© ´
_db≠#≠#¨ Ø
.≠#≠#Ø ∞
Entry≠#≠#∞ µ
(≠#≠#µ ∂
t≠#≠#∂ ∑
)≠#≠#∑ ∏
.≠#≠#∏ π
State≠#≠#π æ
=≠#≠#ø ¿
EntityState≠#≠#¡ Ã
.≠#≠#Ã Õ
Modified≠#≠#Õ ’
)≠#≠#’ ÷
;≠#≠#÷ ◊
if
Æ#Æ# 
(
Æ#Æ# 
registro
Æ#Æ# 
.
Æ#Æ# '
Actores_Negocio_Modificar
Æ#Æ# 6
!=
Æ#Æ#7 9
null
Æ#Æ#: >
&&
Æ#Æ#? A
registro
Æ#Æ#B J
.
Æ#Æ#J K'
Actores_Negocio_Modificar
Æ#Æ#K d
.
Æ#Æ#d e
Count
Æ#Æ#e j
>
Æ#Æ#k l
$num
Æ#Æ#m n
)
Æ#Æ#n o
registro
Æ#Æ#p x
.
Æ#Æ#x y(
Actores_Negocio_ModificarÆ#Æ#y í
.Æ#Æ#í ì
ForEachÆ#Æ#ì ö
(Æ#Æ#ö õ
tÆ#Æ#õ ú
=>Æ#Æ#ù ü
_dbÆ#Æ#† £
.Æ#Æ#£ §
EntryÆ#Æ#§ ©
(Æ#Æ#© ™
tÆ#Æ#™ ´
)Æ#Æ#´ ¨
.Æ#Æ#¨ ≠
StateÆ#Æ#≠ ≤
=Æ#Æ#≥ ¥
EntityStateÆ#Æ#µ ¿
.Æ#Æ#¿ ¡
ModifiedÆ#Æ#¡ …
)Æ#Æ#…  
;Æ#Æ#  À
OperationResult
∞#∞# 
result
∞#∞#  &
=
∞#∞#' (
Save
∞#∞#) -
(
∞#∞#- .
)
∞#∞#. /
;
∞#∞#/ 0
return
≤#≤# 
result
≤#≤# 
;
≤#≤# 
}
≥#≥# 
catch
µ#µ# 
(
µ#µ# *
DbUpdateConcurrencyException
µ#µ# /
ex
µ#µ#0 2
)
µ#µ#2 3
{
∂#∂# 
var
∑#∑# 
entry
∑#∑# 
=
∑#∑# 
ex
∑#∑# 
.
∑#∑# 
Entries
∑#∑# &
.
∑#∑#& '
Single
∑#∑#' -
(
∑#∑#- .
)
∑#∑#. /
;
∑#∑#/ 0
var
π#π# 
	typeModel
π#π# 
=
π#π# 
ObjectContext
π#π#  -
.
π#π#- .
GetObjectType
π#π#. ;
(
π#π#; <
entry
π#π#< A
.
π#π#A B
Entity
π#π#B H
.
π#π#H I
GetType
π#π#I P
(
π#π#P Q
)
π#π#Q R
)
π#π#R S
;
π#π#S T
if
ª#ª# 
(
ª#ª# 
	typeModel
ª#ª# 
.
ª#ª# 
Name
ª#ª# "
==
ª#ª## %
typeof
ª#ª#& ,
(
ª#ª#, -!
Detalle_transaccion
ª#ª#- @
)
ª#ª#@ A
.
ª#ª#A B
Name
ª#ª#B F
)
ª#ª#F G
{
º#º# 
var
Ω#Ω# 
detalle
Ω#Ω# 
=
Ω#Ω#  !
(
Ω#Ω#" #!
Detalle_transaccion
Ω#Ω## 6
)
Ω#Ω#6 7
entry
Ω#Ω#7 <
.
Ω#Ω#< =
Entity
Ω#Ω#= C
;
Ω#Ω#C D
throw
æ#æ# 
new
æ#æ# )
DetalleTransaccionException
æ#æ# 9
(
æ#æ#9 :
ex
æ#æ#: <
,
æ#æ#< =
detalle
æ#æ#> E
,
æ#æ#E F
detalle
æ#æ#G N
.
æ#æ#N O
Transaccion
æ#æ#O Z
)
æ#æ#Z [
;
æ#æ#[ \
}
ø#ø# 
else
¿#¿# 
{
¡#¡# 
var
¬#¬# 
serie
¬#¬# 
=
¬#¬# 
(
¬#¬#  !
Serie_comprobante
¬#¬#! 2
)
¬#¬#2 3
entry
¬#¬#3 8
.
¬#¬#8 9
Entity
¬#¬#9 ?
;
¬#¬#? @
throw
ƒ#ƒ# 
new
ƒ#ƒ# '
SerieComprobanteException
ƒ#ƒ# 7
(
ƒ#ƒ#7 8
ex
ƒ#ƒ#8 :
,
ƒ#ƒ#: ;
serie
ƒ#ƒ#< A
)
ƒ#ƒ#A B
;
ƒ#ƒ#B C
}
≈#≈# 
}
∆#∆# 
catch
«#«# 
(
«#«# 
	Exception
«#«# 
e
«#«# 
)
«#«# 
{
»#»# 
throw
…#…# 
new
…#…# 
DatosException
…#…# (
(
…#…#( )
$str
…#…#) P
,
…#…#P Q
e
…#…#R S
)
…#…#S T
;
…#…#T U
}
 # # 
finally
À#À# 
{
Ã#Ã# 
}
Œ#Œ# 
}
—#—# 	
public
”#”# 
OperationResult
”#”# C
5CrearTransaccionActualizarDetalleTransaccionExistente
”#”# T
(
”#”#T U
Transaccion
”#”#U `
transaccion
”#”#a l
,
”#”#l m
List
”#”#n r
<
”#”#r s"
Detalle_transaccion”#”#s Ü
>”#”#Ü á&
updDetallesTransaccion”#”#à û
,”#”#û ü
int”#”#† £?
/idActorNegocioInternoTransaccionExistenteOrigen”#”#§ ”
,”#”#” ‘
int”#”#’ ÿ0
 idTipoTransaccionExistenteOrigen”#”#Ÿ ˘
,”#”#˘ ˙
int”#”#˚ ˛8
(idUltimoEstadoTransaccionExsitenteOrigen”#”#ˇ ß
,”#”#ß ®
int”#”#© ¨@
0idActorNegocioInternoTransaccionExistenteDestino”#”#≠ ›
,”#”#› ﬁ
int”#”#ﬂ ‚1
!idTipoTransaccionExistenteDestino”#”#„ Ñ
,”#”#Ñ Ö
int”#”#Ü â9
)idUltimoEstadoTransaccionExsitenteDestino”#”#ä ≥
)”#”#≥ ¥
{
‘#‘# 	
try
’#’# 
{
÷#÷# 
_db
ÿ#ÿ# 
.
ÿ#ÿ# 
Transaccion
ÿ#ÿ# 
.
ÿ#ÿ#  
Add
ÿ#ÿ#  #
(
ÿ#ÿ## $
transaccion
ÿ#ÿ#$ /
)
ÿ#ÿ#/ 0
;
ÿ#ÿ#0 1
var
€#€# #
idsConceptoNegocioUpd
€#€# )
=
€#€#* +$
updDetallesTransaccion
€#€#, B
.
€#€#B C
Select
€#€#C I
(
€#€#I J
vdu
€#€#J M
=>
€#€#N P
vdu
€#€#Q T
.
€#€#T U!
id_concepto_negocio
€#€#U h
)
€#€#h i
;
€#€#i j
Transaccion
›#›# !
dbTransaccionOrigen
›#›# /
=
›#›#0 1
_db
›#›#2 5
.
›#›#5 6
Transaccion
›#›#6 A
.
›#›#A B
Include
›#›#B I
(
›#›#I J
t
›#›#J K
=>
›#›#L N
t
›#›#O P
.
›#›#P Q!
Detalle_transaccion
›#›#Q d
)
›#›#d e
.
›#›#e f
SingleOrDefault
›#›#f u
(
›#›#u v
t
›#›#v w
=>
›#›#x z
t
›#›#{ |
.
›#›#| }'
id_actor_negocio_interno›#›#} ï
==›#›#ñ ò?
/idActorNegocioInternoTransaccionExistenteOrigen›#›#ô »
&&
ﬁ#ﬁ#8 :
t
ﬁ#ﬁ#; <
.
ﬁ#ﬁ#< =!
id_tipo_transaccion
ﬁ#ﬁ#= P
==
ﬁ#ﬁ#Q S.
 idTipoTransaccionExistenteOrigen
ﬁ#ﬁ#T t
&&
ﬂ#ﬂ#8 :
t
ﬂ#ﬂ#; <
.
ﬂ#ﬂ#< =
id_estado_actual
ﬂ#ﬂ#= M
==
ﬂ#ﬂ#N P6
(idUltimoEstadoTransaccionExsitenteOrigen
ﬂ#ﬂ#Q y
)
ﬂ#ﬂ#y z
;
ﬂ#ﬂ#z {
List
‚#‚# 
<
‚#‚# !
Detalle_transaccion
‚#‚# (
>
‚#‚#( ))
dbDetallesTransaccionOrigen
‚#‚#* E
=
‚#‚#F G!
dbTransaccionOrigen
‚#‚#H [
.
‚#‚#[ \!
Detalle_transaccion
‚#‚#\ o
.
‚#‚#o p
Where
‚#‚#p u
(
‚#‚#u v
dt
‚#‚#v x
=>
‚#‚#y {$
idsConceptoNegocioUpd‚#‚#| ë
.‚#‚#ë í
Contains‚#‚#í ö
(‚#‚#ö õ
dt‚#‚#õ ù
.‚#‚#ù û#
id_concepto_negocio‚#‚#û ±
)‚#‚#± ≤
)‚#‚#≤ ≥
.‚#‚#≥ ¥
ToList‚#‚#¥ ∫
(‚#‚#∫ ª
)‚#‚#ª º
;‚#‚#º Ω
Transaccion
Â#Â# "
dbTransaccionDestino
Â#Â# 0
=
Â#Â#1 2
_db
Â#Â#3 6
.
Â#Â#6 7
Transaccion
Â#Â#7 B
.
Â#Â#B C
Include
Â#Â#C J
(
Â#Â#J K
t
Â#Â#K L
=>
Â#Â#M O
t
Â#Â#P Q
.
Â#Â#Q R!
Detalle_transaccion
Â#Â#R e
)
Â#Â#e f
.
Â#Â#f g
SingleOrDefault
Â#Â#g v
(
Â#Â#v w
t
Â#Â#w x
=>
Â#Â#y {
t
Â#Â#| }
.
Â#Â#} ~'
id_actor_negocio_internoÂ#Â#~ ñ
==Â#Â#ó ô@
0idActorNegocioInternoTransaccionExistenteDestinoÂ#Â#ö  
&&
Ê#Ê#8 :
t
Ê#Ê#; <
.
Ê#Ê#< =!
id_tipo_transaccion
Ê#Ê#= P
==
Ê#Ê#Q S/
!idTipoTransaccionExistenteDestino
Ê#Ê#T u
&&
Á#Á#8 :
t
Á#Á#; <
.
Á#Á#< =
id_estado_actual
Á#Á#= M
==
Á#Á#N P7
)idUltimoEstadoTransaccionExsitenteDestino
Á#Á#Q z
)
Á#Á#z {
;
Á#Á#{ |
List
Í#Í# 
<
Í#Í# !
Detalle_transaccion
Í#Í# (
>
Í#Í#( )*
dbDetallesTransaccionDestino
Í#Í#* F
=
Í#Í#G H"
dbTransaccionDestino
Í#Í#I ]
.
Í#Í#] ^!
Detalle_transaccion
Í#Í#^ q
.
Í#Í#q r
Where
Í#Í#r w
(
Í#Í#w x
dt
Í#Í#x z
=>
Í#Í#{ }$
idsConceptoNegocioUpdÍ#Í#~ ì
.Í#Í#ì î
ContainsÍ#Í#î ú
(Í#Í#ú ù
dtÍ#Í#ù ü
.Í#Í#ü †#
id_concepto_negocioÍ#Í#† ≥
)Í#Í#≥ ¥
)Í#Í#¥ µ
.Í#Í#µ ∂
ToListÍ#Í#∂ º
(Í#Í#º Ω
)Í#Í#Ω æ
;Í#Í#æ ø
foreach
Ì#Ì# 
(
Ì#Ì# 
var
Ì#Ì# #
updDetalleTransaccion
Ì#Ì# 2
in
Ì#Ì#3 5$
updDetallesTransaccion
Ì#Ì#6 L
)
Ì#Ì#L M
{
Ó#Ó# 
bool
## 
	tieneLote
## "
=
### $
!
##% &
String
##& ,
.
##, -
IsNullOrEmpty
##- :
(
##: ;#
updDetalleTransaccion
##; P
.
##P Q
lote
##Q U
)
##U V
;
##V W
var
Ú#Ú# (
dbDetalleTransaccionOrigen
Ú#Ú# 2
=
Ú#Ú#3 4)
dbDetallesTransaccionOrigen
Ú#Ú#5 P
.
Ú#Ú#P Q
SingleOrDefault
Ú#Ú#Q `
(
Ú#Ú#` a
dbdt
Ú#Ú#a e
=>
Ú#Ú#f h
dbdt
Ú#Ú#i m
.
Ú#Ú#m n"
id_concepto_negocioÚ#Ú#n Å
==Ú#Ú#Ç Ñ%
updDetalleTransaccionÚ#Ú#Ö ö
.Ú#Ú#ö õ#
id_concepto_negocioÚ#Ú#õ Æ
&&Ú#Ú#Ø ±
(Ú#Ú#≤ ≥
(Ú#Ú#≥ ¥
!Ú#Ú#¥ µ
	tieneLoteÚ#Ú#µ æ
&&Ú#Ú#ø ¡
StringÚ#Ú#¬ »
.Ú#Ú#» …
IsNullOrEmptyÚ#Ú#… ÷
(Ú#Ú#÷ ◊
dbdtÚ#Ú#◊ €
.Ú#Ú#€ ‹
loteÚ#Ú#‹ ‡
)Ú#Ú#‡ ·
)Ú#Ú#· ‚
||Ú#Ú#„ Â
(Ú#Ú#Ê Á
	tieneLoteÚ#Ú#Á 
&&Ú#Ú#Ò Û
dbdtÚ#Ú#Ù ¯
.Ú#Ú#¯ ˘
loteÚ#Ú#˘ ˝
==Ú#Ú#˛ Ä%
updDetalleTransaccionÚ#Ú#Å ñ
.Ú#Ú#ñ ó
loteÚ#Ú#ó õ
)Ú#Ú#õ ú
)Ú#Ú#ú ù
)Ú#Ú#ù û
;Ú#Ú#û ü
var
ı#ı# )
dbDetalleTransaccionDestino
ı#ı# 3
=
ı#ı#4 5*
dbDetallesTransaccionDestino
ı#ı#6 R
.
ı#ı#R S
SingleOrDefault
ı#ı#S b
(
ı#ı#b c
dbdt
ı#ı#c g
=>
ı#ı#h j
dbdt
ı#ı#k o
.
ı#ı#o p"
id_concepto_negocioı#ı#p É
==ı#ı#Ñ Ü%
updDetalleTransaccionı#ı#á ú
.ı#ı#ú ù#
id_concepto_negocioı#ı#ù ∞
&&ı#ı#± ≥
(ı#ı#¥ µ
(ı#ı#µ ∂
!ı#ı#∂ ∑
	tieneLoteı#ı#∑ ¿
&&ı#ı#¡ √
Stringı#ı#ƒ  
.ı#ı#  À
IsNullOrEmptyı#ı#À ÿ
(ı#ı#ÿ Ÿ
dbdtı#ı#Ÿ ›
.ı#ı#› ﬁ
loteı#ı#ﬁ ‚
)ı#ı#‚ „
)ı#ı#„ ‰
||ı#ı#Â Á
(ı#ı#Ë È
	tieneLoteı#ı#È Ú
&&ı#ı#Û ı
dbdtı#ı#ˆ ˙
.ı#ı#˙ ˚
loteı#ı#˚ ˇ
==ı#ı#Ä Ç%
updDetalleTransaccionı#ı#É ò
.ı#ı#ò ô
loteı#ı#ô ù
)ı#ı#ù û
)ı#ı#û ü
)ı#ı#ü †
;ı#ı#† °(
dbDetalleTransaccionOrigen
¯#¯# .
.
¯#¯#. /
cantidad
¯#¯#/ 7
=
¯#¯#8 9(
dbDetalleTransaccionOrigen
¯#¯#: T
.
¯#¯#T U
cantidad
¯#¯#U ]
-
¯#¯#^ _#
updDetalleTransaccion
¯#¯#` u
.
¯#¯#u v
cantidad
¯#¯#v ~
;
¯#¯#~ 
if
˙#˙# 
(
˙#˙# )
dbDetalleTransaccionDestino
˙#˙# 3
!=
˙#˙#4 6
null
˙#˙#7 ;
)
˙#˙#; <
{
˚#˚# )
dbDetalleTransaccionDestino
˝#˝# 3
.
˝#˝#3 4
cantidad
˝#˝#4 <
=
˝#˝#= >)
dbDetalleTransaccionDestino
˝#˝#? Z
.
˝#˝#Z [
cantidad
˝#˝#[ c
+
˝#˝#d e#
updDetalleTransaccion
˝#˝#f {
.
˝#˝#{ |
cantidad˝#˝#| Ñ
;˝#˝#Ñ Ö
}
˛#˛# 
else
ˇ#ˇ# 
{
Ä$Ä$ "
dbTransaccionDestino
Ç$Ç$ ,
.
Ç$Ç$, -!
Detalle_transaccion
Ç$Ç$- @
.
Ç$Ç$@ A
Add
Ç$Ç$A D
(
Ç$Ç$D E#
updDetalleTransaccion
Ç$Ç$E Z
)
Ç$Ç$Z [
;
Ç$Ç$[ \
}
É$É$ 
if
á$á$ 
(
á$á$ #
updDetalleTransaccion
á$á$ -
.
á$á$- .7
)Valor_detalle_maestro_detalle_transaccion
á$á$. W
!=
á$á$X Z
null
á$á$[ _
)
á$á$_ `
{
à$à$ 
var
â$â$ 
updValorDetalles
â$â$ ,
=
â$â$- .#
updDetalleTransaccion
â$â$/ D
.
â$â$D E7
)Valor_detalle_maestro_detalle_transaccion
â$â$E n
.
â$â$n o
ToList
â$â$o u
(
â$â$u v
)
â$â$v w
;
â$â$w x
var
ä$ä$ %
dbValoresDetallesOrigen
ä$ä$ 3
=
ä$ä$4 5(
dbDetalleTransaccionOrigen
ä$ä$6 P
.
ä$ä$P Q7
)Valor_detalle_maestro_detalle_transaccion
ä$ä$Q z
;
ä$ä$z {
foreach
å$å$ 
(
å$å$  !
var
å$å$! $
updValorDetalle
å$å$% 4
in
å$å$5 7
updValorDetalles
å$å$8 H
)
å$å$H I
{
ç$ç$ %
dbValoresDetallesOrigen
é$é$ 3
.
é$é$3 4
SingleOrDefault
é$é$4 C
(
é$é$C D
dbvd
é$é$D H
=>
é$é$I K
dbvd
é$é$L P
.
é$é$P Q
id
é$é$Q S
==
é$é$T V
updValorDetalle
é$é$W f
.
é$é$f g
id
é$é$g i
)
é$é$i j
.
é$é$j k!
Detalle_transaccion
é$é$k ~
=é$é$ Ä+
dbDetalleTransaccionDestinoé$é$Å ú
;é$é$ú ù
}
è$è$ 
}
ê$ê$ 
}
í$í$ 
OperationResult
ì$ì$ 
result
ì$ì$  &
=
ì$ì$' (
Save
ì$ì$) -
(
ì$ì$- .
)
ì$ì$. /
;
ì$ì$/ 0
return
î$î$ 
result
î$î$ 
;
î$î$ 
}
ï$ï$ 
catch
ñ$ñ$ 
(
ñ$ñ$ 
	Exception
ñ$ñ$ 
e
ñ$ñ$ 
)
ñ$ñ$ 
{
ó$ó$ 
throw
ò$ò$ 
new
ò$ò$ 
DatosException
ò$ò$ (
(
ò$ò$( )
$str
ò$ò$) P
,
ò$ò$P Q
e
ò$ò$R S
)
ò$ò$S T
;
ò$ò$T U
}
ô$ô$ 
}
ö$ö$ 	
public
ú$ú$ 
IEnumerable
ú$ú$ 
<
ú$ú$ !
Detalle_transaccion
ú$ú$ .
>
ú$ú$. /(
ObtenerDetallesTransaccion
ú$ú$0 J
(
ú$ú$J K
long
ú$ú$K O
idTransaccion
ú$ú$P ]
)
ú$ú$] ^
{
ù$ù$ 	
return
û$û$ 
_db
û$û$ 
.
û$û$ !
Detalle_transaccion
û$û$ *
.
û$û$* +
Where
û$û$+ 0
(
û$û$0 1
dt
û$û$1 3
=>
û$û$4 6
dt
û$û$7 9
.
û$û$9 :
id_transaccion
û$û$: H
==
û$û$I K
idTransaccion
û$û$L Y
)
û$û$Y Z
;
û$û$Z [
}
ü$ü$ 	
public
°$°$ 
IEnumerable
°$°$ 
<
°$°$ !
Detalle_transaccion
°$°$ .
>
°$°$. /(
ObtenerDetallesTransaccion
°$°$0 J
(
°$°$J K
long
°$°$K O
idTransaccion
°$°$P ]
,
°$°$] ^
IEnumerable
°$°$_ j
<
°$°$j k
int
°$°$k n
>
°$°$n o!
idsConceptoNegocio°$°$p Ç
)°$°$Ç É
{
¢$¢$ 	
return
£$£$ 
_db
£$£$ 
.
£$£$ !
Detalle_transaccion
£$£$ *
.
£$£$* +
Where
£$£$+ 0
(
£$£$0 1
dt
£$£$1 3
=>
£$£$4 6
dt
£$£$7 9
.
£$£$9 :
id_transaccion
£$£$: H
==
£$£$I K
idTransaccion
£$£$L Y
&&
£$£$Z \ 
idsConceptoNegocio
£$£$] o
.
£$£$o p
Contains
£$£$p x
(
£$£$x y
dt
£$£$y {
.
£$£${ |"
id_concepto_negocio£$£$| è
)£$£$è ê
)£$£$ê ë
;£$£$ë í
}
§$§$ 	
public
¶$¶$ 
int
¶$¶$ B
4ObtenerNumeroDetallesDeTransaccionConCantidadMayorA0
¶$¶$ G
(
¶$¶$G H
long
¶$¶$H L
idConceptoBasico
¶$¶$M ]
,
¶$¶$] ^
int
¶$¶$_ b
idTipoTransaccion
¶$¶$c t
)
¶$¶$t u
{
ß$ß$ 	
return
®$®$ 
_db
®$®$ 
.
®$®$ !
Detalle_transaccion
®$®$ *
.
®$®$* +
Where
®$®$+ 0
(
®$®$0 1
dt
®$®$1 3
=>
®$®$4 6
dt
®$®$7 9
.
®$®$9 :
Transaccion
®$®$: E
.
®$®$E F!
id_tipo_transaccion
®$®$F Y
==
®$®$Z \
idTipoTransaccion
®$®$] n
&&
®$®$o q
dt
®$®$r t
.
®$®$t u
Concepto_negocio®$®$u Ö
.®$®$Ö Ü 
Detalle_maestro4®$®$Ü ñ
.®$®$ñ ó
id®$®$ó ô
==®$®$ö ú 
idConceptoBasico®$®$ù ≠
&&®$®$Æ ∞
dt®$®$± ≥
.®$®$≥ ¥
cantidad®$®$¥ º
>®$®$Ω æ
$num®$®$ø ¿
)®$®$¿ ¡
.®$®$¡ ¬
Count®$®$¬ «
(®$®$« »
)®$®$» …
;®$®$…  
}
©$©$ 	
public
≤$≤$ 
IEnumerable
≤$≤$ 
<
≤$≤$ 
long
≤$≤$ 
>
≤$≤$  %
ObtenerIdsTransacciones
≤$≤$! 8
(
≤$≤$8 9
int
≤$≤$9 <
idSerie
≤$≤$= D
,
≤$≤$D E
decimal
≤$≤$F M
montoMinimo
≤$≤$N Y
,
≤$≤$Y Z
decimal
≤$≤$[ b
montoMaximo
≤$≤$c n
,
≤$≤$n o
DateTime
≤$≤$p x
desde
≤$≤$y ~
,
≤$≤$~ 
DateTime≤$≤$Ä à
hasta≤$≤$â é
,≤$≤$é è
int≤$≤$ê ì
	idCliente≤$≤$î ù
,≤$≤$ù û
int≤$≤$ü ¢!
idTipoTransaccion≤$≤$£ ¥
,≤$≤$¥ µ
int≤$≤$∂ π
idEstado≤$≤$∫ ¬
)≤$≤$¬ √
{
≥$≥$ 	
return
¥$¥$ 
_db
¥$¥$ 
.
¥$¥$ 
Transaccion
¥$¥$ "
.
¥$¥$" #
Where
¥$¥$# (
(
¥$¥$( )
t
¥$¥$) *
=>
¥$¥$+ -
t
¥$¥$. /
.
¥$¥$/ 0
fecha_inicio
¥$¥$0 <
>
¥$¥$= >
desde
¥$¥$? D
&&
¥$¥$E G
t
¥$¥$H I
.
¥$¥$I J
fecha_inicio
¥$¥$J V
<
¥$¥$W X
hasta
¥$¥$Y ^
&&
¥$¥$_ a
t
¥$¥$b c
.
¥$¥$c d!
id_tipo_transaccion
¥$¥$d w
==
¥$¥$x z 
idTipoTransaccion¥$¥${ å
&&¥$¥$ç è
t¥$¥$ê ë
.¥$¥$ë í 
id_estado_actual¥$¥$í ¢
==¥$¥$£ •
idEstado¥$¥$¶ Æ
&&¥$¥$Ø ±
t¥$¥$≤ ≥
.¥$¥$≥ ¥(
id_actor_negocio_externo¥$¥$¥ Ã
==¥$¥$Õ œ
	idCliente¥$¥$– Ÿ
&&¥$¥$⁄ ‹
montoMinimo¥$¥$› Ë
<=¥$¥$È Î
t¥$¥$Ï Ì
.¥$¥$Ì Ó
importe_total¥$¥$Ó ˚
&&¥$¥$¸ ˛
montoMaximo¥$¥$ˇ ä
>=¥$¥$ã ç
t¥$¥$é è
.¥$¥$è ê
importe_total¥$¥$ê ù
&&¥$¥$û †
t¥$¥$° ¢
.¥$¥$¢ £
Comprobante¥$¥$£ Æ
.¥$¥$Æ Ø$
id_serie_comprobante¥$¥$Ø √
==¥$¥$ƒ ∆
idSerie¥$¥$« Œ
)¥$¥$Œ œ
.¥$¥$œ –
Select¥$¥$– ÷
(¥$¥$÷ ◊
t¥$¥$◊ ÿ
=>¥$¥$Ÿ €
t¥$¥$‹ ›
.¥$¥$› ﬁ
id¥$¥$ﬁ ‡
)¥$¥$‡ ·
;¥$¥$· ‚
}
µ$µ$ 	
public
∑$∑$ 
IEnumerable
∑$∑$ 
<
∑$∑$  
MontoNotaDeCredito
∑$∑$ -
>
∑$∑$- .,
ObtenerMontoAEmitirNotaCredito
∑$∑$/ M
(
∑$∑$M N
int
∑$∑$N Q
idSerieB002
∑$∑$R ]
,
∑$∑$] ^
int
∑$∑$_ b
idSerieB006
∑$∑$c n
,
∑$∑$n o
int
∑$∑$p s
idSerieB007
∑$∑$t 
,∑$∑$ Ä
decimal∑$∑$Å à
montoMinimo∑$∑$â î
,∑$∑$î ï
decimal∑$∑$ñ ù
montoMaximo∑$∑$û ©
,∑$∑$© ™
DateTime∑$∑$´ ≥
	desdeB002∑$∑$¥ Ω
,∑$∑$Ω æ
DateTime∑$∑$ø «
	hastaB002∑$∑$» —
,∑$∑$— “
DateTime∑$∑$” €
	desdeB006∑$∑$‹ Â
,∑$∑$Â Ê
DateTime∑$∑$Á Ô
	hastaB006∑$∑$ ˘
,∑$∑$˘ ˙
DateTime∑$∑$˚ É
	desdeB007∑$∑$Ñ ç
,∑$∑$ç é
DateTime∑$∑$è ó
	hastaB007∑$∑$ò °
,∑$∑$° ¢
int∑$∑$£ ¶
	idCliente∑$∑$ß ∞
,∑$∑$∞ ±
int∑$∑$≤ µ!
idTipoTransaccion∑$∑$∂ «
,∑$∑$« »
int∑$∑$… Ã
idEstado∑$∑$Õ ’
)∑$∑$’ ÷
{
∏$∏$ 	
return
π$π$ 
_db
π$π$ 
.
π$π$ 
Transaccion
π$π$ "
.
π$π$" #
Where
π$π$# (
(
π$π$( )
t
π$π$) *
=>
π$π$+ -
t
π$π$. /
.
π$π$/ 0!
id_tipo_transaccion
π$π$0 C
==
π$π$D F
idTipoTransaccion
π$π$G X
&&
∫$∫$ 
t
∫$∫$ 
.
∫$∫$ 
id_estado_actual
∫$∫$ !
==
∫$∫$" $
idEstado
∫$∫$% -
&&
ª$ª$ 
t
ª$ª$ 
.
ª$ª$ &
id_actor_negocio_externo
ª$ª$ )
==
ª$ª$* ,
	idCliente
ª$ª$- 6
&&
º$º$ 
montoMinimo
º$º$ 
<=
º$º$ 
t
º$º$ 
.
º$º$  
importe_total
º$º$  -
&&
Ω$Ω$ 
montoMaximo
Ω$Ω$ 
>=
Ω$Ω$ 
t
Ω$Ω$ 
.
Ω$Ω$  
importe_total
Ω$Ω$  -
&&
æ$æ$ 
(
æ$æ$ 
(
æ$æ$ 
t
æ$æ$ 
.
æ$æ$ 
Comprobante
æ$æ$ 
.
æ$æ$ "
id_serie_comprobante
æ$æ$ 3
==
æ$æ$4 6
idSerieB002
æ$æ$7 B
&&
æ$æ$C E
t
æ$æ$F G
.
æ$æ$G H
fecha_inicio
æ$æ$H T
>
æ$æ$U V
	desdeB002
æ$æ$W `
&&
æ$æ$a c
t
æ$æ$d e
.
æ$æ$e f
fecha_inicio
æ$æ$f r
<
æ$æ$s t
	hastaB002
æ$æ$u ~
)
æ$æ$~ 
||
ø$ø$ 
(
ø$ø$ 
t
ø$ø$ 
.
ø$ø$ 
Comprobante
ø$ø$ 
.
ø$ø$ "
id_serie_comprobante
ø$ø$ 2
==
ø$ø$3 5
idSerieB006
ø$ø$6 A
&&
ø$ø$B D
t
ø$ø$E F
.
ø$ø$F G
fecha_inicio
ø$ø$G S
>
ø$ø$T U
	desdeB006
ø$ø$V _
&&
ø$ø$` b
t
ø$ø$c d
.
ø$ø$d e
fecha_inicio
ø$ø$e q
<
ø$ø$r s
	hastaB006
ø$ø$t }
)
ø$ø$} ~
||
¿$¿$ 
(
¿$¿$ 
t
¿$¿$ 
.
¿$¿$ 
Comprobante
¿$¿$ 
.
¿$¿$ "
id_serie_comprobante
¿$¿$ 2
==
¿$¿$3 5
idSerieB007
¿$¿$6 A
&&
¿$¿$B D
t
¿$¿$E F
.
¿$¿$F G
fecha_inicio
¿$¿$G S
>
¿$¿$T U
	desdeB007
¿$¿$V _
&&
¿$¿$` b
t
¿$¿$c d
.
¿$¿$d e
fecha_inicio
¿$¿$e q
<
¿$¿$r s
	hastaB007
¿$¿$t }
)
¿$¿$} ~
)
¿$¿$~ 
)¿$¿$ Ä
.
¡$¡$ 
GroupBy
¡$¡$ 
(
¡$¡$ 
t
¡$¡$ 
=>
¡$¡$ 
t
¡$¡$ 
.
¡$¡$  
fecha_inicio
¡$¡$  ,
.
¡$¡$, -
Month
¡$¡$- 2
)
¡$¡$2 3
.
¡$¡$3 4
Select
¡$¡$4 :
(
¡$¡$: ;
t
¡$¡$; <
=>
¡$¡$= ?
new
¡$¡$@ C 
MontoNotaDeCredito
¡$¡$D V
(
¡$¡$V W
)
¡$¡$W X
{
¬$¬$ 
Mes
√$√$ 
=
√$√$ 
t
√$√$ 
.
√$√$ 
FirstOrDefault
√$√$ *
(
√$√$* +
)
√$√$+ ,
.
√$√$, -
fecha_inicio
√$√$- 9
.
√$√$9 :
Month
√$√$: ?
,
√$√$? @
Monto
ƒ$ƒ$ 
=
ƒ$ƒ$ 
t
ƒ$ƒ$ 
.
ƒ$ƒ$ 
Sum
ƒ$ƒ$ !
(
ƒ$ƒ$! "
tt
ƒ$ƒ$" $
=>
ƒ$ƒ$% '
tt
ƒ$ƒ$( *
.
ƒ$ƒ$* +
importe_total
ƒ$ƒ$+ 8
)
ƒ$ƒ$8 9
,
ƒ$ƒ$9 :
Comprobantes
≈$≈$  
=
≈$≈$! "
t
≈$≈$# $
.
≈$≈$$ %
Count
≈$≈$% *
(
≈$≈$* +
)
≈$≈$+ ,
}
∆$∆$ 
)
∆$∆$ 
;
∆$∆$ 
}
«$«$ 	
public
À$À$ 
IEnumerable
À$À$ 
<
À$À$ 
Transaccion
À$À$ &
>
À$À$& 'E
7ObtenerTransaccionesPorTipoYContenganIdTransaccionPadre
À$À$( _
(
À$À$_ `
long
À$À$` d
[
À$À$d e
]
À$À$e f#
idsTransaccionesPadre
À$À$g |
,
À$À$| }
intÀ$À$~ Å!
idTipoTransaccionÀ$À$Ç ì
)À$À$ì î
{
Ã$Ã$ 	
try
Õ$Õ$ 
{
Œ$Œ$ 
return
œ$œ$ 
_db
œ$œ$ 
.
œ$œ$ 
Transaccion
œ$œ$ &
.
œ$œ$& '
Where
–$–$ 
(
–$–$ 
t
–$–$ 
=>
–$–$ #
idsTransaccionesPadre
–$–$ 4
.
–$–$4 5
Contains
–$–$5 =
(
–$–$= >
(
–$–$> ?
long
–$–$? C
)
–$–$C D
t
–$–$D E
.
–$–$E F"
id_transaccion_padre
–$–$F Z
)
–$–$Z [
&&
–$–$\ ^
t
–$–$_ `
.
–$–$` a!
id_tipo_transaccion
–$–$a t
==
–$–$u w 
idTipoTransaccion–$–$x â
)–$–$â ä
;–$–$ä ã
}
—$—$ 
catch
“$“$ 
(
“$“$ 
	Exception
“$“$ 
e
“$“$ 
)
“$“$ 
{
”$”$ 
throw
‘$‘$ 
new
‘$‘$ 
DatosException
‘$‘$ (
(
‘$‘$( )
$str
‘$‘$) I
,
‘$‘$I J
e
‘$‘$K L
)
‘$‘$L M
;
‘$‘$M N
}
’$’$ 
}
÷$÷$ 	
public
◊$◊$ 
IEnumerable
◊$◊$ 
<
◊$◊$ 
Resumen_Venta
◊$◊$ (
>
◊$◊$( )!
ObtenerGuiaRemision
◊$◊$* =
(
◊$◊$= >
int
◊$◊$> A
[
◊$◊$A B
]
◊$◊$B C!
idsTiposTransaccion
◊$◊$D W
,
◊$◊$W X
int
◊$◊$Y \
[
◊$◊$\ ]
]
◊$◊$] ^"
idsTiposComprobantes
◊$◊$_ s
,
◊$◊$s t
DateTime
◊$◊$u }

fechaDesde◊$◊$~ à
,◊$◊$à â
DateTime◊$◊$ä í

fechaHasta◊$◊$ì ù
)◊$◊$ù û
{
ÿ$ÿ$ 	
try
Ÿ$Ÿ$ 
{
⁄$⁄$ 
return
‹$‹$ 
_db
‹$‹$ 
.
‹$‹$ 
Transaccion
‹$‹$ &
.
›$›$ 
Where
›$›$ 
(
›$›$ 
t
›$›$  
=>
›$›$! #
t
›$›$$ %
.
›$›$% &
fecha_inicio
›$›$& 2
>=
›$›$3 5

fechaDesde
›$›$6 @
&&
›$›$A C
t
›$›$D E
.
›$›$E F
fecha_inicio
›$›$F R
<=
›$›$S U

fechaHasta
›$›$V `
&&
ﬁ$ﬁ$ "
idsTiposComprobantes
ﬁ$ﬁ$ .
.
ﬁ$ﬁ$. /
Contains
ﬁ$ﬁ$/ 7
(
ﬁ$ﬁ$7 8
t
ﬁ$ﬁ$8 9
.
ﬁ$ﬁ$9 :
Comprobante
ﬁ$ﬁ$: E
.
ﬁ$ﬁ$E F!
id_tipo_comprobante
ﬁ$ﬁ$F Y
)
ﬁ$ﬁ$Y Z
&&
ﬁ$ﬁ$[ ]!
idsTiposTransaccion
ﬁ$ﬁ$^ q
.
ﬁ$ﬁ$q r
Contains
ﬁ$ﬁ$r z
(
ﬁ$ﬁ$z {
t
ﬁ$ﬁ${ |
.
ﬁ$ﬁ$| }"
id_tipo_transaccionﬁ$ﬁ$} ê
)ﬁ$ﬁ$ê ë
)ﬁ$ﬁ$ë í
.
ﬂ$ﬂ$ 
Select
ﬂ$ﬂ$ 
(
ﬂ$ﬂ$  
t
‡$‡$ 
=>
‡$‡$  
new
‡$‡$! $
Resumen_Venta
‡$‡$% 2
(
‡$‡$2 3
)
‡$‡$3 4
{
·$·$ 
Id
‚$‚$  "
=
‚$‚$# $
t
‚$‚$% &
.
‚$‚$& '
id
‚$‚$' )
,
‚$‚$) *
FechaEmision
„$„$  ,
=
„$„$- .
t
„$„$/ 0
.
„$„$0 1
fecha_inicio
„$„$1 =
,
„$„$= >
IdTipoComprobante
‰$‰$  1
=
‰$‰$2 3
t
‰$‰$4 5
.
‰$‰$5 6
Comprobante
‰$‰$6 A
.
‰$‰$A B
Detalle_maestro
‰$‰$B Q
.
‰$‰$Q R
id
‰$‰$R T
,
‰$‰$T U
TipoComprobante
Â$Â$  /
=
Â$Â$0 1
t
Â$Â$2 3
.
Â$Â$3 4
Comprobante
Â$Â$4 ?
.
Â$Â$? @
Detalle_maestro
Â$Â$@ O
.
Â$Â$O P
nombre
Â$Â$P V
,
Â$Â$V W
CodigoComprobante
Ê$Ê$  1
=
Ê$Ê$2 3
t
Ê$Ê$4 5
.
Ê$Ê$5 6
Comprobante
Ê$Ê$6 A
.
Ê$Ê$A B
Detalle_maestro
Ê$Ê$B Q
.
Ê$Ê$Q R
valor
Ê$Ê$R W
,
Ê$Ê$W X
SerieComprobante
Á$Á$  0
=
Á$Á$1 2
t
Á$Á$3 4
.
Á$Á$4 5
Comprobante
Á$Á$5 @
.
Á$Á$@ A
numero_serie
Á$Á$A M
,
Á$Á$M N
NumeroComprobante
Ë$Ë$  1
=
Ë$Ë$2 3
t
Ë$Ë$4 5
.
Ë$Ë$5 6
Comprobante
Ë$Ë$6 A
.
Ë$Ë$A B
numero
Ë$Ë$B H
,
Ë$Ë$H I
	IdCliente
È$È$  )
=
È$È$* +
t
È$È$, -
.
È$È$- .&
id_actor_negocio_externo
È$È$. F
,
È$È$F G$
IdTipoDocumentoCliente
Í$Í$  6
=
Í$Í$7 8
t
Í$Í$9 :
.
Í$Í$: ;
Actor_negocio1
Í$Í$; I
.
Í$Í$I J
Actor
Í$Í$J O
.
Í$Í$O P$
id_documento_identidad
Í$Í$P f
,
Í$Í$f g
DocumentoCliente
Î$Î$  0
=
Î$Î$1 2
t
Î$Î$3 4
.
Î$Î$4 5
Actor_negocio1
Î$Î$5 C
.
Î$Î$C D
Actor
Î$Î$D I
.
Î$Î$I J(
numero_documento_identidad
Î$Î$J d
,
Î$Î$d e
NombreCliente
Ï$Ï$  -
=
Ï$Ï$. /
t
Ï$Ï$0 1
.
Ï$Ï$1 2
Actor_negocio1
Ï$Ï$2 @
.
Ï$Ï$@ A
Actor
Ï$Ï$A F
.
Ï$Ï$F G
primer_nombre
Ï$Ï$G T
,
Ï$Ï$T U 
PrimerNombreCajero
Ì$Ì$  2
=
Ì$Ì$3 4
t
Ì$Ì$5 6
.
Ì$Ì$6 7
Actor_negocio
Ì$Ì$7 D
.
Ì$Ì$D E
Actor
Ì$Ì$E J
.
Ì$Ì$J K
primer_nombre
Ì$Ì$K X
,
Ì$Ì$X Y!
SegundoNombreCajero
Ó$Ó$  3
=
Ó$Ó$4 5
t
Ó$Ó$6 7
.
Ó$Ó$7 8
Actor_negocio
Ó$Ó$8 E
.
Ó$Ó$E F
Actor
Ó$Ó$F K
.
Ó$Ó$K L
segundo_nombre
Ó$Ó$L Z
,
Ó$Ó$Z [ 
TercerNombreCajero
Ô$Ô$  2
=
Ô$Ô$3 4
t
Ô$Ô$5 6
.
Ô$Ô$6 7
Actor_negocio
Ô$Ô$7 D
.
Ô$Ô$D E
Actor
Ô$Ô$E J
.
Ô$Ô$J K
tercer_nombre
Ô$Ô$K X
,
Ô$Ô$X Y
ImporteTotal
$$  ,
=
$$- .
t
$$/ 0
.
$$0 1
importe_total
$$1 >
,
$$> ?'
ValorParametroTipoDeVenta
Ò$Ò$  9
=
Ò$Ò$: ;
t
Ò$Ò$< =
.
Ò$Ò$= >#
Parametro_transaccion
Ò$Ò$> S
.
Ò$Ò$S T
FirstOrDefault
Ò$Ò$T b
(
Ò$Ò$b c
pcn
Ò$Ò$c f
=>
Ò$Ò$g i
pcn
Ò$Ò$j m
.
Ò$Ò$m n
id_parametro
Ò$Ò$n z
==
Ò$Ò${ }
MaestroSettingsÒ$Ò$~ ç
.Ò$Ò$ç é
DefaultÒ$Ò$é ï
.Ò$Ò$ï ñ2
"IdDetalleMaestroParametroTipoVentaÒ$Ò$ñ ∏
)Ò$Ò$∏ π
!=Ò$Ò$∫ º
nullÒ$Ò$Ω ¡
?Ò$Ò$¬ √
tÒ$Ò$ƒ ≈
.Ò$Ò$≈ ∆%
Parametro_transaccionÒ$Ò$∆ €
.Ò$Ò$€ ‹
FirstOrDefaultÒ$Ò$‹ Í
(Ò$Ò$Í Î
pcnÒ$Ò$Î Ó
=>Ò$Ò$Ô Ò
pcnÒ$Ò$Ú ı
.Ò$Ò$ı ˆ
id_parametroÒ$Ò$ˆ Ç
==Ò$Ò$É Ö
MaestroSettingsÒ$Ò$Ü ï
.Ò$Ò$ï ñ
DefaultÒ$Ò$ñ ù
.Ò$Ò$ù û2
"IdDetalleMaestroParametroTipoVentaÒ$Ò$û ¿
)Ò$Ò$¿ ¡
.Ò$Ò$¡ ¬
valorÒ$Ò$¬ «
:Ò$Ò$» …
nullÒ$Ò$  Œ
,Ò$Ò$Œ œ&
ValorParametroModoDePago
Ú$Ú$  8
=
Ú$Ú$9 :
t
Ú$Ú$; <
.
Ú$Ú$< =#
Parametro_transaccion
Ú$Ú$= R
.
Ú$Ú$R S
FirstOrDefault
Ú$Ú$S a
(
Ú$Ú$a b
pcn
Ú$Ú$b e
=>
Ú$Ú$f h
pcn
Ú$Ú$i l
.
Ú$Ú$l m
id_parametro
Ú$Ú$m y
==
Ú$Ú$z |
MaestroSettingsÚ$Ú$} å
.Ú$Ú$å ç
DefaultÚ$Ú$ç î
.Ú$Ú$î ï3
#IdDetalleMaestroParametroModoDePagoÚ$Ú$ï ∏
)Ú$Ú$∏ π
!=Ú$Ú$∫ º
nullÚ$Ú$Ω ¡
?Ú$Ú$¬ √
tÚ$Ú$ƒ ≈
.Ú$Ú$≈ ∆%
Parametro_transaccionÚ$Ú$∆ €
.Ú$Ú$€ ‹
FirstOrDefaultÚ$Ú$‹ Í
(Ú$Ú$Í Î
pcnÚ$Ú$Î Ó
=>Ú$Ú$Ô Ò
pcnÚ$Ú$Ú ı
.Ú$Ú$ı ˆ
id_parametroÚ$Ú$ˆ Ç
==Ú$Ú$É Ö
MaestroSettingsÚ$Ú$Ü ï
.Ú$Ú$ï ñ
DefaultÚ$Ú$ñ ù
.Ú$Ú$ù û3
#IdDetalleMaestroParametroModoDePagoÚ$Ú$û ¡
)Ú$Ú$¡ ¬
.Ú$Ú$¬ √
valorÚ$Ú$√ »
:Ú$Ú$…  
nullÚ$Ú$À œ
,Ú$Ú$œ –*
ValorParametroAliasDeCliente
Û$Û$  <
=
Û$Û$= >
t
Û$Û$? @
.
Û$Û$@ A#
Parametro_transaccion
Û$Û$A V
.
Û$Û$V W
FirstOrDefault
Û$Û$W e
(
Û$Û$e f
pcn
Û$Û$f i
=>
Û$Û$j l
pcn
Û$Û$m p
.
Û$Û$p q
id_parametro
Û$Û$q }
==Û$Û$~ Ä
MaestroSettingsÛ$Û$Å ê
.Û$Û$ê ë
DefaultÛ$Û$ë ò
.Û$Û$ò ô5
%IdDetalleMaestroParametroAliasClienteÛ$Û$ô æ
)Û$Û$æ ø
!=Û$Û$¿ ¬
nullÛ$Û$√ «
?Û$Û$» …
tÛ$Û$  À
.Û$Û$À Ã%
Parametro_transaccionÛ$Û$Ã ·
.Û$Û$· ‚
FirstOrDefaultÛ$Û$‚ 
(Û$Û$ Ò
pcnÛ$Û$Ò Ù
=>Û$Û$ı ˜
pcnÛ$Û$¯ ˚
.Û$Û$˚ ¸
id_parametroÛ$Û$¸ à
==Û$Û$â ã
MaestroSettingsÛ$Û$å õ
.Û$Û$õ ú
DefaultÛ$Û$ú £
.Û$Û$£ §5
%IdDetalleMaestroParametroAliasClienteÛ$Û$§ …
)Û$Û$…  
.Û$Û$  À
valorÛ$Û$À –
:Û$Û$— “
nullÛ$Û$” ◊
,Û$Û$◊ ÿ
IdEstado
Ù$Ù$  (
=
Ù$Ù$) *
t
Ù$Ù$+ ,
.
Ù$Ù$, -
id_estado_actual
Ù$Ù$- =
,
Ù$Ù$= >
Estado
ı$ı$  &
=
ı$ı$' (
t
ı$ı$) *
.
ı$ı$* +
Detalle_maestro
ı$ı$+ :
.
ı$ı$: ;
nombre
ı$ı$; A
,
ı$ı$A B
Transmitido
ˆ$ˆ$  +
=
ˆ$ˆ$, -
t
ˆ$ˆ$. /
.
ˆ$ˆ$/ 0 
Evento_transaccion
ˆ$ˆ$0 B
.
ˆ$ˆ$B C
Select
ˆ$ˆ$C I
(
ˆ$ˆ$I J
ev
ˆ$ˆ$J L
=>
ˆ$ˆ$M O
ev
ˆ$ˆ$P R
.
ˆ$ˆ$R S
	id_evento
ˆ$ˆ$S \
)
ˆ$ˆ$\ ]
.
ˆ$ˆ$] ^
Contains
ˆ$ˆ$^ f
(
ˆ$ˆ$f g
MaestroSettings
ˆ$ˆ$g v
.
ˆ$ˆ$v w
Default
ˆ$ˆ$w ~
.
ˆ$ˆ$~ 0
!IdDetalleMaestroEstadoTransmitidoˆ$ˆ$ †
)ˆ$ˆ$† °
}
¯$¯$ 
)
˘$˘$ 
.
˘$˘$ 
OrderByDescending
˘$˘$ '
(
˘$˘$' (
t
˘$˘$( )
=>
˘$˘$* ,
t
˘$˘$- .
.
˘$˘$. /
FechaEmision
˘$˘$/ ;
)
˘$˘$; <
;
˘$˘$< =
}
˚$˚$ 
catch
¸$¸$ 
(
¸$¸$ 
	Exception
¸$¸$ 
e
¸$¸$ 
)
¸$¸$ 
{
˝$˝$ 
throw
˛$˛$ 
new
˛$˛$ 
DatosException
˛$˛$ (
(
˛$˛$( )
$str
˛$˛$) I
,
˛$˛$I J
e
˛$˛$K L
)
˛$˛$L M
;
˛$˛$M N
}
ˇ$ˇ$ 
}
Ä%Ä% 	
public
Ç%Ç% 
IEnumerable
Ç%Ç% 
<
Ç%Ç% 
long
Ç%Ç% 
>
Ç%Ç%  -
ObtenerIdsGuiaRemisionPorEnviar
Ç%Ç%! @
(
Ç%Ç%@ A
DateTime
Ç%Ç%A I

fechaDesde
Ç%Ç%J T
,
Ç%Ç%T U
DateTime
Ç%Ç%V ^

fechaHasta
Ç%Ç%_ i
)
Ç%Ç%i j
{
É%É% 	
try
Ñ%Ñ% 
{
Ö%Ö% 
List
Ü%Ü% 
<
Ü%Ü% 
int
Ü%Ü% 
>
Ü%Ü% #
idsTiposTransacciones
Ü%Ü% /
=
Ü%Ü%0 1
Diccionario
Ü%Ü%2 =
.
Ü%Ü%= >:
,TiposDeTransaccionMovimientoDeBienes_Salidas
Ü%Ü%> j
.
Ü%Ü%j k
ToList
Ü%Ü%k q
(
Ü%Ü%q r
)
Ü%Ü%r s
;
Ü%Ü%s t#
idsTiposTransacciones
á%á% %
.
á%á%% &
AddRange
á%á%& .
(
á%á%. /
Diccionario
á%á%/ :
.
á%á%: ;;
-TiposDeTransaccionMovimientoDeBienes_Entradas
á%á%; h
.
á%á%h i
ToList
á%á%i o
(
á%á%o p
)
á%á%p q
)
á%á%q r
;
á%á%r s#
idsTiposTransacciones
à%à% %
.
à%à%% &
AddRange
à%à%& .
(
à%à%. /
Diccionario
à%à%/ :
.
à%à%: ;/
!TiposDeTransaccionGuiasDeRemision
à%à%; \
.
à%à%\ ]
ToList
à%à%] c
(
à%à%c d
)
à%à%d e
)
à%à%e f
;
à%à%f g
return
â%â% 
_db
â%â% 
.
â%â% 
Transaccion
â%â% &
.
â%â%& '
Where
â%â%' ,
(
â%â%, -
t
â%â%- .
=>
â%â%/ 1
t
â%â%2 3
.
â%â%3 4
fecha_inicio
â%â%4 @
>=
â%â%A C

fechaDesde
â%â%D N
&&
â%â%O Q
t
â%â%R S
.
â%â%S T
fecha_inicio
â%â%T `
<=
â%â%a c

fechaHasta
â%â%d n
&&
â%â%o q$
idsTiposTransaccionesâ%â%r á
.â%â%á à
Containsâ%â%à ê
(â%â%ê ë
tâ%â%ë í
.â%â%í ì#
id_tipo_transaccionâ%â%ì ¶
)â%â%¶ ß
&&â%â%® ™
tâ%â%´ ¨
.â%â%¨ ≠
Comprobanteâ%â%≠ ∏
.â%â%∏ π#
id_tipo_comprobanteâ%â%π Ã
==â%â%Õ œ
MaestroSettingsâ%â%– ﬂ
.â%â%ﬂ ‡
Defaultâ%â%‡ Á
.â%â%Á ËB
2IdDetalleMaestroComprobanteGuiaDeRemisionRemitenteâ%â%Ë ö
&&â%â%õ ù
(â%â%û ü
!â%â%ü †
tâ%â%† °
.â%â%° ¢"
Evento_transaccionâ%â%¢ ¥
.â%â%¥ µ
Anyâ%â%µ ∏
(â%â%∏ π
etâ%â%π ª
=>â%â%º æ
etâ%â%ø ¡
.â%â%¡ ¬
	id_eventoâ%â%¬ À
==â%â%Ã Œ
MaestroSettingsâ%â%œ ﬁ
.â%â%ﬁ ﬂ
Defaultâ%â%ﬂ Ê
.â%â%Ê Á1
!IdDetalleMaestroEstadoTransmitidoâ%â%Á à
)â%â%à â
)â%â%â ä
)â%â%ä ã
.â%â%ã å
Selectâ%â%å í
(â%â%í ì
tâ%â%ì î
=>â%â%ï ó
tâ%â%ò ô
.â%â%ô ö
idâ%â%ö ú
)â%â%ú ù
;â%â%ù û
}
ä%ä% 
catch
ã%ã% 
(
ã%ã% 
	Exception
ã%ã% 
e
ã%ã% 
)
ã%ã% 
{
å%å% 
throw
ç%ç% 
new
ç%ç% 
DatosException
ç%ç% (
(
ç%ç%( )
$str
ç%ç%) I
,
ç%ç%I J
e
ç%ç%K L
)
ç%ç%L M
;
ç%ç%M N
}
é%é% 
}
è%è% 	
public
ì%ì% 
IEnumerable
ì%ì% 
<
ì%ì% 
Resumen_Compra
ì%ì% )
>
ì%ì%) */
!ObtenerResumenCompraPorTipoCompra
ì%ì%+ L
(
ì%ì%L M
int
ì%ì%M P
[
ì%ì%P Q
]
ì%ì%Q R!
idsTiposTransaccion
ì%ì%S f
,
ì%ì%f g
int
ì%ì%h k
[
ì%ì%k l
]
ì%ì%l m"
idsTiposComprobanteì%ì%n Å
,ì%ì%Å Ç
intì%ì%É Ü
idEstadoì%ì%á è
,ì%ì%è ê
intì%ì%ë î&
idParametroTransaccionì%ì%ï ´
,ì%ì%´ ¨#
TipoOperacionCompraì%ì%≠ ¿)
valorParametroTransaccionì%ì%¡ ⁄
,ì%ì%⁄ €
DateTimeì%ì%‹ ‰

fechaDesdeì%ì%Â Ô
,ì%ì%Ô 
DateTimeì%ì%Ò ˘

fechaHastaì%ì%˙ Ñ
)ì%ì%Ñ Ö
{
î%î% 	
try
ï%ï% 
{
ñ%ñ% 
return
ó%ó% 
_db
ó%ó% 
.
ó%ó% 
Transaccion
ó%ó% &
.
ò%ò% 
Where
ò%ò% !
(
ò%ò%! "
t
ò%ò%" #
=>
ò%ò%$ &
t
ò%ò%' (
.
ò%ò%( )
fecha_inicio
ò%ò%) 5
>=
ò%ò%6 8

fechaDesde
ò%ò%9 C
&&
ò%ò%D F
t
ò%ò%G H
.
ò%ò%H I
fecha_inicio
ò%ò%I U
<=
ò%ò%V X

fechaHasta
ò%ò%Y c
&&
ô%ô% !
idsTiposTransaccion
ô%ô% 2
.
ô%ô%2 3
Contains
ô%ô%3 ;
(
ô%ô%; <
t
ô%ô%< =
.
ô%ô%= >!
id_tipo_transaccion
ô%ô%> Q
)
ô%ô%Q R
&&
ö%ö% !
idsTiposComprobante
ö%ö% 2
.
ö%ö%2 3
Contains
ö%ö%3 ;
(
ö%ö%; <
t
ö%ö%< =
.
ö%ö%= >
Comprobante
ö%ö%> I
.
ö%ö%I J!
id_tipo_comprobante
ö%ö%J ]
)
ö%ö%] ^
&&
õ%õ% 
t
õ%õ%  
.
õ%õ%  !
id_estado_actual
õ%õ%! 1
==
õ%õ%2 4
idEstado
õ%õ%5 =
&&
ú%ú% 
(
ú%ú%  
t
ú%ú%  !
.
ú%ú%! "#
Parametro_transaccion
ú%ú%" 7
.
ú%ú%7 8
FirstOrDefault
ú%ú%8 F
(
ú%ú%F G
tt
ú%ú%G I
=>
ú%ú%J L
tt
ú%ú%M O
.
ú%ú%O P
id_parametro
ú%ú%P \
==
ú%ú%] _$
idParametroTransaccion
ú%ú%` v
)
ú%ú%v w
.
ú%ú%w x
valor
ú%ú%x }
==ú%ú%~ Ä
(ú%ú%Å Ç
(ú%ú%Ç É
intú%ú%É Ü
)ú%ú%Ü á)
valorParametroTransaccionú%ú%á †
)ú%ú%† °
.ú%ú%° ¢
ToStringú%ú%¢ ™
(ú%ú%™ ´
)ú%ú%´ ¨
)ú%ú%¨ ≠
)ú%ú%≠ Æ
.
ù%ù% 
Select
ù%ù% #
(
ù%ù%# $
t
ù%ù%$ %
=>
ù%ù%& (
new
ù%ù%) ,
Resumen_Compra
ù%ù%- ;
(
ù%ù%; <
)
ù%ù%< =
{
û%û% 
Id
ü%ü%  "
=
ü%ü%# $
t
ü%ü%% &
.
ü%ü%& '
id
ü%ü%' )
,
ü%ü%) *
FechaInicio
†%†%  +
=
†%†%, -
t
†%†%. /
.
†%†%/ 0
fecha_inicio
†%†%0 <
,
†%†%< =
FechaRegistro
°%°%  -
=
°%°%- .
t
°%°%/ 0
.
°%°%0 1$
fecha_registro_sistema
°%°%1 G
,
°%°%G H
IdTipoComprobante
¢%¢%  1
=
¢%¢%2 3
t
¢%¢%4 5
.
¢%¢%5 6
Comprobante
¢%¢%6 A
.
¢%¢%A B
Detalle_maestro
¢%¢%B Q
.
¢%¢%Q R
id
¢%¢%R T
,
¢%¢%T U
TipoComprobante
£%£%  /
=
£%£%0 1
t
£%£%2 3
.
£%£%3 4
Comprobante
£%£%4 ?
.
£%£%? @
Detalle_maestro
£%£%@ O
.
£%£%O P
nombre
£%£%P V
,
£%£%V W
CodigoComprobante
§%§%  1
=
§%§%2 3
t
§%§%4 5
.
§%§%5 6
Comprobante
§%§%6 A
.
§%§%A B
Detalle_maestro
§%§%B Q
.
§%§%Q R
valor
§%§%R W
,
§%§%W X
SerieComprobante
•%•%  0
=
•%•%1 2
t
•%•%3 4
.
•%•%4 5
Comprobante
•%•%5 @
.
•%•%@ A
numero_serie
•%•%A M
,
•%•%M N
NumeroComprobante
¶%¶%  1
=
¶%¶%2 3
t
¶%¶%4 5
.
¶%¶%5 6
Comprobante
¶%¶%6 A
.
¶%¶%A B
numero
¶%¶%B H
,
¶%¶%H I
IdProveedor
ß%ß%  +
=
ß%ß%, -
t
ß%ß%. /
.
ß%ß%/ 0&
id_actor_negocio_externo
ß%ß%0 H
,
ß%ß%H I 
DocumentoProveedor
®%®%  2
=
®%®%3 4
t
®%®%5 6
.
®%®%6 7
Actor_negocio1
®%®%7 E
.
®%®%E F
Actor
®%®%F K
.
®%®%K L(
numero_documento_identidad
®%®%L f
,
®%®%f g
NombreProveedor
©%©%  /
=
©%©%0 1
t
©%©%2 3
.
©%©%3 4
Actor_negocio1
©%©%4 B
.
©%©%B C
Actor
©%©%C H
.
©%©%H I
primer_nombre
©%©%I V
,
©%©%V W
Importe
™%™%  '
=
™%™%( )
t
™%™%* +
.
™%™%+ ,
importe_total
™%™%, 9
,
™%™%9 :1
#ValorParametroTipoOperacionDeCompra
´%´%  C
=
´%´%D E
t
´%´%F G
.
´%´%G H#
Parametro_transaccion
´%´%H ]
.
´%´%] ^
FirstOrDefault
´%´%^ l
(
´%´%l m
pcn
´%´%m p
=>
´%´%q s
pcn
´%´%t w
.
´%´%w x
id_parametro´%´%x Ñ
==´%´%Ö á
MaestroSettings´%´%à ó
.´%´%ó ò
Default´%´%ò ü
.´%´%ü †3
#IdDetalleMaestroParametroTipoCompra´%´%† √
)´%´%√ ƒ
!=´%´%≈ «
null´%´%» Ã
?´%´%Õ Œ
t´%´%œ –
.´%´%– —%
Parametro_transaccion´%´%— Ê
.´%´%Ê Á
FirstOrDefault´%´%Á ı
(´%´%ı ˆ
pcn´%´%ˆ ˘
=>´%´%˙ ¸
pcn´%´%˝ Ä
.´%´%Ä Å
id_parametro´%´%Å ç
==´%´%é ê
MaestroSettings´%´%ë †
.´%´%† °
Default´%´%° ®
.´%´%® ©3
#IdDetalleMaestroParametroTipoCompra´%´%© Ã
)´%´%Ã Õ
.´%´%Õ Œ
valor´%´%Œ ”
:´%´%‘ ’
null´%´%÷ ⁄
,´%´%⁄ €&
ValorParametroModoDePago
¨%¨%  8
=
¨%¨%9 :
t
¨%¨%; <
.
¨%¨%< =#
Parametro_transaccion
¨%¨%= R
.
¨%¨%R S
FirstOrDefault
¨%¨%S a
(
¨%¨%a b
pcn
¨%¨%b e
=>
¨%¨%f h
pcn
¨%¨%i l
.
¨%¨%l m
id_parametro
¨%¨%m y
==
¨%¨%z |
MaestroSettings¨%¨%} å
.¨%¨%å ç
Default¨%¨%ç î
.¨%¨%î ï3
#IdDetalleMaestroParametroModoDePago¨%¨%ï ∏
)¨%¨%∏ π
!=¨%¨%∫ º
null¨%¨%Ω ¡
?¨%¨%¬ √
t¨%¨%ƒ ≈
.¨%¨%≈ ∆%
Parametro_transaccion¨%¨%∆ €
.¨%¨%€ ‹
FirstOrDefault¨%¨%‹ Í
(¨%¨%Í Î
pcn¨%¨%Î Ó
=>¨%¨%Ô Ò
pcn¨%¨%Ú ı
.¨%¨%ı ˆ
id_parametro¨%¨%ˆ Ç
==¨%¨%É Ö
MaestroSettings¨%¨%Ü ï
.¨%¨%ï ñ
Default¨%¨%ñ ù
.¨%¨%ù û3
#IdDetalleMaestroParametroModoDePago¨%¨%û ¡
)¨%¨%¡ ¬
.¨%¨%¬ √
valor¨%¨%√ »
:¨%¨%…  
null¨%¨%À œ
,¨%¨%œ –
Estado
≠%≠%  &
=
≠%≠%' (
t
≠%≠%) *
.
≠%≠%* +
Detalle_maestro
≠%≠%+ :
.
≠%≠%: ;
nombre
≠%≠%; A
,
≠%≠%A B
}
Æ%Æ% 
)
Ø%Ø% 
;
Ø%Ø% 
}
∞%∞% 
catch
±%±% 
(
±%±% 
	Exception
±%±% 
e
±%±% 
)
±%±% 
{
≤%≤% 
throw
≥%≥% 
new
≥%≥% 
DatosException
≥%≥% (
(
≥%≥%( )
$str
≥%≥%) N
,
≥%≥%N O
e
≥%≥%P Q
)
≥%≥%Q R
;
≥%≥%R S
}
¥%¥% 
}
µ%µ% 	
public
∏%∏% 
Transaccion
∏%∏% 3
%ObtenerTransaccionDeUltimoComprobante
∏%∏% @
(
∏%∏%@ A
int
∏%∏%A D 
idSerieComprobante
∏%∏%E W
)
∏%∏%W X
{
π%π% 	
try
∫%∫% 
{
ª%ª% 
Comprobante
º%º% 
comprobante
º%º% '
=
º%º%( )
_db
º%º%* -
.
º%º%- .
Comprobante
º%º%. 9
.
º%º%9 :
Where
º%º%: ?
(
º%º%? @
c
º%º%@ A
=>
º%º%B D
c
º%º%E F
.
º%º%F G"
id_serie_comprobante
º%º%G [
==
º%º%\ ^ 
idSerieComprobante
º%º%_ q
)
º%º%q r
.
º%º%r s 
OrderByDescendingº%º%s Ñ
(º%º%Ñ Ö
cº%º%Ö Ü
=>º%º%á â
cº%º%ä ã
.º%º%ã å
idº%º%å é
)º%º%é è
.º%º%è ê
FirstOrDefaultº%º%ê û
(º%º%û ü
)º%º%ü †
;º%º%† °
Transaccion
Ω%Ω% 
transaccion
Ω%Ω% '
=
Ω%Ω%( )
null
Ω%Ω%* .
;
Ω%Ω%. /
if
æ%æ% 
(
æ%æ% 
comprobante
æ%æ% 
!=
æ%æ%  "
null
æ%æ%# '
)
æ%æ%' (
{
ø%ø% 
transaccion
¿%¿% 
=
¿%¿%  !
_db
¿%¿%" %
.
¿%¿%% &
Transaccion
¿%¿%& 1
.
¿%¿%1 2
Where
¿%¿%2 7
(
¿%¿%7 8
t
¿%¿%8 9
=>
¿%¿%: <
t
¿%¿%= >
.
¿%¿%> ?
id_comprobante
¿%¿%? M
==
¿%¿%N P
comprobante
¿%¿%Q \
.
¿%¿%\ ]
id
¿%¿%] _
)
¿%¿%_ `
.
¿%¿%` a
FirstOrDefault
¿%¿%a o
(
¿%¿%o p
)
¿%¿%p q
;
¿%¿%q r
}
¡%¡% 
return
¬%¬% 
transaccion
¬%¬% "
;
¬%¬%" #
}
√%√% 
catch
ƒ%ƒ% 
(
ƒ%ƒ% 
	Exception
ƒ%ƒ% 
e
ƒ%ƒ% 
)
ƒ%ƒ% 
{
≈%≈% 
throw
∆%∆% 
new
∆%∆% 
DatosException
∆%∆% (
(
∆%∆%( )
$str
∆%∆%) X
,
∆%∆%X Y
e
∆%∆%Z [
)
∆%∆%[ \
;
∆%∆%\ ]
}
«%«% 
}
»%»% 	
public
À%À% 
string
À%À% Y
KObtenerUltimoRegistroDeDetalleTransaccionDeTransaccionOrdenVentaDeUnCliente
À%À% a
(
À%À%a b
int
À%À%b e
	idCliente
À%À%f o
)
À%À%o p
{
Ã%Ã% 	
string
Õ%Õ% (
registroDetalleTransaccion
Õ%Õ% -
=
Õ%Õ%. /
$str
Õ%Õ%0 2
;
Õ%Õ%2 3
if
Œ%Œ% 
(
Œ%Œ% 
_db
Œ%Œ% 
.
Œ%Œ% 
Transaccion
Œ%Œ% 
.
Œ%Œ% 
Any
Œ%Œ% "
(
Œ%Œ%" #
t
Œ%Œ%# $
=>
Œ%Œ%% '
t
Œ%Œ%( )
.
Œ%Œ%) *&
id_actor_negocio_externo
Œ%Œ%* B
==
Œ%Œ%C E
	idCliente
Œ%Œ%F O
&&
Œ%Œ%P R
t
Œ%Œ%S T
.
Œ%Œ%T U!
id_tipo_transaccion
Œ%Œ%U h
==
Œ%Œ%i k!
TransaccionSettings
Œ%Œ%l 
.Œ%Œ% Ä
DefaultŒ%Œ%Ä á
.Œ%Œ%á à-
IdTipoTransaccionOrdenDeVentaŒ%Œ%à •
)Œ%Œ%• ¶
)Œ%Œ%¶ ß
{
œ%œ% (
registroDetalleTransaccion
–%–% *
=
–%–%+ ,
_db
–%–%- 0
.
–%–%0 1
Transaccion
–%–%1 <
.
–%–%< =
Where
–%–%= B
(
–%–%B C
t
–%–%C D
=>
–%–%E G
t
–%–%H I
.
–%–%I J&
id_actor_negocio_externo
–%–%J b
==
–%–%c e
	idCliente
–%–%f o
&&
–%–%p r
t
–%–%s t
.
–%–%t u"
id_tipo_transaccion–%–%u à
==–%–%â ã#
TransaccionSettings–%–%å ü
.–%–%ü †
Default–%–%† ß
.–%–%ß ®-
IdTipoTransaccionOrdenDeVenta–%–%® ≈
)–%–%≈ ∆
.–%–%∆ «!
OrderByDescending–%–%« ÿ
(–%–%ÿ Ÿ
t–%–%Ÿ ⁄
=>–%–%€ ›
t–%–%ﬁ ﬂ
.–%–%ﬂ ‡
id–%–%‡ ‚
)–%–%‚ „
.–%–%„ ‰
FirstOrDefault–%–%‰ Ú
(–%–%Ú Û
)–%–%Û Ù
.–%–%Ù ı#
Detalle_transaccion–%–%ı à
.–%–%à â
FirstOrDefault–%–%â ó
(–%–%ó ò
)–%–%ò ô
.–%–%ô ö
registro–%–%ö ¢
;–%–%¢ £
}
—%—% 
return
”%”% (
registroDetalleTransaccion
”%”% -
;
”%”%- .
}
‘%‘% 	
public
’%’% 5
'OperacionTipoTransaccionTipoComprobante
’%’% 6<
.ObtenerTipoTransaccionTipoComprobanteOperacion
’%’%7 e
(
’%’%e f
long
’%’%f j
idOperacion
’%’%k v
)
’%’%v w
{
÷%÷% 	
try
◊%◊% 
{
ÿ%ÿ% 
return
Ÿ%Ÿ% 
_db
Ÿ%Ÿ% 
.
Ÿ%Ÿ% 
Transaccion
Ÿ%Ÿ% &
.
Ÿ%Ÿ%& '
Where
Ÿ%Ÿ%' ,
(
Ÿ%Ÿ%, -
t
Ÿ%Ÿ%- .
=>
Ÿ%Ÿ%/ 1
t
Ÿ%Ÿ%2 3
.
Ÿ%Ÿ%3 4
id
Ÿ%Ÿ%4 6
==
Ÿ%Ÿ%7 9
idOperacion
Ÿ%Ÿ%: E
)
Ÿ%Ÿ%E F
.
Ÿ%Ÿ%F G
Select
Ÿ%Ÿ%G M
(
Ÿ%Ÿ%M N
t
Ÿ%Ÿ%N O
=>
Ÿ%Ÿ%P R
new
⁄%⁄% 5
'OperacionTipoTransaccionTipoComprobante
⁄%⁄% ;
{
€%€% 
IdOperacion
‹%‹% 
=
‹%‹%  !
t
‹%‹%" #
.
‹%‹%# $
id
‹%‹%$ &
,
‹%‹%& '
IdTipoTransaccion
›%›% %
=
›%›%& '
t
›%›%( )
.
›%›%) *!
id_tipo_transaccion
›%›%* =
,
›%›%= >
IdTipoComprobante
ﬁ%ﬁ% %
=
ﬁ%ﬁ%& '
t
ﬁ%ﬁ%( )
.
ﬁ%ﬁ%) *
Comprobante
ﬁ%ﬁ%* 5
.
ﬁ%ﬁ%5 6!
id_tipo_comprobante
ﬁ%ﬁ%6 I
,
ﬁ%ﬁ%I J
SerieComprobante
ﬂ%ﬂ% $
=
ﬂ%ﬂ%% &
t
ﬂ%ﬂ%' (
.
ﬂ%ﬂ%( )
Comprobante
ﬂ%ﬂ%) 4
.
ﬂ%ﬂ%4 5
numero_serie
ﬂ%ﬂ%5 A
,
ﬂ%ﬂ%A B
NumeroComprobante
‡%‡% %
=
‡%‡%& '
t
‡%‡%( )
.
‡%‡%) *
Comprobante
‡%‡%* 5
.
‡%‡%5 6
numero
‡%‡%6 <
,
‡%‡%< =
TipoComprobante
·%·% #
=
·%·%$ %
t
·%·%& '
.
·%·%' (
Comprobante
·%·%( 3
.
·%·%3 4
Detalle_maestro
·%·%4 C
.
·%·%C D
nombre
·%·%D J
,
·%·%J K
Tercero
‚%‚% 
=
‚%‚% 
t
‚%‚% 
.
‚%‚%  
Actor_negocio1
‚%‚%  .
.
‚%‚%. /
Actor
‚%‚%/ 4
.
‚%‚%4 5
primer_nombre
‚%‚%5 B
.
‚%‚%B C
Replace
‚%‚%C J
(
‚%‚%J K
$str
‚%‚%K N
,
‚%‚%N O
$str
‚%‚%P S
)
‚%‚%S T
,
‚%‚%T U
FechaInicio
„%„% 
=
„%„%  !
t
„%„%" #
.
„%„%# $
fecha_inicio
„%„%$ 0
}
‰%‰% 
)
‰%‰% 
.
‰%‰% 
FirstOrDefault
‰%‰% !
(
‰%‰%! "
)
‰%‰%" #
;
‰%‰%# $
}
Â%Â% 
catch
Ê%Ê% 
(
Ê%Ê% 
	Exception
Ê%Ê% 
e
Ê%Ê% 
)
Ê%Ê% 
{
Á%Á% 
throw
Ë%Ë% 
new
Ë%Ë% 
DatosException
Ë%Ë% (
(
Ë%Ë%( )
$str
Ë%Ë%) d
,
Ë%Ë%d e
e
Ë%Ë%f g
)
Ë%Ë%g h
;
Ë%Ë%h i
}
È%È% 
}
Í%Í% 	
}
Î%Î% 
}Ì%Ì% Á
\D:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\FixVersionColumnConcurrencyMode.cs
	namespace 	
Utility
 
{ 
internal		 
class		 +
FixVersionColumnConcurrencyMode		 2
{

 
private 
static 
void 
Main  
(  !
string! '
[' (
]( )
args* .
). /
{ 	
string 
directoryPath  
=! "
Path# '
.' (
GetDirectoryName( 8
(8 9
Assembly9 A
.A B 
GetExecutingAssemblyB V
(V W
)W X
.X Y
LocationY a
)a b
;b c
var 
files 
= 
	Directory !
.! "
GetFiles" *
(* +
directoryPath+ 8
,8 9
$str: B
)B C
;C D
foreach 
( 
var 
file 
in  
files! &
)& '
{ 
	XDocument 
xmlDoc  
=! "
	XDocument# ,
., -
Load- 1
(1 2
file2 6
)6 7
;7 8
IEnumerable 
< 
XElement $
>$ %
versionColumns& 4
=5 6
from 
el 
in 
xmlDoc %
.% &
Descendants& 1
(1 2
)2 3
where 
( 
string !
)! "
el" $
.$ %
	Attribute% .
(. /
$str/ 5
)5 6
==7 9
$str: H
&& 
( 
string 
) 
el !
.! "
	Attribute" +
(+ ,
$str, 2
)2 3
==4 6
$str7 ?
&& 
( 
string 
) 
el !
.! "
	Attribute" +
(+ ,
$str, =
)= >
!=? A
$strB I
select 
el 
; 
bool 
modified 
= 
false  %
;% &
foreach 
( 
XElement !
el" $
in% '
versionColumns( 6
)6 7
{ 
modified 
= 
true #
;# $
el 
. 
SetAttributeValue (
(( )
$str) :
,: ;
$str< C
)C D
;D E
} 
if 
( 
modified 
) 
xmlDoc   
.   
Save   
(    
file    $
)  $ %
;  % &
}!! 
}"" 	
}## 
}$$ Í
LD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\RepositorioBase.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
." #
Generico# +
{ 
public 

class 
RepositorioBase  
:  !
IRepositorioBase! 1
{ 
	protected 
SigescomEntities "
_db# &
=' (
null) -
;- .
public 
RepositorioBase 
( 
)  
{ 	
_db 
= 
new 
SigescomEntities &
(& '
)' (
;( )
} 	
public 
OperationResult 
Save #
(# $
)$ %
{ 	
try 
{ 
_db 
. 
SaveChanges 
(  
)  !
;! "
return   
new   
OperationResult   *
(  * +
OperationResultEnum  + >
.  > ?
Success  ? F
)  F G
;  G H
}!! 
catch"" 
("" (
DbUpdateConcurrencyException"" /
ex""0 2
)""2 3
{## 
throw%% 
ex%% 
;%% 
})) 
catch** 
(** 
EntityException** "
e**# $
)**$ %
{++ 
OperationResult,, 
result,,  &
=,,' (
new,,) ,
OperationResult,,- <
(,,< =
OperationResultEnum,,= P
.,,P Q
Error,,Q V
,,,V W
$str	,,X Ø
)
,,Ø ∞
;
,,∞ ±
result-- 
.-- 

exceptions-- !
.--! "
Add--" %
(--% &
e--& '
)--' (
;--( )
return.. 
result.. 
;.. 
}// 
catch00 
(00 
	Exception00 
e00 
)00 
{11 
return22 
new22 
OperationResult22 *
(22* +
e22+ ,
)22, -
;22- .
}33 
}55 	
public88 
void88 
RefreshEntity88 !
(88! "
object88" (
_object88) 0
)880 1
{99 	
var:: 
context:: 
=:: 
(:: 
(:: !
IObjectContextAdapter:: 1
)::1 2
_db::2 5
)::5 6
.::6 7
ObjectContext::7 D
;::D E
context;; 
.;; 
Refresh;; 
(;; 
System;; "
.;;" #
Data;;# '
.;;' (
Entity;;( .
.;;. /
Core;;/ 3
.;;3 4
Objects;;4 ;
.;;; <
RefreshMode;;< G
.;;G H
	StoreWins;;H Q
,;;Q R
_object;;S Z
);;Z [
;;;[ \
}<< 	
public== 
void== #
RefreshEntityCollection== +
(==+ ,
IEnumerable==, 7
<==7 8
object==8 >
>==> ?

collection==@ J
)==J K
{>> 	
var?? 
context?? 
=?? 
(?? 
(?? !
IObjectContextAdapter?? 1
)??1 2
_db??2 5
)??5 6
.??6 7
ObjectContext??7 D
;??D E
context@@ 
.@@ 
Refresh@@ 
(@@ 
System@@ "
.@@" #
Data@@# '
.@@' (
Entity@@( .
.@@. /
Core@@/ 3
.@@3 4
Objects@@4 ;
.@@; <
RefreshMode@@< G
.@@G H
	StoreWins@@H Q
,@@Q R

collection@@S ]
)@@] ^
;@@^ _
}AA 	
}BB 
}CC ˆ
KD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Properties\AssemblyInfo.cs
[ 
assembly 	
:	 

AssemblyTitle 
( 
$str 3
)3 4
]4 5
[		 
assembly		 	
:			 

AssemblyDescription		 
(		 
$str		 !
)		! "
]		" #
[

 
assembly

 	
:

	 
!
AssemblyConfiguration

  
(

  !
$str

! #
)

# $
]

$ %
[ 
assembly 	
:	 

AssemblyCompany 
( 
$str 
) 
] 
[ 
assembly 	
:	 

AssemblyProduct 
( 
$str 5
)5 6
]6 7
[ 
assembly 	
:	 

AssemblyCopyright 
( 
$str 0
)0 1
]1 2
[ 
assembly 	
:	 

AssemblyTrademark 
( 
$str 
)  
]  !
[ 
assembly 	
:	 

AssemblyCulture 
( 
$str 
) 
] 
[ 
assembly 	
:	 


ComVisible 
( 
false 
) 
] 
[ 
assembly 	
:	 

Guid 
( 
$str 6
)6 7
]7 8
[## 
assembly## 	
:##	 

AssemblyVersion## 
(## 
$str## $
)##$ %
]##% &
[$$ 
assembly$$ 	
:$$	 

AssemblyFileVersion$$ 
($$ 
$str$$ (
)$$( )
]$$) *˙
ND:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\SigescomEntitites.cs
	namespace

 	
Tsp


 
.

 
Sigescom

 
.

 
Modelo

 
.

 
	Entidades

 '
{ 
public 

class 
	WriteFile 
{ 
[ 	
Conditional	 
( 
$str 
) 
] 
public 
static 
void 
WriteSQL #
(# $
string$ *
data+ /
)/ 0
{ 	
try 
{ 
string 
path 
= 
$str 0
;0 1
File 
. 
AppendAllText "
(" #
path# '
,' (
data) -
)- .
;. /
} 
catch 
( 
	Exception 
) 
{ 
} 
} 	
} 
} °w
UD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\Venta\VentaReporte_Datos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
{ 
public 

partial 
class 
VentaReporte_Datos +
:, -%
IVentaReporte_Repositorio. G
{ 
public 
IEnumerable 
< !
OperacionFamiliaGrupo 0
>0 1*
ObtenerVentasPorFamiliasGrupos2 P
(P Q
intQ T
[T U
]U V
idsTipoTransaccionW i
,i j
intk n
idEstadoo w
,w x
inty |
idPuntoVenta	} â
,
â ä
DateTime
ã ì

fechaDesde
î û
,
û ü
DateTime
† ®

fechaHasta
© ≥
,
≥ ¥
int
µ ∏
[
∏ π
]
π ∫
idsFamilias
ª ∆
,
∆ «
int
» À
[
À Ã
]
Ã Õ
	idsGrupos
Œ ◊
)
◊ ÿ
{ 	
try 
{ 
SigescomEntities  
_db! $
=% &
new' *
SigescomEntities+ ;
(; <
)< =
;= >
var 
	resultado 
= 
_db  #
.# $
Detalle_transaccion$ 7
.7 8
Where8 =
(= >
dt> @
=>A C
dtD F
.F G
TransaccionG R
.R S
fecha_inicioS _
>=` b

fechaDesdec m
&&8 :
dt; =
.= >
Transaccion> I
.I J
fecha_inicioJ V
<=W Y

fechaHastaZ d
&&8 :
dt; =
.= >
Transaccion> I
.I J$
id_actor_negocio_internoJ b
==c e
idPuntoVentaf r
&&8 :
idsTipoTransaccion; M
.M N
ContainsN V
(V W
dtW Y
.Y Z
TransaccionZ e
.e f
id_tipo_transaccionf y
)y z
&&8 :
dt; =
.= >
Transaccion> I
.I J
id_estado_actualJ Z
==[ ]
idEstado^ f
&&  8 :
idsFamilias  ; F
.  F G
Contains  G O
(  O P
(  P Q
int  Q T
)  T U
dt  U W
.  W X
Concepto_negocio  X h
.  h i
id_concepto_basico  i {
)  { |
&&!!8 :
	idsGrupos!!; D
.!!D E
Contains!!E M
(!!M N
(!!N O
int!!O R
)!!R S
dt!!S U
.!!U V
Transaccion!!V a
.!!a b%
id_actor_negocio_externo1!!b {
)!!{ |
)!!| }
."" 
Select"" 
("" 
dt"" 
=>""  
new""! $!
OperacionFamiliaGrupo""% :
("": ;
)""; <
{## 
IdTipoTransaccion$$ (
=$$) *
dt$$+ -
.$$- .
Transaccion$$. 9
.$$9 :
id_tipo_transaccion$$: M
,$$M N
IdGrupo%% 
=%%  
(%%! "
int%%" %
)%%% &
dt%%& (
.%%( )
Transaccion%%) 4
.%%4 5%
id_actor_negocio_externo1%%5 N
,%%N O
NombreGrupo&& "
=&&# $
dt&&% '
.&&' (
Transaccion&&( 3
.&&3 4
Actor_negocio3&&4 B
.&&B C
Actor&&C H
.&&H I
primer_nombre&&I V
,&&V W
	IdFamilia''  
=''! "
dt''# %
.''% &
Concepto_negocio''& 6
.''6 7
id_concepto_basico''7 I
,''I J
NombreFamilia(( $
=((% &
dt((' )
.(() *
Concepto_negocio((* :
.((: ;
Detalle_maestro4((; K
.((K L
nombre((L R
,((R S
Importe)) 
=))  
dt))! #
.))# $
total))$ )
}** 
)** 
;** 
return++ 
	resultado++  
;++  !
},, 
catch-- 
(-- 
	Exception-- 
e-- 
)-- 
{.. 
throw// 
new// 
DatosException// (
(//( )
$str//) a
,//a b
e//c d
)//d e
;//e f
}00 
}11 	
public22 
IEnumerable22 
<22 
OperacionGrupo22 )
>22) *"
ObtenerVentasPorGrupos22+ A
(22A B
int22B E
[22E F
]22F G
idsTipoTransaccion22H Z
,22Z [
int22\ _
idEstado22` h
,22h i
int22j m
idPuntoVenta22n z
,22z {
DateTime	22| Ñ

fechaDesde
22Ö è
,
22è ê
DateTime
22ë ô

fechaHasta
22ö §
,
22§ •
int
22¶ ©
[
22© ™
]
22™ ´
	idsGrupos
22¨ µ
)
22µ ∂
{33 	
try44 
{55 
SigescomEntities66  
_db66! $
=66% &
new66' *
SigescomEntities66+ ;
(66; <
)66< =
;66= >
var77 
	resultado77 
=77 
_db77  #
.77# $
Transaccion77$ /
.77/ 0
Where770 5
(775 6
t776 7
=>778 :
t77; <
.77< =
fecha_inicio77= I
>=77J L

fechaDesde77M W
&&888 :
t88; <
.88< =
fecha_inicio88= I
<=88J L

fechaHasta88M W
&&998 :
t99; <
.99< =$
id_actor_negocio_interno99= U
==99V X
idPuntoVenta99Y e
&&::8 :
idsTipoTransaccion::; M
.::M N
Contains::N V
(::V W
t::W X
.::X Y
id_tipo_transaccion::Y l
)::l m
&&;;8 :
t;;; <
.;;< =
id_estado_actual;;= M
==;;N P
idEstado;;Q Y
&&<<8 :
	idsGrupos<<; D
.<<D E
Contains<<E M
(<<M N
(<<N O
int<<O R
)<<R S
t<<S T
.<<T U%
id_actor_negocio_externo1<<U n
)<<n o
)<<o p
.== 
Select== 
(== 
t== 
=>== 
new==  #
OperacionGrupo==$ 2
(==2 3
)==3 4
{>> 
IdTipoTransaccion?? (
=??) *
t??+ ,
.??, -
id_tipo_transaccion??- @
,??@ A
IdGrupo@@ 
=@@  
(@@! "
int@@" %
)@@% &
t@@& '
.@@' (%
id_actor_negocio_externo1@@( A
,@@A B
NombreGrupoAA "
=AA# $
tAA% &
.AA& '
Actor_negocio3AA' 5
.AA5 6
ActorAA6 ;
.AA; <
primer_nombreAA< I
,AAI J 
DocumentoResponsableBB +
=BB, -
tBB. /
.BB/ 0
Actor_negocio3BB0 >
.BB> ?"
Vinculo_Actor_Negocio1BB? U
.BBU V
FirstOrDefaultBBV d
(BBd e
vanBBe h
=>BBi k
vanBBl o
.BBo p'
id_actor_negocio_vinculado	BBp ä
==
BBã ç
(
BBé è
int
BBè í
)
BBí ì
t
BBì î
.
BBî ï'
id_actor_negocio_externo1
BBï Æ
&&
BBØ ±
van
BB≤ µ
.
BBµ ∂
tipo_vinculo
BB∂ ¬
==
BB√ ≈
(
BB∆ «
int
BB«  
)
BB  À
TipoVinculo
BBÀ ÷
.
BB÷ ◊
ResponsableGrupo
BB◊ Á
)
BBÁ Ë
.
BBË È
Actor_negocio
BBÈ ˆ
.
BBˆ ˜
Actor
BB˜ ¸
.
BB¸ ˝(
numero_documento_identidad
BB˝ ó
,
BBó ò
NombreResponsableCC (
=CC) *
tCC+ ,
.CC, -
Actor_negocio3CC- ;
.CC; <"
Vinculo_Actor_Negocio1CC< R
.CCR S
FirstOrDefaultCCS a
(CCa b
vanCCb e
=>CCf h
vanCCi l
.CCl m'
id_actor_negocio_vinculado	CCm á
==
CCà ä
(
CCã å
int
CCå è
)
CCè ê
t
CCê ë
.
CCë í'
id_actor_negocio_externo1
CCí ´
&&
CC¨ Æ
van
CCØ ≤
.
CC≤ ≥
tipo_vinculo
CC≥ ø
==
CC¿ ¬
(
CC√ ƒ
int
CCƒ «
)
CC« »
TipoVinculo
CC» ”
.
CC” ‘
ResponsableGrupo
CC‘ ‰
)
CC‰ Â
.
CCÂ Ê
Actor_negocio
CCÊ Û
.
CCÛ Ù
Actor
CCÙ ˘
.
CC˘ ˙
primer_nombre
CC˙ á
.
CCá à
Replace
CCà è
(
CCè ê
$str
CCê ì
,
CCì î
$str
CCï ò
)
CCò ô
,
CCô ö
	IdClienteDD  
=DD! "
tDD# $
.DD$ %$
id_actor_negocio_externoDD% =
,DD= >
NombreClienteEE $
=EE% &
tEE' (
.EE( )
Actor_negocio1EE) 7
.EE7 8
ActorEE8 =
.EE= >
primer_nombreEE> K
.EEK L
ReplaceEEL S
(EES T
$strEET W
,EEW X
$strEEY \
)EE\ ]
,EE] ^
IdComprobanteFF $
=FF% &
tFF' (
.FF( )
id_comprobanteFF) 7
,FF7 8
InfoComprobanteGG &
=GG' (
$strGG) -
+GG. /
tGG0 1
.GG1 2
ComprobanteGG2 =
.GG= >
Detalle_maestroGG> M
.GGM N
valorGGN S
+GGT U
$strGGV Z
+GG[ \
tGG] ^
.GG^ _
ComprobanteGG_ j
.GGj k
numero_serieGGk w
+GGx y
$strGGz }
+GG~ 
t
GGÄ Å
.
GGÅ Ç
Comprobante
GGÇ ç
.
GGç é
numero
GGé î
+
GGï ñ
$str
GGó ö
,
GGö õ
ImporteHH 
=HH  
tHH! "
.HH" #
importe_totalHH# 0
,HH0 1
}II 
)II 
;II 
returnJJ 
	resultadoJJ  
;JJ  !
}KK 
catchLL 
(LL 
	ExceptionLL 
eLL 
)LL 
{MM 
throwNN 
newNN 
DatosExceptionNN (
(NN( )
$strNN) X
,NNX Y
eNNZ [
)NN[ \
;NN\ ]
}OO 
}PP 	
publicRR 
IEnumerableRR 
<RR #
OperacionGrupoDetalladoRR 2
>RR2 3*
ObtenerVentasPorGrupoDetalladoRR4 R
(RRR S
intRRS V
[RRV W
]RRW X
idsTipoTransaccionRRY k
,RRk l
intRRm p
idEstadoRRq y
,RRy z
intRR{ ~
idPuntoVenta	RR ã
,
RRã å
DateTime
RRç ï

fechaDesde
RRñ †
,
RR† °
DateTime
RR¢ ™

fechaHasta
RR´ µ
,
RRµ ∂
int
RR∑ ∫
idGrupo
RRª ¬
)
RR¬ √
{SS 	
tryTT 
{UU 
SigescomEntitiesVV  
_dbVV! $
=VV% &
newVV' *
SigescomEntitiesVV+ ;
(VV; <
)VV< =
;VV= >
varWW 
	resultadoWW 
=WW 
_dbWW  #
.WW# $
TransaccionWW$ /
.WW/ 0
WhereWW0 5
(WW5 6
tWW6 7
=>WW8 :
tWW; <
.WW< =
fecha_inicioWW= I
>=WWJ L

fechaDesdeWWM W
&&XX8 :
tXX; <
.XX< =
fecha_inicioXX= I
<=XXJ L

fechaHastaXXM W
&&YY8 :
tYY; <
.YY< =$
id_actor_negocio_internoYY= U
==YYV X
idPuntoVentaYYY e
&&ZZ8 :
idsTipoTransaccionZZ; M
.ZZM N
ContainsZZN V
(ZZV W
tZZW X
.ZZX Y
id_tipo_transaccionZZY l
)ZZl m
&&[[8 :
t[[; <
.[[< =
id_estado_actual[[= M
==[[N P
idEstado[[Q Y
&&\\8 :
(\\; <
int\\< ?
)\\? @
t\\@ A
.\\A B%
id_actor_negocio_externo1\\B [
==\\\ ^
idGrupo\\_ f
)\\f g
.]] 
Select]] 
(]] 
t]] 
=>]] 
new]]  ##
OperacionGrupoDetallado]]$ ;
(]]; <
)]]< =
{^^ 
Id__ 
=__ 
t__ 
.__ 
id__  
,__  !
IdTipoTransaccion`` (
=``) *
t``+ ,
.``, -
id_tipo_transaccion``- @
,``@ A
NombreResponsableaa (
=aa) *
taa+ ,
.aa, -
Actor_negocio3aa- ;
.aa; <"
Vinculo_Actor_Negocio1aa< R
.aaR S
FirstOrDefaultaaS a
(aaa b
vanaab e
=>aaf h
vanaai l
.aal m'
id_actor_negocio_vinculado	aam á
==
aaà ä
(
aaã å
int
aaå è
)
aaè ê
t
aaê ë
.
aaë í'
id_actor_negocio_externo1
aaí ´
&&
aa¨ Æ
van
aaØ ≤
.
aa≤ ≥
tipo_vinculo
aa≥ ø
==
aa¿ ¬
(
aa√ ƒ
int
aaƒ «
)
aa« »
TipoVinculo
aa» ”
.
aa” ‘
ResponsableGrupo
aa‘ ‰
)
aa‰ Â
.
aaÂ Ê
Actor_negocio
aaÊ Û
.
aaÛ Ù
Actor
aaÙ ˘
.
aa˘ ˙
primer_nombre
aa˙ á
.
aaá à
Replace
aaà è
(
aaè ê
$str
aaê ì
,
aaì î
$str
aaï ò
)
aaò ô
,
aaô ö
DocumentoClientebb '
=bb( )
tbb* +
.bb+ ,
Actor_negocio1bb, :
.bb: ;
Actorbb; @
.bb@ A&
numero_documento_identidadbbA [
,bb[ \
NombreClientecc $
=cc% &
tcc' (
.cc( )
Actor_negocio1cc) 7
.cc7 8
Actorcc8 =
.cc= >
primer_nombrecc> K
.ccK L
ReplaceccL S
(ccS T
$strccT W
,ccW X
$strccY \
)cc\ ]
,cc] ^
Emisiondd 
=dd  
tdd! "
.dd" #
fecha_iniciodd# /
,dd/ 0
TipoComprobanteee &
=ee' (
tee) *
.ee* +
Comprobanteee+ 6
.ee6 7
Detalle_maestroee7 F
.eeF G
valoreeG L
,eeL M#
SerieYNumeroComprobanteff .
=ff/ 0
tff1 2
.ff2 3
Comprobanteff3 >
.ff> ?
numero_serieff? K
+ffL M
$strffN Q
+ffR S
tffT U
.ffU V
ComprobanteffV a
.ffa b
numeroffb h
,ffh i
Importegg 
=gg  
tgg! "
.gg" #
importe_totalgg# 0
}ii 
)ii 
;ii 
returnjj 
	resultadojj  
;jj  !
}kk 
catchll 
(ll 
	Exceptionll 
ell 
)ll 
{mm 
thrownn 
newnn 
DatosExceptionnn (
(nn( )
$strnn) a
,nna b
ennc d
)nnd e
;nne f
}oo 
}pp 	
}uu 
}vv ¯
XD:\Tsp.Sigescom2.3-Back\Tsp.Sigescom.AccesoDatos\Sigescom\Venta\MaestrosAlmacen_Datos.cs
	namespace 	
Tsp
 
. 
Sigescom 
. 
AccesoDatos "
." #
Venta# (
{ 
public 

class 
MaestroVenta_Datos #
:# $&
IMaestrosVenta_Repositorio% ?
{ 
public 
IEnumerable 
< &
Familia_Concepto_Comercial 5
>5 6
ObtenerFamilias7 F
(F G
)G H
{ 	
try 
{ 
SigescomEntities  
_db! $
=% &
new' *
SigescomEntities+ ;
(; <
)< =
;= >
return 
_db 
.  
Concepto_negocio_rol /
./ 0
Where0 5
(5 6
cnr6 9
=>: <
cnr= @
.@ A
id_rolA G
==H J
ConceptoSettingsK [
.[ \
Default\ c
.c d
IdRolMercaderiad s
)s t
.t u
Selectu {
({ |
cnr| 
=>
Ä Ç
cnr
É Ü
.
Ü á
Concepto_negocio
á ó
)
ó ò
.
ò ô
Select
ô ü
(
ü †
cn
† ¢
=>
£ •
cn
¶ ®
.
® ©
Detalle_maestro4
© π
)
π ∫
.
∫ ª
Distinct
ª √
(
√ ƒ
)
ƒ ≈
. 
Select 
( 
dm 
=> !
new" %&
Familia_Concepto_Comercial& @
(@ A
)A B
{ 
Id 
= 
dm 
.  
id  "
," #
Nombre 
=  
dm! #
.# $
nombre$ *
,* +
Esbien 
=  
dm! #
.# $
valor$ )
==* ,
$str- 0
} 
) 
; 
} 
catch   
(   
	Exception   
e   
)   
{!! 
throw"" 
new"" 
DatosException"" (
(""( )
$str"") O
,""O P
e""Q R
)""R S
;""S T
}## 
}$$ 	
}'' 
}(( 